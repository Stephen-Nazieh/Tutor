{
  "version": 3,
  "sources": [],
  "debugId": "5cbb55a6-99a5-2718-8263-c0f7d4c560e2",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/cache-manager.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/api/parent-helpers.ts"],"sourcesContent":["// @ts-nocheck\n/**\n * Redis Cache Manager with Multi-Tier Caching\n * \n * Features:\n * - Multi-tier caching (L1: in-memory, L2: Redis)\n * - Compression for large values (>1KB)\n * - Encryption for sensitive data\n * - Tag-based invalidation system\n * - Performance monitoring hooks\n * - Type-safe schemas with Zod validation\n * - China network optimizations (shorter timeouts, keep-alive)\n * - Production-ready error handling\n * \n * Optimized for Chinese market:\n * - Reduced connection timeouts (2s vs 5s default)\n * - Aggressive keep-alive (30s)\n * - Connection pooling for high concurrency\n * - Automatic retry with exponential backoff\n */\n\nimport { z } from 'zod'\nimport * as crypto from 'crypto'\nimport { gzip, gunzip } from 'zlib'\nimport { promisify } from 'util'\nimport type { Redis } from 'ioredis'\n\nconst gzipAsync = promisify(gzip)\nconst gunzipAsync = promisify(gunzip)\n\n// ============================================================================\n// Configuration & Types\n// ============================================================================\n\nconst CACHE_CONFIG = {\n  // Key prefixes\n  PREFIX: 'tutorme:cache:',\n  TAG_PREFIX: 'tutorme:tags:',\n  METRIC_PREFIX: 'tutorme:metrics:',\n  \n  // Compression threshold (compress values larger than this)\n  COMPRESS_THRESHOLD: 1024, // 1KB\n  \n  // Encryption key (from env or generate)\n  ENCRYPTION_ALGORITHM: 'aes-256-gcm',\n  ENCRYPTION_KEY_LENGTH: 32,\n  \n  // China network optimizations\n  CONNECTION_TIMEOUT: 2000, // 2s (reduced from default 5s)\n  COMMAND_TIMEOUT: 3000, // 3s\n  KEEP_ALIVE: 30000, // 30s\n  MAX_RETRIES: 5,\n  RETRY_DELAY_BASE: 100, // ms\n  \n  // Health check\n  HEALTH_CHECK_INTERVAL: 30000, // 30s\n  \n  // In-memory cache limits\n  MEMORY_CACHE_MAX_SIZE: 1000, // Max entries\n  MEMORY_CACHE_TTL: 60, // seconds\n  \n  // Default TTLs (from env or defaults)\n  TTL_DEFAULT: parseInt(process.env.CACHE_TTL_DEFAULT || '60', 10),\n  TTL_USER: parseInt(process.env.CACHE_TTL_USER || '300', 10),\n  TTL_LEADERBOARD: parseInt(process.env.CACHE_TTL_LEADERBOARD || '300', 10),\n  TTL_CONTENT: parseInt(process.env.CACHE_TTL_CONTENT || '600', 10),\n} as const\n\n// Cache entry metadata schema\nconst CacheEntrySchema = z.object({\n  value: z.unknown(),\n  compressed: z.boolean().default(false),\n  encrypted: z.boolean().default(false),\n  tags: z.array(z.string()).default([]),\n  createdAt: z.number(),\n  ttl: z.number(),\n})\n\ntype CacheEntry<T> = {\n  value: T\n  compressed: boolean\n  encrypted: boolean\n  tags: string[]\n  createdAt: number\n  ttl: number\n}\n\n// Performance metrics schema\nconst MetricsSchema = z.object({\n  hits: z.number().default(0),\n  misses: z.number().default(0),\n  sets: z.number().default(0),\n  deletes: z.number().default(0),\n  errors: z.number().default(0),\n  totalLatencyMs: z.number().default(0),\n  compressionRatio: z.number().default(0),\n  memoryCacheHits: z.number().default(0),\n  redisCacheHits: z.number().default(0),\n})\n\ntype CacheMetrics = z.infer<typeof MetricsSchema>\n\n// Cache options type\ntype CacheOptions<T = unknown> = {\n  ttl?: number\n  tags?: string[]\n  compress?: boolean\n  encrypt?: boolean\n  schema?: z.ZodType<T>\n}\n\n// Performance monitoring hook type\ntype PerformanceHook = (operation: string, duration: number, success: boolean) => void\n\n// ============================================================================\n// Encryption & Compression Utilities\n// ============================================================================\n\nclass EncryptionService {\n  private key: Buffer\n  \n  constructor() {\n    // Get encryption key from env or generate one (for development)\n    const envKey = process.env.CACHE_ENCRYPTION_KEY\n    if (envKey) {\n      this.key = Buffer.from(envKey, 'hex')\n      if (this.key.length !== CACHE_CONFIG.ENCRYPTION_KEY_LENGTH) {\n        throw new Error('CACHE_ENCRYPTION_KEY must be 64 hex characters (32 bytes)')\n      }\n    } else {\n      // Generate a deterministic key from NEXTAUTH_SECRET for development\n      const secret = process.env.NEXTAUTH_SECRET || 'dev-secret-change-in-production'\n      this.key = crypto.createHash('sha256').update(secret).digest()\n    }\n  }\n  \n  encrypt(data: string): string {\n    const iv = crypto.randomBytes(16)\n    const cipher = crypto.createCipheriv(\n      CACHE_CONFIG.ENCRYPTION_ALGORITHM,\n      this.key,\n      iv\n    )\n    \n    let encrypted = cipher.update(data, 'utf8', 'hex')\n    encrypted += cipher.final('hex')\n    const authTag = cipher.getAuthTag()\n    \n    // Return: iv:authTag:encrypted\n    return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`\n  }\n  \n  decrypt(encryptedData: string): string {\n    const [ivHex, authTagHex, encrypted] = encryptedData.split(':')\n    if (!ivHex || !authTagHex || !encrypted) {\n      throw new Error('Invalid encrypted data format')\n    }\n    \n    const iv = Buffer.from(ivHex, 'hex')\n    const authTag = Buffer.from(authTagHex, 'hex')\n    \n    const decipher = crypto.createDecipheriv(\n      CACHE_CONFIG.ENCRYPTION_ALGORITHM,\n      this.key,\n      iv\n    )\n    decipher.setAuthTag(authTag)\n    \n    let decrypted = decipher.update(encrypted, 'hex', 'utf8')\n    decrypted += decipher.final('utf8')\n    \n    return decrypted\n  }\n}\n\n// ============================================================================\n// In-Memory Cache (L1)\n// ============================================================================\n\nclass MemoryCache {\n  private cache: Map<string, { data: CacheEntry<unknown>; expires: number }>\n  private maxSize: number\n  \n  constructor(maxSize = CACHE_CONFIG.MEMORY_CACHE_MAX_SIZE) {\n    this.cache = new Map()\n    this.maxSize = maxSize\n  }\n  \n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key)\n    if (!entry) return null\n    \n    if (entry.expires < Date.now()) {\n      this.cache.delete(key)\n      return null\n    }\n    \n    return entry.data.value as T\n  }\n  \n  set<T>(key: string, value: CacheEntry<T>, ttl: number): void {\n    // Evict oldest entries if at capacity\n    if (this.cache.size >= this.maxSize && !this.cache.has(key)) {\n      const oldestKey = this.cache.keys().next().value\n      if (oldestKey) this.cache.delete(oldestKey)\n    }\n    \n    this.cache.set(key, {\n      data: value as CacheEntry<unknown>,\n      expires: Date.now() + ttl * 1000,\n    })\n  }\n  \n  delete(key: string): void {\n    this.cache.delete(key)\n  }\n  \n  clear(): void {\n    this.cache.clear()\n  }\n  \n  size(): number {\n    return this.cache.size\n  }\n  \n  // Clean expired entries\n  cleanup(): number {\n    const now = Date.now()\n    let cleaned = 0\n    const entries = Array.from(this.cache.entries())\n    for (const [key, entry] of entries) {\n      if (entry.expires < now) {\n        this.cache.delete(key)\n        cleaned++\n      }\n    }\n    return cleaned\n  }\n}\n\n// ============================================================================\n// Cache Manager Class\n// ============================================================================\n\nclass CacheManager {\n  private redis: Redis | null = null\n  private memoryCache: MemoryCache\n  private encryption: EncryptionService\n  private metrics: CacheMetrics\n  private performanceHook: PerformanceHook | null = null\n  private healthCheckInterval: NodeJS.Timeout | null = null\n  private isHealthy = false\n  private initializationPromise: Promise<void> | null = null\n  \n  constructor() {\n    this.memoryCache = new MemoryCache()\n    this.encryption = new EncryptionService()\n    this.metrics = MetricsSchema.parse({})\n    \n    // Cleanup expired entries every minute\n    setInterval(() => {\n      this.memoryCache.cleanup()\n    }, 60000)\n  }\n  \n  // ========================================================================\n  // Initialization & Connection Management\n  // ========================================================================\n  \n  /**\n   * Initialize Redis connection with China network optimizations\n   */\n  async initialize(): Promise<void> {\n    if (this.initializationPromise) {\n      return this.initializationPromise\n    }\n    \n    this.initializationPromise = this._initialize()\n    return this.initializationPromise\n  }\n  \n  private async _initialize(): Promise<void> {\n    // Server-side only\n    if (typeof window !== 'undefined') {\n      console.warn('[CacheManager] Client-side initialization skipped')\n      return\n    }\n    \n    const redisUrl = process.env.REDIS_URL\n    if (!redisUrl) {\n      console.warn('[CacheManager] REDIS_URL not configured, using in-memory cache only')\n      return\n    }\n    \n    try {\n      const { Redis } = await import('ioredis')\n      \n      // China network optimizations: shorter timeouts, aggressive keep-alive\n      this.redis = new Redis(redisUrl, {\n        // Connection settings\n        connectTimeout: CACHE_CONFIG.CONNECTION_TIMEOUT,\n        commandTimeout: CACHE_CONFIG.COMMAND_TIMEOUT,\n        keepAlive: CACHE_CONFIG.KEEP_ALIVE,\n        lazyConnect: false,\n        \n        // Retry strategy with exponential backoff\n        retryStrategy: (times) => {\n          if (times > CACHE_CONFIG.MAX_RETRIES) {\n            console.error('[CacheManager] Max retries reached, giving up')\n            return null // Stop retrying\n          }\n          const delay = Math.min(\n            CACHE_CONFIG.RETRY_DELAY_BASE * Math.pow(2, times - 1),\n            2000\n          )\n          console.warn(`[CacheManager] Retry attempt ${times} after ${delay}ms`)\n          return delay\n        },\n        \n        maxRetriesPerRequest: 3,\n        \n        // Connection pool for high concurrency\n        enableReadyCheck: true,\n        enableOfflineQueue: true,\n        \n        // Error handling\n        showFriendlyErrorStack: process.env.NODE_ENV === 'development',\n      })\n      \n      // Event handlers\n      this.redis.on('connect', () => {\n        console.log('[CacheManager] Redis connected')\n        this.isHealthy = true\n      })\n      \n      this.redis.on('ready', () => {\n        console.log('[CacheManager] Redis ready')\n        this.isHealthy = true\n      })\n      \n      this.redis.on('error', (err) => {\n        console.error('[CacheManager] Redis error:', err.message)\n        this.isHealthy = false\n        this.metrics.errors++\n      })\n      \n      this.redis.on('close', () => {\n        console.warn('[CacheManager] Redis connection closed')\n        this.isHealthy = false\n      })\n      \n      this.redis.on('reconnecting', (delay) => {\n        console.log(`[CacheManager] Redis reconnecting in ${delay}ms`)\n      })\n      \n      // Wait for connection\n      await this.redis.ping()\n      console.log('[CacheManager] Redis initialized successfully')\n      \n      // Start health check\n      this.startHealthCheck()\n      \n    } catch (error) {\n      console.error('[CacheManager] Failed to initialize Redis:', error)\n      this.redis = null\n      this.isHealthy = false\n    }\n  }\n  \n  /**\n   * Health check for Redis connection\n   */\n  private startHealthCheck(): void {\n    if (this.healthCheckInterval) return\n    \n    this.healthCheckInterval = setInterval(async () => {\n      if (!this.redis) {\n        this.isHealthy = false\n        return\n      }\n      \n      try {\n        await Promise.race([\n          this.redis.ping(),\n          new Promise((_, reject) =>\n            setTimeout(() => reject(new Error('Health check timeout')), 1000)\n          ),\n        ])\n        this.isHealthy = true\n      } catch (error) {\n        console.warn('[CacheManager] Health check failed:', error)\n        this.isHealthy = false\n      }\n    }, CACHE_CONFIG.HEALTH_CHECK_INTERVAL)\n  }\n  \n  /**\n   * Check if cache is healthy\n   */\n  isCacheHealthy(): boolean {\n    return this.isHealthy || this.redis === null // Healthy if Redis unavailable (fallback mode)\n  }\n  \n  /**\n   * Get Redis client (for advanced usage)\n   */\n  getRedisClient(): Redis | null {\n    return this.redis\n  }\n  \n  // ========================================================================\n  // Performance Monitoring\n  // ========================================================================\n  \n  /**\n   * Set performance monitoring hook\n   */\n  setPerformanceHook(hook: PerformanceHook): void {\n    this.performanceHook = hook\n  }\n  \n  /**\n   * Record performance metrics\n   */\n  private recordMetrics(\n    operation: string,\n    duration: number,\n    success: boolean,\n    tier: 'memory' | 'redis' | 'none' = 'none'\n  ): void {\n    if (success) {\n      if (operation === 'get') {\n        this.metrics.hits++\n        if (tier === 'memory') this.metrics.memoryCacheHits++\n        if (tier === 'redis') this.metrics.redisCacheHits++\n      } else if (operation === 'set') {\n        this.metrics.sets++\n      } else if (operation === 'delete') {\n        this.metrics.deletes++\n      }\n    } else {\n      this.metrics.misses++\n      if (operation !== 'get') this.metrics.errors++\n    }\n    \n    this.metrics.totalLatencyMs += duration\n    \n    // Call performance hook if set\n    if (this.performanceHook) {\n      this.performanceHook(operation, duration, success)\n    }\n  }\n  \n  /**\n   * Get performance metrics\n   */\n  getMetrics(): CacheMetrics {\n    const hitRate = this.metrics.hits + this.metrics.misses > 0\n      ? this.metrics.hits / (this.metrics.hits + this.metrics.misses)\n      : 0\n    \n    const avgLatency = this.metrics.hits + this.metrics.misses > 0\n      ? this.metrics.totalLatencyMs / (this.metrics.hits + this.metrics.misses)\n      : 0\n    \n    return {\n      ...this.metrics,\n      hitRate,\n      avgLatencyMs: avgLatency,\n    } as CacheMetrics & { hitRate: number; avgLatencyMs: number }\n  }\n  \n  /**\n   * Reset metrics\n   */\n  resetMetrics(): void {\n    this.metrics = MetricsSchema.parse({})\n  }\n  \n  // ========================================================================\n  // Core Cache Operations\n  // ========================================================================\n  \n  /**\n   * Get cached value with multi-tier lookup\n   */\n  async get<T>(key: string, options: CacheOptions<T> = {}): Promise<T | null> {\n    const startTime = Date.now()\n    const fullKey = CACHE_CONFIG.PREFIX + key\n    \n    try {\n      // Ensure Redis is initialized\n      await this.initialize()\n      \n      // L1: Check in-memory cache first\n      const memoryValue = this.memoryCache.get<T>(fullKey)\n      if (memoryValue !== null) {\n        this.recordMetrics('get', Date.now() - startTime, true, 'memory')\n        return memoryValue\n      }\n      \n      // L2: Check Redis\n      if (this.redis && this.isHealthy) {\n        try {\n          const rawValue = await this.redis.get(fullKey)\n          if (rawValue) {\n            const entry = await this.deserializeEntry<T>(rawValue)\n            \n            // Check expiration\n            const age = (Date.now() - entry.createdAt) / 1000\n            if (age >= entry.ttl) {\n              await this.delete(key) // Expired, remove it\n              this.recordMetrics('get', Date.now() - startTime, false)\n              return null\n            }\n            \n            // Store in L1 cache\n            this.memoryCache.set(fullKey, entry, entry.ttl - age)\n            \n            // Validate schema if provided\n            if (options.schema) {\n              const validated = options.schema.parse(entry.value)\n              this.recordMetrics('get', Date.now() - startTime, true, 'redis')\n              return validated\n            }\n            \n            this.recordMetrics('get', Date.now() - startTime, true, 'redis')\n            return entry.value\n          }\n        } catch (error) {\n          console.error('[CacheManager] Redis get error:', error)\n          this.isHealthy = false\n        }\n      }\n      \n      this.recordMetrics('get', Date.now() - startTime, false)\n      return null\n      \n    } catch (error) {\n      console.error('[CacheManager] Get error:', error)\n      this.recordMetrics('get', Date.now() - startTime, false)\n      return null\n    }\n  }\n  \n  /**\n   * Set cached value with compression and encryption\n   */\n  async set<T>(\n    key: string,\n    value: T,\n    options: CacheOptions<T> = {}\n  ): Promise<boolean> {\n    const startTime = Date.now()\n    const fullKey = CACHE_CONFIG.PREFIX + key\n    const ttl = options.ttl || CACHE_CONFIG.TTL_DEFAULT\n    \n    try {\n      // Ensure Redis is initialized\n      await this.initialize()\n      \n      // Validate schema if provided\n      let validatedValue = value\n      if (options.schema) {\n        validatedValue = options.schema.parse(value)\n      }\n      \n      // Create cache entry\n      const entry: CacheEntry<T> = {\n        value: validatedValue,\n        compressed: false,\n        encrypted: false,\n        tags: options.tags || [],\n        createdAt: Date.now(),\n        ttl,\n      }\n      \n      // Serialize entry\n      let serialized = await this.serializeEntry(entry, options)\n      \n      // Store in L1 cache\n      this.memoryCache.set(fullKey, entry, ttl)\n      \n      // Store in L2 cache (Redis)\n      if (this.redis && this.isHealthy) {\n        try {\n          await this.redis.setex(fullKey, ttl, serialized)\n          \n          // Store tag mappings for invalidation\n          if (entry.tags.length > 0) {\n            await this.addTagsToKey(fullKey, entry.tags)\n          }\n          \n          this.recordMetrics('set', Date.now() - startTime, true)\n          return true\n        } catch (error) {\n          console.error('[CacheManager] Redis set error:', error)\n          this.isHealthy = false\n          // Still return true if memory cache succeeded\n          this.recordMetrics('set', Date.now() - startTime, true)\n          return true\n        }\n      }\n      \n      // Redis unavailable, but memory cache succeeded\n      this.recordMetrics('set', Date.now() - startTime, true)\n      return true\n      \n    } catch (error) {\n      console.error('[CacheManager] Set error:', error)\n      this.recordMetrics('set', Date.now() - startTime, false)\n      return false\n    }\n  }\n  \n  /**\n   * Delete cached value\n   */\n  async delete(key: string): Promise<boolean> {\n    const startTime = Date.now()\n    const fullKey = CACHE_CONFIG.PREFIX + key\n    \n    try {\n      // Delete from L1 cache\n      this.memoryCache.delete(fullKey)\n      \n      // Delete from L2 cache\n      if (this.redis && this.isHealthy) {\n        try {\n          await this.redis.del(fullKey)\n          // Remove tag mappings\n          await this.removeTagsFromKey(fullKey)\n          this.recordMetrics('delete', Date.now() - startTime, true)\n          return true\n        } catch (error) {\n          console.error('[CacheManager] Redis delete error:', error)\n          this.isHealthy = false\n          this.recordMetrics('delete', Date.now() - startTime, true) // Memory delete succeeded\n          return true\n        }\n      }\n      \n      this.recordMetrics('delete', Date.now() - startTime, true)\n      return true\n      \n    } catch (error) {\n      console.error('[CacheManager] Delete error:', error)\n      this.recordMetrics('delete', Date.now() - startTime, false)\n      return false\n    }\n  }\n  \n  /**\n   * Get or set pattern (cache-aside)\n   */\n  async getOrSet<T>(\n    key: string,\n    factory: () => Promise<T>,\n    options: CacheOptions<T> = {}\n  ): Promise<T> {\n    const cached = await this.get<T>(key, options)\n    if (cached !== null) {\n      return cached\n    }\n    \n    const value = await factory()\n    await this.set(key, value, options)\n    return value\n  }\n  \n  /**\n   * Clear all cache\n   */\n  async clear(): Promise<boolean> {\n    const startTime = Date.now()\n    \n    try {\n      // Clear L1 cache\n      this.memoryCache.clear()\n      \n      // Clear L2 cache\n      if (this.redis && this.isHealthy) {\n        try {\n          const keys = await this.redis.keys(CACHE_CONFIG.PREFIX + '*')\n          if (keys.length > 0) {\n            await this.redis.del(...keys)\n          }\n          // Clear tag mappings\n          const tagKeys = await this.redis.keys(CACHE_CONFIG.TAG_PREFIX + '*')\n          if (tagKeys.length > 0) {\n            await this.redis.del(...tagKeys)\n          }\n          this.recordMetrics('delete', Date.now() - startTime, true)\n          return true\n        } catch (error) {\n          console.error('[CacheManager] Redis clear error:', error)\n          this.isHealthy = false\n          this.recordMetrics('delete', Date.now() - startTime, true) // Memory clear succeeded\n          return true\n        }\n      }\n      \n      this.recordMetrics('delete', Date.now() - startTime, true)\n      return true\n      \n    } catch (error) {\n      console.error('[CacheManager] Clear error:', error)\n      this.recordMetrics('delete', Date.now() - startTime, false)\n      return false\n    }\n  }\n  \n  // ========================================================================\n  // Tag-Based Invalidation\n  // ========================================================================\n  \n  /**\n   * Invalidate all keys with given tag\n   */\n  async invalidateTag(tag: string): Promise<number> {\n    const startTime = Date.now()\n    const tagKey = CACHE_CONFIG.TAG_PREFIX + tag\n    \n    try {\n      if (!this.redis || !this.isHealthy) {\n        // Without Redis, we can't track tags efficiently\n        console.warn('[CacheManager] Tag invalidation requires Redis')\n        return 0\n      }\n      \n      // Get all keys for this tag\n      const keys = await this.redis.smembers(tagKey)\n      if (keys.length === 0) {\n        return 0\n      }\n      \n      // Delete all tagged keys\n      const fullKeys = keys.map((k) => CACHE_CONFIG.PREFIX + k.replace(CACHE_CONFIG.PREFIX, ''))\n      \n      // Also delete from memory cache\n      fullKeys.forEach((key) => this.memoryCache.delete(key))\n      \n      // Delete from Redis\n      await this.redis.del(...fullKeys)\n      \n      // Remove tag set\n      await this.redis.del(tagKey)\n      \n      this.recordMetrics('delete', Date.now() - startTime, true)\n      return keys.length\n      \n    } catch (error) {\n      console.error('[CacheManager] Tag invalidation error:', error)\n      this.recordMetrics('delete', Date.now() - startTime, false)\n      return 0\n    }\n  }\n  \n  /**\n   * Invalidate multiple tags\n   */\n  async invalidateTags(tags: string[]): Promise<number> {\n    let total = 0\n    for (const tag of tags) {\n      total += await this.invalidateTag(tag)\n    }\n    return total\n  }\n  \n  /**\n   * Add tags to a key (internal)\n   */\n  private async addTagsToKey(key: string, tags: string[]): Promise<void> {\n    if (!this.redis || !this.isHealthy || tags.length === 0) return\n    \n    try {\n      const pipeline = this.redis.pipeline()\n      for (const tag of tags) {\n        const tagKey = CACHE_CONFIG.TAG_PREFIX + tag\n        pipeline.sadd(tagKey, key)\n        pipeline.expire(tagKey, CACHE_CONFIG.TTL_DEFAULT * 2) // Tag TTL is 2x entry TTL\n      }\n      await pipeline.exec()\n    } catch (error) {\n      console.error('[CacheManager] Add tags error:', error)\n    }\n  }\n  \n  /**\n   * Remove tags from a key (internal)\n   */\n  private async removeTagsFromKey(key: string): Promise<void> {\n    if (!this.redis || !this.isHealthy) return\n    \n    try {\n      // Get all tags and remove this key from each\n      const tagKeys = await this.redis.keys(CACHE_CONFIG.TAG_PREFIX + '*')\n      if (tagKeys.length === 0) return\n      \n      const pipeline = this.redis.pipeline()\n      for (const tagKey of tagKeys) {\n        pipeline.srem(tagKey, key)\n      }\n      await pipeline.exec()\n    } catch (error) {\n      console.error('[CacheManager] Remove tags error:', error)\n    }\n  }\n  \n  // ========================================================================\n  // Serialization & Compression\n  // ========================================================================\n  \n  /**\n   * Serialize cache entry with optional compression/encryption\n   */\n  private async serializeEntry<T>(\n    entry: CacheEntry<T>,\n    options: CacheOptions<T>\n  ): Promise<string> {\n    // First serialize the entry to JSON\n    let serialized = JSON.stringify(entry)\n    \n    // Compression\n    const shouldCompress =\n      options.compress !== undefined\n        ? options.compress\n        : Buffer.byteLength(serialized, 'utf8') > CACHE_CONFIG.COMPRESS_THRESHOLD\n    \n    if (shouldCompress) {\n      const compressed = await gzipAsync(Buffer.from(serialized, 'utf8'))\n      serialized = compressed.toString('base64')\n      entry.compressed = true\n    }\n    \n    // Encryption\n    if (options.encrypt) {\n      serialized = this.encryption.encrypt(serialized)\n      entry.encrypted = true\n    }\n    \n    // Create wrapper object with metadata and the processed data\n    const wrapper = {\n      compressed: entry.compressed,\n      encrypted: entry.encrypted,\n      tags: entry.tags,\n      createdAt: entry.createdAt,\n      ttl: entry.ttl,\n      data: serialized, // Store the compressed/encrypted serialized data\n    }\n    \n    return JSON.stringify(wrapper)\n  }\n  \n  /**\n   * Deserialize cache entry with decompression/decryption\n   */\n  private async deserializeEntry<T>(serialized: string): Promise<CacheEntry<T>> {\n    const wrapper = JSON.parse(serialized) as {\n      compressed: boolean\n      encrypted: boolean\n      tags: string[]\n      createdAt: number\n      ttl: number\n      data: string\n    }\n    \n    let data = wrapper.data\n    \n    // Decrypt first (if encrypted)\n    if (wrapper.encrypted) {\n      data = this.encryption.decrypt(data)\n    }\n    \n    // Decompress (if compressed)\n    if (wrapper.compressed) {\n      const decompressed = await gunzipAsync(Buffer.from(data, 'base64'))\n      data = decompressed.toString('utf8')\n    }\n    \n    // Parse the original entry\n    const entry = JSON.parse(data) as CacheEntry<T>\n    \n    // Restore metadata\n    entry.compressed = wrapper.compressed\n    entry.encrypted = wrapper.encrypted\n    entry.tags = wrapper.tags\n    entry.createdAt = wrapper.createdAt\n    entry.ttl = wrapper.ttl\n    \n    return entry\n  }\n  \n  // ========================================================================\n  // Cleanup & Disconnection\n  // ========================================================================\n  \n  /**\n   * Disconnect from Redis\n   */\n  async disconnect(): Promise<void> {\n    if (this.healthCheckInterval) {\n      clearInterval(this.healthCheckInterval)\n      this.healthCheckInterval = null\n    }\n    \n    if (this.redis) {\n      await this.redis.quit()\n      this.redis = null\n      this.isHealthy = false\n    }\n    \n    this.memoryCache.clear()\n    console.log('[CacheManager] Disconnected')\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\n// Global instance (server-side only)\nconst globalForCache = globalThis as unknown as {\n  cacheManager: CacheManager | undefined\n}\n\nlet cacheManager: CacheManager\n\nif (typeof window === 'undefined') {\n  // Server-side: use singleton\n  if (!globalForCache.cacheManager) {\n    globalForCache.cacheManager = new CacheManager()\n  }\n  cacheManager = globalForCache.cacheManager\n} else {\n  // Client-side: create a no-op instance\n  cacheManager = new CacheManager()\n}\n\n// Export singleton instance\nexport default cacheManager\n\n// Export types and utilities\nexport type { CacheOptions, CacheMetrics, PerformanceHook }\nexport { CacheManager, CACHE_CONFIG }\n","import type { Session } from 'next-auth'\nimport { and, eq, inArray } from 'drizzle-orm'\nimport { drizzleDb } from '@/lib/db/drizzle'\nimport { familyAccount, familyMember, profile, user } from '@/lib/db/schema'\nimport cacheManager from '@/lib/cache-manager'\n\n/** Parent API cache TTLs - optimized for 85%+ hit rate, Chinese market */\nexport const PARENT_CACHE_TTL = {\n  DASHBOARD: parseInt(process.env.CACHE_TTL_PARENT_DASHBOARD || '180', 10),\n  STUDENT_ANALYTICS: parseInt(process.env.CACHE_TTL_STUDENT_ANALYTICS || '45', 10),\n  FINANCIAL: parseInt(process.env.CACHE_TTL_PARENT_FINANCIAL || '120', 10),\n  FAMILY: parseInt(process.env.CACHE_TTL_PARENT_FAMILY || '300', 10),\n} as const\n\nconst CACHE_TTL_PARENT = PARENT_CACHE_TTL.FAMILY\n\nexport interface FamilyMemberWithUser {\n  id: string\n  name: string\n  relation: string\n  email: string | null\n  userId: string | null\n  user?: {\n    id: string\n    email: string\n    profile: { name: string | null; gradeLevel?: string | null; avatarUrl?: string | null } | null\n  } | null\n}\n\nexport interface FamilyAccountWithMembers {\n  id: string\n  familyName: string\n  primaryEmail: string\n  defaultCurrency: string\n  monthlyBudget: number\n  enableBudget?: boolean\n  members: FamilyMemberWithUser[]\n  studentIds: string[]\n}\n\nexport async function getFamilyAccountForParent(\n  session: Session,\n  useCache = true\n): Promise<FamilyAccountWithMembers | null> {\n  const email = session?.user?.email\n  if (!email) return null\n\n  const cacheKey = 'parent:family:' + session.user.id\n\n  if (useCache) {\n    const cached = await cacheManager.get<FamilyAccountWithMembers>(cacheKey)\n    if (cached) return cached\n  }\n\n  const parentRelations = ['parent', 'PARENT', 'guardian']\n  const [memberLink] = await drizzleDb\n    .select()\n    .from(familyMember)\n    .where(\n      and(\n        eq(familyMember.userId, session.user.id),\n        inArray(familyMember.relation, parentRelations)\n      )\n    )\n    .limit(1)\n\n  if (memberLink) {\n    const [fa] = await drizzleDb\n      .select()\n      .from(familyAccount)\n      .where(eq(familyAccount.id, memberLink.familyAccountId))\n      .limit(1)\n    if (fa) {\n      const members = await drizzleDb\n        .select()\n        .from(familyMember)\n        .where(eq(familyMember.familyAccountId, fa.id))\n      const userIds = members.map((m) => m.userId).filter(Boolean) as string[]\n      const users =\n        userIds.length > 0\n          ? await drizzleDb.select({ id: user.id, email: user.email }).from(user).where(inArray(user.id, userIds))\n          : []\n      const profiles =\n        userIds.length > 0\n          ? await drizzleDb\n              .select({ userId: profile.userId, name: profile.name, gradeLevel: profile.gradeLevel, avatarUrl: profile.avatarUrl })\n              .from(profile)\n              .where(inArray(profile.userId, userIds))\n          : []\n      const userMap = Object.fromEntries(users.map((u) => [u.id, u]))\n      const profileByUserId = Object.fromEntries(profiles.map((p) => [p.userId, p]))\n\n      const studentIds = members\n        .filter((m) => m.userId && ['child', 'children'].includes(m.relation.toLowerCase()))\n        .map((m) => m.userId!)\n        .filter(Boolean)\n\n      const result: FamilyAccountWithMembers = {\n        id: fa.id,\n        familyName: fa.familyName,\n        primaryEmail: fa.primaryEmail,\n        defaultCurrency: fa.defaultCurrency,\n        monthlyBudget: fa.monthlyBudget,\n        enableBudget: fa.enableBudget,\n        members: members.map((m) => {\n          const u = m.userId ? userMap[m.userId] : undefined\n          const p = m.userId ? profileByUserId[m.userId] : undefined\n          return {\n            id: m.id,\n            name: m.name,\n            relation: m.relation,\n            email: m.email,\n            userId: m.userId,\n            user: u\n              ? {\n                  id: u.id,\n                  email: u.email ?? '',\n                  profile: p ? { name: p.name, gradeLevel: p.gradeLevel, avatarUrl: p.avatarUrl } : null,\n                }\n              : null,\n          }\n        }),\n        studentIds,\n      }\n\n      await cacheManager.set(cacheKey, result, {\n        ttl: CACHE_TTL_PARENT,\n        tags: ['parent', 'parent:' + session.user.id, 'family:' + fa.id],\n      })\n      return result\n    }\n  }\n\n  const [faByEmail] = await drizzleDb\n    .select()\n    .from(familyAccount)\n    .where(\n      and(\n        eq(familyAccount.primaryEmail, email.toLowerCase()),\n        eq(familyAccount.isActive, true)\n      )\n    )\n    .limit(1)\n\n  if (!faByEmail) return null\n\n  const members = await drizzleDb\n    .select()\n    .from(familyMember)\n    .where(eq(familyMember.familyAccountId, faByEmail.id))\n  const userIds = members.map((m) => m.userId).filter(Boolean) as string[]\n  const users =\n    userIds.length > 0\n      ? await drizzleDb.select({ id: user.id, email: user.email }).from(user).where(inArray(user.id, userIds))\n      : []\n  const profiles =\n    userIds.length > 0\n      ? await drizzleDb\n          .select({ userId: profile.userId, name: profile.name, gradeLevel: profile.gradeLevel, avatarUrl: profile.avatarUrl })\n          .from(profile)\n          .where(inArray(profile.userId, userIds))\n      : []\n  const userMap = Object.fromEntries(users.map((u) => [u.id, u]))\n  const profileByUserId = Object.fromEntries(profiles.map((p) => [p.userId, p]))\n\n  const studentIds = members\n    .filter((m) => m.userId && ['child', 'children'].includes(m.relation.toLowerCase()))\n    .map((m) => m.userId!)\n    .filter(Boolean)\n\n  const result: FamilyAccountWithMembers = {\n    id: faByEmail.id,\n    familyName: faByEmail.familyName,\n    primaryEmail: faByEmail.primaryEmail,\n    defaultCurrency: faByEmail.defaultCurrency,\n    monthlyBudget: faByEmail.monthlyBudget,\n    enableBudget: faByEmail.enableBudget,\n    members: members.map((m) => {\n      const u = m.userId ? userMap[m.userId] : undefined\n      const p = m.userId ? profileByUserId[m.userId] : undefined\n      return {\n        id: m.id,\n        name: m.name,\n        relation: m.relation,\n        email: m.email,\n        userId: m.userId,\n        user: u\n          ? {\n              id: u.id,\n              email: u.email ?? '',\n              profile: p ? { name: p.name, gradeLevel: p.gradeLevel, avatarUrl: p.avatarUrl } : null,\n            }\n          : null,\n      }\n    }),\n    studentIds,\n  }\n\n  await cacheManager.set(cacheKey, result, {\n    ttl: CACHE_TTL_PARENT,\n    tags: ['parent', 'parent:' + session.user.id, 'family:' + faByEmail.id],\n  })\n\n  return result\n}\n\nexport async function invalidateParentCache(userId: string): Promise<void> {\n  await cacheManager.invalidateTag('parent:' + userId)\n}\n"],"names":[],"mappings":"4CA85BI,EAz4BJ,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAGA,IAAM,EAAY,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAA,IAAI,EAC1B,EAAc,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAA,MAAM,EAM9B,EAAe,CAEnB,OAAQ,iBACR,WAAY,gBACZ,cAAe,mBAGf,mBAAoB,KAGpB,qBAAsB,cACtB,sBAAuB,GAGvB,mBAAoB,IACpB,gBAAiB,IACjB,WAAY,IACZ,YAAa,EACb,iBAAkB,IAGlB,sBAAuB,IAGvB,sBAAuB,IACvB,iBAAkB,GAGlB,YAAa,SAAS,QAAQ,GAAG,CAAC,iBAAiB,EAAI,KAAM,IAC7D,SAAU,SAAS,QAAQ,GAAG,CAAC,cAAc,EAAI,MAAO,IACxD,gBAAiB,SAAS,QAAQ,GAAG,CAAC,qBAAqB,EAAI,MAAO,IACtE,YAAa,SAAS,QAAQ,GAAG,CAAC,iBAAiB,EAAI,MAAO,GAChE,EAGyB,EAAA,CAAC,CAAC,MAAM,CAAC,CAChC,MAAO,EAAA,CAAC,CAAC,OAAO,GAChB,WAAY,EAAA,CAAC,CAAC,OAAO,GAAG,OAAO,EAAC,GAChC,UAAW,EAAA,CAAC,CAAC,OAAO,GAAG,OAAO,EAAC,GAC/B,KAAM,EAAA,CAAC,CAAC,KAAK,CAAC,EAAA,CAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE,EACpC,UAAW,EAAA,CAAC,CAAC,MAAM,GACnB,IAAK,EAAA,CAAC,CAAC,MAAM,EACf,GAYA,IAAM,EAAgB,EAAA,CAAC,CAAC,MAAM,CAAC,CAC7B,KAAM,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GACzB,OAAQ,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GAC3B,KAAM,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GACzB,QAAS,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GAC5B,OAAQ,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GAC3B,eAAgB,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GACnC,iBAAkB,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GACrC,gBAAiB,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,GACpC,eAAgB,EAAA,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC,EACrC,EAoBA,OAAM,EACI,GAAW,AAEnB,cAAc,CAEZ,MAAM,EAAS,QAAQ,GAAG,CAAC,oBAAoB,CAC/C,GAAI,EAEF,IADA,EADU,EACN,CAAC,GAAG,CAAG,OAAO,IAAI,CAAC,EAAQ,OAC3B,IAAI,CAAC,GAAG,CAAC,MAAM,GAAK,EAAa,qBAAqB,CACxD,CAD0D,KACpD,AAAI,MAAM,4DAClB,KACK,CAEL,MAAM,EAAS,QAAQ,GAAG,CAAC,eAAe,EAAI,kCAC9C,IAAI,CAAC,GAAG,CAAG,EAAA,UAAiB,CAAC,UAAU,MAAM,CAAC,GAAQ,MAAM,EAC9D,CACF,CAEA,QAAQ,CAAY,CAAU,CAC5B,IAAM,EAAK,EAAA,WAAkB,CAAC,IACxB,EAAS,EAAA,cAAqB,CAClC,EAAa,oBAAoB,CACjC,IAAI,CAAC,GAAG,CACR,GAGE,EAAY,EAAO,MAAM,CAAC,EAAM,OAAQ,OAC5C,GAAa,EAAO,KAAK,CAAC,OAC1B,IAAM,EAAU,EAAO,UAAU,GAGjC,MAAO,CAAA,EAAG,EAAG,QAAQ,CAAC,OAAO,CAAC,EAAE,EAAQ,QAAQ,CAAC,OAAO,CAAC,EAAE,EAAA,CAAW,AACxE,CAEA,QAAQ,CAAqB,CAAU,CACrC,GAAM,CAAC,EAAO,EAAY,EAAU,CAAG,EAAc,KAAK,CAAC,KAC3D,GAAI,CAAC,GAAS,CAAC,GAAc,CAAC,EAC5B,MAAM,AAAI,GAD6B,GACvB,iCAGlB,IAAM,EAAK,OAAO,IAAI,CAAC,EAAO,OACxB,EAAU,OAAO,IAAI,CAAC,EAAY,OAElC,EAAW,EAAA,gBAAuB,CACtC,EAAa,oBAAoB,CACjC,IAAI,CAAC,GAAG,CACR,GAEF,EAAS,UAAU,CAAC,GAEpB,IAAI,EAAY,EAAS,MAAM,CAAC,EAAW,MAAO,QAGlD,OAAO,AAFP,EAAa,EAAS,KAAK,CAAC,OAG9B,CACF,CAMA,MAAM,EACI,KAAkE,CAClE,OAAe,AAEvB,aAAY,EAAU,EAAa,qBAAqB,CAAE,CACxD,IAAI,CAAC,KAAK,CAAG,IAAI,IACjB,IAAI,CAAC,OAAO,CAAG,CACjB,CAEA,IAAO,CAAW,CAAY,CAC5B,IAAM,EAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,UACxB,AAAL,EAEI,EAFA,AAEM,GAFE,IAEK,CAAG,KAAK,GAAG,IAAI,AAC9B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GACX,MAGF,EAAM,IAAI,CAAC,KAAK,CAPJ,IAQrB,CAEA,IAAO,CAAW,CAAE,CAAoB,CAAE,CAAW,CAAQ,CAE3D,GAAI,IAAI,CAAC,KAAK,CAAC,IAAI,EAAI,IAAI,CAAC,OAAO,EAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAM,CAC3D,IAAM,EAAY,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,GAAG,KAAK,CAC5C,GAAW,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EACnC,CAEA,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAK,CAClB,KAAM,EACN,QAAS,KAAK,GAAG,GAAK,AAAM,KAC9B,EACF,CAEA,OAAO,CAAW,CAAQ,CACxB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EACpB,CAEA,OAAc,CACZ,IAAI,CAAC,KAAK,CAAC,KAAK,EAClB,CAEA,MAAe,CACb,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,AACxB,CAGA,SAAkB,CAChB,IAAM,EAAM,KAAK,GAAG,GAChB,EAAU,EAEd,IAAK,GAAM,CAAC,EAAK,EAAM,GADP,CACW,KADL,GACc,CADV,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,IAEvC,EAAM,OAAO,CAAG,IAClB,CADuB,GACnB,CAAC,KAAK,CAAC,MAAM,CAAC,GAClB,KAGJ,OAAO,CACT,CACF,CA4qBA,IAAM,EAAiB,UAQjB,CAAC,EAAe,YAAY,EAAE,CAChC,EAAe,YAAY,CAAG,IA/qBlC,AA+qBsC,MA/qBhC,AACI,MAAsB,IAAI,CAC1B,WAAwB,CACxB,UAA6B,AAC7B,QAAqB,AACrB,iBAA0C,IAAI,CAC9C,oBAA6C,IAAI,CACjD,WAAY,CAAK,CACjB,sBAA8C,IAEtD,AAF0D,cAE5C,CACZ,IAAI,CAAC,WAAW,CAAG,IAAI,EACvB,IAAI,CAAC,UAAU,CAAG,IAAI,EACtB,IAAI,CAAC,OAAO,CAAG,EAAc,KAAK,CAAC,CAAC,GAGpC,YAAY,KACV,IAAI,CAAC,WAAW,CAAC,OAAO,EAC1B,EAAG,IACL,CASA,MAAM,YAA4B,QAC5B,IAAI,CAAC,qBAAqB,EAAE,CAIhC,IAAI,CAAC,qBAAqB,CAAG,IAAI,CAAC,WAAW,EAAA,EAHpC,IAAI,CAAC,qBAKhB,AALqC,CAOrC,MAAc,aAA6B,CAOzC,IAAM,EAAW,QAAQ,GAAG,CAAC,SAAS,CACtC,GAAI,CAAC,EAAU,YACb,QAAQ,IAAI,CAAC,uEAIf,GAAI,CACF,GAAM,CAAE,OAAK,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,QAGlB,IAAI,CAAC,KAAK,CAAG,IAAI,EAAM,EAAU,CAE/B,eAAgB,EAAa,kBAAkB,CAC/C,eAAgB,EAAa,eAAe,CAC5C,UAAW,EAAa,UAAU,CAClC,aAAa,EAGb,cAAe,AAAC,IACd,GAAI,EAAQ,EAAa,WAAW,CAElC,CAFoC,MACpC,QAAQ,KAAK,CAAC,iDACP,KAAK,AAEd,IAAM,EAAQ,KAAK,GAAG,CACpB,CAH4B,CAGf,gBAAgB,CAAG,KAAK,GAAG,CAAC,EAAG,EAAQ,GACpD,KAGF,OADA,QAAQ,IAAI,CAAC,CAAC,6BAA6B,EAAE,EAAM,OAAO,EAAE,EAAM,EAAE,CAAC,EAC9D,CACT,EAEA,qBAAsB,EAGtB,kBAAkB,EAClB,oBAAoB,EAGpB,wBAAwB,CAC1B,GAGA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,UAAW,KACvB,QAAQ,GAAG,CAAC,MALqC,4BAMjD,IAAI,CAAC,SAAS,EAAG,CACnB,GAEA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAS,KACrB,QAAQ,GAAG,CAAC,8BACZ,IAAI,CAAC,SAAS,EAAG,CACnB,GAEA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAS,AAAC,IACtB,QAAQ,KAAK,CAAC,8BAA+B,EAAI,OAAO,EACxD,IAAI,CAAC,SAAS,EAAG,EACjB,IAAI,CAAC,OAAO,CAAC,MAAM,EACrB,GAEA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,QAAS,KACrB,QAAQ,IAAI,CAAC,0CACb,IAAI,CAAC,SAAS,EAAG,CACnB,GAEA,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,eAAgB,AAAC,IAC7B,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,EAAM,EAAE,CAAC,CAC/D,GAGA,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,GACrB,QAAQ,GAAG,CAAC,iDAGZ,IAAI,CAAC,gBAAgB,EAEvB,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,6CAA8C,GAC5D,IAAI,CAAC,KAAK,CAAG,KACb,IAAI,CAAC,SAAS,EAAG,CACnB,CACF,CAKQ,kBAAyB,CAC3B,IAAI,CAAC,mBAAmB,EAAE,CAE9B,IAAI,CAAC,mBAAmB,CAAG,YAAY,UACrC,GAAI,CAAC,IAAI,CAAC,KAAK,CAAE,CACf,IAAI,CAAC,SAAS,EAAG,EACjB,MACF,CAEA,GAAI,CACF,MAAM,QAAQ,IAAI,CAAC,CACjB,IAAI,CAAC,KAAK,CAAC,IAAI,GACf,IAAI,QAAQ,CAAC,EAAG,IACd,WAAW,IAAM,EAAO,AAAI,MAAM,yBAA0B,MAE/D,EACD,IAAI,CAAC,SAAS,EAAG,CACnB,CAAE,MAAO,EAAO,CACd,QAAQ,IAAI,CAAC,sCAAuC,GACpD,IAAI,CAAC,SAAS,EAAG,CACnB,CACF,EAAG,EAAa,qBAAqB,EACvC,CAKA,gBAA0B,CACxB,OAAO,IAAI,CAAC,SAAS,EAAmB,KAAK,EAApB,IAAI,CAAC,KAAK,AACrC,CAKA,gBAA+B,CAC7B,OAAO,IAAI,CAAC,KAAK,AACnB,AAR8F,CAiB9F,mBAAmB,CAAqB,CAAQ,CAC9C,IAAI,CAAC,eAAe,CAAG,CACzB,CAKQ,cACN,CAAiB,CACjB,CAAgB,CAChB,CAAgB,CAChB,EAAoC,MAAM,CACpC,CACF,EACgB,OADP,AACc,CAArB,GACF,IAAI,CAAC,OAAO,CAAC,IAAI,GACJ,WAAT,GAAmB,IAAI,CAAC,OAAO,CAAC,eAAe,GACtC,UAAT,GAAkB,IAAI,CAAC,OAAO,CAAC,cAAc,IAC1B,OAAO,CAArB,EACT,IAAI,CAAC,OAAO,CAAC,IAAI,GACM,UAAU,CAAxB,GACT,IAAI,CAAC,OAAO,CAAC,OAAO,IAGtB,IAAI,CAAC,OAAO,CAAC,MAAM,GACD,QAAd,GAAqB,IAAI,CAAC,OAAO,CAAC,MAAM,IAG9C,IAAI,CAAC,OAAO,CAAC,cAAc,EAAI,EAG3B,IAAI,CAAC,eAAe,EAAE,AACxB,IAAI,CAAC,eAAe,CAAC,EAAW,EAAU,EAE9C,CAKA,YAA2B,CACzB,IAAM,EAAU,IAAI,CAAC,OAAO,CAAC,IAAI,CAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,EACtD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAI,CAAD,GAAK,CAAC,OAAO,CAAC,IAAI,CAAG,IAAI,CAAC,OAAO,CAAC,MAAM,AAAN,EACtD,EAEE,EAAa,IAAI,CAAC,OAAO,CAAC,IAAI,CAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,EACzD,IAAI,CAAC,OAAO,CAAC,cAAc,EAAI,CAAD,GAAK,CAAC,OAAO,CAAC,IAAI,CAAG,IAAI,CAAC,OAAO,CAAC,MAAA,AAAM,EACtE,EAEJ,MAAO,CACL,GAAG,IAAI,CAAC,OAAO,SACf,EACA,aAAc,CAChB,CACF,CAKA,cAAqB,CACnB,IAAI,CAAC,OAAO,CAAG,EAAc,KAAK,CAAC,CAAC,EACtC,CASA,MAAM,IAAO,CAAW,CAAE,EAA2B,CAAC,CAAC,CAAqB,CAC1E,IAAM,EAAY,KAAK,GAAG,GACpB,EAAU,EAAa,MAAM,CAAG,EAEtC,GAAI,CAEF,MAAM,IAAI,CAAC,UAAU,GAGrB,IAAM,EAAc,IAAI,CAAC,WAAW,CAAC,GAAG,CAAI,GAC5C,GAAoB,MAAM,CAAtB,EAEF,OADA,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,EAAM,UACjD,EAIT,GAAI,IAAI,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAC9B,CADgC,EAC5B,CACF,IAAM,EAAW,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GACtC,GAAI,EAAU,CACZ,IAAM,EAAQ,MAAM,IAAI,CAAC,gBAAgB,CAAI,GAGvC,EAAM,CAAC,KAAK,GAAG,GAAK,EAAM,SAAS,AAAT,EAAa,IAC7C,GAAI,GAAO,EAAM,GAAG,CAGlB,CAHoB,MACpB,MAAM,IAAI,CAAC,MAAM,CAAC,GAClB,GADuB,CACnB,CAAC,aAAa,CAAC,KADyB,CAClB,KAAK,GAAG,GAAK,GAAW,GAC3C,KAOT,GAHA,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAS,EAAO,EAAM,GAAG,CAAG,GAG7C,EAAQ,MAAM,CAAE,CAClB,IAAM,EAAY,EAAQ,MAAM,CAAC,KAAK,CAAC,EAAM,KAAK,EAElD,OADA,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,EAAW,GAAM,SACjD,CACT,CAGA,OADA,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,EAAM,SACjD,EAAM,KAAK,AACpB,CACF,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,kCAAmC,GACjD,IAAI,CAAC,SAAS,CAAG,EACnB,CAIF,OADA,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,GAC3C,IAET,CAAE,MAAO,EAAO,CAGd,OAFA,QAAQ,KAAK,CAAC,4BAA6B,GAC3C,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,GAC3C,IACT,CACF,CAKA,MAAM,IACJ,CAAW,CACX,CAAQ,CACR,EAA2B,CAAC,CAAC,CACX,CAClB,IAAM,EAAY,KAAK,GAAG,GACpB,EAAU,EAAa,MAAM,CAAG,EAChC,EAAM,EAAQ,GAAG,EAAI,EAAa,WAAW,CAEnD,GAAI,CAEF,MAAM,IAAI,CAAC,UAAU,GAGrB,IAAI,EAAiB,EACjB,EAAQ,MAAM,EAAE,AAClB,GAAiB,EAAQ,MAAM,CAAC,KAAK,CAAC,EAAA,EAIxC,IAAM,EAAuB,CAC3B,MAAO,EACP,YAAY,EACZ,WAAW,EACX,KAAM,EAAQ,IAAI,EAAI,EAAE,CACxB,UAAW,KAAK,GAAG,OACnB,CACF,EAGI,EAAa,MAAM,IAAI,CAAC,cAAc,CAAC,EAAO,GAMlD,GAHA,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAS,EAAO,GAGjC,IAAI,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAC9B,CADgC,EAC5B,CASF,OARA,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAS,EAAK,GAGjC,EAAM,IAAI,CAAC,MAAM,CAAG,GAAG,AACzB,MAAM,IAAI,CAAC,YAAY,CAAC,EAAS,EAAM,IAAI,EAG7C,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,IAC3C,CACT,CAAE,MAAO,EAAO,CAKd,OAJA,QAAQ,KAAK,CAAC,kCAAmC,GACjD,IAAI,CAAC,SAAS,EAAG,EAEjB,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,IAC3C,CACT,CAKF,OADA,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,GAC3C,EAET,CAAE,MAAO,EAAO,CAGd,OAFA,QAAQ,KAAK,CAAC,4BAA6B,GAC3C,IAAI,CAAC,aAAa,CAAC,MAAO,KAAK,GAAG,GAAK,GAAW,IAC3C,CACT,CACF,CAKA,MAAM,OAAO,CAAW,CAAoB,CAC1C,IAAM,EAAY,KAAK,GAAG,GACpB,EAAU,EAAa,MAAM,CAAG,EAEtC,GAAI,CAKF,GAHA,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,GAGpB,IAAI,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAC9B,CADgC,EAC5B,CAKF,OAJA,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAErB,MAAM,IAAI,CAAC,iBAAiB,CAAC,GAC7B,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,EAAW,KAC9C,CACT,CAAE,MAAO,EAAO,CAId,OAHA,QAAQ,KAAK,CAAC,qCAAsC,GACpD,IAAI,CAAC,SAAS,EAAG,EACjB,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,IAC9C,CACT,CAIF,CAN+D,MAK/D,IAAI,CAAC,aAAa,CAAC,CALsE,QAK5D,KAAK,GAAG,GAAK,GAAW,IAC9C,CAET,CAAE,MAAO,EAAO,CAGd,OAFA,QAAQ,KAAK,CAAC,+BAAgC,GAC9C,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,IAC9C,CACT,CACF,CAKA,MAAM,SACJ,CAAW,CACX,CAAyB,CACzB,EAA2B,CAAC,CAAC,CACjB,CACZ,IAAM,EAAS,MAAM,IAAI,CAAC,GAAG,CAAI,EAAK,GACtC,GAAI,AAAW,MAAM,GACnB,OAAO,EAGT,IAAM,EAAQ,MAAM,IAEpB,OADA,MAAM,IAAI,CAAC,GAAG,CAAC,EAAK,EAAO,GACpB,CACT,CAKA,MAAM,OAA0B,CAC9B,IAAM,EAAY,KAAK,GAAG,GAE1B,GAAI,CAKF,GAHA,IAAI,CAAC,WAAW,CAAC,KAAK,GAGlB,IAAI,CAAC,KAAK,EAAI,IAAI,CAAC,SAAS,CAC9B,CADgC,EAC5B,CACF,IAAM,EAAO,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAa,MAAM,CAAG,KACrD,EAAK,MAAM,CAAG,GAAG,AACnB,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,GAG1B,IAAM,EAAU,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAa,UAAU,CAAG,KAKhE,OAJI,EAAQ,MAAM,CAAG,GAAG,AACtB,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,GAE1B,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,IAC9C,CACT,CAAE,MAAO,EAAO,CAId,OAHA,QAAQ,KAAK,CAAC,oCAAqC,GACnD,IAAI,CAAC,SAAS,EAAG,EACjB,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,IAC9C,CACT,CAIF,CAN+D,MAK/D,IAAI,CAAC,aAAa,CALsE,AAKrE,SAAU,KAAK,GAAG,GAAK,GAAW,IAC9C,CAET,CAAE,MAAO,EAAO,CAGd,OAFA,QAAQ,KAAK,CAAC,8BAA+B,GAC7C,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,GAC9C,EACT,CACF,CASA,MAAM,cAAc,CAAW,CAAmB,CAChD,IAAM,EAAY,KAAK,GAAG,GACpB,EAAS,EAAa,UAAU,CAAG,EAEzC,GAAI,CACF,GAAI,CAAC,IAAI,CAAC,KAAK,EAAI,CAAC,IAAI,CAAC,SAAS,CAGhC,CAHkC,MAElC,QAAQ,IAAI,CAAC,kDACN,EAIT,IAAM,EAAO,MAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GACvC,GAAoB,GAAG,CAAnB,EAAK,MAAM,CACb,OAAO,EAIT,IAAM,EAAW,EAAK,GAAG,CAAC,AAAC,GAAM,EAAa,MAAM,CAAG,EAAE,OAAO,CAAC,EAAa,MAAM,CAAE,KAYtF,OATA,EAAS,OAAO,CAAC,AAAC,GAAQ,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAGlD,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,GAGxB,MAAM,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAErB,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,GAC9C,EAAK,MAEd,AAFoB,CAElB,MAAO,EAAO,CAGd,OAFA,QAAQ,KAAK,CAAC,yCAA0C,GACxD,IAAI,CAAC,aAAa,CAAC,SAAU,KAAK,GAAG,GAAK,GAAW,GAC9C,CACT,CACF,CAKA,MAAM,eAAe,CAAc,CAAmB,CACpD,IAAI,EAAQ,EACZ,IAAK,IAAM,KAAO,EAChB,GADsB,AACb,MAAM,IAAI,CAAC,aAAa,CAAC,GAEpC,OAAO,CACT,CAKA,MAAc,aAAa,CAAW,CAAE,CAAc,CAAiB,CACrE,GAAI,AAAC,IAAI,CAAC,KAAK,EAAK,EAAD,EAAK,CAAC,SAAS,EAAoB,GAAG,CAAnB,EAAK,MAAM,CAEjD,GAAI,CACF,IAAM,EAAW,IAAI,CAAC,KAAK,CAAC,QAAQ,GACpC,IAAK,IAAM,KAAO,EAAM,CACtB,IAAM,EAAS,EAAa,UAAU,CAAG,EACzC,EAAS,IAAI,CAAC,EAAQ,GACtB,EAAS,MAAM,CAAC,EAAmC,EAA3B,EAAa,AAAiB,WAAN,CAClD,CACA,MAAM,EAAS,IAAI,CAF+D,CAGpF,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,iCAAkC,EAClD,CACF,CAKA,MAAc,kBAAkB,CAAW,CAAiB,CAC1D,GAAI,AAAC,IAAI,CAAC,KAAK,EAAK,EAAD,EAAK,CAAC,SAAS,CAElC,CAFoC,EAEhC,CAEF,IAAM,EAAU,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAa,UAAU,CAAG,KAChE,GAAuB,IAAnB,EAAQ,MAAM,CAAQ,OAE1B,IAAM,EAAW,IAAI,CAAC,KAAK,CAAC,QAAQ,GACpC,IAAK,IAAM,KAAU,EACnB,EAAS,IADmB,AACf,CAAC,EAAQ,EAExB,OAAM,EAAS,IAAI,EACrB,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,oCAAqC,EACrD,CACF,CASA,MAAc,eACZ,CAAoB,CACpB,CAAwB,CACP,CAEjB,IAAI,EAAa,KAAK,SAAS,CAAC,GA8BhC,YA1BuB,IAArB,EAAQ,QAAQ,CACZ,EAAQ,QAAQ,CAChB,OAAO,UAAU,CAAC,EAAY,QAAU,EAAa,kBAAA,AAAkB,IAI3E,EAAa,CADM,MAAM,EAAU,OAAO,IAAI,CAAC,EAAY,QAAA,EACnC,QAAQ,CAAC,UACjC,EAAM,UAAU,EAAG,GAIjB,EAAQ,OAAO,EAAE,CACnB,EAAa,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,GACrC,EAAM,SAAS,EAAG,GAab,KAAK,SAAS,CAAC,AATN,CACd,WAAY,EAAM,UAAU,CAC5B,UAAW,EAAM,SAAS,CAC1B,KAAM,EAAM,IAAI,CAChB,UAAW,EAAM,SAAS,CAC1B,IAAK,EAAM,GAAG,CACd,KAAM,CACR,EAGF,CAKA,MAAc,iBAAoB,CAAkB,CAA0B,CAC5E,IAAM,EAAU,KAAK,KAAK,CAAC,GASvB,EAAO,EAAQ,IAAI,CAGnB,EAAQ,SAAS,EAAE,CACrB,EAAO,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAA,EAI7B,EAAQ,UAAU,EAAE,CAEtB,EAAO,CADc,MAAM,EAAY,OAAO,IAAI,CAAC,EAAM,UAAA,EACrC,QAAQ,CAAC,OAAA,EAI/B,IAAM,EAAQ,KAAK,KAAK,CAAC,GASzB,OANA,EAAM,UAAU,CAAG,EAAQ,UAAU,CACrC,EAAM,SAAS,CAAG,EAAQ,SAAS,CACnC,EAAM,IAAI,CAAG,EAAQ,IAAI,CACzB,EAAM,SAAS,CAAG,EAAQ,SAAS,CACnC,EAAM,GAAG,CAAG,EAAQ,GAAG,CAEhB,CACT,CASA,MAAM,YAA4B,CAC5B,IAAI,CAAC,mBAAmB,EAAE,CAC5B,cAAc,IAAI,CAAC,mBAAmB,EACtC,IAAI,CAAC,mBAAmB,CAAG,MAGzB,IAAI,CAAC,KAAK,EAAE,CACd,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,GACrB,IAAI,CAAC,KAAK,CAAG,KACb,IAAI,CAAC,SAAS,CAAG,IAGnB,IAAI,CAAC,WAAW,CAAC,KAAK,GACtB,QAAQ,GAAG,CAAC,8BACd,CACF,CAgBsC,EAEpC,EAAe,EAAe,YAAY,kBAO7B,kCC36Bf,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,0CAUA,IAAM,EAP0B,AAOP,CANvB,UAAW,SAAS,QAAQ,GAAG,CAAC,0BAA0B,EAAI,MAAO,IACrE,kBAAmB,SAAS,QAAQ,GAAG,CAAC,2BAA2B,EAAI,KAAM,IAC7E,UAAW,SAAS,QAAQ,GAAG,CAAC,0BAA0B,EAAI,MAAO,IACrE,OAAQ,SAAS,QAAQ,GAAG,CAAC,uBAAuB,EAAI,MAAO,GACjE,EAE0C,MAAM,CA0BzC,eAAe,EACpB,CAAgB,CAChB,GAAW,CAAI,EAEf,IAAM,EAAQ,GAAS,MAAM,MAC7B,GAAI,CAAC,EAAO,OAAO,KAEnB,IAAM,EAAW,iBAAmB,EAAQ,IAAI,CAAC,EAAE,CAEnD,GAAI,EAAU,CACZ,IAAM,EAAS,MAAM,EAAA,OAAY,CAAC,GAAG,CAA2B,GAChE,GAAI,EAAQ,OAAO,CACrB,CAGA,GAAM,CAAC,EAAW,CAAG,MAAM,EAAA,SAAS,CACjC,MAAM,GACN,IAAI,CAAC,EAAA,YAAY,EACjB,KAAK,CACJ,CAAA,EAAA,EAAA,GAAA,AAAG,EACD,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,YAAY,CAAC,MAAM,CAAE,EAAQ,IAAI,CAAC,EAAE,EACvC,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,YAAY,CAAC,QAAQ,CAPX,CAOa,AAPZ,SAAU,SAAU,WAAW,IAUrD,KAAK,CAAC,GAET,GAAI,EAAY,CACd,GAAM,CAAC,EAAG,CAAG,MAAM,EAAA,SAAS,CACzB,MAAM,GACN,IAAI,CAAC,EAAA,aAAa,EAClB,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,aAAa,CAAC,EAAE,CAAE,EAAW,eAAe,GACrD,KAAK,CAAC,GACT,GAAI,EAAI,CACN,IAAM,EAAU,MAAM,EAAA,SAAS,CAC5B,MAAM,GACN,IAAI,CAAC,EAAA,YAAY,EACjB,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,YAAY,CAAC,eAAe,CAAE,EAAG,EAAE,GACzC,EAAU,EAAQ,GAAG,CAAC,AAAC,GAAM,EAAE,MAAM,EAAE,MAAM,CAAC,SAC9C,EACJ,EAAQ,MAAM,CAAG,EACb,MAAM,EAAA,SAAS,CAAC,MAAM,CAAC,CAAE,GAAI,EAAA,IAAI,CAAC,EAAE,CAAE,MAAO,EAAA,IAAI,CAAC,KAAK,AAAC,GAAG,IAAI,CAAC,EAAA,IAAI,EAAE,KAAK,CAAC,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,IAAI,CAAC,EAAE,CAAE,IAC7F,EAAE,CACF,EACJ,EAAQ,MAAM,CAAG,EACb,MAAM,EAAA,SAAS,CACZ,MAAM,CAAC,CAAE,OAAQ,EAAA,OAAO,CAAC,MAAM,CAAE,KAAM,EAAA,OAAO,CAAC,IAAI,CAAE,WAAY,EAAA,OAAO,CAAC,UAAU,CAAE,UAAW,EAAA,OAAO,CAAC,SAAS,AAAC,GAClH,IAAI,CAAC,EAAA,OAAO,EACZ,KAAK,CAAC,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,OAAO,CAAC,MAAM,CAAE,IACjC,EAAE,CACF,EAAU,OAAO,WAAW,CAAC,EAAM,GAAG,CAAC,AAAC,GAAM,CAAC,EAAE,EAAE,CAAE,EAAE,GACvD,EAAkB,OAAO,WAAW,CAAC,EAAS,GAAG,CAAC,AAAC,GAAM,CAAC,EAAE,MAAM,CAAE,EAAE,GAEtE,EAAa,EAChB,MAAM,CAAC,AAAC,GAAM,EAAE,MAAM,EAAI,CAAC,QAAS,WAAW,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,WAAW,KAC/E,GAAG,CAAC,AAAC,GAAM,EAAE,MAAM,EACnB,MAAM,CAAC,SAEJ,EAAmC,CACvC,GAAI,EAAG,EAAE,CACT,WAAY,EAAG,UAAU,CACzB,aAAc,EAAG,YAAY,CAC7B,gBAAiB,EAAG,eAAe,CACnC,cAAe,EAAG,aAAa,CAC/B,aAAc,EAAG,YAAY,CAC7B,QAAS,EAAQ,GAAG,CAAC,AAAC,IACpB,IAAM,EAAI,EAAE,MAAM,CAAG,CAAO,CAAC,EAAE,MAAM,CAAC,MAAG,EACnC,EAAI,EAAE,MAAM,CAAG,CAAe,CAAC,EAAE,MAAM,CAAC,MAAG,EACjD,MAAO,CACL,GAAI,EAAE,EAAE,CACR,KAAM,EAAE,IAAI,CACZ,SAAU,EAAE,QAAQ,CACpB,MAAO,EAAE,KAAK,CACd,OAAQ,EAAE,MAAM,CAChB,KAAM,EACF,CACE,GAAI,EAAE,EAAE,CACR,MAAO,EAAE,KAAK,EAAI,GAClB,QAAS,EAAI,CAAE,KAAM,EAAE,IAAI,CAAE,WAAY,EAAE,UAAU,CAAE,UAAW,EAAE,SAAS,AAAC,EAAI,IACpF,EACA,IACN,CACF,cACA,CACF,EAMA,OAJA,MAAM,EAAA,OAAY,CAAC,GAAG,CAAC,EAAU,EAAQ,CACvC,IAAK,EACL,KAAM,CAAC,SAAU,UAAY,EAAQ,IAAI,CAAC,EAAE,CAAE,UAAY,EAAG,EAAE,CAAC,AAClE,GACO,CACT,CACF,CAEA,GAAM,CAAC,EAAU,CAAG,MAAM,EAAA,SAAS,CAChC,MAAM,GACN,IAAI,CAAC,EAAA,aAAa,EAClB,KAAK,CACJ,CAAA,EAAA,EAAA,GAAA,AAAG,EACD,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,aAAa,CAAC,YAAY,CAAE,EAAM,WAAW,IAChD,CAAA,EAAA,EAAA,EAAE,AAAF,EAAG,EAAA,aAAa,CAAC,QAAQ,EAAE,KAG9B,KAAK,CAAC,GAET,GAAI,CAAC,EAAW,OAAO,KAEvB,IAAM,EAAU,MAAM,EAAA,SAAS,CAC5B,MAAM,GACN,IAAI,CAAC,EAAA,YAAY,EACjB,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,YAAY,CAAC,eAAe,CAAE,EAAU,EAAE,GAChD,EAAU,EAAQ,GAAG,CAAC,AAAC,GAAM,EAAE,MAAM,EAAE,MAAM,CAAC,SAC9C,EACJ,EAAQ,MAAM,CAAG,EACb,MAAM,EAAA,SAAS,CAAC,MAAM,CAAC,CAAE,GAAI,EAAA,IAAI,CAAC,EAAE,CAAE,MAAO,EAAA,IAAI,CAAC,KAAM,AAAD,GAAI,IAAI,CAAC,EAAA,IAAI,EAAE,KAAK,CAAC,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,IAAI,CAAC,EAAE,CAAE,IAC7F,EAAE,CACF,EACJ,EAAQ,MAAM,CAAG,EACb,MAAM,EAAA,SAAS,CACZ,MAAM,CAAC,CAAE,OAAQ,EAAA,OAAO,CAAC,MAAM,CAAE,KAAM,EAAA,OAAO,CAAC,IAAI,CAAE,WAAY,EAAA,OAAO,CAAC,UAAU,CAAE,UAAW,EAAA,OAAO,CAAC,SAAS,AAAC,GAClH,IAAI,CAAC,EAAA,OAAO,EACZ,KAAK,CAAC,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,OAAO,CAAC,MAAM,CAAE,IACjC,EAAE,CACF,EAAU,OAAO,WAAW,CAAC,EAAM,GAAG,CAAC,AAAC,GAAM,CAAC,EAAE,EAAE,CAAE,EAAE,GACvD,EAAkB,OAAO,WAAW,CAAC,EAAS,GAAG,CAAC,AAAC,GAAM,CAAC,EAAE,MAAM,CAAE,EAAE,GAEtE,EAAa,EAChB,MAAM,CAAC,AAAC,GAAM,EAAE,MAAM,EAAI,CAAC,QAAS,WAAW,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,WAAW,KAC/E,GAAG,CAAC,AAAC,GAAM,EAAE,MAAM,EACnB,MAAM,CAAC,SAEJ,EAAmC,CACvC,GAAI,EAAU,EAAE,CAChB,WAAY,EAAU,UAAU,CAChC,aAAc,EAAU,YAAY,CACpC,gBAAiB,EAAU,eAAe,CAC1C,cAAe,EAAU,aAAa,CACtC,aAAc,EAAU,YAAY,CACpC,QAAS,EAAQ,GAAG,CAAC,AAAC,IACpB,IAAM,EAAI,EAAE,MAAM,CAAG,CAAO,CAAC,EAAE,MAAM,CAAC,MAAG,EACnC,EAAI,EAAE,MAAM,CAAG,CAAe,CAAC,EAAE,MAAM,CAAC,MAAG,EACjD,MAAO,CACL,GAAI,EAAE,EAAE,CACR,KAAM,EAAE,IAAI,CACZ,SAAU,EAAE,QAAQ,CACpB,MAAO,EAAE,KAAK,CACd,OAAQ,EAAE,MAAM,CAChB,KAAM,EACF,CACE,GAAI,EAAE,EAAE,CACR,MAAO,EAAE,KAAK,EAAI,GAClB,QAAS,EAAI,CAAE,KAAM,EAAE,IAAI,CAAE,WAAY,EAAE,UAAU,CAAE,UAAW,EAAE,SAAS,AAAC,EAAI,IACpF,EACA,IACN,CACF,cACA,CACF,EAOA,OALA,MAAM,EAAA,OAAY,CAAC,GAAG,CAAC,EAAU,EAAQ,CACvC,IAAK,EACL,KAAM,CAAC,SAAU,UAAY,EAAQ,IAAI,CAAC,EAAE,CAAE,UAAY,EAAU,EAAE,CAAC,AACzE,GAEO,CACT"}}]
}