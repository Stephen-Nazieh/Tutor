;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5bc904a3-259c-6850-9b90-015b2c66dbeb")}catch(e){}}();
module.exports=[902157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},450869,e=>{"use strict";let t="tutorme:query:",r=null,i=null,s=!1,a=!(void 0!==globalThis.EdgeRuntime||"u">typeof process&&0);function n(){return a?(i||(i=new Map),i):null}async function o(){if(!a)return null;if(s)return r;try{let t=process.env.REDIS_URL;if(!t)return console.log("[DB] Redis URL not configured, using in-memory cache"),s=!0,null;let{Redis:i}=await e.A(443460);return(r=new i(t,{retryStrategy:e=>Math.min(50*e,2e3),maxRetriesPerRequest:3})).on("error",e=>{console.error("[Redis] Connection error:",e),r=null}),console.log("[DB] Redis cache initialized"),s=!0,r}catch(e){return console.warn("[DB] Failed to initialize Redis, using in-memory cache"),s=!0,null}}if(a)try{let{drizzleDb:t}=e.r(738597);console.log("[DB] Drizzle client (default db) initialized")}catch(e){console.error("[DB] Failed to initialize Drizzle:",e)}e.s(["cache",0,{ensureRedis:async()=>a?(s||await o(),r):null,async get(e){if(!a)return null;let r=t+e,i=await this.ensureRedis();if(i)try{let e=await i.get(r);if(e)return JSON.parse(e)}catch(e){console.error("[Cache] Redis get error:",e)}let s=n();if(!s)return null;let o=s.get(r);return o&&o.expires>Date.now()?o.data:(s.delete(r),null)},async set(e,r,i=60){if(!a)return;let s=t+e,o=await this.ensureRedis();if(o)try{await o.setex(s,i,JSON.stringify(r));return}catch(e){console.error("[Cache] Redis set error:",e)}let c=n();c&&c.set(s,{data:r,expires:Date.now()+1e3*i})},async delete(e){if(!a)return;let r=t+e,i=await this.ensureRedis();if(i)try{await i.del(r)}catch(e){console.error("[Cache] Redis del error:",e)}let s=n();s&&s.delete(r)},async clear(){if(!a)return;let e=await this.ensureRedis();if(e)try{let r=await e.keys(t+"*");r.length>0&&await e.del(...r)}catch(e){console.error("[Cache] Redis clear error:",e)}let r=n();r&&r.clear()},async getOrSet(e,t,r=60){let i=await this.get(e);if(null!==i)return i;let s=await t();return await this.set(e,s,r),s},async invalidatePattern(e){if(!a)return;let r=await this.ensureRedis();if(r)try{let i=await r.keys(t+e);i.length>0&&await r.del(...i)}catch(e){console.error("[Cache] Pattern invalidation error:",e)}let i=n();if(i){let r=new RegExp(t+e.replace("*",".*"));for(let e of i.keys())r.test(e)&&i.delete(e)}}}])},917126,e=>{"use strict";let t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,r=/\s*on\w+\s*=\s*["'][^"']*["']/gi,i=/javascript\s*:/gi,s=/data\s*:\s*[^,]*\s*,/gi,a=/<(?:iframe|object|embed|form|meta|link)\b[^>]*>/gi;function n(e){return"string"!=typeof e?"":e.replace(t,"").replace(a,"").replace(r,"").replace(i,"").replace(s,"")}function o(e,t=5e4){let r=n(e);return r.length<=t?r:r.slice(0,t)}e.s(["sanitizeHtml",()=>n,"sanitizeHtmlWithMax",()=>o])},765433,e=>e.a(async(t,r)=>{try{var i=e.i(738597);e.i(688768);var s=e.i(257357),a=t([i]);async function n(e,t,r){try{await i.drizzleDb.insert(s.userActivityLog).values({id:crypto.randomUUID(),userId:e,action:t,metadata:r??{}})}catch(e){console.error("Audit log failed:",e)}}[i]=a.then?(await a)():a,e.s(["AUDIT_ACTIONS",0,{PROFILE_VIEW:"audit_profile_view",PROFILE_UPDATE:"audit_profile_update",DATA_EXPORT:"audit_data_export",DATA_DELETE:"audit_data_delete",PAYMENT_CREATE:"audit_payment_create",PAYMENT_REFUND:"audit_payment_refund",PAYMENT_ALERT:"audit_payment_alert",COURSE_SHARE:"audit_course_share",ADMIN_ACCESS:"audit_admin_access",SENSITIVE_ACCESS:"audit_sensitive_access"},"logAudit",()=>n]),r()}catch(e){r(e)}},!1),190735,e=>e.a(async(t,r)=>{try{var i=e.i(254799),s=(e.i(909105),e.i(738597));e.i(688768);var a=e.i(257357),n=e.i(765433),o=t([s,n]);async function c(e,t,r){try{let o=r??{};t&&await (0,n.logAudit)(t,`security_${e}`,o),await s.drizzleDb.insert(a.securityEvent).values({id:i.default.randomUUID(),eventType:`security_${e}`,metadata:o})}catch(e){console.error("[SecurityAudit] logSecurityEvent failed:",e)}}[s,n]=o.then?(await o)():o,e.s(["logSecurityEvent",()=>c]),r()}catch(e){r(e)}},!1),528678,e=>e.a(async(t,r)=>{try{var i=e.i(190735),s=t([i]);[i]=s.then?(await s)():s,e.s(["securityLogger",0,{logEvent(e){let t=e.severity??"LOW";(0,i.logSecurityEvent)(e.eventType,void 0,{description:e.description,severity:t,...e.metadata}).catch(e=>console.error("Security log failed:",e))}}]),r()}catch(e){r(e)}},!1),930140,e=>e.a(async(t,r)=>{try{var i=e.i(917126),s=e.i(254799),a=e.i(528678),n=t([a]);[a]=n.then?(await n)():n;class o{static sanitizeAiInput(e){if(!e||"string"!=typeof e)return"";try{let t=e.trim(),r=[/ignore.*all.*previous.*instructions/gi,/forget.*everything.*above/gi,/disregard.*above/gi,/you are now.*admin/gi,/your role is now.*system/gi,/from now on.*you are.*developer/gi,/new instructions.*ignore.*previous/gi,/system prompt.*override/gi,/override.*all.*security.*rules/gi];for(let e of r)t=t.replace(e,"[REMOVED]");let s=[/assistant.*you.*are.*now/gi,/you.*are.*now.*assistant.*system/gi,/mode.*system.*administrator/gi,/bypass.*all.*restrictions/gi,/unlock.*all.*capabilities/gi];for(let e of s)t=t.replace(e,"[REMOVED]");let n=[/exec\s*\(/gi,/system\s*\(/gi,/shell\s*\(/gi,/exec\s+/gi,/system\s+/gi,/shell\s+/gi,/bash\.*execute/gi,/powershell\.*run/gi];for(let e of n)t=t.replace(e,"[REMOVED]");for(let e of[/<script.*?>/gi,/javascript:\.*\(/gi,/vbscript:\.*\(/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/eval\s*\(/gi])t=t.replace(e,"[REMOVED]");for(let e of[/sudo/gi,/admin/gi,/system.*override/gi,/override.*security.*settings/gi,/disable.*all.*protections/gi])t=t.replace(e,"[REMOVED]");return(t=(0,i.sanitizeHtml)(t)).length>3e3&&(t=t.substring(0,3e3)+" [TRUNCATED FOR SECURITY]"),a.securityLogger.logEvent({eventType:"AI_INPUT_SANITIZED",description:"AI input underwent security sanitization",metadata:{originalLength:e.length,sanitizedLength:t.length,patternsRemoved:r.length+s.length+n.length}}),t.trim()}catch(e){return a.securityLogger.logEvent({eventType:"AI_SECURITY_ERROR",description:"AI input sanitization error occurred",severity:"MEDIUM",metadata:{error:e.message}}),""}}static createStudentHash(e){if(!e||"string"!=typeof e)return"anonymous_student";try{let t=process.env.NEXTAUTH_SECRET||"default_secret";return s.default.createHash("sha256").update(e).update(t).digest("hex").substring(0,16)}catch(e){return a.securityLogger.logEvent({eventType:"STUDENT_HASH_ERROR",description:"Student hash creation failed",severity:"LOW",metadata:{error:e.message}}),"anonymous_student"}}static async validateAiResponse(e){let t=[],r="LOW";if(!e||"string"!=typeof e)return{isValid:!1,issues:["AI response is invalid"],severity:"HIGH"};for(let i of[/suicide(\.*|\s+)+support/gi,/self.?harm(\.*|\s+)+advice/gi,/violence(\.*|\s+)+instructions/gi,/how.?to.?harm.+yourself/gi,/end.?it.?all/gi])if(i.test(e)){t.push("AI response contains inappropriate or harmful content"),r="CRITICAL";break}for(let i of[/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/i,/\b\d{3}[-.\s]?\d{3}[-.\s]?\d{4}\b/g,/\b\d{3}-\d{2}-\d{4}\b/g])i.test(e)&&(t.push("AI response contains potential personal information"),r="CRITICAL"===r?"CRITICAL":"HIGH");for(let i of((e.includes("System:")||e.includes("Instruction:"))&&(t.push("AI response may contain system instruction leakage"),r="CRITICAL"===r?"CRITICAL":"HIGH"),[/eval\s*\(/gi,/system\s*\(/gi,/download.*malicious/gi,/install.*virus/gi]))i.test(e)&&(t.push("AI response contains potentially malicious content"),r="CRITICAL");return e.length>5e3&&(t.push("AI response exceeds safe length limits"),r="CRITICAL"===r?"CRITICAL":"HIGH"),t.length>0&&a.securityLogger.logEvent({eventType:"AI_RESPONSE_VALIDATION",description:"AI response failed security validation",severity:r,metadata:{issues:t,responseLength:e.length}}),{isValid:0===t.length,issues:t,severity:r}}static createSafeTutoringPrompt(e,t,r,i){let s=this.createStudentHash(e),a=this.sanitizeAiInput(i);return 0===a.length?{systemPrompt:this.createProtectedSystemPrompt(t,r),userPrompt:"Student provided invalid input - please redirect to proper input format"}:{systemPrompt:this.createProtectedSystemPrompt(t,r,s),userPrompt:`Student ${s} asks: "${a}"`}}static createProtectedSystemPrompt(e,t,r){return`
You are an AI tutor specializing in ${e} for ${t} level students.

SAFETY RULES STRICTLY ENFORCED:
1. **NEVER** provide direct answers - use Socratic method (guiding questions)
2. **NEVER** give private information or personal data
3. **NEVER** provide medical, legal, or financial advice
4. **NEVER** generate harmful or inappropriate content
5. **NEVER** give instructions for self-harm or dangerous activities
6. **ALWAYS** maintain educational focus and age-appropriate language
7. **ALWAYS** escalate concerning content to human supervision
8. **ALWAYS** encourage students to discover solutions through guided learning

RESPONSE GUIDELINES:
- Use only educational, age-appropriate language
- Ask questions to guide discovery
- Provide examples when helpful
- Adapt to student${r?` ${r}`:""}'s responses
- Never complete assignments for students
- Always check for understanding

CURRENT CONTEXT:
- Subject: ${e}
- Level: ${t}
- Anonymized Student ID: ${r||"anonymous"}
- Current Date: ${new Date().toISOString()}
`.trim()}}e.s(["AISecurityManager",()=>o]),r()}catch(e){r(e)}},!1),742335,e=>{"use strict";let t=new Map,r=new Map,i=new Map,s=new Map,a="student-1";t.set(a,{id:a,name:"Sarah Chen",age:16,level:"B1",learningStyle:"visual",interests:["music","technology","travel"],goals:["improve_pronunciation","vocabulary_expansion"],preferredVoice:{gender:"female",accent:"us"}}),r.set(a,{currentMood:"neutral",energyLevel:80,recentStruggles:[],masteredTopics:["present_perfect","basic_greetings"],activeTopics:["conditionals","phrasal_verbs"]}),i.set(a,[]);class n{static async getStudentContext(e){let s=t.get(e);return s?{profile:s,state:r.get(e)||this.getInitialState(),signals:(i.get(e)||[]).filter(e=>!e.expiresAt||e.expiresAt>Date.now())}:null}static appendTranscript(e,t){let r=s.get(e)||[];s.set(e,[...r,t])}static getTranscript(e){return s.get(e)||[]}static async recordSignal(e,t){let r={...t,id:Math.random().toString(36).substring(7),timestamp:Date.now()},s=i.get(e)||[];i.set(e,[...s,r]),"struggle_detected"===t.type&&await this.updateState(e,e=>(e.recentStruggles.push({topic:t.context?.topic||"unknown",errorType:t.context?.errorType||"general",severity:t.context?.severity||5,detectedAt:Date.now()}),e.recentStruggles.length>5&&e.recentStruggles.shift(),e))}static async updateState(e,t){let i=t({...r.get(e)||this.getInitialState()});r.set(e,i)}static getInitialState(){return{currentMood:"neutral",energyLevel:100,recentStruggles:[],masteredTopics:[],activeTopics:[]}}static async processClassSummary(e,t){await this.recordSignal(e,{source:"classroom_ta",type:"topic_requested",content:`Completed class on ${t.topic}. Status: ${t.status}`,context:t}),await this.updateState(e,e=>(t.struggles&&Array.isArray(t.struggles)&&t.struggles.forEach(t=>{e.recentStruggles.push({topic:t,errorType:"general",severity:7,detectedAt:Date.now()})}),t.topic&&!e.activeTopics.includes(t.topic)&&e.activeTopics.push(t.topic),e))}static async recordQuizResult(e,t){let r=t.score/t.maxScore;await this.recordSignal(e,{source:"personal_tutor",type:r>=.7?"mastery_achieved":"struggle_detected",content:`Quiz on ${t.topic}: ${t.score}/${t.maxScore} (${Math.round(100*r)}%)`,context:t}),await this.updateState(e,e=>(r<.7?(!e.recentStruggles.find(e=>e.topic===t.topic)&&(e.recentStruggles.push({topic:t.topic,errorType:"general",severity:Math.round((1-r)*10),detectedAt:Date.now()}),e.recentStruggles.length>10&&e.recentStruggles.shift()),e.activeTopics.includes(t.topic)||e.activeTopics.push(t.topic)):r>=.85&&(e.masteredTopics.includes(t.topic)||e.masteredTopics.push(t.topic),e.recentStruggles=e.recentStruggles.filter(e=>e.topic!==t.topic)),e))}}e.s(["MemoryService",()=>n])},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))},848393,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_ai_subjects_index_ts_bb74979b._.js"].map(t=>e.l(t))).then(()=>t(522855)))}];

//# debugId=5bc904a3-259c-6850-9b90-015b2c66dbeb
//# sourceMappingURL=%5Broot-of-the-server%5D__05eca4f4._.js.map