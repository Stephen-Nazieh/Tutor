{
  "version": 3,
  "sources": [],
  "debugId": "3468117e-63a3-4bf6-291b-d52dd5024fac",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/extract-file-text.ts"],"sourcesContent":["// @ts-nocheck\n/**\n * Extract plain text from uploaded files: .txt, .md, .pdf, .docx, and images (OCR).\n * Used by the course/subject materials upload flow.\n */\n\nexport async function extractTextFromFile(file: File): Promise<string> {\n  const name = file.name.toLowerCase()\n  const type = file.type\n\n  // Plain text\n  if (\n    type === 'text/plain' ||\n    type.startsWith('text/') ||\n    name.endsWith('.txt') ||\n    name.endsWith('.md') ||\n    name.endsWith('.markdown')\n  ) {\n    return readAsText(file)\n  }\n\n  // PDF\n  if (type === 'application/pdf' || name.endsWith('.pdf')) {\n    return extractPdfText(file)\n  }\n\n  // Word .docx\n  if (\n    type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||\n    name.endsWith('.docx')\n  ) {\n    return extractDocxText(file)\n  }\n\n  // Legacy .doc - treat as binary; we could try mammoth with .doc but support is limited\n  if (name.endsWith('.doc')) {\n    try {\n      return extractDocxText(file)\n    } catch {\n      return readAsText(file).catch(() => '')\n    }\n  }\n\n  // Images: OCR\n  if (type.startsWith('image/')) {\n    return extractImageText(file)\n  }\n\n  // Fallback: try as text\n  return readAsText(file).catch(() => '')\n}\n\nfunction readAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(String(reader.result ?? ''))\n    reader.onerror = () => reject(reader.error)\n    reader.readAsText(file)\n  })\n}\n\nasync function extractPdfText(file: File): Promise<string> {\n  const pdfjs = await import('pdfjs-dist')\n  // Worker must be same-origin (CSP blocks external scripts). Served from public/ via copy-pdf-worker script.\n  if (typeof window !== 'undefined') {\n    const opts = (pdfjs as { GlobalWorkerOptions?: { workerSrc?: string } }).GlobalWorkerOptions\n    if (opts && !opts.workerSrc) {\n      opts.workerSrc = '/pdf.worker.min.mjs'\n    }\n  }\n  const data = await file.arrayBuffer()\n  const doc = await pdfjs.getDocument({ data }).promise\n  const numPages = doc.numPages\n  const parts: string[] = []\n  for (let i = 1; i <= numPages; i++) {\n    const page = await doc.getPage(i)\n    const content = await page.getTextContent()\n    const pageText = content.items.map((item: { str?: string }) => (item as { str?: string }).str ?? '').join(' ')\n    parts.push(pageText)\n  }\n  return parts.join('\\n\\n').trim() || ''\n}\n\nasync function extractDocxText(file: File): Promise<string> {\n  const mammoth = await import('mammoth')\n  const arrayBuffer = await file.arrayBuffer()\n  const result = await mammoth.extractRawText({ arrayBuffer })\n  return (result.value || '').trim()\n}\n\nasync function extractImageText(file: File): Promise<string> {\n  const mod = await import('tesseract.js')\n  const api = (mod as { default?: { recognize: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }; recognize?: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }).default ?? mod\n  const { data } = await api.recognize(file, 'eng', { logger: () => {} })\n  return (data?.text || '').trim()\n}\n"],"names":[],"mappings":"wCAMO,eAAe,EAAoB,CAAU,EAClD,IAAM,EAAO,EAAK,IAAI,CAAC,WAAW,GAC5B,EAAO,EAAK,IAAI,CAGtB,GACE,AAAS,kBACT,EAAK,UAAU,CAAC,UAChB,EAAK,QAAQ,CAAC,SACd,EAAK,QAAQ,CAAC,QACd,EAAK,QAAQ,CAAC,aAEd,CADA,MACO,EAAW,GAIpB,GAAa,oBAAT,GAA8B,EAAK,QAAQ,CAAC,QAC9C,CADuD,MAChD,EAAe,GAIxB,GACW,4EAAT,GACA,EAAK,QAAQ,CAAC,SAEd,CADA,MACO,EAAgB,GAIzB,GAAI,EAAK,QAAQ,CAAC,QAChB,CADyB,EACrB,CACF,OAAO,EAAgB,EACzB,CAAE,KAAM,CACN,OAAO,EAAW,GAAM,KAAK,CAAC,IAAM,GACtC,QAIF,AAAI,EAAK,UAAU,CAAC,UACX,CADsB,CACL,GAInB,EAAW,GAAM,KAAK,CAAC,IAAM,GACtC,CAEA,SAAS,EAAW,CAAU,EAC5B,OAAO,IAAI,QAAQ,CAAC,EAAS,KAC3B,IAAM,EAAS,IAAI,WACnB,EAAO,MAAM,CAAG,IAAM,EAAQ,OAAO,EAAO,MAAM,EAAI,KACtD,EAAO,OAAO,CAAG,IAAM,EAAO,EAAO,KAAK,EAC1C,EAAO,UAAU,CAAC,EACpB,EACF,CAEA,eAAe,EAAe,CAAU,EACtC,IAAM,EAAQ,MAAA,EAAA,CAAA,CAAA,QAQR,EAAO,MAAM,EAAK,WAAW,GAC7B,EAAM,MAAM,EAAM,WAAW,CAAC,MAAE,CAAK,GAAG,OAAO,CAC/C,EAAW,EAAI,QAAQ,CACvB,EAAkB,EAAE,CAC1B,IAAK,IAAI,EAAI,EAAG,GAAK,EAAU,IAAK,CAClC,IAAM,EAAO,MAAM,EAAI,OAAO,CAAC,GAEzB,EAAW,CADD,MAAM,EAAK,cAAc,EAAA,EAChB,KAAK,CAAC,GAAG,CAAC,AAAC,GAA4B,EAA0B,GAAG,EAAI,IAAI,IAAI,CAAC,KAC1G,EAAM,IAAI,CAAC,EACb,CACA,OAAO,EAAM,IAAI,CAAC,QAAQ,IAAI,IAAM,EACtC,CAEA,eAAe,EAAgB,CAAU,EACvC,IAAM,EAAU,MAAA,EAAA,CAAA,CAAA,QACV,EAAc,MAAM,EAAK,WAAW,GAE1C,MAAO,CAAC,CADO,MAAM,EAAQ,cAAc,CAAC,aAAE,CAAY,EAAA,EAC3C,KAAK,EAAI,EAAA,CAAE,CAAE,IAAI,EAClC,CAEA,eAAe,EAAiB,CAAU,EACxC,IAAM,EAAM,MAAA,EAAA,CAAA,CAAA,QACN,EAAO,EAA0N,OAAO,EAAI,EAC5O,CAAE,MAAI,CAAE,CAAG,MAAM,EAAI,SAAS,CAAC,EAAM,MAAO,CAAE,OAAQ,KAAO,CAAE,GACrE,MAAO,CAAC,GAAM,MAAQ,EAAA,CAAE,CAAE,IAAI,EAChC"}}]
}