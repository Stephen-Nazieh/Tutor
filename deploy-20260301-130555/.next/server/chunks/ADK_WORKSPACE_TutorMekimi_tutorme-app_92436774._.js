;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="a0bcf031-7cbc-e8c1-0287-5fa4647dfee9")}catch(e){}}();
module.exports=[277719,e=>{"use strict";var t=e.i(748846);async function r(e,t,o={}){var i,s,c,d,l,u;let{useAI:p=!0}=o;switch(e.type){case"multiple_choice":case"true_false":let h;return i=e,s=t,h=String(i.correctAnswer||"").toLowerCase().trim()===String(s).toLowerCase().trim(),{questionId:i.id,pointsEarned:h?i.points:0,pointsMax:i.points,correct:h,feedback:h?"Correct!":`Incorrect. The correct answer is: ${i.correctAnswer}`,explanation:i.explanation||void 0,gradedBy:"auto"};case"multi_select":let w,m,f,g,A,x,R,E,y;return c=e,d=t,w=Array.isArray(c.correctAnswer)?c.correctAnswer.map(e=>String(e).toLowerCase().trim()):[String(c.correctAnswer).toLowerCase().trim()],f=(m=Array.isArray(d)?d.map(e=>String(e).toLowerCase().trim()):[String(d).toLowerCase().trim()]).filter(e=>w.includes(e)).length,g=m.filter(e=>!w.includes(e)).length,A=w.length,R=f*(x=c.points/A)-.5*x*g,R=Math.round(100*(R=Math.max(0,Math.min(c.points,R))))/100,E=f===A&&0===g,y=R>0&&!E,{questionId:c.id,pointsEarned:R,pointsMax:c.points,correct:E,feedback:E?"Correct! All selections are right.":y?`Partially correct. You got ${f} of ${A} correct.`:"Incorrect.",explanation:c.explanation||void 0,gradedBy:"auto"};case"fill_in_blank":let v,b,q;return l=e,u=t,v=String(l.correctAnswer||"").toLowerCase().trim(),b=String(u).toLowerCase().trim(),q=v.split("|").map(e=>e.trim()).some(e=>e===b),{questionId:l.id,pointsEarned:q?l.points:0,pointsMax:l.points,correct:q,feedback:q?"Correct!":`Incorrect. The correct answer is: ${l.correctAnswer}`,explanation:l.explanation||void 0,gradedBy:"auto"};case"matching":return function(e,t){let r=e.correctAnswer||{},a=t||{},n=Object.keys(r).length,o=0;for(let[e,t]of Object.entries(r))a[e]?.toLowerCase().trim()===t.toLowerCase().trim()&&o++;let i=Math.round(o*(e.points/n)*100)/100,s=o===n;return{questionId:e.id,pointsEarned:i,pointsMax:e.points,correct:s,feedback:s?"Perfect match!":`You matched ${o} of ${n} correctly.`,explanation:e.explanation||void 0,gradedBy:"auto"}}(e,t);case"short_answer":case"essay":if(p)return a(e,t);return n(e);default:return n(e)}}async function a(e,r){let a=Array.isArray(r)?r.join(", "):String(r);try{var o;let r=(o={question:e.question,rubric:e.correctAnswer?`Expected answer should include: ${e.correctAnswer}`:void 0,studentAnswer:a,correctAnswer:e.correctAnswer?String(e.correctAnswer):void 0,maxScore:e.points,questionType:e.type},`You are an expert educational assessor. Grade the following student answer based on the question and rubric.

QUESTION: ${o.question}

${o.rubric?`RUBRIC/EXPECTED ANSWER: ${o.rubric}`:""}
${o.correctAnswer?`CORRECT ANSWER: ${o.correctAnswer}`:""}

STUDENT ANSWER: ${o.studentAnswer}

MAXIMUM SCORE: ${o.maxScore}

Provide your grading in the following JSON format:
{
    "score": number (0-${o.maxScore}),
    "feedback": "Brief, encouraging feedback for the student",
    "explanation": "Why this score was given and what was missing or excellent",
    "confidence": number (0-1)
}

Be fair but thorough. Partial credit is allowed. Return only valid JSON.`),n=await (0,t.generateWithFallback)(r,{temperature:.3,maxTokens:800}),i=function(e){try{let t=e.match(/\{[\s\S]*\}/);if(!t)throw Error("No JSON found in response");let r=JSON.parse(t[0]);return{score:r.score||0,maxScore:r.maxScore||100,feedback:r.feedback||"Your answer has been graded.",explanation:r.explanation||"",confidence:r.confidence||.5}}catch(e){return console.error("Failed to parse AI grading response:",e),{score:0,maxScore:100,feedback:"Could not grade answer automatically.",explanation:"An error occurred during AI grading.",confidence:0}}}(n.content);return{questionId:e.id,pointsEarned:Math.min(e.points,Math.max(0,i.score)),pointsMax:e.points,correct:i.score>=.7*e.points,feedback:i.feedback,explanation:i.explanation,gradedBy:"ai"}}catch(t){return console.error("AI grading failed:",t),n(e)}}function n(e){return{questionId:e.id,pointsEarned:0,pointsMax:e.points,correct:!1,feedback:"This question requires manual grading.",explanation:e.explanation||void 0,gradedBy:"auto"}}async function o(e,t,a={}){let n=[],i=0,s=0;for(let o of e){let e=t[o.id];if(null==e||""===e){n.push({questionId:o.id,correct:!1,pointsEarned:0,pointsMax:o.points,selectedAnswer:e,correctAnswer:o.correctAnswer,feedback:"No answer provided",gradedBy:"auto"}),s+=o.points;continue}let c=await r(o,e,a);n.push({questionId:o.id,correct:c.correct,pointsEarned:c.pointsEarned,pointsMax:c.pointsMax,selectedAnswer:e,correctAnswer:o.correctAnswer,feedback:c.feedback,explanation:c.explanation,gradedBy:c.gradedBy}),i+=c.pointsEarned,s+=o.points}let c=s>0?Math.round(i/s*100):0;return{results:n,totalScore:i,maxScore:s,percentage:c}}e.s(["gradeQuiz",()=>o])},700852,e=>e.a(async(t,r)=>{try{var a=e.i(620971),n=e.i(384030),o=e.i(908286),i=e.i(738597);e.i(688768);var s=e.i(257357),c=e.i(909105),d=e.i(277719),l=t([n,i]);[n,i]=l.then?(await l)():l;let u=(0,n.withCsrf)((0,n.withAuth)(async(t,r,l)=>{let u=await (0,o.getParamAsync)(l?.params,"id");if(!u)throw new n.ValidationError("Quiz ID required");let p=r.user.id,{attemptId:h,answers:w,timeSpent:m}=await t.json();if(!h)throw new n.ValidationError("attemptId is required");if(!w||"object"!=typeof w)throw new n.ValidationError("answers are required");let[f]=await i.drizzleDb.select().from(s.quiz).where((0,c.eq)(s.quiz.id,u)).limit(1);if(!f)throw new n.NotFoundError("Quiz not found");let[g]=await i.drizzleDb.select().from(s.quizAttempt).where((0,c.and)((0,c.eq)(s.quizAttempt.id,h),(0,c.eq)(s.quizAttempt.quizId,u),(0,c.eq)(s.quizAttempt.studentId,p),(0,c.eq)(s.quizAttempt.status,"in_progress"))).limit(1);if(!g)throw new n.NotFoundError("Active attempt not found");f.timeLimit&&(Date.now()-g.startedAt.getTime())/6e4>f.timeLimit+1&&console.log(`Quiz ${u} auto-submitted due to time limit for student ${p}`);let A=f.questions??[],x=await (0,d.gradeQuiz)(A,w,{useAI:!0,studentId:p}),R=m??Math.floor((Date.now()-g.startedAt.getTime())/1e3);await i.drizzleDb.update(s.quizAttempt).set({status:"graded",answers:w,score:x.totalScore,maxScore:x.maxScore,completedAt:new Date,timeSpent:R,questionResults:x.results}).where((0,c.eq)(s.quizAttempt.id,h));let[E]=await i.drizzleDb.select().from(s.quizAttempt).where((0,c.eq)(s.quizAttempt.id,h)).limit(1);try{let{onQuizComplete:t}=await e.A(639477);E.gamification=await t(p,u,x.percentage,100===x.percentage)}catch(e){console.error("Failed to award XP/badges:",e)}return a.NextResponse.json({success:!0,attempt:{id:E.id,score:x.totalScore,maxScore:x.maxScore,percentage:x.percentage,completedAt:E.completedAt,questionResults:x.results}})},{role:"STUDENT"}));e.s(["POST",0,u]),r()}catch(e){r(e)}},!1),928553,e=>e.a(async(t,r)=>{try{var a=e.i(78315),n=e.i(586961),o=e.i(196657),i=e.i(899733),s=e.i(233979),c=e.i(631683),d=e.i(840960),l=e.i(711373),u=e.i(699699),p=e.i(521140),h=e.i(205260),w=e.i(500249),m=e.i(431740),f=e.i(82608),g=e.i(635207),A=e.i(193695);e.i(708038);var x=e.i(447430),R=e.i(700852),E=t([R]);[R]=E.then?(await E)():E;let b=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/student/quizzes/[id]/submit/route",pathname:"/api/student/quizzes/[id]/submit",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/student/quizzes/[id]/submit/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:q,workUnitAsyncStorage:C,serverHooks:S}=b;function y(){return(0,o.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:C})}async function v(e,t,r){b.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/student/quizzes/[id]/submit/route";a=a.replace(/\/index$/,"")||"/";let o=await b.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:y,parsedUrl:v,isDraftMode:q,prerenderManifest:C,routerServerContext:S,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,resolvedPathname:I,clientReferenceManifest:z,serverActionsManifest:k}=o,M=(0,d.normalizeAppPath)(a),O=!!(C.dynamicRoutes[M]||C.routes[I]),P=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,v,!1):t.end("This page could not be found"),null);if(O&&!q){let e=!!C.routes[I],t=C.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await P();throw new A.NoFallbackError}}let _=null;!O||b.isDev||q||(_=I,_="/index"===_?"/":_);let $=!0===b.isDev||!O,D=O&&!$;k&&z&&(0,c.setManifestsSingleton)({page:a,clientReferenceManifest:z,serverActionsManifest:k});let U=e.method||"GET",B=(0,s.getTracer)(),H=B.getActiveScopeSpan(),L={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>b.onRequestError(e,t,a,n,S)},sharedContext:{buildId:R}},j=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(j,(0,u.signalFromNodeResponse)(t));try{let o=async e=>b.handle(K,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${a}`)}),c=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let l=async({previousCacheEntry:n})=>{try{if(!c&&T&&N&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let s=L.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=L.renderOpts.collectedTags;if(!O)return await (0,w.sendResponse)(j,F,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})},!1,S),t}},u=await b.handleResponse({req:e,nextConfig:y,cacheKey:_,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:c});if(!O)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});c||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),q&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return c&&O||p.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,w.sendResponse)(j,F,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};H?await d(H):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${U} ${a}`,kind:s.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},d))}catch(t){if(t instanceof A.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:T})},!1,S),O)throw t;return await (0,w.sendResponse)(j,F,new Response(null,{status:500})),null}}e.s(["handler",()=>v,"patchFetch",()=>y,"routeModule",()=>b,"serverHooks",()=>S,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>C]),r()}catch(e){r(e)}},!1)];

//# debugId=a0bcf031-7cbc-e8c1-0287-5fa4647dfee9
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_92436774._.js.map