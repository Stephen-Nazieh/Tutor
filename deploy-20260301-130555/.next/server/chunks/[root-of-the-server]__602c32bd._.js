;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="73527306-c8b1-4788-258d-50883ab0db12")}catch(e){}}();
module.exports=[908286,e=>{"use strict";async function t(e,t){var n=e instanceof Promise?await e:e;if(!n||"object"!=typeof n)return;let a=n[t];return null!=a?Array.isArray(a)?a[0]:a:void 0}e.s(["getParamAsync",()=>t])},142388,e=>e.a(async(t,n)=>{try{var a=e.i(620971),r=e.i(909105),s=e.i(320947),i=e.i(997103),o=e.i(384030),l=e.i(908286),u=e.i(6286),d=e.i(738597);e.i(688768);var c=e.i(257357),p=t([o,u,d]);[o,u,d]=p.then?(await p)():p;let m=(0,o.withAuth)(async(e,t,n)=>{let o=await (0,l.getParamAsync)(n?.params,"studentId");if(!o)return a.NextResponse.json({error:"Student ID required"},{status:400});let p=await (0,u.getFamilyAccountForParent)(t);if(!p)return a.NextResponse.json({error:"未找到家庭账户"},{status:404});if(!p.studentIds.includes(o))return a.NextResponse.json({error:"无权查看该学生的作业"},{status:403});let m=await d.drizzleDb.query.generatedTask.findMany({where:(0,r.and)((0,r.inArray)(c.generatedTask.status,["assigned","completed","draft"]),s.sql`${c.generatedTask.assignments} ?? ${o}`),orderBy:[(0,i.desc)(c.generatedTask.createdAt)],limit:100,with:{tutor:{with:{profile:{columns:{name:!0}}},columns:{id:!0}},lesson:{with:{module:{with:{curriculum:{columns:{name:!0}}}}},columns:{id:!0,title:!0}}}}),h=m.map(e=>e.id),[g,f]=await Promise.all([h.length>0?d.drizzleDb.query.taskSubmission.findMany({where:(0,r.and)((0,r.eq)(c.taskSubmission.studentId,o),(0,r.inArray)(c.taskSubmission.taskId,h))}):Promise.resolve([]),h.length>0?d.drizzleDb.query.feedbackWorkflow.findMany({where:(0,r.eq)(c.feedbackWorkflow.studentId,o),with:{submission:{columns:{taskId:!0}}}}):Promise.resolve([])]),v=f.filter(e=>h.includes(e.submission?.taskId)),R=new Map(g.map(e=>[e.taskId,e])),w=new Map(v.map(e=>[e.submissionId,e])),y=m.map(e=>{let t=R.get(e.id),n=e.dueDate&&new Date(e.dueDate)<new Date&&!t,a=t?"submitted":n?"overdue":"pending",r=t?w.get(t.id):null;return{id:e.id,title:e.title,description:e.description,type:e.type,difficulty:e.difficulty,dueDate:e.dueDate?.toISOString()??null,assignedAt:e.assignedAt?.toISOString()??null,maxScore:e.maxScore,status:a,score:t?.score??null,submittedAt:t?.submittedAt?.toISOString()??null,gradedAt:t?.gradedAt?.toISOString()??null,questionCount:Array.isArray(e.questions)?e.questions.length:0,lessonId:e.lessonId,lessonTitle:e.lesson?.title??null,curriculumName:e.lesson?.module?.curriculum?.name??null,tutorName:e.tutor?.profile?.name??null,timeSpent:t?.timeSpent??null,attempts:t?.attempts??0,maxAttempts:e.maxAttempts,aiGraded:!!r,aiScore:r?.aiScore??null,aiComments:r?.aiComments??null,aiStrengths:r?.aiStrengths??[],aiImprovements:r?.aiImprovements??[],tutorFeedback:t?.tutorFeedback??r?.modifiedComments??null,tutorApproved:t?.tutorApproved??r?.approvedAt!=null}}),A=y.filter(e=>"pending"===e.status).length,E=y.filter(e=>"submitted"===e.status).length,_=y.filter(e=>"overdue"===e.status).length;return a.NextResponse.json({success:!0,assignments:y,stats:{pending:A,submitted:E,overdue:_,total:y.length}})},{role:"PARENT"});e.s(["GET",0,m]),n()}catch(e){n(e)}},!1),535022,e=>e.a(async(t,n)=>{try{var a=e.i(78315),r=e.i(586961),s=e.i(196657),i=e.i(899733),o=e.i(233979),l=e.i(631683),u=e.i(840960),d=e.i(711373),c=e.i(699699),p=e.i(521140),m=e.i(205260),h=e.i(500249),g=e.i(431740),f=e.i(82608),v=e.i(635207),R=e.i(193695);e.i(708038);var w=e.i(447430),y=e.i(142388),A=t([y]);[y]=A.then?(await A)():A;let b=new a.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/parent/students/[studentId]/assignments/route",pathname:"/api/parent/students/[studentId]/assignments",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/parent/students/[studentId]/assignments/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:C,workUnitAsyncStorage:S,serverHooks:x}=b;function E(){return(0,s.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:S})}async function _(e,t,n){b.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/parent/students/[studentId]/assignments/route";a=a.replace(/\/index$/,"")||"/";let s=await b.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:y,params:A,nextConfig:E,parsedUrl:_,isDraftMode:C,prerenderManifest:S,routerServerContext:x,isOnDemandRevalidate:k,revalidateOnlyGenerated:I,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:N}=s,O=(0,u.normalizeAppPath)(a),D=!!(S.dynamicRoutes[O]||S.routes[P]),q=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,_,!1):t.end("This page could not be found"),null);if(D&&!C){let e=!!S.routes[P],t=S.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await q();throw new R.NoFallbackError}}let M=null;!D||b.isDev||C||(M=P,M="/index"===M?"/":M);let H=!0===b.isDev||!D,U=D&&!H;N&&T&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:T,serverActionsManifest:N});let j=e.method||"GET",F=(0,o.getTracer)(),K=F.getActiveScopeSpan(),$={params:A,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a,r)=>b.onRequestError(e,t,a,r,x)},sharedContext:{buildId:y}},z=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let s=async e=>b.handle(W,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=F.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${j} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${a}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var o,u;let d=async({previousCacheEntry:r})=>{try{if(!l&&k&&I&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let o=$.renderOpts.pendingWaitUntil;o&&n.waitUntil&&(n.waitUntil(o),o=void 0);let u=$.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(z,B,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})},!1,x),t}},c=await b.handleResponse({req:e,nextConfig:E,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:l});if(!D)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(u=c.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",k?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&D||p.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(z,B,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};K?await u(K):await F.withPropagatedContext(e.headers,()=>F.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},u))}catch(t){if(t instanceof R.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:k})},!1,x),D)throw t;return await (0,h.sendResponse)(z,B,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>E,"routeModule",()=>b,"serverHooks",()=>x,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>S]),n()}catch(e){n(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=73527306-c8b1-4788-258d-50883ab0db12
//# sourceMappingURL=%5Broot-of-the-server%5D__602c32bd._.js.map