;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="fb8b2a51-4e62-409f-725c-c97899e2f20e")}catch(e){}}();
module.exports=[578079,e=>e.a(async(t,r)=>{try{var a=e.i(620971),n=e.i(384030),i=e.i(738597);e.i(688768);var o=e.i(257357),l=e.i(909105),u=t([n,i]);[n,i]=u.then?(await u)():u;let s="COMPLETED",d="PENDING",c="PROCESSING",p=(0,n.withAuth)(async(e,t)=>{let r=t.user.id,[n,u]=await Promise.all([i.drizzleDb.select({id:o.clinic.id}).from(o.clinic).where((0,l.eq)(o.clinic.tutorId,r)),i.drizzleDb.select({id:o.curriculum.id}).from(o.curriculum).where((0,l.eq)(o.curriculum.creatorId,r))]),p=n.map(e=>e.id),m=u.map(e=>e.id),h=[],y=[];p.length>0&&(h=(await i.drizzleDb.select({id:o.clinicBooking.id}).from(o.clinicBooking).where((0,l.inArray)(o.clinicBooking.clinicId,p))).map(e=>e.id)),m.length>0&&(y=(await i.drizzleDb.select({id:o.curriculumEnrollment.id}).from(o.curriculumEnrollment).where((0,l.inArray)(o.curriculumEnrollment.curriculumId,m))).map(e=>e.id));let g=(await i.drizzleDb.select({id:o.payment.id,amount:o.payment.amount,currency:o.payment.currency,createdAt:o.payment.createdAt,tutorId:o.payment.tutorId,bookingId:o.payment.bookingId,enrollmentId:o.payment.enrollmentId}).from(o.payment).where((0,l.eq)(o.payment.status,s))).filter(e=>e.tutorId===r||e.bookingId&&h.includes(e.bookingId)||e.enrollmentId&&y.includes(e.enrollmentId)),R=(await i.drizzleDb.select({id:o.payment.id,amount:o.payment.amount,currency:o.payment.currency,tutorId:o.payment.tutorId,bookingId:o.payment.bookingId,enrollmentId:o.payment.enrollmentId}).from(o.payment).where((0,l.inArray)(o.payment.status,[d,c]))).filter(e=>e.tutorId===r||e.bookingId&&h.includes(e.bookingId)||e.enrollmentId&&y.includes(e.enrollmentId)),w=await i.drizzleDb.select({amount:o.payout.amount,status:o.payout.status}).from(o.payout).where((0,l.eq)(o.payout.tutorId,r)),v=g.reduce((e,t)=>e+(Number(t.amount)||0),0),f=R.reduce((e,t)=>e+(Number(t.amount)||0),0),E=w.filter(e=>e.status===s).reduce((e,t)=>e+(Number(t.amount)||0),0),b=w.filter(e=>e.status===d||e.status===c).reduce((e,t)=>e+(Number(t.amount)||0),0),A=new Date,I=new Date(A.getFullYear(),A.getMonth(),1),_=g.filter(e=>e.createdAt&&new Date(e.createdAt)>=I).reduce((e,t)=>e+(Number(t.amount)||0),0),C=new Date(A.getFullYear(),A.getMonth()-1,1),P=new Date(A.getFullYear(),A.getMonth(),0),x=g.filter(e=>{let t=e.createdAt?new Date(e.createdAt):null;return t&&t>=C&&t<=P}).reduce((e,t)=>e+(Number(t.amount)||0),0),D=g.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,5).map(e=>({id:e.id,amount:e.amount,currency:e.currency,date:e.createdAt}));return a.NextResponse.json({balance:{available:Math.round(100*(v-E-b))/100,pending:Math.round(100*f)/100,pendingPayouts:Math.round(100*b)/100,totalEarnings:Math.round(100*v)/100,totalPayouts:Math.round(100*E)/100},thisMonth:{earnings:Math.round(100*_)/100,change:Math.round(10*(x>0?(_-x)/x*100:0))/10},recentPayments:D,currency:"SGD"})},{role:"TUTOR"});e.s(["GET",0,p]),r()}catch(e){r(e)}},!1),312135,e=>e.a(async(t,r)=>{try{var a=e.i(78315),n=e.i(586961),i=e.i(196657),o=e.i(899733),l=e.i(233979),u=e.i(631683),s=e.i(840960),d=e.i(711373),c=e.i(699699),p=e.i(521140),m=e.i(205260),h=e.i(500249),y=e.i(431740),g=e.i(82608),R=e.i(635207),w=e.i(193695);e.i(708038);var v=e.i(447430),f=e.i(578079),E=t([f]);[f]=E.then?(await E)():E;let I=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/tutor/revenue/balance/route",pathname:"/api/tutor/revenue/balance",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/revenue/balance/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:_,workUnitAsyncStorage:C,serverHooks:P}=I;function b(){return(0,i.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:C})}async function A(e,t,r){I.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/tutor/revenue/balance/route";a=a.replace(/\/index$/,"")||"/";let i=await I.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:f,params:E,nextConfig:b,parsedUrl:A,isDraftMode:_,prerenderManifest:C,routerServerContext:P,isOnDemandRevalidate:x,revalidateOnlyGenerated:D,resolvedPathname:N,clientReferenceManifest:T,serverActionsManifest:k}=i,M=(0,s.normalizeAppPath)(a),O=!!(C.dynamicRoutes[M]||C.routes[N]),S=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,A,!1):t.end("This page could not be found"),null);if(O&&!_){let e=!!C.routes[N],t=C.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let q=null;!O||I.isDev||_||(q=N,q="/index"===q?"/":q);let H=!0===I.isDev||!O,U=O&&!H;k&&T&&(0,u.setManifestsSingleton)({page:a,clientReferenceManifest:T,serverActionsManifest:k});let z=e.method||"GET",K=(0,l.getTracer)(),j=K.getActiveScopeSpan(),F={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>I.onRequestError(e,t,a,n,P)},sharedContext:{buildId:f}},$=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest($,(0,c.signalFromNodeResponse)(t));try{let i=async e=>I.handle(G,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=K.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${z} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${z} ${a}`)}),u=!!(0,o.getRequestMeta)(e,"minimalMode"),s=async o=>{var l,s;let d=async({previousCacheEntry:n})=>{try{if(!u&&x&&D&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let s=F.renderOpts.collectedTags;if(!O)return await (0,h.sendResponse)($,B,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(a.headers);s&&(t[R.NEXT_CACHE_TAGS_HEADER]=s),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,P),t}},c=await I.handleResponse({req:e,nextConfig:b,cacheKey:q,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:D,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:u});if(!O)return null;if((null==c||null==(l=c.value)?void 0:l.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(s=c.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",x?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,y.fromNodeOutgoingHttpHeaders)(c.value.headers);return u&&O||p.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)($,B,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};j?await s(j):await K.withPropagatedContext(e.headers,()=>K.trace(p.BaseServerSpan.handleRequest,{spanName:`${z} ${a}`,kind:l.SpanKind.SERVER,attributes:{"http.method":z,"http.target":e.url}},s))}catch(t){if(t instanceof w.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,P),O)throw t;return await (0,h.sendResponse)($,B,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>b,"routeModule",()=>I,"serverHooks",()=>P,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>C]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=fb8b2a51-4e62-409f-725c-c97899e2f20e
//# sourceMappingURL=%5Broot-of-the-server%5D__0ea9f9a1._.js.map