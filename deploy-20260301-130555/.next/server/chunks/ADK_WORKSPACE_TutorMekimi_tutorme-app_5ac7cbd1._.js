;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="c992709e-b1ca-18aa-2de6-b2c229823c8e")}catch(e){}}();
module.exports=[924366,e=>e.a(async(t,i)=>{try{var r=e.i(620971),a=e.i(909105),n=e.i(997103),o=e.i(122697),s=e.i(384030),u=e.i(908286),d=e.i(738597);e.i(688768);var l=e.i(257357),c=t([s,d]);[s,d]=c.then?(await c)():c;let p=(0,s.withAuth)(async(e,t,i)=>{let c=await (0,u.getParamAsync)(i?.params,"id");if(!c)throw new s.ValidationError("Quiz ID required");let[p]=await d.drizzleDb.select().from(l.quiz).where((0,a.and)((0,a.eq)(l.quiz.id,c),(0,a.eq)(l.quiz.tutorId,t.user.id))).limit(1);if(!p)throw new s.NotFoundError("Quiz not found");let[h]=await d.drizzleDb.select({value:(0,o.count)()}).from(l.quizAttempt).where((0,a.eq)(l.quizAttempt.quizId,c)),[m]=await d.drizzleDb.select({value:(0,o.count)()}).from(l.quizAssignment).where((0,a.eq)(l.quizAssignment.quizId,c)),w=await d.drizzleDb.select({id:l.quizAttempt.id,score:l.quizAttempt.score,maxScore:l.quizAttempt.maxScore,completedAt:l.quizAttempt.completedAt,studentName:l.profile.name,studentId:l.user.id}).from(l.quizAttempt).innerJoin(l.user,(0,a.eq)(l.user.id,l.quizAttempt.studentId)).leftJoin(l.profile,(0,a.eq)(l.profile.userId,l.user.id)).where((0,a.eq)(l.quizAttempt.quizId,c)).orderBy((0,n.desc)(l.quizAttempt.completedAt)).limit(5);return r.NextResponse.json({quiz:{...p,attemptCount:Number(h?.value||0),assignmentCount:Number(m?.value||0)},recentAttempts:w.map(e=>({id:e.id,score:e.score,maxScore:e.maxScore,percentage:Math.round(e.score/e.maxScore*100),completedAt:e.completedAt,studentName:e.studentName||"Unknown"}))})},{role:"TUTOR"}),h=(0,s.withCsrf)((0,s.withAuth)(async(e,t,i)=>{let n=await (0,u.getParamAsync)(i?.params,"id");if(!n)throw new s.ValidationError("Quiz ID required");let[o]=await d.drizzleDb.select().from(l.quiz).where((0,a.and)((0,a.eq)(l.quiz.id,n),(0,a.eq)(l.quiz.tutorId,t.user.id))).limit(1);if(!o)throw new s.NotFoundError("Quiz not found");let{title:c,description:p,type:h,status:m,timeLimit:w,allowedAttempts:q,shuffleQuestions:z,shuffleOptions:f,showCorrectAnswers:v,passingScore:R,questions:A,tags:E,startDate:g,dueDate:x,curriculumId:C,lessonId:y}=await e.json(),N={};if(void 0!==c&&(N.title=c),void 0!==p&&(N.description=p),void 0!==h&&(N.type=h),void 0!==m&&(N.status=m),void 0!==w&&(N.timeLimit=w),void 0!==q&&(N.allowedAttempts=Math.max(1,q)),void 0!==z&&(N.shuffleQuestions=z),void 0!==f&&(N.shuffleOptions=f),void 0!==v&&(N.showCorrectAnswers=v),void 0!==R&&(N.passingScore=R),void 0!==E&&(N.tags=E),void 0!==g&&(N.startDate=g?new Date(g):null),void 0!==x&&(N.dueDate=x?new Date(x):null),void 0!==C&&(N.curriculumId=C),void 0!==y&&(N.lessonId=y),void 0!==A){if(0===A.length)throw new s.ValidationError("Quiz must have at least one question");for(let e=0;e<A.length;e++)if(!A[e].question)throw new s.ValidationError(`Question ${e+1} is missing text`);N.questions=A.map((e,t)=>({...e,id:e.id||`q-${Date.now()}-${t}`,order:t})),N.totalPoints=A.reduce((e,t)=>e+(t.points||1),0)}let[b]=await d.drizzleDb.update(l.quiz).set(N).where((0,a.eq)(l.quiz.id,n)).returning();return r.NextResponse.json({success:!0,quiz:b})},{role:"TUTOR"})),m=(0,s.withCsrf)((0,s.withAuth)(async(e,t,i)=>{let n=await (0,u.getParamAsync)(i?.params,"id");if(!n)throw new s.ValidationError("Quiz ID required");let[c]=await d.drizzleDb.select().from(l.quiz).where((0,a.and)((0,a.eq)(l.quiz.id,n),(0,a.eq)(l.quiz.tutorId,t.user.id))).limit(1);if(!c)throw new s.NotFoundError("Quiz not found");let[p]=await d.drizzleDb.select({value:(0,o.count)()}).from(l.quizAttempt).where((0,a.eq)(l.quizAttempt.quizId,n));return Number(p?.value||0)>0?(await d.drizzleDb.update(l.quiz).set({status:"archived"}).where((0,a.eq)(l.quiz.id,n)),r.NextResponse.json({success:!0,message:"Quiz has attempts and was archived instead of deleted"})):(await d.drizzleDb.delete(l.quiz).where((0,a.eq)(l.quiz.id,n)),r.NextResponse.json({success:!0,message:"Quiz deleted successfully"}))},{role:"TUTOR"}));e.s(["DELETE",0,m,"GET",0,p,"PATCH",0,h]),i()}catch(e){i(e)}},!1),844612,e=>e.a(async(t,i)=>{try{var r=e.i(78315),a=e.i(586961),n=e.i(196657),o=e.i(899733),s=e.i(233979),u=e.i(631683),d=e.i(840960),l=e.i(711373),c=e.i(699699),p=e.i(521140),h=e.i(205260),m=e.i(500249),w=e.i(431740),q=e.i(82608),z=e.i(635207),f=e.i(193695);e.i(708038);var v=e.i(447430),R=e.i(924366),A=t([R]);[R]=A.then?(await A)():A;let x=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tutor/quizzes/[id]/route",pathname:"/api/tutor/quizzes/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/quizzes/[id]/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:C,workUnitAsyncStorage:y,serverHooks:N}=x;function E(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:y})}async function g(e,t,i){x.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/tutor/quizzes/[id]/route";r=r.replace(/\/index$/,"")||"/";let n=await x.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:R,params:A,nextConfig:E,parsedUrl:g,isDraftMode:C,prerenderManifest:y,routerServerContext:N,isOnDemandRevalidate:b,revalidateOnlyGenerated:T,resolvedPathname:D,clientReferenceManifest:I,serverActionsManifest:P}=n,O=(0,d.normalizeAppPath)(r),S=!!(y.dynamicRoutes[O]||y.routes[D]),_=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,g,!1):t.end("This page could not be found"),null);if(S&&!C){let e=!!y.routes[D],t=y.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await _();throw new f.NoFallbackError}}let U=null;!S||x.isDev||C||(U=D,U="/index"===U?"/":U);let H=!0===x.isDev||!S,k=S&&!H;P&&I&&(0,u.setManifestsSingleton)({page:r,clientReferenceManifest:I,serverActionsManifest:P});let M=e.method||"GET",j=(0,s.getTracer)(),$=j.getActiveScopeSpan(),F={params:A,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,r,a)=>x.onRequestError(e,t,r,a,N)},sharedContext:{buildId:R}},Q=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=c.NextRequestAdapter.fromNodeNextRequest(Q,(0,c.signalFromNodeResponse)(t));try{let n=async e=>x.handle(V,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=j.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${r}`)}),u=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var s,d;let l=async({previousCacheEntry:a})=>{try{if(!u&&b&&T&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await n(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let s=F.renderOpts.pendingWaitUntil;s&&i.waitUntil&&(i.waitUntil(s),s=void 0);let d=F.renderOpts.collectedTags;if(!S)return await (0,m.sendResponse)(Q,K,r,F.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,w.toNodeOutgoingHttpHeaders)(r.headers);d&&(t[z.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=z.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=z.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:b})},!1,N),t}},c=await x.handleResponse({req:e,nextConfig:E,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:T,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:u});if(!S)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,w.fromNodeOutgoingHttpHeaders)(c.value.headers);return u&&S||p.delete(z.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,q.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(Q,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};$?await d($):await j.withPropagatedContext(e.headers,()=>j.trace(p.BaseServerSpan.handleRequest,{spanName:`${M} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},d))}catch(t){if(t instanceof f.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:b})},!1,N),S)throw t;return await (0,m.sendResponse)(Q,K,new Response(null,{status:500})),null}}e.s(["handler",()=>g,"patchFetch",()=>E,"routeModule",()=>x,"serverHooks",()=>N,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>y]),i()}catch(e){i(e)}},!1)];

//# debugId=c992709e-b1ca-18aa-2de6-b2c229823c8e
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_5ac7cbd1._.js.map