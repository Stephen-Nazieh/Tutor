;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5cf1d358-9413-460c-cb98-0fde4986ab7b")}catch(e){}}();
module.exports=[31333,e=>e.a(async(t,a)=>{try{var r=e.i(620971),i=e.i(909105),n=e.i(320947),s=e.i(997103),o=e.i(384030),l=e.i(738597);e.i(688768);var u=e.i(257357),d=e.i(254799),c=t([o,l]);[o,l]=c.then?(await c)():c;let p=(0,o.withAuth)(async(e,t)=>{let{searchParams:a}=new URL(e.url),o=a.get("status"),d=a.get("type"),c=a.get("curriculumId"),p=a.get("q"),h=parseInt(a.get("page")||"1"),m=Math.min(parseInt(a.get("limit")||"20"),100),R=(h-1)*m,g=[(0,i.eq)(u.quiz.tutorId,t.user.id)];if(o&&g.push((0,i.eq)(u.quiz.status,o)),d&&g.push((0,i.eq)(u.quiz.type,d)),c&&g.push((0,i.eq)(u.quiz.curriculumId,c)),p){let e=(0,i.or)((0,i.ilike)(u.quiz.title,`%${p}%`),(0,i.ilike)(u.quiz.description,`%${p}%`),n.sql`${u.quiz.tags} @> ARRAY[${p}]::text[]`);e&&g.push(e)}let f=(0,i.and)(...g),[w,v]=await Promise.all([l.drizzleDb.query.quiz.findMany({where:f,orderBy:[(0,s.desc)(u.quiz.updatedAt)],limit:m,offset:R,with:{attempts:{columns:{id:!0}},assignments:{columns:{id:!0}}}}),l.drizzleDb.select({count:n.sql`count(*)`}).from(u.quiz).where(f)]),E=Number(v[0]?.count||0),y=w.map(e=>({...e,attemptCount:e.attempts.length,assignmentCount:e.assignments.length,attempts:void 0,assignments:void 0}));return r.NextResponse.json({quizzes:y,pagination:{page:h,limit:m,totalCount:E,totalPages:Math.ceil(E/m)}})},{role:"TUTOR"}),h=(0,o.withCsrf)((0,o.withAuth)(async(e,t)=>{let{title:a,description:i,type:n="graded",timeLimit:s,allowedAttempts:c=1,shuffleQuestions:p=!1,shuffleOptions:h=!1,showCorrectAnswers:m="after_attempt",passingScore:R,questions:g=[],tags:f=[],startDate:w,dueDate:v,curriculumId:E,lessonId:y}=await e.json().catch(()=>({}));if(!a)throw new o.ValidationError("Title is required");if(!Array.isArray(g)||0===g.length)throw new o.ValidationError("Quiz must have at least one question");let _=g.reduce((e,t)=>e+(t.points||1),0);for(let e=0;e<g.length;e++){let t=g[e];if(!t.question)throw new o.ValidationError(`Question ${e+1} is missing text`);if(("multiple_choice"===t.type||"multi_select"===t.type)&&(!t.options||t.options.length<2))throw new o.ValidationError(`Question ${e+1} requires at least 2 options`)}let q=g.map((e,t)=>({...e,id:e.id||`q-${d.default.randomUUID()}-${t}`,order:t})),[A]=await l.drizzleDb.insert(u.quiz).values({id:d.default.randomUUID(),tutorId:t.user.id,title:a,description:i||null,type:n,status:"draft",timeLimit:s||null,allowedAttempts:Math.max(1,c),shuffleQuestions:!!p,shuffleOptions:!!h,showCorrectAnswers:m,passingScore:R||null,questions:q,totalPoints:_,tags:Array.isArray(f)?f:[],startDate:w?new Date(w):null,dueDate:v?new Date(v):null,curriculumId:E||null,lessonId:y||null}).returning();return r.NextResponse.json({success:!0,quiz:A},{status:201})},{role:"TUTOR"}));e.s(["GET",0,p,"POST",0,h]),a()}catch(e){a(e)}},!1),768135,e=>e.a(async(t,a)=>{try{var r=e.i(78315),i=e.i(586961),n=e.i(196657),s=e.i(899733),o=e.i(233979),l=e.i(631683),u=e.i(840960),d=e.i(711373),c=e.i(699699),p=e.i(521140),h=e.i(205260),m=e.i(500249),R=e.i(431740),g=e.i(82608),f=e.i(635207),w=e.i(193695);e.i(708038);var v=e.i(447430),E=e.i(31333),y=t([E]);[E]=y.then?(await y)():y;let A=new r.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/tutor/quizzes/route",pathname:"/api/tutor/quizzes",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/quizzes/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:C,workUnitAsyncStorage:x,serverHooks:T}=A;function _(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:x})}async function q(e,t,a){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/tutor/quizzes/route";r=r.replace(/\/index$/,"")||"/";let n=await A.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:E,params:y,nextConfig:_,parsedUrl:q,isDraftMode:C,prerenderManifest:x,routerServerContext:T,isOnDemandRevalidate:P,revalidateOnlyGenerated:z,resolvedPathname:b,clientReferenceManifest:O,serverActionsManifest:N}=n,I=(0,u.normalizeAppPath)(r),D=!!(x.dynamicRoutes[I]||x.routes[b]),S=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,q,!1):t.end("This page could not be found"),null);if(D&&!C){let e=!!x.routes[b],t=x.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let U=null;!D||A.isDev||C||(U=b,U="/index"===U?"/":U);let k=!0===A.isDev||!D,M=D&&!k;N&&O&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:O,serverActionsManifest:N});let H=e.method||"GET",$=(0,o.getTracer)(),j=$.getActiveScopeSpan(),K={params:y,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>A.onRequestError(e,t,r,i,T)},sharedContext:{buildId:E}},F=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),V=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let n=async e=>A.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${r}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var o,u;let d=async({previousCacheEntry:i})=>{try{if(!l&&P&&z&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await n(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let o=K.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let u=K.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(F,L,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,i=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},!1,T),t}},c=await A.handleResponse({req:e,nextConfig:_,cacheKey:U,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:z,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!D)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(u=c.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,R.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&D||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(F,L,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};j?await u(j):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${r}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof w.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},!1,T),D)throw t;return await (0,m.sendResponse)(F,L,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>_,"routeModule",()=>A,"serverHooks",()=>T,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>x]),a()}catch(e){a(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=5cf1d358-9413-460c-cb98-0fde4986ab7b
//# sourceMappingURL=%5Broot-of-the-server%5D__634b2243._.js.map