;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="a9003b1c-5c20-f703-7aa6-e9cecca945de")}catch(e){}}();
module.exports=[908286,e=>{"use strict";async function t(e,t){var r=e instanceof Promise?await e:e;if(!r||"object"!=typeof r)return;let a=r[t];return null!=a?Array.isArray(a)?a[0]:a:void 0}e.s(["getParamAsync",()=>t])},917126,e=>{"use strict";let t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,r=/\s*on\w+\s*=\s*["'][^"']*["']/gi,a=/javascript\s*:/gi,i=/data\s*:\s*[^,]*\s*,/gi,n=/<(?:iframe|object|embed|form|meta|link)\b[^>]*>/gi;function s(e){return"string"!=typeof e?"":e.replace(t,"").replace(n,"").replace(r,"").replace(a,"").replace(i,"")}function o(e,t=5e4){let r=s(e);return r.length<=t?r:r.slice(0,t)}e.s(["sanitizeHtml",()=>s,"sanitizeHtmlWithMax",()=>o])},122697,e=>{"use strict";var t=e.i(707529),r=e.i(691827),a=e.i(320947);function i(e){return a.sql`count(${e||a.sql.raw("*")})`.mapWith(Number)}function n(e){return a.sql`count(distinct ${e})`.mapWith(Number)}function s(e){return a.sql`avg(${e})`.mapWith(String)}function o(e){return a.sql`avg(distinct ${e})`.mapWith(String)}function u(e){return a.sql`sum(${e})`.mapWith(String)}function l(e){return a.sql`sum(distinct ${e})`.mapWith(String)}function c(e){return a.sql`max(${e})`.mapWith((0,r.is)(e,t.Column)?e:String)}function d(e){return a.sql`min(${e})`.mapWith((0,r.is)(e,t.Column)?e:String)}e.s(["avg",()=>s,"avgDistinct",()=>o,"count",()=>i,"countDistinct",()=>n,"max",()=>c,"min",()=>d,"sum",()=>u,"sumDistinct",()=>l])},163649,e=>e.a(async(t,r)=>{try{var a=e.i(620971),i=e.i(909105),n=e.i(997103),s=e.i(122697),o=e.i(384030),u=e.i(738597);e.i(688768);var l=e.i(257357),c=e.i(908286),d=e.i(917126),p=e.i(254799),h=t([o,u]);[o,u]=h.then?(await h)():h;let m=(0,o.withAuth)(async(e,t,r)=>{let d=await (0,c.getParamAsync)(r?.params,"id");if(!d)return a.NextResponse.json({error:"Course ID required"},{status:400});let[p]=await u.drizzleDb.select().from(l.curriculum).where((0,i.eq)(l.curriculum.id,d)).limit(1);if(!p)throw new o.NotFoundError("Course not found");let h=await u.drizzleDb.select().from(l.courseBatch).where((0,i.eq)(l.courseBatch.curriculumId,d)).orderBy((0,n.asc)(l.courseBatch.order)),m=await Promise.all(h.map(async t=>{let[r]=await u.drizzleDb.select({value:(0,s.count)()}).from(l.curriculumEnrollment).where((0,i.eq)(l.curriculumEnrollment.batchId,t.id));return{id:t.id,name:t.name,startDate:t.startDate,order:t.order,difficulty:t.difficulty??null,schedule:Array.isArray(t.schedule)?t.schedule:[],enrollmentCount:Number(r?.value||0),joinLink:t.meetingUrl??`${e.nextUrl.origin}/curriculum/${d}?batch=${t.id}`}}));return a.NextResponse.json({batches:m})},{role:"TUTOR"}),f=(0,o.withCsrf)((0,o.withAuth)(async(e,t,r)=>{let n=await (0,c.getParamAsync)(r?.params,"id");if(!n)return a.NextResponse.json({error:"Course ID required"},{status:400});let[h]=await u.drizzleDb.select({id:l.curriculum.id}).from(l.curriculum).where((0,i.eq)(l.curriculum.id,n)).limit(1);if(!h)throw new o.NotFoundError("Course not found");let m=await e.json().catch(()=>({})),f="string"==typeof m.name?(0,d.sanitizeHtmlWithMax)(m.name.trim(),200):"",w=m.startDate?new Date(m.startDate):null;if(!f)throw new o.ValidationError("Batch name is required");let[v]=await u.drizzleDb.select({maxValue:(0,s.max)(l.courseBatch.order)}).from(l.courseBatch).where((0,i.eq)(l.courseBatch.curriculumId,n)),R=v?.maxValue??-1,[g]=await u.drizzleDb.insert(l.courseBatch).values({id:p.default.randomUUID(),curriculumId:n,name:f,startDate:w,order:R+1,isLive:!0,maxStudents:50}).returning();return a.NextResponse.json({batch:{id:g.id,name:g.name,startDate:g.startDate,order:g.order},message:"Batch created."})},{role:"TUTOR"}));e.s(["GET",0,m,"POST",0,f]),r()}catch(e){r(e)}},!1),736934,e=>e.a(async(t,r)=>{try{var a=e.i(78315),i=e.i(586961),n=e.i(196657),s=e.i(899733),o=e.i(233979),u=e.i(631683),l=e.i(840960),c=e.i(711373),d=e.i(699699),p=e.i(521140),h=e.i(205260),m=e.i(500249),f=e.i(431740),w=e.i(82608),v=e.i(635207),R=e.i(193695);e.i(708038);var g=e.i(447430),y=e.i(163649),E=t([y]);[y]=E.then?(await E)():E;let C=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/tutor/courses/[id]/batches/route",pathname:"/api/tutor/courses/[id]/batches",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/courses/[id]/batches/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:_,workUnitAsyncStorage:A,serverHooks:D}=C;function b(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:A})}async function x(e,t,r){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/tutor/courses/[id]/batches/route";a=a.replace(/\/index$/,"")||"/";let n=await C.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:b,parsedUrl:x,isDraftMode:_,prerenderManifest:A,routerServerContext:D,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:N,clientReferenceManifest:q,serverActionsManifest:S}=n,O=(0,l.normalizeAppPath)(a),k=!!(A.dynamicRoutes[O]||A.routes[N]),I=async()=>((null==D?void 0:D.render404)?await D.render404(e,t,x,!1):t.end("This page could not be found"),null);if(k&&!_){let e=!!A.routes[N],t=A.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await I();throw new R.NoFallbackError}}let U=null;!k||C.isDev||_||(U=N,U="/index"===U?"/":U);let H=!0===C.isDev||!k,$=k&&!H;S&&q&&(0,u.setManifestsSingleton)({page:a,clientReferenceManifest:q,serverActionsManifest:S});let j=e.method||"GET",M=(0,o.getTracer)(),z=M.getActiveScopeSpan(),B={params:E,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>C.onRequestError(e,t,a,i,D)},sharedContext:{buildId:y}},W=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),F=d.NextRequestAdapter.fromNodeNextRequest(W,(0,d.signalFromNodeResponse)(t));try{let n=async e=>C.handle(F,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${a}`)}),u=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var o,l;let c=async({previousCacheEntry:i})=>{try{if(!u&&P&&T&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let o=B.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let l=B.renderOpts.collectedTags;if(!k)return await (0,m.sendResponse)(W,K,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[v.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,i=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:P})},!1,D),t}},d=await C.handleResponse({req:e,nextConfig:b,cacheKey:U,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:u});if(!k)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return u&&k||p.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(W,K,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};z?await l(z):await M.withPropagatedContext(e.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:P})},!1,D),k)throw t;return await (0,m.sendResponse)(W,K,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>b,"routeModule",()=>C,"serverHooks",()=>D,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>A]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=a9003b1c-5c20-f703-7aa6-e9cecca945de
//# sourceMappingURL=%5Broot-of-the-server%5D__f74778fe._.js.map