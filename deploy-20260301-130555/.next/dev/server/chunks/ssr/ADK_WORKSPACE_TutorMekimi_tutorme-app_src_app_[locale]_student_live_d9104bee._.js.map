{
  "version": 3,
  "sources": [],
  "debugId": "b9cb2ed4-2309-6e7d-bceb-ccd856924bcf",
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/student/live/components/StudentLiveWhiteboard.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useRef, useEffect, useCallback, useMemo } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport { Slider } from '@/components/ui/slider'\nimport {\n  Pencil,\n  Eraser,\n  EyeOff,\n  UserCheck,\n  Users,\n  Trash2,\n  Undo,\n  CheckCircle2,\n  Lock,\n  ChevronDown,\n  ChevronUp,\n  Palette,\n  Type,\n  Minus,\n  ArrowRight,\n  RectangleHorizontal,\n  Circle,\n  Triangle,\n  PenLine,\n  Highlighter,\n  Dot,\n  Move,\n  MousePointer2\n} from 'lucide-react'\nimport { useLiveClassWhiteboard, WhiteboardStroke } from '@/hooks/use-live-class-whiteboard'\nimport { cn } from '@/lib/utils'\nimport type { LiveSharedDocument } from '@/app/[locale]/tutor/live-class/components/LiveSharedDocumentModal'\n\ntype Tool =\n  | 'pencil'\n  | 'pen'\n  | 'marker'\n  | 'highlighter'\n  | 'calligraphy'\n  | 'eraser'\n  | 'line'\n  | 'arrow'\n  | 'rectangle'\n  | 'circle'\n  | 'triangle'\n  | 'connector'\n  | 'text'\n  | 'laser'\n  | 'hand'\n  | 'select'\n\ninterface StudentLiveWhiteboardProps {\n  roomId: string\n  sessionId: string\n  mode?: 'floating' | 'embedded'\n  visibleTaskShares?: LiveSharedDocument[]\n  onOpenTask?: (shareId: string) => void\n}\n\nconst COLORS = ['#111827', '#2563EB', '#7C3AED', '#059669', '#DC2626', '#EA580C', '#0891B2', '#CA8A04', '#6B7280']\n\nconst TOOL_PRESET: Record<Tool, { width: number; opacity: number; strokeType: WhiteboardStroke['type'] }> = {\n  pencil: { width: 2, opacity: 0.82, strokeType: 'pencil' },\n  pen: { width: 3, opacity: 1, strokeType: 'pen' },\n  marker: { width: 6, opacity: 0.9, strokeType: 'marker' },\n  highlighter: { width: 16, opacity: 0.22, strokeType: 'highlighter' },\n  calligraphy: { width: 5, opacity: 0.95, strokeType: 'calligraphy' },\n  eraser: { width: 24, opacity: 1, strokeType: 'eraser' },\n  line: { width: 3, opacity: 1, strokeType: 'shape' },\n  arrow: { width: 3, opacity: 1, strokeType: 'shape' },\n  rectangle: { width: 3, opacity: 1, strokeType: 'shape' },\n  circle: { width: 3, opacity: 1, strokeType: 'shape' },\n  triangle: { width: 3, opacity: 1, strokeType: 'shape' },\n  connector: { width: 3, opacity: 1, strokeType: 'shape' },\n  text: { width: 3, opacity: 1, strokeType: 'text' },\n  laser: { width: 3, opacity: 1, strokeType: 'pen' },\n  hand: { width: 3, opacity: 1, strokeType: 'pen' },\n  select: { width: 3, opacity: 1, strokeType: 'pen' },\n}\ntype DrawPoint = { x: number; y: number; pressure?: number }\ntype ViewportState = { scale: number; offsetX: number; offsetY: number }\ntype ConnectorPort = 'top' | 'right' | 'bottom' | 'left' | 'center'\ntype ConnectorDragState = { strokeId: string; endpoint: 'source' | 'target' } | null\n\nexport function StudentLiveWhiteboard({\n  roomId,\n  sessionId,\n  mode = 'floating',\n  visibleTaskShares = [],\n  onOpenTask,\n}: StudentLiveWhiteboardProps) {\n  const { data: session } = useSession()\n  const myUserId = session?.user?.id\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const [tool, setTool] = useState<Tool>('pen')\n  const [color, setColor] = useState('#111827')\n  const [customColor, setCustomColor] = useState('#111827')\n  const [brushSize, setBrushSize] = useState(3)\n  const [isDrawing, setIsDrawing] = useState(false)\n  const [currentStroke, setCurrentStroke] = useState<DrawPoint[]>([])\n  const [shapeStart, setShapeStart] = useState<DrawPoint | null>(null)\n  const [shapePreview, setShapePreview] = useState<DrawPoint | null>(null)\n  const [laserPoint, setLaserPoint] = useState<{ x: number; y: number } | null>(null)\n  const [textDraft, setTextDraft] = useState<{ x: number; y: number; value: string } | null>(null)\n  const [fontSize, setFontSize] = useState(20)\n  const [viewport, setViewport] = useState<ViewportState>({ scale: 1, offsetX: 0, offsetY: 0 })\n  const [isPanning, setIsPanning] = useState(false)\n  const panStartRef = useRef<{ x: number; y: number; offsetX: number; offsetY: number } | null>(null)\n  const [selectionRect, setSelectionRect] = useState<{ x: number; y: number; width: number; height: number } | null>(null)\n  const [selectedStrokeIds, setSelectedStrokeIds] = useState<Set<string>>(new Set())\n  const [selectionMode, setSelectionMode] = useState<'rect' | 'lasso'>('rect')\n  const [selectionHitMode, setSelectionHitMode] = useState<'intersect' | 'contain'>('intersect')\n  const [lassoPath, setLassoPath] = useState<Array<{ x: number; y: number }> | null>(null)\n  const [isDraggingSelection, setIsDraggingSelection] = useState(false)\n  const [activeTransformHandle, setActiveTransformHandle] = useState<'nw' | 'ne' | 'sw' | 'se' | null>(null)\n  const transformRef = useRef<{ centerX: number; centerY: number; startDist: number } | null>(null)\n  const [isRotatingSelection, setIsRotatingSelection] = useState(false)\n  const rotateRef = useRef<{ centerX: number; centerY: number; startAngle: number } | null>(null)\n  const [connectorDrag, setConnectorDrag] = useState<ConnectorDragState>(null)\n  const dragStartRef = useRef<DrawPoint | null>(null)\n  const selectionSnapshotRef = useRef<Map<string, DrawPoint[]>>(new Map())\n  const [isMinimized, setIsMinimized] = useState(false)\n  const [showTutorBoard, setShowTutorBoard] = useState(true)\n  const [stylusPriority, setStylusPriority] = useState(true)\n  const [highContrast, setHighContrast] = useState(false)\n  const [zoomPreset, setZoomPreset] = useState(1)\n  const [snapEnabled, setSnapEnabled] = useState(true)\n  const [gridVisible, setGridVisible] = useState(true)\n  const [gridSize, setGridSize] = useState(20)\n  const [followTutorCursor, setFollowTutorCursor] = useState(false)\n  const [textPreset, setTextPreset] = useState<'plain' | 'latex' | 'code' | 'table' | 'sticky'>('plain')\n  const [branchNameInput, setBranchNameInput] = useState('')\n  const [taskPanelOpen, setTaskPanelOpen] = useState(false)\n  const lastCursorEmitRef = useRef(0)\n  const lastPointerTypeRef = useRef<string>('mouse')\n  const shapeTools = useMemo(() => new Set<Tool>(['line', 'arrow', 'rectangle', 'circle', 'triangle', 'connector']), [])\n  const freeDrawTools = useMemo(() => new Set<Tool>(['pencil', 'pen', 'marker', 'highlighter', 'calligraphy', 'eraser']), [])\n  \n  const {\n    myStrokes,\n    tutorStrokes,\n    visibility,\n    isConnected,\n    remoteCursors,\n    remoteSelections,\n    isLayerLocked,\n    hasSubmitted,\n    addStroke,\n    changeVisibility,\n    submitMyBoard,\n    undoLastStroke,\n    updateCursor,\n    updateSelectionPresence,\n    clearOwnStrokes,\n    replaceMyStrokes,\n    assignmentOverlay,\n    spotlight,\n    activeLayerId,\n    setActiveLayerId,\n    availableBranches,\n    createBoardBranch,\n    switchBoardBranch\n  } = useLiveClassWhiteboard(roomId, sessionId, 'student')\n\n  const drawShape = useCallback(\n    (\n      ctx: CanvasRenderingContext2D,\n      shapeType: NonNullable<WhiteboardStroke['shapeType']>,\n      from: { x: number; y: number },\n      to: { x: number; y: number },\n      stroke: Pick<WhiteboardStroke, 'color' | 'width' | 'opacity'>\n    ) => {\n      const x = Math.min(from.x, to.x)\n      const y = Math.min(from.y, to.y)\n      const width = Math.abs(to.x - from.x)\n      const height = Math.abs(to.y - from.y)\n      ctx.save()\n      ctx.globalAlpha = stroke.opacity ?? 1\n      ctx.strokeStyle = stroke.color\n      ctx.lineWidth = stroke.width\n      ctx.lineCap = 'round'\n      ctx.lineJoin = 'round'\n      if (shapeType === 'line' || shapeType === 'arrow' || shapeType === 'connector') {\n        ctx.beginPath()\n        ctx.moveTo(from.x, from.y)\n        ctx.lineTo(to.x, to.y)\n        ctx.stroke()\n        if (shapeType === 'connector') {\n          ctx.beginPath()\n          ctx.arc(from.x, from.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n          ctx.arc(to.x, to.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n          ctx.fillStyle = stroke.color\n          ctx.fill()\n        }\n        if (shapeType === 'arrow') {\n          const angle = Math.atan2(to.y - from.y, to.x - from.x)\n          const size = Math.max(10, stroke.width * 4)\n          ctx.beginPath()\n          ctx.moveTo(to.x, to.y)\n          ctx.lineTo(to.x - size * Math.cos(angle - Math.PI / 6), to.y - size * Math.sin(angle - Math.PI / 6))\n          ctx.lineTo(to.x - size * Math.cos(angle + Math.PI / 6), to.y - size * Math.sin(angle + Math.PI / 6))\n          ctx.closePath()\n          ctx.fillStyle = stroke.color\n          ctx.fill()\n        }\n      } else if (shapeType === 'rectangle') {\n        ctx.strokeRect(x, y, width, height)\n      } else if (shapeType === 'circle') {\n        ctx.beginPath()\n        ctx.ellipse(x + width / 2, y + height / 2, Math.max(2, width / 2), Math.max(2, height / 2), 0, 0, Math.PI * 2)\n        ctx.stroke()\n      } else if (shapeType === 'triangle') {\n        ctx.beginPath()\n        ctx.moveTo(x + width / 2, y)\n        ctx.lineTo(x + width, y + height)\n        ctx.lineTo(x, y + height)\n        ctx.closePath()\n        ctx.stroke()\n      }\n      ctx.restore()\n    },\n    []\n  )\n\n  const drawStroke = useCallback((ctx: CanvasRenderingContext2D, stroke: WhiteboardStroke, alpha: number = 1) => {\n    if (stroke.type === 'text') {\n      const anchor = stroke.points[0]\n      if (!anchor || !stroke.text) return\n      ctx.save()\n      ctx.fillStyle = stroke.color\n      ctx.globalAlpha = (stroke.opacity ?? 1) * alpha\n      const textWeight = stroke.textStyle?.bold ? '700' : '400'\n      const textItalic = stroke.textStyle?.italic ? 'italic' : 'normal'\n      ctx.font = `${textItalic} ${textWeight} ${stroke.fontSize || fontSize}px ${stroke.fontFamily || 'Inter, Segoe UI, system-ui, sans-serif'}`\n      ctx.textBaseline = 'top'\n      ctx.textAlign = stroke.textStyle?.align || 'left'\n      ctx.fillText(stroke.text, anchor.x, anchor.y)\n      ctx.restore()\n      return\n    }\n\n    if (stroke.type === 'shape' && stroke.shapeType && stroke.points.length >= 2) {\n      if (stroke.shapeType === 'connector') {\n        ctx.save()\n        ctx.globalAlpha = (stroke.opacity ?? 1) * alpha\n        ctx.strokeStyle = stroke.color\n        ctx.lineWidth = stroke.width\n        ctx.lineJoin = 'round'\n        ctx.lineCap = 'round'\n        ctx.beginPath()\n        stroke.points.forEach((point, index) => {\n          if (index === 0) ctx.moveTo(point.x, point.y)\n          else ctx.lineTo(point.x, point.y)\n        })\n        ctx.stroke()\n        const first = stroke.points[0]\n        const last = stroke.points[stroke.points.length - 1]\n        ctx.beginPath()\n        ctx.arc(first.x, first.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n        ctx.arc(last.x, last.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n        ctx.fillStyle = stroke.color\n        ctx.fill()\n        ctx.restore()\n        return\n      }\n      drawShape(ctx, stroke.shapeType, stroke.points[0], stroke.points[stroke.points.length - 1], {\n        color: stroke.color,\n        width: stroke.width,\n        opacity: (stroke.opacity ?? 1) * alpha,\n      })\n      return\n    }\n\n    if (stroke.points.length < 2) return\n\n    ctx.save()\n    ctx.globalAlpha = (stroke.opacity ?? 1) * alpha\n    ctx.strokeStyle = stroke.color\n    ctx.lineCap = stroke.type === 'calligraphy' ? 'square' : 'round'\n    ctx.lineJoin = 'round'\n    for (let i = 1; i < stroke.points.length; i += 1) {\n      const prev = stroke.points[i - 1]\n      const point = stroke.points[i]\n      const pressure = typeof point.pressure === 'number' ? point.pressure : 0.5\n      ctx.lineWidth = Math.max(1, stroke.width * (0.55 + pressure * 0.9))\n      if (stroke.type === 'pencil') ctx.setLineDash([1, 1.5])\n      else ctx.setLineDash([])\n      ctx.beginPath()\n      ctx.moveTo(prev.x, prev.y)\n      ctx.lineTo(point.x, point.y)\n      ctx.stroke()\n    }\n    ctx.restore()\n  }, [drawShape, fontSize])\n\n  const getStrokeBounds = useCallback((stroke: WhiteboardStroke) => {\n    if (stroke.type === 'text') {\n      const anchor = stroke.points[0]\n      if (!anchor) return null\n      const width = Math.max(80, (stroke.text?.length || 0) * ((stroke.fontSize || fontSize) * 0.55))\n      const height = (stroke.fontSize || fontSize) * 1.4\n      return { x: anchor.x, y: anchor.y, width, height }\n    }\n    if (!stroke.points.length) return null\n    const xs = stroke.points.map((point) => point.x)\n    const ys = stroke.points.map((point) => point.y)\n    const minX = Math.min(...xs)\n    const minY = Math.min(...ys)\n    const maxX = Math.max(...xs)\n    const maxY = Math.max(...ys)\n    const pad = Math.max(8, stroke.width)\n    return { x: minX - pad, y: minY - pad, width: maxX - minX + pad * 2, height: maxY - minY + pad * 2 }\n  }, [fontSize])\n\n  const pointInPolygon = useCallback((point: { x: number; y: number }, polygon: Array<{ x: number; y: number }>) => {\n    let inside = false\n    for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n      const xi = polygon[i].x\n      const yi = polygon[i].y\n      const xj = polygon[j].x\n      const yj = polygon[j].y\n      const intersect = ((yi > point.y) !== (yj > point.y)) &&\n        point.x < ((xj - xi) * (point.y - yi)) / ((yj - yi) || 1e-6) + xi\n      if (intersect) inside = !inside\n    }\n    return inside\n  }, [])\n\n  const routeOrthogonalConnector = useCallback((from: DrawPoint, to: DrawPoint, obstacles: Array<{ x: number; y: number; width: number; height: number }>) => {\n    const pad = 18\n    const inflate = (b: { x: number; y: number; width: number; height: number }) => ({\n      x: b.x - pad,\n      y: b.y - pad,\n      width: b.width + pad * 2,\n      height: b.height + pad * 2,\n    })\n    const inflated = obstacles.map(inflate)\n    const segmentHitsRect = (a: DrawPoint, b: DrawPoint, r: { x: number; y: number; width: number; height: number }) => {\n      const minX = Math.min(a.x, b.x)\n      const maxX = Math.max(a.x, b.x)\n      const minY = Math.min(a.y, b.y)\n      const maxY = Math.max(a.y, b.y)\n      return maxX >= r.x && minX <= r.x + r.width && maxY >= r.y && minY <= r.y + r.height\n    }\n    const clearSegment = (a: DrawPoint, b: DrawPoint) => inflated.every((r) => !segmentHitsRect(a, b, r))\n    const bestL = (firstHorizontal: boolean) => {\n      const mid: DrawPoint = firstHorizontal ? { x: to.x, y: from.y } : { x: from.x, y: to.y }\n      return [from, mid, to]\n    }\n    const candidates: DrawPoint[][] = [\n      bestL(true),\n      bestL(false),\n      [from, { x: from.x, y: from.y - 80 }, { x: to.x, y: from.y - 80 }, to],\n      [from, { x: from.x, y: from.y + 80 }, { x: to.x, y: from.y + 80 }, to],\n      [from, { x: from.x - 80, y: from.y }, { x: from.x - 80, y: to.y }, to],\n      [from, { x: from.x + 80, y: from.y }, { x: from.x + 80, y: to.y }, to],\n    ]\n    const pathCost = (path: DrawPoint[]) =>\n      path.reduce((acc, point, i) => i === 0 ? 0 : acc + Math.abs(point.x - path[i - 1].x) + Math.abs(point.y - path[i - 1].y), 0)\n    const valid = candidates\n      .map((path) => ({\n        path,\n        ok: path.every((p, i) => i === 0 || clearSegment(path[i - 1], p)),\n        cost: pathCost(path),\n      }))\n      .filter((p) => p.ok)\n      .sort((a, b) => a.cost - b.cost)\n    return (valid[0]?.path || bestL(true)).map((p) => ({ x: p.x, y: p.y }))\n  }, [])\n\n  const getPortAnchors = useCallback((bounds: { x: number; y: number; width: number; height: number }) => ({\n    top: { x: bounds.x + bounds.width / 2, y: bounds.y },\n    right: { x: bounds.x + bounds.width, y: bounds.y + bounds.height / 2 },\n    bottom: { x: bounds.x + bounds.width / 2, y: bounds.y + bounds.height },\n    left: { x: bounds.x, y: bounds.y + bounds.height / 2 },\n    center: { x: bounds.x + bounds.width / 2, y: bounds.y + bounds.height / 2 },\n  }), [])\n\n  const closestPortForPoint = useCallback((point: DrawPoint, bounds: { x: number; y: number; width: number; height: number }) => {\n    const anchors = getPortAnchors(bounds)\n    let bestPort: ConnectorPort = 'center'\n    let best = anchors.center\n    let bestDist = Number.POSITIVE_INFINITY\n    ;(Object.keys(anchors) as ConnectorPort[]).forEach((port) => {\n      const candidate = anchors[port]\n      const dx = candidate.x - point.x\n      const dy = candidate.y - point.y\n      const dist = Math.sqrt(dx * dx + dy * dy)\n      if (dist < bestDist) {\n        bestDist = dist\n        bestPort = port\n        best = candidate\n      }\n    })\n    return { port: bestPort, anchor: best, distance: bestDist }\n  }, [getPortAnchors])\n\n  const resolveConnectorEndpoint = useCallback((point: DrawPoint, strokes: WhiteboardStroke[]) => {\n    let best: {\n      strokeId?: string\n      port?: ConnectorPort\n      anchor: DrawPoint\n      distance: number\n    } = {\n      anchor: point,\n      distance: Number.POSITIVE_INFINITY,\n    }\n    strokes\n      .filter((stroke) => stroke.shapeType !== 'connector')\n      .forEach((stroke) => {\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return\n        const candidate = closestPortForPoint(point, bounds)\n        if (candidate.distance < best.distance) {\n          best = {\n            strokeId: stroke.id,\n            port: candidate.port,\n            anchor: candidate.anchor,\n            distance: candidate.distance,\n          }\n        }\n      })\n    if (best.distance <= 56 && best.strokeId && best.port) {\n      return {\n        point: best.anchor,\n        sourceStrokeId: best.strokeId,\n        sourcePort: best.port,\n      }\n    }\n    return { point }\n  }, [closestPortForPoint, getStrokeBounds])\n\n  const getSelectedBounds = useCallback((selectedIds: Set<string>) => {\n    const selectedBounds = myStrokes\n      .filter((stroke) => selectedIds.has(stroke.id))\n      .map((stroke) => getStrokeBounds(stroke))\n      .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n    if (!selectedBounds.length) return null\n    const minX = Math.min(...selectedBounds.map((bounds) => bounds.x))\n    const minY = Math.min(...selectedBounds.map((bounds) => bounds.y))\n    const maxX = Math.max(...selectedBounds.map((bounds) => bounds.x + bounds.width))\n    const maxY = Math.max(...selectedBounds.map((bounds) => bounds.y + bounds.height))\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY }\n  }, [getStrokeBounds, myStrokes])\n\n  const nudgeSelection = useCallback((dx: number, dy: number) => {\n    if (isLayerLocked || selectedStrokeIds.size === 0) return\n    replaceMyStrokes((prev) =>\n      prev.map((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return stroke\n        return {\n          ...stroke,\n          points: stroke.points.map((point) => ({\n            ...point,\n            x: snapEnabled ? Math.round((point.x + dx) / gridSize) * gridSize : point.x + dx,\n            y: snapEnabled ? Math.round((point.y + dy) / gridSize) * gridSize : point.y + dy,\n          })),\n        }\n      }),\n    )\n  }, [gridSize, isLayerLocked, replaceMyStrokes, selectedStrokeIds, snapEnabled])\n\n  const scaleSelection = useCallback((factor: number) => {\n    if (isLayerLocked || selectedStrokeIds.size === 0) return\n    const bounds = getSelectedBounds(selectedStrokeIds)\n    if (!bounds) return\n    const centerX = bounds.x + bounds.width / 2\n    const centerY = bounds.y + bounds.height / 2\n    replaceMyStrokes((prev) =>\n      prev.map((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return stroke\n        return {\n          ...stroke,\n          points: stroke.points.map((point) => ({\n            ...point,\n            x: snapEnabled\n              ? Math.round((centerX + (point.x - centerX) * factor) / gridSize) * gridSize\n              : centerX + (point.x - centerX) * factor,\n            y: snapEnabled\n              ? Math.round((centerY + (point.y - centerY) * factor) / gridSize) * gridSize\n              : centerY + (point.y - centerY) * factor,\n          })),\n        }\n      }),\n    )\n  }, [getSelectedBounds, gridSize, isLayerLocked, replaceMyStrokes, selectedStrokeIds, snapEnabled])\n\n  const selectByAttribute = useCallback((attribute: 'color' | 'type' | 'layer') => {\n    const seed = myStrokes.find((stroke) => selectedStrokeIds.has(stroke.id))\n    if (!seed) return\n    const selected = new Set<string>()\n    myStrokes.forEach((stroke) => {\n      if (attribute === 'color' && stroke.color === seed.color) selected.add(stroke.id)\n      if (attribute === 'type' && stroke.type === seed.type) selected.add(stroke.id)\n      if (attribute === 'layer' && (stroke.layerId || 'student-personal') === (seed.layerId || 'student-personal')) selected.add(stroke.id)\n    })\n    setSelectedStrokeIds(selected)\n  }, [myStrokes, selectedStrokeIds])\n\n  const selectedBounds = useMemo(() => getSelectedBounds(selectedStrokeIds), [getSelectedBounds, selectedStrokeIds])\n  const activeSelectedConnector = useMemo(() => {\n    if (selectedStrokeIds.size !== 1) return null\n    const id = Array.from(selectedStrokeIds)[0]\n    const stroke = myStrokes.find((item) => item.id === id)\n    if (!stroke || stroke.shapeType !== 'connector' || stroke.points.length < 2) return null\n    return stroke\n  }, [myStrokes, selectedStrokeIds])\n\n  const getConnectorScreenEndpoints = useCallback((stroke: WhiteboardStroke, strokes: WhiteboardStroke[]) => {\n    let sourcePoint = stroke.points[0]\n    let targetPoint = stroke.points[stroke.points.length - 1]\n    if (stroke.sourceStrokeId && stroke.sourcePort) {\n      const sourceStroke = strokes.find((item) => item.id === stroke.sourceStrokeId)\n      const bounds = sourceStroke ? getStrokeBounds(sourceStroke) : null\n      if (bounds) sourcePoint = getPortAnchors(bounds)[stroke.sourcePort]\n    }\n    if (stroke.targetStrokeId && stroke.targetPort) {\n      const targetStroke = strokes.find((item) => item.id === stroke.targetStrokeId)\n      const bounds = targetStroke ? getStrokeBounds(targetStroke) : null\n      if (bounds) targetPoint = getPortAnchors(bounds)[stroke.targetPort]\n    }\n    return {\n      source: {\n        x: sourcePoint.x * viewport.scale + viewport.offsetX,\n        y: sourcePoint.y * viewport.scale + viewport.offsetY,\n      },\n      target: {\n        x: targetPoint.x * viewport.scale + viewport.offsetX,\n        y: targetPoint.y * viewport.scale + viewport.offsetY,\n      },\n    }\n  }, [getPortAnchors, getStrokeBounds, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const hitTestConnectorEndpointHandle = useCallback((screenX: number, screenY: number) => {\n    if (!activeSelectedConnector) return null\n    const endpoints = getConnectorScreenEndpoints(activeSelectedConnector, myStrokes)\n    const radius = 10\n    const sourceDist = Math.hypot(screenX - endpoints.source.x, screenY - endpoints.source.y)\n    if (sourceDist <= radius) return { strokeId: activeSelectedConnector.id, endpoint: 'source' as const }\n    const targetDist = Math.hypot(screenX - endpoints.target.x, screenY - endpoints.target.y)\n    if (targetDist <= radius) return { strokeId: activeSelectedConnector.id, endpoint: 'target' as const }\n    return null\n  }, [activeSelectedConnector, getConnectorScreenEndpoints, myStrokes])\n\n  useEffect(() => {\n    updateSelectionPresence(Array.from(selectedStrokeIds), undefined, '#f59e0b')\n  }, [selectedStrokeIds, updateSelectionPresence])\n\n  useEffect(() => {\n    replaceMyStrokes((prev) => {\n      const byId = new Map(prev.map((stroke) => [stroke.id, stroke]))\n      const obstacles = prev\n        .filter((stroke) => stroke.shapeType !== 'connector')\n        .map((stroke) => getStrokeBounds(stroke))\n        .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n      let changed = false\n      const next: WhiteboardStroke[] = []\n      prev.forEach((stroke) => {\n        if (stroke.shapeType !== 'connector') {\n          next.push(stroke)\n          return\n        }\n        if (!stroke.sourceStrokeId || !stroke.targetStrokeId || !stroke.sourcePort || !stroke.targetPort) {\n          next.push(stroke)\n          return\n        }\n        const source = byId.get(stroke.sourceStrokeId)\n        const target = byId.get(stroke.targetStrokeId)\n        if (!source || !target) {\n          changed = true\n          return\n        }\n        const sourceBounds = getStrokeBounds(source)\n        const targetBounds = getStrokeBounds(target)\n        if (!sourceBounds || !targetBounds) {\n          next.push(stroke)\n          return\n        }\n        const from = getPortAnchors(sourceBounds)[stroke.sourcePort]\n        const to = getPortAnchors(targetBounds)[stroke.targetPort]\n        const rerouted = routeOrthogonalConnector(from, to, obstacles)\n        const same =\n          stroke.points.length === rerouted.length &&\n          stroke.points.every((point, index) => {\n            const nextPoint = rerouted[index]\n            return Math.abs(point.x - nextPoint.x) < 0.5 && Math.abs(point.y - nextPoint.y) < 0.5\n          })\n        if (same) {\n          next.push(stroke)\n          return\n        }\n        changed = true\n        next.push({\n          ...stroke,\n          points: rerouted,\n          updatedAt: Date.now(),\n        })\n      })\n      return changed ? next : prev\n    })\n  }, [getPortAnchors, getStrokeBounds, myStrokes, replaceMyStrokes, routeOrthogonalConnector])\n\n  const hitTestSelectionHandle = useCallback((screenX: number, screenY: number) => {\n    if (!selectedBounds) return null\n    const corners: Array<{ id: 'nw' | 'ne' | 'sw' | 'se'; x: number; y: number }> = [\n      { id: 'nw', x: selectedBounds.x, y: selectedBounds.y },\n      { id: 'ne', x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y },\n      { id: 'sw', x: selectedBounds.x, y: selectedBounds.y + selectedBounds.height },\n      { id: 'se', x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y + selectedBounds.height },\n    ]\n    const radius = 10\n    for (const corner of corners) {\n      const px = corner.x * viewport.scale + viewport.offsetX\n      const py = corner.y * viewport.scale + viewport.offsetY\n      const dx = screenX - px\n      const dy = screenY - py\n      if (Math.sqrt(dx * dx + dy * dy) <= radius) return corner.id\n    }\n    const rotateScreen = {\n      x: (selectedBounds.x + selectedBounds.width / 2) * viewport.scale + viewport.offsetX,\n      y: (selectedBounds.y - 36) * viewport.scale + viewport.offsetY,\n    }\n    const rdx = screenX - rotateScreen.x\n    const rdy = screenY - rotateScreen.y\n    if (Math.sqrt(rdx * rdx + rdy * rdy) <= 11) return 'rotate'\n    return null\n  }, [selectedBounds, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const redrawCanvas = useCallback(() => {\n    const canvas = canvasRef.current\n    const ctx = canvas?.getContext('2d')\n    if (!canvas || !ctx) return\n    \n    // Clear canvas\n    ctx.fillStyle = '#ffffff'\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    if (gridVisible) {\n      ctx.save()\n      ctx.strokeStyle = 'rgba(148, 163, 184, 0.18)'\n      ctx.lineWidth = 1\n      for (let x = 0; x < canvas.width; x += gridSize) {\n        ctx.beginPath()\n        ctx.moveTo(x, 0)\n        ctx.lineTo(x, canvas.height)\n        ctx.stroke()\n      }\n      for (let y = 0; y < canvas.height; y += gridSize) {\n        ctx.beginPath()\n        ctx.moveTo(0, y)\n        ctx.lineTo(canvas.width, y)\n        ctx.stroke()\n      }\n      ctx.restore()\n    }\n    ctx.save()\n    ctx.translate(viewport.offsetX, viewport.offsetY)\n    ctx.scale(viewport.scale, viewport.scale)\n    const worldViewport = {\n      left: (-viewport.offsetX) / viewport.scale,\n      top: (-viewport.offsetY) / viewport.scale,\n      right: (canvas.width - viewport.offsetX) / viewport.scale,\n      bottom: (canvas.height - viewport.offsetY) / viewport.scale,\n    }\n    const isBoundsVisible = (bounds: { x: number; y: number; width: number; height: number } | null) => {\n      if (!bounds) return true\n      return (\n        bounds.x <= worldViewport.right &&\n        bounds.x + bounds.width >= worldViewport.left &&\n        bounds.y <= worldViewport.bottom &&\n        bounds.y + bounds.height >= worldViewport.top\n      )\n    }\n\n    // Draw tutor's strokes first (bottom layer)\n    if (showTutorBoard) {\n      tutorStrokes.forEach(stroke => {\n        const bounds = getStrokeBounds(stroke)\n        if (!isBoundsVisible(bounds)) return\n        drawStroke(ctx, stroke, 0.5)\n      })\n    }\n    \n    // Draw student's strokes on top\n    myStrokes.forEach(stroke => {\n      const bounds = getStrokeBounds(stroke)\n      if (!isBoundsVisible(bounds)) return\n      drawStroke(ctx, stroke, 1)\n      if (selectedStrokeIds.has(stroke.id)) {\n        if (bounds) {\n          ctx.save()\n          ctx.strokeStyle = '#2563eb'\n          ctx.setLineDash([6, 4])\n          ctx.lineWidth = 1.5 / Math.max(0.4, viewport.scale)\n          ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height)\n          ctx.restore()\n        }\n      }\n    })\n    remoteSelections.forEach((presence) => {\n      presence.strokeIds.forEach((id) => {\n        const stroke = myStrokes.find((entry) => entry.id === id) || tutorStrokes.find((entry) => entry.id === id)\n        if (!stroke) return\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds || !isBoundsVisible(bounds)) return\n        ctx.save()\n        ctx.strokeStyle = presence.color || '#f59e0b'\n        ctx.setLineDash([4, 4])\n        ctx.lineWidth = 1.25 / Math.max(0.4, viewport.scale)\n        ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height)\n        ctx.restore()\n      })\n    })\n    if (isDrawing && currentStroke.length > 1 && freeDrawTools.has(tool)) {\n      const previewStroke: WhiteboardStroke = {\n        id: 'preview',\n        points: currentStroke,\n        color: tool === 'eraser' ? '#ffffff' : color,\n        width: tool === 'eraser' ? TOOL_PRESET.eraser.width : brushSize,\n        opacity: TOOL_PRESET[tool].opacity,\n        type: TOOL_PRESET[tool].strokeType,\n        userId: 'preview',\n      }\n      drawStroke(ctx, previewStroke, 1)\n    }\n    if (shapeStart && shapePreview && shapeTools.has(tool)) {\n      const preset = TOOL_PRESET[tool]\n      drawShape(ctx, tool as NonNullable<WhiteboardStroke['shapeType']>, shapeStart, shapePreview, {\n        color,\n        width: Math.max(1, brushSize),\n        opacity: preset.opacity,\n      })\n    }\n    if (laserPoint) {\n      ctx.save()\n      ctx.globalAlpha = 0.9\n      const gradient = ctx.createRadialGradient(laserPoint.x, laserPoint.y, 1, laserPoint.x, laserPoint.y, 28)\n      gradient.addColorStop(0, 'rgba(239,68,68,0.95)')\n      gradient.addColorStop(1, 'rgba(239,68,68,0)')\n      ctx.fillStyle = gradient\n      ctx.beginPath()\n      ctx.arc(laserPoint.x, laserPoint.y, 28, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.restore()\n    }\n    ctx.restore()\n    if (selectionRect) {\n      ctx.save()\n      ctx.strokeStyle = '#2563eb'\n      ctx.fillStyle = 'rgba(37, 99, 235, 0.08)'\n      ctx.setLineDash([6, 3])\n      const x = Math.min(selectionRect.x, selectionRect.x + selectionRect.width)\n      const y = Math.min(selectionRect.y, selectionRect.y + selectionRect.height)\n      const width = Math.abs(selectionRect.width)\n      const height = Math.abs(selectionRect.height)\n      ctx.strokeRect(x, y, width, height)\n      ctx.fillRect(x, y, width, height)\n      ctx.restore()\n    }\n    if (lassoPath && lassoPath.length > 1) {\n      ctx.save()\n      ctx.strokeStyle = '#2563eb'\n      ctx.fillStyle = 'rgba(37, 99, 235, 0.08)'\n      ctx.setLineDash([6, 3])\n      ctx.beginPath()\n      lassoPath.forEach((point, index) => {\n        const screen = {\n          x: point.x * viewport.scale + viewport.offsetX,\n          y: point.y * viewport.scale + viewport.offsetY,\n        }\n        if (index === 0) ctx.moveTo(screen.x, screen.y)\n        else ctx.lineTo(screen.x, screen.y)\n      })\n      ctx.closePath()\n      ctx.stroke()\n      ctx.fill()\n      ctx.restore()\n    }\n    if (selectedBounds) {\n      const corners: Array<{ x: number; y: number }> = [\n        { x: selectedBounds.x, y: selectedBounds.y },\n        { x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y },\n        { x: selectedBounds.x, y: selectedBounds.y + selectedBounds.height },\n        { x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y + selectedBounds.height },\n      ]\n      ctx.save()\n      ctx.fillStyle = '#2563eb'\n      corners.forEach((corner) => {\n        const sx = corner.x * viewport.scale + viewport.offsetX\n        const sy = corner.y * viewport.scale + viewport.offsetY\n        ctx.beginPath()\n        ctx.arc(sx, sy, 5, 0, Math.PI * 2)\n        ctx.fill()\n      })\n      const centerX = (selectedBounds.x + selectedBounds.width / 2) * viewport.scale + viewport.offsetX\n      const topY = selectedBounds.y * viewport.scale + viewport.offsetY\n      const rotateY = (selectedBounds.y - 36) * viewport.scale + viewport.offsetY\n      ctx.strokeStyle = '#2563eb'\n      ctx.beginPath()\n      ctx.moveTo(centerX, topY)\n      ctx.lineTo(centerX, rotateY + 8)\n      ctx.stroke()\n      ctx.beginPath()\n      ctx.arc(centerX, rotateY, 6, 0, Math.PI * 2)\n      ctx.fillStyle = '#0ea5e9'\n      ctx.fill()\n      ctx.restore()\n    }\n    if (activeSelectedConnector) {\n      const endpoints = getConnectorScreenEndpoints(activeSelectedConnector, myStrokes)\n      ctx.save()\n      ctx.fillStyle = '#0ea5e9'\n      ctx.strokeStyle = '#0369a1'\n      ctx.lineWidth = 2\n      ctx.beginPath()\n      ctx.arc(endpoints.source.x, endpoints.source.y, 7, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.stroke()\n      ctx.fillStyle = '#22c55e'\n      ctx.strokeStyle = '#15803d'\n      ctx.beginPath()\n      ctx.arc(endpoints.target.x, endpoints.target.y, 7, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.stroke()\n      ctx.restore()\n    }\n  }, [activeSelectedConnector, brushSize, color, currentStroke, drawShape, drawStroke, freeDrawTools, getConnectorScreenEndpoints, getStrokeBounds, gridSize, gridVisible, isDrawing, lassoPath, laserPoint, myStrokes, remoteSelections, selectedBounds, selectedStrokeIds, selectionRect, shapePreview, shapeStart, shapeTools, showTutorBoard, tool, tutorStrokes, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const getOverlayBackground = useCallback(() => {\n    switch (assignmentOverlay) {\n      case 'graph-paper':\n        return 'linear-gradient(to right, rgba(59,130,246,0.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(59,130,246,0.15) 1px, transparent 1px)'\n      case 'geometry-grid':\n        return 'linear-gradient(45deg, rgba(16,185,129,0.16) 1px, transparent 1px), linear-gradient(-45deg, rgba(16,185,129,0.16) 1px, transparent 1px)'\n      case 'coordinate-plane':\n        return 'linear-gradient(to right, rgba(107,114,128,0.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(107,114,128,0.15) 1px, transparent 1px), linear-gradient(to right, transparent calc(50% - 1px), rgba(239,68,68,0.35) calc(50% - 1px), rgba(239,68,68,0.35) calc(50% + 1px), transparent calc(50% + 1px)), linear-gradient(to bottom, transparent calc(50% - 1px), rgba(239,68,68,0.35) calc(50% - 1px), rgba(239,68,68,0.35) calc(50% + 1px), transparent calc(50% + 1px))'\n      case 'chemistry-structure':\n        return 'radial-gradient(circle at 20px 20px, rgba(245,158,11,0.18) 2px, transparent 2px), radial-gradient(circle at 60px 40px, rgba(245,158,11,0.18) 2px, transparent 2px), radial-gradient(circle at 100px 20px, rgba(245,158,11,0.18) 2px, transparent 2px)'\n      default:\n        return 'none'\n    }\n  }, [assignmentOverlay])\n  \n  // Canvas setup\n  useEffect(() => {\n    const canvas = canvasRef.current\n    const container = containerRef.current\n    if (!canvas || !container) return\n    \n    const resizeCanvas = () => {\n      canvas.width = container.clientWidth\n      canvas.height = container.clientHeight\n      redrawCanvas()\n    }\n    \n    resizeCanvas()\n    window.addEventListener('resize', resizeCanvas)\n    return () => window.removeEventListener('resize', resizeCanvas)\n  }, [redrawCanvas])\n  \n  // Redraw canvas when strokes change\n  useEffect(() => {\n    redrawCanvas()\n  }, [redrawCanvas])\n  \n  const getCanvasPoint = (e: React.PointerEvent<HTMLCanvasElement>): DrawPoint => {\n    const canvas = canvasRef.current\n    if (!canvas) return { x: 0, y: 0 }\n    const rect = canvas.getBoundingClientRect()\n    const screenX = e.clientX - rect.left\n    const screenY = e.clientY - rect.top\n    return {\n      x: (screenX - viewport.offsetX) / viewport.scale,\n      y: (screenY - viewport.offsetY) / viewport.scale,\n      pressure: e.pointerType === 'mouse' ? 0.5 : (e.pressure || 0.5),\n    }\n  }\n\n  const pointerToScreen = useCallback((point: DrawPoint) => ({\n    x: point.x * viewport.scale + viewport.offsetX,\n    y: point.y * viewport.scale + viewport.offsetY,\n  }), [viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const commitTextDraft = useCallback(() => {\n    if (!textDraft || !textDraft.value.trim()) {\n      setTextDraft(null)\n      return\n    }\n    const value = textDraft.value.trim()\n    const formattedText =\n      textPreset === 'latex' ? `$$${value}$$` :\n      textPreset === 'code' ? `\\`\\`\\`\\n${value}\\n\\`\\`\\`` :\n      textPreset === 'table' ? `| Column A | Column B |\\n|---|---|\\n| ${value} |  |` :\n      value\n    const stroke: WhiteboardStroke = {\n      id: Date.now().toString(),\n      points: [{ x: textDraft.x, y: textDraft.y }],\n      color,\n      width: 1,\n      opacity: 1,\n      type: 'text',\n      text: formattedText,\n      fontSize,\n      fontFamily: 'Inter, Segoe UI, system-ui, sans-serif',\n      userId: myUserId || 'student',\n      layerId: activeLayerId,\n    }\n    addStroke(stroke)\n    setTextDraft(null)\n  }, [activeLayerId, addStroke, color, fontSize, myUserId, textDraft, textPreset])\n  \n  const handlePointerDown = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    lastPointerTypeRef.current = e.pointerType\n    if (isLayerLocked) return\n    if (stylusPriority && lastPointerTypeRef.current === 'touch') return\n    e.currentTarget.setPointerCapture(e.pointerId)\n    const point = getCanvasPoint(e)\n    const screenPoint = pointerToScreen(point)\n    if (tool === 'hand') {\n      setIsPanning(true)\n      panStartRef.current = {\n        x: e.clientX,\n        y: e.clientY,\n        offsetX: viewport.offsetX,\n        offsetY: viewport.offsetY,\n      }\n      return\n    }\n    if (tool === 'select') {\n      const connectorHandle = hitTestConnectorEndpointHandle(screenPoint.x, screenPoint.y)\n      if (connectorHandle) {\n        setConnectorDrag(connectorHandle)\n        return\n      }\n      if (e.altKey) {\n        const hitStroke = [...myStrokes].reverse().find((stroke) => {\n          const bounds = getStrokeBounds(stroke)\n          if (!bounds) return false\n          return point.x >= bounds.x && point.x <= bounds.x + bounds.width && point.y >= bounds.y && point.y <= bounds.y + bounds.height\n        })\n        if (hitStroke) {\n          setSelectedStrokeIds((prev) => {\n            const next = new Set(prev)\n            if (next.has(hitStroke.id)) next.delete(hitStroke.id)\n            else next.add(hitStroke.id)\n            return next\n          })\n        }\n        return\n      }\n      const handle = hitTestSelectionHandle(screenPoint.x, screenPoint.y)\n      if (handle && selectedBounds) {\n        const centerX = selectedBounds.x + selectedBounds.width / 2\n        const centerY = selectedBounds.y + selectedBounds.height / 2\n        selectionSnapshotRef.current = new Map(\n          myStrokes\n            .filter((stroke) => selectedStrokeIds.has(stroke.id))\n            .map((stroke) => [stroke.id, stroke.points.map((p) => ({ ...p }))]),\n        )\n        if (handle === 'rotate') {\n          rotateRef.current = { centerX, centerY, startAngle: Math.atan2(point.y - centerY, point.x - centerX) }\n          setIsRotatingSelection(true)\n        } else {\n          const startDist = Math.max(1, Math.hypot(point.x - centerX, point.y - centerY))\n          transformRef.current = { centerX, centerY, startDist }\n          setActiveTransformHandle(handle)\n        }\n        return\n      }\n      const hitSelectedStroke = myStrokes.some((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return false\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return false\n        return (\n          point.x >= bounds.x &&\n          point.x <= bounds.x + bounds.width &&\n          point.y >= bounds.y &&\n          point.y <= bounds.y + bounds.height\n        )\n      })\n      if (hitSelectedStroke) {\n        const snapshot = new Map<string, DrawPoint[]>()\n        myStrokes.forEach((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return\n          snapshot.set(stroke.id, stroke.points.map((p) => ({ ...p })))\n        })\n        selectionSnapshotRef.current = snapshot\n        dragStartRef.current = point\n        setIsDraggingSelection(true)\n      } else if (selectionMode === 'lasso') {\n        setLassoPath([point])\n        setSelectionRect(null)\n      } else {\n        setSelectionRect({ x: screenPoint.x, y: screenPoint.y, width: 0, height: 0 })\n        setLassoPath(null)\n      }\n      return\n    }\n    if (tool === 'text') {\n      setTextDraft({ x: point.x, y: point.y, value: '' })\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(point)\n      updateCursor(point.x, point.y, 'laser')\n      return\n    }\n    if (shapeTools.has(tool)) {\n      setIsDrawing(true)\n      setShapeStart(point)\n      setShapePreview(point)\n      return\n    }\n    if (!freeDrawTools.has(tool)) return\n    setIsDrawing(true)\n    setCurrentStroke([point])\n    updateCursor(point.x, point.y)\n  }\n  \n  const handlePointerMove = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    if (isPanning && panStartRef.current) {\n      const deltaX = e.clientX - panStartRef.current.x\n      const deltaY = e.clientY - panStartRef.current.y\n      setViewport((prev) => ({\n        ...prev,\n        offsetX: panStartRef.current!.offsetX + deltaX,\n        offsetY: panStartRef.current!.offsetY + deltaY,\n      }))\n      return\n    }\n    const point = getCanvasPoint(e)\n    const now = Date.now()\n    if (now - lastCursorEmitRef.current > 50) {\n      updateCursor(point.x, point.y, tool === 'laser' ? 'laser' : 'cursor')\n      lastCursorEmitRef.current = now\n    }\n    if (connectorDrag) {\n      replaceMyStrokes((prev) => {\n        const obstacles = prev\n          .filter((stroke) => stroke.shapeType !== 'connector')\n          .map((stroke) => getStrokeBounds(stroke))\n          .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n        const peers = prev.filter((stroke) => stroke.id !== connectorDrag.strokeId)\n        return prev.map((stroke) => {\n          if (stroke.id !== connectorDrag.strokeId || stroke.shapeType !== 'connector') return stroke\n          const resolved = resolveConnectorEndpoint(point, peers)\n          const from = connectorDrag.endpoint === 'source' ? resolved.point : stroke.points[0]\n          const to = connectorDrag.endpoint === 'target' ? resolved.point : stroke.points[stroke.points.length - 1]\n          return {\n            ...stroke,\n            points: routeOrthogonalConnector(from, to, obstacles),\n            sourceStrokeId: connectorDrag.endpoint === 'source' ? resolved.sourceStrokeId : stroke.sourceStrokeId,\n            sourcePort: connectorDrag.endpoint === 'source' ? resolved.sourcePort : stroke.sourcePort,\n            targetStrokeId: connectorDrag.endpoint === 'target' ? resolved.sourceStrokeId : stroke.targetStrokeId,\n            targetPort: connectorDrag.endpoint === 'target' ? resolved.sourcePort : stroke.targetPort,\n            updatedAt: Date.now(),\n          }\n        })\n      })\n      return\n    }\n    if (isRotatingSelection && rotateRef.current) {\n      const { centerX, centerY, startAngle } = rotateRef.current\n      const currentAngle = Math.atan2(point.y - centerY, point.x - centerX)\n      const delta = currentAngle - startAngle\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            rotation: ((stroke.rotation || 0) + (delta * 180) / Math.PI) % 360,\n            updatedAt: Date.now(),\n            points: base.map((p) => {\n              const dx = p.x - centerX\n              const dy = p.y - centerY\n              return {\n                ...p,\n                x: centerX + dx * Math.cos(delta) - dy * Math.sin(delta),\n                y: centerY + dx * Math.sin(delta) + dy * Math.cos(delta),\n              }\n            }),\n          }\n        }),\n      )\n      return\n    }\n    if (activeTransformHandle && transformRef.current) {\n      const { centerX, centerY, startDist } = transformRef.current\n      const currentDist = Math.max(1, Math.hypot(point.x - centerX, point.y - centerY))\n      const factor = currentDist / startDist\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            points: base.map((p) => ({\n              ...p,\n              x: snapEnabled\n                ? Math.round((centerX + (p.x - centerX) * factor) / gridSize) * gridSize\n                : centerX + (p.x - centerX) * factor,\n              y: snapEnabled\n                ? Math.round((centerY + (p.y - centerY) * factor) / gridSize) * gridSize\n                : centerY + (p.y - centerY) * factor,\n            })),\n          }\n        }),\n      )\n      return\n    }\n    if (isDraggingSelection && dragStartRef.current) {\n      const dx = point.x - dragStartRef.current.x\n      const dy = point.y - dragStartRef.current.y\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            points: base.map((p) => ({\n              ...p,\n              x: snapEnabled ? Math.round((p.x + dx) / gridSize) * gridSize : p.x + dx,\n              y: snapEnabled ? Math.round((p.y + dy) / gridSize) * gridSize : p.y + dy,\n            })),\n          }\n        }),\n      )\n      return\n    }\n    if (selectionRect) {\n      const screen = pointerToScreen(point)\n      setSelectionRect((prev) => prev ? { ...prev, width: screen.x - prev.x, height: screen.y - prev.y } : prev)\n      return\n    }\n    if (lassoPath) {\n      setLassoPath((prev) => (prev ? [...prev, point] : prev))\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(point)\n      return\n    }\n    if (!isDrawing) return\n    if (shapeTools.has(tool)) {\n      setShapePreview(point)\n      return\n    }\n    setCurrentStroke((prev) => {\n      const last = prev[prev.length - 1]\n      if (last) {\n        const dx = point.x - last.x\n        const dy = point.y - last.y\n        if (dx * dx + dy * dy < 0.7) return prev\n      }\n      return [...prev, point]\n    })\n  }\n  \n  const handlePointerUp = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    e.currentTarget.releasePointerCapture(e.pointerId)\n    if (isPanning) {\n      setIsPanning(false)\n      panStartRef.current = null\n      return\n    }\n    if (connectorDrag) {\n      setConnectorDrag(null)\n      return\n    }\n    if (selectionRect) {\n      const x = Math.min(selectionRect.x, selectionRect.x + selectionRect.width)\n      const y = Math.min(selectionRect.y, selectionRect.y + selectionRect.height)\n      const width = Math.abs(selectionRect.width)\n      const height = Math.abs(selectionRect.height)\n      const selected = new Set<string>()\n      myStrokes.forEach((stroke) => {\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return\n        const topLeft = pointerToScreen({ x: bounds.x, y: bounds.y })\n        const bottomRight = pointerToScreen({ x: bounds.x + bounds.width, y: bounds.y + bounds.height })\n        const intersects = topLeft.x < x + width && bottomRight.x > x && topLeft.y < y + height && bottomRight.y > y\n        const contains = topLeft.x >= x && bottomRight.x <= x + width && topLeft.y >= y && bottomRight.y <= y + height\n        if ((selectionHitMode === 'intersect' && intersects) || (selectionHitMode === 'contain' && contains)) {\n          selected.add(stroke.id)\n        }\n      })\n      setSelectedStrokeIds(selected)\n      setSelectionRect(null)\n      return\n    }\n    if (lassoPath && lassoPath.length > 2) {\n      const selected = new Set<string>()\n      myStrokes.forEach((stroke) => {\n        if (stroke.points.some((p) => pointInPolygon({ x: p.x, y: p.y }, lassoPath))) {\n          selected.add(stroke.id)\n        }\n      })\n      setSelectedStrokeIds(selected)\n      setLassoPath(null)\n      return\n    }\n    if (isRotatingSelection) {\n      setIsRotatingSelection(false)\n      rotateRef.current = null\n      selectionSnapshotRef.current.clear()\n      return\n    }\n    if (activeTransformHandle) {\n      setActiveTransformHandle(null)\n      transformRef.current = null\n      selectionSnapshotRef.current.clear()\n      return\n    }\n    if (isDraggingSelection) {\n      setIsDraggingSelection(false)\n      dragStartRef.current = null\n      selectionSnapshotRef.current.clear()\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(null)\n      return\n    }\n    if (!isDrawing) return\n\n    if (shapeTools.has(tool) && shapeStart && shapePreview) {\n      const preset = TOOL_PRESET[tool]\n      const fromResolved = tool === 'connector' ? resolveConnectorEndpoint(shapeStart, myStrokes) : { point: shapeStart }\n      const toResolved = tool === 'connector' ? resolveConnectorEndpoint(shapePreview, myStrokes) : { point: shapePreview }\n      const fromPoint = fromResolved.point\n      const toPoint = toResolved.point\n      const connectorPoints = tool === 'connector'\n        ? routeOrthogonalConnector(\n            fromPoint,\n            toPoint,\n            myStrokes\n              .filter((stroke) => stroke.shapeType !== 'connector')\n              .map((stroke) => getStrokeBounds(stroke))\n              .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds)),\n          )\n        : [fromPoint, toPoint]\n      const stroke: WhiteboardStroke = {\n        id: Date.now().toString(),\n        points: connectorPoints,\n        color,\n        width: Math.max(1, brushSize),\n        opacity: preset.opacity,\n        shapeType: tool as NonNullable<WhiteboardStroke['shapeType']>,\n        type: 'shape',\n        userId: myUserId || 'student',\n        layerId: activeLayerId,\n        sourceStrokeId: tool === 'connector' ? fromResolved.sourceStrokeId : undefined,\n        targetStrokeId: tool === 'connector' ? toResolved.sourceStrokeId : undefined,\n        sourcePort: tool === 'connector' ? fromResolved.sourcePort : undefined,\n        targetPort: tool === 'connector' ? toResolved.sourcePort : undefined,\n      }\n      addStroke(stroke)\n      setShapeStart(null)\n      setShapePreview(null)\n      setIsDrawing(false)\n      return\n    }\n\n    if (currentStroke.length === 0) {\n      setIsDrawing(false)\n      return\n    }\n\n    const preset = TOOL_PRESET[tool]\n    const stroke: WhiteboardStroke = {\n      id: Date.now().toString(),\n      points: currentStroke,\n      color: tool === 'eraser' ? '#ffffff' : color,\n      width: tool === 'eraser' ? preset.width : brushSize,\n      opacity: preset.opacity,\n      type: preset.strokeType,\n      userId: myUserId || 'student',\n      layerId: activeLayerId\n    }\n    addStroke(stroke)\n    setIsDrawing(false)\n    setCurrentStroke([])\n  }\n\n  const handleWheel = useCallback((e: React.WheelEvent<HTMLCanvasElement>) => {\n    e.preventDefault()\n    const zoomFactor = e.deltaY < 0 ? 1.08 : 0.92\n    const nextScale = Math.min(3, Math.max(0.35, viewport.scale * zoomFactor))\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const rect = canvas.getBoundingClientRect()\n    const cursorX = e.clientX - rect.left\n    const cursorY = e.clientY - rect.top\n    const worldX = (cursorX - viewport.offsetX) / viewport.scale\n    const worldY = (cursorY - viewport.offsetY) / viewport.scale\n    setViewport({\n      scale: nextScale,\n      offsetX: cursorX - worldX * nextScale,\n      offsetY: cursorY - worldY * nextScale,\n    })\n  }, [viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  useEffect(() => {\n    if (!followTutorCursor) return\n    const tutorCursor = Array.from(remoteCursors.values()).find((cursor) => cursor.role === 'tutor')\n    if (!tutorCursor) return\n    setViewport((prev) => ({\n      ...prev,\n      offsetX: (canvasRef.current?.width || 0) / 2 - tutorCursor.x * prev.scale,\n      offsetY: (canvasRef.current?.height || 0) / 2 - tutorCursor.y * prev.scale,\n    }))\n  }, [followTutorCursor, remoteCursors])\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if ((event.target as HTMLElement)?.tagName === 'INPUT' || (event.target as HTMLElement)?.tagName === 'TEXTAREA') return\n      const step = event.shiftKey ? 20 : 6\n      const key = event.key.toLowerCase()\n      if (key === 'v') setTool('select')\n      if (key === 'p') setTool('pen')\n      if (key === 'e') setTool('eraser')\n      if (key === 't') setTool('text')\n      if (key === 'l') setTool('laser')\n      if (key === 'h') setTool('hand')\n      if (selectedStrokeIds.size > 0) {\n        if (event.key === 'ArrowUp') { event.preventDefault(); nudgeSelection(0, -step) }\n        if (event.key === 'ArrowDown') { event.preventDefault(); nudgeSelection(0, step) }\n        if (event.key === 'ArrowLeft') { event.preventDefault(); nudgeSelection(-step, 0) }\n        if (event.key === 'ArrowRight') { event.preventDefault(); nudgeSelection(step, 0) }\n        if (event.key === '+') { event.preventDefault(); scaleSelection(1.08) }\n        if (event.key === '-') { event.preventDefault(); scaleSelection(0.92) }\n      }\n      if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'z') {\n        event.preventDefault()\n        undoLastStroke()\n      }\n      if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === 'x') {\n        event.preventDefault()\n        clearOwnStrokes()\n      }\n    }\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [clearOwnStrokes, nudgeSelection, scaleSelection, selectedStrokeIds.size, undoLastStroke])\n\n  useEffect(() => {\n    const preset = TOOL_PRESET[tool]\n    if (!preset) return\n    if (tool === 'eraser' || tool === 'highlighter' || tool === 'marker' || tool === 'calligraphy' || tool === 'pencil' || tool === 'pen') {\n      setBrushSize(preset.width)\n    }\n  }, [tool])\n\n  useEffect(() => {\n    setViewport((prev) => ({ ...prev, scale: zoomPreset }))\n  }, [zoomPreset])\n\n  const cursorColorForId = useCallback((userId: string) => {\n    const palette = ['#2563eb', '#7c3aed', '#059669', '#dc2626', '#ea580c', '#0891b2', '#ca8a04']\n    let hash = 0\n    for (let i = 0; i < userId.length; i += 1) hash = (hash * 31 + userId.charCodeAt(i)) | 0\n    return palette[Math.abs(hash) % palette.length]\n  }, [])\n  \n  const getVisibilityIcon = () => {\n    switch (visibility) {\n      case 'private': return <EyeOff className=\"w-4 h-4 mr-2\" />\n      case 'tutor-only': return <UserCheck className=\"w-4 h-4 mr-2\" />\n      case 'public': return <Users className=\"w-4 h-4 mr-2\" />\n    }\n  }\n  \n  const getVisibilityLabel = () => {\n    switch (visibility) {\n      case 'private': return 'Private'\n      case 'tutor-only': return 'Tutor Only'\n      case 'public': return 'Class Visible'\n    }\n  }\n  \n  if (mode === 'floating' && isMinimized) {\n    return (\n      <div className=\"fixed bottom-4 right-4 bg-white border rounded-lg shadow-lg p-3 z-50\">\n        <div className=\"flex items-center gap-3\">\n          <Palette className=\"w-5 h-5\" />\n          <span className=\"font-medium\">My Whiteboard</span>\n          <Badge variant={visibility === 'public' ? 'default' : 'secondary'} className=\"text-xs\">\n            {getVisibilityLabel()}\n          </Badge>\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsMinimized(false)}>\n            <ChevronUp className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    )\n  }\n  \n  return (\n    <div className={cn(\n      \"bg-white border rounded-lg shadow-2xl flex flex-col\",\n      mode === 'floating' ? \"fixed bottom-4 right-4 w-96 z-50\" : \"w-full h-full\"\n    )}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b bg-gray-50 rounded-t-lg\">\n        <div className=\"flex items-center gap-2\">\n          <Palette className=\"w-4 h-4\" />\n          <span className=\"font-medium text-sm\">My Whiteboard</span>\n          {isLayerLocked && (\n            <Badge variant=\"destructive\" className=\"text-xs\">\n              <Lock className=\"w-3 h-3 mr-1\" />\n              Locked\n            </Badge>\n          )}\n          {hasSubmitted && (\n            <Badge className=\"text-xs bg-green-100 text-green-700 border-green-200\">\n              <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n              Submitted\n            </Badge>\n          )}\n          {!isConnected && (\n            <Badge variant=\"outline\" className=\"text-xs text-red-500\">Offline</Badge>\n          )}\n        </div>\n        \n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-7 text-xs\"\n            onClick={() => setStylusPriority((prev) => !prev)}\n            aria-label=\"Toggle stylus priority\"\n          >\n            {stylusPriority ? 'Stylus Priority' : 'Touch Enabled'}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-7 text-xs\"\n            onClick={() => setHighContrast((prev) => !prev)}\n            aria-label=\"Toggle high contrast\"\n          >\n            {highContrast ? 'Standard' : 'High Contrast'}\n          </Button>\n          <Sheet open={taskPanelOpen} onOpenChange={setTaskPanelOpen}>\n            <SheetTrigger asChild>\n              <Button\n                variant={visibleTaskShares.length > 0 ? 'default' : 'ghost'}\n                size=\"sm\"\n                className={cn('h-7 text-xs', visibleTaskShares.length > 0 && 'animate-pulse')}\n              >\n                {visibleTaskShares.length > 0 ? `Live Tasks (${visibleTaskShares.length})` : 'Tasks (0)'}\n              </Button>\n            </SheetTrigger>\n            <SheetContent side=\"right\" className=\"w-[420px] sm:w-[520px]\">\n              <SheetHeader>\n                <SheetTitle>Visible Tasks</SheetTitle>\n              </SheetHeader>\n              <div className=\"mt-4 space-y-3\">\n                {visibleTaskShares.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">No visible tasks yet.</p>\n                ) : (\n                  visibleTaskShares.map((share) => (\n                    <div key={share.shareId} className=\"rounded-lg border p-3\">\n                      <p className=\"text-sm font-medium\">{share.title}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {share.description || 'Tutor shared task document'}\n                      </p>\n                      <div className=\"mt-2 flex items-center justify-between text-xs\">\n                        <div className=\"flex items-center gap-1\">\n                          <Badge variant=\"outline\">{share.visibleToAll ? 'Class Visible' : 'Private'}</Badge>\n                          <Badge variant=\"secondary\">\n                            {share.allowCollaborativeWrite ? 'Collaborative' : 'Read only'}\n                          </Badge>\n                          {share.submissions?.some((submission) => submission.userId === myUserId) && (\n                            <Badge className=\"bg-green-100 text-green-700 border-green-200\">Submitted</Badge>\n                          )}\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            onOpenTask?.(share.shareId)\n                            setTaskPanelOpen(false)\n                          }}\n                        >\n                          Open Task\n                        </Button>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </SheetContent>\n          </Sheet>\n          {/* Visibility Toggle */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 text-xs\">\n                {getVisibilityIcon()}\n                {getVisibilityLabel()}\n                <ChevronDown className=\"w-3 h-3 ml-1\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem onClick={() => changeVisibility('private')}>\n                <EyeOff className=\"w-4 h-4 mr-2\" />\n                Private (Only Me)\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => changeVisibility('tutor-only')}>\n                <UserCheck className=\"w-4 h-4 mr-2\" />\n                Tutor Can View\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => changeVisibility('public')}>\n                <Users className=\"w-4 h-4 mr-2\" />\n                Class Can View\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n          \n          {mode === 'floating' && (\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-7\" onClick={() => setIsMinimized(true)}>\n              <ChevronDown className=\"w-4 h-4\" />\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {visibleTaskShares.length > 0 && (\n        <div className=\"border-b bg-blue-50 px-3 py-2 text-xs text-blue-800\">\n          Tutor shared {visibleTaskShares.length} live task{visibleTaskShares.length > 1 ? 's' : ''}. Click{' '}\n          <span className=\"font-semibold\">Live Tasks</span> to open and work on your copy.\n        </div>\n      )}\n      \n      {/* Toolbar */}\n      <div className=\"space-y-2 border-b bg-slate-50/95 px-3 py-2 backdrop-blur\">\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {[\n              { id: 'pencil', icon: Pencil, label: 'Pencil' },\n              { id: 'pen', icon: PenLine, label: 'Pen' },\n              { id: 'marker', icon: Dot, label: 'Marker' },\n              { id: 'highlighter', icon: Highlighter, label: 'Highlighter' },\n              { id: 'calligraphy', icon: Minus, label: 'Calligraphy' },\n              { id: 'eraser', icon: Eraser, label: 'Eraser' },\n            ].map(({ id, icon: Icon, label }) => (\n              <button\n                key={id}\n                onClick={() => setTool(id as Tool)}\n                className={cn(\n                  \"rounded-md px-2 py-1.5 transition-colors\",\n                  tool === id ? 'bg-blue-100 text-blue-700' : 'text-slate-600 hover:bg-slate-100'\n                )}\n                title={label}\n                aria-label={label}\n              >\n                <Icon className=\"h-4 w-4\" />\n              </button>\n            ))}\n          </div>\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {[\n              { id: 'line', icon: Minus, label: 'Line' },\n              { id: 'arrow', icon: ArrowRight, label: 'Arrow' },\n              { id: 'rectangle', icon: RectangleHorizontal, label: 'Rectangle' },\n              { id: 'circle', icon: Circle, label: 'Circle' },\n              { id: 'triangle', icon: Triangle, label: 'Triangle' },\n              { id: 'connector', icon: ArrowRight, label: 'Connector' },\n              { id: 'text', icon: Type, label: 'Text' },\n              { id: 'laser', icon: Dot, label: 'Laser Pointer' },\n              { id: 'select', icon: MousePointer2, label: 'Select' },\n              { id: 'hand', icon: Move, label: 'Pan' },\n            ].map(({ id, icon: Icon, label }) => (\n              <button\n                key={id}\n                onClick={() => setTool(id as Tool)}\n                className={cn(\n                  \"rounded-md px-2 py-1.5 transition-colors\",\n                  tool === id ? 'bg-indigo-100 text-indigo-700' : 'text-slate-600 hover:bg-slate-100'\n                )}\n                title={label}\n                aria-label={label}\n              >\n                <Icon className=\"h-4 w-4\" />\n              </button>\n            ))}\n          </div>\n\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {COLORS.map((c) => (\n              <button\n                key={c}\n                onClick={() => setColor(c)}\n                className={cn(\n                  \"h-5 w-5 rounded-full border transition-all\",\n                  color === c ? 'scale-110 border-slate-600' : 'border-transparent'\n                )}\n                style={{ backgroundColor: c }}\n                title={c}\n              />\n            ))}\n            <input\n              type=\"color\"\n              value={customColor}\n              onChange={(e) => {\n                setCustomColor(e.target.value)\n                setColor(e.target.value)\n              }}\n              className=\"h-5 w-7 cursor-pointer rounded border bg-transparent p-0\"\n              title=\"Custom color\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n            <span className=\"text-xs text-slate-500\">Stroke</span>\n            <Slider\n              value={[brushSize]}\n              onValueChange={([value]) => setBrushSize(value)}\n              min={1}\n              max={32}\n              step={1}\n              className=\"w-20\"\n            />\n            <span className=\"w-6 text-xs font-medium text-slate-600\">{brushSize}</span>\n          </div>\n          {tool === 'text' && (\n            <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n              <span className=\"text-xs text-slate-500\">Font</span>\n              <Slider\n                value={[fontSize]}\n                onValueChange={([value]) => setFontSize(value)}\n                min={14}\n                max={56}\n                step={1}\n                className=\"w-20\"\n              />\n              <span className=\"w-6 text-xs font-medium text-slate-600\">{fontSize}</span>\n            </div>\n          )}\n          {tool === 'text' && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              {(['plain', 'latex', 'code', 'table', 'sticky'] as const).map((preset) => (\n                <Button\n                  key={preset}\n                  variant={textPreset === preset ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  className=\"h-7 px-2 text-xs capitalize\"\n                  title={`Text preset: ${preset}`}\n                  aria-label={`Text preset: ${preset}`}\n                  onClick={() => setTextPreset(preset)}\n                >\n                  {preset}\n                </Button>\n              ))}\n            </div>\n          )}\n          {tool === 'select' && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              <Button\n                variant={selectionMode === 'rect' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Selection mode: rectangle\"\n                onClick={() => setSelectionMode('rect')}\n              >\n                Rect\n              </Button>\n              <Button\n                variant={selectionMode === 'lasso' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Selection mode: lasso\"\n                onClick={() => setSelectionMode('lasso')}\n              >\n                Lasso\n              </Button>\n              <Button\n                variant={selectionHitMode === 'intersect' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Select items that intersect selection area\"\n                onClick={() => setSelectionHitMode('intersect')}\n              >\n                Intersect\n              </Button>\n              <Button\n                variant={selectionHitMode === 'contain' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Select only items fully contained in selection area\"\n                onClick={() => setSelectionHitMode('contain')}\n              >\n                Contain\n              </Button>\n            </div>\n          )}\n          {selectedStrokeIds.size > 0 && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection up\" onClick={() => nudgeSelection(0, -10)} disabled={isLayerLocked}>\n                Up\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection left\" onClick={() => nudgeSelection(-10, 0)} disabled={isLayerLocked}>\n                Left\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection right\" onClick={() => nudgeSelection(10, 0)} disabled={isLayerLocked}>\n                Right\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection down\" onClick={() => nudgeSelection(0, 10)} disabled={isLayerLocked}>\n                Down\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Scale selected items down\" onClick={() => scaleSelection(0.9)} disabled={isLayerLocked}>\n                Scale -\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Scale selected items up\" onClick={() => scaleSelection(1.1)} disabled={isLayerLocked}>\n                Scale +\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all with same color\" onClick={() => selectByAttribute('color')} disabled={isLayerLocked}>\n                Same Color\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all with same stroke type\" onClick={() => selectByAttribute('type')} disabled={isLayerLocked}>\n                Same Type\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all in same layer\" onClick={() => selectByAttribute('layer')} disabled={isLayerLocked}>\n                Same Layer\n              </Button>\n            </div>\n          )}\n\n          <div className=\"flex items-center gap-1\">\n            <Button size=\"sm\" variant={zoomPreset === 1 ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" onClick={() => setZoomPreset(1)}>\n              100%\n            </Button>\n            <Button size=\"sm\" variant={zoomPreset === 1.25 ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" onClick={() => setZoomPreset(1.25)}>\n              125%\n            </Button>\n            <Button size=\"sm\" variant={zoomPreset === 1.5 ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" onClick={() => setZoomPreset(1.5)}>\n              150%\n            </Button>\n          </div>\n          <Button size=\"sm\" variant={snapEnabled ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" title=\"Toggle snap-to-grid\" onClick={() => setSnapEnabled((prev) => !prev)}>\n            Snap\n          </Button>\n          <Button size=\"sm\" variant={gridVisible ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" title=\"Show or hide grid\" onClick={() => setGridVisible((prev) => !prev)}>\n            Grid\n          </Button>\n          <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n            <span className=\"text-xs text-slate-500\">Grid</span>\n            <Slider value={[gridSize]} onValueChange={([v]) => setGridSize(v)} min={8} max={64} step={2} className=\"w-20\" />\n            <span className=\"w-6 text-xs font-medium text-slate-600\">{gridSize}</span>\n          </div>\n          <Button size=\"sm\" variant={followTutorCursor ? 'default' : 'outline'} className=\"h-7 px-2 text-xs\" title=\"Center viewport on tutor cursor\" onClick={() => setFollowTutorCursor((prev) => !prev)}>\n            Follow Tutor\n          </Button>\n\n          <div className=\"flex items-center gap-1 text-xs\">\n            <Button\n              size=\"sm\"\n              variant={activeLayerId === 'student-personal' ? 'default' : 'outline'}\n              className=\"h-7 px-2 text-xs\"\n              onClick={() => setActiveLayerId('student-personal')}\n            >\n              My Layer\n            </Button>\n            <Button\n              size=\"sm\"\n              variant={activeLayerId === 'shared-group' ? 'default' : 'outline'}\n              className=\"h-7 px-2 text-xs\"\n              onClick={() => setActiveLayerId('shared-group')}\n            >\n              Shared Layer\n            </Button>\n          </div>\n\n          <div className=\"ml-auto flex items-center gap-1\">\n            <Badge variant=\"outline\" className=\"text-xs\">\n              {Math.round(viewport.scale * 100)}%\n            </Badge>\n            {selectedStrokeIds.size > 0 && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {selectedStrokeIds.size} selected\n              </Badge>\n            )}\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"h-7 text-xs\"\n              onClick={submitMyBoard}\n              disabled={isLayerLocked || myStrokes.length === 0 || hasSubmitted}\n            >\n              {hasSubmitted ? 'Submitted' : 'Submit'}\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => undoLastStroke()} disabled={isLayerLocked}>\n              <Undo className=\"w-3.5 h-3.5\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={clearOwnStrokes} disabled={isLayerLocked}>\n              <Trash2 className=\"w-3.5 h-3.5\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n      \n      {/* Tutor Board Toggle */}\n      {tutorStrokes.length > 0 && (\n        <div className=\"px-3 py-1.5 border-b bg-blue-50 flex items-center justify-between\">\n          <span className=\"text-xs text-blue-700\">\n            {tutorStrokes.length} strokes from tutor\n          </span>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-6 text-xs\"\n            onClick={() => setShowTutorBoard(!showTutorBoard)}\n          >\n            {showTutorBoard ? 'Hide' : 'Show'}\n          </Button>\n        </div>\n      )}\n      \n      {/* Canvas */}\n      <div ref={containerRef} className={cn(\"p-3\", mode === 'floating' ? \"h-64\" : \"h-full min-h-[380px]\")}>\n        <div\n          className={cn(\"relative w-full h-full overflow-hidden\", highContrast && \"contrast-150 saturate-150\")}\n          style={{\n            backgroundImage: getOverlayBackground(),\n            backgroundSize:\n              assignmentOverlay === 'chemistry-structure' ? '120px 80px' :\n              assignmentOverlay === 'geometry-grid' ? '24px 24px' : '20px 20px',\n          }}\n        >\n          <canvas\n            ref={canvasRef}\n            onPointerDown={handlePointerDown}\n            onPointerMove={handlePointerMove}\n            onPointerUp={handlePointerUp}\n            onPointerLeave={handlePointerUp}\n            onWheel={handleWheel}\n            className={cn(\n              \"w-full h-full border rounded bg-white\",\n              isLayerLocked ? 'cursor-not-allowed' :\n                tool === 'laser' ? 'cursor-none' :\n                tool === 'hand' ? 'cursor-grab' :\n                tool === 'select' ? 'cursor-default' :\n                'cursor-crosshair'\n            )}\n            aria-label=\"Student whiteboard canvas\"\n          />\n          {textDraft && (\n            <div\n              className=\"absolute z-30\"\n              style={{ left: textDraft.x, top: textDraft.y }}\n            >\n              <div className=\"w-72 rounded-md border border-slate-300 bg-white/95 p-2 shadow-lg\">\n                <textarea\n                  autoFocus\n                  value={textDraft.value}\n                  rows={4}\n                  onChange={(event) => setTextDraft((prev) => prev ? { ...prev, value: event.target.value } : prev)}\n                  onKeyDown={(event) => {\n                    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n                      event.preventDefault()\n                      commitTextDraft()\n                    }\n                    if (event.key === 'Escape') {\n                      event.preventDefault()\n                      setTextDraft(null)\n                    }\n                  }}\n                  placeholder=\"Type here... (Cmd/Ctrl + Enter to place)\"\n                  className=\"w-full resize-none rounded-md border border-slate-200 bg-white p-2 text-sm outline-none ring-offset-2 focus:ring-2\"\n                />\n                <div className=\"mt-2 flex items-center justify-end gap-2\">\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => setTextDraft(null)}>\n                    Cancel\n                  </Button>\n                  <Button size=\"sm\" onClick={commitTextDraft}>\n                    Place\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {spotlight.enabled && (\n            <div className=\"absolute inset-0 pointer-events-none\">\n              <div className=\"absolute inset-0 bg-black/30\" />\n              <div\n                className={cn(\n                  \"absolute border-2 border-yellow-300 shadow-[0_0_0_9999px_rgba(0,0,0,0.32)]\",\n                  spotlight.mode === 'pen' ? 'rounded-full' : 'rounded-md'\n                )}\n                style={{\n                  left: spotlight.x,\n                  top: spotlight.y,\n                  width: spotlight.width,\n                  height: spotlight.height,\n                }}\n              />\n            </div>\n          )}\n          {Array.from(remoteCursors.values())\n            .filter((cursor) => cursor.userId !== myUserId)\n            .map((cursor) => (\n              <div\n                key={cursor.userId}\n                className=\"absolute pointer-events-none z-10\"\n                style={{ left: cursor.x, top: cursor.y, transform: 'translate(-50%, -50%)' }}\n              >\n                {cursor.pointerMode === 'laser' ? (\n                  <div className=\"h-10 w-10 rounded-full bg-red-500/30 ring-2 ring-red-500/60 blur-[1px]\" />\n                ) : (\n                  <div\n                    className=\"h-2.5 w-2.5 rounded-full border border-white shadow\"\n                    style={{ backgroundColor: cursorColorForId(cursor.userId) }}\n                  />\n                )}\n                <div\n                  className=\"mt-1 whitespace-nowrap rounded px-1.5 py-0.5 text-[10px] text-white\"\n                  style={{ backgroundColor: cursorColorForId(cursor.userId) }}\n                >\n                  {cursor.name} {Date.now() - cursor.lastUpdated > 2000 ? '(idle)' : ''}\n                </div>\n              </div>\n            ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3065, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/student/live/%5BsessionId%5D/page.tsx"],"sourcesContent":["'use client'\n\nimport { useCallback, useEffect, useState } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useSession } from 'next-auth/react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { ArrowLeft, Loader2, ExternalLink, Video, Layers, Users, Calculator } from 'lucide-react'\nimport { MultiLayerWhiteboardInterface } from '@/app/[locale]/tutor/live-class/components/MultiLayerWhiteboardInterface'\nimport { useSocket } from '@/hooks/use-socket'\nimport { MathBoardHost } from '@/components/whiteboard/MathBoardHost'\n\ninterface JoinedSession {\n  id: string\n  title: string\n  subject: string\n  status: string\n  roomId: string | null\n  roomUrl: string | null\n  maxStudents: number\n  participants: Array<{\n    id: string\n    studentId?: string\n  }>\n  tutor?: {\n    profile?: {\n      name?: string | null\n    } | null\n  } | null\n}\n\ninterface JoinResponse {\n  session: JoinedSession\n  token: string\n  roomUrl: string | null\n}\n\nexport default function StudentLiveSessionPage() {\n  const router = useRouter()\n  const params = useParams()\n  const sessionId = params.sessionId as string\n  const { data: authSession } = useSession()\n\n  const [loading, setLoading] = useState(true)\n  const [joinData, setJoinData] = useState<JoinResponse | null>(null)\n  const [error, setError] = useState<string | null>(null)\n  const [showRecordingNotice, setShowRecordingNotice] = useState(false)\n\n  const socketOptions = authSession?.user?.id\n    ? {\n        roomId: sessionId,\n        userId: authSession.user.id,\n        name: authSession.user.name || 'Student',\n        role: 'student' as const,\n      }\n    : undefined\n  const { socket } = useSocket(socketOptions)\n\n  const getCsrfToken = useCallback(async (): Promise<string | null> => {\n    try {\n      const res = await fetch('/api/csrf', { credentials: 'include' })\n      const data = await res.json().catch(() => ({}))\n      return data?.token ?? null\n    } catch {\n      return null\n    }\n  }, [])\n\n  const fetchJoinData = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const csrfToken = await getCsrfToken()\n      const res = await fetch(`/api/class/rooms/${sessionId}/join`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(csrfToken ? { 'X-CSRF-Token': csrfToken } : {}),\n        },\n        credentials: 'include',\n      })\n\n      if (!res.ok) {\n        const raw = await res.text().catch(() => '')\n        throw new Error(raw || `Failed to join class (${res.status})`)\n      }\n\n      const data = (await res.json()) as JoinResponse\n      setJoinData(data)\n    } catch (e) {\n      const message = e instanceof Error ? e.message : 'Unable to join class'\n      setError(message)\n    } finally {\n      setLoading(false)\n    }\n  }, [getCsrfToken, sessionId])\n\n  useEffect(() => {\n    if (!sessionId) return\n    fetchJoinData()\n  }, [sessionId, fetchJoinData])\n\n  useEffect(() => {\n    if (!joinData?.session?.id) return\n    const key = `live-recording-notice:${joinData.session.id}`\n    const alreadySeen = typeof window !== 'undefined' ? window.sessionStorage.getItem(key) : null\n    if (!alreadySeen) {\n      setShowRecordingNotice(true)\n      if (typeof window !== 'undefined') {\n        window.sessionStorage.setItem(key, '1')\n      }\n    }\n  }, [joinData?.session?.id])\n\n  const openVideoClassroom = useCallback(() => {\n    const roomUrl = joinData?.roomUrl\n    const token = joinData?.token\n    if (!roomUrl) {\n      toast.error('Room URL is not available')\n      return\n    }\n    const target = token\n      ? `${roomUrl}${roomUrl.includes('?') ? '&' : '?'}t=${encodeURIComponent(token)}`\n      : roomUrl\n    window.open(target, '_blank', 'noopener,noreferrer')\n  }, [joinData])\n\n  if (loading) {\n    return (\n      <div className=\"w-full p-6\">\n        <div className=\"flex items-center justify-center py-24 text-gray-500\">\n          <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n          Joining live class...\n        </div>\n      </div>\n    )\n  }\n\n  if (error || !joinData) {\n    return (\n      <div className=\"w-full p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Unable to open live class</CardTitle>\n            <CardDescription>{error || 'Unexpected error'}</CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={() => router.push('/student/live/join')}>\n              Back to Join\n            </Button>\n            <Button onClick={fetchJoinData}>Retry</Button>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  const session = joinData.session\n\n  return (\n    <div className=\"w-full p-4 sm:p-6 space-y-4\">\n      <Dialog open={showRecordingNotice} onOpenChange={setShowRecordingNotice}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>This class is being recorded</DialogTitle>\n            <DialogDescription>\n              Recordings help with safety, lesson replays, missed-lesson recovery, and AI-generated lesson summaries.\n              Continue only if you consent to this class recording policy.\n            </DialogDescription>\n          </DialogHeader>\n        </DialogContent>\n      </Dialog>\n\n      <div className=\"flex items-center justify-between gap-3\">\n        <Button variant=\"ghost\" onClick={() => router.push('/student/live/join')}>\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Back\n        </Button>\n        <div className=\"flex items-center gap-2\">\n          <Badge variant=\"secondary\">{session.subject}</Badge>\n          <Badge>{session.status}</Badge>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between gap-3\">\n            <span>{session.title}</span>\n            <Button onClick={openVideoClassroom}>\n              <Video className=\"w-4 h-4 mr-2\" />\n              Open Classroom\n              <ExternalLink className=\"w-4 h-4 ml-2\" />\n            </Button>\n          </CardTitle>\n          <CardDescription>\n            Tutor: {session.tutor?.profile?.name || 'Tutor'}  Participants: {session.participants.length}/{session.maxStudents}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      <Tabs defaultValue=\"whiteboard\" className=\"space-y-4\">\n        <TabsList className=\"grid grid-cols-3 w-full max-w-lg\">\n          <TabsTrigger value=\"whiteboard\" className=\"gap-1\">\n            <Layers className=\"w-4 h-4\" />\n            Whiteboard\n          </TabsTrigger>\n          <TabsTrigger value=\"math\" className=\"gap-1\">\n            <Calculator className=\"w-4 h-4\" />\n            Math\n          </TabsTrigger>\n          <TabsTrigger value=\"session\" className=\"gap-1\">\n            <Users className=\"w-4 h-4\" />\n            Session\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"whiteboard\" className=\"h-[calc(100vh-240px)] min-h-[620px]\">\n          <MultiLayerWhiteboardInterface\n            sessionId={session.id}\n            roomId={session.roomId || session.id}\n            students={[]}\n            isSocketConnected={true}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"math\" className=\"h-[calc(100vh-240px)] min-h-[620px]\">\n          <MathBoardHost\n            sessionId={`math-${session.id}`}\n            socket={socket}\n            userId={authSession?.user?.id}\n            userName={authSession?.user?.name || 'Student'}\n            role=\"student\"\n            className=\"h-full\"\n          />\n        </TabsContent>\n\n        <TabsContent value=\"session\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Classroom Access</CardTitle>\n              <CardDescription>\n                Open the video classroom in a new tab while keeping this whiteboard panel open.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Button onClick={openVideoClassroom}>\n                <Video className=\"w-4 h-4 mr-2\" />\n                Open Classroom\n              </Button>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}