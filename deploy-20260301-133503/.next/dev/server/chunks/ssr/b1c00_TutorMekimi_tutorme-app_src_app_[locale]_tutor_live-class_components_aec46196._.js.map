{
  "version": 3,
  "sources": [],
  "debugId": "8a7f4da9-4d4a-91b6-194d-58f47729cd31",
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/tutor/live-class/components/CourseStructureLinkPanel.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useMemo, useState, useCallback, useRef } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { BookOpen, RefreshCw, Loader2 } from 'lucide-react'\nimport { CourseBuilder } from '../../dashboard/components/CourseBuilder'\nimport type { Module as CourseBuilderModule } from '../../dashboard/components/CourseBuilder'\nimport type { VisibleDocumentPayload } from '../../dashboard/components/CourseBuilder'\nimport { toast } from 'sonner'\n\ninterface CourseSummary {\n  id: string\n  name: string\n  subject: string\n}\n\ninterface CourseStructureLinkPanelProps {\n  buttonClassName?: string\n  initialCourseId?: string | null\n  classSubject?: string\n  onMakeVisibleToStudents?: (payload: VisibleDocumentPayload) => void\n}\n\nexport function CourseStructureLinkPanel({ buttonClassName, initialCourseId, classSubject, onMakeVisibleToStudents }: CourseStructureLinkPanelProps) {\n  const [open, setOpen] = useState(false)\n  const [courses, setCourses] = useState<CourseSummary[]>([])\n  const [selectedCourseId, setSelectedCourseId] = useState<string>('')\n  const [loadingCourses, setLoadingCourses] = useState(false)\n  const [loadingBuilder, setLoadingBuilder] = useState(false)\n  const [savingBuilder, setSavingBuilder] = useState(false)\n  const [modules, setModules] = useState<CourseBuilderModule[] | null>(null)\n  const [builderVersion, setBuilderVersion] = useState(0)\n  const [panelWidth, setPanelWidth] = useState(720)\n  const isResizingRef = useRef(false)\n\n  const selectedCourse = useMemo(\n    () => courses.find((course) => course.id === selectedCourseId) || null,\n    [courses, selectedCourseId]\n  )\n\n  const loadCourses = useCallback(async () => {\n    setLoadingCourses(true)\n    try {\n      const res = await fetch('/api/tutor/courses', { credentials: 'include' })\n      if (!res.ok) throw new Error('Failed to load courses')\n      const data = await res.json()\n      const nextCourses = (Array.isArray(data.courses) ? data.courses : []) as CourseSummary[]\n      setCourses(nextCourses)\n\n      const preferred = initialCourseId && nextCourses.some((course) => course.id === initialCourseId)\n        ? initialCourseId\n        : null\n      if (preferred) {\n        setSelectedCourseId(preferred)\n      } else if (!selectedCourseId && nextCourses.length > 0) {\n        setSelectedCourseId(nextCourses[0].id)\n      }\n    } catch {\n      setCourses([])\n    } finally {\n      setLoadingCourses(false)\n    }\n  }, [selectedCourseId, initialCourseId])\n\n  const loadBuilderTree = useCallback(async (courseId: string) => {\n    if (!courseId) return\n    setLoadingBuilder(true)\n    try {\n      const res = await fetch(`/api/tutor/courses/${courseId}/curriculum`, { credentials: 'include' })\n      if (!res.ok) throw new Error('Failed to load course builder data')\n      const data = await res.json()\n      setModules(Array.isArray(data.modules) ? (data.modules as CourseBuilderModule[]) : [])\n      setBuilderVersion((prev) => prev + 1)\n    } catch {\n      setModules([])\n      toast.error('Failed to load course content')\n    } finally {\n      setLoadingBuilder(false)\n    }\n  }, [])\n\n  useEffect(() => {\n    loadCourses()\n  }, [loadCourses])\n\n  useEffect(() => {\n    if (!open || !selectedCourseId) return\n    loadBuilderTree(selectedCourseId)\n  }, [open, selectedCourseId, loadBuilderTree])\n\n  const handleSave = async (\n    nextModules: CourseBuilderModule[],\n    options?: {\n      developmentMode: 'single' | 'multi'\n      previewDifficulty: 'all' | 'beginner' | 'intermediate' | 'advanced'\n    }\n  ) => {\n    if (!selectedCourseId) return\n    setSavingBuilder(true)\n    try {\n      const csrfRes = await fetch('/api/csrf', { credentials: 'include' })\n      const csrfData = await csrfRes.json().catch(() => ({}))\n      const csrfToken = csrfData?.token ?? null\n\n      const res = await fetch(`/api/tutor/courses/${selectedCourseId}/curriculum`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(csrfToken && { 'X-CSRF-Token': csrfToken }),\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          modules: nextModules,\n          developmentMode: options?.developmentMode ?? 'single',\n          previewDifficulty: options?.previewDifficulty ?? 'all',\n        }),\n      })\n\n      const data = await res.json().catch(() => ({}))\n      if (!res.ok) {\n        toast.error(data.error ?? 'Failed to save curriculum')\n        return\n      }\n\n      setModules(nextModules)\n      toast.success(`Curriculum saved — ${data.moduleCount ?? nextModules.length} modules`)\n    } catch {\n      toast.error('Failed to save curriculum')\n    } finally {\n      setSavingBuilder(false)\n    }\n  }\n\n  const buttonLabel = selectedCourse?.name ?? (classSubject ? `${classSubject} Class` : 'Course Builder')\n\n  useEffect(() => {\n    const applyDefaultWidth = () => {\n      const viewport = window.innerWidth\n      const preferred = Math.round(viewport * 0.48)\n      const clamped = Math.max(420, Math.min(Math.max(620, viewport - 280), preferred))\n      setPanelWidth(clamped)\n    }\n\n    applyDefaultWidth()\n    window.addEventListener('resize', applyDefaultWidth)\n    return () => window.removeEventListener('resize', applyDefaultWidth)\n  }, [])\n\n  useEffect(() => {\n    const handleMove = (event: MouseEvent) => {\n      if (!isResizingRef.current) return\n      const maxWidth = Math.max(620, window.innerWidth - 240)\n      const nextWidth = Math.max(420, Math.min(maxWidth, event.clientX))\n      setPanelWidth(nextWidth)\n    }\n\n    const handleTouchMove = (event: TouchEvent) => {\n      if (!isResizingRef.current) return\n      const touch = event.touches[0]\n      if (!touch) return\n      const maxWidth = Math.max(620, window.innerWidth - 240)\n      const nextWidth = Math.max(420, Math.min(maxWidth, touch.clientX))\n      setPanelWidth(nextWidth)\n    }\n\n    const handleUp = () => {\n      isResizingRef.current = false\n      document.body.style.userSelect = ''\n      document.body.style.cursor = ''\n    }\n\n    window.addEventListener('mousemove', handleMove)\n    window.addEventListener('touchmove', handleTouchMove, { passive: true })\n    window.addEventListener('mouseup', handleUp)\n    window.addEventListener('touchend', handleUp)\n    return () => {\n      window.removeEventListener('mousemove', handleMove)\n      window.removeEventListener('touchmove', handleTouchMove)\n      window.removeEventListener('mouseup', handleUp)\n      window.removeEventListener('touchend', handleUp)\n    }\n  }, [])\n\n  const startResize = () => {\n    isResizingRef.current = true\n    document.body.style.userSelect = 'none'\n    document.body.style.cursor = 'col-resize'\n  }\n\n  return (\n    <>\n      <Button variant=\"outline\" size=\"sm\" className={buttonClassName} onClick={() => setOpen(true)}>\n        <BookOpen className=\"w-4 h-4 mr-2\" />\n        <span className=\"max-w-[220px] truncate\">{buttonLabel}</span>\n      </Button>\n\n      {open && (\n        <div className=\"fixed inset-0 z-50\">\n          <button\n            type=\"button\"\n            aria-label=\"Close course builder panel overlay\"\n            className=\"absolute inset-0 bg-black/65\"\n            onClick={() => setOpen(false)}\n          />\n\n          <div\n            className=\"absolute inset-y-0 left-0 flex h-full border-r bg-background shadow-xl\"\n            style={{ width: `${panelWidth}px` }}\n          >\n            <button\n              type=\"button\"\n              aria-label=\"Resize course builder panel\"\n              onMouseDown={startResize}\n              onTouchStart={startResize}\n              className=\"absolute right-0 top-0 z-20 h-full w-3 cursor-col-resize border-r border-transparent bg-transparent transition-colors hover:border-blue-300\"\n            />\n            <div className=\"flex h-full min-w-0 flex-1 flex-col\">\n              <div className=\"border-b px-6 py-4\">\n                <div className=\"text-lg font-semibold\">Live Course Builder Panel</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  This is the same builder as Course Builder page. Changes stay in sync.\n                </div>\n              </div>\n\n            <div className=\"flex items-center gap-2 border-b px-6 py-3\">\n              <div className=\"w-[360px]\">\n                <Select value={selectedCourseId} onValueChange={setSelectedCourseId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder={loadingCourses ? 'Loading courses…' : 'Select a course'} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {courses.map((course) => (\n                      <SelectItem key={course.id} value={course.id}>\n                        {course.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={!selectedCourseId || loadingBuilder}\n                onClick={() => loadBuilderTree(selectedCourseId)}\n              >\n                <RefreshCw className=\"w-4 h-4 mr-2\" />\n                {loadingBuilder ? 'Syncing…' : 'Sync'}\n              </Button>\n              {savingBuilder && (\n                <Badge variant=\"secondary\">Saving…</Badge>\n              )}\n            </div>\n\n            <div className=\"min-h-0 flex-1 overflow-hidden\">\n              {!selectedCourseId ? (\n                <div className=\"flex h-full items-center justify-center text-sm text-muted-foreground\">\n                  Select a course to open the builder.\n                </div>\n              ) : loadingBuilder || modules === null ? (\n                <div className=\"flex h-full items-center justify-center\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-blue-500\" />\n                </div>\n              ) : (\n                <div className=\"h-full overflow-auto px-4 py-4\">\n                  <CourseBuilder\n                    key={`${selectedCourseId}:${builderVersion}`}\n                    courseId={selectedCourseId}\n                    courseName={selectedCourse?.name}\n                    panelMode=\"live-class\"\n                    initialModules={modules}\n                    onSave={handleSave}\n                    onMakeVisibleToStudents={(payload) => {\n                      setOpen(false)\n                      onMakeVisibleToStudents?.(payload)\n                    }}\n                  />\n                </div>\n              )}\n            </div>\n\n            <button\n              type=\"button\"\n              className=\"absolute right-4 top-4 rounded border border-border bg-background px-2 py-1 text-xs text-muted-foreground hover:text-foreground\"\n              onClick={() => setOpen(false)}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n        </div>\n      )}\n    </>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AAVA;;;;;;;;;AAyBO,SAAS,yBAAyB,EAAE,eAAe,EAAE,eAAe,EAAE,YAAY,EAAE,uBAAuB,EAAiC;IACjJ,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,mQAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mQAAQ,EAAkB,EAAE;IAC1D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,mQAAQ,EAAS;IACjE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,mQAAQ,EAAC;IACrD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,mQAAQ,EAAC;IACrD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,mQAAQ,EAAC;IACnD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mQAAQ,EAA+B;IACrE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,mQAAQ,EAAC;IACrD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,mQAAQ,EAAC;IAC7C,MAAM,gBAAgB,IAAA,iQAAM,EAAC;IAE7B,MAAM,iBAAiB,IAAA,kQAAO,EAC5B,IAAM,QAAQ,IAAI,CAAC,CAAC,SAAW,OAAO,EAAE,KAAK,qBAAqB,MAClE;QAAC;QAAS;KAAiB;IAG7B,MAAM,cAAc,IAAA,sQAAW,EAAC;QAC9B,kBAAkB;QAClB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,sBAAsB;gBAAE,aAAa;YAAU;YACvE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,MAAM,cAAe,MAAM,OAAO,CAAC,KAAK,OAAO,IAAI,KAAK,OAAO,GAAG,EAAE;YACpE,WAAW;YAEX,MAAM,YAAY,mBAAmB,YAAY,IAAI,CAAC,CAAC,SAAW,OAAO,EAAE,KAAK,mBAC5E,kBACA;YACJ,IAAI,WAAW;gBACb,oBAAoB;YACtB,OAAO,IAAI,CAAC,oBAAoB,YAAY,MAAM,GAAG,GAAG;gBACtD,oBAAoB,WAAW,CAAC,EAAE,CAAC,EAAE;YACvC;QACF,EAAE,OAAM;YACN,WAAW,EAAE;QACf,SAAU;YACR,kBAAkB;QACpB;IACF,GAAG;QAAC;QAAkB;KAAgB;IAEtC,MAAM,kBAAkB,IAAA,sQAAW,EAAC,OAAO;QACzC,IAAI,CAAC,UAAU;QACf,kBAAkB;QAClB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,SAAS,WAAW,CAAC,EAAE;gBAAE,aAAa;YAAU;YAC9F,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,WAAW,MAAM,OAAO,CAAC,KAAK,OAAO,IAAK,KAAK,OAAO,GAA6B,EAAE;YACrF,kBAAkB,CAAC,OAAS,OAAO;QACrC,EAAE,OAAM;YACN,WAAW,EAAE;YACb,mMAAK,CAAC,KAAK,CAAC;QACd,SAAU;YACR,kBAAkB;QACpB;IACF,GAAG,EAAE;IAEL,IAAA,oQAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAY;IAEhB,IAAA,oQAAS,EAAC;QACR,IAAI,CAAC,QAAQ,CAAC,kBAAkB;QAChC,gBAAgB;IAClB,GAAG;QAAC;QAAM;QAAkB;KAAgB;IAE5C,MAAM,aAAa,OACjB,aACA;QAKA,IAAI,CAAC,kBAAkB;QACvB,iBAAiB;QACjB,IAAI;YACF,MAAM,UAAU,MAAM,MAAM,aAAa;gBAAE,aAAa;YAAU;YAClE,MAAM,WAAW,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YACrD,MAAM,YAAY,UAAU,SAAS;YAErC,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,iBAAiB,WAAW,CAAC,EAAE;gBAC3E,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,GAAI,aAAa;wBAAE,gBAAgB;oBAAU,CAAC;gBAChD;gBACA,aAAa;gBACb,MAAM,KAAK,SAAS,CAAC;oBACnB,SAAS;oBACT,iBAAiB,SAAS,mBAAmB;oBAC7C,mBAAmB,SAAS,qBAAqB;gBACnD;YACF;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YAC7C,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,mMAAK,CAAC,KAAK,CAAC,KAAK,KAAK,IAAI;gBAC1B;YACF;YAEA,WAAW;YACX,mMAAK,CAAC,OAAO,CAAC,CAAC,mBAAmB,EAAE,KAAK,WAAW,IAAI,YAAY,MAAM,CAAC,QAAQ,CAAC;QACtF,EAAE,OAAM;YACN,mMAAK,CAAC,KAAK,CAAC;QACd,SAAU;YACR,iBAAiB;QACnB;IACF;IAEA,MAAM,cAAc,gBAAgB,QAAQ,CAAC,eAAe,GAAG,aAAa,MAAM,CAAC,GAAG,gBAAgB;IAEtG,IAAA,oQAAS,EAAC;QACR,MAAM,oBAAoB;YACxB,MAAM,WAAW,OAAO,UAAU;YAClC,MAAM,YAAY,KAAK,KAAK,CAAC,WAAW;YACxC,MAAM,UAAU,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,KAAK,WAAW,MAAM;YACtE,cAAc;QAChB;QAEA;QACA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;IACpD,GAAG,EAAE;IAEL,IAAA,oQAAS,EAAC;QACR,MAAM,aAAa,CAAC;YAClB,IAAI,CAAC,cAAc,OAAO,EAAE;YAC5B,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,OAAO,UAAU,GAAG;YACnD,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,UAAU,MAAM,OAAO;YAChE,cAAc;QAChB;QAEA,MAAM,kBAAkB,CAAC;YACvB,IAAI,CAAC,cAAc,OAAO,EAAE;YAC5B,MAAM,QAAQ,MAAM,OAAO,CAAC,EAAE;YAC9B,IAAI,CAAC,OAAO;YACZ,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,OAAO,UAAU,GAAG;YACnD,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,UAAU,MAAM,OAAO;YAChE,cAAc;QAChB;QAEA,MAAM,WAAW;YACf,cAAc,OAAO,GAAG;YACxB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG;YACjC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;QAC/B;QAEA,OAAO,gBAAgB,CAAC,aAAa;QACrC,OAAO,gBAAgB,CAAC,aAAa,iBAAiB;YAAE,SAAS;QAAK;QACtE,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,gBAAgB,CAAC,YAAY;QACpC,OAAO;YACL,OAAO,mBAAmB,CAAC,aAAa;YACxC,OAAO,mBAAmB,CAAC,aAAa;YACxC,OAAO,mBAAmB,CAAC,WAAW;YACtC,OAAO,mBAAmB,CAAC,YAAY;QACzC;IACF,GAAG,EAAE;IAEL,MAAM,cAAc;QAClB,cAAc,OAAO,GAAG;QACxB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG;QACjC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;IAC/B;IAEA,qBACE;;0BACE,gSAAC,8LAAM;gBAAC,SAAQ;gBAAU,MAAK;gBAAK,WAAW;gBAAiB,SAAS,IAAM,QAAQ;;kCACrF,gSAAC,4QAAQ;wBAAC,WAAU;;;;;;kCACpB,gSAAC;wBAAK,WAAU;kCAA0B;;;;;;;;;;;;YAG3C,sBACC,gSAAC;gBAAI,WAAU;;kCACb,gSAAC;wBACC,MAAK;wBACL,cAAW;wBACX,WAAU;wBACV,SAAS,IAAM,QAAQ;;;;;;kCAGzB,gSAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,OAAO,GAAG,WAAW,EAAE,CAAC;wBAAC;;0CAElC,gSAAC;gCACC,MAAK;gCACL,cAAW;gCACX,aAAa;gCACb,cAAc;gCACd,WAAU;;;;;;0CAEZ,gSAAC;gCAAI,WAAU;;kDACb,gSAAC;wCAAI,WAAU;;0DACb,gSAAC;gDAAI,WAAU;0DAAwB;;;;;;0DACvC,gSAAC;gDAAI,WAAU;0DAAgC;;;;;;;;;;;;kDAKnD,gSAAC;wCAAI,WAAU;;0DACb,gSAAC;gDAAI,WAAU;0DACb,cAAA,gSAAC,8LAAM;oDAAC,OAAO;oDAAkB,eAAe;;sEAC9C,gSAAC,qMAAa;sEACZ,cAAA,gSAAC,mMAAW;gEAAC,aAAa,iBAAiB,qBAAqB;;;;;;;;;;;sEAElE,gSAAC,qMAAa;sEACX,QAAQ,GAAG,CAAC,CAAC,uBACZ,gSAAC,kMAAU;oEAAiB,OAAO,OAAO,EAAE;8EACzC,OAAO,IAAI;mEADG,OAAO,EAAE;;;;;;;;;;;;;;;;;;;;;0DAOlC,gSAAC,8LAAM;gDACL,MAAK;gDACL,SAAQ;gDACR,MAAK;gDACL,UAAU,CAAC,oBAAoB;gDAC/B,SAAS,IAAM,gBAAgB;;kEAE/B,gSAAC,+QAAS;wDAAC,WAAU;;;;;;oDACpB,iBAAiB,aAAa;;;;;;;4CAEhC,+BACC,gSAAC,4LAAK;gDAAC,SAAQ;0DAAY;;;;;;;;;;;;kDAI/B,gSAAC;wCAAI,WAAU;kDACZ,CAAC,iCACA,gSAAC;4CAAI,WAAU;sDAAwE;;;;;mDAGrF,kBAAkB,YAAY,qBAChC,gSAAC;4CAAI,WAAU;sDACb,cAAA,gSAAC,8QAAO;gDAAC,WAAU;;;;;;;;;;iEAGrB,gSAAC;4CAAI,WAAU;sDACb,cAAA,gSAAC,iPAAa;gDAEZ,UAAU;gDACV,YAAY,gBAAgB;gDAC5B,WAAU;gDACV,gBAAgB;gDAChB,QAAQ;gDACR,yBAAyB,CAAC;oDACxB,QAAQ;oDACR,0BAA0B;gDAC5B;+CATK,GAAG,iBAAiB,CAAC,EAAE,gBAAgB;;;;;;;;;;;;;;;kDAepD,gSAAC;wCACC,MAAK;wCACL,WAAU;wCACV,SAAS,IAAM,QAAQ;kDACxB;;;;;;;;;;;;;;;;;;;;;;;;;;AASb"}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/tutor/live-class/components/TutorWhiteboardManager.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useCallback, useRef, useEffect, useMemo } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Slider } from '@/components/ui/slider'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport {\n  Pencil,\n  Eraser,\n  Undo,\n  Trash2,\n  Play,\n  Square as StopIcon,\n  Users,\n  Eye,\n  EyeOff,\n  Lock,\n  Unlock,\n  CheckCircle2,\n  Minus,\n  Palette,\n  MousePointer2,\n  Pin,\n  PinOff,\n  Plus,\n  ChevronLeft,\n  ChevronRight,\n  Download,\n  Sparkles,\n  Clock3,\n  Grid3X3,\n  Ban,\n  Type,\n  MinusCircle,\n  ArrowRight,\n  RectangleHorizontal,\n  Circle,\n  Triangle,\n  PenLine,\n  Highlighter,\n  Dot,\n  Move,\n  FileUp,\n  WandSparkles,\n  Copy,\n  BringToFront,\n  SendToBack,\n  Group,\n  Ungroup,\n  Link2,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  Gauge\n} from 'lucide-react'\nimport { useLiveClassWhiteboard, WhiteboardStroke } from '@/hooks/use-live-class-whiteboard'\nimport { cn } from '@/lib/utils'\nimport { CourseStructureLinkPanel } from './CourseStructureLinkPanel'\nimport { PDFTutoringWorkbench } from '@/components/pdf-tutoring/PDFTutoringWorkbench'\nimport type { VisibleDocumentPayload } from '../../dashboard/components/CourseBuilder'\n\ntype Tool =\n  | 'pencil'\n  | 'pen'\n  | 'marker'\n  | 'highlighter'\n  | 'calligraphy'\n  | 'eraser'\n  | 'line'\n  | 'arrow'\n  | 'rectangle'\n  | 'circle'\n  | 'triangle'\n  | 'connector'\n  | 'text'\n  | 'laser'\n  | 'hand'\n  | 'select'\n\ninterface TutorWhiteboardManagerProps {\n  roomId: string\n  sessionId: string\n  initialCourseId?: string | null\n  classSubject?: string\n  students: Array<{ id: string; name: string }>\n  onDocumentVisibleToStudents?: (payload: VisibleDocumentPayload) => void\n}\n\nconst COLORS = [\n  '#111827', '#2563EB', '#7C3AED', '#059669', '#DC2626', '#EA580C', '#0891B2', '#CA8A04', '#6B7280'\n]\n\nconst TOOL_PRESET: Record<Tool, { width: number; opacity: number; strokeType: WhiteboardStroke['type'] }> = {\n  pencil: { width: 2, opacity: 0.82, strokeType: 'pencil' },\n  pen: { width: 3, opacity: 1, strokeType: 'pen' },\n  marker: { width: 6, opacity: 0.9, strokeType: 'marker' },\n  highlighter: { width: 16, opacity: 0.22, strokeType: 'highlighter' },\n  calligraphy: { width: 5, opacity: 0.95, strokeType: 'calligraphy' },\n  eraser: { width: 24, opacity: 1, strokeType: 'eraser' },\n  line: { width: 3, opacity: 1, strokeType: 'shape' },\n  arrow: { width: 3, opacity: 1, strokeType: 'shape' },\n  rectangle: { width: 3, opacity: 1, strokeType: 'shape' },\n  circle: { width: 3, opacity: 1, strokeType: 'shape' },\n  triangle: { width: 3, opacity: 1, strokeType: 'shape' },\n  connector: { width: 3, opacity: 1, strokeType: 'shape' },\n  text: { width: 3, opacity: 1, strokeType: 'text' },\n  laser: { width: 3, opacity: 1, strokeType: 'pen' },\n  hand: { width: 3, opacity: 1, strokeType: 'pen' },\n  select: { width: 3, opacity: 1, strokeType: 'pen' },\n}\n\nconst DEFAULT_PAGE_ID = 'page-1'\ntype DrawPoint = { x: number; y: number; pressure?: number }\ntype ViewportState = { scale: number; offsetX: number; offsetY: number }\ntype ConnectorPort = 'top' | 'right' | 'bottom' | 'left' | 'center'\ntype ConnectorDragState = { strokeId: string; endpoint: 'source' | 'target' } | null\n\nexport function TutorWhiteboardManager({ roomId, sessionId, initialCourseId, classSubject, students, onDocumentVisibleToStudents }: TutorWhiteboardManagerProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const boardViewportRef = useRef<HTMLDivElement>(null)\n  const [tool, setTool] = useState<Tool>('pen')\n  const [color, setColor] = useState('#111827')\n  const [customColor, setCustomColor] = useState('#111827')\n  const [brushSize, setBrushSize] = useState(3)\n  const [isDrawing, setIsDrawing] = useState(false)\n  const [currentStroke, setCurrentStroke] = useState<DrawPoint[]>([])\n  const [shapeStart, setShapeStart] = useState<DrawPoint | null>(null)\n  const [shapePreview, setShapePreview] = useState<DrawPoint | null>(null)\n  const [laserPoint, setLaserPoint] = useState<{ x: number; y: number } | null>(null)\n  const [textDraft, setTextDraft] = useState<{ x: number; y: number; value: string } | null>(null)\n  const [fontSize, setFontSize] = useState(22)\n  const [viewport, setViewport] = useState<ViewportState>({ scale: 1, offsetX: 0, offsetY: 0 })\n  const [isPanning, setIsPanning] = useState(false)\n  const panStartRef = useRef<{ x: number; y: number; offsetX: number; offsetY: number } | null>(null)\n  const [selectionRect, setSelectionRect] = useState<{ x: number; y: number; width: number; height: number } | null>(null)\n  const [selectedStrokeIds, setSelectedStrokeIds] = useState<Set<string>>(new Set())\n  const [selectionMode, setSelectionMode] = useState<'rect' | 'lasso'>('rect')\n  const [selectionHitMode, setSelectionHitMode] = useState<'intersect' | 'contain'>('intersect')\n  const [lassoPath, setLassoPath] = useState<Array<{ x: number; y: number }> | null>(null)\n  const [isDraggingSelection, setIsDraggingSelection] = useState(false)\n  const [activeTransformHandle, setActiveTransformHandle] = useState<'nw' | 'ne' | 'sw' | 'se' | null>(null)\n  const transformRef = useRef<{ centerX: number; centerY: number; startDist: number } | null>(null)\n  const [isRotatingSelection, setIsRotatingSelection] = useState(false)\n  const rotateRef = useRef<{ centerX: number; centerY: number; startAngle: number } | null>(null)\n  const [connectorDrag, setConnectorDrag] = useState<ConnectorDragState>(null)\n  const dragStartRef = useRef<DrawPoint | null>(null)\n  const selectionSnapshotRef = useRef<Map<string, DrawPoint[]>>(new Map())\n  const [snapEnabled, setSnapEnabled] = useState(true)\n  const [gridVisible, setGridVisible] = useState(true)\n  const [gridSize, setGridSize] = useState(20)\n  const [checkpointName, setCheckpointName] = useState('')\n  const [namedCheckpoints, setNamedCheckpoints] = useState<Array<{ id: string; name: string; createdAt: number }>>([])\n  const [importedAsset, setImportedAsset] = useState<{ kind: 'image' | 'pdf'; src: string; name: string } | null>(null)\n  const [textPreset, setTextPreset] = useState<'plain' | 'latex' | 'code' | 'table' | 'sticky'>('plain')\n  const [textStyle, setTextStyle] = useState<{ bold: boolean; italic: boolean; align: 'left' | 'center' | 'right' }>({\n    bold: false,\n    italic: false,\n    align: 'left',\n  })\n  const [pdfPage, setPdfPage] = useState(1)\n  const [showMiniMap, setShowMiniMap] = useState(true)\n  const [showPerfHud, setShowPerfHud] = useState(false)\n  const [fps, setFps] = useState(0)\n  const [branchNameInput, setBranchNameInput] = useState('')\n  const [auditTrail, setAuditTrail] = useState<Array<{ at: number; action: string; details?: string }>>([])\n  const [srAnnouncement, setSrAnnouncement] = useState('')\n  const [activeTab, setActiveTab] = useState('my-board')\n  const [submissionFilter, setSubmissionFilter] = useState<'all' | 'submitted' | 'pending' | 'reviewed'>('all')\n  const [reviewStudentId, setReviewStudentId] = useState<string | null>(null)\n  const [isReviewPanelOpen, setIsReviewPanelOpen] = useState(false)\n  const [timelinePreviewIndex, setTimelinePreviewIndex] = useState<number | null>(null)\n  const [showHighContrast, setShowHighContrast] = useState(false)\n  const [pages, setPages] = useState<Array<{ id: string; label: string }>>([{ id: DEFAULT_PAGE_ID, label: 'Page 1' }])\n  const [activePageId, setActivePageId] = useState(DEFAULT_PAGE_ID)\n  \n  const {\n    myStrokes,\n    studentWhiteboards,\n    isBroadcasting,\n    isConnected,\n    viewingStudentId,\n    activeStudentBoards,\n    remoteCursors,\n    remoteSelections,\n    startBroadcast,\n    stopBroadcast,\n    viewStudentWhiteboard,\n    stopViewingStudent,\n    isLayerLocked,\n    submissions,\n    toggleLayerLock,\n    markSubmissionReviewed,\n    markAllSubmissionsReviewed,\n    pinSubmission,\n    clearMyWhiteboard,\n    replaceMyStrokes,\n    undoLastStroke,\n    updateCursor,\n    updateSelectionPresence,\n    addTutorStroke,\n    layerConfig,\n    activeLayerId,\n    setLayerConfig,\n    setActiveLayerId,\n    setLayerLock,\n    moderationState,\n    setDrawMuteForStudent,\n    updateStrokeRateLimit,\n    assignmentOverlay,\n    setAssignmentOverlayMode,\n    spotlight,\n    updateSpotlight,\n    requestAIRegionHint,\n    aiRegionHints,\n    snapshots,\n    availableBranches,\n    requestSnapshotTimeline,\n    promoteBreakoutBoard,\n    exportAndAttachBoard,\n    createBoardBranch,\n    switchBoardBranch\n  } = useLiveClassWhiteboard(roomId, sessionId, 'tutor')\n\n  const submissionByStudentId = new Map(submissions.map((submission) => [submission.studentId, submission]))\n  const pendingSubmissions = submissions.filter((submission) => !submission.reviewed)\n  const reviewSubmission = reviewStudentId ? submissionByStudentId.get(reviewStudentId) : undefined\n  const reviewStudent = reviewStudentId ? students.find((student) => student.id === reviewStudentId) : undefined\n  const reviewStudentBoard = reviewStudentId ? studentWhiteboards.get(reviewStudentId) : undefined\n  const visibleStudents = students.filter((student) => {\n    const submission = submissionByStudentId.get(student.id)\n    if (submissionFilter === 'all') return true\n    if (submissionFilter === 'submitted') return Boolean(submission)\n    if (submissionFilter === 'pending') return Boolean(submission && !submission.reviewed)\n    return Boolean(submission && submission.reviewed)\n  })\n  const timelineSource = useMemo(\n    () => (timelinePreviewIndex !== null ? snapshots[timelinePreviewIndex]?.strokes || [] : myStrokes),\n    [timelinePreviewIndex, snapshots, myStrokes]\n  )\n  const activePageStrokes = useMemo(\n    () => timelineSource.filter((stroke) => (stroke.pageId || DEFAULT_PAGE_ID) === activePageId),\n    [timelineSource, activePageId]\n  )\n  const activePageIndex = useMemo(\n    () => pages.findIndex((page) => page.id === activePageId),\n    [pages, activePageId]\n  )\n\n  const openReviewPanel = useCallback((studentId: string) => {\n    setReviewStudentId(studentId)\n    setIsReviewPanelOpen(true)\n    viewStudentWhiteboard(studentId)\n  }, [viewStudentWhiteboard])\n\n  const reviewNextPending = useCallback(() => {\n    if (!reviewStudentId) return\n    const currentIndex = pendingSubmissions.findIndex((submission) => submission.studentId === reviewStudentId)\n    const nextSubmission = pendingSubmissions[currentIndex + 1] || pendingSubmissions[0]\n    if (nextSubmission) {\n      setReviewStudentId(nextSubmission.studentId)\n      viewStudentWhiteboard(nextSubmission.studentId)\n    }\n  }, [pendingSubmissions, reviewStudentId, viewStudentWhiteboard])\n\n  const reviewPreviousPending = useCallback(() => {\n    if (!reviewStudentId || pendingSubmissions.length === 0) return\n    const currentIndex = pendingSubmissions.findIndex((submission) => submission.studentId === reviewStudentId)\n    const previousSubmission =\n      currentIndex > 0\n        ? pendingSubmissions[currentIndex - 1]\n        : pendingSubmissions[pendingSubmissions.length - 1]\n    if (previousSubmission) {\n      setReviewStudentId(previousSubmission.studentId)\n      viewStudentWhiteboard(previousSubmission.studentId)\n    }\n  }, [pendingSubmissions, reviewStudentId, viewStudentWhiteboard])\n\n  // Keyboard shortcuts for fast review workflow while panel is open.\n  useEffect(() => {\n    if (!isReviewPanelOpen) return\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if ((event.target as HTMLElement)?.tagName === 'INPUT' || (event.target as HTMLElement)?.tagName === 'TEXTAREA') {\n        return\n      }\n\n      if (event.key.toLowerCase() === 'r' && reviewSubmission && !reviewSubmission.reviewed) {\n        event.preventDefault()\n        markSubmissionReviewed(reviewSubmission.studentId)\n      }\n      if (event.key.toLowerCase() === 'j') {\n        event.preventDefault()\n        reviewNextPending()\n      }\n      if (event.key.toLowerCase() === 'k') {\n        event.preventDefault()\n        reviewPreviousPending()\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [isReviewPanelOpen, markSubmissionReviewed, reviewNextPending, reviewPreviousPending, reviewSubmission])\n\n  const shapeTools = useMemo(() => new Set<Tool>(['line', 'arrow', 'rectangle', 'circle', 'triangle', 'connector']), [])\n  const freeDrawTools = useMemo(() => new Set<Tool>(['pencil', 'pen', 'marker', 'highlighter', 'calligraphy', 'eraser']), [])\n\n  const drawShape = useCallback(\n    (\n      ctx: CanvasRenderingContext2D,\n      shapeType: NonNullable<WhiteboardStroke['shapeType']>,\n      from: { x: number; y: number },\n      to: { x: number; y: number },\n      stroke: Pick<WhiteboardStroke, 'color' | 'width' | 'opacity'>\n    ) => {\n      const x = Math.min(from.x, to.x)\n      const y = Math.min(from.y, to.y)\n      const width = Math.abs(to.x - from.x)\n      const height = Math.abs(to.y - from.y)\n      ctx.save()\n      ctx.globalAlpha = stroke.opacity ?? 1\n      ctx.strokeStyle = stroke.color\n      ctx.lineWidth = stroke.width\n      ctx.lineCap = 'round'\n      ctx.lineJoin = 'round'\n\n      if (shapeType === 'line' || shapeType === 'arrow' || shapeType === 'connector') {\n        ctx.beginPath()\n        ctx.moveTo(from.x, from.y)\n        ctx.lineTo(to.x, to.y)\n        ctx.stroke()\n        if (shapeType === 'connector') {\n          ctx.beginPath()\n          ctx.arc(from.x, from.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n          ctx.arc(to.x, to.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n          ctx.fillStyle = stroke.color\n          ctx.fill()\n        }\n        if (shapeType === 'arrow') {\n          const angle = Math.atan2(to.y - from.y, to.x - from.x)\n          const size = Math.max(10, stroke.width * 4)\n          ctx.beginPath()\n          ctx.moveTo(to.x, to.y)\n          ctx.lineTo(to.x - size * Math.cos(angle - Math.PI / 6), to.y - size * Math.sin(angle - Math.PI / 6))\n          ctx.lineTo(to.x - size * Math.cos(angle + Math.PI / 6), to.y - size * Math.sin(angle + Math.PI / 6))\n          ctx.closePath()\n          ctx.fillStyle = stroke.color\n          ctx.fill()\n        }\n      } else if (shapeType === 'rectangle') {\n        ctx.strokeRect(x, y, width, height)\n      } else if (shapeType === 'circle') {\n        ctx.beginPath()\n        ctx.ellipse(x + width / 2, y + height / 2, Math.max(2, width / 2), Math.max(2, height / 2), 0, 0, Math.PI * 2)\n        ctx.stroke()\n      } else if (shapeType === 'triangle') {\n        ctx.beginPath()\n        ctx.moveTo(x + width / 2, y)\n        ctx.lineTo(x + width, y + height)\n        ctx.lineTo(x, y + height)\n        ctx.closePath()\n        ctx.stroke()\n      }\n      ctx.restore()\n    },\n    []\n  )\n\n  const drawStroke = useCallback((ctx: CanvasRenderingContext2D, stroke: WhiteboardStroke) => {\n    if (stroke.type === 'text') {\n      const anchor = stroke.points[0]\n      if (!anchor || !stroke.text) return\n      ctx.save()\n      ctx.fillStyle = stroke.color\n      ctx.globalAlpha = stroke.opacity ?? 1\n      const textWeight = stroke.textStyle?.bold ? '700' : '400'\n      const textItalic = stroke.textStyle?.italic ? 'italic' : 'normal'\n      ctx.font = `${textItalic} ${textWeight} ${stroke.fontSize || fontSize}px ${stroke.fontFamily || 'ui-sans-serif, system-ui, sans-serif'}`\n      ctx.textBaseline = 'top'\n      ctx.textAlign = stroke.textStyle?.align || 'left'\n      ctx.fillText(stroke.text, anchor.x, anchor.y)\n      ctx.restore()\n      return\n    }\n\n    if (stroke.type === 'shape' && stroke.shapeType && stroke.points.length >= 2) {\n      if (stroke.shapeType === 'connector') {\n        ctx.save()\n        ctx.globalAlpha = stroke.opacity ?? 1\n        ctx.strokeStyle = stroke.color\n        ctx.lineWidth = stroke.width\n        ctx.lineJoin = 'round'\n        ctx.lineCap = 'round'\n        ctx.beginPath()\n        stroke.points.forEach((point, index) => {\n          if (index === 0) ctx.moveTo(point.x, point.y)\n          else ctx.lineTo(point.x, point.y)\n        })\n        ctx.stroke()\n        const first = stroke.points[0]\n        const last = stroke.points[stroke.points.length - 1]\n        ctx.beginPath()\n        ctx.arc(first.x, first.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n        ctx.arc(last.x, last.y, Math.max(3, stroke.width), 0, Math.PI * 2)\n        ctx.fillStyle = stroke.color\n        ctx.fill()\n        ctx.restore()\n        return\n      }\n      drawShape(ctx, stroke.shapeType, stroke.points[0], stroke.points[stroke.points.length - 1], stroke)\n      return\n    }\n\n    if (stroke.points.length < 2) return\n    ctx.save()\n    ctx.globalAlpha = stroke.opacity ?? 1\n    ctx.strokeStyle = stroke.color\n    ctx.lineCap = stroke.type === 'calligraphy' ? 'square' : 'round'\n    ctx.lineJoin = 'round'\n    for (let i = 1; i < stroke.points.length; i += 1) {\n      const prev = stroke.points[i - 1]\n      const point = stroke.points[i]\n      const pressure = typeof point.pressure === 'number' ? point.pressure : 0.5\n      ctx.lineWidth = Math.max(1, stroke.width * (0.55 + pressure * 0.9))\n      if (stroke.type === 'pencil') {\n        ctx.setLineDash([1, 1.5])\n      } else {\n        ctx.setLineDash([])\n      }\n      ctx.beginPath()\n      ctx.moveTo(prev.x, prev.y)\n      ctx.lineTo(point.x, point.y)\n      ctx.stroke()\n    }\n    ctx.restore()\n  }, [drawShape, fontSize])\n\n  const getStrokeBounds = useCallback((stroke: WhiteboardStroke) => {\n    if (stroke.type === 'text') {\n      const anchor = stroke.points[0]\n      if (!anchor) return null\n      const width = Math.max(80, (stroke.text?.length || 0) * ((stroke.fontSize || fontSize) * 0.55))\n      const height = (stroke.fontSize || fontSize) * 1.4\n      return { x: anchor.x, y: anchor.y, width, height }\n    }\n    if (!stroke.points.length) return null\n    const xs = stroke.points.map((point) => point.x)\n    const ys = stroke.points.map((point) => point.y)\n    const minX = Math.min(...xs)\n    const minY = Math.min(...ys)\n    const maxX = Math.max(...xs)\n    const maxY = Math.max(...ys)\n    const pad = Math.max(8, stroke.width)\n    return { x: minX - pad, y: minY - pad, width: maxX - minX + pad * 2, height: maxY - minY + pad * 2 }\n  }, [fontSize])\n\n  const pointInPolygon = useCallback((point: { x: number; y: number }, polygon: Array<{ x: number; y: number }>) => {\n    let inside = false\n    for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n      const xi = polygon[i].x\n      const yi = polygon[i].y\n      const xj = polygon[j].x\n      const yj = polygon[j].y\n      const intersect = ((yi > point.y) !== (yj > point.y)) &&\n        point.x < ((xj - xi) * (point.y - yi)) / ((yj - yi) || 1e-6) + xi\n      if (intersect) inside = !inside\n    }\n    return inside\n  }, [])\n\n  const routeOrthogonalConnector = useCallback((from: DrawPoint, to: DrawPoint, obstacles: Array<{ x: number; y: number; width: number; height: number }>) => {\n    const pad = 18\n    const inflate = (b: { x: number; y: number; width: number; height: number }) => ({\n      x: b.x - pad,\n      y: b.y - pad,\n      width: b.width + pad * 2,\n      height: b.height + pad * 2,\n    })\n    const inflated = obstacles.map(inflate)\n    const segmentHitsRect = (a: DrawPoint, b: DrawPoint, r: { x: number; y: number; width: number; height: number }) => {\n      const minX = Math.min(a.x, b.x)\n      const maxX = Math.max(a.x, b.x)\n      const minY = Math.min(a.y, b.y)\n      const maxY = Math.max(a.y, b.y)\n      return maxX >= r.x && minX <= r.x + r.width && maxY >= r.y && minY <= r.y + r.height\n    }\n    const clearSegment = (a: DrawPoint, b: DrawPoint) => inflated.every((r) => !segmentHitsRect(a, b, r))\n    const bestL = (firstHorizontal: boolean) => {\n      const mid: DrawPoint = firstHorizontal ? { x: to.x, y: from.y } : { x: from.x, y: to.y }\n      return [from, mid, to]\n    }\n    const candidates: DrawPoint[][] = [\n      bestL(true),\n      bestL(false),\n      [from, { x: from.x, y: from.y - 80 }, { x: to.x, y: from.y - 80 }, to],\n      [from, { x: from.x, y: from.y + 80 }, { x: to.x, y: from.y + 80 }, to],\n      [from, { x: from.x - 80, y: from.y }, { x: from.x - 80, y: to.y }, to],\n      [from, { x: from.x + 80, y: from.y }, { x: from.x + 80, y: to.y }, to],\n    ]\n    const pathCost = (path: DrawPoint[]) =>\n      path.reduce((acc, point, i) => i === 0 ? 0 : acc + Math.abs(point.x - path[i - 1].x) + Math.abs(point.y - path[i - 1].y), 0)\n    const valid = candidates\n      .map((path) => ({\n        path,\n        ok: path.every((p, i) => i === 0 || clearSegment(path[i - 1], p)),\n        cost: pathCost(path),\n      }))\n      .filter((p) => p.ok)\n      .sort((a, b) => a.cost - b.cost)\n    return (valid[0]?.path || bestL(true)).map((p) => ({ x: p.x, y: p.y }))\n  }, [])\n\n  const getPortAnchors = useCallback((bounds: { x: number; y: number; width: number; height: number }) => ({\n    top: { x: bounds.x + bounds.width / 2, y: bounds.y },\n    right: { x: bounds.x + bounds.width, y: bounds.y + bounds.height / 2 },\n    bottom: { x: bounds.x + bounds.width / 2, y: bounds.y + bounds.height },\n    left: { x: bounds.x, y: bounds.y + bounds.height / 2 },\n    center: { x: bounds.x + bounds.width / 2, y: bounds.y + bounds.height / 2 },\n  }), [])\n\n  const closestPortForPoint = useCallback((point: DrawPoint, bounds: { x: number; y: number; width: number; height: number }) => {\n    const anchors = getPortAnchors(bounds)\n    let bestPort: ConnectorPort = 'center'\n    let best = anchors.center\n    let bestDist = Number.POSITIVE_INFINITY\n    ;(Object.keys(anchors) as ConnectorPort[]).forEach((port) => {\n      const candidate = anchors[port]\n      const dx = candidate.x - point.x\n      const dy = candidate.y - point.y\n      const dist = Math.sqrt(dx * dx + dy * dy)\n      if (dist < bestDist) {\n        bestDist = dist\n        bestPort = port\n        best = candidate\n      }\n    })\n    return { port: bestPort, anchor: best, distance: bestDist }\n  }, [getPortAnchors])\n\n  const resolveConnectorEndpoint = useCallback((point: DrawPoint, strokes: WhiteboardStroke[]) => {\n    let best: {\n      strokeId?: string\n      port?: ConnectorPort\n      anchor: DrawPoint\n      distance: number\n    } = {\n      anchor: point,\n      distance: Number.POSITIVE_INFINITY,\n    }\n    strokes\n      .filter((stroke) => stroke.shapeType !== 'connector')\n      .forEach((stroke) => {\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return\n        const candidate = closestPortForPoint(point, bounds)\n        if (candidate.distance < best.distance) {\n          best = {\n            strokeId: stroke.id,\n            port: candidate.port,\n            anchor: candidate.anchor,\n            distance: candidate.distance,\n          }\n        }\n      })\n    if (best.distance <= 56 && best.strokeId && best.port) {\n      return {\n        point: best.anchor,\n        sourceStrokeId: best.strokeId,\n        sourcePort: best.port,\n      }\n    }\n    return { point }\n  }, [closestPortForPoint, getStrokeBounds])\n\n  const getSelectedBounds = useCallback((selectedIds: Set<string>) => {\n    const selectedBounds = activePageStrokes\n      .filter((stroke) => selectedIds.has(stroke.id))\n      .map((stroke) => getStrokeBounds(stroke))\n      .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n    if (!selectedBounds.length) return null\n    const minX = Math.min(...selectedBounds.map((bounds) => bounds.x))\n    const minY = Math.min(...selectedBounds.map((bounds) => bounds.y))\n    const maxX = Math.max(...selectedBounds.map((bounds) => bounds.x + bounds.width))\n    const maxY = Math.max(...selectedBounds.map((bounds) => bounds.y + bounds.height))\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY }\n  }, [activePageStrokes, getStrokeBounds])\n\n  const nudgeSelection = useCallback((dx: number, dy: number) => {\n    if (selectedStrokeIds.size === 0) return\n    replaceMyStrokes((prev) =>\n      prev.map((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return stroke\n        if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n        return {\n          ...stroke,\n          points: stroke.points.map((point) => ({\n            ...point,\n            x: snapEnabled ? Math.round((point.x + dx) / gridSize) * gridSize : point.x + dx,\n            y: snapEnabled ? Math.round((point.y + dy) / gridSize) * gridSize : point.y + dy,\n          })),\n        }\n      }),\n    )\n  }, [activePageId, gridSize, replaceMyStrokes, selectedStrokeIds, snapEnabled])\n\n  const scaleSelection = useCallback((factor: number) => {\n    if (selectedStrokeIds.size === 0) return\n    const bounds = getSelectedBounds(selectedStrokeIds)\n    if (!bounds) return\n    const centerX = bounds.x + bounds.width / 2\n    const centerY = bounds.y + bounds.height / 2\n    replaceMyStrokes((prev) =>\n      prev.map((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return stroke\n        if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n        return {\n          ...stroke,\n          points: stroke.points.map((point) => ({\n            ...point,\n            x: snapEnabled\n              ? Math.round((centerX + (point.x - centerX) * factor) / gridSize) * gridSize\n              : centerX + (point.x - centerX) * factor,\n            y: snapEnabled\n              ? Math.round((centerY + (point.y - centerY) * factor) / gridSize) * gridSize\n              : centerY + (point.y - centerY) * factor,\n          })),\n        }\n      }),\n    )\n  }, [activePageId, getSelectedBounds, gridSize, replaceMyStrokes, selectedStrokeIds, snapEnabled])\n\n  const logAudit = useCallback((action: string, details?: string) => {\n    const entry = { at: Date.now(), action, details }\n    setAuditTrail((prev) => [entry, ...prev].slice(0, 80))\n    setSrAnnouncement(`${action}${details ? `: ${details}` : ''}`)\n  }, [])\n\n  const updateSelectedStrokes = useCallback((updater: (stroke: WhiteboardStroke, index: number) => WhiteboardStroke) => {\n    replaceMyStrokes((prev) => prev.map((stroke, index) => {\n      if (!selectedStrokeIds.has(stroke.id)) return stroke\n      if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n      if (stroke.locked) return stroke\n      return updater(stroke, index)\n    }))\n  }, [activePageId, replaceMyStrokes, selectedStrokeIds])\n\n  const groupSelection = useCallback(() => {\n    if (selectedStrokeIds.size < 2) return\n    const gid = `group-${Date.now()}`\n    updateSelectedStrokes((stroke) => ({ ...stroke, groupId: gid, updatedAt: Date.now() }))\n    logAudit('Grouped selection', gid)\n  }, [logAudit, selectedStrokeIds.size, updateSelectedStrokes])\n\n  const ungroupSelection = useCallback(() => {\n    if (selectedStrokeIds.size === 0) return\n    updateSelectedStrokes((stroke) => ({ ...stroke, groupId: undefined, updatedAt: Date.now() }))\n    logAudit('Ungrouped selection')\n  }, [logAudit, selectedStrokeIds.size, updateSelectedStrokes])\n\n  const lockSelection = useCallback((locked: boolean) => {\n    updateSelectedStrokes((stroke) => ({ ...stroke, locked, updatedAt: Date.now() }))\n    logAudit(locked ? 'Locked selection' : 'Unlocked selection')\n  }, [logAudit, updateSelectedStrokes])\n\n  const duplicateSelection = useCallback(() => {\n    if (selectedStrokeIds.size === 0) return\n    replaceMyStrokes((prev) => {\n      const duplicates = prev\n        .filter((stroke) => selectedStrokeIds.has(stroke.id) && (stroke.pageId || DEFAULT_PAGE_ID) === activePageId)\n        .map((stroke) => ({\n          ...stroke,\n          id: `${stroke.id}-dup-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`,\n          points: stroke.points.map((p) => ({ ...p, x: p.x + 24, y: p.y + 24 })),\n          zIndex: (stroke.zIndex || 0) + 1,\n          locked: false,\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        }))\n      return [...prev, ...duplicates]\n    })\n    logAudit('Duplicated selection')\n  }, [activePageId, logAudit, replaceMyStrokes, selectedStrokeIds])\n\n  const reorderSelection = useCallback((mode: 'front' | 'forward' | 'back') => {\n    replaceMyStrokes((prev) => {\n      const maxZ = Math.max(0, ...prev.map((stroke) => stroke.zIndex || 0))\n      const minZ = Math.min(0, ...prev.map((stroke) => stroke.zIndex || 0))\n      return prev.map((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return stroke\n        if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n        const z = stroke.zIndex || 0\n        if (mode === 'front') return { ...stroke, zIndex: maxZ + 1, updatedAt: Date.now() }\n        if (mode === 'forward') return { ...stroke, zIndex: z + 1, updatedAt: Date.now() }\n        return { ...stroke, zIndex: minZ - 1, updatedAt: Date.now() }\n      })\n    })\n    logAudit('Reordered selection', mode)\n  }, [activePageId, logAudit, replaceMyStrokes, selectedStrokeIds])\n\n  const pushSelectionAsExemplar = useCallback(() => {\n    if (!selectedStrokeIds.size) return\n    replaceMyStrokes((prev) => {\n      const maxZ = Math.max(0, ...prev.map((stroke) => stroke.zIndex || 0))\n      const copies = prev\n        .filter((stroke) => selectedStrokeIds.has(stroke.id))\n        .map((stroke, index) => ({\n          ...stroke,\n          id: `${stroke.id}-exemplar-${Date.now()}-${index}`,\n          layerId: 'tutor-broadcast' as const,\n          zIndex: maxZ + 10 + index,\n          updatedAt: Date.now(),\n          createdAt: Date.now(),\n        }))\n      return [...prev, ...copies]\n    })\n    logAudit('Pushed exemplar to broadcast layer')\n  }, [logAudit, replaceMyStrokes, selectedStrokeIds])\n\n  const broadcastViewport = useCallback(() => {\n    updateSpotlight({\n      ...spotlight,\n      enabled: true,\n      x: Math.max(0, -viewport.offsetX / Math.max(0.1, viewport.scale)),\n      y: Math.max(0, -viewport.offsetY / Math.max(0.1, viewport.scale)),\n      width: 420 / Math.max(0.6, viewport.scale),\n      height: 260 / Math.max(0.6, viewport.scale),\n    })\n    logAudit('Broadcasted viewport')\n  }, [logAudit, spotlight, updateSpotlight, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const exportSvg = useCallback(() => {\n    const strokes = activePageStrokes\n    const width = 1600\n    const height = 900\n    const content = strokes.map((stroke) => {\n      if (stroke.type === 'text') {\n        const p = stroke.points[0]\n        if (!p || !stroke.text) return ''\n        return `<text x=\"${p.x}\" y=\"${p.y}\" fill=\"${stroke.color}\" font-size=\"${stroke.fontSize || 20}\">${stroke.text.replace(/&/g, '&amp;').replace(/</g, '&lt;')}</text>`\n      }\n      const d = stroke.points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ')\n      return `<path d=\"${d}\" fill=\"none\" stroke=\"${stroke.color}\" stroke-width=\"${stroke.width}\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />`\n    }).join('\\n')\n    const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">${content}</svg>`\n    const blob = new Blob([svg], { type: 'image/svg+xml' })\n    const href = URL.createObjectURL(blob)\n    const anchor = document.createElement('a')\n    anchor.href = href\n    anchor.download = `whiteboard_${roomId}_${Date.now()}.svg`\n    anchor.click()\n    URL.revokeObjectURL(href)\n    logAudit('Exported SVG')\n  }, [activePageStrokes, logAudit, roomId])\n\n  const selectByAttribute = useCallback((attribute: 'color' | 'type' | 'layer') => {\n    const seed = activePageStrokes.find((stroke) => selectedStrokeIds.has(stroke.id))\n    if (!seed) return\n    const selected = new Set<string>()\n    activePageStrokes.forEach((stroke) => {\n      if (attribute === 'color' && stroke.color === seed.color) selected.add(stroke.id)\n      if (attribute === 'type' && stroke.type === seed.type) selected.add(stroke.id)\n      if (attribute === 'layer' && (stroke.layerId || 'tutor-broadcast') === (seed.layerId || 'tutor-broadcast')) selected.add(stroke.id)\n    })\n    setSelectedStrokeIds(selected)\n  }, [activePageStrokes, selectedStrokeIds])\n\n  const selectedBounds = useMemo(() => getSelectedBounds(selectedStrokeIds), [getSelectedBounds, selectedStrokeIds])\n  const activeSelectedConnector = useMemo(() => {\n    if (selectedStrokeIds.size !== 1) return null\n    const id = Array.from(selectedStrokeIds)[0]\n    const stroke = activePageStrokes.find((item) => item.id === id)\n    if (!stroke || stroke.shapeType !== 'connector' || stroke.points.length < 2) return null\n    return stroke\n  }, [activePageStrokes, selectedStrokeIds])\n\n  const getConnectorScreenEndpoints = useCallback((stroke: WhiteboardStroke, strokes: WhiteboardStroke[]) => {\n    let sourcePoint = stroke.points[0]\n    let targetPoint = stroke.points[stroke.points.length - 1]\n    if (stroke.sourceStrokeId && stroke.sourcePort) {\n      const sourceStroke = strokes.find((item) => item.id === stroke.sourceStrokeId)\n      const bounds = sourceStroke ? getStrokeBounds(sourceStroke) : null\n      if (bounds) sourcePoint = getPortAnchors(bounds)[stroke.sourcePort]\n    }\n    if (stroke.targetStrokeId && stroke.targetPort) {\n      const targetStroke = strokes.find((item) => item.id === stroke.targetStrokeId)\n      const bounds = targetStroke ? getStrokeBounds(targetStroke) : null\n      if (bounds) targetPoint = getPortAnchors(bounds)[stroke.targetPort]\n    }\n    return {\n      source: {\n        x: sourcePoint.x * viewport.scale + viewport.offsetX,\n        y: sourcePoint.y * viewport.scale + viewport.offsetY,\n      },\n      target: {\n        x: targetPoint.x * viewport.scale + viewport.offsetX,\n        y: targetPoint.y * viewport.scale + viewport.offsetY,\n      },\n    }\n  }, [getPortAnchors, getStrokeBounds, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const hitTestConnectorEndpointHandle = useCallback((screenX: number, screenY: number) => {\n    if (!activeSelectedConnector) return null\n    const endpoints = getConnectorScreenEndpoints(activeSelectedConnector, activePageStrokes)\n    const radius = 10\n    const sourceDist = Math.hypot(screenX - endpoints.source.x, screenY - endpoints.source.y)\n    if (sourceDist <= radius) return { strokeId: activeSelectedConnector.id, endpoint: 'source' as const }\n    const targetDist = Math.hypot(screenX - endpoints.target.x, screenY - endpoints.target.y)\n    if (targetDist <= radius) return { strokeId: activeSelectedConnector.id, endpoint: 'target' as const }\n    return null\n  }, [activePageStrokes, activeSelectedConnector, getConnectorScreenEndpoints])\n\n  useEffect(() => {\n    updateSelectionPresence(Array.from(selectedStrokeIds), activePageId, '#0ea5e9')\n  }, [activePageId, selectedStrokeIds, updateSelectionPresence])\n\n  useEffect(() => {\n    replaceMyStrokes((prev) => {\n      const activeStrokes = prev.filter((stroke) => (stroke.pageId || DEFAULT_PAGE_ID) === activePageId)\n      const byId = new Map(activeStrokes.map((stroke) => [stroke.id, stroke]))\n      const obstacles = activeStrokes\n        .filter((stroke) => stroke.shapeType !== 'connector')\n        .map((stroke) => getStrokeBounds(stroke))\n        .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n      let changed = false\n      const next: WhiteboardStroke[] = []\n      prev.forEach((stroke) => {\n        if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId || stroke.shapeType !== 'connector') {\n          next.push(stroke)\n          return\n        }\n        if (!stroke.sourceStrokeId || !stroke.targetStrokeId || !stroke.sourcePort || !stroke.targetPort) {\n          next.push(stroke)\n          return\n        }\n        const source = byId.get(stroke.sourceStrokeId)\n        const target = byId.get(stroke.targetStrokeId)\n        if (!source || !target) {\n          changed = true\n          return\n        }\n        const sourceBounds = getStrokeBounds(source)\n        const targetBounds = getStrokeBounds(target)\n        if (!sourceBounds || !targetBounds) {\n          next.push(stroke)\n          return\n        }\n        const from = getPortAnchors(sourceBounds)[stroke.sourcePort]\n        const to = getPortAnchors(targetBounds)[stroke.targetPort]\n        const rerouted = routeOrthogonalConnector(from, to, obstacles)\n        const same =\n          stroke.points.length === rerouted.length &&\n          stroke.points.every((point, index) => {\n            const nextPoint = rerouted[index]\n            return Math.abs(point.x - nextPoint.x) < 0.5 && Math.abs(point.y - nextPoint.y) < 0.5\n          })\n        if (same) {\n          next.push(stroke)\n          return\n        }\n        changed = true\n        next.push({\n          ...stroke,\n          points: rerouted,\n          updatedAt: Date.now(),\n        })\n      })\n      return changed ? next : prev\n    })\n  }, [activePageId, activePageStrokes, getPortAnchors, getStrokeBounds, replaceMyStrokes, routeOrthogonalConnector])\n\n  const hitTestSelectionHandle = useCallback((screenX: number, screenY: number) => {\n    if (!selectedBounds) return null\n    const corners: Array<{ id: 'nw' | 'ne' | 'sw' | 'se'; x: number; y: number }> = [\n      { id: 'nw', x: selectedBounds.x, y: selectedBounds.y },\n      { id: 'ne', x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y },\n      { id: 'sw', x: selectedBounds.x, y: selectedBounds.y + selectedBounds.height },\n      { id: 'se', x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y + selectedBounds.height },\n    ]\n    const radius = 10\n    for (const corner of corners) {\n      const screen = {\n        x: corner.x * viewport.scale + viewport.offsetX,\n        y: corner.y * viewport.scale + viewport.offsetY,\n      }\n      const dx = screenX - screen.x\n      const dy = screenY - screen.y\n      if (Math.sqrt(dx * dx + dy * dy) <= radius) return corner.id\n    }\n    const rotateScreen = {\n      x: (selectedBounds.x + selectedBounds.width / 2) * viewport.scale + viewport.offsetX,\n      y: (selectedBounds.y - 36) * viewport.scale + viewport.offsetY,\n    }\n    const rdx = screenX - rotateScreen.x\n    const rdy = screenY - rotateScreen.y\n    if (Math.sqrt(rdx * rdx + rdy * rdy) <= 11) return 'rotate'\n    return null\n  }, [selectedBounds, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const redrawCanvas = useCallback(() => {\n    const canvas = canvasRef.current\n    const ctx = canvas?.getContext('2d')\n    if (!canvas || !ctx) return\n    \n    // Clear canvas\n    ctx.fillStyle = '#ffffff'\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    if (gridVisible) {\n      ctx.save()\n      ctx.strokeStyle = 'rgba(148, 163, 184, 0.18)'\n      ctx.lineWidth = 1\n      for (let x = 0; x < canvas.width; x += gridSize) {\n        ctx.beginPath()\n        ctx.moveTo(x, 0)\n        ctx.lineTo(x, canvas.height)\n        ctx.stroke()\n      }\n      for (let y = 0; y < canvas.height; y += gridSize) {\n        ctx.beginPath()\n        ctx.moveTo(0, y)\n        ctx.lineTo(canvas.width, y)\n        ctx.stroke()\n      }\n      ctx.restore()\n    }\n\n    ctx.save()\n    ctx.translate(viewport.offsetX, viewport.offsetY)\n    ctx.scale(viewport.scale, viewport.scale)\n\n    const visibleLayerIds = new Set(layerConfig.filter((layer) => layer.visible).map((layer) => layer.id))\n    const worldViewport = {\n      left: (-viewport.offsetX) / viewport.scale,\n      top: (-viewport.offsetY) / viewport.scale,\n      right: (canvas.width - viewport.offsetX) / viewport.scale,\n      bottom: (canvas.height - viewport.offsetY) / viewport.scale,\n    }\n    const isBoundsVisible = (bounds: { x: number; y: number; width: number; height: number } | null) => {\n      if (!bounds) return true\n      return (\n        bounds.x <= worldViewport.right &&\n        bounds.x + bounds.width >= worldViewport.left &&\n        bounds.y <= worldViewport.bottom &&\n        bounds.y + bounds.height >= worldViewport.top\n      )\n    }\n    const orderedStrokes = [...activePageStrokes].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0))\n    orderedStrokes.forEach(stroke => {\n      const strokeLayer = stroke.layerId || 'tutor-broadcast'\n      const bounds = getStrokeBounds(stroke)\n      if (!isBoundsVisible(bounds)) return\n      if (visibleLayerIds.has(strokeLayer)) {\n        drawStroke(ctx, stroke)\n        if (stroke.locked) {\n          if (bounds) {\n            ctx.save()\n            ctx.strokeStyle = 'rgba(220, 38, 38, 0.7)'\n            ctx.setLineDash([4, 4])\n            ctx.lineWidth = 1\n            ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height)\n            ctx.restore()\n          }\n        }\n        if (selectedStrokeIds.has(stroke.id)) {\n          if (bounds) {\n            ctx.save()\n            ctx.strokeStyle = '#2563eb'\n            ctx.setLineDash([6, 4])\n            ctx.lineWidth = 1.5 / Math.max(0.4, viewport.scale)\n            ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height)\n            ctx.restore()\n          }\n        }\n      }\n    })\n    remoteSelections.forEach((presence) => {\n      if (presence.pageId && presence.pageId !== activePageId) return\n      presence.strokeIds.forEach((id) => {\n        const stroke = activePageStrokes.find((entry) => entry.id === id)\n        if (!stroke) return\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds || !isBoundsVisible(bounds)) return\n        ctx.save()\n        ctx.strokeStyle = presence.color || '#f59e0b'\n        ctx.setLineDash([4, 4])\n        ctx.lineWidth = 1.25 / Math.max(0.4, viewport.scale)\n        ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height)\n        ctx.restore()\n      })\n    })\n\n    if (isDrawing && currentStroke.length > 1 && freeDrawTools.has(tool)) {\n      const previewStroke: WhiteboardStroke = {\n        id: 'preview',\n        points: currentStroke,\n        color: tool === 'eraser' ? '#ffffff' : color,\n        width: tool === 'eraser' ? TOOL_PRESET.eraser.width : brushSize,\n        opacity: TOOL_PRESET[tool].opacity,\n        type: TOOL_PRESET[tool].strokeType,\n        userId: 'preview',\n      }\n      drawStroke(ctx, previewStroke)\n    }\n\n    if (shapeStart && shapePreview && shapeTools.has(tool)) {\n      const preset = TOOL_PRESET[tool]\n      drawShape(ctx, tool as NonNullable<WhiteboardStroke['shapeType']>, shapeStart, shapePreview, {\n        color,\n        width: Math.max(1, brushSize),\n        opacity: preset.opacity,\n      })\n    }\n\n    if (laserPoint) {\n      ctx.save()\n      ctx.globalAlpha = 0.9\n      const gradient = ctx.createRadialGradient(laserPoint.x, laserPoint.y, 1, laserPoint.x, laserPoint.y, 28)\n      gradient.addColorStop(0, 'rgba(239,68,68,0.95)')\n      gradient.addColorStop(1, 'rgba(239,68,68,0)')\n      ctx.fillStyle = gradient\n      ctx.beginPath()\n      ctx.arc(laserPoint.x, laserPoint.y, 28, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.restore()\n    }\n    ctx.restore()\n\n    if (selectionRect) {\n      ctx.save()\n      ctx.strokeStyle = '#2563eb'\n      ctx.fillStyle = 'rgba(37, 99, 235, 0.08)'\n      ctx.setLineDash([6, 3])\n      const x = Math.min(selectionRect.x, selectionRect.x + selectionRect.width)\n      const y = Math.min(selectionRect.y, selectionRect.y + selectionRect.height)\n      const width = Math.abs(selectionRect.width)\n      const height = Math.abs(selectionRect.height)\n      ctx.strokeRect(x, y, width, height)\n      ctx.fillRect(x, y, width, height)\n      ctx.restore()\n    }\n    if (lassoPath && lassoPath.length > 1) {\n      ctx.save()\n      ctx.strokeStyle = '#2563eb'\n      ctx.fillStyle = 'rgba(37, 99, 235, 0.08)'\n      ctx.setLineDash([6, 3])\n      ctx.beginPath()\n      lassoPath.forEach((point, index) => {\n        const screen = {\n          x: point.x * viewport.scale + viewport.offsetX,\n          y: point.y * viewport.scale + viewport.offsetY,\n        }\n        if (index === 0) ctx.moveTo(screen.x, screen.y)\n        else ctx.lineTo(screen.x, screen.y)\n      })\n      ctx.closePath()\n      ctx.stroke()\n      ctx.fill()\n      ctx.restore()\n    }\n    if (selectedBounds) {\n      const corners: Array<{ x: number; y: number }> = [\n        { x: selectedBounds.x, y: selectedBounds.y },\n        { x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y },\n        { x: selectedBounds.x, y: selectedBounds.y + selectedBounds.height },\n        { x: selectedBounds.x + selectedBounds.width, y: selectedBounds.y + selectedBounds.height },\n      ]\n      ctx.save()\n      ctx.fillStyle = '#2563eb'\n      corners.forEach((corner) => {\n        const screenX = corner.x * viewport.scale + viewport.offsetX\n        const screenY = corner.y * viewport.scale + viewport.offsetY\n        ctx.beginPath()\n        ctx.arc(screenX, screenY, 5, 0, Math.PI * 2)\n        ctx.fill()\n      })\n      const centerX = (selectedBounds.x + selectedBounds.width / 2) * viewport.scale + viewport.offsetX\n      const topY = selectedBounds.y * viewport.scale + viewport.offsetY\n      const rotateY = (selectedBounds.y - 36) * viewport.scale + viewport.offsetY\n      ctx.strokeStyle = '#2563eb'\n      ctx.beginPath()\n      ctx.moveTo(centerX, topY)\n      ctx.lineTo(centerX, rotateY + 8)\n      ctx.stroke()\n      ctx.beginPath()\n      ctx.arc(centerX, rotateY, 6, 0, Math.PI * 2)\n      ctx.fillStyle = '#0ea5e9'\n      ctx.fill()\n      ctx.restore()\n    }\n    if (activeSelectedConnector) {\n      const endpoints = getConnectorScreenEndpoints(activeSelectedConnector, activePageStrokes)\n      ctx.save()\n      ctx.fillStyle = '#0ea5e9'\n      ctx.strokeStyle = '#0369a1'\n      ctx.lineWidth = 2\n      ctx.beginPath()\n      ctx.arc(endpoints.source.x, endpoints.source.y, 7, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.stroke()\n      ctx.fillStyle = '#22c55e'\n      ctx.strokeStyle = '#15803d'\n      ctx.beginPath()\n      ctx.arc(endpoints.target.x, endpoints.target.y, 7, 0, Math.PI * 2)\n      ctx.fill()\n      ctx.stroke()\n      ctx.restore()\n    }\n  }, [activePageId, activePageStrokes, activeSelectedConnector, brushSize, color, currentStroke, drawShape, drawStroke, freeDrawTools, getConnectorScreenEndpoints, getStrokeBounds, gridSize, gridVisible, isDrawing, lassoPath, laserPoint, layerConfig, remoteSelections, selectedBounds, selectedStrokeIds, selectionRect, shapePreview, shapeStart, shapeTools, tool, viewport.offsetX, viewport.offsetY, viewport.scale])\n  \n  // Canvas setup\n  useEffect(() => {\n    const canvas = canvasRef.current\n    if (!canvas) return\n    \n    const resizeCanvas = () => {\n      const parent = canvas.parentElement\n      if (parent) {\n        canvas.width = parent.clientWidth\n        canvas.height = parent.clientHeight\n      }\n      redrawCanvas()\n    }\n    \n    resizeCanvas()\n    window.addEventListener('resize', resizeCanvas)\n    return () => window.removeEventListener('resize', resizeCanvas)\n  }, [redrawCanvas])\n  \n  // Redraw canvas when strokes change\n  useEffect(() => {\n    redrawCanvas()\n  }, [redrawCanvas])\n  \n  const getCanvasPoint = (e: React.PointerEvent<HTMLCanvasElement>): DrawPoint => {\n    const canvas = canvasRef.current\n    if (!canvas) return { x: 0, y: 0 }\n    const rect = canvas.getBoundingClientRect()\n    const screenX = e.clientX - rect.left\n    const screenY = e.clientY - rect.top\n    return {\n      x: (screenX - viewport.offsetX) / viewport.scale,\n      y: (screenY - viewport.offsetY) / viewport.scale,\n      pressure: e.pointerType === 'mouse' ? 0.5 : (e.pressure || 0.5),\n    }\n  }\n\n  const pointerToScreen = useCallback((point: DrawPoint) => ({\n    x: point.x * viewport.scale + viewport.offsetX,\n    y: point.y * viewport.scale + viewport.offsetY,\n  }), [viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const handlePointerDown = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    const target = e.currentTarget\n    target.setPointerCapture(e.pointerId)\n    const point = getCanvasPoint(e)\n    const screenPoint = pointerToScreen(point)\n    if (tool === 'hand') {\n      setIsPanning(true)\n      panStartRef.current = {\n        x: e.clientX,\n        y: e.clientY,\n        offsetX: viewport.offsetX,\n        offsetY: viewport.offsetY,\n      }\n      return\n    }\n    if (tool === 'select') {\n      const connectorHandle = hitTestConnectorEndpointHandle(screenPoint.x, screenPoint.y)\n      if (connectorHandle) {\n        setConnectorDrag(connectorHandle)\n        return\n      }\n      if (e.altKey) {\n        const hitStroke = [...activePageStrokes].reverse().find((stroke) => {\n          const bounds = getStrokeBounds(stroke)\n          if (!bounds) return false\n          return point.x >= bounds.x && point.x <= bounds.x + bounds.width && point.y >= bounds.y && point.y <= bounds.y + bounds.height\n        })\n        if (hitStroke) {\n          setSelectedStrokeIds((prev) => {\n            const next = new Set(prev)\n            if (next.has(hitStroke.id)) next.delete(hitStroke.id)\n            else next.add(hitStroke.id)\n            return next\n          })\n        }\n        return\n      }\n      const handle = hitTestSelectionHandle(screenPoint.x, screenPoint.y)\n      if (handle) {\n        if (selectedBounds) {\n          const centerX = selectedBounds.x + selectedBounds.width / 2\n          const centerY = selectedBounds.y + selectedBounds.height / 2\n          selectionSnapshotRef.current = new Map(\n            activePageStrokes\n              .filter((stroke) => selectedStrokeIds.has(stroke.id))\n              .map((stroke) => [stroke.id, stroke.points.map((p) => ({ ...p }))]),\n          )\n          if (handle === 'rotate') {\n            rotateRef.current = { centerX, centerY, startAngle: Math.atan2(point.y - centerY, point.x - centerX) }\n            setIsRotatingSelection(true)\n          } else {\n            const startDist = Math.max(1, Math.hypot(point.x - centerX, point.y - centerY))\n            transformRef.current = { centerX, centerY, startDist }\n            setActiveTransformHandle(handle)\n          }\n          return\n        }\n      }\n      const hitSelectedStroke = activePageStrokes.some((stroke) => {\n        if (!selectedStrokeIds.has(stroke.id)) return false\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return false\n        return (\n          point.x >= bounds.x &&\n          point.x <= bounds.x + bounds.width &&\n          point.y >= bounds.y &&\n          point.y <= bounds.y + bounds.height\n        )\n      })\n      if (hitSelectedStroke) {\n        const snapshot = new Map<string, DrawPoint[]>()\n        activePageStrokes.forEach((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return\n          snapshot.set(stroke.id, stroke.points.map((p) => ({ ...p })))\n        })\n        selectionSnapshotRef.current = snapshot\n        dragStartRef.current = point\n        setIsDraggingSelection(true)\n      } else if (selectionMode === 'lasso') {\n        setLassoPath([point])\n        setSelectionRect(null)\n      } else {\n        setSelectionRect({ x: screenPoint.x, y: screenPoint.y, width: 0, height: 0 })\n        setLassoPath(null)\n      }\n      return\n    }\n    if (tool === 'text') {\n      setTextDraft({ x: point.x, y: point.y, value: '' })\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(point)\n      updateCursor(point.x, point.y, 'laser')\n      return\n    }\n    if (shapeTools.has(tool)) {\n      setIsDrawing(true)\n      setShapeStart(point)\n      setShapePreview(point)\n      return\n    }\n    if (!freeDrawTools.has(tool)) return\n    setIsDrawing(true)\n    setCurrentStroke([point])\n  }\n\n  const handlePointerMove = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    if (isPanning && panStartRef.current) {\n      const deltaX = e.clientX - panStartRef.current.x\n      const deltaY = e.clientY - panStartRef.current.y\n      setViewport((prev) => ({\n        ...prev,\n        offsetX: panStartRef.current!.offsetX + deltaX,\n        offsetY: panStartRef.current!.offsetY + deltaY,\n      }))\n      return\n    }\n    const point = getCanvasPoint(e)\n    updateCursor(point.x, point.y, tool === 'laser' ? 'laser' : 'cursor')\n    if (connectorDrag) {\n      replaceMyStrokes((prev) => {\n        const pageStrokes = prev.filter((stroke) => (stroke.pageId || DEFAULT_PAGE_ID) === activePageId)\n        const obstacles = pageStrokes\n          .filter((stroke) => stroke.shapeType !== 'connector')\n          .map((stroke) => getStrokeBounds(stroke))\n          .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds))\n        const peers = pageStrokes.filter((stroke) => stroke.id !== connectorDrag.strokeId)\n        return prev.map((stroke) => {\n          if (stroke.id !== connectorDrag.strokeId || stroke.shapeType !== 'connector') return stroke\n          const resolved = resolveConnectorEndpoint(point, peers)\n          const from = connectorDrag.endpoint === 'source' ? resolved.point : stroke.points[0]\n          const to = connectorDrag.endpoint === 'target' ? resolved.point : stroke.points[stroke.points.length - 1]\n          return {\n            ...stroke,\n            points: routeOrthogonalConnector(from, to, obstacles),\n            sourceStrokeId: connectorDrag.endpoint === 'source' ? resolved.sourceStrokeId : stroke.sourceStrokeId,\n            sourcePort: connectorDrag.endpoint === 'source' ? resolved.sourcePort : stroke.sourcePort,\n            targetStrokeId: connectorDrag.endpoint === 'target' ? resolved.sourceStrokeId : stroke.targetStrokeId,\n            targetPort: connectorDrag.endpoint === 'target' ? resolved.sourcePort : stroke.targetPort,\n            updatedAt: Date.now(),\n          }\n        })\n      })\n      return\n    }\n    if (isRotatingSelection && rotateRef.current) {\n      const { centerX, centerY, startAngle } = rotateRef.current\n      const currentAngle = Math.atan2(point.y - centerY, point.x - centerX)\n      const delta = currentAngle - startAngle\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            rotation: ((stroke.rotation || 0) + (delta * 180) / Math.PI) % 360,\n            updatedAt: Date.now(),\n            points: base.map((p) => {\n              const dx = p.x - centerX\n              const dy = p.y - centerY\n              return {\n                ...p,\n                x: centerX + dx * Math.cos(delta) - dy * Math.sin(delta),\n                y: centerY + dx * Math.sin(delta) + dy * Math.cos(delta),\n              }\n            }),\n          }\n        }),\n      )\n      return\n    }\n    if (activeTransformHandle && transformRef.current) {\n      const { centerX, centerY, startDist } = transformRef.current\n      const currentDist = Math.max(1, Math.hypot(point.x - centerX, point.y - centerY))\n      const factor = currentDist / startDist\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            points: base.map((p) => ({\n              ...p,\n              x: snapEnabled\n                ? Math.round((centerX + (p.x - centerX) * factor) / gridSize) * gridSize\n                : centerX + (p.x - centerX) * factor,\n              y: snapEnabled\n                ? Math.round((centerY + (p.y - centerY) * factor) / gridSize) * gridSize\n                : centerY + (p.y - centerY) * factor,\n            })),\n          }\n        }),\n      )\n      return\n    }\n    if (isDraggingSelection && dragStartRef.current) {\n      const dx = point.x - dragStartRef.current.x\n      const dy = point.y - dragStartRef.current.y\n      replaceMyStrokes((prev) =>\n        prev.map((stroke) => {\n          if (!selectedStrokeIds.has(stroke.id)) return stroke\n          if ((stroke.pageId || DEFAULT_PAGE_ID) !== activePageId) return stroke\n          const base = selectionSnapshotRef.current.get(stroke.id)\n          if (!base) return stroke\n          return {\n            ...stroke,\n            points: base.map((p) => ({\n              ...p,\n              x: snapEnabled ? Math.round((p.x + dx) / gridSize) * gridSize : p.x + dx,\n              y: snapEnabled ? Math.round((p.y + dy) / gridSize) * gridSize : p.y + dy,\n            })),\n          }\n        }),\n      )\n      return\n    }\n    if (selectionRect) {\n      const screen = pointerToScreen(point)\n      setSelectionRect((prev) => prev ? { ...prev, width: screen.x - prev.x, height: screen.y - prev.y } : prev)\n      return\n    }\n    if (lassoPath) {\n      setLassoPath((prev) => (prev ? [...prev, point] : prev))\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(point)\n      return\n    }\n    if (!isDrawing) return\n    if (shapeTools.has(tool)) {\n      setShapePreview(point)\n      return\n    }\n    setCurrentStroke((prev) => {\n      const last = prev[prev.length - 1]\n      if (last) {\n        const dx = point.x - last.x\n        const dy = point.y - last.y\n        if (dx * dx + dy * dy < 0.7) return prev\n      }\n      return [...prev, point]\n    })\n  }\n\n  const handlePointerUp = (e: React.PointerEvent<HTMLCanvasElement>) => {\n    e.currentTarget.releasePointerCapture(e.pointerId)\n    if (isPanning) {\n      setIsPanning(false)\n      panStartRef.current = null\n      return\n    }\n    if (connectorDrag) {\n      setConnectorDrag(null)\n      return\n    }\n    if (selectionRect) {\n      const x = Math.min(selectionRect.x, selectionRect.x + selectionRect.width)\n      const y = Math.min(selectionRect.y, selectionRect.y + selectionRect.height)\n      const width = Math.abs(selectionRect.width)\n      const height = Math.abs(selectionRect.height)\n      const selected = new Set<string>()\n      activePageStrokes.forEach((stroke) => {\n        const bounds = getStrokeBounds(stroke)\n        if (!bounds) return\n        const topLeft = pointerToScreen({ x: bounds.x, y: bounds.y })\n        const bottomRight = pointerToScreen({ x: bounds.x + bounds.width, y: bounds.y + bounds.height })\n        const intersects = topLeft.x < x + width && bottomRight.x > x && topLeft.y < y + height && bottomRight.y > y\n        const contains = topLeft.x >= x && bottomRight.x <= x + width && topLeft.y >= y && bottomRight.y <= y + height\n        if ((selectionHitMode === 'intersect' && intersects) || (selectionHitMode === 'contain' && contains)) {\n          selected.add(stroke.id)\n        }\n      })\n      setSelectedStrokeIds(selected)\n      setSelectionRect(null)\n      return\n    }\n    if (lassoPath && lassoPath.length > 2) {\n      const selected = new Set<string>()\n      activePageStrokes.forEach((stroke) => {\n        const strokePoints = stroke.points\n        if (strokePoints.some((p) => pointInPolygon({ x: p.x, y: p.y }, lassoPath))) {\n          selected.add(stroke.id)\n        }\n      })\n      setSelectedStrokeIds(selected)\n      setLassoPath(null)\n      return\n    }\n    if (isRotatingSelection) {\n      setIsRotatingSelection(false)\n      rotateRef.current = null\n      selectionSnapshotRef.current.clear()\n      logAudit('Rotated selection')\n      return\n    }\n    if (activeTransformHandle) {\n      setActiveTransformHandle(null)\n      transformRef.current = null\n      selectionSnapshotRef.current.clear()\n      logAudit('Scaled selection')\n      return\n    }\n    if (isDraggingSelection) {\n      setIsDraggingSelection(false)\n      dragStartRef.current = null\n      selectionSnapshotRef.current.clear()\n      logAudit('Moved selection')\n      return\n    }\n    if (tool === 'laser') {\n      setLaserPoint(null)\n      return\n    }\n    if (!isDrawing) return\n\n    if (shapeTools.has(tool) && shapeStart && shapePreview) {\n      const preset = TOOL_PRESET[tool]\n      const fromResolved = tool === 'connector' ? resolveConnectorEndpoint(shapeStart, activePageStrokes) : { point: shapeStart }\n      const toResolved = tool === 'connector' ? resolveConnectorEndpoint(shapePreview, activePageStrokes) : { point: shapePreview }\n      const fromPoint = fromResolved.point\n      const toPoint = toResolved.point\n      const connectorPoints = tool === 'connector'\n        ? routeOrthogonalConnector(\n            fromPoint,\n            toPoint,\n            activePageStrokes\n              .filter((stroke) => stroke.shapeType !== 'connector')\n              .map((stroke) => getStrokeBounds(stroke))\n              .filter((bounds): bounds is NonNullable<ReturnType<typeof getStrokeBounds>> => Boolean(bounds)),\n          )\n        : [fromPoint, toPoint]\n      const stroke: WhiteboardStroke = {\n        id: Date.now().toString(),\n        points: connectorPoints,\n        color,\n        width: Math.max(1, brushSize),\n        opacity: preset.opacity,\n        shapeType: tool as NonNullable<WhiteboardStroke['shapeType']>,\n        type: 'shape',\n        userId: 'tutor',\n        pageId: activePageId,\n        zIndex: Math.max(0, ...activePageStrokes.map((s) => s.zIndex || 0)) + 1,\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n        sourceStrokeId: tool === 'connector' ? fromResolved.sourceStrokeId : undefined,\n        targetStrokeId: tool === 'connector' ? toResolved.sourceStrokeId : undefined,\n        sourcePort: tool === 'connector' ? fromResolved.sourcePort : undefined,\n        targetPort: tool === 'connector' ? toResolved.sourcePort : undefined,\n      }\n      addTutorStroke(stroke)\n      if (tool === 'connector') logAudit('Added orthogonal connector')\n      setShapeStart(null)\n      setShapePreview(null)\n      setIsDrawing(false)\n      return\n    }\n\n    if (currentStroke.length === 0) {\n      setIsDrawing(false)\n      return\n    }\n\n    const preset = TOOL_PRESET[tool]\n    const stroke: WhiteboardStroke = {\n      id: Date.now().toString(),\n      points: currentStroke,\n      color: tool === 'eraser' ? '#ffffff' : color,\n      width: tool === 'eraser' ? preset.width : brushSize,\n      opacity: preset.opacity,\n      type: preset.strokeType,\n      userId: 'tutor',\n      pageId: activePageId,\n      zIndex: Math.max(0, ...activePageStrokes.map((s) => s.zIndex || 0)) + 1,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    }\n\n    addTutorStroke(stroke)\n    setIsDrawing(false)\n    setCurrentStroke([])\n  }\n\n  const handleWheel = useCallback((e: React.WheelEvent<HTMLCanvasElement>) => {\n    e.preventDefault()\n    const zoomFactor = e.deltaY < 0 ? 1.08 : 0.92\n    const nextScale = Math.min(3, Math.max(0.35, viewport.scale * zoomFactor))\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const rect = canvas.getBoundingClientRect()\n    const cursorX = e.clientX - rect.left\n    const cursorY = e.clientY - rect.top\n    const worldX = (cursorX - viewport.offsetX) / viewport.scale\n    const worldY = (cursorY - viewport.offsetY) / viewport.scale\n    setViewport({\n      scale: nextScale,\n      offsetX: cursorX - worldX * nextScale,\n      offsetY: cursorY - worldY * nextScale,\n    })\n  }, [viewport.offsetX, viewport.offsetY, viewport.scale])\n  \n  useEffect(() => {\n    requestSnapshotTimeline()\n  }, [requestSnapshotTimeline])\n\n  const exportCurrentBoard = () => {\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const dataUrl = canvas.toDataURL('image/png')\n    const fileName = `whiteboard_${roomId}_${Date.now()}.png`\n    exportAndAttachBoard({\n      format: 'png',\n      fileName,\n      dataUrl,\n      studentId: reviewStudentId || undefined,\n    })\n  }\n\n  const exportSelection = useCallback(() => {\n    if (!selectedBounds || !canvasRef.current) return\n    const canvas = canvasRef.current\n    const temp = document.createElement('canvas')\n    const startX = Math.round(selectedBounds.x * viewport.scale + viewport.offsetX)\n    const startY = Math.round(selectedBounds.y * viewport.scale + viewport.offsetY)\n    const width = Math.max(1, Math.round(selectedBounds.width * viewport.scale))\n    const height = Math.max(1, Math.round(selectedBounds.height * viewport.scale))\n    temp.width = width\n    temp.height = height\n    const tctx = temp.getContext('2d')\n    if (!tctx) return\n    tctx.drawImage(canvas, startX, startY, width, height, 0, 0, width, height)\n    exportAndAttachBoard({\n      format: 'png',\n      fileName: `whiteboard_selection_${roomId}_${Date.now()}.png`,\n      dataUrl: temp.toDataURL('image/png'),\n      studentId: reviewStudentId || undefined,\n    })\n  }, [exportAndAttachBoard, reviewStudentId, roomId, selectedBounds, viewport.offsetX, viewport.offsetY, viewport.scale])\n\n  const addPage = useCallback(() => {\n    setPages((prev) => {\n      const nextPageNumber = prev.length + 1\n      const nextPageId = `page-${nextPageNumber}`\n      const next = [...prev, { id: nextPageId, label: `Page ${nextPageNumber}` }]\n      setActivePageId(nextPageId)\n      return next\n    })\n  }, [])\n\n  const goToPage = useCallback((direction: 'prev' | 'next') => {\n    const currentIndex = pages.findIndex((page) => page.id === activePageId)\n    if (currentIndex < 0) return\n    if (direction === 'prev' && currentIndex > 0) {\n      setActivePageId(pages[currentIndex - 1].id)\n    }\n    if (direction === 'next' && currentIndex < pages.length - 1) {\n      setActivePageId(pages[currentIndex + 1].id)\n    }\n  }, [activePageId, pages])\n\n  useEffect(() => {\n    const preset = TOOL_PRESET[tool]\n    if (!preset) return\n    if (tool === 'eraser' || tool === 'highlighter' || tool === 'marker' || tool === 'calligraphy' || tool === 'pencil' || tool === 'pen') {\n      setBrushSize(preset.width)\n    }\n  }, [tool])\n\n  useEffect(() => {\n    return () => {\n      if (importedAsset?.src) URL.revokeObjectURL(importedAsset.src)\n    }\n  }, [importedAsset])\n\n  const commitTextDraft = useCallback(() => {\n    if (!textDraft || !textDraft.value.trim()) {\n      setTextDraft(null)\n      return\n    }\n    const value = textDraft.value.trim()\n    const formattedText =\n      textPreset === 'latex' ? `$$${value}$$` :\n      textPreset === 'code' ? `\\`\\`\\`\\n${value}\\n\\`\\`\\`` :\n      textPreset === 'table' ? `| Column A | Column B |\\n|---|---|\\n| ${value} |  |` :\n      value\n    const stroke: WhiteboardStroke = {\n      id: Date.now().toString(),\n      points: [{ x: textDraft.x, y: textDraft.y }],\n      color,\n      width: 1,\n      opacity: 1,\n      type: 'text',\n      text: formattedText,\n      fontSize,\n      fontFamily: textPreset === 'sticky' ? 'Caveat, ui-sans-serif, system-ui, sans-serif' : 'Inter, Segoe UI, system-ui, sans-serif',\n      textStyle,\n      userId: 'tutor',\n      pageId: activePageId,\n      zIndex: Math.max(0, ...activePageStrokes.map((s) => s.zIndex || 0)) + 1,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    }\n    addTutorStroke(stroke)\n    setTextDraft(null)\n    logAudit('Added text', textPreset)\n  }, [activePageId, activePageStrokes, addTutorStroke, color, fontSize, logAudit, textDraft, textPreset, textStyle])\n\n  const saveNamedCheckpoint = useCallback(() => {\n    const name = checkpointName.trim() || `Checkpoint ${new Date().toLocaleTimeString()}`\n    setNamedCheckpoints((prev) => [{ id: `${Date.now()}`, name, createdAt: Date.now() }, ...prev].slice(0, 30))\n    requestSnapshotTimeline()\n    logAudit('Saved checkpoint', name)\n    setCheckpointName('')\n  }, [checkpointName, logAudit, requestSnapshotTimeline])\n\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if ((event.target as HTMLElement)?.tagName === 'INPUT' || (event.target as HTMLElement)?.tagName === 'TEXTAREA') return\n      const step = event.shiftKey ? 20 : 6\n      const key = event.key.toLowerCase()\n      if (key === 'v') setTool('select')\n      if (key === 'p') setTool('pen')\n      if (key === 'e') setTool('eraser')\n      if (key === 't') setTool('text')\n      if (key === 'h') setTool('hand')\n      if (selectedStrokeIds.size > 0) {\n        if (event.key === 'ArrowUp') { event.preventDefault(); nudgeSelection(0, -step) }\n        if (event.key === 'ArrowDown') { event.preventDefault(); nudgeSelection(0, step) }\n        if (event.key === 'ArrowLeft') { event.preventDefault(); nudgeSelection(-step, 0) }\n        if (event.key === 'ArrowRight') { event.preventDefault(); nudgeSelection(step, 0) }\n        if (event.key === '+') { event.preventDefault(); scaleSelection(1.08) }\n        if (event.key === '-') { event.preventDefault(); scaleSelection(0.92) }\n      }\n      if ((event.metaKey || event.ctrlKey) && key === 'z') {\n        event.preventDefault()\n        undoLastStroke(activePageId)\n      }\n    }\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [activePageId, nudgeSelection, scaleSelection, selectedStrokeIds.size, undoLastStroke])\n\n  useEffect(() => {\n    let rafId = 0\n    let lastTs = performance.now()\n    let frameCount = 0\n    const tick = (ts: number) => {\n      frameCount += 1\n      if (ts - lastTs >= 1000) {\n        setFps(Math.round((frameCount * 1000) / (ts - lastTs)))\n        frameCount = 0\n        lastTs = ts\n      }\n      rafId = requestAnimationFrame(tick)\n    }\n    rafId = requestAnimationFrame(tick)\n    return () => cancelAnimationFrame(rafId)\n  }, [])\n\n  useEffect(() => {\n    if (!srAnnouncement) return\n    const timer = window.setTimeout(() => setSrAnnouncement(''), 1200)\n    return () => window.clearTimeout(timer)\n  }, [srAnnouncement])\n\n  const cursorColorForId = useCallback((userId: string) => {\n    const palette = ['#2563eb', '#7c3aed', '#059669', '#dc2626', '#ea580c', '#0891b2', '#ca8a04']\n    let hash = 0\n    for (let i = 0; i < userId.length; i += 1) hash = (hash * 31 + userId.charCodeAt(i)) | 0\n    return palette[Math.abs(hash) % palette.length]\n  }, [])\n\n  return (\n    <div className=\"flex flex-col h-full bg-white rounded-lg border\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b\">\n        <div className=\"flex items-center gap-2\">\n          <Palette className=\"w-5 h-5\" />\n          <span className=\"font-medium\">Whiteboard</span>\n          {isBroadcasting && (\n            <Badge variant=\"destructive\" className=\"animate-pulse\">\n              <Play className=\"w-3 h-3 mr-1\" />\n              Broadcasting\n            </Badge>\n          )}\n          {viewingStudentId && (\n            <Badge variant=\"secondary\">\n              <Eye className=\"w-3 h-3 mr-1\" />\n              Viewing Student\n            </Badge>\n          )}\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={isLayerLocked ? 'destructive' : 'outline'}\n            size=\"sm\"\n            disabled={!isConnected}\n            title={!isConnected ? 'Connect to the class to lock student boards' : (isLayerLocked ? 'Unlock so students can draw again' : 'Lock student boards so only you can draw')}\n            onClick={() => toggleLayerLock(!isLayerLocked)}\n          >\n            {isLayerLocked ? (\n              <>\n                <Lock className=\"w-4 h-4 mr-2\" />\n                Unlock Student Layers\n              </>\n            ) : (\n              <>\n                <Unlock className=\"w-4 h-4 mr-2\" />\n                Lock Student Layers\n              </>\n            )}\n          </Button>\n          {isBroadcasting ? (\n            <Button variant=\"destructive\" size=\"sm\" onClick={stopBroadcast} title=\"Stop sending your board to students\">\n              <StopIcon className=\"w-4 h-4 mr-2\" />\n              Stop Broadcast\n            </Button>\n          ) : (\n            <Button\n              variant=\"default\"\n              size=\"sm\"\n              disabled={!isConnected}\n              title={!isConnected ? 'Connect to the class to broadcast your board' : 'Send your whiteboard to all students in real time'}\n              onClick={startBroadcast}\n            >\n              <Play className=\"w-4 h-4 mr-2\" />\n              Broadcast\n            </Button>\n          )}\n        </div>\n      </div>\n      \n      {/* Toolbar */}\n      <div className=\"space-y-2 border-b bg-slate-50/95 px-4 py-2 backdrop-blur\">\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {[\n              { id: 'pencil', icon: Pencil, label: 'Pencil' },\n              { id: 'pen', icon: PenLine, label: 'Pen' },\n              { id: 'marker', icon: Dot, label: 'Marker' },\n              { id: 'highlighter', icon: Highlighter, label: 'Highlighter' },\n              { id: 'calligraphy', icon: MinusCircle, label: 'Calligraphy' },\n              { id: 'eraser', icon: Eraser, label: 'Eraser' },\n            ].map(({ id, icon: Icon, label }) => (\n              <button\n                key={id}\n                onClick={() => setTool(id as Tool)}\n                className={cn(\n                  \"rounded-md px-2 py-1.5 transition-colors\",\n                  tool === id ? 'bg-blue-100 text-blue-700' : 'text-slate-600 hover:bg-slate-100'\n                )}\n                title={label}\n              >\n                <Icon className=\"h-4 w-4\" />\n              </button>\n            ))}\n          </div>\n\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {[\n              { id: 'line', icon: Minus, label: 'Line' },\n              { id: 'arrow', icon: ArrowRight, label: 'Arrow' },\n              { id: 'rectangle', icon: RectangleHorizontal, label: 'Rectangle' },\n              { id: 'circle', icon: Circle, label: 'Circle' },\n              { id: 'triangle', icon: Triangle, label: 'Triangle' },\n              { id: 'connector', icon: Link2, label: 'Connector' },\n              { id: 'text', icon: Type, label: 'Text' },\n              { id: 'laser', icon: Ban, label: 'Laser Pointer' },\n              { id: 'select', icon: MousePointer2, label: 'Select' },\n              { id: 'hand', icon: Move, label: 'Pan' },\n            ].map(({ id, icon: Icon, label }) => (\n              <button\n                key={id}\n                onClick={() => setTool(id as Tool)}\n                className={cn(\n                  \"rounded-md px-2 py-1.5 transition-colors\",\n                  tool === id ? 'bg-indigo-100 text-indigo-700' : 'text-slate-600 hover:bg-slate-100'\n                )}\n                title={label}\n              >\n                <Icon className=\"h-4 w-4\" />\n              </button>\n            ))}\n          </div>\n\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            {COLORS.map((c) => (\n              <button\n                key={c}\n                onClick={() => setColor(c)}\n                className={cn(\n                  \"h-6 w-6 rounded-full border transition-all\",\n                  color === c ? 'scale-110 border-slate-600' : 'border-transparent'\n                )}\n                style={{ backgroundColor: c }}\n                title={c}\n              />\n            ))}\n            <input\n              type=\"color\"\n              value={customColor}\n              onChange={(e) => {\n                setCustomColor(e.target.value)\n                setColor(e.target.value)\n              }}\n              className=\"h-6 w-8 cursor-pointer rounded border bg-transparent p-0\"\n              title=\"Custom color\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n            <span className=\"text-xs text-slate-500\">Stroke</span>\n            <Slider\n              value={[brushSize]}\n              onValueChange={([value]) => setBrushSize(value)}\n              min={1}\n              max={32}\n              step={1}\n              className=\"w-24\"\n            />\n            <span className=\"w-7 text-xs font-medium text-slate-600\">{brushSize}</span>\n          </div>\n\n          {tool === 'text' && (\n            <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n              <span className=\"text-xs text-slate-500\">Font</span>\n              <Slider\n                value={[fontSize]}\n                onValueChange={([value]) => setFontSize(value)}\n                min={14}\n                max={56}\n                step={1}\n                className=\"w-24\"\n              />\n              <span className=\"w-7 text-xs font-medium text-slate-600\">{fontSize}</span>\n            </div>\n          )}\n          {tool === 'text' && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              {(['plain', 'latex', 'code', 'table', 'sticky'] as const).map((preset) => (\n                <Button\n                  key={preset}\n                  variant={textPreset === preset ? 'default' : 'ghost'}\n                  size=\"sm\"\n                  className=\"h-7 px-2 text-xs capitalize\"\n                  title={`Text preset: ${preset}`}\n                  aria-label={`Text preset: ${preset}`}\n                  onClick={() => setTextPreset(preset)}\n                >\n                  {preset}\n                </Button>\n              ))}\n            </div>\n          )}\n          {tool === 'text' && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              <Button size=\"sm\" variant={textStyle.bold ? 'default' : 'ghost'} className=\"h-7 px-2 text-xs\" title=\"Bold text\" onClick={() => setTextStyle((prev) => ({ ...prev, bold: !prev.bold }))}>B</Button>\n              <Button size=\"sm\" variant={textStyle.italic ? 'default' : 'ghost'} className=\"h-7 px-2 text-xs italic\" title=\"Italic text\" onClick={() => setTextStyle((prev) => ({ ...prev, italic: !prev.italic }))}>I</Button>\n              <Button size=\"sm\" variant={textStyle.align === 'left' ? 'default' : 'ghost'} className=\"h-7 px-2 text-xs\" title=\"Align left\" onClick={() => setTextStyle((prev) => ({ ...prev, align: 'left' }))}><AlignLeft className=\"h-3.5 w-3.5\" /></Button>\n              <Button size=\"sm\" variant={textStyle.align === 'center' ? 'default' : 'ghost'} className=\"h-7 px-2 text-xs\" title=\"Align center\" onClick={() => setTextStyle((prev) => ({ ...prev, align: 'center' }))}><AlignCenter className=\"h-3.5 w-3.5\" /></Button>\n              <Button size=\"sm\" variant={textStyle.align === 'right' ? 'default' : 'ghost'} className=\"h-7 px-2 text-xs\" title=\"Align right\" onClick={() => setTextStyle((prev) => ({ ...prev, align: 'right' }))}><AlignRight className=\"h-3.5 w-3.5\" /></Button>\n            </div>\n          )}\n          {tool === 'select' && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              <Button\n                variant={selectionMode === 'rect' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Selection mode: rectangle\"\n                onClick={() => setSelectionMode('rect')}\n              >\n                Rect\n              </Button>\n              <Button\n                variant={selectionMode === 'lasso' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Selection mode: lasso\"\n                onClick={() => setSelectionMode('lasso')}\n              >\n                Lasso\n              </Button>\n              <Button\n                variant={selectionHitMode === 'intersect' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Select items that intersect selection area\"\n                onClick={() => setSelectionHitMode('intersect')}\n              >\n                Intersect\n              </Button>\n              <Button\n                variant={selectionHitMode === 'contain' ? 'default' : 'ghost'}\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs\"\n                title=\"Select only items fully contained in selection area\"\n                onClick={() => setSelectionHitMode('contain')}\n              >\n                Contain\n              </Button>\n            </div>\n          )}\n          {selectedStrokeIds.size > 0 && (\n            <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection up\" onClick={() => nudgeSelection(0, -10)}>\n                Up\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection left\" onClick={() => nudgeSelection(-10, 0)}>\n                Left\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection right\" onClick={() => nudgeSelection(10, 0)}>\n                Right\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Nudge selection down\" onClick={() => nudgeSelection(0, 10)}>\n                Down\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Scale selected items down\" onClick={() => scaleSelection(0.9)}>\n                Scale -\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Scale selected items up\" onClick={() => scaleSelection(1.1)}>\n                Scale +\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all with same color\" onClick={() => selectByAttribute('color')}>\n                Same Color\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all with same stroke type\" onClick={() => selectByAttribute('type')}>\n                Same Type\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Select all in same layer\" onClick={() => selectByAttribute('layer')}>\n                Same Layer\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Duplicate selection\" onClick={duplicateSelection}>\n                <Copy className=\"mr-1 h-3.5 w-3.5\" /> Dup\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Group selected objects\" onClick={groupSelection}>\n                <Group className=\"mr-1 h-3.5 w-3.5\" /> Group\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Ungroup selected objects\" onClick={ungroupSelection}>\n                <Ungroup className=\"mr-1 h-3.5 w-3.5\" /> Ungroup\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Bring selected to front\" onClick={() => reorderSelection('front')}>\n                <BringToFront className=\"mr-1 h-3.5 w-3.5\" /> Front\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Bring selected forward\" onClick={() => reorderSelection('forward')}>\n                <ArrowRight className=\"mr-1 h-3.5 w-3.5\" /> Forward\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Send selected to back\" onClick={() => reorderSelection('back')}>\n                <SendToBack className=\"mr-1 h-3.5 w-3.5\" /> Back\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Lock selected objects\" onClick={() => lockSelection(true)}>\n                Lock\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Unlock selected objects\" onClick={() => lockSelection(false)}>\n                Unlock\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 text-xs\" title=\"Push selection as class exemplar\" onClick={pushSelectionAsExemplar}>\n                Exemplar\n              </Button>\n            </div>\n          )}\n          <div className=\"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm\">\n            <input\n              value={branchNameInput}\n              onChange={(e) => setBranchNameInput(e.target.value)}\n              placeholder=\"Branch name\"\n              className=\"h-7 w-28 rounded border px-2 text-xs\"\n            />\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 px-2 text-xs\"\n              onClick={() => {\n                if (!branchNameInput.trim()) return\n                createBoardBranch(branchNameInput)\n                setBranchNameInput('')\n              }}\n              title=\"Create board branch\"\n            >\n              Branch\n            </Button>\n            {availableBranches.length > 0 && (\n              <select\n                className=\"h-7 rounded border px-2 text-xs\"\n                onChange={(e) => e.target.value && switchBoardBranch(e.target.value)}\n                defaultValue=\"\"\n                aria-label=\"Switch board branch\"\n              >\n                <option value=\"\" disabled>Switch branch</option>\n                {availableBranches.map((branch) => (\n                  <option key={branch} value={branch}>{branch}</option>\n                ))}\n              </select>\n            )}\n          </div>\n\n          <div className=\"ml-auto flex items-center gap-1 rounded-md border bg-white px-1 py-1 shadow-sm\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-7 w-7\"\n              onClick={() => goToPage('prev')}\n              disabled={activePageIndex <= 0}\n            >\n              <ChevronLeft className=\"w-4 h-4\" />\n            </Button>\n            <span className=\"min-w-[72px] text-center text-xs font-medium\">\n              {pages.find((page) => page.id === activePageId)?.label || 'Page'}\n            </span>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-7 w-7\"\n              onClick={() => goToPage('next')}\n              disabled={activePageIndex >= pages.length - 1}\n            >\n              <ChevronRight className=\"w-4 h-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={addPage}>\n              <Plus className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => undoLastStroke(activePageId)}>\n            <Undo className=\"mr-1 h-4 w-4\" /> Undo\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => clearMyWhiteboard(activePageId)}>\n            <Trash2 className=\"mr-1 h-4 w-4\" /> Clear\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowHighContrast((prev) => !prev)}\n          >\n            {showHighContrast ? 'Standard' : 'High Contrast'}\n          </Button>\n          <Button variant={snapEnabled ? 'default' : 'outline'} size=\"sm\" title=\"Toggle snap-to-grid\" onClick={() => setSnapEnabled((prev) => !prev)}>\n            Snap\n          </Button>\n          <Button variant={gridVisible ? 'default' : 'outline'} size=\"sm\" title=\"Show or hide grid\" onClick={() => setGridVisible((prev) => !prev)}>\n            Grid\n          </Button>\n          <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n            <span className=\"text-xs text-slate-500\">Grid</span>\n            <Slider value={[gridSize]} onValueChange={([value]) => setGridSize(value)} min={8} max={64} step={2} className=\"w-20\" />\n            <span className=\"w-7 text-xs font-medium text-slate-600\">{gridSize}</span>\n          </div>\n          <label className=\"inline-flex\">\n            <input\n              type=\"file\"\n              accept=\"image/*,application/pdf\"\n              className=\"hidden\"\n              onChange={(event) => {\n                const file = event.target.files?.[0]\n                if (!file) return\n                const src = URL.createObjectURL(file)\n                setImportedAsset({ kind: file.type.includes('pdf') ? 'pdf' : 'image', src, name: file.name })\n                setPdfPage(1)\n                logAudit('Imported asset', file.name)\n                event.currentTarget.value = ''\n              }}\n            />\n            <span className=\"inline-flex h-9 cursor-pointer items-center rounded-md border px-3 text-sm\">\n              <FileUp className=\"mr-1 h-4 w-4\" /> Import\n            </span>\n          </label>\n          <Button variant=\"outline\" size=\"sm\" title=\"Export full whiteboard page\" onClick={exportCurrentBoard}>\n            <Download className=\"mr-1 h-4 w-4\" /> Export\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" title=\"Export as SVG vectors\" onClick={exportSvg}>\n            <Download className=\"mr-1 h-4 w-4\" /> SVG\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" title=\"Export current selection\" onClick={exportSelection} disabled={!selectedBounds}>\n            <Download className=\"mr-1 h-4 w-4\" /> Export Sel\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" title=\"Broadcast current viewport focus to class\" onClick={broadcastViewport}>\n            Broadcast View\n          </Button>\n          <Button variant={showMiniMap ? 'default' : 'outline'} size=\"sm\" title=\"Toggle collaboration minimap\" onClick={() => setShowMiniMap((prev) => !prev)}>\n            Minimap\n          </Button>\n          <Button variant={showPerfHud ? 'default' : 'outline'} size=\"sm\" title=\"Toggle performance HUD\" onClick={() => setShowPerfHud((prev) => !prev)}>\n            <Gauge className=\"mr-1 h-4 w-4\" /> Perf\n          </Button>\n          <div className=\"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm\">\n            <input\n              value={checkpointName}\n              onChange={(event) => setCheckpointName(event.target.value)}\n              placeholder=\"Checkpoint\"\n              className=\"h-7 w-28 rounded border px-2 text-xs\"\n            />\n            <Button size=\"sm\" variant=\"outline\" className=\"h-7 text-xs\" title=\"Save named checkpoint\" onClick={saveNamedCheckpoint}>\n              <WandSparkles className=\"mr-1 h-3.5 w-3.5\" /> Save\n            </Button>\n          </div>\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {Math.round(viewport.scale * 100)}%\n          </Badge>\n          {selectedStrokeIds.size > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {selectedStrokeIds.size} selected\n            </Badge>\n          )}\n          <Badge variant=\"outline\" className=\"text-xs\">\n            CP {namedCheckpoints.length}\n          </Badge>\n        </div>\n      </div>\n      \n      {/* Main Content */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Canvas Area */}\n        <div className=\"flex-1 relative\">\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"h-full\">\n            <TabsList className=\"absolute top-2 left-2 z-10\">\n              <TabsTrigger value=\"my-board\">My Board</TabsTrigger>\n              <TabsTrigger value=\"student-boards\">\n                <Users className=\"w-4 h-4 mr-2\" />\n                Students ({activeStudentBoards.length})\n              </TabsTrigger>\n              <TabsTrigger value=\"pdf-board\">PDF Tutoring</TabsTrigger>\n            </TabsList>\n            \n            <TabsContent value=\"my-board\" className=\"h-full m-0\">\n              <div className=\"h-full p-4\">\n                <div ref={boardViewportRef} className={cn(\"relative w-full h-full\", showHighContrast && \"contrast-125 saturate-150\")}>\n                  <div className=\"absolute left-2 top-14 z-20\">\n                    <CourseStructureLinkPanel\n                      initialCourseId={initialCourseId}\n                      classSubject={classSubject}\n                      onMakeVisibleToStudents={onDocumentVisibleToStudents}\n                    />\n                  </div>\n                  <canvas\n                    ref={canvasRef}\n                    onPointerDown={handlePointerDown}\n                    onPointerMove={handlePointerMove}\n                    onPointerUp={handlePointerUp}\n                    onPointerLeave={handlePointerUp}\n                    onWheel={handleWheel}\n                    className={cn(\n                      \"w-full h-full border rounded-lg bg-white\",\n                      (freeDrawTools.has(tool) || shapeTools.has(tool) || tool === 'text') && \"cursor-crosshair\",\n                      tool === 'laser' && \"cursor-none\",\n                      tool === 'hand' && \"cursor-grab\",\n                      tool === 'select' && \"cursor-default\"\n                    )}\n                    aria-label=\"Tutor whiteboard canvas\"\n                  />\n                  {importedAsset?.kind === 'image' && (\n                    // eslint-disable-next-line @next/next/no-img-element\n                    <img\n                      src={importedAsset.src}\n                      alt={importedAsset.name}\n                      className=\"pointer-events-none absolute inset-0 h-full w-full rounded-lg object-contain opacity-30\"\n                    />\n                  )}\n                  {importedAsset?.kind === 'pdf' && (\n                    <>\n                      <iframe\n                        src={`${importedAsset.src}#page=${pdfPage}`}\n                        title={importedAsset.name}\n                        className=\"pointer-events-none absolute inset-0 h-full w-full rounded-lg opacity-25\"\n                      />\n                      <div className=\"absolute right-3 top-16 z-30 flex items-center gap-1 rounded-md bg-white/90 p-1\">\n                        <Button size=\"sm\" variant=\"ghost\" className=\"h-7 px-2\" onClick={() => setPdfPage((prev) => Math.max(1, prev - 1))}>\n                          Prev\n                        </Button>\n                        <span className=\"text-xs font-medium\">PDF p.{pdfPage}</span>\n                        <Button size=\"sm\" variant=\"ghost\" className=\"h-7 px-2\" onClick={() => setPdfPage((prev) => prev + 1)}>\n                          Next\n                        </Button>\n                      </div>\n                    </>\n                  )}\n                  {textDraft && (\n                    <div\n                      className=\"absolute z-30\"\n                      style={{ left: textDraft.x, top: textDraft.y }}\n                    >\n                      <div className=\"w-80 rounded-md border border-slate-300 bg-white/95 p-2 shadow-lg\">\n                        <textarea\n                          autoFocus\n                          value={textDraft.value}\n                          rows={4}\n                          onChange={(event) => setTextDraft((prev) => prev ? { ...prev, value: event.target.value } : prev)}\n                          onKeyDown={(event) => {\n                            if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {\n                              event.preventDefault()\n                              commitTextDraft()\n                            }\n                            if (event.key === 'Escape') {\n                              event.preventDefault()\n                              setTextDraft(null)\n                            }\n                          }}\n                          placeholder=\"Type here... (Cmd/Ctrl + Enter to place)\"\n                          className=\"w-full resize-none rounded-md border border-slate-200 bg-white p-2 text-sm outline-none ring-offset-2 focus:ring-2\"\n                        />\n                        <div className=\"mt-2 flex items-center justify-end gap-2\">\n                          <Button size=\"sm\" variant=\"outline\" onClick={() => setTextDraft(null)}>\n                            Cancel\n                          </Button>\n                          <Button size=\"sm\" onClick={commitTextDraft}>\n                            Place\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  {Array.from(remoteCursors.values()).map((cursor) => (\n                    <div\n                      key={cursor.userId}\n                      className=\"absolute pointer-events-none z-10\"\n                      style={{ left: cursor.x, top: cursor.y, transform: 'translate(-50%, -50%)' }}\n                    >\n                      {cursor.pointerMode === 'laser' ? (\n                        <div className=\"h-10 w-10 rounded-full bg-red-500/30 ring-2 ring-red-500/60 blur-[1px]\" />\n                      ) : (\n                        <div\n                          className=\"h-2.5 w-2.5 rounded-full border border-white shadow\"\n                          style={{ backgroundColor: cursorColorForId(cursor.userId) }}\n                        />\n                      )}\n                      <div\n                        className=\"mt-1 whitespace-nowrap rounded px-1.5 py-0.5 text-[10px] text-white\"\n                        style={{ backgroundColor: cursorColorForId(cursor.userId) }}\n                      >\n                        {cursor.name} {Date.now() - cursor.lastUpdated > 2000 ? '(idle)' : ''}\n                      </div>\n                    </div>\n                  ))}\n                  {spotlight.enabled && (\n                    <div className=\"absolute inset-0 pointer-events-none\">\n                      <div className=\"absolute inset-0 bg-black/35\" />\n                      <div\n                        className={cn(\n                          \"absolute border-2 border-yellow-300 shadow-[0_0_0_9999px_rgba(0,0,0,0.35)]\",\n                          spotlight.mode === 'pen' ? 'rounded-full' : 'rounded-md'\n                        )}\n                        style={{\n                          left: spotlight.x,\n                          top: spotlight.y,\n                          width: spotlight.width,\n                          height: spotlight.height,\n                        }}\n                      />\n                    </div>\n                  )}\n                  {showMiniMap && (\n                    <div className=\"absolute bottom-3 right-3 z-30 h-28 w-44 rounded-md border bg-white/90 p-2\">\n                      <div className=\"mb-1 text-[10px] font-semibold uppercase text-slate-500\">Presence Minimap</div>\n                      <div className=\"relative h-[88px] w-full overflow-hidden rounded bg-slate-100\">\n                        <div\n                          className=\"absolute border border-blue-500/70 bg-blue-200/20\"\n                          style={{\n                            left: `${Math.max(0, Math.min(92, (-viewport.offsetX / 1600) * 100))}%`,\n                            top: `${Math.max(0, Math.min(92, (-viewport.offsetY / 900) * 100))}%`,\n                            width: `${Math.max(8, Math.min(100, (420 / Math.max(0.4, viewport.scale)) / 16))}%`,\n                            height: `${Math.max(8, Math.min(100, (240 / Math.max(0.4, viewport.scale)) / 9))}%`,\n                          }}\n                        />\n                        {Array.from(remoteCursors.values()).map((cursor) => (\n                          <div\n                            key={`mini-${cursor.userId}`}\n                            className=\"absolute h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-white\"\n                            style={{\n                              left: `${Math.max(0, Math.min(100, (cursor.x / 1600) * 100))}%`,\n                              top: `${Math.max(0, Math.min(100, (cursor.y / 900) * 100))}%`,\n                              backgroundColor: cursorColorForId(cursor.userId),\n                            }}\n                          />\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  {showPerfHud && (\n                    <div className=\"absolute bottom-3 left-3 z-30 rounded-md border bg-white/90 px-2 py-1 text-xs\">\n                      FPS {fps} | Strokes {activePageStrokes.length} | Cursors {remoteCursors.size}\n                    </div>\n                  )}\n                  <div className=\"sr-only\" aria-live=\"polite\">{srAnnouncement}</div>\n                </div>\n                <div className=\"mt-3 grid grid-cols-1 gap-3 lg:grid-cols-3\">\n                  <div className=\"rounded-md border p-2\">\n                    <div className=\"mb-2 flex items-center gap-2 text-sm font-semibold\">\n                      <Grid3X3 className=\"w-4 h-4\" />\n                      Layer Model\n                    </div>\n                    <div className=\"space-y-2\">\n                      {layerConfig.map((layer) => (\n                        <div key={layer.id} className=\"flex items-center justify-between gap-2 text-xs\">\n                          <button\n                            className={cn(\n                              \"rounded border px-2 py-1\",\n                              activeLayerId === layer.id ? 'bg-blue-100 border-blue-400' : 'bg-white'\n                            )}\n                            onClick={() => setActiveLayerId(layer.id)}\n                          >\n                            {layer.label}\n                          </button>\n                          <div className=\"flex items-center gap-1\">\n                            <Button\n                              size=\"sm\"\n                              variant={layer.visible ? 'default' : 'outline'}\n                              className=\"h-6 px-2 text-[11px]\"\n                              onClick={() =>\n                                setLayerConfig(layerConfig.map((item) =>\n                                  item.id === layer.id ? { ...item, visible: !item.visible } : item\n                                ))\n                              }\n                            >\n                              {layer.visible ? 'Visible' : 'Hidden'}\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant={layer.locked ? 'destructive' : 'outline'}\n                              className=\"h-6 px-2 text-[11px]\"\n                              onClick={() => setLayerLock(layer.id, !layer.locked)}\n                            >\n                              {layer.locked ? 'Locked' : 'Unlocked'}\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  <div className=\"rounded-md border p-2\">\n                    <div className=\"mb-2 flex items-center gap-2 text-sm font-semibold\">\n                      <Sparkles className=\"w-4 h-4\" />\n                      Spotlight + AI\n                    </div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant={spotlight.enabled ? 'default' : 'outline'}\n                        onClick={() =>\n                          updateSpotlight({ ...spotlight, enabled: !spotlight.enabled })\n                        }\n                      >\n                        {spotlight.enabled ? 'Disable Spotlight' : 'Enable Spotlight'}\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() =>\n                          updateSpotlight({\n                            ...spotlight,\n                            mode: spotlight.mode === 'rectangle' ? 'pen' : 'rectangle',\n                            width: spotlight.mode === 'rectangle' ? 160 : 420,\n                            height: spotlight.mode === 'rectangle' ? 160 : 220,\n                          })\n                        }\n                      >\n                        Spotlight Pen Mode\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() =>\n                          requestAIRegionHint({\n                            x: spotlight.x,\n                            y: spotlight.y,\n                            width: spotlight.width,\n                            height: spotlight.height,\n                          }, 'Tutor review request')\n                        }\n                      >\n                        AI Region Hint\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => setAssignmentOverlayMode('none')}>\n                        Template: None\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => setAssignmentOverlayMode('graph-paper')}>\n                        Template: Graph\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => setAssignmentOverlayMode('coordinate-plane')}>\n                        Template: Coordinate\n                      </Button>\n                    </div>\n                  </div>\n                  <div className=\"rounded-md border p-2\">\n                    <div className=\"mb-2 flex items-center gap-2 text-sm font-semibold\">\n                      <Clock3 className=\"w-4 h-4\" />\n                      Timeline + Export\n                    </div>\n                    <div className=\"space-y-2 text-xs\">\n                      <p>{snapshots.length} snapshots in timeline</p>\n                      <p className=\"text-[11px] text-gray-500\">\n                        Delta vs live: {Math.max(0, myStrokes.length - (timelinePreviewIndex !== null ? (snapshots[timelinePreviewIndex]?.strokes.length || 0) : myStrokes.length))} stroke(s)\n                      </p>\n                      <p className=\"text-[11px] text-gray-500\">\n                        Active page strokes: {activePageStrokes.length}\n                      </p>\n                      <div className=\"flex items-center gap-2\">\n                        <input\n                          type=\"range\"\n                          min={0}\n                          max={Math.max(0, snapshots.length - 1)}\n                          value={timelinePreviewIndex ?? 0}\n                          onChange={(e) => setTimelinePreviewIndex(Number(e.target.value))}\n                          disabled={snapshots.length === 0}\n                          className=\"w-full\"\n                        />\n                        <Button size=\"sm\" variant=\"ghost\" onClick={() => setTimelinePreviewIndex(null)}>\n                          Live\n                        </Button>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button size=\"sm\" variant=\"outline\" onClick={requestSnapshotTimeline}>\n                          Refresh Timeline\n                        </Button>\n                        <Button size=\"sm\" onClick={exportCurrentBoard}>\n                          <Download className=\"w-3.5 h-3.5 mr-1\" />\n                          Export Attach\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"rounded-md border p-2\">\n                    <div className=\"mb-2 flex items-center gap-2 text-sm font-semibold\">\n                      <Clock3 className=\"w-4 h-4\" />\n                      Audit Trail\n                    </div>\n                    <div className=\"max-h-24 space-y-1 overflow-auto text-[11px]\">\n                      {auditTrail.length === 0 ? (\n                        <p className=\"text-slate-500\">No actions yet.</p>\n                      ) : (\n                        auditTrail.map((entry) => (\n                          <div key={`${entry.at}-${entry.action}`} className=\"rounded border px-2 py-1\">\n                            <p className=\"font-medium\">{entry.action}</p>\n                            {entry.details ? <p className=\"text-slate-500\">{entry.details}</p> : null}\n                            <p className=\"text-[10px] text-slate-400\">{new Date(entry.at).toLocaleTimeString()}</p>\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n            \n            <TabsContent value=\"student-boards\" className=\"h-full m-0\">\n              <ScrollArea className=\"h-full p-4 space-y-4\">\n                {submissions.length > 0 && (\n                  <div className=\"mb-4 border rounded-lg p-3 bg-amber-50/50\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <h4 className=\"text-sm font-semibold\">Submission Queue</h4>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\">{pendingSubmissions.length} pending</Badge>\n                        {pendingSubmissions.length > 1 && (\n                          <Button size=\"sm\" variant=\"outline\" onClick={markAllSubmissionsReviewed}>\n                            Mark All Reviewed\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      {submissions.map((submission) => (\n                        <div key={submission.studentId} className=\"flex items-center justify-between rounded-md border bg-white px-2 py-1.5\">\n                          <div>\n                            <p className=\"text-sm font-medium\">{submission.studentName}</p>\n                            <p className=\"text-xs text-gray-500\">\n                              {submission.strokeCount} strokes • {new Date(submission.submittedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                            </p>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => viewStudentWhiteboard(submission.studentId)}>\n                              View\n                            </Button>\n                            <Button variant=\"secondary\" size=\"sm\" onClick={() => openReviewPanel(submission.studentId)}>\n                              Review\n                            </Button>\n                            <Button\n                              variant={submission.pinned ? 'default' : 'outline'}\n                              size=\"sm\"\n                              onClick={() => pinSubmission(submission.studentId, !submission.pinned)}\n                            >\n                              {submission.pinned ? <PinOff className=\"w-3.5 h-3.5 mr-1\" /> : <Pin className=\"w-3.5 h-3.5 mr-1\" />}\n                              {submission.pinned ? 'Unpin' : 'Pin'}\n                            </Button>\n                            {!submission.reviewed ? (\n                              <Button size=\"sm\" onClick={() => markSubmissionReviewed(submission.studentId)}>\n                                Mark Reviewed\n                              </Button>\n                            ) : (\n                              <Badge className=\"bg-green-100 text-green-700 border-green-200\">\n                                <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n                                Reviewed\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                <div className=\"mb-3 flex items-center justify-between\">\n                  <h4 className=\"text-sm font-semibold\">Student Boards</h4>\n                  <div className=\"flex items-center gap-1 flex-wrap justify-end\">\n                    <Button\n                      size=\"sm\"\n                      variant={submissionFilter === 'all' ? 'default' : 'outline'}\n                      onClick={() => setSubmissionFilter('all')}\n                    >\n                      All\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant={submissionFilter === 'submitted' ? 'default' : 'outline'}\n                      onClick={() => setSubmissionFilter('submitted')}\n                    >\n                      Submitted Only\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant={submissionFilter === 'pending' ? 'default' : 'outline'}\n                      onClick={() => setSubmissionFilter('pending')}\n                    >\n                      Pending\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant={submissionFilter === 'reviewed' ? 'default' : 'outline'}\n                      onClick={() => setSubmissionFilter('reviewed')}\n                    >\n                      Reviewed\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  {visibleStudents.map(student => {\n                    const wb = studentWhiteboards.get(student.id)\n                    const isViewing = viewingStudentId === student.id\n                    const submission = submissionByStudentId.get(student.id)\n                    \n                    return (\n                      <div\n                        key={student.id}\n                        className={cn(\n                          \"border rounded-lg p-3 cursor-pointer transition-all\",\n                          isViewing ? 'ring-2 ring-blue-500' : 'hover:border-blue-300',\n                          wb?.visibility === 'private' && \"opacity-50\"\n                        )}\n                        onClick={() => {\n                          if (wb && wb.visibility !== 'private') {\n                            viewStudentWhiteboard(student.id)\n                          }\n                        }}\n                      >\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <span className=\"font-medium text-sm\">{student.name}</span>\n                          <div className=\"flex items-center gap-1\">\n                            {submission && (\n                              <Badge className={cn(\n                                \"text-xs\",\n                                submission.reviewed\n                                  ? 'bg-green-100 text-green-700 border-green-200'\n                                  : 'bg-amber-100 text-amber-700 border-amber-200'\n                              )}>\n                                {submission.reviewed ? 'Reviewed' : 'Submitted'}\n                              </Badge>\n                            )}\n                            {wb && (\n                              <Badge variant={wb.visibility === 'public' ? 'default' : 'secondary'} className=\"text-xs\">\n                                {wb.visibility === 'public' ? <Eye className=\"w-3 h-3 mr-1\" /> : <EyeOff className=\"w-3 h-3 mr-1\" />}\n                                {wb.visibility}\n                              </Badge>\n                            )}\n                            {!wb && (\n                              <Badge variant=\"outline\" className=\"text-xs\">No activity</Badge>\n                            )}\n                            <Button\n                              size=\"sm\"\n                              variant={moderationState.mutedStudentIds.includes(student.id) ? 'destructive' : 'outline'}\n                              className=\"h-6 px-2 text-[11px]\"\n                              onClick={(e) => {\n                                e.stopPropagation()\n                                setDrawMuteForStudent(student.id, !moderationState.mutedStudentIds.includes(student.id))\n                              }}\n                            >\n                              <Ban className=\"w-3 h-3 mr-1\" />\n                              {moderationState.mutedStudentIds.includes(student.id) ? 'Muted' : 'Mute'}\n                            </Button>\n                          </div>\n                        </div>\n                        \n                        {/* Mini preview */}\n                        <div className=\"h-24 bg-gray-50 rounded border flex items-center justify-center\">\n                          {wb && wb.strokes.length > 0 ? (\n                            <MiniCanvas strokes={wb.strokes} />\n                          ) : (\n                            <span className=\"text-xs text-gray-400\">Empty</span>\n                          )}\n                        </div>\n                        \n                        {isViewing && (\n                          <div className=\"mt-2 flex items-center gap-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"flex-1\"\n                              onClick={(e) => {\n                                e.stopPropagation()\n                                stopViewingStudent()\n                              }}\n                            >\n                              Stop Viewing\n                            </Button>\n                            {submission && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"flex-1\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  openReviewPanel(student.id)\n                                }}\n                              >\n                                Open Review\n                              </Button>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    )\n                  })}\n                  {visibleStudents.length === 0 && (\n                    <div className=\"col-span-3 border rounded-lg p-6 text-center text-sm text-gray-500\">\n                      No submitted boards yet.\n                    </div>\n                  )}\n                </div>\n                <div className=\"mt-4 rounded-md border p-3 bg-muted/20\">\n                  <h4 className=\"text-sm font-semibold mb-2\">Moderation + Overlay + Breakout Sync</h4>\n                  <div className=\"grid grid-cols-1 gap-3 md:grid-cols-3\">\n                    <div className=\"space-y-2 text-xs\">\n                      <p className=\"font-medium\">Anti-spam stroke throttle</p>\n                      <Slider\n                        value={[moderationState.studentStrokeWindowLimit]}\n                        onValueChange={([value]) => updateStrokeRateLimit(value)}\n                        min={20}\n                        max={200}\n                        step={5}\n                      />\n                      <p>{moderationState.studentStrokeWindowLimit} strokes / 5s</p>\n                    </div>\n                    <div className=\"space-y-2 text-xs\">\n                      <p className=\"font-medium\">Assignment overlay</p>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {(['none', 'graph-paper', 'geometry-grid', 'coordinate-plane', 'chemistry-structure'] as const).map((overlay) => (\n                          <Button\n                            key={overlay}\n                            size=\"sm\"\n                            variant={assignmentOverlay === overlay ? 'default' : 'outline'}\n                            className=\"h-6 px-2 text-[11px]\"\n                            onClick={() => setAssignmentOverlayMode(overlay)}\n                          >\n                            {overlay}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                    <div className=\"space-y-2 text-xs\">\n                      <p className=\"font-medium\">Breakout board sync</p>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => promoteBreakoutBoard('breakout-demo', activePageStrokes)}\n                      >\n                        Promote Best Board to Main Room\n                      </Button>\n                    </div>\n                  </div>\n                  {aiRegionHints.length > 0 && (\n                    <div className=\"mt-3 rounded border bg-white p-2\">\n                      <p className=\"text-xs font-semibold mb-1\">AI Board Insight</p>\n                      <p className=\"text-xs text-gray-700\">{aiRegionHints[0].hint}</p>\n                      <p className=\"text-[11px] text-amber-700 mt-1\">{aiRegionHints[0].misconception}</p>\n                    </div>\n                  )}\n                </div>\n              </ScrollArea>\n            </TabsContent>\n\n            <TabsContent value=\"pdf-board\" className=\"h-full m-0\">\n              <div className=\"h-full overflow-auto p-4\">\n                <PDFTutoringWorkbench roomId={`${roomId}:pdf`} />\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      <Dialog\n        open={isReviewPanelOpen}\n        onOpenChange={(open) => {\n          setIsReviewPanelOpen(open)\n          if (!open) setReviewStudentId(null)\n        }}\n      >\n        <DialogContent className=\"max-w-5xl max-h-[88vh] overflow-hidden p-0\">\n          <DialogHeader className=\"border-b px-6 py-4\">\n            <DialogTitle>Tutor Review Panel</DialogTitle>\n            <DialogDescription>\n              Review submitted student work against your board and close feedback loops quickly.\n              Shortcuts: `J` next, `K` previous, `R` mark reviewed.\n            </DialogDescription>\n          </DialogHeader>\n\n          {!reviewStudentId || !reviewStudent ? (\n            <div className=\"m-6 rounded-md border p-6 text-sm text-gray-500\">\n              Pick a student submission to begin review.\n            </div>\n          ) : (\n            <div className=\"space-y-4 overflow-y-auto px-6 py-4\">\n              <div className=\"flex flex-wrap items-center justify-between gap-2 rounded-lg border bg-muted/40 px-3 py-2\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-medium\">{reviewStudent.name}</span>\n                  {reviewSubmission ? (\n                    <Badge className={cn(\n                      reviewSubmission.reviewed\n                        ? 'bg-green-100 text-green-700 border-green-200'\n                        : 'bg-amber-100 text-amber-700 border-amber-200'\n                    )}>\n                      {reviewSubmission.reviewed ? 'Reviewed' : 'Pending review'}\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"outline\">No submission metadata</Badge>\n                  )}\n                </div>\n                <div className=\"text-xs text-gray-500\">\n                  {reviewSubmission\n                    ? `${reviewSubmission.strokeCount} strokes • ${new Date(reviewSubmission.submittedAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`\n                    : 'No timestamp available'}\n                </div>\n              </div>\n\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <div className=\"rounded-lg border p-3\">\n                  <div className=\"mb-2 flex items-center justify-between\">\n                    <h4 className=\"text-sm font-semibold\">Student Board</h4>\n                    <Badge variant=\"secondary\">{reviewStudentBoard?.strokes.length ?? 0} strokes</Badge>\n                  </div>\n                  <ReviewCanvas strokes={reviewStudentBoard?.strokes ?? []} />\n                </div>\n                <div className=\"rounded-lg border p-3\">\n                  <div className=\"mb-2 flex items-center justify-between\">\n                    <h4 className=\"text-sm font-semibold\">Tutor Board Reference</h4>\n                    <Badge variant=\"secondary\">{myStrokes.length} strokes</Badge>\n                  </div>\n                  <ReviewCanvas strokes={activePageStrokes} />\n                </div>\n              </div>\n            </div>\n          )}\n\n          <DialogFooter className=\"border-t px-6 py-4\">\n            <div className=\"flex w-full flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={reviewPreviousPending}\n                  disabled={pendingSubmissions.length === 0}\n                >\n                  Previous Pending (K)\n                </Button>\n                <Button\n                  variant=\"secondary\"\n                  onClick={reviewNextPending}\n                  disabled={pendingSubmissions.length === 0}\n                >\n                  Next Pending (J)\n                </Button>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {reviewStudentId && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      viewStudentWhiteboard(reviewStudentId)\n                      setActiveTab('student-boards')\n                      setIsReviewPanelOpen(false)\n                    }}\n                  >\n                    Jump to Live Board\n                  </Button>\n                )}\n                {reviewSubmission && !reviewSubmission.reviewed && (\n                  <Button\n                    onClick={() => markSubmissionReviewed(reviewSubmission.studentId)}\n                  >\n                    Mark Reviewed (R)\n                  </Button>\n                )}\n              </div>\n            </div>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n\n// Mini canvas for student preview\nfunction MiniCanvas({ strokes }: { strokes: WhiteboardStroke[] }) {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  \n  useEffect(() => {\n    const canvas = canvasRef.current\n    const ctx = canvas?.getContext('2d')\n    if (!canvas || !ctx) return\n    \n    // Clear\n    ctx.fillStyle = '#ffffff'\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    \n    // Draw strokes (scaled down)\n    strokes.forEach(stroke => {\n      if (stroke.points.length < 2) return\n      \n      ctx.beginPath()\n      ctx.moveTo(stroke.points[0].x / 4, stroke.points[0].y / 4)\n      stroke.points.forEach((point, i) => {\n        if (i > 0) ctx.lineTo(point.x / 4, point.y / 4)\n      })\n      \n      ctx.strokeStyle = stroke.color\n      ctx.lineWidth = Math.max(1, stroke.width / 4)\n      ctx.lineCap = 'round'\n      ctx.stroke()\n    })\n  }, [strokes])\n  \n  return (\n    <canvas\n      ref={canvasRef}\n      width={150}\n      height={100}\n      className=\"w-full h-full\"\n    />\n  )\n}\n\nfunction ReviewCanvas({ strokes }: { strokes: WhiteboardStroke[] }) {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    const canvas = canvasRef.current\n    const ctx = canvas?.getContext('2d')\n    if (!canvas || !ctx) return\n\n    ctx.fillStyle = '#ffffff'\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n    if (strokes.length === 0) return\n\n    // Fit all points into the panel while preserving their shape.\n    const allPoints = strokes.flatMap((stroke) => stroke.points)\n    if (allPoints.length === 0) return\n\n    const minX = Math.min(...allPoints.map((p) => p.x))\n    const minY = Math.min(...allPoints.map((p) => p.y))\n    const maxX = Math.max(...allPoints.map((p) => p.x))\n    const maxY = Math.max(...allPoints.map((p) => p.y))\n    const width = Math.max(1, maxX - minX)\n    const height = Math.max(1, maxY - minY)\n\n    const padding = 16\n    const scaleX = (canvas.width - padding * 2) / width\n    const scaleY = (canvas.height - padding * 2) / height\n    const scale = Math.max(0.2, Math.min(scaleX, scaleY))\n\n    const offsetX = (canvas.width - width * scale) / 2 - minX * scale\n    const offsetY = (canvas.height - height * scale) / 2 - minY * scale\n\n    strokes.forEach((stroke) => {\n      if (stroke.points.length < 2) return\n\n      ctx.beginPath()\n      ctx.moveTo(stroke.points[0].x * scale + offsetX, stroke.points[0].y * scale + offsetY)\n      stroke.points.forEach((point, i) => {\n        if (i > 0) ctx.lineTo(point.x * scale + offsetX, point.y * scale + offsetY)\n      })\n\n      ctx.strokeStyle = stroke.color\n      ctx.lineWidth = Math.max(1, stroke.width * scale * 0.6)\n      ctx.lineCap = 'round'\n      ctx.lineJoin = 'round'\n      ctx.stroke()\n    })\n  }, [strokes])\n\n  return (\n    <div className=\"h-64 w-full rounded-md border bg-white\">\n      <canvas\n        ref={canvasRef}\n        width={600}\n        height={320}\n        className=\"h-full w-full\"\n      />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5732, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/tutor/live-class/components/LiveSharedDocumentModal.tsx"],"sourcesContent":["'use client'\n\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Switch } from '@/components/ui/switch'\nimport { Label } from '@/components/ui/label'\nimport { Badge } from '@/components/ui/badge'\nimport { PDFCollaborativeViewer } from '@/components/pdf-tutoring/PDFCollaborativeViewer'\n\nexport interface LiveDocumentCollaborationPolicy {\n  allowDrawing: boolean\n  allowTyping: boolean\n  allowShapes: boolean\n}\n\nexport interface LiveSharedDocument {\n  shareId: string\n  classRoomId: string\n  ownerId: string\n  ownerName: string\n  assignedStudentId?: string\n  templateShareId?: string\n  title: string\n  description?: string\n  fileUrl: string\n  mimeType?: string\n  pdfRoomId: string\n  visibleToAll: boolean\n  allowCollaborativeWrite: boolean\n  collaborationPolicy?: LiveDocumentCollaborationPolicy\n  active: boolean\n  submissions?: Array<{ userId: string; userName: string; submittedAt: number }>\n  updatedAt: number\n}\n\ninterface LiveSharedDocumentModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  share: LiveSharedDocument | null\n  viewerRole: 'tutor' | 'student'\n  canManageShare?: boolean\n  onVisibilityChange?: (visible: boolean) => void\n  onWriteAccessChange?: (allow: boolean) => void\n  onCollaborationPolicyChange?: (policy: LiveDocumentCollaborationPolicy) => void\n  onSubmitToTutor?: () => void\n  hasSubmitted?: boolean\n}\n\nexport function LiveSharedDocumentModal({\n  open,\n  onOpenChange,\n  share,\n  viewerRole,\n  canManageShare = false,\n  onVisibilityChange,\n  onWriteAccessChange,\n  onCollaborationPolicyChange,\n  onSubmitToTutor,\n  hasSubmitted = false,\n}: LiveSharedDocumentModalProps) {\n  if (!share) return null\n  const isPdf = (share.mimeType || '').includes('pdf') || share.fileUrl.toLowerCase().includes('.pdf')\n  const isReadOnly = !share.allowCollaborativeWrite && !canManageShare\n  const collaborationPolicy: LiveDocumentCollaborationPolicy = {\n    allowDrawing: share.collaborationPolicy?.allowDrawing ?? true,\n    allowTyping: share.collaborationPolicy?.allowTyping ?? true,\n    allowShapes: share.collaborationPolicy?.allowShapes ?? true,\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-h-[92vh] w-[95vw] max-w-[1300px] overflow-hidden p-0\">\n        <div className=\"flex h-full flex-col\">\n          <DialogHeader className=\"border-b px-5 py-4\">\n            <div className=\"flex items-center gap-2\">\n              <DialogTitle>{share.title}</DialogTitle>\n              <Badge variant=\"outline\">Owner: {share.ownerName}</Badge>\n              <Badge variant={share.visibleToAll ? 'default' : 'secondary'}>\n                {share.visibleToAll ? 'Visible to class' : 'Private copy'}\n              </Badge>\n              <Badge variant=\"outline\">\n                Submissions: {share.submissions?.length || 0}\n              </Badge>\n            </div>\n            <DialogDescription>\n              {share.description || 'Shared live document session'}\n            </DialogDescription>\n          </DialogHeader>\n\n          {canManageShare && (\n            <div className=\"grid grid-cols-1 gap-4 border-b px-5 py-3 md:grid-cols-2\">\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={share.visibleToAll} onCheckedChange={onVisibilityChange} />\n                <Label>Visible to everyone in this live class</Label>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={share.allowCollaborativeWrite} onCheckedChange={onWriteAccessChange} />\n                <Label>Allow others to write/type on this document</Label>\n              </div>\n              <div className=\"col-span-full grid grid-cols-1 gap-3 rounded-md border bg-muted/20 px-3 py-2 md:grid-cols-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    checked={collaborationPolicy.allowDrawing}\n                    onCheckedChange={(checked) => onCollaborationPolicyChange?.({ ...collaborationPolicy, allowDrawing: checked })}\n                    disabled={!share.allowCollaborativeWrite}\n                  />\n                  <Label>Allow drawing</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    checked={collaborationPolicy.allowTyping}\n                    onCheckedChange={(checked) => onCollaborationPolicyChange?.({ ...collaborationPolicy, allowTyping: checked })}\n                    disabled={!share.allowCollaborativeWrite}\n                  />\n                  <Label>Allow typing</Label>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    checked={collaborationPolicy.allowShapes}\n                    onCheckedChange={(checked) => onCollaborationPolicyChange?.({ ...collaborationPolicy, allowShapes: checked })}\n                    disabled={!share.allowCollaborativeWrite}\n                  />\n                  <Label>Allow shapes</Label>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {!canManageShare && onSubmitToTutor && (\n            <div className=\"border-b px-5 py-3\">\n              <button\n                type=\"button\"\n                onClick={onSubmitToTutor}\n                disabled={hasSubmitted}\n                className=\"rounded border px-3 py-1.5 text-sm hover:bg-muted disabled:opacity-60\"\n              >\n                {hasSubmitted ? 'Submitted to Tutor' : 'Submit to Tutor'}\n              </button>\n            </div>\n          )}\n\n          <div className=\"min-h-0 flex-1 overflow-auto p-0\">\n            {isPdf ? (\n              <PDFCollaborativeViewer\n                roomId={share.pdfRoomId}\n                role={viewerRole}\n                initialPdfUrl={share.fileUrl}\n                forceLocked={isReadOnly}\n                showLockControl={canManageShare}\n                showCollabStatus={viewerRole === 'tutor'}\n                showAiActions={viewerRole === 'tutor'}\n                capabilities={{\n                  draw: canManageShare || (share.allowCollaborativeWrite && collaborationPolicy.allowDrawing),\n                  erase: canManageShare || (share.allowCollaborativeWrite && collaborationPolicy.allowDrawing),\n                  text: canManageShare || (share.allowCollaborativeWrite && collaborationPolicy.allowTyping),\n                  shapes: canManageShare || (share.allowCollaborativeWrite && collaborationPolicy.allowShapes),\n                  select: canManageShare || share.allowCollaborativeWrite,\n                  clear: canManageShare || share.allowCollaborativeWrite,\n                }}\n              />\n            ) : (\n              <div className=\"m-4 rounded-lg border bg-muted/20 p-4 text-sm\">\n                <p className=\"font-medium\">This file is not a PDF.</p>\n                <p className=\"text-muted-foreground\">\n                  Open the source file in a new tab. PDF canvas annotation is available for PDF files.\n                </p>\n                <a\n                  href={share.fileUrl}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"mt-3 inline-block text-blue-600 underline\"\n                >\n                  Open source file\n                </a>\n              </div>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6080, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/%5Blocale%5D/tutor/live-class/components/MultiLayerWhiteboardInterface.tsx"],"sourcesContent":["'use client'\n\nimport { useMemo, useEffect, useState, useCallback, useRef } from 'react'\nimport { useSession } from 'next-auth/react'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { TutorWhiteboardManager } from './TutorWhiteboardManager'\nimport { StudentLiveWhiteboard } from '@/app/[locale]/student/live/components/StudentLiveWhiteboard'\nimport { PDFCollaborativeViewer } from '@/components/pdf-tutoring/PDFCollaborativeViewer'\nimport { useSimpleSocket } from '@/hooks/use-simple-socket'\nimport { LiveSharedDocumentModal, LiveSharedDocument, type LiveDocumentCollaborationPolicy } from './LiveSharedDocumentModal'\nimport type { VisibleDocumentPayload } from '../../dashboard/components/CourseBuilder'\nimport { Layers, Users, Radio, Eye } from 'lucide-react'\nimport { toast } from 'sonner'\n\ninterface MultiLayerStudent {\n  id: string\n  name: string\n  status: string\n  engagement: number\n}\n\ninterface MultiLayerWhiteboardInterfaceProps {\n  sessionId: string\n  roomId: string\n  initialCourseId?: string | null\n  classSubject?: string\n  students: MultiLayerStudent[]\n  isSocketConnected: boolean\n  onLayerUpdate?: (layerData: unknown) => void\n  onPermissionChange?: (permissionData: unknown) => void\n}\n\nexport function MultiLayerWhiteboardInterface({\n  sessionId,\n  roomId,\n  initialCourseId,\n  classSubject,\n  students,\n  isSocketConnected,\n}: MultiLayerWhiteboardInterfaceProps) {\n  const { data: session } = useSession()\n  const isTutor = session?.user?.role === 'TUTOR'\n  const userId = session?.user?.id\n  const userName = session?.user?.name || (isTutor ? 'Tutor' : 'Student')\n  const socketRole: 'tutor' | 'student' = isTutor ? 'tutor' : 'student'\n  const { socket } = useSimpleSocket(roomId, {\n    userId,\n    name: userName,\n    role: socketRole,\n  })\n  const [shares, setShares] = useState<Record<string, LiveSharedDocument>>({})\n  const [activeShareId, setActiveShareId] = useState<string | null>(null)\n  const [uploadingPersonalDoc, setUploadingPersonalDoc] = useState(false)\n  const announcedSharesRef = useRef<Set<string>>(new Set())\n\n  const connectedStudents = useMemo(\n    () => students.filter((student) => student.status === 'online').length,\n    [students]\n  )\n\n  const publishShare = useCallback((share: LiveSharedDocument) => {\n    if (socket) {\n      socket.emit('live_doc_share_update', share)\n    }\n  }, [socket])\n\n  const handleShareRequestFromBuilder = useCallback((payload: VisibleDocumentPayload) => {\n    if (!userId || !payload.sourceDocument) return\n    const shareId = `share-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`\n    const share: LiveSharedDocument = {\n      shareId,\n      classRoomId: roomId,\n      ownerId: userId,\n      ownerName: userName,\n      title: payload.title,\n      description: payload.description,\n      fileUrl: payload.sourceDocument.fileUrl,\n      mimeType: payload.sourceDocument.mimeType,\n      pdfRoomId: `${roomId}:pdf-share:${userId}:${shareId}`,\n      visibleToAll: true,\n      allowCollaborativeWrite: true,\n      collaborationPolicy: {\n        allowDrawing: true,\n        allowTyping: true,\n        allowShapes: true,\n      },\n      active: true,\n      submissions: [],\n      updatedAt: Date.now(),\n    }\n    setShares((prev) => ({ ...prev, [shareId]: share }))\n    publishShare(share)\n    setActiveShareId(shareId)\n  }, [publishShare, roomId, userId, userName])\n\n  const uploadAndSharePersonalDocument = useCallback(async (file: File) => {\n    if (!socket || !userId) return\n    setUploadingPersonalDoc(true)\n    try {\n      const formData = new FormData()\n      formData.append('file', file)\n      const uploadRes = await fetch('/api/uploads/documents', {\n        method: 'POST',\n        credentials: 'include',\n        body: formData,\n      })\n      if (!uploadRes.ok) return\n      const uploadData = await uploadRes.json()\n      const shareId = `share-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`\n      const share: LiveSharedDocument = {\n        shareId,\n        classRoomId: roomId,\n        ownerId: userId,\n        ownerName: userName,\n        title: file.name,\n        description: 'Student shared document',\n        fileUrl: uploadData.url,\n        mimeType: file.type,\n        pdfRoomId: `${roomId}:pdf-share:${userId}:${shareId}`,\n        visibleToAll: true,\n        allowCollaborativeWrite: true,\n        collaborationPolicy: {\n          allowDrawing: true,\n          allowTyping: true,\n          allowShapes: true,\n        },\n        active: true,\n        updatedAt: Date.now(),\n      }\n      publishShare(share)\n      setActiveShareId(shareId)\n    } finally {\n      setUploadingPersonalDoc(false)\n    }\n  }, [publishShare, roomId, socket, userId, userName])\n\n  useEffect(() => {\n    if (!socket || !roomId) return\n\n    const handleShareUpdate = (share: LiveSharedDocument) => {\n      if (share.classRoomId !== roomId) return\n      setShares((prev) => ({ ...prev, [share.shareId]: share }))\n      if (\n        share.active &&\n        (share.visibleToAll || share.ownerId === userId) &&\n        !announcedSharesRef.current.has(share.shareId)\n      ) {\n        announcedSharesRef.current.add(share.shareId)\n        toast.info(`Live task available: ${share.title}. Open from Tasks.`)\n      }\n      if (share.active && (share.visibleToAll || share.ownerId === userId)) {\n        setActiveShareId(share.shareId)\n      }\n    }\n\n    const handleShareSubmission = (data: {\n      classRoomId: string\n      shareId: string\n      userId: string\n      userName: string\n      submittedAt: number\n    }) => {\n      if (data.classRoomId !== roomId) return\n      setShares((prev) => {\n        const current = prev[data.shareId]\n        if (!current) return prev\n        const existing = current.submissions || []\n        if (existing.some((submission) => submission.userId === data.userId)) return prev\n        return {\n          ...prev,\n          [data.shareId]: {\n            ...current,\n            submissions: [...existing, { userId: data.userId, userName: data.userName, submittedAt: data.submittedAt }],\n            updatedAt: Date.now(),\n          },\n        }\n      })\n    }\n\n    const handleShareState = (data: { classRoomId: string; shares: LiveSharedDocument[] }) => {\n      if (data.classRoomId !== roomId) return\n      const next: Record<string, LiveSharedDocument> = {}\n      data.shares.forEach((share) => {\n        next[share.shareId] = share\n      })\n      setShares(next)\n    }\n\n    socket.on('live_doc_share_update', handleShareUpdate)\n    socket.on('live_doc_share_state', handleShareState)\n    socket.on('live_doc_task_submitted', handleShareSubmission)\n    socket.emit('live_doc_share_state_request', { classRoomId: roomId })\n\n    return () => {\n      socket.off('live_doc_share_update', handleShareUpdate)\n      socket.off('live_doc_share_state', handleShareState)\n      socket.off('live_doc_task_submitted', handleShareSubmission)\n    }\n  }, [socket, roomId, userId])\n\n  const activeShare = activeShareId ? shares[activeShareId] || null : null\n  const canManageActiveShare = Boolean(activeShare && userId && activeShare.ownerId === userId)\n  const visibleShares = useMemo(\n    () =>\n      Object.values(shares)\n        .filter((share) => share.active && (share.visibleToAll || share.ownerId === userId))\n        .sort((a, b) => b.updatedAt - a.updatedAt),\n    [shares, userId]\n  )\n  const updateActiveSharePolicy = useCallback((policy: LiveDocumentCollaborationPolicy) => {\n    if (!activeShare || !canManageActiveShare) return\n    publishShare({ ...activeShare, collaborationPolicy: policy })\n  }, [activeShare, canManageActiveShare, publishShare])\n\n  if (isTutor) {\n    return (\n      <>\n        <div className=\"h-full grid grid-cols-1 xl:grid-cols-[1fr_300px] gap-4\">\n          <div className=\"min-h-0\">\n            <TutorWhiteboardManager\n              roomId={roomId}\n              sessionId={sessionId}\n              initialCourseId={initialCourseId}\n              classSubject={classSubject}\n              students={students.map((student) => ({ id: student.id, name: student.name }))}\n              onDocumentVisibleToStudents={handleShareRequestFromBuilder}\n            />\n          </div>\n\n          <Card className=\"min-h-0 overflow-hidden\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Layers className=\"w-4 h-4 text-blue-600\" />\n                Multi-Layer Controls\n              </CardTitle>\n              <CardDescription>\n                Broadcast your board and monitor student boards in real time.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-sm\">\n              <div className=\"flex items-center justify-between p-2 rounded-md bg-gray-50 border\">\n                <span className=\"text-gray-600\">Socket</span>\n                <Badge variant={isSocketConnected ? 'default' : 'secondary'}>\n                  {isSocketConnected ? 'Connected' : 'Offline'}\n                </Badge>\n              </div>\n              <div className=\"flex items-center justify-between p-2 rounded-md bg-gray-50 border\">\n                <span className=\"text-gray-600 flex items-center gap-1\">\n                  <Users className=\"w-3 h-3\" />\n                  Online Students\n                </span>\n                <span className=\"font-medium\">{connectedStudents}</span>\n              </div>\n              <div className=\"flex items-center justify-between p-2 rounded-md bg-gray-50 border\">\n                <span className=\"text-gray-600\">Total Boards</span>\n                <span className=\"font-medium\">{students.length + 1}</span>\n              </div>\n\n              <div className=\"pt-2 space-y-2 text-xs text-gray-600\">\n                <p className=\"flex items-start gap-1\">\n                  <Radio className=\"w-3 h-3 mt-0.5 text-red-500\" />\n                  <strong>Broadcast</strong>: send your whiteboard to all students in real time.\n                </p>\n                <p className=\"flex items-start gap-1\">\n                  <Eye className=\"w-3 h-3 mt-0.5 text-blue-500\" />\n                  <strong>Lock Student Layers</strong>: prevent students from drawing until you unlock.\n                </p>\n                <p className=\"flex items-start gap-1\">\n                  <Eye className=\"w-3 h-3 mt-0.5 text-muted-foreground\" />\n                  Switch to <strong>Students</strong> to review individual work quickly.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <LiveSharedDocumentModal\n          open={Boolean(activeShare)}\n          onOpenChange={(open) => {\n            if (!open) setActiveShareId(null)\n          }}\n          share={activeShare}\n          viewerRole=\"tutor\"\n          canManageShare={canManageActiveShare}\n          onVisibilityChange={(visible) => {\n            if (!activeShare || !canManageActiveShare) return\n            publishShare({ ...activeShare, visibleToAll: visible, active: visible })\n          }}\n          onWriteAccessChange={(allow) => {\n            if (!activeShare || !canManageActiveShare) return\n            publishShare({ ...activeShare, allowCollaborativeWrite: allow })\n          }}\n          onCollaborationPolicyChange={updateActiveSharePolicy}\n        />\n      </>\n    )\n  }\n\n  return (\n    <>\n      <Card className=\"h-full\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base flex items-center gap-2\">\n            <Layers className=\"w-4 h-4 text-blue-600\" />\n            Collaborative Whiteboard\n          </CardTitle>\n          <CardDescription>\n            Draw on your own layer while viewing tutor annotations in real time.\n          </CardDescription>\n          <div className=\"pt-2\">\n            <Button size=\"sm\" variant=\"outline\" disabled={uploadingPersonalDoc} asChild>\n              <label className=\"cursor-pointer\">\n                {uploadingPersonalDoc ? 'Sharing...' : 'Share My Document'}\n                <input\n                  type=\"file\"\n                  className=\"hidden\"\n                  accept=\".pdf,.txt,.md,.doc,.docx,image/*\"\n                  onChange={(event) => {\n                    const file = event.target.files?.[0]\n                    if (!file) return\n                    void uploadAndSharePersonalDocument(file)\n                    event.currentTarget.value = ''\n                  }}\n                />\n              </label>\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"h-[calc(100%-84px)] p-3\">\n          <Tabs defaultValue=\"student-board\" className=\"h-full\">\n            <TabsList className=\"mb-2\">\n              <TabsTrigger value=\"student-board\">Whiteboard</TabsTrigger>\n              <TabsTrigger value=\"student-pdf\">PDF Tutoring</TabsTrigger>\n            </TabsList>\n            <TabsContent value=\"student-board\" className=\"h-[calc(100%-40px)] m-0\">\n              <StudentLiveWhiteboard\n                roomId={roomId}\n                sessionId={sessionId}\n                mode=\"embedded\"\n                visibleTaskShares={visibleShares}\n                onOpenTask={(shareId) => setActiveShareId(shareId)}\n              />\n            </TabsContent>\n            <TabsContent value=\"student-pdf\" className=\"h-[calc(100%-40px)] m-0 overflow-auto\">\n              <PDFCollaborativeViewer roomId={`${roomId}:pdf`} role=\"student\" />\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      <LiveSharedDocumentModal\n        open={Boolean(activeShare)}\n        onOpenChange={(open) => {\n          if (!open) setActiveShareId(null)\n        }}\n        share={activeShare}\n        viewerRole={socketRole}\n        canManageShare={canManageActiveShare}\n        onVisibilityChange={(visible) => {\n          if (!activeShare || !canManageActiveShare) return\n          publishShare({ ...activeShare, visibleToAll: visible, active: visible })\n        }}\n        onWriteAccessChange={(allow) => {\n          if (!activeShare || !canManageActiveShare) return\n          publishShare({ ...activeShare, allowCollaborativeWrite: allow })\n        }}\n        onCollaborationPolicyChange={updateActiveSharePolicy}\n        onSubmitToTutor={() => {\n          if (!socket || !activeShare || !userId) return\n          socket.emit('live_doc_task_submit', {\n            classRoomId: roomId,\n            shareId: activeShare.shareId,\n            userId,\n            userName,\n          })\n        }}\n        hasSubmitted={Boolean(activeShare?.submissions?.some((submission) => submission.userId === userId))}\n      />\n    </>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}