{
  "version": 3,
  "sources": [],
  "debugId": "e4f66377-c914-177d-0965-e86217168ea4",
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-socket.ts"],"sourcesContent":["/**\n * React Hook for Socket.io Client\n * Provides real-time communication for live class sessions\n */\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { io, Socket } from 'socket.io-client'\nimport { StudentState, ChatMessage, BreakoutRoom } from '@/lib/socket-server'\n\ninterface UseSocketOptions {\n  roomId: string\n  userId: string\n  name: string\n  role: 'student' | 'tutor'\n  tutorId?: string\n  onStudentJoined?: (student: StudentState) => void\n  onStudentLeft?: (userId: string) => void\n  onStudentStateUpdate?: (data: { userId: string; state: StudentState }) => void\n  onStudentDistress?: (data: { userId: string; name: string; message: string }) => void\n  onChatMessage?: (message: ChatMessage) => void\n  onTutorBroadcast?: (message: ChatMessage) => void\n  onAIHint?: (hint: { userId: string; text: string; type: string }) => void\n  onWhiteboardUpdate?: (data: { strokes: any[] }) => void\n  onCodeUpdate?: (data: { content: string; language: string; userId: string }) => void\n  onBreakoutInvite?: (data: { roomId: string; roomUrl: string; tutorName: string }) => void\n  onBreakoutRoomUpdate?: (rooms: BreakoutRoom[]) => void\n  onBreakoutMessage?: (message: { id: string; senderId: string; senderName: string; content: string; timestamp: number; isAi?: boolean }) => void\n  onNotification?: (notification: { type: string; message: string }) => void\n  onRoomState?: (state: {\n    students: StudentState[]\n    chatHistory: ChatMessage[]\n    whiteboardData?: any\n  }) => void\n}\n\nexport function useSocket(options?: UseSocketOptions) {\n  const socketRef = useRef<Socket | null>(null)\n  const [isConnected, setIsConnected] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    let socket: Socket\n    const connect = async () => {\n      const token = await import('@/lib/socket-auth').then((m) => m.getSocketToken())\n      if (!token) {\n        setError('Authentication required')\n        return\n      }\n      socket = io({\n        path: '/api/socket',\n        transports: ['websocket', 'polling'],\n        auth: { token },\n      })\n      socketRef.current = socket\n\n    socket.on('connect', () => {\n      console.log('Socket connected:', socket.id)\n      setIsConnected(true)\n      setError(null)\n\n      // Join class room only when identity context is provided.\n      if (options?.roomId && options.userId && options.name && options.role) {\n        socket.emit('join_class', {\n          roomId: options.roomId,\n          userId: options.userId,\n          name: options.name,\n          role: options.role,\n          tutorId: options.tutorId\n        })\n      }\n    })\n\n    socket.on('disconnect', () => {\n      console.log('Socket disconnected')\n      setIsConnected(false)\n    })\n\n    socket.on('connect_error', (err) => {\n      console.error('Socket connection error:', err)\n      setError(err.message)\n      setIsConnected(false)\n    })\n\n    // Room state (initial load)\n    socket.on('room_state', (state) => {\n      options?.onRoomState?.(state)\n    })\n\n    // Student events\n    socket.on('student_joined', (data) => {\n      options?.onStudentJoined?.(data.state)\n    })\n\n    socket.on('student_left', (data) => {\n      options?.onStudentLeft?.(data.userId)\n    })\n\n    socket.on('student_state_update', (data) => {\n      options?.onStudentStateUpdate?.(data)\n    })\n\n    socket.on('student_distress', (data) => {\n      options?.onStudentDistress?.(data)\n    })\n\n    // Chat events\n    socket.on('chat_message', (message) => {\n      options?.onChatMessage?.(message)\n    })\n\n    socket.on('tutor_broadcast', (message) => {\n      options?.onTutorBroadcast?.(message)\n    })\n\n    // AI hints\n    socket.on('ai_hint', (hint) => {\n      options?.onAIHint?.(hint)\n    })\n\n    // Whiteboard\n    socket.on('whiteboard_update', (data) => {\n      options?.onWhiteboardUpdate?.(data)\n    })\n\n    // Code editor\n    socket.on('code_update', (data) => {\n      options?.onCodeUpdate?.(data)\n    })\n\n    // Breakout\n    socket.on('breakout_invite', (data) => {\n      options?.onBreakoutInvite?.(data)\n    })\n\n    socket.on('breakout_room_update', (data) => {\n      options?.onBreakoutRoomUpdate?.(data.rooms)\n    })\n\n    socket.on('breakout_message', (data) => {\n      options?.onBreakoutMessage?.(data)\n    })\n\n    socket.on('notification', (data) => {\n      options?.onNotification?.(data)\n    })\n\n    }\n    connect()\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect()\n        socketRef.current = null\n      }\n    }\n  }, [options?.roomId, options?.userId, options?.name, options?.role, options?.tutorId])\n\n  // Send chat message\n  const sendChatMessage = useCallback((text: string) => {\n    socketRef.current?.emit('chat_message', { text })\n  }, [])\n\n  // Send whiteboard update\n  const sendWhiteboardUpdate = useCallback((strokes: any[]) => {\n    socketRef.current?.emit('whiteboard_update', { strokes })\n  }, [])\n\n  // Send code update\n  const sendCodeUpdate = useCallback((content: string, language: string) => {\n    socketRef.current?.emit('code_update', { content, language })\n  }, [])\n\n  // Send activity ping\n  const sendActivityPing = useCallback((data: {\n    activity: string\n    engagement?: number\n    understanding?: number\n  }) => {\n    socketRef.current?.emit('activity_ping', data)\n  }, [])\n\n  // Tutor broadcast\n  const sendBroadcast = useCallback((text: string, targetGroup: 'all' | 'struggling' | 'needs_help' = 'all') => {\n    socketRef.current?.emit('tutor_broadcast', { text, targetGroup })\n  }, [])\n\n  // Push hint to student\n  const pushHint = useCallback((targetUserId: string, hint: string, type: 'socratic' | 'direct' | 'encouragement') => {\n    socketRef.current?.emit('push_hint', { targetUserId, hint, type })\n  }, [])\n\n  // Invite to breakout\n  const inviteToBreakout = useCallback((targetUserId: string, roomId: string) => {\n    socketRef.current?.emit('breakout_invite', { targetUserId, roomId })\n  }, [])\n\n  // Broadcast to all breakout rooms\n  const sendBreakoutBroadcast = useCallback((message: string) => {\n    socketRef.current?.emit('breakout_broadcast', { message })\n  }, [])\n\n  // Close a breakout room\n  const closeBreakoutRoom = useCallback((breakoutRoomId: string) => {\n    socketRef.current?.emit('close_breakout', { breakoutRoomId })\n  }, [])\n\n  // Extend breakout room time\n  const extendBreakoutTime = useCallback((breakoutRoomId: string, minutes: number) => {\n    socketRef.current?.emit('extend_breakout_time', { breakoutRoomId, minutes })\n  }, [])\n\n  // Send message in breakout room\n  const sendBreakoutMessage = useCallback((breakoutRoomId: string, message: string) => {\n    socketRef.current?.emit('breakout_message', { breakoutRoomId, message })\n  }, [])\n\n  // Request help in breakout room\n  const requestHelp = useCallback((breakoutRoomId: string, reason: string) => {\n    socketRef.current?.emit('request_help', { breakoutRoomId, reason })\n  }, [])\n\n  return {\n    socket: socketRef.current,\n    isConnected,\n    error,\n    sendChatMessage,\n    sendWhiteboardUpdate,\n    sendCodeUpdate,\n    sendActivityPing,\n    sendBroadcast,\n    pushHint,\n    inviteToBreakout,\n    sendBreakoutBroadcast,\n    closeBreakoutRoom,\n    extendBreakoutTime,\n    sendBreakoutMessage,\n    requestHelp\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-simple-socket.ts"],"sourcesContent":["/**\n * Simple Socket.io Hook\n * \n * Provides a basic socket connection for room-based features.\n * Used by the Live Class Whiteboard system.\n */\n\nimport { useEffect, useRef, useState } from 'react'\nimport { io, Socket } from 'socket.io-client'\n\ninterface SimpleSocketOptions {\n  userId?: string\n  name?: string\n  role?: 'student' | 'tutor'\n}\n\nexport function useSimpleSocket(roomId: string, options: SimpleSocketOptions = {}) {\n  const socketRef = useRef<Socket | null>(null)\n  const [socketInstance, setSocketInstance] = useState<Socket | null>(null)\n  const [isConnected, setIsConnected] = useState(false)\n\n  useEffect(() => {\n    if (!roomId) return\n\n    const connect = async () => {\n      const token = await import('@/lib/socket-auth').then((m) => m.getSocketToken())\n      if (!token) return\n      const socket = io({\n        path: '/api/socket',\n        transports: ['websocket', 'polling'],\n        timeout: 20000,\n        reconnection: true,\n        reconnectionAttempts: 10,\n        reconnectionDelay: 500,\n        auth: { token },\n      })\n      socketRef.current = socket\n\n    socket.on('connect', () => {\n      setIsConnected(true)\n      setSocketInstance(socket)\n\n      if (roomId && options.userId && options.role) {\n        socket.emit('join_class', {\n          roomId,\n          userId: options.userId,\n          name: options.name || options.role,\n          role: options.role,\n        })\n      }\n    })\n\n    socket.on('disconnect', () => {\n      setIsConnected(false)\n      setSocketInstance(null)\n    })\n\n    socket.on('connect_error', (err) => {\n      console.warn('Socket connection error:', err?.message || err)\n      setIsConnected(false)\n    })\n    }\n    connect()\n    return () => {\n      socketRef.current?.disconnect()\n      socketRef.current = null\n    }\n  }, [roomId, options.name, options.role, options.userId])\n\n  return {\n    socket: socketInstance,\n    isConnected\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;CAKC,GAED;AACA;;;AAQO,SAAS,gBAAgB,MAAc,EAAE,UAA+B,CAAC,CAAC;IAC/E,MAAM,YAAY,IAAA,iQAAM,EAAgB;IACxC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,mQAAQ,EAAgB;IACpE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,mQAAQ,EAAC;IAE/C,IAAA,oQAAS,EAAC;QACR,IAAI,CAAC,QAAQ;QAEb,MAAM,UAAU;YACd,MAAM,QAAQ,MAAM,uIAA4B,IAAI,CAAC,CAAC,IAAM,EAAE,cAAc;YAC5E,IAAI,CAAC,OAAO;YACZ,MAAM,SAAS,IAAA,gPAAE,EAAC;gBAChB,MAAM;gBACN,YAAY;oBAAC;oBAAa;iBAAU;gBACpC,SAAS;gBACT,cAAc;gBACd,sBAAsB;gBACtB,mBAAmB;gBACnB,MAAM;oBAAE;gBAAM;YAChB;YACA,UAAU,OAAO,GAAG;YAEtB,OAAO,EAAE,CAAC,WAAW;gBACnB,eAAe;gBACf,kBAAkB;gBAElB,IAAI,UAAU,QAAQ,MAAM,IAAI,QAAQ,IAAI,EAAE;oBAC5C,OAAO,IAAI,CAAC,cAAc;wBACxB;wBACA,QAAQ,QAAQ,MAAM;wBACtB,MAAM,QAAQ,IAAI,IAAI,QAAQ,IAAI;wBAClC,MAAM,QAAQ,IAAI;oBACpB;gBACF;YACF;YAEA,OAAO,EAAE,CAAC,cAAc;gBACtB,eAAe;gBACf,kBAAkB;YACpB;YAEA,OAAO,EAAE,CAAC,iBAAiB,CAAC;gBAC1B,QAAQ,IAAI,CAAC,4BAA4B,KAAK,WAAW;gBACzD,eAAe;YACjB;QACA;QACA;QACA,OAAO;YACL,UAAU,OAAO,EAAE;YACnB,UAAU,OAAO,GAAG;QACtB;IACF,GAAG;QAAC;QAAQ,QAAQ,IAAI;QAAE,QAAQ,IAAI;QAAE,QAAQ,MAAM;KAAC;IAEvD,OAAO;QACL,QAAQ;QACR;IACF;AACF"}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-live-class-whiteboard.ts"],"sourcesContent":["/**\n * Live Class Whiteboard Hook\n * \n * Manages whiteboard state and socket communication for Live Class sessions.\n * Supports both tutor broadcast mode and student personal whiteboards.\n */\n\nimport { useState, useEffect, useCallback, useRef } from 'react'\nimport { useSimpleSocket } from './use-simple-socket'\nimport { useSession } from 'next-auth/react'\nimport { toast } from 'sonner'\n\nexport interface WhiteboardStroke {\n  id: string\n  points: Array<{ x: number; y: number; pressure?: number }>\n  color: string\n  width: number\n  type: 'pen' | 'eraser' | 'pencil' | 'marker' | 'highlighter' | 'calligraphy' | 'shape' | 'text'\n  userId: string\n  opacity?: number\n  shapeType?: 'line' | 'arrow' | 'rectangle' | 'circle' | 'triangle' | 'connector'\n  text?: string\n  fontSize?: number\n  fontFamily?: string\n  textStyle?: {\n    bold?: boolean\n    italic?: boolean\n    align?: 'left' | 'center' | 'right'\n  }\n  pageId?: string\n  layerId?: 'tutor-broadcast' | 'tutor-private' | 'student-personal' | 'shared-group'\n  roomScope?: 'main' | 'breakout'\n  groupId?: string\n  zIndex?: number\n  locked?: boolean\n  rotation?: number\n  createdAt?: number\n  updatedAt?: number\n  sourceStrokeId?: string\n  targetStrokeId?: string\n  sourcePort?: 'top' | 'right' | 'bottom' | 'left' | 'center'\n  targetPort?: 'top' | 'right' | 'bottom' | 'left' | 'center'\n}\n\ninterface WhiteboardStrokeOp {\n  kind: 'upsert' | 'delete'\n  stroke?: WhiteboardStroke\n  strokeId?: string\n  opId?: string\n  sentAt?: number\n  baseVersion?: number\n  _seq?: number\n}\n\nexport interface WhiteboardSelectionPresence {\n  userId: string\n  name: string\n  role: 'tutor' | 'student'\n  strokeIds: string[]\n  pageId?: string\n  color: string\n  updatedAt: number\n}\n\nexport interface StudentWhiteboard {\n  studentId: string\n  studentName: string\n  whiteboardId: string\n  visibility: 'private' | 'tutor-only' | 'public'\n  strokes: WhiteboardStroke[]\n  lastActivity: Date\n}\n\nexport interface WhiteboardCursor {\n  userId: string\n  name: string\n  role: 'tutor' | 'student'\n  x: number\n  y: number\n  pointerMode?: 'cursor' | 'laser'\n  lastUpdated: number\n}\n\nexport interface WhiteboardSubmission {\n  studentId: string\n  studentName: string\n  submittedAt: number\n  strokeCount: number\n  reviewed: boolean\n  pinned?: boolean\n}\n\nexport interface LayerConfig {\n  id: 'tutor-broadcast' | 'tutor-private' | 'student-personal' | 'shared-group'\n  label: string\n  visible: boolean\n  locked: boolean\n}\n\nexport interface WhiteboardSnapshot {\n  id: string\n  createdAt: number\n  roomId: string\n  createdBy: string\n  strokes: WhiteboardStroke[]\n}\n\nexport interface WhiteboardSpotlight {\n  enabled: boolean\n  x: number\n  y: number\n  width: number\n  height: number\n  mode: 'rectangle' | 'pen'\n}\n\nexport function useLiveClassWhiteboard(\n  roomId: string | null,\n  sessionId: string | null,\n  role: 'tutor' | 'student'\n) {\n  const applyStrokeOps = useCallback((prev: WhiteboardStroke[], ops: WhiteboardStrokeOp[]) => {\n    if (!ops.length) return prev\n    let changed = false\n    const byId = new Map(prev.map((stroke) => [stroke.id, stroke]))\n    ops.forEach((op) => {\n      if (op.kind === 'delete') {\n        if (op.strokeId && byId.has(op.strokeId)) {\n          byId.delete(op.strokeId)\n          changed = true\n        }\n        return\n      }\n      const stroke = op.stroke\n      if (!stroke) return\n      const existing = byId.get(stroke.id)\n      const incomingVersion = stroke.updatedAt || stroke.createdAt || 0\n      const currentVersion = existing?.updatedAt || existing?.createdAt || 0\n      if (!existing || (incomingVersion >= currentVersion && JSON.stringify(existing) !== JSON.stringify(stroke))) {\n        byId.set(stroke.id, stroke)\n        changed = true\n      }\n    })\n    return changed ? Array.from(byId.values()) : prev\n  }, [])\n\n  const { data: session } = useSession()\n  const { socket, isConnected } = useSimpleSocket(roomId || '', {\n    userId: session?.user?.id,\n    name: session?.user?.name || role,\n    role,\n  })\n  \n  // Whiteboard state\n  const [myStrokes, setMyStrokes] = useState<WhiteboardStroke[]>([])\n  const [tutorStrokes, setTutorStrokes] = useState<WhiteboardStroke[]>([])\n  const [studentWhiteboards, setStudentWhiteboards] = useState<Map<string, StudentWhiteboard>>(new Map())\n  const [visibility, setVisibility] = useState<'private' | 'tutor-only' | 'public'>('private')\n  const [isBroadcasting, setIsBroadcasting] = useState(false)\n  const [viewingStudentId, setViewingStudentId] = useState<string | null>(null)\n  const [activeStudentBoards, setActiveStudentBoards] = useState<string[]>([])\n  const [remoteCursors, setRemoteCursors] = useState<Map<string, WhiteboardCursor>>(new Map())\n  const [remoteSelections, setRemoteSelections] = useState<Map<string, WhiteboardSelectionPresence>>(new Map())\n  const [availableBranches, setAvailableBranches] = useState<string[]>([])\n  const [isLayerLocked, setIsLayerLocked] = useState(false)\n  const [submissions, setSubmissions] = useState<Map<string, WhiteboardSubmission>>(new Map())\n  const [hasSubmitted, setHasSubmitted] = useState(false)\n  const [layerConfig, setLayerConfig] = useState<LayerConfig[]>([\n    { id: 'tutor-broadcast', label: 'Tutor Broadcast', visible: true, locked: false },\n    { id: 'tutor-private', label: 'Tutor Private', visible: true, locked: false },\n    { id: 'student-personal', label: 'Student Personal', visible: true, locked: false },\n    { id: 'shared-group', label: 'Shared Group', visible: true, locked: false },\n  ])\n  const [activeLayerId, setActiveLayerId] = useState<LayerConfig['id']>(role === 'tutor' ? 'tutor-broadcast' : 'student-personal')\n  const [assignmentOverlay, setAssignmentOverlay] = useState<'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure'>('none')\n  const [spotlight, setSpotlight] = useState<WhiteboardSpotlight>({\n    enabled: false,\n    x: 160,\n    y: 120,\n    width: 420,\n    height: 220,\n    mode: 'rectangle',\n  })\n  const [snapshots, setSnapshots] = useState<WhiteboardSnapshot[]>([])\n  const [timelineIndex, setTimelineIndex] = useState<number | null>(null)\n  const [aiRegionHints, setAiRegionHints] = useState<Array<{\n    requestedBy: string\n    region: { x: number; y: number; width: number; height: number }\n    hint: string\n    misconception: string\n    timestamp: number\n  }>>([])\n  const [moderationState, setModerationState] = useState<{\n    mutedStudentIds: string[]\n    studentStrokeWindowLimit: number\n    strokeWindowMs: number\n    lockedLayers: string[]\n  }>({\n    mutedStudentIds: [],\n    studentStrokeWindowLimit: 80,\n    strokeWindowMs: 5000,\n    lockedLayers: [],\n  })\n  \n  const strokesRef = useRef<WhiteboardStroke[]>([])\n  const pendingOpsRef = useRef<WhiteboardStrokeOp[]>([])\n  const flushTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\n  const localOpSeqRef = useRef(0)\n  const boardSeqRef = useRef<{ student: number; tutor: number }>({ student: 0, tutor: 0 })\n  \n  // Keep ref in sync\n  useEffect(() => {\n    strokesRef.current = myStrokes\n  }, [myStrokes])\n\n  const flushStrokeOps = useCallback(() => {\n    if (!socket || !roomId || !session?.user?.id) return\n    if (!pendingOpsRef.current.length) return\n    const merged = new Map<string, WhiteboardStrokeOp>()\n    pendingOpsRef.current.forEach((op) => {\n      if (op.kind === 'delete' && op.strokeId) {\n        merged.set(op.strokeId, op)\n      } else if (op.kind === 'upsert' && op.stroke) {\n        merged.set(op.stroke.id, op)\n      }\n    })\n    pendingOpsRef.current = []\n    const ops = Array.from(merged.values())\n    if (!ops.length) return\n    if (role === 'student') {\n      socket.emit('lcwb_student_stroke_ops', {\n        roomId,\n        userId: session.user.id,\n        ops,\n        visibility,\n      })\n    } else if (role === 'tutor') {\n      socket.emit('lcwb_tutor_stroke_ops', {\n        roomId,\n        ops,\n      })\n    }\n  }, [role, roomId, session, socket, visibility])\n\n  const enqueueStrokeOps = useCallback((ops: WhiteboardStrokeOp[]) => {\n    if (!ops.length) return\n    pendingOpsRef.current.push(...ops)\n    if (pendingOpsRef.current.length >= 120) {\n      flushStrokeOps()\n      return\n    }\n    if (flushTimerRef.current) return\n    flushTimerRef.current = setTimeout(() => {\n      flushTimerRef.current = null\n      flushStrokeOps()\n    }, 28)\n  }, [flushStrokeOps])\n\n  useEffect(() => {\n    return () => {\n      if (flushTimerRef.current) {\n        clearTimeout(flushTimerRef.current)\n        flushTimerRef.current = null\n      }\n      flushStrokeOps()\n    }\n  }, [flushStrokeOps])\n  \n  // Initialize whiteboard on mount\n  useEffect(() => {\n    if (!sessionId || !socket || !isConnected) return\n    \n    const userId = session?.user?.id\n    if (!userId) return\n    \n    if (role === 'student') {\n      // Join student's personal whiteboard\n      socket.emit('lcwb_student_join', {\n        roomId,\n        userId,\n        name: session?.user?.name || 'Student'\n      })\n    }\n    \n    // Request initial sync\n    socket.emit('lcwb_sync_request', { roomId, userId })\n    socket.emit('lcwb_replay_request', {\n      roomId,\n      userId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      sinceSeq: role === 'tutor' ? boardSeqRef.current.tutor : boardSeqRef.current.student,\n    })\n    if (role === 'student') {\n      socket.emit('lcwb_replay_request', {\n        roomId,\n        userId,\n        scope: 'tutor',\n        sinceSeq: boardSeqRef.current.tutor,\n      })\n    }\n  }, [sessionId, roomId, socket, isConnected, role, session])\n  \n  // Set up socket listeners\n  useEffect(() => {\n    if (!socket) return\n    \n    // Tutor broadcasting started\n    socket.on('lcwb_tutor_broadcasting', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor stopped broadcasting\n    socket.on('lcwb_tutor_broadcast_stopped', () => {\n      setTutorStrokes([])\n    })\n    \n    // Receive tutor's stroke (for students)\n    socket.on('lcwb_tutor_stroke', (stroke: WhiteboardStroke) => {\n      setTutorStrokes(prev => [...prev, stroke])\n    })\n    socket.on('lcwb_tutor_strokes_reset', (data: { strokes: WhiteboardStroke[] }) => {\n      setTutorStrokes(data.strokes || [])\n    })\n    socket.on('lcwb_tutor_stroke_ops', (data: { ops: WhiteboardStrokeOp[] }) => {\n      const maxSeq = Math.max(0, ...((data.ops || []).map((op) => op._seq || 0)))\n      if (maxSeq > 0) boardSeqRef.current.tutor = Math.max(boardSeqRef.current.tutor, maxSeq)\n      setTutorStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n    })\n\n    socket.on('lcwb_student_whiteboard_state', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        } else {\n          next.set(data.studentId, {\n            studentId: data.studentId,\n            studentName: 'Student',\n            whiteboardId: '',\n            visibility: 'tutor-only',\n            strokes: data.strokes,\n            lastActivity: new Date(),\n          })\n        }\n        return next\n      })\n    })\n    \n    // Student created a whiteboard (tutor receives)\n    socket.on('lcwb_student_whiteboard_created', (data: { studentId: string; name: string }) => {\n      setActiveStudentBoards(prev => [...new Set([...prev, data.studentId])])\n      setStudentWhiteboards(prev => new Map(prev.set(data.studentId, {\n        studentId: data.studentId,\n        studentName: data.name,\n        whiteboardId: '',\n        visibility: 'private',\n        strokes: [],\n        lastActivity: new Date()\n      })))\n    })\n    \n    // Receive student's stroke (tutor receives)\n    socket.on('lcwb_student_stroke', (data: { studentId: string; stroke: WhiteboardStroke }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.strokes.push(data.stroke)\n          wb.lastActivity = new Date()\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    socket.on('lcwb_student_strokes_reset', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes || []\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    socket.on('lcwb_student_stroke_ops', (data: { studentId: string; ops: WhiteboardStrokeOp[] }) => {\n      const maxSeq = Math.max(0, ...((data.ops || []).map((op) => op._seq || 0)))\n      if (maxSeq > 0 && session?.user?.id === data.studentId) {\n        boardSeqRef.current.student = Math.max(boardSeqRef.current.student, maxSeq)\n      }\n      setStudentWhiteboards((prev) => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = applyStrokeOps(wb.strokes, data.ops || [])\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    \n    // Student visibility changed\n    socket.on('lcwb_student_visibility_changed', (data: { studentId: string; visibility: 'private' | 'tutor-only' | 'public' }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.visibility = data.visibility\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    \n    // Student made board public (other students receive)\n    socket.on('lcwb_student_public', (data: { studentId: string; name: string }) => {\n      setActiveStudentBoards(prev => [...new Set([...prev, data.studentId])])\n    })\n    \n    // Receive public student stroke (students receive from other students)\n    socket.on('lcwb_public_student_stroke', (data: { studentId: string; stroke: WhiteboardStroke }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.strokes.push(data.stroke)\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    socket.on('lcwb_public_student_strokes_reset', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes || []\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    socket.on('lcwb_public_student_stroke_ops', (data: { studentId: string; ops: WhiteboardStrokeOp[] }) => {\n      setStudentWhiteboards((prev) => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = applyStrokeOps(wb.strokes, data.ops || [])\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n\n    socket.on('lcwb_replay_ops', (data: {\n      scope: 'student' | 'tutor'\n      userId?: string\n      latestSeq?: number\n      ops: WhiteboardStrokeOp[]\n    }) => {\n      if (data.scope === 'tutor') {\n        boardSeqRef.current.tutor = Math.max(boardSeqRef.current.tutor, data.latestSeq || 0)\n        setTutorStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n        return\n      }\n      const myId = session?.user?.id\n      if (!myId || (data.userId && data.userId !== myId)) return\n      boardSeqRef.current.student = Math.max(boardSeqRef.current.student, data.latestSeq || 0)\n      setMyStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n    })\n\n    socket.on('lcwb_selection_presence_update', (data: WhiteboardSelectionPresence) => {\n      if (!data?.userId || data.userId === session?.user?.id) return\n      setRemoteSelections((prev) => {\n        const next = new Map(prev)\n        next.set(data.userId, data)\n        return next\n      })\n    })\n\n    socket.on('lcwb_selection_presence_remove', (data: { userId: string }) => {\n      if (!data?.userId) return\n      setRemoteSelections((prev) => {\n        if (!prev.has(data.userId)) return prev\n        const next = new Map(prev)\n        next.delete(data.userId)\n        return next\n      })\n    })\n\n    socket.on('lcwb_branch_list', (data: { branches: string[] }) => {\n      setAvailableBranches(data.branches || [])\n    })\n    \n    // Tutor is viewing this student's board\n    socket.on('lcwb_tutor_viewing', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor stopped viewing\n    socket.on('lcwb_tutor_stopped_viewing', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor annotated on student's board\n    socket.on('lcwb_tutor_annotation', (data: { stroke: WhiteboardStroke; tutorId: string }) => {\n      setMyStrokes(prev => [...prev, data.stroke])\n    })\n    \n    // Sync response\n    socket.on('lcwb_sync_response', (data: { strokes: WhiteboardStroke[] }) => {\n      setMyStrokes(data.strokes)\n    })\n\n    socket.on('lcwb_cursor_update', (data: WhiteboardCursor) => {\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        next.set(data.userId, data)\n        return next\n      })\n    })\n\n    socket.on('lcwb_cursor_remove', (data: { userId: string }) => {\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        next.delete(data.userId)\n        return next\n      })\n    })\n\n    socket.on('lcwb_layer_locked', (data: { locked: boolean }) => {\n      setIsLayerLocked(data.locked)\n    })\n\n    socket.on('lcwb_layer_config', (data: { visibility: Record<string, boolean>; lockedLayers: string[] }) => {\n      setLayerConfig((prev) => prev.map((layer) => ({\n        ...layer,\n        visible: data.visibility[layer.id] ?? layer.visible,\n        locked: data.lockedLayers.includes(layer.id),\n      })))\n    })\n\n    socket.on('lcwb_student_submitted', (data: {\n      studentId: string\n      studentName: string\n      submittedAt: number\n      strokeCount: number\n    }) => {\n      if (role === 'tutor') {\n        toast.success(`${data.studentName} submitted their board`)\n      }\n      setSubmissions((prev) => {\n        const next = new Map(prev)\n        next.set(data.studentId, {\n          studentId: data.studentId,\n          studentName: data.studentName,\n          submittedAt: data.submittedAt,\n          strokeCount: data.strokeCount,\n          reviewed: false,\n        })\n        return next\n      })\n    })\n\n    socket.on('lcwb_submission_reviewed', (data: { studentId: string }) => {\n      if (role === 'student' && session?.user?.id === data.studentId) {\n        setHasSubmitted(false)\n        toast.success('Your board was reviewed by the tutor')\n      }\n      if (role === 'tutor') {\n        setSubmissions((prev) => {\n          const next = new Map(prev)\n          const existing = next.get(data.studentId)\n          if (existing) {\n            next.set(data.studentId, { ...existing, reviewed: true })\n          }\n          return next\n        })\n      }\n    })\n\n    socket.on('lcwb_moderation_state', (data: {\n      mutedStudentIds: string[]\n      studentStrokeWindowLimit: number\n      strokeWindowMs: number\n      lockedLayers: string[]\n    }) => {\n      setModerationState(data)\n    })\n\n    socket.on('lcwb_moderation_warning', (data: { code: string; message: string }) => {\n      toast.warning(data.message || 'Board action blocked by moderation settings')\n    })\n\n    socket.on('lcwb_assignment_overlay', (data: { overlay: 'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure' }) => {\n      setAssignmentOverlay(data.overlay)\n    })\n\n    socket.on('lcwb_spotlight_update', (data: WhiteboardSpotlight) => {\n      setSpotlight(data)\n    })\n\n    socket.on('lcwb_ai_region_hint', (data: {\n      requestedBy: string\n      region: { x: number; y: number; width: number; height: number }\n      hint: string\n      misconception: string\n      timestamp: number\n    }) => {\n      setAiRegionHints((prev) => [data, ...prev].slice(0, 20))\n    })\n\n    socket.on('lcwb_snapshot_created', (snapshot: WhiteboardSnapshot) => {\n      setSnapshots((prev) => [snapshot, ...prev].slice(0, 80))\n    })\n\n    socket.on('lcwb_snapshot_timeline', (data: { snapshots: WhiteboardSnapshot[] }) => {\n      setSnapshots(data.snapshots)\n    })\n\n    socket.on('lcwb_breakout_promoted', (data: { strokes: WhiteboardStroke[] }) => {\n      if (role === 'tutor') {\n        setTutorStrokes((prev) => [...prev, ...data.strokes])\n      }\n    })\n\n    // AI region hint error\n    socket.on('lcwb_ai_region_error', (data: { message?: string }) => {\n      toast.error(data.message || 'Failed to get AI hint')\n    })\n\n    // Export attached by tutor\n    socket.on('lcwb_export_attached', (data: { exportId: string; name: string; url: string; attachedBy: string }) => {\n      toast.success(`Export \"${data.name}\" attached by tutor`)\n    })\n\n    // Student cleared their own board\n    socket.on('lcwb_student_cleared_own', (data: { studentId: string }) => {\n      if (role === 'tutor') {\n        setStudentWhiteboards(prev => {\n          const next = new Map(prev)\n          const wb = next.get(data.studentId)\n          if (wb) {\n            wb.strokes = []\n            next.set(data.studentId, wb)\n          }\n          return next\n        })\n      }\n      if (role === 'student' && session?.user?.id === data.studentId) {\n        setMyStrokes([])\n        toast.info('Your board was cleared')\n      }\n    })\n    \n    // Cleanup\n    return () => {\n      socket.off('lcwb_tutor_broadcasting')\n      socket.off('lcwb_tutor_broadcast_stopped')\n      socket.off('lcwb_tutor_stroke')\n      socket.off('lcwb_tutor_strokes_reset')\n      socket.off('lcwb_tutor_stroke_ops')\n      socket.off('lcwb_student_whiteboard_created')\n      socket.off('lcwb_student_stroke')\n      socket.off('lcwb_student_strokes_reset')\n      socket.off('lcwb_student_stroke_ops')\n      socket.off('lcwb_student_visibility_changed')\n      socket.off('lcwb_student_public')\n      socket.off('lcwb_public_student_stroke')\n      socket.off('lcwb_public_student_strokes_reset')\n      socket.off('lcwb_public_student_stroke_ops')\n      socket.off('lcwb_replay_ops')\n      socket.off('lcwb_selection_presence_update')\n      socket.off('lcwb_selection_presence_remove')\n      socket.off('lcwb_branch_list')\n      socket.off('lcwb_tutor_viewing')\n      socket.off('lcwb_tutor_stopped_viewing')\n      socket.off('lcwb_tutor_annotation')\n      socket.off('lcwb_sync_response')\n      socket.off('lcwb_student_whiteboard_state')\n      socket.off('lcwb_cursor_update')\n      socket.off('lcwb_cursor_remove')\n      socket.off('lcwb_layer_locked')\n      socket.off('lcwb_layer_config')\n      socket.off('lcwb_student_submitted')\n      socket.off('lcwb_submission_reviewed')\n      socket.off('lcwb_moderation_state')\n      socket.off('lcwb_moderation_warning')\n      socket.off('lcwb_assignment_overlay')\n      socket.off('lcwb_spotlight_update')\n      socket.off('lcwb_ai_region_hint')\n      socket.off('lcwb_snapshot_created')\n      socket.off('lcwb_snapshot_timeline')\n      socket.off('lcwb_breakout_promoted')\n      socket.off('lcwb_ai_region_error')\n      socket.off('lcwb_export_attached')\n      socket.off('lcwb_student_cleared_own')\n    }\n  }, [applyStrokeOps, role, session?.user?.id, socket])\n\n  // Remove stale cursors (network drops / tab backgrounding).\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const cutoff = Date.now() - 5000\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        let changed = false\n        next.forEach((cursor, userId) => {\n          if (cursor.lastUpdated < cutoff) {\n            next.delete(userId)\n            changed = true\n          }\n        })\n        return changed ? next : prev\n      })\n    }, 2000)\n\n    return () => clearInterval(interval)\n  }, [])\n  \n  /** Tutor: Start broadcasting — your strokes are sent to all students in the room in real time. */\n  const startBroadcast = useCallback(() => {\n    if (role !== 'tutor') return\n    if (!socket || !isConnected) {\n      toast.warning('Connect to the class first')\n      return\n    }\n    if (!sessionId || !roomId) {\n      toast.warning('Session or room not ready')\n      return\n    }\n    socket.emit('lcwb_broadcast_start', {\n      roomId,\n      whiteboardId: session?.user?.id\n    })\n    setIsBroadcasting(true)\n  }, [socket, isConnected, role, roomId, sessionId, session])\n  \n  /** Tutor: Stop broadcasting — students no longer receive your strokes. */\n  const stopBroadcast = useCallback(() => {\n    if (!socket || role !== 'tutor') return\n    socket.emit('lcwb_broadcast_stop', { roomId })\n    setIsBroadcasting(false)\n  }, [socket, role, roomId])\n  \n  // Tutor: Broadcast a stroke\n  const broadcastStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    \n    socket.emit('lcwb_stroke_broadcast', { roomId, stroke })\n  }, [socket, role, roomId])\n  \n  // Student: Add a stroke to their whiteboard\n  const addStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || !session?.user?.id) return\n    if (role === 'student' && isLayerLocked) return\n    if (role === 'student' && moderationState.lockedLayers.includes(activeLayerId)) {\n      toast.warning('This layer is locked by the tutor')\n      return\n    }\n    \n    // Update local state\n    setMyStrokes(prev => [...prev, stroke])\n    \n    // Send to server\n    socket.emit('lcwb_student_update', {\n      roomId,\n      userId: session.user.id,\n      stroke: { ...stroke, layerId: stroke.layerId || activeLayerId },\n      visibility\n    })\n    if (role === 'student' && hasSubmitted) {\n      setHasSubmitted(false)\n    }\n  }, [socket, session, role, isLayerLocked, roomId, visibility, hasSubmitted, activeLayerId, moderationState.lockedLayers])\n\n  const addTutorStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    const normalizedStroke = { ...stroke, layerId: stroke.layerId || activeLayerId }\n    setMyStrokes(prev => [...prev, normalizedStroke])\n    if (isBroadcasting || normalizedStroke.layerId === 'tutor-broadcast') {\n      socket.emit('lcwb_stroke_broadcast', { roomId, stroke: normalizedStroke })\n    }\n  }, [socket, role, activeLayerId, isBroadcasting, roomId])\n  \n  // Student: Change visibility\n  const changeVisibility = useCallback((newVisibility: 'private' | 'tutor-only' | 'public') => {\n    if (!socket || role !== 'student' || !session?.user?.id) return\n    \n    setVisibility(newVisibility)\n    socket.emit('lcwb_visibility_change', {\n      roomId,\n      userId: session.user.id,\n      visibility: newVisibility\n    })\n  }, [socket, role, roomId, session])\n  \n  // Tutor: View a specific student's whiteboard\n  const viewStudentWhiteboard = useCallback((studentId: string) => {\n    if (!socket || role !== 'tutor') return\n    \n    // Stop viewing previous student\n    if (viewingStudentId) {\n      socket.emit('lcwb_tutor_stop_view', { roomId, studentId: viewingStudentId })\n    }\n    \n    socket.emit('lcwb_tutor_view_student', { roomId, studentId })\n    setViewingStudentId(studentId)\n  }, [socket, role, roomId, viewingStudentId])\n  \n  // Tutor: Stop viewing student\n  const stopViewingStudent = useCallback(() => {\n    if (!socket || role !== 'tutor' || !viewingStudentId) return\n    \n    socket.emit('lcwb_tutor_stop_view', { roomId, studentId: viewingStudentId })\n    setViewingStudentId(null)\n  }, [socket, role, roomId, viewingStudentId])\n  \n  // Tutor: Annotate on student's whiteboard\n  const annotateOnStudentBoard = useCallback((studentId: string, stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    \n    socket.emit('lcwb_tutor_annotate', { roomId, studentId, stroke })\n  }, [socket, role, roomId])\n  \n  // Clear my whiteboard\n  const clearMyWhiteboard = useCallback((pageId?: string) => {\n    if (!pageId) {\n      setMyStrokes([])\n      return\n    }\n    setMyStrokes((prev) => prev.filter((stroke) => stroke.pageId !== pageId))\n  }, [])\n  \n  // Undo last stroke\n  const undoLastStroke = useCallback((pageId?: string) => {\n    setMyStrokes((prev) => {\n      if (!pageId) return prev.slice(0, -1)\n      const lastIndex = [...prev].reverse().findIndex((stroke) => stroke.pageId === pageId)\n      if (lastIndex < 0) return prev\n      const indexToRemove = prev.length - 1 - lastIndex\n      return prev.filter((_, index) => index !== indexToRemove)\n    })\n  }, [])\n\n  const updateCursor = useCallback((x: number, y: number, pointerMode: 'cursor' | 'laser' = 'cursor') => {\n    if (!socket || !session?.user?.id || !roomId) return\n    socket.emit('lcwb_cursor_update', {\n      roomId,\n      userId: session.user.id,\n      name: session.user.name || role,\n      role,\n      x,\n      y,\n      pointerMode,\n      lastUpdated: Date.now(),\n    })\n  }, [socket, session, roomId, role])\n\n  const updateSelectionPresence = useCallback((strokeIds: string[], pageId?: string, color: string = '#2563eb') => {\n    if (!socket || !roomId || !session?.user?.id) return\n    socket.emit('lcwb_selection_presence_update', {\n      roomId,\n      userId: session.user.id,\n      name: session.user.name || role,\n      role,\n      strokeIds,\n      pageId,\n      color,\n      updatedAt: Date.now(),\n    })\n  }, [roomId, role, session, socket])\n\n  const createBoardBranch = useCallback((branchName: string) => {\n    if (!socket || !roomId || !session?.user?.id || !branchName.trim()) return\n    socket.emit('lcwb_branch_create', {\n      roomId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      userId: session.user.id,\n      branchName: branchName.trim(),\n    })\n  }, [roomId, role, session, socket])\n\n  const switchBoardBranch = useCallback((branchName: string) => {\n    if (!socket || !roomId || !session?.user?.id || !branchName.trim()) return\n    socket.emit('lcwb_branch_switch', {\n      roomId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      userId: session.user.id,\n      branchName: branchName.trim(),\n    })\n  }, [roomId, role, session, socket])\n\n  /** Tutor: Lock/unlock student layers — when locked, students cannot draw on their boards until you unlock. */\n  const toggleLayerLock = useCallback((locked: boolean) => {\n    if (role !== 'tutor') return\n    if (!socket || !isConnected) {\n      toast.warning('Connect to the class first')\n      return\n    }\n    if (!roomId) {\n      toast.warning('Room not ready')\n      return\n    }\n    setIsLayerLocked(locked)\n    socket.emit('lcwb_layer_lock', {\n      roomId,\n      locked,\n    })\n  }, [socket, isConnected, role, roomId])\n\n  const updateLayerConfig = useCallback((nextConfig: LayerConfig[]) => {\n    setLayerConfig(nextConfig)\n    if (!socket || !roomId || role !== 'tutor') return\n    const visibility = nextConfig.reduce<Record<string, boolean>>((acc, layer) => {\n      acc[layer.id] = layer.visible\n      return acc\n    }, {})\n    socket.emit('lcwb_layer_config_update', {\n      roomId,\n      visibility,\n      lockedLayers: nextConfig.filter((layer) => layer.locked).map((layer) => layer.id),\n    })\n  }, [socket, roomId, role])\n\n  const setLayerLock = useCallback((layerId: LayerConfig['id'], locked: boolean) => {\n    setLayerConfig((prev) => {\n      const next = prev.map((layer) => layer.id === layerId ? { ...layer, locked } : layer)\n      if (socket && roomId && role === 'tutor') {\n        const visibility = next.reduce<Record<string, boolean>>((acc, layer) => {\n          acc[layer.id] = layer.visible\n          return acc\n        }, {})\n        socket.emit('lcwb_layer_config_update', {\n          roomId,\n          visibility,\n          lockedLayers: next.filter((layer) => layer.locked).map((layer) => layer.id),\n        })\n      }\n      return next\n    })\n  }, [socket, roomId, role])\n\n  const submitMyBoard = useCallback(() => {\n    if (!socket || role !== 'student' || !session?.user?.id || !roomId) return\n    socket.emit('lcwb_student_submit', {\n      roomId,\n      studentId: session.user.id,\n      studentName: session.user.name || 'Student',\n      strokeCount: strokesRef.current.length,\n      submittedAt: Date.now(),\n    })\n    setHasSubmitted(true)\n    toast.success('Board submitted to tutor')\n  }, [socket, role, session, roomId])\n\n  const markSubmissionReviewed = useCallback((studentId: string) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_tutor_mark_reviewed', {\n      roomId,\n      studentId,\n    })\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      const existing = next.get(studentId)\n      if (existing) next.set(studentId, { ...existing, reviewed: true })\n      return next\n    })\n  }, [socket, role, roomId])\n\n  const pinSubmission = useCallback((studentId: string, pinned: boolean) => {\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      const existing = next.get(studentId)\n      if (existing) next.set(studentId, { ...existing, pinned })\n      return next\n    })\n  }, [])\n\n  const markAllSubmissionsReviewed = useCallback(() => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    const pending = Array.from(submissions.values()).filter((submission) => !submission.reviewed)\n    pending.forEach((submission) => {\n      socket.emit('lcwb_tutor_mark_reviewed', {\n        roomId,\n        studentId: submission.studentId,\n      })\n    })\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      next.forEach((submission, studentId) => {\n        next.set(studentId, { ...submission, reviewed: true })\n      })\n      return next\n    })\n  }, [socket, role, roomId, submissions])\n\n  const setDrawMuteForStudent = useCallback((studentId: string, muted: boolean) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    const nextMuted = new Set(moderationState.mutedStudentIds)\n    if (muted) nextMuted.add(studentId)\n    if (!muted) nextMuted.delete(studentId)\n    socket.emit('lcwb_tutor_moderation_update', {\n      roomId,\n      mutedStudentIds: Array.from(nextMuted),\n      studentStrokeWindowLimit: moderationState.studentStrokeWindowLimit,\n      strokeWindowMs: moderationState.strokeWindowMs,\n      lockedLayers: moderationState.lockedLayers,\n    })\n  }, [socket, role, roomId, moderationState])\n\n  const updateStrokeRateLimit = useCallback((limit: number, windowMs: number = moderationState.strokeWindowMs) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_tutor_moderation_update', {\n      roomId,\n      mutedStudentIds: moderationState.mutedStudentIds,\n      studentStrokeWindowLimit: limit,\n      strokeWindowMs: windowMs,\n      lockedLayers: moderationState.lockedLayers,\n    })\n  }, [socket, role, roomId, moderationState])\n\n  const clearOwnStrokes = useCallback(() => {\n    if (!socket || !roomId || !session?.user?.id) return\n    setMyStrokes((prev) => prev.filter((stroke) => stroke.userId !== session.user.id))\n    socket.emit('lcwb_clear_own', { roomId, userId: session.user.id })\n  }, [socket, roomId, session])\n\n  const replaceMyStrokes = useCallback((nextOrUpdater: WhiteboardStroke[] | ((prev: WhiteboardStroke[]) => WhiteboardStroke[])) => {\n    setMyStrokes((prev) => {\n      const next = typeof nextOrUpdater === 'function'\n        ? (nextOrUpdater as (prev: WhiteboardStroke[]) => WhiteboardStroke[])(prev)\n        : nextOrUpdater\n\n      if (socket && roomId && session?.user?.id) {\n        const prevMap = new Map(prev.map((stroke) => [stroke.id, stroke]))\n        const nextMap = new Map(next.map((stroke) => [stroke.id, stroke]))\n        const ops: WhiteboardStrokeOp[] = []\n        nextMap.forEach((stroke, id) => {\n          const existing = prevMap.get(id)\n          if (!existing || JSON.stringify(existing) !== JSON.stringify(stroke)) {\n            localOpSeqRef.current += 1\n            ops.push({\n              kind: 'upsert',\n              stroke,\n              opId: `${session.user.id}:${Date.now()}:${localOpSeqRef.current}:${id}:u`,\n              sentAt: Date.now(),\n              baseVersion: existing?.updatedAt || existing?.createdAt || 0,\n            })\n          }\n        })\n        prevMap.forEach((_, id) => {\n          if (!nextMap.has(id)) {\n            localOpSeqRef.current += 1\n            ops.push({\n              kind: 'delete',\n              strokeId: id,\n              opId: `${session.user.id}:${Date.now()}:${localOpSeqRef.current}:${id}:d`,\n              sentAt: Date.now(),\n            })\n          }\n        })\n\n        if (!ops.length) return prev\n\n        enqueueStrokeOps(ops)\n      }\n      return next\n    })\n  }, [enqueueStrokeOps, roomId, session, socket])\n\n  const setAssignmentOverlayMode = useCallback((overlay: 'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure') => {\n    setAssignmentOverlay(overlay)\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_assignment_overlay', { roomId, overlay })\n  }, [socket, role, roomId])\n\n  const updateSpotlight = useCallback((nextSpotlight: WhiteboardSpotlight) => {\n    setSpotlight(nextSpotlight)\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_spotlight_update', { roomId, ...nextSpotlight })\n  }, [socket, role, roomId])\n\n  const requestAIRegionHint = useCallback((region: { x: number; y: number; width: number; height: number }, context?: string) => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_ai_region_request', { roomId, region, context })\n  }, [socket, roomId])\n\n  const captureSnapshot = useCallback((strokes: WhiteboardStroke[]) => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_snapshot_capture', { roomId, strokes })\n  }, [socket, roomId])\n\n  const requestSnapshotTimeline = useCallback(() => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_snapshot_request', { roomId })\n  }, [socket, roomId])\n\n  const promoteBreakoutBoard = useCallback((breakoutRoomId: string, strokes: WhiteboardStroke[], sourceStudentId?: string) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_breakout_promote', {\n      mainRoomId: roomId,\n      breakoutRoomId,\n      sourceStudentId,\n      strokes,\n    })\n  }, [socket, role, roomId])\n\n  const exportAndAttachBoard = useCallback((data: {\n    format: 'png' | 'pdf'\n    fileName: string\n    dataUrl: string\n    studentId?: string\n  }) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_export_attach', {\n      roomId,\n      sessionId,\n      studentId: data.studentId,\n      format: data.format,\n      fileName: data.fileName,\n      dataUrl: data.dataUrl,\n    })\n  }, [socket, role, roomId, sessionId])\n\n  useEffect(() => {\n    if (!roomId || !socket) return\n    const interval = setInterval(() => {\n      const sourceStrokes = role === 'tutor' ? myStrokes : myStrokes\n      if (sourceStrokes.length > 0) {\n        socket.emit('lcwb_snapshot_capture', { roomId, strokes: sourceStrokes })\n      }\n    }, 2 * 60 * 1000)\n    return () => clearInterval(interval)\n  }, [roomId, socket, role, myStrokes])\n  \n  return {\n    // State\n    myStrokes,\n    tutorStrokes,\n    studentWhiteboards,\n    visibility,\n    isBroadcasting,\n    viewingStudentId,\n    activeStudentBoards,\n    isConnected,\n    remoteCursors,\n    remoteSelections: Array.from(remoteSelections.values()),\n    isLayerLocked,\n    submissions: Array.from(submissions.values()).sort((a, b) => b.submittedAt - a.submittedAt),\n    hasSubmitted,\n    layerConfig,\n    activeLayerId,\n    assignmentOverlay,\n    spotlight,\n    snapshots: [...snapshots].sort((a, b) => b.createdAt - a.createdAt),\n    timelineIndex,\n    aiRegionHints,\n    moderationState,\n    availableBranches,\n    \n    // Actions\n    startBroadcast,\n    stopBroadcast,\n    broadcastStroke,\n    addStroke,\n    addTutorStroke,\n    changeVisibility,\n    viewStudentWhiteboard,\n    stopViewingStudent,\n    annotateOnStudentBoard,\n    clearMyWhiteboard,\n    undoLastStroke,\n    updateCursor,\n    updateSelectionPresence,\n    toggleLayerLock,\n    submitMyBoard,\n    markSubmissionReviewed,\n    markAllSubmissionsReviewed,\n    pinSubmission,\n    setLayerConfig: updateLayerConfig,\n    setActiveLayerId,\n    setLayerLock,\n    setDrawMuteForStudent,\n    updateStrokeRateLimit,\n    clearOwnStrokes,\n    replaceMyStrokes,\n    setAssignmentOverlayMode,\n    updateSpotlight,\n    requestAIRegionHint,\n    captureSnapshot,\n    requestSnapshotTimeline,\n    setTimelineIndex,\n    promoteBreakoutBoard,\n    exportAndAttachBoard,\n    createBoardBranch,\n    switchBoardBranch\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1573, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-pdf-collab-socket.ts"],"sourcesContent":["'use client'\n\nimport { useCallback, useEffect, useMemo, useState } from 'react'\nimport { useSimpleSocket } from './use-simple-socket'\nimport type { PdfCanvasEventPayload } from '@/lib/pdf-tutoring/types'\n\nexport interface PdfParticipant {\n  userId?: string\n  name: string\n  role: 'student' | 'tutor'\n  joinedAt: number\n}\n\ninterface UsePdfCollabSocketArgs {\n  roomId: string\n  userId?: string\n  name?: string\n  role?: 'student' | 'tutor'\n  onCanvasEvent?: (payload: PdfCanvasEventPayload) => void\n  onCanvasState?: (payload: { roomId: string; events: PdfCanvasEventPayload[] }) => void\n  onPresenceState?: (payload: { roomId: string; participants: PdfParticipant[] }) => void\n}\n\nexport function usePdfCollabSocket({ roomId, userId, name, role = 'tutor', onCanvasEvent, onCanvasState, onPresenceState }: UsePdfCollabSocketArgs) {\n  const { socket, isConnected } = useSimpleSocket(roomId, {\n    userId,\n    name,\n    role,\n  })\n  const [isLocked, setIsLocked] = useState(false)\n  const [latencyMs, setLatencyMs] = useState<number | null>(null)\n  const [participants, setParticipants] = useState<PdfParticipant[]>([])\n\n  useEffect(() => {\n    if (!socket || !roomId) return\n\n    socket.emit('pdf_join_room', {\n      roomId,\n      userId,\n      name,\n      role,\n    })\n\n    const handleCanvasEvent = (payload: PdfCanvasEventPayload) => {\n      if (typeof payload.sentAt === 'number') {\n        setLatencyMs(Math.max(0, Date.now() - payload.sentAt))\n      }\n      onCanvasEvent?.(payload)\n    }\n\n    const handleLockState = (data: { roomId: string; locked: boolean }) => {\n      if (data.roomId === roomId) setIsLocked(data.locked)\n    }\n\n    const handleCanvasState = (data: { roomId: string; events: PdfCanvasEventPayload[] }) => {\n      if (data.roomId !== roomId) return\n      onCanvasState?.(data)\n    }\n\n    const handlePresenceState = (data: { roomId: string; participants: PdfParticipant[] }) => {\n      if (data.roomId !== roomId) return\n      setParticipants(data.participants || [])\n      onPresenceState?.(data)\n    }\n\n    socket.on('pdf_canvas_event', handleCanvasEvent)\n    socket.on('pdf_lock_state', handleLockState)\n    socket.on('pdf_canvas_state', handleCanvasState)\n    socket.on('pdf_presence_state', handlePresenceState)\n\n    socket.emit('pdf_request_state', { roomId })\n\n    return () => {\n      socket.off('pdf_canvas_event', handleCanvasEvent)\n      socket.off('pdf_lock_state', handleLockState)\n      socket.off('pdf_canvas_state', handleCanvasState)\n      socket.off('pdf_presence_state', handlePresenceState)\n    }\n  }, [socket, roomId, userId, name, role, onCanvasEvent, onCanvasState, onPresenceState])\n\n  const emitCanvasEvent = useCallback(\n    (payload: Omit<PdfCanvasEventPayload, 'roomId' | 'sentAt' | 'actorId'>) => {\n      if (!socket || !roomId) return\n      socket.emit('pdf_canvas_event', {\n        roomId,\n        actorId: userId,\n        sentAt: Date.now(),\n        ...payload,\n      } satisfies PdfCanvasEventPayload)\n    },\n    [socket, roomId, userId]\n  )\n\n  const setLock = useCallback(\n    (locked: boolean) => {\n      if (!socket || !roomId) return\n      socket.emit('pdf_lock_toggle', { roomId, locked })\n    },\n    [socket, roomId]\n  )\n\n  return useMemo(\n    () => ({\n      socket,\n      isConnected,\n      isLocked,\n      latencyMs,\n      participants,\n      emitCanvasEvent,\n      setLock,\n    }),\n    [socket, isConnected, isLocked, latencyMs, participants, emitCanvasEvent, setLock]\n  )\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAuBO,SAAS,mBAAmB,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,OAAO,EAAE,aAAa,EAAE,aAAa,EAAE,eAAe,EAA0B;IAChJ,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,4MAAe,EAAC,QAAQ;QACtD;QACA;QACA;IACF;IACA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mQAAQ,EAAC;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,mQAAQ,EAAgB;IAC1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,mQAAQ,EAAmB,EAAE;IAErE,IAAA,oQAAS,EAAC;QACR,IAAI,CAAC,UAAU,CAAC,QAAQ;QAExB,OAAO,IAAI,CAAC,iBAAiB;YAC3B;YACA;YACA;YACA;QACF;QAEA,MAAM,oBAAoB,CAAC;YACzB,IAAI,OAAO,QAAQ,MAAM,KAAK,UAAU;gBACtC,aAAa,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,KAAK,QAAQ,MAAM;YACtD;YACA,gBAAgB;QAClB;QAEA,MAAM,kBAAkB,CAAC;YACvB,IAAI,KAAK,MAAM,KAAK,QAAQ,YAAY,KAAK,MAAM;QACrD;QAEA,MAAM,oBAAoB,CAAC;YACzB,IAAI,KAAK,MAAM,KAAK,QAAQ;YAC5B,gBAAgB;QAClB;QAEA,MAAM,sBAAsB,CAAC;YAC3B,IAAI,KAAK,MAAM,KAAK,QAAQ;YAC5B,gBAAgB,KAAK,YAAY,IAAI,EAAE;YACvC,kBAAkB;QACpB;QAEA,OAAO,EAAE,CAAC,oBAAoB;QAC9B,OAAO,EAAE,CAAC,kBAAkB;QAC5B,OAAO,EAAE,CAAC,oBAAoB;QAC9B,OAAO,EAAE,CAAC,sBAAsB;QAEhC,OAAO,IAAI,CAAC,qBAAqB;YAAE;QAAO;QAE1C,OAAO;YACL,OAAO,GAAG,CAAC,oBAAoB;YAC/B,OAAO,GAAG,CAAC,kBAAkB;YAC7B,OAAO,GAAG,CAAC,oBAAoB;YAC/B,OAAO,GAAG,CAAC,sBAAsB;QACnC;IACF,GAAG;QAAC;QAAQ;QAAQ;QAAQ;QAAM;QAAM;QAAe;QAAe;KAAgB;IAEtF,MAAM,kBAAkB,IAAA,sQAAW,EACjC,CAAC;QACC,IAAI,CAAC,UAAU,CAAC,QAAQ;QACxB,OAAO,IAAI,CAAC,oBAAoB;YAC9B;YACA,SAAS;YACT,QAAQ,KAAK,GAAG;YAChB,GAAG,OAAO;QACZ;IACF,GACA;QAAC;QAAQ;QAAQ;KAAO;IAG1B,MAAM,UAAU,IAAA,sQAAW,EACzB,CAAC;QACC,IAAI,CAAC,UAAU,CAAC,QAAQ;QACxB,OAAO,IAAI,CAAC,mBAAmB;YAAE;YAAQ;QAAO;IAClD,GACA;QAAC;QAAQ;KAAO;IAGlB,OAAO,IAAA,kQAAO,EACZ,IAAM,CAAC;YACL;YACA;YACA;YACA;YACA;YACA;YACA;QACF,CAAC,GACD;QAAC;QAAQ;QAAa;QAAU;QAAW;QAAc;QAAiB;KAAQ;AAEtF"}},
    {"offset": {"line": 1685, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-daily-call.ts"],"sourcesContent":["/**\n * React Hook for Daily.co Video Calls\n * Manages video call state and Daily.co call object\n */\n\nimport { useState, useCallback, useRef, useEffect } from 'react'\nimport DailyIframe, { DailyCall, DailyParticipant } from '@daily-co/daily-js'\nimport { VideoCallState, VideoParticipant } from '@/lib/video/types'\n\ninterface UseDailyCallOptions {\n  onParticipantJoined?: (participant: VideoParticipant) => void\n  onParticipantLeft?: (participant: VideoParticipant) => void\n  onError?: (error: Error) => void\n  onRecordingStarted?: () => void\n  onRecordingStopped?: () => void\n}\n\n// Module-level singleton to prevent duplicate Daily instances\nlet globalCallInstance: DailyCall | null = null\nlet instanceCount = 0\n\nexport function useDailyCall(options: UseDailyCallOptions = {}) {\n  const callRef = useRef<DailyCall | null>(globalCallInstance)\n  const instanceId = useRef(++instanceCount)\n  \n  const [state, setState] = useState<VideoCallState>({\n    isJoined: false,\n    isAudioEnabled: false,\n    isVideoEnabled: false,\n    isScreenSharing: false,\n    participants: [],\n    error: null\n  })\n\n  // Initialize Daily call object\n  useEffect(() => {\n    // Only the first instance creates the call object\n    if (globalCallInstance) {\n      callRef.current = globalCallInstance\n      return\n    }\n    \n    let call: DailyCall | null = null\n    \n    try {\n      call = DailyIframe.createCallObject()\n      globalCallInstance = call\n      callRef.current = call\n    } catch (error) {\n      console.warn('Failed to create Daily call object:', error)\n      return\n    }\n\n    // Listen for participant events\n    call.on('participant-joined', (event) => {\n      const participant = mapDailyParticipant(event.participant)\n      options.onParticipantJoined?.(participant)\n      updateParticipants()\n    })\n\n    call.on('participant-updated', () => {\n      updateParticipants()\n    })\n\n    call.on('participant-left', (event) => {\n      const participant = mapDailyParticipant(event.participant)\n      options.onParticipantLeft?.(participant)\n      updateParticipants()\n    })\n\n    call.on('error', (event) => {\n      setState(prev => ({ ...prev, error: event.errorMsg }))\n      options.onError?.(new Error(event.errorMsg))\n    })\n\n    call.on('recording-started', () => {\n      options.onRecordingStarted?.()\n    })\n\n    call.on('recording-stopped', () => {\n      options.onRecordingStopped?.()\n    })\n\n    // Note: We don't destroy the call object on unmount\n    // because we want it to persist for the session.\n    // It's destroyed when the user explicitly leaves the call.\n  }, [])\n\n  const updateParticipants = useCallback(() => {\n    const call = callRef.current\n    if (!call) return\n\n    const participantsMap = call.participants()\n    const participants = Object.values(participantsMap).map(mapDailyParticipant)\n    \n    setState(prev => ({ ...prev, participants }))\n  }, [])\n\n  const join = useCallback(async (url: string, token?: string) => {\n    // Check if this is a mock URL (for development without Daily API key)\n    if (url.includes('mock.daily.co')) {\n      console.log('Using mock video mode')\n      setState(prev => ({\n        ...prev,\n        isJoined: true,\n        isAudioEnabled: false,\n        isVideoEnabled: false,\n        error: null\n      }))\n      return\n    }\n\n    const call = callRef.current\n    if (!call) {\n      console.warn('Daily call object not initialized - using mock mode')\n      setState(prev => ({\n        ...prev,\n        isJoined: true,\n        isAudioEnabled: false,\n        isVideoEnabled: false,\n        error: null\n      }))\n      return\n    }\n\n    try {\n      await call.join({\n        url,\n        token,\n        audioSource: false,\n        videoSource: false\n      })\n\n      setState(prev => ({\n        ...prev,\n        isJoined: true,\n        isAudioEnabled: false,\n        isVideoEnabled: false,\n        error: null\n      }))\n    } catch (error) {\n      console.error('Daily join error:', error)\n      // Fall back to mock mode on error\n      console.warn('Falling back to mock video mode')\n      setState(prev => ({\n        ...prev,\n        isJoined: true,\n        isAudioEnabled: false,\n        isVideoEnabled: false,\n        error: null\n      }))\n    }\n  }, [])\n\n  const leave = useCallback(() => {\n    const call = callRef.current\n    if (!call) return\n\n    call.leave()\n    call.destroy()\n    globalCallInstance = null\n    callRef.current = null\n    \n    setState(prev => ({\n      ...prev,\n      isJoined: false,\n      isAudioEnabled: false,\n      isVideoEnabled: false,\n      isScreenSharing: false,\n      participants: []\n    }))\n  }, [])\n\n  const toggleAudio = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    const newState = !state.isAudioEnabled\n    call.setLocalAudio(newState)\n    setState(prev => ({ ...prev, isAudioEnabled: newState }))\n  }, [state.isJoined, state.isAudioEnabled])\n\n  const toggleVideo = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    const newState = !state.isVideoEnabled\n    call.setLocalVideo(newState)\n    setState(prev => ({ ...prev, isVideoEnabled: newState }))\n  }, [state.isJoined, state.isVideoEnabled])\n\n  const startScreenShare = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    call.startScreenShare()\n    setState(prev => ({ ...prev, isScreenSharing: true }))\n  }, [state.isJoined])\n\n  const stopScreenShare = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    call.stopScreenShare()\n    setState(prev => ({ ...prev, isScreenSharing: false }))\n  }, [state.isJoined])\n\n  // Start recording\n  const startRecording = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    call.startRecording()\n  }, [state.isJoined])\n\n  // Stop recording\n  const stopRecording = useCallback(() => {\n    const call = callRef.current\n    if (!call || !state.isJoined) return\n\n    call.stopRecording()\n  }, [state.isJoined])\n\n  return {\n    call: callRef.current,\n    ...state,\n    join,\n    leave,\n    toggleAudio,\n    toggleVideo,\n    startScreenShare,\n    stopScreenShare,\n    startRecording,\n    stopRecording\n  }\n}\n\nfunction mapDailyParticipant(participant: DailyParticipant): VideoParticipant {\n  return {\n    id: participant.session_id,\n    userId: participant.user_id || participant.session_id,\n    name: participant.user_name || 'Anonymous',\n    isScreenSharing: participant.screen,\n    isAudioEnabled: participant.audio,\n    isVideoEnabled: participant.video\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1926, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/ai/memory-service.ts"],"sourcesContent":["/**\n * Memory Service\n * The \"Shared Brain\" for AI Agents\n * Manages context persistence and retrieval\n */\n\nimport { StudentContext, StudentProfile, LearningState, AgentSignal } from './types/context'\n\n// Mock Database (In-Memory for now)\nconst profiles = new Map<string, StudentProfile>()\nconst states = new Map<string, LearningState>()\nconst signals = new Map<string, AgentSignal[]>()\nconst roomTranscripts = new Map<string, any[]>()\n\n// Initialize with some mock data for testing\nconst MOCK_STUDENT_ID = 'student-1'\nprofiles.set(MOCK_STUDENT_ID, {\n    id: MOCK_STUDENT_ID,\n    name: 'Sarah Chen',\n    age: 16,\n    level: 'B1',\n    learningStyle: 'visual',\n    interests: ['music', 'technology', 'travel'],\n    goals: ['improve_pronunciation', 'vocabulary_expansion'],\n    preferredVoice: { gender: 'female', accent: 'us' }\n})\n\nstates.set(MOCK_STUDENT_ID, {\n    currentMood: 'neutral',\n    energyLevel: 80,\n    recentStruggles: [],\n    masteredTopics: ['present_perfect', 'basic_greetings'],\n    activeTopics: ['conditionals', 'phrasal_verbs']\n})\n\nsignals.set(MOCK_STUDENT_ID, [])\n\nexport class MemoryService {\n    /**\n     * Get the full context for a student\n     * Aggregates Profile + State + Signals\n     */\n    static async getStudentContext(studentId: string): Promise<StudentContext | null> {\n        const profile = profiles.get(studentId)\n        if (!profile) return null\n\n        const state = states.get(studentId) || this.getInitialState()\n        const studentSignals = signals.get(studentId) || []\n\n        // Filter out expired signals\n        const activeSignals = studentSignals.filter(s => !s.expiresAt || s.expiresAt > Date.now())\n\n        return {\n            profile,\n            state,\n            signals: activeSignals\n        }\n    }\n\n    /**\n     * Transcript Management\n     */\n    static appendTranscript(roomId: string, entry: any) {\n        const current = roomTranscripts.get(roomId) || []\n        roomTranscripts.set(roomId, [...current, entry])\n    }\n\n    static getTranscript(roomId: string): any[] {\n        return roomTranscripts.get(roomId) || []\n    }\n\n    /**\n     * Record a new signal from an agent\n     */\n    static async recordSignal(studentId: string, signal: Omit<AgentSignal, 'id' | 'timestamp'>) {\n        const newSignal: AgentSignal = {\n            ...signal,\n            id: Math.random().toString(36).substring(7),\n            timestamp: Date.now()\n        }\n\n        const currentSignals = signals.get(studentId) || []\n        signals.set(studentId, [...currentSignals, newSignal])\n\n        // Auto-update state based on signals\n        if (signal.type === 'struggle_detected') {\n            await this.updateState(studentId, (state) => {\n                state.recentStruggles.push({\n                    topic: signal.context?.topic || 'unknown',\n                    errorType: signal.context?.errorType || 'general',\n                    severity: signal.context?.severity || 5,\n                    detectedAt: Date.now()\n                })\n                // Keep only last 5 struggles\n                if (state.recentStruggles.length > 5) state.recentStruggles.shift()\n                return state\n            })\n        }\n    }\n\n    /**\n     * Update the dynamic learning state\n     */\n    static async updateState(studentId: string, updateFn: (state: LearningState) => LearningState) {\n        const currentState = states.get(studentId) || this.getInitialState()\n        const newState = updateFn({ ...currentState })\n        states.set(studentId, newState)\n    }\n\n    /**\n     * Get initial state for new students\n     */\n    private static getInitialState(): LearningState {\n        return {\n            currentMood: 'neutral',\n            energyLevel: 100,\n            recentStruggles: [],\n            masteredTopics: [],\n            activeTopics: []\n        }\n    }\n\n    /**\n     * Analyze Transcript Summary and update context\n     * This is the bridge from Classroom TA to Personal Tutor\n     */\n    static async processClassSummary(studentId: string, summaryJson: any) {\n        // 1. Record the summary signal\n        await this.recordSignal(studentId, {\n            source: 'classroom_ta',\n            type: 'topic_requested', // Or a new type 'class_summary'\n            content: `Completed class on ${summaryJson.topic}. Status: ${summaryJson.status}`,\n            context: summaryJson\n        })\n\n        // 2. Update state based on summary\n        await this.updateState(studentId, (state) => {\n            // Add struggles\n            if (summaryJson.struggles && Array.isArray(summaryJson.struggles)) {\n                summaryJson.struggles.forEach((s: string) => {\n                    state.recentStruggles.push({\n                        topic: s,\n                        errorType: 'general',\n                        severity: 7,\n                        detectedAt: Date.now()\n                    })\n                })\n            }\n\n            // Update active topics\n            if (summaryJson.topic) {\n                if (!state.activeTopics.includes(summaryJson.topic)) {\n                    state.activeTopics.push(summaryJson.topic)\n                }\n            }\n\n            return state\n        })\n    }\n\n    /**\n     * Record Quiz Result and Update Context\n     * Updates student context based on quiz performance\n     */\n    static async recordQuizResult(studentId: string, result: {\n        topic: string\n        score: number\n        maxScore: number\n        questionTypes: string[]\n    }) {\n        const percentage = result.score / result.maxScore\n\n        // Record signal\n        await this.recordSignal(studentId, {\n            source: 'personal_tutor',\n            type: percentage >= 0.7 ? 'mastery_achieved' : 'struggle_detected',\n            content: `Quiz on ${result.topic}: ${result.score}/${result.maxScore} (${Math.round(percentage * 100)}%)`,\n            context: result\n        })\n\n        // Update state based on performance\n        await this.updateState(studentId, (state) => {\n            if (percentage < 0.7) {\n                // Poor performance - add to struggles\n                const existingStruggle = state.recentStruggles.find(s => s.topic === result.topic)\n                if (!existingStruggle) {\n                    state.recentStruggles.push({\n                        topic: result.topic,\n                        errorType: 'general',\n                        severity: Math.round((1 - percentage) * 10), // Higher severity for lower scores\n                        detectedAt: Date.now()\n                    })\n                    // Keep only last 10 struggles\n                    if (state.recentStruggles.length > 10) {\n                        state.recentStruggles.shift()\n                    }\n                }\n\n                // Add to active topics if not already there\n                if (!state.activeTopics.includes(result.topic)) {\n                    state.activeTopics.push(result.topic)\n                }\n            } else if (percentage >= 0.85) {\n                // Excellent performance - add to mastered topics\n                if (!state.masteredTopics.includes(result.topic)) {\n                    state.masteredTopics.push(result.topic)\n                }\n\n                // Remove from struggles if present\n                state.recentStruggles = state.recentStruggles.filter(s => s.topic !== result.topic)\n            }\n\n            return state\n        })\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2134, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/extract-file-text.ts"],"sourcesContent":["// @ts-nocheck\n/**\n * Extract plain text from uploaded files: .txt, .md, .pdf, .docx, and images (OCR).\n * Used by the course/subject materials upload flow.\n */\n\nexport async function extractTextFromFile(file: File): Promise<string> {\n  const name = file.name.toLowerCase()\n  const type = file.type\n\n  // Plain text\n  if (\n    type === 'text/plain' ||\n    type.startsWith('text/') ||\n    name.endsWith('.txt') ||\n    name.endsWith('.md') ||\n    name.endsWith('.markdown')\n  ) {\n    return readAsText(file)\n  }\n\n  // PDF\n  if (type === 'application/pdf' || name.endsWith('.pdf')) {\n    return extractPdfText(file)\n  }\n\n  // Word .docx\n  if (\n    type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||\n    name.endsWith('.docx')\n  ) {\n    return extractDocxText(file)\n  }\n\n  // Legacy .doc - treat as binary; we could try mammoth with .doc but support is limited\n  if (name.endsWith('.doc')) {\n    try {\n      return extractDocxText(file)\n    } catch {\n      return readAsText(file).catch(() => '')\n    }\n  }\n\n  // Images: OCR\n  if (type.startsWith('image/')) {\n    return extractImageText(file)\n  }\n\n  // Fallback: try as text\n  return readAsText(file).catch(() => '')\n}\n\nfunction readAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(String(reader.result ?? ''))\n    reader.onerror = () => reject(reader.error)\n    reader.readAsText(file)\n  })\n}\n\nasync function extractPdfText(file: File): Promise<string> {\n  const pdfjs = await import('pdfjs-dist')\n  // Worker must be same-origin (CSP blocks external scripts). Served from public/ via copy-pdf-worker script.\n  if (typeof window !== 'undefined') {\n    const opts = (pdfjs as { GlobalWorkerOptions?: { workerSrc?: string } }).GlobalWorkerOptions\n    if (opts && !opts.workerSrc) {\n      opts.workerSrc = '/pdf.worker.min.mjs'\n    }\n  }\n  const data = await file.arrayBuffer()\n  const doc = await pdfjs.getDocument({ data }).promise\n  const numPages = doc.numPages\n  const parts: string[] = []\n  for (let i = 1; i <= numPages; i++) {\n    const page = await doc.getPage(i)\n    const content = await page.getTextContent()\n    const pageText = content.items.map((item: { str?: string }) => (item as { str?: string }).str ?? '').join(' ')\n    parts.push(pageText)\n  }\n  return parts.join('\\n\\n').trim() || ''\n}\n\nasync function extractDocxText(file: File): Promise<string> {\n  const mammoth = await import('mammoth')\n  const arrayBuffer = await file.arrayBuffer()\n  const result = await mammoth.extractRawText({ arrayBuffer })\n  return (result.value || '').trim()\n}\n\nasync function extractImageText(file: File): Promise<string> {\n  const mod = await import('tesseract.js')\n  const api = (mod as { default?: { recognize: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }; recognize?: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }).default ?? mod\n  const { data } = await api.recognize(file, 'eng', { logger: () => {} })\n  return (data?.text || '').trim()\n}\n"],"names":[],"mappings":"AAAA,cAAc;AACd;;;CAGC;;;;AAEM,eAAe,oBAAoB,IAAU;IAClD,MAAM,OAAO,KAAK,IAAI,CAAC,WAAW;IAClC,MAAM,OAAO,KAAK,IAAI;IAEtB,aAAa;IACb,IACE,SAAS,gBACT,KAAK,UAAU,CAAC,YAChB,KAAK,QAAQ,CAAC,WACd,KAAK,QAAQ,CAAC,UACd,KAAK,QAAQ,CAAC,cACd;QACA,OAAO,WAAW;IACpB;IAEA,MAAM;IACN,IAAI,SAAS,qBAAqB,KAAK,QAAQ,CAAC,SAAS;QACvD,OAAO,eAAe;IACxB;IAEA,aAAa;IACb,IACE,SAAS,6EACT,KAAK,QAAQ,CAAC,UACd;QACA,OAAO,gBAAgB;IACzB;IAEA,uFAAuF;IACvF,IAAI,KAAK,QAAQ,CAAC,SAAS;QACzB,IAAI;YACF,OAAO,gBAAgB;QACzB,EAAE,OAAM;YACN,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;QACtC;IACF;IAEA,cAAc;IACd,IAAI,KAAK,UAAU,CAAC,WAAW;QAC7B,OAAO,iBAAiB;IAC1B;IAEA,wBAAwB;IACxB,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;AACtC;AAEA,SAAS,WAAW,IAAU;IAC5B,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG,IAAM,OAAO,OAAO,KAAK;QAC1C,OAAO,UAAU,CAAC;IACpB;AACF;AAEA,eAAe,eAAe,IAAU;IACtC,MAAM,QAAQ;IACd,4GAA4G;IAC5G;;IAMA,MAAM,OAAO,MAAM,KAAK,WAAW;IACnC,MAAM,MAAM,MAAM,MAAM,WAAW,CAAC;QAAE;IAAK,GAAG,OAAO;IACrD,MAAM,WAAW,IAAI,QAAQ;IAC7B,MAAM,QAAkB,EAAE;IAC1B,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;QAClC,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC;QAC/B,MAAM,UAAU,MAAM,KAAK,cAAc;QACzC,MAAM,WAAW,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC,OAA2B,AAAC,KAA0B,GAAG,IAAI,IAAI,IAAI,CAAC;QAC1G,MAAM,IAAI,CAAC;IACb;IACA,OAAO,MAAM,IAAI,CAAC,QAAQ,IAAI,MAAM;AACtC;AAEA,eAAe,gBAAgB,IAAU;IACvC,MAAM,UAAU;IAChB,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,MAAM,QAAQ,cAAc,CAAC;QAAE;IAAY;IAC1D,OAAO,CAAC,OAAO,KAAK,IAAI,EAAE,EAAE,IAAI;AAClC;AAEA,eAAe,iBAAiB,IAAU;IACxC,MAAM,MAAM;IACZ,MAAM,MAAM,AAAC,IAA0N,OAAO,IAAI;IAClP,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,SAAS,CAAC,MAAM,OAAO;QAAE,QAAQ,KAAO;IAAE;IACrE,OAAO,CAAC,MAAM,QAAQ,EAAE,EAAE,IAAI;AAChC"}},
    {"offset": {"line": 2219, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/pdf-tutoring/coordinates.ts"],"sourcesContent":["export interface PointPx {\n  x: number\n  y: number\n}\n\nexport interface PointPercent {\n  x: number\n  y: number\n}\n\nfunction clampPercent(value: number): number {\n  return Math.max(0, Math.min(100, value))\n}\n\nexport function pxToPercent(value: number, total: number): number {\n  if (!Number.isFinite(value) || !Number.isFinite(total) || total <= 0) return 0\n  return clampPercent((value / total) * 100)\n}\n\nexport function percentToPx(value: number, total: number): number {\n  if (!Number.isFinite(value) || !Number.isFinite(total) || total <= 0) return 0\n  return (value / 100) * total\n}\n\nexport function pointToPercent(point: PointPx, width: number, height: number): PointPercent {\n  return {\n    x: pxToPercent(point.x, width),\n    y: pxToPercent(point.y, height),\n  }\n}\n\nexport function pointToPx(point: PointPercent, width: number, height: number): PointPx {\n  return {\n    x: percentToPx(point.x, width),\n    y: percentToPx(point.y, height),\n  }\n}\n\nexport function rectToPercent<T extends { left?: number; top?: number; width?: number; height?: number }>(\n  rect: T,\n  width: number,\n  height: number\n): T {\n  return {\n    ...rect,\n    ...(typeof rect.left === 'number' ? { left: pxToPercent(rect.left, width) } : {}),\n    ...(typeof rect.top === 'number' ? { top: pxToPercent(rect.top, height) } : {}),\n    ...(typeof rect.width === 'number' ? { width: pxToPercent(rect.width, width) } : {}),\n    ...(typeof rect.height === 'number' ? { height: pxToPercent(rect.height, height) } : {}),\n  }\n}\n\nexport function rectToPx<T extends { left?: number; top?: number; width?: number; height?: number }>(\n  rect: T,\n  width: number,\n  height: number\n): T {\n  return {\n    ...rect,\n    ...(typeof rect.left === 'number' ? { left: percentToPx(rect.left, width) } : {}),\n    ...(typeof rect.top === 'number' ? { top: percentToPx(rect.top, height) } : {}),\n    ...(typeof rect.width === 'number' ? { width: percentToPx(rect.width, width) } : {}),\n    ...(typeof rect.height === 'number' ? { height: percentToPx(rect.height, height) } : {}),\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAUA,SAAS,aAAa,KAAa;IACjC,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK;AACnC;AAEO,SAAS,YAAY,KAAa,EAAE,KAAa;IACtD,IAAI,CAAC,OAAO,QAAQ,CAAC,UAAU,CAAC,OAAO,QAAQ,CAAC,UAAU,SAAS,GAAG,OAAO;IAC7E,OAAO,aAAa,AAAC,QAAQ,QAAS;AACxC;AAEO,SAAS,YAAY,KAAa,EAAE,KAAa;IACtD,IAAI,CAAC,OAAO,QAAQ,CAAC,UAAU,CAAC,OAAO,QAAQ,CAAC,UAAU,SAAS,GAAG,OAAO;IAC7E,OAAO,AAAC,QAAQ,MAAO;AACzB;AAEO,SAAS,eAAe,KAAc,EAAE,KAAa,EAAE,MAAc;IAC1E,OAAO;QACL,GAAG,YAAY,MAAM,CAAC,EAAE;QACxB,GAAG,YAAY,MAAM,CAAC,EAAE;IAC1B;AACF;AAEO,SAAS,UAAU,KAAmB,EAAE,KAAa,EAAE,MAAc;IAC1E,OAAO;QACL,GAAG,YAAY,MAAM,CAAC,EAAE;QACxB,GAAG,YAAY,MAAM,CAAC,EAAE;IAC1B;AACF;AAEO,SAAS,cACd,IAAO,EACP,KAAa,EACb,MAAc;IAEd,OAAO;QACL,GAAG,IAAI;QACP,GAAI,OAAO,KAAK,IAAI,KAAK,WAAW;YAAE,MAAM,YAAY,KAAK,IAAI,EAAE;QAAO,IAAI,CAAC,CAAC;QAChF,GAAI,OAAO,KAAK,GAAG,KAAK,WAAW;YAAE,KAAK,YAAY,KAAK,GAAG,EAAE;QAAQ,IAAI,CAAC,CAAC;QAC9E,GAAI,OAAO,KAAK,KAAK,KAAK,WAAW;YAAE,OAAO,YAAY,KAAK,KAAK,EAAE;QAAO,IAAI,CAAC,CAAC;QACnF,GAAI,OAAO,KAAK,MAAM,KAAK,WAAW;YAAE,QAAQ,YAAY,KAAK,MAAM,EAAE;QAAQ,IAAI,CAAC,CAAC;IACzF;AACF;AAEO,SAAS,SACd,IAAO,EACP,KAAa,EACb,MAAc;IAEd,OAAO;QACL,GAAG,IAAI;QACP,GAAI,OAAO,KAAK,IAAI,KAAK,WAAW;YAAE,MAAM,YAAY,KAAK,IAAI,EAAE;QAAO,IAAI,CAAC,CAAC;QAChF,GAAI,OAAO,KAAK,GAAG,KAAK,WAAW;YAAE,KAAK,YAAY,KAAK,GAAG,EAAE;QAAQ,IAAI,CAAC,CAAC;QAC9E,GAAI,OAAO,KAAK,KAAK,KAAK,WAAW;YAAE,OAAO,YAAY,KAAK,KAAK,EAAE;QAAO,IAAI,CAAC,CAAC;QACnF,GAAI,OAAO,KAAK,MAAM,KAAK,WAAW;YAAE,QAAQ,YAAY,KAAK,MAAM,EAAE;QAAQ,IAAI,CAAC,CAAC;IACzF;AACF"}}]
}