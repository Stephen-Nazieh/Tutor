;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f56b37fe-abc8-6bdb-1180-d3e0aa597759")}catch(e){}}();
module.exports=[921517,(e,r,t)=>{r.exports=e.x("http",()=>require("http"))},406461,(e,r,t)=>{r.exports=e.x("zlib",()=>require("zlib"))},524836,(e,r,t)=>{r.exports=e.x("https",()=>require("https"))},792509,(e,r,t)=>{r.exports=e.x("url",()=>require("url"))},427699,(e,r,t)=>{r.exports=e.x("events",()=>require("events"))},500874,(e,r,t)=>{r.exports=e.x("buffer",()=>require("buffer"))},918622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},224361,(e,r,t)=>{r.exports=e.x("util",()=>require("util"))},193695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},654884,139346,983142,322112,e=>{"use strict";var r,t,i="object"==typeof globalThis?globalThis:e.g,s="1.9.0",a=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,n=function(e){var r=new Set([e]),t=new Set,i=e.match(a);if(!i)return function(){return!1};var s={major:+i[1],minor:+i[2],patch:+i[3],prerelease:i[4]};if(null!=s.prerelease)return function(r){return r===e};function n(e){return t.add(e),!1}return function(e){if(r.has(e))return!0;if(t.has(e))return!1;var i=e.match(a);if(!i)return n(e);var o={major:+i[1],minor:+i[2],patch:+i[3],prerelease:i[4]};if(null!=o.prerelease||s.major!==o.major)return n(e);if(0===s.major)return s.minor===o.minor&&s.patch<=o.patch?(r.add(e),!0):n(e);return s.minor<=o.minor?(r.add(e),!0):n(e)}}(s),o=Symbol.for("opentelemetry.js.api."+s.split(".")[0]);function c(e,r,t,a){void 0===a&&(a=!1);var n,c=i[o]=null!=(n=i[o])?n:{version:s};if(!a&&c[e]){var l=Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return t.error(l.stack||l.message),!1}if(c.version!==s){var l=Error("@opentelemetry/api: Registration of version v"+c.version+" for "+e+" does not match previously registered API v"+s);return t.error(l.stack||l.message),!1}return c[e]=r,t.debug("@opentelemetry/api: Registered a global for "+e+" v"+s+"."),!0}function l(e){var r,t,s=null==(r=i[o])?void 0:r.version;if(s&&n(s))return null==(t=i[o])?void 0:t[e]}function h(e,r){r.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+s+".");var t=i[o];t&&delete t[e]}e.s(["getGlobal",()=>l,"registerGlobal",()=>c,"unregisterGlobal",()=>h],139346);var u=function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,s,a=t.call(e),n=[];try{for(;(void 0===r||r-- >0)&&!(i=a.next()).done;)n.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(s)throw s.error}}return n},d=function(e,r,t){if(t||2==arguments.length)for(var i,s=0,a=r.length;s<a;s++)!i&&s in r||(i||(i=Array.prototype.slice.call(r,0,s)),i[s]=r[s]);return e.concat(i||Array.prototype.slice.call(r))},m=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return p("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return p("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return p("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return p("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return p("verbose",this._namespace,e)},e}();function p(e,r,t){var i=l("diag");if(i)return t.unshift(r),i[e].apply(i,d([],u(t),!1))}(r=t||(t={}))[r.NONE=0]="NONE",r[r.ERROR=30]="ERROR",r[r.WARN=50]="WARN",r[r.INFO=60]="INFO",r[r.DEBUG=70]="DEBUG",r[r.VERBOSE=80]="VERBOSE",r[r.ALL=9999]="ALL",e.s(["DiagLogLevel",()=>t],983142);var f=function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,s,a=t.call(e),n=[];try{for(;(void 0===r||r-- >0)&&!(i=a.next()).done;)n.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(s)throw s.error}}return n},g=function(e,r,t){if(t||2==arguments.length)for(var i,s=0,a=r.length;s<a;s++)!i&&s in r||(i||(i=Array.prototype.slice.call(r,0,s)),i[s]=r[s]);return e.concat(i||Array.prototype.slice.call(r))},y=function(){function e(){function e(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i=l("diag");if(i)return i[e].apply(i,g([],f(r),!1))}}var r=this;r.setLogger=function(e,i){if(void 0===i&&(i={logLevel:t.INFO}),e===r){var s,a,n,o=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error(null!=(s=o.stack)?s:o.message),!1}"number"==typeof i&&(i={logLevel:i});var h=l("diag"),u=function(e,r){function i(t,i){var s=r[t];return"function"==typeof s&&e>=i?s.bind(r):function(){}}return e<t.NONE?e=t.NONE:e>t.ALL&&(e=t.ALL),r=r||{},{error:i("error",t.ERROR),warn:i("warn",t.WARN),info:i("info",t.INFO),debug:i("debug",t.DEBUG),verbose:i("verbose",t.VERBOSE)}}(null!=(a=i.logLevel)?a:t.INFO,e);if(h&&!i.suppressOverrideMessage){var d=null!=(n=Error().stack)?n:"<failed to generate stacktrace>";h.warn("Current logger will be overwritten from "+d),u.warn("Current logger will overwrite one already registered from "+d)}return c("diag",u,r,!0)},r.disable=function(){h("diag",r)},r.createComponentLogger=function(e){return new m(e)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();e.s(["DiagAPI",()=>y],322112);var E=y.instance();e.s(["diag",()=>E],654884)},254799,(e,r,t)=>{r.exports=e.x("crypto",()=>require("crypto"))},238523,e=>e.a(async(r,t)=>{try{let r=await e.y("pg-db6d965ecbff73b5");e.n(r),t()}catch(e){t(e)}},!0),491405,e=>{"use strict";let r;var t=e.i(841195),i=e.i(254799),s=e.i(406461),a=e.i(224361);let n=(0,a.promisify)(s.gzip),o=(0,a.promisify)(s.gunzip),c={PREFIX:"tutorme:cache:",TAG_PREFIX:"tutorme:tags:",METRIC_PREFIX:"tutorme:metrics:",COMPRESS_THRESHOLD:1024,ENCRYPTION_ALGORITHM:"aes-256-gcm",ENCRYPTION_KEY_LENGTH:32,CONNECTION_TIMEOUT:2e3,COMMAND_TIMEOUT:3e3,KEEP_ALIVE:3e4,MAX_RETRIES:5,RETRY_DELAY_BASE:100,HEALTH_CHECK_INTERVAL:3e4,MEMORY_CACHE_MAX_SIZE:1e3,MEMORY_CACHE_TTL:60,TTL_DEFAULT:parseInt(process.env.CACHE_TTL_DEFAULT||"60",10),TTL_USER:parseInt(process.env.CACHE_TTL_USER||"300",10),TTL_LEADERBOARD:parseInt(process.env.CACHE_TTL_LEADERBOARD||"300",10),TTL_CONTENT:parseInt(process.env.CACHE_TTL_CONTENT||"600",10)};t.z.object({value:t.z.unknown(),compressed:t.z.boolean().default(!1),encrypted:t.z.boolean().default(!1),tags:t.z.array(t.z.string()).default([]),createdAt:t.z.number(),ttl:t.z.number()});let l=t.z.object({hits:t.z.number().default(0),misses:t.z.number().default(0),sets:t.z.number().default(0),deletes:t.z.number().default(0),errors:t.z.number().default(0),totalLatencyMs:t.z.number().default(0),compressionRatio:t.z.number().default(0),memoryCacheHits:t.z.number().default(0),redisCacheHits:t.z.number().default(0)});class h{key;constructor(){const e=process.env.CACHE_ENCRYPTION_KEY;if(e){if(this.key=Buffer.from(e,"hex"),this.key.length!==c.ENCRYPTION_KEY_LENGTH)throw Error("CACHE_ENCRYPTION_KEY must be 64 hex characters (32 bytes)")}else{const e=process.env.NEXTAUTH_SECRET||"dev-secret-change-in-production";this.key=i.createHash("sha256").update(e).digest()}}encrypt(e){let r=i.randomBytes(16),t=i.createCipheriv(c.ENCRYPTION_ALGORITHM,this.key,r),s=t.update(e,"utf8","hex");s+=t.final("hex");let a=t.getAuthTag();return`${r.toString("hex")}:${a.toString("hex")}:${s}`}decrypt(e){let[r,t,s]=e.split(":");if(!r||!t||!s)throw Error("Invalid encrypted data format");let a=Buffer.from(r,"hex"),n=Buffer.from(t,"hex"),o=i.createDecipheriv(c.ENCRYPTION_ALGORITHM,this.key,a);o.setAuthTag(n);let l=o.update(s,"hex","utf8");return l+o.final("utf8")}}class u{cache;maxSize;constructor(e=c.MEMORY_CACHE_MAX_SIZE){this.cache=new Map,this.maxSize=e}get(e){let r=this.cache.get(e);return r?r.expires<Date.now()?(this.cache.delete(e),null):r.data.value:null}set(e,r,t){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(e,{data:r,expires:Date.now()+1e3*t})}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cache.size}cleanup(){let e=Date.now(),r=0;for(let[t,i]of Array.from(this.cache.entries()))i.expires<e&&(this.cache.delete(t),r++);return r}}let d=globalThis;d.cacheManager||(d.cacheManager=new class{redis=null;memoryCache;encryption;metrics;performanceHook=null;healthCheckInterval=null;isHealthy=!1;initializationPromise=null;constructor(){this.memoryCache=new u,this.encryption=new h,this.metrics=l.parse({}),setInterval(()=>{this.memoryCache.cleanup()},6e4)}async initialize(){return this.initializationPromise||(this.initializationPromise=this._initialize()),this.initializationPromise}async _initialize(){let r=process.env.REDIS_URL;if(!r)return void console.warn("[CacheManager] REDIS_URL not configured, using in-memory cache only");try{let{Redis:t}=await e.A(443460);this.redis=new t(r,{connectTimeout:c.CONNECTION_TIMEOUT,commandTimeout:c.COMMAND_TIMEOUT,keepAlive:c.KEEP_ALIVE,lazyConnect:!1,retryStrategy:e=>{if(e>c.MAX_RETRIES)return console.error("[CacheManager] Max retries reached, giving up"),null;let r=Math.min(c.RETRY_DELAY_BASE*Math.pow(2,e-1),2e3);return console.warn(`[CacheManager] Retry attempt ${e} after ${r}ms`),r},maxRetriesPerRequest:3,enableReadyCheck:!0,enableOfflineQueue:!0,showFriendlyErrorStack:!1}),this.redis.on("connect",()=>{console.log("[CacheManager] Redis connected"),this.isHealthy=!0}),this.redis.on("ready",()=>{console.log("[CacheManager] Redis ready"),this.isHealthy=!0}),this.redis.on("error",e=>{console.error("[CacheManager] Redis error:",e.message),this.isHealthy=!1,this.metrics.errors++}),this.redis.on("close",()=>{console.warn("[CacheManager] Redis connection closed"),this.isHealthy=!1}),this.redis.on("reconnecting",e=>{console.log(`[CacheManager] Redis reconnecting in ${e}ms`)}),await this.redis.ping(),console.log("[CacheManager] Redis initialized successfully"),this.startHealthCheck()}catch(e){console.error("[CacheManager] Failed to initialize Redis:",e),this.redis=null,this.isHealthy=!1}}startHealthCheck(){this.healthCheckInterval||(this.healthCheckInterval=setInterval(async()=>{if(!this.redis){this.isHealthy=!1;return}try{await Promise.race([this.redis.ping(),new Promise((e,r)=>setTimeout(()=>r(Error("Health check timeout")),1e3))]),this.isHealthy=!0}catch(e){console.warn("[CacheManager] Health check failed:",e),this.isHealthy=!1}},c.HEALTH_CHECK_INTERVAL))}isCacheHealthy(){return this.isHealthy||null===this.redis}getRedisClient(){return this.redis}setPerformanceHook(e){this.performanceHook=e}recordMetrics(e,r,t,i="none"){t?"get"===e?(this.metrics.hits++,"memory"===i&&this.metrics.memoryCacheHits++,"redis"===i&&this.metrics.redisCacheHits++):"set"===e?this.metrics.sets++:"delete"===e&&this.metrics.deletes++:(this.metrics.misses++,"get"!==e&&this.metrics.errors++),this.metrics.totalLatencyMs+=r,this.performanceHook&&this.performanceHook(e,r,t)}getMetrics(){let e=this.metrics.hits+this.metrics.misses>0?this.metrics.hits/(this.metrics.hits+this.metrics.misses):0,r=this.metrics.hits+this.metrics.misses>0?this.metrics.totalLatencyMs/(this.metrics.hits+this.metrics.misses):0;return{...this.metrics,hitRate:e,avgLatencyMs:r}}resetMetrics(){this.metrics=l.parse({})}async get(e,r={}){let t=Date.now(),i=c.PREFIX+e;try{await this.initialize();let s=this.memoryCache.get(i);if(null!==s)return this.recordMetrics("get",Date.now()-t,!0,"memory"),s;if(this.redis&&this.isHealthy)try{let s=await this.redis.get(i);if(s){let a=await this.deserializeEntry(s),n=(Date.now()-a.createdAt)/1e3;if(n>=a.ttl)return await this.delete(e),this.recordMetrics("get",Date.now()-t,!1),null;if(this.memoryCache.set(i,a,a.ttl-n),r.schema){let e=r.schema.parse(a.value);return this.recordMetrics("get",Date.now()-t,!0,"redis"),e}return this.recordMetrics("get",Date.now()-t,!0,"redis"),a.value}}catch(e){console.error("[CacheManager] Redis get error:",e),this.isHealthy=!1}return this.recordMetrics("get",Date.now()-t,!1),null}catch(e){return console.error("[CacheManager] Get error:",e),this.recordMetrics("get",Date.now()-t,!1),null}}async set(e,r,t={}){let i=Date.now(),s=c.PREFIX+e,a=t.ttl||c.TTL_DEFAULT;try{await this.initialize();let e=r;t.schema&&(e=t.schema.parse(r));let n={value:e,compressed:!1,encrypted:!1,tags:t.tags||[],createdAt:Date.now(),ttl:a},o=await this.serializeEntry(n,t);if(this.memoryCache.set(s,n,a),this.redis&&this.isHealthy)try{return await this.redis.setex(s,a,o),n.tags.length>0&&await this.addTagsToKey(s,n.tags),this.recordMetrics("set",Date.now()-i,!0),!0}catch(e){return console.error("[CacheManager] Redis set error:",e),this.isHealthy=!1,this.recordMetrics("set",Date.now()-i,!0),!0}return this.recordMetrics("set",Date.now()-i,!0),!0}catch(e){return console.error("[CacheManager] Set error:",e),this.recordMetrics("set",Date.now()-i,!1),!1}}async delete(e){let r=Date.now(),t=c.PREFIX+e;try{if(this.memoryCache.delete(t),this.redis&&this.isHealthy)try{return await this.redis.del(t),await this.removeTagsFromKey(t),this.recordMetrics("delete",Date.now()-r,!0),!0}catch(e){return console.error("[CacheManager] Redis delete error:",e),this.isHealthy=!1,this.recordMetrics("delete",Date.now()-r,!0),!0}return this.recordMetrics("delete",Date.now()-r,!0),!0}catch(e){return console.error("[CacheManager] Delete error:",e),this.recordMetrics("delete",Date.now()-r,!1),!1}}async getOrSet(e,r,t={}){let i=await this.get(e,t);if(null!==i)return i;let s=await r();return await this.set(e,s,t),s}async clear(){let e=Date.now();try{if(this.memoryCache.clear(),this.redis&&this.isHealthy)try{let r=await this.redis.keys(c.PREFIX+"*");r.length>0&&await this.redis.del(...r);let t=await this.redis.keys(c.TAG_PREFIX+"*");return t.length>0&&await this.redis.del(...t),this.recordMetrics("delete",Date.now()-e,!0),!0}catch(r){return console.error("[CacheManager] Redis clear error:",r),this.isHealthy=!1,this.recordMetrics("delete",Date.now()-e,!0),!0}return this.recordMetrics("delete",Date.now()-e,!0),!0}catch(r){return console.error("[CacheManager] Clear error:",r),this.recordMetrics("delete",Date.now()-e,!1),!1}}async invalidateTag(e){let r=Date.now(),t=c.TAG_PREFIX+e;try{if(!this.redis||!this.isHealthy)return console.warn("[CacheManager] Tag invalidation requires Redis"),0;let e=await this.redis.smembers(t);if(0===e.length)return 0;let i=e.map(e=>c.PREFIX+e.replace(c.PREFIX,""));return i.forEach(e=>this.memoryCache.delete(e)),await this.redis.del(...i),await this.redis.del(t),this.recordMetrics("delete",Date.now()-r,!0),e.length}catch(e){return console.error("[CacheManager] Tag invalidation error:",e),this.recordMetrics("delete",Date.now()-r,!1),0}}async invalidateTags(e){let r=0;for(let t of e)r+=await this.invalidateTag(t);return r}async addTagsToKey(e,r){if(this.redis&&this.isHealthy&&0!==r.length)try{let t=this.redis.pipeline();for(let i of r){let r=c.TAG_PREFIX+i;t.sadd(r,e),t.expire(r,2*c.TTL_DEFAULT)}await t.exec()}catch(e){console.error("[CacheManager] Add tags error:",e)}}async removeTagsFromKey(e){if(this.redis&&this.isHealthy)try{let r=await this.redis.keys(c.TAG_PREFIX+"*");if(0===r.length)return;let t=this.redis.pipeline();for(let i of r)t.srem(i,e);await t.exec()}catch(e){console.error("[CacheManager] Remove tags error:",e)}}async serializeEntry(e,r){let t=JSON.stringify(e);return(void 0!==r.compress?r.compress:Buffer.byteLength(t,"utf8")>c.COMPRESS_THRESHOLD)&&(t=(await n(Buffer.from(t,"utf8"))).toString("base64"),e.compressed=!0),r.encrypt&&(t=this.encryption.encrypt(t),e.encrypted=!0),JSON.stringify({compressed:e.compressed,encrypted:e.encrypted,tags:e.tags,createdAt:e.createdAt,ttl:e.ttl,data:t})}async deserializeEntry(e){let r=JSON.parse(e),t=r.data;r.encrypted&&(t=this.encryption.decrypt(t)),r.compressed&&(t=(await o(Buffer.from(t,"base64"))).toString("utf8"));let i=JSON.parse(t);return i.compressed=r.compressed,i.encrypted=r.encrypted,i.tags=r.tags,i.createdAt=r.createdAt,i.ttl=r.ttl,i}async disconnect(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.redis&&(await this.redis.quit(),this.redis=null,this.isHealthy=!1),this.memoryCache.clear(),console.log("[CacheManager] Disconnected")}}),r=d.cacheManager,e.s(["default",0,r])},412171,e=>{e.v(r=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(r=>e.l(r))).then(()=>r(145830)))},443460,e=>{e.v(r=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(r=>e.l(r))).then(()=>r(693545)))}];

//# debugId=f56b37fe-abc8-6bdb-1180-d3e0aa597759
//# sourceMappingURL=%5Broot-of-the-server%5D__f2830d2b._.js.map