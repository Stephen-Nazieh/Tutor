;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="cb2c7b7e-93b2-32bb-6a05-44132236a47e")}catch(e){}}();
module.exports=[663176,e=>e.a(async(t,r)=>{try{var a=e.i(620971),n=e.i(384030),i=e.i(738597);e.i(688768);var o=e.i(257357),s=e.i(909105),l=e.i(997103),d=e.i(841195),c=e.i(75835),u=t([n,i]);[n,i]=u.then?(await u)():u;let p=d.z.object({date:d.z.string().datetime(),isAvailable:d.z.boolean().default(!1),startTime:d.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/).optional(),endTime:d.z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/).optional(),reason:d.z.string().optional()}),h=(0,n.withAuth)(async(e,t)=>{let r=t.user.id,{searchParams:n}=new URL(e.url),d=n.get("start"),c=n.get("end");try{let e=[(0,s.eq)(o.calendarException.tutorId,r)];d&&e.push((0,s.gte)(o.calendarException.date,new Date(d))),c&&e.push((0,s.lte)(o.calendarException.date,new Date(c)));let t=await i.drizzleDb.select().from(o.calendarException).where((0,s.and)(...e)).orderBy((0,l.asc)(o.calendarException.date));return a.NextResponse.json({exceptions:t})}catch(e){return console.error("Fetch exceptions error:",e),a.NextResponse.json({error:"Failed to fetch exceptions"},{status:500})}},{role:"TUTOR"}),x=(0,n.withAuth)(async(e,t)=>{let r=t.user.id;try{let t=await e.json(),n=p.safeParse(t);if(!n.success)return a.NextResponse.json({error:"Invalid request",details:n.error.format()},{status:400});let l=n.data;if(l.startTime&&l.endTime&&l.startTime>=l.endTime)return a.NextResponse.json({error:"End time must be after start time"},{status:400});let d=new Date(l.date);d.setUTCHours(0,0,0,0);let u=l.startTime??null,h=l.endTime??null,x=null===u?(0,s.and)((0,s.eq)(o.calendarException.tutorId,r),(0,s.eq)(o.calendarException.date,d),(0,s.isNull)(o.calendarException.startTime)):(0,s.and)((0,s.eq)(o.calendarException.tutorId,r),(0,s.eq)(o.calendarException.date,d),(0,s.eq)(o.calendarException.startTime,u)),[R]=await i.drizzleDb.select().from(o.calendarException).where(x).limit(1);if(R){let[e]=await i.drizzleDb.update(o.calendarException).set({isAvailable:l.isAvailable,reason:l.reason??R.reason}).where((0,s.eq)(o.calendarException.id,R.id)).returning();return a.NextResponse.json({exception:e})}let[E]=await i.drizzleDb.insert(o.calendarException).values({id:(0,c.nanoid)(),tutorId:r,date:d,isAvailable:l.isAvailable,startTime:u,endTime:h,reason:l.reason}).returning();return a.NextResponse.json({exception:E},{status:201})}catch(e){if("23505"===e.code)return a.NextResponse.json({error:"Exception already exists for this date and time"},{status:409});return console.error("Create exception error:",e),a.NextResponse.json({error:"Failed to create exception"},{status:500})}},{role:"TUTOR"}),R=(0,n.withAuth)(async(e,t)=>{let r=t.user.id;try{let{dates:t,isAvailable:n=!1,reason:l}=await e.json();if(!Array.isArray(t)||0===t.length)return a.NextResponse.json({error:"Dates array is required"},{status:400});let d=[];for(let e of t){let t=new Date(e);t.setUTCHours(0,0,0,0);let[a]=await i.drizzleDb.select().from(o.calendarException).where((0,s.and)((0,s.eq)(o.calendarException.tutorId,r),(0,s.eq)(o.calendarException.date,t),(0,s.isNull)(o.calendarException.startTime))).limit(1);if(a){let[e]=await i.drizzleDb.update(o.calendarException).set({isAvailable:n,reason:l}).where((0,s.eq)(o.calendarException.id,a.id)).returning();e&&d.push(e)}else{let[e]=await i.drizzleDb.insert(o.calendarException).values({id:(0,c.nanoid)(),tutorId:r,date:t,isAvailable:n,reason:l}).returning();e&&d.push(e)}}return a.NextResponse.json({exceptions:d,count:d.length})}catch(e){return console.error("Bulk create exceptions error:",e),a.NextResponse.json({error:"Failed to create exceptions"},{status:500})}},{role:"TUTOR"});e.s(["GET",0,h,"POST",0,x,"PUT",0,R]),r()}catch(e){r(e)}},!1),159141,e=>e.a(async(t,r)=>{try{var a=e.i(78315),n=e.i(586961),i=e.i(196657),o=e.i(899733),s=e.i(233979),l=e.i(631683),d=e.i(840960),c=e.i(711373),u=e.i(699699),p=e.i(521140),h=e.i(205260),x=e.i(500249),R=e.i(431740),E=e.i(82608),m=e.i(635207),w=e.i(193695);e.i(708038);var f=e.i(447430),v=e.i(663176),g=t([v]);[v]=g.then?(await g)():g;let A=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/tutor/calendar/exceptions/route",pathname:"/api/tutor/calendar/exceptions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/calendar/exceptions/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:C,workUnitAsyncStorage:b,serverHooks:N}=A;function T(){return(0,i.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:b})}async function y(e,t,r){A.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/tutor/calendar/exceptions/route";a=a.replace(/\/index$/,"")||"/";let i=await A.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:g,nextConfig:T,parsedUrl:y,isDraftMode:C,prerenderManifest:b,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:q,resolvedPathname:D,clientReferenceManifest:O,serverActionsManifest:U}=i,j=(0,d.normalizeAppPath)(a),z=!!(b.dynamicRoutes[j]||b.routes[D]),S=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,y,!1):t.end("This page could not be found"),null);if(z&&!C){let e=!!b.routes[D],t=b.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await S();throw new w.NoFallbackError}}let _=null;!z||A.isDev||C||(_=D,_="/index"===_?"/":_);let I=!0===A.isDev||!z,H=z&&!I;U&&O&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:O,serverActionsManifest:U});let k=e.method||"GET",M=(0,s.getTracer)(),F=M.getActiveScopeSpan(),$={params:g,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>A.onRequestError(e,t,a,n,N)},sharedContext:{buildId:v}},K=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),L=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let i=async e=>A.handle(L,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${k} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var s,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&P&&q&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(o);e.fetchMetrics=$.renderOpts.fetchMetrics;let s=$.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=$.renderOpts.collectedTags;if(!z)return await (0,x.sendResponse)(K,B,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})},!1,N),t}},u=await A.handleResponse({req:e,nextConfig:T,cacheKey:_,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:q,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!z)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,R.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&z||p.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,E.getCacheControlHeader)(u.cacheControl)),await (0,x.sendResponse)(K,B,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};F?await d(F):await M.withPropagatedContext(e.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${k} ${a}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},d))}catch(t){if(t instanceof w.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})},!1,N),z)throw t;return await (0,x.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>y,"patchFetch",()=>T,"routeModule",()=>A,"serverHooks",()=>N,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>b]),r()}catch(e){r(e)}},!1)];

//# debugId=cb2c7b7e-93b2-32bb-6a05-44132236a47e
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_867f589f._.js.map