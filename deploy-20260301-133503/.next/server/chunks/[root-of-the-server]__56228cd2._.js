;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1c493be3-63e3-7f33-d64d-527d002d2b9f")}catch(e){}}();
module.exports=[386053,e=>e.a(async(t,r)=>{try{var u=e.i(620971),i=e.i(384030),n=e.i(738597);e.i(688768);var l=e.i(257357),a=e.i(909105),s=e.i(997103),o=e.i(320947),c=t([i,n]);[i,n]=c.then?(await c)():c;let d=(0,i.withAuth)(async(e,t)=>{let{curriculumId:r}=await e.json().catch(()=>({}));if(!r||"string"!=typeof r)return u.NextResponse.json({error:"Curriculum ID is required"},{status:400});let[s]=await n.drizzleDb.select().from(l.curriculum).where((0,a.eq)(l.curriculum.id,r)).limit(1);if(!s)throw new i.NotFoundError("Course not found");if(s.price&&s.price>0&&!(await n.drizzleDb.select().from(l.payment).where((0,a.inArray)(l.payment.status,["COMPLETED","PENDING"]))).some(e=>{let u=e.metadata;return u?.curriculumId===r&&u?.studentId===t.user.id}))return u.NextResponse.json({error:"Payment required",requiresPayment:!0,amount:s.price,currency:s.currency||"USD"},{status:402});let c=(await n.drizzleDb.select({id:l.curriculumModule.id}).from(l.curriculumModule).where((0,a.eq)(l.curriculumModule.curriculumId,r))).map(e=>e.id),d=0===c.length?0:(await n.drizzleDb.select({count:o.sql`count(*)::int`}).from(l.curriculumLesson).where((0,a.inArray)(l.curriculumLesson.moduleId,c)))[0]?.count??0,[m]=await n.drizzleDb.select().from(l.curriculumProgress).where((0,a.and)((0,a.eq)(l.curriculumProgress.studentId,t.user.id),(0,a.eq)(l.curriculumProgress.curriculumId,r))).limit(1);if(m)return u.NextResponse.json({success:!0,message:"Already enrolled",progress:m});let p=crypto.randomUUID(),h=crypto.randomUUID();await n.drizzleDb.insert(l.curriculumEnrollment).values({id:p,studentId:t.user.id,curriculumId:r,lessonsCompleted:0,enrollmentSource:"browse"}),await n.drizzleDb.insert(l.curriculumProgress).values({id:h,studentId:t.user.id,curriculumId:r,lessonsCompleted:0,totalLessons:d,isCompleted:!1});let[w]=await n.drizzleDb.select().from(l.curriculumEnrollment).where((0,a.eq)(l.curriculumEnrollment.id,p)).limit(1),[f]=await n.drizzleDb.select().from(l.curriculumProgress).where((0,a.eq)(l.curriculumProgress.id,h)).limit(1);return u.NextResponse.json({success:!0,message:"Enrolled successfully",enrollment:w,progress:f})}),m=(0,i.withAuth)(async(e,t)=>{let r=await n.drizzleDb.select({enrollment:l.curriculumEnrollment,curriculumId:l.curriculum.id,curriculumName:l.curriculum.name,curriculumSubject:l.curriculum.subject,curriculumDescription:l.curriculum.description,curriculumDifficulty:l.curriculum.difficulty,curriculumEstimatedHours:l.curriculum.estimatedHours,curriculumIsPublished:l.curriculum.isPublished}).from(l.curriculumEnrollment).innerJoin(l.curriculum,(0,a.eq)(l.curriculumEnrollment.curriculumId,l.curriculum.id)).where((0,a.eq)(l.curriculumEnrollment.studentId,t.user.id)).orderBy((0,s.desc)(l.curriculumEnrollment.enrolledAt)),i=await Promise.all(r.map(async e=>{let[{count:t}]=await n.drizzleDb.select({count:o.sql`count(*)::int`}).from(l.curriculumModule).where((0,a.eq)(l.curriculumModule.curriculumId,e.curriculumId));return{curriculumId:e.curriculumId,moduleCount:t??0}})),c=new Map(i.map(e=>[e.curriculumId,e.moduleCount])),d=r.map(e=>({...e.enrollment,curriculum:{id:e.curriculumId,name:e.curriculumName,subject:e.curriculumSubject,description:e.curriculumDescription,difficulty:e.curriculumDifficulty,estimatedHours:e.curriculumEstimatedHours,isPublished:e.curriculumIsPublished,_count:{modules:c.get(e.curriculumId)??0}}}));return u.NextResponse.json({enrollments:d})});e.s(["GET",0,m,"POST",0,d]),r()}catch(e){r(e)}},!1),980174,e=>e.a(async(t,r)=>{try{var u=e.i(78315),i=e.i(586961),n=e.i(196657),l=e.i(899733),a=e.i(233979),s=e.i(631683),o=e.i(840960),c=e.i(711373),d=e.i(699699),m=e.i(521140),p=e.i(205260),h=e.i(500249),w=e.i(431740),f=e.i(82608),R=e.i(635207),E=e.i(193695);e.i(708038);var v=e.i(447430),y=e.i(386053),g=t([y]);[y]=g.then?(await g)():g;let P=new u.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/student/enrollments/route",pathname:"/api/student/enrollments",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/student/enrollments/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:_,workUnitAsyncStorage:A,serverHooks:I}=P;function C(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:A})}async function b(e,t,r){P.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let u="/api/student/enrollments/route";u=u.replace(/\/index$/,"")||"/";let n=await P.prepare(e,t,{srcPage:u,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:g,nextConfig:C,parsedUrl:b,isDraftMode:_,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:x,revalidateOnlyGenerated:D,resolvedPathname:N,clientReferenceManifest:T,serverActionsManifest:q}=n,S=(0,o.normalizeAppPath)(u),O=!!(A.dynamicRoutes[S]||A.routes[N]),z=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,b,!1):t.end("This page could not be found"),null);if(O&&!_){let e=!!A.routes[N],t=A.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await z();throw new E.NoFallbackError}}let M=null;!O||P.isDev||_||(M=N,M="/index"===M?"/":M);let H=!0===P.isDev||!O,U=O&&!H;q&&T&&(0,s.setManifestsSingleton)({page:u,clientReferenceManifest:T,serverActionsManifest:q});let j=e.method||"GET",k=(0,a.getTracer)(),K=k.getActiveScopeSpan(),F={params:g,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,l.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,u,i)=>P.onRequestError(e,t,u,i,I)},sharedContext:{buildId:y}},$=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let n=async e=>P.handle(B,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${u}`)}),s=!!(0,l.getRequestMeta)(e,"minimalMode"),o=async l=>{var a,o;let c=async({previousCacheEntry:i})=>{try{if(!s&&x&&D&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let u=await n(l);e.fetchMetrics=F.renderOpts.fetchMetrics;let a=F.renderOpts.pendingWaitUntil;a&&r.waitUntil&&(r.waitUntil(a),a=void 0);let o=F.renderOpts.collectedTags;if(!O)return await (0,h.sendResponse)($,L,u,F.renderOpts.pendingWaitUntil),null;{let e=await u.blob(),t=(0,w.toNodeOutgoingHttpHeaders)(u.headers);o&&(t[R.NEXT_CACHE_TAGS_HEADER]=o),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:u.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:u,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,I),t}},d=await P.handleResponse({req:e,nextConfig:C,cacheKey:M,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:D,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:s});if(!O)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(o=d.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",x?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,w.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&O||m.delete(R.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)($,L,new Response(d.value.body,{headers:m,status:d.value.status||200})),null};K?await o(K):await k.withPropagatedContext(e.headers,()=>k.trace(m.BaseServerSpan.handleRequest,{spanName:`${j} ${u}`,kind:a.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},o))}catch(t){if(t instanceof E.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,I),O)throw t;return await (0,h.sendResponse)($,L,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>C,"routeModule",()=>P,"serverHooks",()=>I,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>A]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=1c493be3-63e3-7f33-d64d-527d002d2b9f
//# sourceMappingURL=%5Broot-of-the-server%5D__56228cd2._.js.map