;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="eb0148e6-8444-09ed-fe46-bbeaa3d6efa5")}catch(e){}}();
module.exports=[715478,e=>e.a(async(t,o)=>{try{var r=e.i(620971),s=e.i(8235),l=e.i(908286),n=e.i(738597);e.i(688768);var a=e.i(257357),i=e.i(909105),p=e.i(997103),d=e.i(841195),u=t([s,n]);async function c(e,t){try{let o=await (0,s.getServerSession)(s.authOptions,e);if(!o?.user)return r.NextResponse.json({error:"Unauthorized"},{status:401});let d=await (0,l.getParamAsync)(t?.params,"pollId");if(!d)return r.NextResponse.json({error:"Poll ID required"},{status:400});let[u]=await n.drizzleDb.select().from(a.poll).where((0,i.eq)(a.poll.id,d)).limit(1);if(!u)return r.NextResponse.json({error:"Poll not found"},{status:404});let c=await n.drizzleDb.select().from(a.pollOption).where((0,i.eq)(a.pollOption.pollId,d)).orderBy((0,p.asc)(a.pollOption.label)),R=await n.drizzleDb.select({id:a.pollResponse.id,optionIds:a.pollResponse.optionIds,rating:a.pollResponse.rating,textAnswer:a.pollResponse.textAnswer,studentId:a.pollResponse.studentId,createdAt:a.pollResponse.createdAt}).from(a.pollResponse).where((0,i.eq)(a.pollResponse.pollId,d)),h={...u,options:c,responses:u.isAnonymous?R.map(e=>({...e,studentId:void 0})):R,totalResponses:R.length};return r.NextResponse.json({poll:h})}catch(e){return console.error("Failed to fetch poll:",e),r.NextResponse.json({error:"Failed to fetch poll"},{status:500})}}[s,n]=u.then?(await u)():u;let w=d.z.object({status:d.z.enum(["DRAFT","ACTIVE","CLOSED"]).optional(),question:d.z.string().min(1).max(500).optional(),showResults:d.z.boolean().optional()});async function R(e,t){try{let o=await (0,s.getServerSession)(s.authOptions,e);if(!o?.user||"TUTOR"!==o.user.role)return r.NextResponse.json({error:"Unauthorized"},{status:401});let p=await (0,l.getParamAsync)(t?.params,"pollId");if(!p)return r.NextResponse.json({error:"Poll ID required"},{status:400});let d=await e.json(),u=w.parse(d),c={};if(u.status&&(c.status=u.status,"ACTIVE"===u.status?c.startedAt=new Date:"CLOSED"===u.status&&(c.endedAt=new Date)),void 0!==u.question&&(c.question=u.question),void 0!==u.showResults&&(c.showResults=u.showResults),0===Object.keys(c).length){let[e]=await n.drizzleDb.select().from(a.poll).where((0,i.eq)(a.poll.id,p)).limit(1);if(!e)return r.NextResponse.json({error:"Poll not found"},{status:404});let t=await n.drizzleDb.select().from(a.pollOption).where((0,i.eq)(a.pollOption.pollId,p)),o=await n.drizzleDb.select({id:a.pollResponse.id,optionIds:a.pollResponse.optionIds,rating:a.pollResponse.rating,textAnswer:a.pollResponse.textAnswer,createdAt:a.pollResponse.createdAt}).from(a.pollResponse).where((0,i.eq)(a.pollResponse.pollId,p));return r.NextResponse.json({poll:{...e,options:t,responses:o}})}await n.drizzleDb.update(a.poll).set(c).where((0,i.eq)(a.poll.id,p));let[R]=await n.drizzleDb.select().from(a.poll).where((0,i.eq)(a.poll.id,p)).limit(1),h=await n.drizzleDb.select().from(a.pollOption).where((0,i.eq)(a.pollOption.pollId,p)),f=await n.drizzleDb.select({id:a.pollResponse.id,optionIds:a.pollResponse.optionIds,rating:a.pollResponse.rating,textAnswer:a.pollResponse.textAnswer,createdAt:a.pollResponse.createdAt}).from(a.pollResponse).where((0,i.eq)(a.pollResponse.pollId,p));return r.NextResponse.json({poll:{...R,options:h,responses:f}})}catch(e){if(e instanceof d.z.ZodError)return r.NextResponse.json({error:"Invalid input",details:e.issues},{status:400});return console.error("Failed to update poll:",e),r.NextResponse.json({error:"Failed to update poll"},{status:500})}}async function h(e,t){try{let o=await (0,s.getServerSession)(s.authOptions,e);if(!o?.user||"TUTOR"!==o.user.role)return r.NextResponse.json({error:"Unauthorized"},{status:401});let p=await (0,l.getParamAsync)(t?.params,"pollId");if(!p)return r.NextResponse.json({error:"Poll ID required"},{status:400});return await n.drizzleDb.delete(a.pollResponse).where((0,i.eq)(a.pollResponse.pollId,p)),await n.drizzleDb.delete(a.pollOption).where((0,i.eq)(a.pollOption.pollId,p)),await n.drizzleDb.delete(a.poll).where((0,i.eq)(a.poll.id,p)),r.NextResponse.json({success:!0})}catch(e){return console.error("Failed to delete poll:",e),r.NextResponse.json({error:"Failed to delete poll"},{status:500})}}e.s(["DELETE",()=>h,"GET",()=>c,"PATCH",()=>R]),o()}catch(e){o(e)}},!1),879782,e=>e.a(async(t,o)=>{try{var r=e.i(78315),s=e.i(586961),l=e.i(196657),n=e.i(899733),a=e.i(233979),i=e.i(631683),p=e.i(840960),d=e.i(711373),u=e.i(699699),c=e.i(521140),R=e.i(205260),h=e.i(500249),w=e.i(431740),f=e.i(82608),m=e.i(635207),x=e.i(193695);e.i(708038);var v=e.i(447430),A=e.i(715478),g=t([A]);[A]=g.then?(await g)():g;let y=new r.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/polls/[pollId]/route",pathname:"/api/polls/[pollId]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/polls/[pollId]/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:C,workUnitAsyncStorage:N,serverHooks:O}=y;function E(){return(0,l.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:N})}async function I(e,t,o){y.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/polls/[pollId]/route";r=r.replace(/\/index$/,"")||"/";let l=await y.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!l)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:A,params:g,nextConfig:E,parsedUrl:I,isDraftMode:C,prerenderManifest:N,routerServerContext:O,isOnDemandRevalidate:b,revalidateOnlyGenerated:D,resolvedPathname:z,clientReferenceManifest:T,serverActionsManifest:q}=l,P=(0,p.normalizeAppPath)(r),S=!!(N.dynamicRoutes[P]||N.routes[z]),j=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,I,!1):t.end("This page could not be found"),null);if(S&&!C){let e=!!N.routes[z],t=N.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await j();throw new x.NoFallbackError}}let U=null;!S||y.isDev||C||(U=z,U="/index"===U?"/":U);let _=!0===y.isDev||!S,H=S&&!_;q&&T&&(0,i.setManifestsSingleton)({page:r,clientReferenceManifest:T,serverActionsManifest:q});let k=e.method||"GET",F=(0,a.getTracer)(),M=F.getActiveScopeSpan(),K={params:g,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,r,s)=>y.onRequestError(e,t,r,s,O)},sharedContext:{buildId:A}},$=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let l=async e=>y.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=F.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=o.get("next.route");if(s){let t=`${k} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${r}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),p=async n=>{var a,p;let d=async({previousCacheEntry:s})=>{try{if(!i&&b&&D&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await l(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let a=K.renderOpts.pendingWaitUntil;a&&o.waitUntil&&(o.waitUntil(a),a=void 0);let p=K.renderOpts.collectedTags;if(!S)return await (0,h.sendResponse)($,L,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,w.toNodeOutgoingHttpHeaders)(r.headers);p&&(t[m.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,s=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,R.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:b})},!1,O),t}},u=await y.handleResponse({req:e,nextConfig:E,cacheKey:U,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:D,responseGenerator:d,waitUntil:o.waitUntil,isMinimalMode:i});if(!S)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(p=u.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",b?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,w.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&S||c.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)($,L,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};M?await p(M):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${r}`,kind:a.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},p))}catch(t){if(t instanceof x.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,R.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:b})},!1,O),S)throw t;return await (0,h.sendResponse)($,L,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>E,"routeModule",()=>y,"serverHooks",()=>O,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>N]),o()}catch(e){o(e)}},!1)];

//# debugId=eb0148e6-8444-09ed-fe46-bbeaa3d6efa5
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_87dd73a6._.js.map