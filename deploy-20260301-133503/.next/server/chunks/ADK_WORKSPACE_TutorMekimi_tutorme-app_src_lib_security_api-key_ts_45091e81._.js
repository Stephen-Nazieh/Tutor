;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1cad83f9-13b1-1167-eff9-4416693dcedd")}catch(e){}}();
module.exports=[175922,e=>e.a(async(t,i)=>{try{var a=e.i(254799),r=e.i(997103),d=e.i(909105),n=e.i(738597);e.i(688768);var y=e.i(257357),s=t([n]);function l(e){return a.default.createHash("sha256").update(e).digest("hex")}async function u(e,t){let i=a.default.randomBytes(32).toString("base64url"),r="tm_"+i,d=l(r),[s]=await n.drizzleDb.insert(y.apiKey).values({id:a.default.randomUUID(),name:e,keyHash:d,createdById:t}).returning();if(!s)throw Error("Failed to create API key");return{id:s.id,name:s.name,key:r}}async function c(e){if(!e.startsWith("tm_"))return null;let t=l(e),[i]=await n.drizzleDb.select().from(y.apiKey).where((0,d.eq)(y.apiKey.keyHash,t)).limit(1);return i?(await n.drizzleDb.update(y.apiKey).set({lastUsedAt:new Date}).where((0,d.eq)(y.apiKey.id,i.id)),{id:i.id}):null}async function p(e){return(await n.drizzleDb.delete(y.apiKey).where((0,d.eq)(y.apiKey.id,e)).returning({id:y.apiKey.id})).length>0}async function K(e){let t=n.drizzleDb.select({id:y.apiKey.id,name:y.apiKey.name,createdAt:y.apiKey.createdAt,lastUsedAt:y.apiKey.lastUsedAt}).from(y.apiKey).orderBy((0,r.desc)(y.apiKey.createdAt));return e?t.where((0,d.eq)(y.apiKey.createdById,e)):t}[n]=s.then?(await s)():s,e.s(["createApiKey",()=>u,"listApiKeys",()=>K,"revokeApiKey",()=>p,"verifyApiKey",()=>c]),i()}catch(e){i(e)}},!1)];

//# debugId=1cad83f9-13b1-1167-eff9-4416693dcedd
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js.map