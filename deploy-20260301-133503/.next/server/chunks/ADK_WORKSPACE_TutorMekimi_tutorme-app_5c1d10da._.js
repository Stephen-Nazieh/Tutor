;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bb3f1d2f-0f51-b465-acdd-5c1b84cbdd1a")}catch(e){}}();
module.exports=[273155,e=>e.a(async(t,r)=>{try{var n=e.i(620971),a=e.i(384030),i=e.i(908286),l=e.i(738597);e.i(688768);var o=e.i(257357),s=e.i(909105),d=e.i(841195),u=t([a,l]);[a,l]=u.then?(await u)():u;let c=d.z.object({title:d.z.string().min(1).optional(),description:d.z.string().optional(),type:d.z.enum(["LESSON","CLINIC","CONSULTATION","BREAK","PERSONAL","OTHER"]).optional(),startTime:d.z.string().datetime().optional(),endTime:d.z.string().datetime().optional(),timezone:d.z.string().optional(),isAllDay:d.z.boolean().optional(),location:d.z.string().optional(),meetingUrl:d.z.string().optional(),isVirtual:d.z.boolean().optional(),curriculumId:d.z.string().optional().nullable(),batchId:d.z.string().optional().nullable(),studentId:d.z.string().optional().nullable(),maxAttendees:d.z.number().min(1).optional(),attendees:d.z.array(d.z.object({userId:d.z.string().optional(),email:d.z.string(),name:d.z.string(),status:d.z.enum(["pending","accepted","declined"]).default("pending")})).optional(),reminders:d.z.array(d.z.object({minutes:d.z.number(),type:d.z.enum(["email","push","sms"])})).optional(),color:d.z.string().optional(),status:d.z.enum(["CONFIRMED","TENTATIVE","CANCELLED"]).optional(),isCancelled:d.z.boolean().optional()}),p=(0,a.withAuth)(async(e,t,r)=>{let a=await (0,i.getParamAsync)(r?.params,"id");if(!a)return n.NextResponse.json({error:"Event ID required"},{status:400});let d=t.user.id;try{let[e]=await l.drizzleDb.select({event:o.calendarEvent,curriculumId:o.curriculum.id,curriculumName:o.curriculum.name,curriculumSubject:o.curriculum.subject,batchId:o.courseBatch.id,batchName:o.courseBatch.name}).from(o.calendarEvent).leftJoin(o.curriculum,(0,s.eq)(o.calendarEvent.curriculumId,o.curriculum.id)).leftJoin(o.courseBatch,(0,s.eq)(o.calendarEvent.batchId,o.courseBatch.id)).where((0,s.and)((0,s.eq)(o.calendarEvent.id,a),(0,s.eq)(o.calendarEvent.tutorId,d),(0,s.isNull)(o.calendarEvent.deletedAt))).limit(1);if(!e)return n.NextResponse.json({error:"Event not found"},{status:404});let t={...e.event,curriculum:e.curriculumId?{id:e.curriculumId,name:e.curriculumName,subject:e.curriculumSubject}:null,batch:e.batchId?{id:e.batchId,name:e.batchName}:null};return n.NextResponse.json({event:t})}catch(e){return console.error("Fetch event error:",e),n.NextResponse.json({error:"Failed to fetch event"},{status:500})}},{role:"TUTOR"}),m=(0,a.withAuth)(async(e,t,r)=>{let a=await (0,i.getParamAsync)(r?.params,"id");if(!a)return n.NextResponse.json({error:"Event ID required"},{status:400});let d=t.user.id;try{let t=await e.json(),r=c.safeParse(t);if(!r.success)return n.NextResponse.json({error:"Invalid request",details:r.error.format()},{status:400});let i=r.data,[u]=await l.drizzleDb.select().from(o.calendarEvent).where((0,s.and)((0,s.eq)(o.calendarEvent.id,a),(0,s.eq)(o.calendarEvent.tutorId,d),(0,s.isNull)(o.calendarEvent.deletedAt))).limit(1);if(!u)return n.NextResponse.json({error:"Event not found"},{status:404});if((i.startTime||i.endTime)&&"PERSONAL"!==u.type){let e=i.startTime?new Date(i.startTime):u.startTime,t=i.endTime?new Date(i.endTime):u.endTime,r=await l.drizzleDb.select().from(o.calendarEvent).where((0,s.and)((0,s.eq)(o.calendarEvent.tutorId,d),(0,s.ne)(o.calendarEvent.id,a),(0,s.isNull)(o.calendarEvent.deletedAt),(0,s.eq)(o.calendarEvent.isCancelled,!1),(0,s.lt)(o.calendarEvent.startTime,t),(0,s.gt)(o.calendarEvent.endTime,e)));if(r.length>0)return n.NextResponse.json({error:"Schedule conflict detected",conflicts:r.map(e=>({id:e.id,title:e.title,startTime:e.startTime,endTime:e.endTime}))},{status:409})}let p={};void 0!==i.title&&(p.title=i.title),void 0!==i.description&&(p.description=i.description),void 0!==i.type&&(p.type=i.type),void 0!==i.startTime&&(p.startTime=new Date(i.startTime)),void 0!==i.endTime&&(p.endTime=new Date(i.endTime)),void 0!==i.timezone&&(p.timezone=i.timezone),void 0!==i.isAllDay&&(p.isAllDay=i.isAllDay),void 0!==i.location&&(p.location=i.location),void 0!==i.meetingUrl&&(p.meetingUrl=i.meetingUrl),void 0!==i.isVirtual&&(p.isVirtual=i.isVirtual),void 0!==i.curriculumId&&(p.curriculumId=i.curriculumId),void 0!==i.batchId&&(p.batchId=i.batchId),void 0!==i.studentId&&(p.studentId=i.studentId),void 0!==i.maxAttendees&&(p.maxAttendees=i.maxAttendees),void 0!==i.attendees&&(p.attendees=i.attendees),void 0!==i.reminders&&(p.reminders=i.reminders),void 0!==i.color&&(p.color=i.color),void 0!==i.status&&(p.status=i.status),void 0!==i.isCancelled&&(p.isCancelled=i.isCancelled);let[m]=await l.drizzleDb.update(o.calendarEvent).set(p).where((0,s.eq)(o.calendarEvent.id,a)).returning();if(!m)return n.NextResponse.json({error:"Failed to update event"},{status:500});let[v]=m.curriculumId?await l.drizzleDb.select({id:o.curriculum.id,name:o.curriculum.name,subject:o.curriculum.subject}).from(o.curriculum).where((0,s.eq)(o.curriculum.id,m.curriculumId)).limit(1):[null],[h]=m.batchId?await l.drizzleDb.select({id:o.courseBatch.id,name:o.courseBatch.name}).from(o.courseBatch).where((0,s.eq)(o.courseBatch.id,m.batchId)).limit(1):[null],E={...m,curriculum:v?{id:v.id,name:v.name,subject:v.subject}:null,batch:h?{id:h.id,name:h.name}:null};return n.NextResponse.json({event:E})}catch(e){return console.error("Update event error:",e),n.NextResponse.json({error:"Failed to update event"},{status:500})}},{role:"TUTOR"}),v=(0,a.withAuth)(async(e,t,r)=>{let a=await (0,i.getParamAsync)(r?.params,"id");if(!a)return n.NextResponse.json({error:"Event ID required"},{status:400});let d=t.user.id,{searchParams:u}=new URL(e.url),c="true"===u.get("series");try{let[e]=await l.drizzleDb.select().from(o.calendarEvent).where((0,s.and)((0,s.eq)(o.calendarEvent.id,a),(0,s.eq)(o.calendarEvent.tutorId,d),(0,s.isNull)(o.calendarEvent.deletedAt))).limit(1);if(!e)return n.NextResponse.json({error:"Event not found"},{status:404});let t=new Date;if(c&&e.isRecurring)return await l.drizzleDb.update(o.calendarEvent).set({deletedAt:t,isCancelled:!0}).where((0,s.and)((0,s.eq)(o.calendarEvent.tutorId,d),(0,s.or)((0,s.eq)(o.calendarEvent.id,a),(0,s.eq)(o.calendarEvent.recurringEventId,a)))),n.NextResponse.json({message:"Recurring event series deleted",deletedCount:"multiple"});return await l.drizzleDb.update(o.calendarEvent).set({deletedAt:t,isCancelled:!0}).where((0,s.eq)(o.calendarEvent.id,a)),n.NextResponse.json({message:"Event deleted successfully",deletedCount:1})}catch(e){return console.error("Delete event error:",e),n.NextResponse.json({error:"Failed to delete event"},{status:500})}},{role:"TUTOR"});e.s(["DELETE",0,v,"GET",0,p,"PUT",0,m]),r()}catch(e){r(e)}},!1),178241,e=>e.a(async(t,r)=>{try{var n=e.i(78315),a=e.i(586961),i=e.i(196657),l=e.i(899733),o=e.i(233979),s=e.i(631683),d=e.i(840960),u=e.i(711373),c=e.i(699699),p=e.i(521140),m=e.i(205260),v=e.i(500249),h=e.i(431740),E=e.i(82608),R=e.i(635207),f=e.i(193695);e.i(708038);var g=e.i(447430),w=e.i(273155),b=t([w]);[w]=b.then?(await b)():b;let N=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tutor/calendar/events/[id]/route",pathname:"/api/tutor/calendar/events/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/calendar/events/[id]/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:I,workUnitAsyncStorage:y,serverHooks:x}=N;function T(){return(0,i.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:y})}async function A(e,t,r){N.isDev&&(0,l.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/tutor/calendar/events/[id]/route";n=n.replace(/\/index$/,"")||"/";let i=await N.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:b,nextConfig:T,parsedUrl:A,isDraftMode:I,prerenderManifest:y,routerServerContext:x,isOnDemandRevalidate:z,revalidateOnlyGenerated:C,resolvedPathname:D,clientReferenceManifest:j,serverActionsManifest:q}=i,O=(0,d.normalizeAppPath)(n),P=!!(y.dynamicRoutes[O]||y.routes[D]),S=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,A,!1):t.end("This page could not be found"),null);if(P&&!I){let e=!!y.routes[D],t=y.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await S();throw new f.NoFallbackError}}let U=null;!P||N.isDev||I||(U=D,U="/index"===U?"/":U);let _=!0===N.isDev||!P,H=P&&!_;q&&j&&(0,s.setManifestsSingleton)({page:n,clientReferenceManifest:j,serverActionsManifest:q});let k=e.method||"GET",B=(0,o.getTracer)(),F=B.getActiveScopeSpan(),L={params:b,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,l.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>N.onRequestError(e,t,n,a,x)},sharedContext:{buildId:w}},M=new u.NodeNextRequest(e),K=new u.NodeNextResponse(t),$=c.NextRequestAdapter.fromNodeNextRequest(M,(0,c.signalFromNodeResponse)(t));try{let i=async e=>N.handle($,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${n}`)}),s=!!(0,l.getRequestMeta)(e,"minimalMode"),d=async l=>{var o,d;let u=async({previousCacheEntry:a})=>{try{if(!s&&z&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(l);e.fetchMetrics=L.renderOpts.fetchMetrics;let o=L.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let d=L.renderOpts.collectedTags;if(!P)return await (0,v.sendResponse)(M,K,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:z})},!1,x),t}},c=await N.handleResponse({req:e,nextConfig:T,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:z,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:s});if(!P)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",z?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&P||p.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,E.getCacheControlHeader)(c.cacheControl)),await (0,v.sendResponse)(M,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};F?await d(F):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${k} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},d))}catch(t){if(t instanceof f.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:z})},!1,x),P)throw t;return await (0,v.sendResponse)(M,K,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>T,"routeModule",()=>N,"serverHooks",()=>x,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>y]),r()}catch(e){r(e)}},!1)];

//# debugId=bb3f1d2f-0f51-b465-acdd-5c1b84cbdd1a
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_5c1d10da._.js.map