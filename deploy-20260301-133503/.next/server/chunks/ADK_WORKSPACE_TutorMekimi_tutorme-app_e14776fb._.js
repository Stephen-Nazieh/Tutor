;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="17e248a0-01d5-e763-8681-a8847a1298c4")}catch(e){}}();
module.exports=[286080,e=>e.a(async(t,n)=>{try{var r=e.i(620971),i=e.i(8235),o=e.i(738597);e.i(688768);var a=e.i(257357),s=e.i(909105),l=e.i(254799),c=t([i,o]);function d(e,t){if(e<0)return 100;let n=Math.exp(-e/t);return Math.min(100,Math.round(100*n))}function u(e,t,n=24){return 0===e?n:1===e?n*t*1:2===e?n*t*1.5:n*t*Math.pow(1.2,e-2)}function p(e,t,n=.85){let r=-t*Math.log(n),i=new Date(e);return i.setHours(i.getHours()+r),i}async function h(t){try{let n=await (0,i.getServerSession)(i.authOptions,t);if(!n?.user?.id)return r.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let l=n.user.id,c=new Date,h=await o.drizzleDb.select().from(a.contentProgress).where((0,s.eq)(a.contentProgress.studentId,l));if(0===h.length)return r.NextResponse.json({success:!0,data:{subjectCurves:[],upcomingReviews:[],overdueReviews:[],totalDue:0}});let w=[...new Set(h.map(e=>e.contentId))],m=new Map;if(w.length>0)for(let e of(await o.drizzleDb.select({id:a.contentItem.id,title:a.contentItem.title,subject:a.contentItem.subject}).from(a.contentItem).where((0,s.inArray)(a.contentItem.id,w))))m.set(e.id,e);let v=h.map(e=>({...e,content:m.get(e.contentId)?{id:m.get(e.contentId).id,title:m.get(e.contentId).title,subjectId:m.get(e.contentId).subject,subject:{id:m.get(e.contentId).subject,name:m.get(e.contentId).subject,code:m.get(e.contentId).subject,color:"#3B82F6"}}:null})),{desc:R}=await e.A(908994),f=(await o.drizzleDb.select().from(a.quizAttempt).where((0,s.eq)(a.quizAttempt.studentId,l)).orderBy(R(a.quizAttempt.completedAt))).map(e=>({...e,quiz:{contentId:null,subjectId:null}})),g=await o.drizzleDb.select().from(a.reviewSchedule).where((0,s.eq)(a.reviewSchedule.studentId,l)),b=[...new Set(g.map(e=>e.contentId))],I=new Map;if(b.length>0)for(let e of(await o.drizzleDb.select({id:a.contentItem.id,title:a.contentItem.title,subject:a.contentItem.subject}).from(a.contentItem).where((0,s.inArray)(a.contentItem.id,b))))I.set(e.id,e);let x=g.map(e=>{let t=I.get(e.contentId);return{id:e.id,contentId:e.contentId,content:t?{id:t.id,title:t.title,subjectId:t.subject,subject:{id:t.subject,name:t.subject,code:t.subject,color:"#3B82F6"}}:void 0,lastReviewed:e.lastReviewed,nextReview:e.nextReview,stability:e.stability,easeFactor:e.easeFactor,repetitionCount:e.repetitionCount,performance:e.performance}});if(0===x.length){let e=[];for(let t of v)if(t.progress>0&&t.content){let n=f.filter(e=>e.quiz?.contentId===t.contentId&&e.completedAt),r=n.length>0?n.reduce((e,t)=>e+(t.score||0),0)/n.length:70,i=1.3+Math.min(100,r)/100*1.2,o=n.length,a=u(o,i),s=n[0]?.completedAt||t.updatedAt,d=p(s,a);e.push({id:`${l}-${t.contentId}`,contentId:t.contentId,content:t.content,lastReviewed:s,nextReview:d,stability:a,easeFactor:i,repetitionCount:o,performance:r,priority:d<c?"high":d.getTime()-c.getTime()<1728e5?"medium":"low"})}x=e}let j=new Map;for(let e of x){let t=e.content?.subjectId||"general",n=e.content?.subject?.name||"General",r=e.content?.subject?.color||"#3B82F6";j.has(t)||j.set(t,{id:t,name:n,color:r,schedules:[]}),j.get(t)?.schedules.push(e)}let y=[];for(let[e,t]of j){let n={subjectId:e,subjectName:t.name,color:t.color,dataPoints:[]};for(let e=0;e<=30;e++){let r=new Date(c);r.setDate(r.getDate()+e);let i=0,o=!1,a=null;for(let e of t.schedules){let t=new Date(e.lastReviewed),n=(r.getTime()-t.getTime())/36e5;if(new Date(e.nextReview).toDateString()===r.toDateString())o=!0,a={reviewId:e.id,contentTitle:e.content?.title,contentId:e.content?.id},i+=95;else if(n<0)i+=100;else{let t=d(n,e.stability);i+=t}}let s=t.schedules.length>0?Math.round(i/t.schedules.length):0;n.dataPoints.push({day:e,date:r,retention:Math.max(0,Math.min(100,s)),isReviewPoint:o,...a})}y.push(n)}let C=new Date(c.getTime()+12096e5),T=x.filter(e=>e.nextReview>=c&&e.nextReview<=C).sort((e,t)=>e.nextReview.getTime()-t.nextReview.getTime()).slice(0,10).map(e=>({id:e.id,contentId:e.contentId,contentTitle:e.content?.title||"Unknown",subjectId:e.content?.subjectId,subjectName:e.content?.subject?.name||"General",subjectColor:e.content?.subject?.color||"#3B82F6",scheduledFor:e.nextReview,isOverdue:e.nextReview<c,daysUntilDue:Math.ceil((e.nextReview.getTime()-c.getTime())/864e5),currentRetention:d((c.getTime()-new Date(e.lastReviewed).getTime())/36e5,e.stability),repetitionCount:e.repetitionCount,priority:e.priority})),E=x.filter(e=>e.nextReview<c).sort((e,t)=>e.nextReview.getTime()-t.nextReview.getTime()).map(e=>({id:e.id,contentId:e.contentId,contentTitle:e.content?.title||"Unknown",subjectId:e.content?.subjectId,subjectName:e.content?.subject?.name||"General",subjectColor:e.content?.subject?.color||"#3B82F6",scheduledFor:e.nextReview,daysOverdue:Math.floor((c.getTime()-e.nextReview.getTime())/864e5),currentRetention:d((c.getTime()-new Date(e.lastReviewed).getTime())/36e5,e.stability)}));return r.NextResponse.json({success:!0,data:{subjectCurves:y,upcomingReviews:T,overdueReviews:E,totalDue:E.length+T.filter(e=>0===e.daysUntilDue).length}})}catch(e){return console.error("Error fetching review schedule:",e),r.NextResponse.json({success:!1,error:"Failed to fetch review schedule"},{status:500})}}async function w(e){try{let t=await (0,i.getServerSession)(i.authOptions,e);if(!t?.user?.id)return r.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let{contentId:n,performance:c}=await e.json();if(!n)return r.NextResponse.json({success:!1,error:"Content ID required"},{status:400});let d=t.user.id,h=new Date,[w]=await o.drizzleDb.select().from(a.reviewSchedule).where((0,s.and)((0,s.eq)(a.reviewSchedule.studentId,d),(0,s.eq)(a.reviewSchedule.contentId,n))).limit(1);if(!w){let e=1.3+Math.min(100,c||70)/100*1.2,t=u(1,e),i=p(h,t),w=Math.round(t/24),m=l.default.randomUUID();await o.drizzleDb.insert(a.reviewSchedule).values({id:m,studentId:d,contentId:n,lastReviewed:h,nextReview:i,stability:t,easeFactor:e,repetitionCount:1,performance:c??70,interval:w});let[v]=await o.drizzleDb.select().from(a.reviewSchedule).where((0,s.eq)(a.reviewSchedule.id,m)).limit(1);return r.NextResponse.json({success:!0,data:{schedule:v??{id:m,studentId:d,contentId:n,lastReviewed:h,nextReview:i,stability:t,easeFactor:e,repetitionCount:1,performance:c??70,interval:w}}})}let m=w.repetitionCount+1,v=w.easeFactor;void 0!==c&&(c<60?v=Math.max(1.3,w.easeFactor-.2):c>85&&(v=Math.min(2.5,w.easeFactor+.15)));let R=u(m,v,w.stability),f=p(h,R),g=Math.round(R/24);await o.drizzleDb.update(a.reviewSchedule).set({lastReviewed:h,nextReview:f,stability:R,easeFactor:v,repetitionCount:m,performance:void 0!==c?c:w.performance,interval:g}).where((0,s.eq)(a.reviewSchedule.id,w.id));let[b]=await o.drizzleDb.select().from(a.reviewSchedule).where((0,s.eq)(a.reviewSchedule.id,w.id)).limit(1);return r.NextResponse.json({success:!0,data:{schedule:b??w}})}catch(e){return console.error("Error recording review:",e),r.NextResponse.json({success:!1,error:"Failed to record review"},{status:500})}}[i,o]=c.then?(await c)():c,e.s(["GET",()=>h,"POST",()=>w]),n()}catch(e){n(e)}},!1),927789,e=>e.a(async(t,n)=>{try{var r=e.i(78315),i=e.i(586961),o=e.i(196657),a=e.i(899733),s=e.i(233979),l=e.i(631683),c=e.i(840960),d=e.i(711373),u=e.i(699699),p=e.i(521140),h=e.i(205260),w=e.i(500249),m=e.i(431740),v=e.i(82608),R=e.i(635207),f=e.i(193695);e.i(708038);var g=e.i(447430),b=e.i(286080),I=t([b]);[b]=I.then?(await I)():I;let y=new r.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/student/reviews/route",pathname:"/api/student/reviews",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/student/reviews/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:C,workUnitAsyncStorage:T,serverHooks:E}=y;function x(){return(0,o.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:T})}async function j(e,t,n){y.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/student/reviews/route";r=r.replace(/\/index$/,"")||"/";let o=await y.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:b,params:I,nextConfig:x,parsedUrl:j,isDraftMode:C,prerenderManifest:T,routerServerContext:E,isOnDemandRevalidate:D,revalidateOnlyGenerated:A,resolvedPathname:S,clientReferenceManifest:N,serverActionsManifest:M}=o,P=(0,c.normalizeAppPath)(r),q=!!(T.dynamicRoutes[P]||T.routes[S]),z=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,j,!1):t.end("This page could not be found"),null);if(q&&!C){let e=!!T.routes[S],t=T.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await z();throw new f.NoFallbackError}}let O=null;!q||y.isDev||C||(O=S,O="/index"===O?"/":O);let U=!0===y.isDev||!q,F=q&&!U;M&&N&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:N,serverActionsManifest:M});let _=e.method||"GET",H=(0,s.getTracer)(),k=H.getActiveScopeSpan(),B={params:I,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,i)=>y.onRequestError(e,t,r,i,E)},sharedContext:{buildId:b}},$=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let o=async e=>y.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=H.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=n.get("next.route");if(i){let t=`${_} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${_} ${r}`)}),l=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var s,c;let d=async({previousCacheEntry:i})=>{try{if(!l&&D&&A&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let c=B.renderOpts.collectedTags;if(!q)return await (0,w.sendResponse)($,K,r,B.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[R.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,i=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:D})},!1,E),t}},u=await y.handleResponse({req:e,nextConfig:x,cacheKey:O,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:A,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:l});if(!q)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",D?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&q||p.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,v.getCacheControlHeader)(u.cacheControl)),await (0,w.sendResponse)($,K,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};k?await c(k):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${_} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":_,"http.target":e.url}},c))}catch(t){if(t instanceof f.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:D})},!1,E),q)throw t;return await (0,w.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>x,"routeModule",()=>y,"serverHooks",()=>E,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>T]),n()}catch(e){n(e)}},!1)];

//# debugId=17e248a0-01d5-e763-8681-a8847a1298c4
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_e14776fb._.js.map