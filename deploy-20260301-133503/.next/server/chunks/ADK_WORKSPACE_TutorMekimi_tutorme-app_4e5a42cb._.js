;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="4bf9c9b9-dc9d-4218-2b0d-174f46a97f14")}catch(e){}}();
module.exports=[568611,e=>e.a(async(t,r)=>{try{var a=e.i(620971),o=e.i(384030),i=e.i(738597);e.i(688768);var n=e.i(257357),s=e.i(909105),d=e.i(997103),l=e.i(320947),u=e.i(841195),c=t([o,i]);[o,i]=c.then?(await c)():c;let h=u.z.object({title:u.z.string().min(1),description:u.z.string().optional(),sessionId:u.z.string().optional(),roomId:u.z.string().optional(),curriculumId:u.z.string().optional(),lessonId:u.z.string().optional(),isTemplate:u.z.boolean().default(!1),isPublic:u.z.boolean().default(!1),width:u.z.number().default(1e4),height:u.z.number().default(1e4),backgroundColor:u.z.string().default("#ffffff"),backgroundStyle:u.z.enum(["solid","grid","dots","lines"]).default("solid")}),p=(0,o.withAuth)(async(e,t)=>{let r=t.user.id,{searchParams:o}=new URL(e.url),u=o.get("sessionId"),c=o.get("roomId"),h=o.get("isTemplate"),p=Math.min(parseInt(o.get("limit")||"50",10),100);try{let e=[(0,s.eq)(n.whiteboard.tutorId,r),(0,s.isNull)(n.whiteboard.deletedAt),...u?[(0,s.eq)(n.whiteboard.sessionId,u)]:[],...c?[(0,s.eq)(n.whiteboard.roomId,c)]:[],...null!==h&&""!==h?[(0,s.eq)(n.whiteboard.isTemplate,"true"===h)]:[]].filter(Boolean),t=await i.drizzleDb.select().from(n.whiteboard).where((0,s.and)(...e)).orderBy((0,d.desc)(n.whiteboard.updatedAt)).limit(p),o=t.map(e=>e.id),[w,b]=await Promise.all([o.length?i.drizzleDb.select({whiteboardId:n.whiteboardPage.whiteboardId,id:n.whiteboardPage.id,name:n.whiteboardPage.name,order:n.whiteboardPage.order}).from(n.whiteboardPage).where((0,s.inArray)(n.whiteboardPage.whiteboardId,o)).orderBy(n.whiteboardPage.order):[],o.length?i.drizzleDb.select({whiteboardId:n.whiteboardSnapshot.whiteboardId,count:l.sql`count(*)::int`}).from(n.whiteboardSnapshot).where((0,s.inArray)(n.whiteboardSnapshot.whiteboardId,o)).groupBy(n.whiteboardSnapshot.whiteboardId):[]]),g=Object.fromEntries(b.map(e=>[e.whiteboardId,e.count])),m=w.reduce((e,t)=>(e[t.whiteboardId]||(e[t.whiteboardId]=[]),e[t.whiteboardId].push({id:t.id,name:t.name,order:t.order}),e),{}),R=t.map(e=>({...e,pages:(m[e.id]??[]).sort((e,t)=>e.order-t.order),_count:{pages:m[e.id]?.length??0,snapshots:g[e.id]??0}}));return a.NextResponse.json({whiteboards:R})}catch(e){return console.error("Fetch whiteboards error:",e),a.NextResponse.json({error:"Failed to fetch whiteboards"},{status:500})}},{role:"TUTOR"}),w=(0,o.withAuth)(async(e,t)=>{let r=t.user.id;try{let t=await e.json(),o=h.safeParse(t);if(!o.success)return a.NextResponse.json({error:"Invalid request",details:o.error.format()},{status:400});let d=o.data,l=crypto.randomUUID(),u=crypto.randomUUID();await i.drizzleDb.transaction(async e=>{await e.insert(n.whiteboard).values({id:l,tutorId:r,title:d.title,description:d.description??null,sessionId:d.sessionId??null,roomId:d.roomId??null,curriculumId:d.curriculumId??null,lessonId:d.lessonId??null,isTemplate:d.isTemplate,isPublic:d.isPublic,width:d.width,height:d.height,backgroundColor:d.backgroundColor,backgroundStyle:d.backgroundStyle,visibility:"private",isBroadcasting:!1,ownerType:"tutor"}),await e.insert(n.whiteboardPage).values({id:u,whiteboardId:l,name:"Page 1",order:0,strokes:[],shapes:[],texts:[],images:[]})});let[c]=await i.drizzleDb.select().from(n.whiteboard).where((0,s.eq)(n.whiteboard.id,l)),p=await i.drizzleDb.select().from(n.whiteboardPage).where((0,s.eq)(n.whiteboardPage.whiteboardId,l)).orderBy(n.whiteboardPage.order);return a.NextResponse.json({whiteboard:c?{...c,pages:p}:null},{status:201})}catch(e){return console.error("Create whiteboard error:",e),a.NextResponse.json({error:"Failed to create whiteboard"},{status:500})}},{role:"TUTOR"});e.s(["GET",0,p,"POST",0,w]),r()}catch(e){r(e)}},!1),275224,e=>e.a(async(t,r)=>{try{var a=e.i(78315),o=e.i(586961),i=e.i(196657),n=e.i(899733),s=e.i(233979),d=e.i(631683),l=e.i(840960),u=e.i(711373),c=e.i(699699),h=e.i(521140),p=e.i(205260),w=e.i(500249),b=e.i(431740),g=e.i(82608),m=e.i(635207),R=e.i(193695);e.i(708038);var f=e.i(447430),v=e.i(568611),I=t([v]);[v]=I.then?(await I)():I;let P=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/whiteboards/route",pathname:"/api/whiteboards",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/whiteboards/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:C,workUnitAsyncStorage:x,serverHooks:A}=P;function y(){return(0,i.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:x})}async function E(e,t,r){P.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/whiteboards/route";a=a.replace(/\/index$/,"")||"/";let i=await P.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:I,nextConfig:y,parsedUrl:E,isDraftMode:C,prerenderManifest:x,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,resolvedPathname:S,clientReferenceManifest:z,serverActionsManifest:O}=i,U=(0,l.normalizeAppPath)(a),q=!!(x.dynamicRoutes[U]||x.routes[S]),D=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(q&&!C){let e=!!x.routes[S],t=x.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await D();throw new R.NoFallbackError}}let _=null;!q||P.isDev||C||(_=S,_="/index"===_?"/":_);let k=!0===P.isDev||!q,H=q&&!k;O&&z&&(0,d.setManifestsSingleton)({page:a,clientReferenceManifest:z,serverActionsManifest:O});let j=e.method||"GET",M=(0,s.getTracer)(),B=M.getActiveScopeSpan(),F={params:I,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>P.onRequestError(e,t,a,o,A)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),$=new u.NodeNextResponse(t),L=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let i=async e=>P.handle(L,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${j} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${a}`)}),d=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:o})=>{try{if(!d&&T&&N&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let s=F.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let l=F.renderOpts.collectedTags;if(!q)return await (0,w.sendResponse)(K,$,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,b.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,o=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await P.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,A),t}},c=await P.handleResponse({req:e,nextConfig:y,cacheKey:_,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:d});if(!q)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,b.fromNodeOutgoingHttpHeaders)(c.value.headers);return d&&q||h.delete(m.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,w.sendResponse)(K,$,new Response(c.value.body,{headers:h,status:c.value.status||200})),null};B?await l(B):await M.withPropagatedContext(e.headers,()=>M.trace(h.BaseServerSpan.handleRequest,{spanName:`${j} ${a}`,kind:s.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await P.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,A),q)throw t;return await (0,w.sendResponse)(K,$,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>y,"routeModule",()=>P,"serverHooks",()=>A,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>x]),r()}catch(e){r(e)}},!1)];

//# debugId=4bf9c9b9-dc9d-4218-2b0d-174f46a97f14
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_4e5a42cb._.js.map