;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="82dbd81f-a16e-26c7-d666-1e331c4c3eff")}catch(e){}}();
module.exports=[183862,r=>r.a(async(e,u)=>{try{var l=r.i(909105),i=r.i(320947),t=r.i(738597);r.i(688768);var c=r.i(257357),n=e([t]);async function o(r,e){let[u]=await t.drizzleDb.select().from(c.curriculum).where((0,l.eq)(c.curriculum.id,e)).limit(1);if(!u)throw Error("Curriculum not found");let n=(await t.drizzleDb.select().from(c.curriculumModule).where((0,l.eq)(c.curriculumModule.curriculumId,e))).map(r=>r.id),o=n.length>0?await t.drizzleDb.select({count:i.sql`count(*)::int`}).from(c.curriculumLesson).where((0,l.inArray)(c.curriculumLesson.moduleId,n)):[{count:0}],m=o[0]?.count??0,[d]=await t.drizzleDb.select().from(c.curriculumProgress).where((0,l.and)((0,l.eq)(c.curriculumProgress.studentId,r),(0,l.eq)(c.curriculumProgress.curriculumId,e))).limit(1);if(d)return{enrolled:!1};let[s]=await t.drizzleDb.select().from(c.curriculumEnrollment).where((0,l.and)((0,l.eq)(c.curriculumEnrollment.studentId,r),(0,l.eq)(c.curriculumEnrollment.curriculumId,e))).limit(1);s?await t.drizzleDb.update(c.curriculumEnrollment).set({enrollmentSource:"signup"}).where((0,l.eq)(c.curriculumEnrollment.id,s.id)):await t.drizzleDb.insert(c.curriculumEnrollment).values({id:crypto.randomUUID(),studentId:r,curriculumId:e,lessonsCompleted:0,enrollmentSource:"signup"});let a=await t.drizzleDb.insert(c.curriculumProgress).values({id:crypto.randomUUID(),studentId:r,curriculumId:e,lessonsCompleted:0,totalLessons:m,isCompleted:!1}).returning();return{enrolled:!0,progress:a[0]?{id:a[0].id}:void 0}}[t]=n.then?(await n)():n,r.s(["enrollStudentInCurriculum",()=>o]),u()}catch(r){u(r)}},!1)];

//# debugId=82dbd81f-a16e-26c7-d666-1e331c4c3eff
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_enrollment_ts_e851318c._.js.map