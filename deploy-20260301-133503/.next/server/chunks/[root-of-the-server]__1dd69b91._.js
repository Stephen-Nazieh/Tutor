;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="b715e9e4-cf76-904d-cea0-b31c288c06a3")}catch(e){}}();
module.exports=[4472,e=>e.a(async(t,r)=>{try{var a=e.i(620971),s=e.i(384030),n=e.i(738597);e.i(688768);var o=e.i(257357),i=e.i(909105),l=e.i(841195),u=e.i(254799),d=t([s,n]);[s,n]=d.then?(await d)():d;let p=l.z.object({answer:l.z.union([l.z.string(),l.z.array(l.z.string())]),anonymousId:l.z.string().optional()}),c=(0,s.withAuth)(async(e,t)=>{try{let r=e.url.split("/polls/")[1]?.split("/")[0];if(!r)return a.NextResponse.json({error:"Poll ID is required"},{status:400});let s=await e.json(),l=p.parse(s),[d]=await n.drizzleDb.select().from(o.poll).where((0,i.eq)(o.poll.id,r)).limit(1);if(!d)return a.NextResponse.json({error:"Poll not found"},{status:404});if("ACTIVE"!==d.status)return a.NextResponse.json({error:"Poll is not active"},{status:400});if(null!=d.timeLimit&&d.startedAt&&(Date.now()-new Date(d.startedAt).getTime())/1e3>d.timeLimit)return a.NextResponse.json({error:"Poll has expired"},{status:400});if(!d.isAnonymous){let[e]=await n.drizzleDb.select().from(o.pollResponse).where((0,i.and)((0,i.eq)(o.pollResponse.pollId,r),(0,i.eq)(o.pollResponse.studentId,t.user.id))).limit(1);if(e)return a.NextResponse.json({error:"You have already voted in this poll"},{status:400})}let c=Array.isArray(l.answer)?l.answer:[l.answer],h=null;d.isAnonymous&&(h=l.anonymousId??u.default.createHash("sha256").update(t.user.id+r).digest("hex").substring(0,16));let R=u.default.randomUUID();await n.drizzleDb.insert(o.pollResponse).values({id:R,pollId:r,studentId:d.isAnonymous?null:t.user.id,respondentHash:h,optionIds:c,rating:null,textAnswer:null});let[m]=await n.drizzleDb.select().from(o.pollResponse).where((0,i.eq)(o.pollResponse.id,R)).limit(1),v=(d.totalResponses??0)+1;return await n.drizzleDb.update(o.poll).set({totalResponses:v}).where((0,i.eq)(o.poll.id,r)),a.NextResponse.json({success:!0,response:m??{id:R,pollId:r,optionIds:c,createdAt:new Date}})}catch(e){if(e instanceof l.z.ZodError)return a.NextResponse.json({error:"Invalid data",issues:e.issues},{status:400});return console.error("Error submitting vote:",e),a.NextResponse.json({error:"Failed to submit vote"},{status:500})}});e.s(["POST",0,c]),r()}catch(e){r(e)}},!1),617609,e=>e.a(async(t,r)=>{try{var a=e.i(78315),s=e.i(586961),n=e.i(196657),o=e.i(899733),i=e.i(233979),l=e.i(631683),u=e.i(840960),d=e.i(711373),p=e.i(699699),c=e.i(521140),h=e.i(205260),R=e.i(500249),m=e.i(431740),v=e.i(82608),w=e.i(635207),f=e.i(193695);e.i(708038);var E=e.i(447430),g=e.i(4472),y=t([g]);[g]=y.then?(await y)():y;let _=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/class/polls/[pollId]/vote/route",pathname:"/api/class/polls/[pollId]/vote",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/class/polls/[pollId]/vote/route.ts",nextConfigOutput:"",userland:g}),{workAsyncStorage:C,workUnitAsyncStorage:b,serverHooks:P}=_;function A(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:b})}async function x(e,t,r){_.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/class/polls/[pollId]/vote/route";a=a.replace(/\/index$/,"")||"/";let n=await _.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:g,params:y,nextConfig:A,parsedUrl:x,isDraftMode:C,prerenderManifest:b,routerServerContext:P,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,resolvedPathname:I,clientReferenceManifest:D,serverActionsManifest:O}=n,S=(0,u.normalizeAppPath)(a),j=!!(b.dynamicRoutes[S]||b.routes[I]),k=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,x,!1):t.end("This page could not be found"),null);if(j&&!C){let e=!!b.routes[I],t=b.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await k();throw new f.NoFallbackError}}let q=null;!j||_.isDev||C||(q=I,q="/index"===q?"/":q);let z=!0===_.isDev||!j,H=j&&!z;O&&D&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:D,serverActionsManifest:O});let U=e.method||"GET",M=(0,i.getTracer)(),K=M.getActiveScopeSpan(),F={params:y,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:z,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>_.onRequestError(e,t,a,s,P)},sharedContext:{buildId:g}},$=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),B=p.NextRequestAdapter.fromNodeNextRequest($,(0,p.signalFromNodeResponse)(t));try{let n=async e=>_.handle(B,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${U} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),u=async o=>{var i,u;let d=async({previousCacheEntry:s})=>{try{if(!l&&N&&T&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let i=F.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let u=F.renderOpts.collectedTags;if(!j)return await (0,R.sendResponse)($,L,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[w.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,s=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},!1,P),t}},p=await _.handleResponse({req:e,nextConfig:A,cacheKey:q,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!j)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(u=p.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",N?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&j||c.delete(w.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,v.getCacheControlHeader)(p.cacheControl)),await (0,R.sendResponse)($,L,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};K?await u(K):await M.withPropagatedContext(e.headers,()=>M.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},u))}catch(t){if(t instanceof f.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},!1,P),j)throw t;return await (0,R.sendResponse)($,L,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>A,"routeModule",()=>_,"serverHooks",()=>P,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>b]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=b715e9e4-cf76-904d-cea0-b31c288c06a3
//# sourceMappingURL=%5Broot-of-the-server%5D__1dd69b91._.js.map