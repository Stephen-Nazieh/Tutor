;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="88b8bba3-d6ed-0c00-94af-e11d376aa2b9")}catch(e){}}();
module.exports=[329308,e=>e.a(async(r,a)=>{try{var t=e.i(254799),o=e.i(738597);e.i(688768);var i=e.i(257357),n=r([o]);async function s(e,r,a){try{await o.drizzleDb.insert(i.userActivityLog).values({id:t.default.randomUUID(),userId:e,action:r,metadata:a??{}})}catch(e){console.error("Failed to log activity:",e)}}[o]=n.then?(await n)():n,e.s(["logActivity",()=>s]),a()}catch(e){a(e)}},!1),505589,e=>{"use strict";e.s(["XP_LEVELS",0,{1:0,2:200,3:500,4:1e3,5:1800,6:3e3,7:4600,8:6600,9:9100,10:12100,11:15600,12:19600,13:24100,14:29100,15:34600,16:40600,17:47100,18:54100,19:61600,20:69600},"XP_REWARDS",0,{COMPLETE_MISSION:50,PERFECT_QUIZ:20,DAILY_LOGIN:10,STREAK_3_DAYS:50,STREAK_7_DAYS:150,STREAK_30_DAYS:500,SPEAKING_PRACTICE:30,AI_CONVERSATION:40,COMPLETE_LESSON:40,FIRST_MISSION:100}])},977762,e=>e.a(async(r,a)=>{try{var t=e.i(254799),o=e.i(909105),i=e.i(738597);e.i(688768);var n=e.i(257357),s=e.i(329308),c=e.i(505589),l=r([i,s]);async function d(e){let[r]=await i.drizzleDb.select().from(n.userGamification).where((0,o.eq)(n.userGamification.userId,e)).limit(1);if(r)return r;let[a]=await i.drizzleDb.insert(n.userGamification).values({id:t.default.randomUUID(),userId:e,level:1,xp:0,streakDays:0,longestStreak:0,totalStudyMinutes:0,grammarScore:0,vocabularyScore:0,speakingScore:0,listeningScore:0,confidenceScore:0,fluencyScore:0,unlockedWorlds:[]}).returning();if(!a)throw Error("Failed to create user gamification");return a}async function u(e,r,a,t){let l=await d(e),u=l.xp+r,y=function(e){let r=1;for(let a=1;a<=20;a++)if(e>=c.XP_LEVELS[a])r=a;else break;return r}(u),p=y>l.level,[g]=await i.drizzleDb.update(n.userGamification).set({xp:u,level:y}).where((0,o.eq)(n.userGamification.userId,e)).returning();if(!g)throw Error("Failed to update gamification");return await (0,s.logActivity)(e,"XP_EARNED",{amount:r,source:a,newTotal:u,leveledUp:p,...t}),{...g,xpEarned:r,leveledUp:p,previousLevel:l.level}}async function y(e){let r=await d(e),a=new Date;a.setHours(0,0,0,0);let t=r.lastActiveDate?new Date(r.lastActiveDate):null,l=r.streakDays,u=0,y=!1,p=!1;if(t){t.setHours(0,0,0,0);let e=Math.floor((a.getTime()-t.getTime())/864e5);1===e?(l+=1,y=!0,3===l?u=c.XP_REWARDS.STREAK_3_DAYS:7===l?u=c.XP_REWARDS.STREAK_7_DAYS:30===l&&(u=c.XP_REWARDS.STREAK_30_DAYS)):0===e?y=!0:(p=!0,l=1)}else l=1;let g=Math.max(r.longestStreak,l),[m]=await i.drizzleDb.update(n.userGamification).set({streakDays:l,longestStreak:g,lastActiveDate:a}).where((0,o.eq)(n.userGamification.userId,e)).returning();if(!m)throw Error("Failed to update streak");return await (0,s.logActivity)(e,p?"STREAK_BROKEN":"STREAK_UPDATED",{streakDays:l,previousStreak:r.streakDays,streakBroken:p,streakContinued:y}),{...m,streakBonus:u,streakContinued:y,streakBroken:p}}async function p(e){let r=await d(e),a=new Date;a.setHours(0,0,0,0);let t=r.lastActiveDate?new Date(r.lastActiveDate):null;if(!t||t.getTime()!==a.getTime()){let r=await y(e),a=await u(e,c.XP_REWARDS.DAILY_LOGIN,"daily_login");return{firstLoginToday:!0,xpEarned:a.xpEarned+r.streakBonus,streakBonus:r.streakBonus,streakDays:r.streakDays,leveledUp:a.leveledUp}}return{firstLoginToday:!1,streakDays:r.streakDays}}async function g(e,r){let a=await d(e),t=(e,r)=>void 0===r?e:Math.round(.7*e+.3*r),[c]=await i.drizzleDb.update(n.userGamification).set({grammarScore:t(a.grammarScore,r.grammar),vocabularyScore:t(a.vocabularyScore,r.vocabulary),speakingScore:t(a.speakingScore,r.speaking),listeningScore:t(a.listeningScore,r.listening),confidenceScore:t(a.confidenceScore,r.confidence),fluencyScore:t(a.fluencyScore,r.fluency)}).where((0,o.eq)(n.userGamification.userId,e)).returning();if(!c)throw Error("Failed to update skill scores");return r.confidence&&r.confidence>a.confidenceScore+5&&await (0,s.logActivity)(e,"CONFIDENCE_MILESTONE",{previousScore:a.confidenceScore,newScore:c.confidenceScore,delta:c.confidenceScore-a.confidenceScore}),c}async function m(e){var r,a,t;let o,i,n=await d(e),s=(r=n.level,c.XP_LEVELS[r+1]||2*c.XP_LEVELS[20]),l=c.XP_LEVELS[n.level],u=(a=n.xp,t=n.level,o=c.XP_LEVELS[t],i=c.XP_LEVELS[t+1]||2*c.XP_LEVELS[20],Math.min(100,Math.round((a-o)/(i-o)*100)));return{level:n.level,xp:n.xp,nextLevelXp:s,currentLevelXp:l,progress:u,xpToNextLevel:s-n.xp,streakDays:n.streakDays,longestStreak:n.longestStreak,skills:{grammar:n.grammarScore,vocabulary:n.vocabularyScore,speaking:n.speakingScore,listening:n.listeningScore,confidence:n.confidenceScore,fluency:n.fluencyScore},unlockedWorlds:n.unlockedWorlds}}async function f(e,r){return(await d(e)).level>=r}[i,s]=l.then?(await l)():l,e.s(["awardXp",()=>u,"canAccessWorld",()=>f,"checkDailyLogin",()=>p,"getGamificationSummary",()=>m,"getOrCreateGamification",()=>d,"updateSkillScores",()=>g]),a()}catch(e){a(e)}},!1),239713,e=>e.a(async(r,a)=>{try{var t=e.i(254799),o=e.i(909105),i=e.i(997103),n=e.i(738597);e.i(688768);var s=e.i(257357),c=e.i(977762),l=e.i(329308),d=r([n,c,l]);[n,c,l]=d.then?(await d)():d;let f=[{key:"first_steps",name:"First Steps",description:"Complete your first lesson",icon:"footprints",color:"#22c55e",category:"general",rarity:"common",xpBonus:50,requirement:{type:"complete_lessons",count:1},order:1},{key:"quick_learner",name:"Quick Learner",description:"Complete 10 lessons",icon:"zap",color:"#3b82f6",category:"general",rarity:"common",xpBonus:100,requirement:{type:"complete_lessons",count:10},order:2},{key:"knowledge_seeker",name:"Knowledge Seeker",description:"Complete 50 lessons",icon:"book-open",color:"#8b5cf6",category:"general",rarity:"rare",xpBonus:250,requirement:{type:"complete_lessons",count:50},order:3},{key:"master_scholar",name:"Master Scholar",description:"Complete 100 lessons",icon:"graduation-cap",color:"#f59e0b",category:"general",rarity:"epic",xpBonus:500,requirement:{type:"complete_lessons",count:100},order:4},{key:"streak_3",name:"On Fire",description:"Maintain a 3-day learning streak",icon:"flame",color:"#f97316",category:"streak",rarity:"common",xpBonus:100,requirement:{type:"streak_days",days:3},order:10},{key:"streak_7",name:"Week Warrior",description:"Maintain a 7-day learning streak",icon:"flame",color:"#ef4444",category:"streak",rarity:"rare",xpBonus:250,requirement:{type:"streak_days",days:7},order:11},{key:"streak_30",name:"Monthly Master",description:"Maintain a 30-day learning streak",icon:"crown",color:"#eab308",category:"streak",rarity:"epic",xpBonus:1e3,requirement:{type:"streak_days",days:30},order:12},{key:"streak_100",name:"Centurion",description:"Maintain a 100-day learning streak",icon:"medal",color:"#6366f1",category:"streak",rarity:"legendary",xpBonus:5e3,requirement:{type:"streak_days",days:100},order:13},{key:"first_quiz",name:"Quiz Taker",description:"Complete your first quiz",icon:"help-circle",color:"#10b981",category:"quiz",rarity:"common",xpBonus:50,requirement:{type:"complete_quizzes",count:1},order:20},{key:"quiz_pro",name:"Quiz Pro",description:"Complete 20 quizzes",icon:"check-circle",color:"#3b82f6",category:"quiz",rarity:"common",xpBonus:150,requirement:{type:"complete_quizzes",count:20},order:21},{key:"perfect_score",name:"Perfect Score",description:"Score 100% on a quiz",icon:"star",color:"#f59e0b",category:"quiz",rarity:"rare",xpBonus:200,requirement:{type:"perfect_quiz",count:1},order:22},{key:"quiz_master",name:"Quiz Master",description:"Complete 50 quizzes with 80%+ average",icon:"trophy",color:"#8b5cf6",category:"quiz",rarity:"epic",xpBonus:500,requirement:{type:"complete_quizzes_expert",count:50,score:80},order:23},{key:"social_butterfly",name:"Social Butterfly",description:"Join 5 live sessions",icon:"users",color:"#ec4899",category:"social",rarity:"common",xpBonus:100,requirement:{type:"join_sessions",count:5},order:30},{key:"active_participant",name:"Active Participant",description:"Send 50 messages in live sessions",icon:"message-circle",color:"#06b6d4",category:"social",rarity:"rare",xpBonus:200,requirement:{type:"send_messages",count:50},order:31},{key:"study_group_hero",name:"Study Group Hero",description:"Join or create 3 study groups",icon:"users-round",color:"#84cc16",category:"social",rarity:"rare",xpBonus:300,requirement:{type:"join_groups",count:3},order:32},{key:"level_5",name:"Rising Star",description:"Reach level 5",icon:"rocket",color:"#f97316",category:"mastery",rarity:"common",xpBonus:200,requirement:{type:"reach_level",level:5},order:40},{key:"level_10",name:"Expert Learner",description:"Reach level 10",icon:"award",color:"#3b82f6",category:"mastery",rarity:"rare",xpBonus:500,requirement:{type:"reach_level",level:10},order:41},{key:"level_20",name:"Grandmaster",description:"Reach level 20",icon:"crown",color:"#eab308",category:"mastery",rarity:"epic",xpBonus:2e3,requirement:{type:"reach_level",level:20},order:42},{key:"xp_10000",name:"XP Hunter",description:"Earn 10,000 total XP",icon:"target",color:"#8b5cf6",category:"mastery",rarity:"rare",xpBonus:500,requirement:{type:"earn_xp",count:1e4},order:43},{key:"night_owl",name:"Night Owl",description:"Complete a lesson between midnight and 5 AM",icon:"moon",color:"#6366f1",category:"general",rarity:"rare",xpBonus:150,requirement:{type:"night_study"},isSecret:!0,order:50},{key:"early_bird",name:"Early Bird",description:"Complete a lesson before 7 AM",icon:"sunrise",color:"#f59e0b",category:"general",rarity:"rare",xpBonus:150,requirement:{type:"morning_study"},isSecret:!0,order:51}];async function u(){for(let e of f){let[r]=await n.drizzleDb.select().from(s.badge).where((0,o.eq)(s.badge.key,e.key)).limit(1);r?await n.drizzleDb.update(s.badge).set({name:e.name,description:e.description,icon:e.icon,color:e.color,category:e.category,rarity:e.rarity,xpBonus:e.xpBonus,requirement:e.requirement,isSecret:e.isSecret??!1,order:e.order}).where((0,o.eq)(s.badge.id,r.id)):await n.drizzleDb.insert(s.badge).values({id:t.default.randomUUID(),key:e.key,name:e.name,description:e.description,icon:e.icon,color:e.color,category:e.category,rarity:e.rarity,xpBonus:e.xpBonus,requirement:e.requirement,isSecret:e.isSecret??!1,order:e.order})}console.log(`[Badges] Initialized ${f.length} badges`)}async function y(e,r){let[a]=await n.drizzleDb.select().from(s.badge).where((0,o.eq)(s.badge.key,r)).limit(1);if(!a)throw Error(`Badge not found: ${r}`);let[i]=await n.drizzleDb.select().from(s.userBadge).where((0,o.and)((0,o.eq)(s.userBadge.userId,e),(0,o.eq)(s.userBadge.badgeId,a.id))).limit(1);return i?{awarded:!1,alreadyHad:!0}:(await n.drizzleDb.insert(s.userBadge).values({id:t.default.randomUUID(),userId:e,badgeId:a.id,progress:0}),a.xpBonus>0&&await (0,c.awardXp)(e,a.xpBonus,"badge_earned",{badgeKey:r}),await (0,l.logActivity)(e,"BADGE_EARNED",{badgeKey:r,badgeName:a.name,rarity:a.rarity,xpBonus:a.xpBonus}),{awarded:!0,badge:a,xpBonus:a.xpBonus})}async function p(e){let[r,a]=await Promise.all([n.drizzleDb.select().from(s.badge).orderBy((0,i.asc)(s.badge.order)),n.drizzleDb.select({badgeId:s.userBadge.badgeId,earnedAt:s.userBadge.earnedAt,progress:s.userBadge.progress}).from(s.userBadge).where((0,o.eq)(s.userBadge.userId,e))]),t=new Set(a.map(e=>e.badgeId)),c=new Map(a.map(e=>[e.badgeId,e]));return r.map(e=>({...e,earned:t.has(e.id),earnedAt:c.get(e.id)?.earnedAt??null,progress:c.get(e.id)?.progress??0}))}async function g(e,r){let a=[];void 0!==r.lessonsCompleted&&(r.lessonsCompleted>=1&&a.push("first_steps"),r.lessonsCompleted>=10&&a.push("quick_learner"),r.lessonsCompleted>=50&&a.push("knowledge_seeker"),r.lessonsCompleted>=100&&a.push("master_scholar")),void 0!==r.streakDays&&(r.streakDays>=3&&a.push("streak_3"),r.streakDays>=7&&a.push("streak_7"),r.streakDays>=30&&a.push("streak_30"),r.streakDays>=100&&a.push("streak_100")),void 0!==r.quizzesCompleted&&(r.quizzesCompleted>=1&&a.push("first_quiz"),r.quizzesCompleted>=20&&a.push("quiz_pro")),r.perfectQuizzes&&r.perfectQuizzes>=1&&a.push("perfect_score"),r.quizzesCompleted&&r.quizAverage&&r.quizzesCompleted>=50&&r.quizAverage>=80&&a.push("quiz_master"),void 0!==r.sessionsJoined&&r.sessionsJoined>=5&&a.push("social_butterfly"),void 0!==r.messagesSent&&r.messagesSent>=50&&a.push("active_participant"),void 0!==r.currentLevel&&(r.currentLevel>=5&&a.push("level_5"),r.currentLevel>=10&&a.push("level_10"),r.currentLevel>=20&&a.push("level_20")),void 0!==r.totalXp&&r.totalXp>=1e4&&a.push("xp_10000");let t=[];for(let r of a){let a=await y(e,r);a.awarded&&a.badge&&t.push({badgeKey:r,badgeName:a.badge.name,xpBonus:a.xpBonus})}return t}async function m(e){let[r,a]=await Promise.all([n.drizzleDb.select({badgeId:s.userBadge.badgeId,bRarity:s.badge.rarity,bCategory:s.badge.category,bXpBonus:s.badge.xpBonus}).from(s.userBadge).innerJoin(s.badge,(0,o.eq)(s.badge.id,s.userBadge.badgeId)).where((0,o.eq)(s.userBadge.userId,e)),n.drizzleDb.select().from(s.badge)]),t={common:r.filter(e=>"common"===e.bRarity).length,rare:r.filter(e=>"rare"===e.bRarity).length,epic:r.filter(e=>"epic"===e.bRarity).length,legendary:r.filter(e=>"legendary"===e.bRarity).length},i={general:r.filter(e=>"general"===e.bCategory).length,streak:r.filter(e=>"streak"===e.bCategory).length,quiz:r.filter(e=>"quiz"===e.bCategory).length,social:r.filter(e=>"social"===e.bCategory).length,mastery:r.filter(e=>"mastery"===e.bCategory).length};return{totalEarned:r.length,totalAvailable:a.length,completionPercentage:a.length?Math.round(r.length/a.length*100):0,byRarity:t,byCategory:i,totalXpFromBadges:r.reduce((e,r)=>e+r.bXpBonus,0)}}e.s(["awardBadge",()=>y,"checkAndAwardBadges",()=>g,"getAllBadgesWithProgress",()=>p,"getBadgeStats",()=>m,"initializeBadges",()=>u]),a()}catch(e){a(e)}},!1)];

//# debugId=88b8bba3-d6ed-0c00-94af-e11d376aa2b9
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_gamification_a22ba6d4._.js.map