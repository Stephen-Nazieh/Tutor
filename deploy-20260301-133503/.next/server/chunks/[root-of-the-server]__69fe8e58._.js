;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="8694ad79-0181-d885-ee51-2aa340f41140")}catch(e){}}();
module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},908286,e=>{"use strict";async function t(e,t){var r=e instanceof Promise?await e:e;if(!r||"object"!=typeof r)return;let s=r[t];return null!=s?Array.isArray(s)?s[0]:s:void 0}e.s(["getParamAsync",()=>t])},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},37702,(e,t,r)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},891820,e=>e.a(async(t,r)=>{try{var s=e.i(909105),a=e.i(997103),n=e.i(320947),i=e.i(738597);e.i(688768);var o=e.i(257357),c=t([i]);async function l(e,t){let r=await i.drizzleDb.select().from(o.taskSubmission).where((0,s.eq)(o.taskSubmission.studentId,e));if(0===r.length)return{averageScore:0,completionRate:0,engagementScore:0,attendanceRate:0,participationRate:0};let a=r.reduce((e,t)=>e+(Number(t.score)||0),0)/r.length,c=r.filter(e=>"graded"===e.status).length/r.length*100,l=r.reduce((e,t)=>e+(t.timeSpent||0),0)/r.length,u=r.reduce((e,t)=>e+(t.attempts||1),0)/r.length,d=Math.min(100,l/300*50+1/u*50),m=await i.drizzleDb.select({sessionId:o.sessionParticipant.sessionId,joinedAt:o.sessionParticipant.joinedAt}).from(o.sessionParticipant).where((0,s.eq)(o.sessionParticipant.studentId,e)),p=new Set(m.map(e=>e.sessionId)),f=new Set(m.filter(e=>null!=e.joinedAt).map(e=>e.sessionId)),g=p.size,h=f.size,[w]=await i.drizzleDb.select({count:n.sql`count(*)::int`}).from(o.message).where((0,s.eq)(o.message.userId,e)),S=w?.count??0,A=Math.min(100,5*S);return{averageScore:Math.round(10*a)/10,completionRate:Math.round(10*c)/10,engagementScore:Math.round(10*d)/10,attendanceRate:Math.round(10*(g>0?h/g*100:0))/10,participationRate:Math.round(10*A)/10}}async function u(e){let t={},r=await i.drizzleDb.select().from(o.taskSubmission).where((0,s.eq)(o.taskSubmission.studentId,e));for(let e of r){let r=e.answers;for(let s of r?.subjects||r?.topics||["general"])t[s]||(t[s]=[]),t[s].push(e.score||0)}let a={};for(let e of r){let t=e.questionResults;if(Array.isArray(t))for(let e of t){let t=e.questionId??"unknown";a[t]||(a[t]={correct:0,total:0}),a[t].total++,e.correct&&a[t].correct++}}for(let t of(await i.drizzleDb.select().from(o.quizAttempt).where((0,s.and)((0,s.eq)(o.quizAttempt.studentId,e),(0,s.isNotNull)(o.quizAttempt.questionResults))).limit(50))){let e=t.questionResults;if(Array.isArray(e))for(let t of e){let e=t.questionId??"unknown";a[e]||(a[e]={correct:0,total:0}),a[e].total++,t.correct&&a[e].correct++}}for(let[e,r]of Object.entries(a)){if(0===r.total)continue;let s=r.correct/r.total*100,a=`Q:${e}`;s>=80?(t[a]||(t[a]=[]),t[a].push(s)):s<50&&(t[a]||(t[a]=[]),t[a].push(s))}let n=[],c=[];for(let[e,r]of Object.entries(t)){let t=r.reduce((e,t)=>e+t,0)/r.length;t>=80?n.push(e):t<60&&c.push(e)}return{strengths:n,weaknesses:c}}async function d(e){let t=await i.drizzleDb.select().from(o.taskSubmission).where((0,s.eq)(o.taskSubmission.studentId,e)).orderBy((0,a.desc)(o.taskSubmission.submittedAt)).limit(50),r={},n=(e,t)=>{r[e]||(r[e]={count:0,lastAt:t}),r[e].count++,t>r[e].lastAt&&(r[e].lastAt=t)};for(let e of t){let t=e.answers;if(t?.mistakes)for(let r of t.mistakes)n(r.type||"general",e.submittedAt)}for(let e of t){let t=e.questionResults;if(Array.isArray(t))for(let r of t){if(r.correct)continue;let t=r.selectedAnswer?`Q:${r.questionId}: chose ${String(r.selectedAnswer).slice(0,40)}`:`Q:${r.questionId}: incorrect`;n(t,e.submittedAt)}}for(let t of(await i.drizzleDb.select().from(o.quizAttempt).where((0,s.and)((0,s.eq)(o.quizAttempt.studentId,e),(0,s.isNotNull)(o.quizAttempt.questionResults))).orderBy((0,a.desc)(o.quizAttempt.completedAt)).limit(50))){let e=t.questionResults;if(Array.isArray(e))for(let r of e){if(r.correct)continue;let e=r.selectedAnswer?`Q:${r.questionId}: chose ${String(r.selectedAnswer).slice(0,40)}`:`Q:${r.questionId}: incorrect`;n(e,t.completedAt)}}return Object.entries(r).map(([e,t])=>({type:e,frequency:t.count,lastOccurred:t.lastAt})).sort((e,t)=>t.frequency-e.frequency).slice(0,10)}async function m(e){let t=[],r=[],n=0,c=0;for(let l of(await i.drizzleDb.select().from(o.quizAttempt).where((0,s.and)((0,s.eq)(o.quizAttempt.studentId,e),(0,s.isNotNull)(o.quizAttempt.questionResults))).orderBy((0,a.desc)(o.quizAttempt.completedAt)).limit(50))){let e=l.questionResults;if(!Array.isArray(e)||0===e.length)continue;let s=e.map(e=>({sourceType:"quiz",sourceId:l.quizId,questionId:e.questionId,correct:e.correct??(void 0!==e.pointsEarned&&void 0!==e.pointsMax&&e.pointsEarned>=.7*e.pointsMax),pointsEarned:e.pointsEarned??0,pointsMax:e.pointsMax??100,selectedAnswer:e.selectedAnswer,completedAt:l.completedAt}));for(let e of s)c++,e.correct?n++:r.push(e.questionId);t.push({sourceType:"quiz",sourceId:l.quizId,completedAt:l.completedAt,questions:s})}for(let l of(await i.drizzleDb.select().from(o.taskSubmission).where((0,s.and)((0,s.eq)(o.taskSubmission.studentId,e),(0,s.isNotNull)(o.taskSubmission.questionResults))).orderBy((0,a.desc)(o.taskSubmission.submittedAt)).limit(50))){let e=l.questionResults;if(!Array.isArray(e)||0===e.length)continue;let s=e.map(e=>({sourceType:"task",sourceId:l.taskId,questionId:e.questionId,correct:e.correct??(void 0!==e.pointsEarned&&void 0!==e.pointsMax&&e.pointsEarned>=.7*e.pointsMax),pointsEarned:e.pointsEarned??0,pointsMax:e.pointsMax??100,selectedAnswer:e.selectedAnswer,completedAt:l.submittedAt}));for(let e of s)c++,e.correct?n++:r.push(e.questionId);t.push({sourceType:"task",sourceId:l.taskId,completedAt:l.submittedAt,questions:s})}return{bySource:t,weakQuestionIds:[...new Set(r)],totalCorrect:n,totalQuestions:c}}async function p(e,t){let r,n=await l(e,t),{strengths:c,weaknesses:m}=await u(e);if(t){let n=await i.drizzleDb.select({id:o.courseBatch.id}).from(o.courseBatch).where((0,s.eq)(o.courseBatch.curriculumId,t)),c=n.length>0?(await i.drizzleDb.select({id:o.generatedTask.id}).from(o.generatedTask).where((0,s.inArray)(o.generatedTask.batchId,n.map(e=>e.id)))).map(e=>e.id):[];r=c.length>0?await i.drizzleDb.select().from(o.taskSubmission).where((0,s.and)((0,s.eq)(o.taskSubmission.studentId,e),(0,s.inArray)(o.taskSubmission.taskId,c))).orderBy((0,a.desc)(o.taskSubmission.submittedAt)).limit(20):await i.drizzleDb.select().from(o.taskSubmission).where((0,s.eq)(o.taskSubmission.studentId,e)).orderBy((0,a.desc)(o.taskSubmission.submittedAt)).limit(20)}else r=await i.drizzleDb.select().from(o.taskSubmission).where((0,s.eq)(o.taskSubmission.studentId,e)).orderBy((0,a.desc)(o.taskSubmission.submittedAt)).limit(20);let p=r.map(e=>{let t=e.answers;return{taskId:e.taskId,score:e.score||0,timeSpent:e.timeSpent||0,attempts:e.attempts||1,completedAt:e.submittedAt,strengths:t?.strengthsDemonstrated||[],weaknesses:t?.areasForImprovement||[]}}),f=await d(e),g=function(e){if(e.length<3)return"normal";let t=e.reduce((e,t)=>e+t.timeSpent,0)/e.length,r=e.reduce((e,t)=>e+t.attempts,0)/e.length;return t<180&&r<1.5?"fast":t>600||r>2.5?"slow":"normal"}(p),h=n.averageScore>=80&&n.completionRate>=80&&n.engagementScore>=70?"advanced":n.averageScore<60||n.completionRate<50||n.engagementScore<40?"struggling":"intermediate",w=r.filter(e=>{let t=e.answers;return t?.taskType==="visual"}).length>r.length/2?"visual":"mixed";return{studentId:e,overallMetrics:n,subjectStrengths:c,subjectWeaknesses:m,learningStyle:w,pace:g,taskHistory:p,commonMistakes:f,performanceCluster:h}}async function f(e){let t=await i.drizzleDb.select({studentId:o.curriculumEnrollment.studentId}).from(o.curriculumEnrollment).where((0,s.eq)(o.curriculumEnrollment.curriculumId,e)),r=await Promise.all(t.map(async t=>{let[r]=await i.drizzleDb.select({name:o.profile.name}).from(o.profile).where((0,s.eq)(o.profile.userId,t.studentId)).limit(1);return{id:t.studentId,name:r?.name??"Unknown",performance:await p(t.studentId,e)}})),a={advanced:0,intermediate:0,struggling:0},n=0,c=[];for(let e of r)a[e.performance.performanceCluster]++,n+=e.performance.overallMetrics.averageScore,"struggling"===e.performance.performanceCluster&&c.push({id:e.id,name:e.name,reason:`Low performance: ${e.performance.overallMetrics.averageScore.toFixed(0)}% avg`});let l=r.sort((e,t)=>t.performance.overallMetrics.averageScore-e.performance.overallMetrics.averageScore).slice(0,5).map(e=>({id:e.id,name:e.name,score:e.performance.overallMetrics.averageScore}));return{totalStudents:t.length,averageScore:t.length>0?n/t.length:0,clusterDistribution:a,topStudents:l,studentsNeedingAttention:c}}async function g(e,t){let r=await p(e,t),[a]=await i.drizzleDb.select().from(o.studentPerformance).where((0,s.eq)(o.studentPerformance.studentId,e)).limit(1),n={studentId:e,cluster:r.performanceCluster,strengths:r.subjectStrengths,weaknesses:r.subjectWeaknesses,commonMistakes:r.commonMistakes.map(e=>({type:e.type,frequency:e.frequency})),learningStyle:r.learningStyle??"mixed",averageScore:r.overallMetrics.averageScore,completionRate:r.overallMetrics.completionRate,engagementScore:r.overallMetrics.engagementScore,attendanceRate:r.overallMetrics.attendanceRate,participationRate:r.overallMetrics.participationRate,pace:r.pace};a?await i.drizzleDb.update(o.studentPerformance).set({cluster:n.cluster,strengths:n.strengths,weaknesses:n.weaknesses,commonMistakes:n.commonMistakes,learningStyle:n.learningStyle,averageScore:n.averageScore,completionRate:n.completionRate,engagementScore:n.engagementScore,attendanceRate:n.attendanceRate,participationRate:n.participationRate,pace:n.pace,curriculumId:t??null}).where((0,s.eq)(o.studentPerformance.id,a.id)):await i.drizzleDb.insert(o.studentPerformance).values({id:crypto.randomUUID(),studentId:n.studentId,curriculumId:t??null,cluster:n.cluster,strengths:n.strengths,weaknesses:n.weaknesses,commonMistakes:n.commonMistakes,learningStyle:n.learningStyle,averageScore:n.averageScore,completionRate:n.completionRate,engagementScore:n.engagementScore,attendanceRate:n.attendanceRate,participationRate:n.participationRate,pace:n.pace,taskHistory:[],skillBreakdown:{},recommendedPeers:[],updatedAt:new Date})}[i]=c.then?(await c)():c,e.s(["getClassPerformanceSummary",()=>f,"getQuestionLevelBreakdown",()=>m,"getStudentPerformance",()=>p,"updateStudentPerformanceRecord",()=>g]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=8694ad79-0181-d885-ee51-2aa340f41140
//# sourceMappingURL=%5Broot-of-the-server%5D__69fe8e58._.js.map