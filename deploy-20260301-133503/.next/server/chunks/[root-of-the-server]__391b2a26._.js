;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="06824a82-25f7-7a42-df76-003d79d2d730")}catch(e){}}();
module.exports=[902157,(e,t,a)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,a)=>{t.exports=e.x("node:path",()=>require("node:path"))},450869,e=>{"use strict";let t="tutorme:query:",a=null,n=null,r=!1,i=!(void 0!==globalThis.EdgeRuntime||"u">typeof process&&0);function s(){return i?(n||(n=new Map),n):null}async function o(){if(!i)return null;if(r)return a;try{let t=process.env.REDIS_URL;if(!t)return console.log("[DB] Redis URL not configured, using in-memory cache"),r=!0,null;let{Redis:n}=await e.A(443460);return(a=new n(t,{retryStrategy:e=>Math.min(50*e,2e3),maxRetriesPerRequest:3})).on("error",e=>{console.error("[Redis] Connection error:",e),a=null}),console.log("[DB] Redis cache initialized"),r=!0,a}catch(e){return console.warn("[DB] Failed to initialize Redis, using in-memory cache"),r=!0,null}}if(i)try{let{drizzleDb:t}=e.r(738597);console.log("[DB] Drizzle client (default db) initialized")}catch(e){console.error("[DB] Failed to initialize Drizzle:",e)}e.s(["cache",0,{ensureRedis:async()=>i?(r||await o(),a):null,async get(e){if(!i)return null;let a=t+e,n=await this.ensureRedis();if(n)try{let e=await n.get(a);if(e)return JSON.parse(e)}catch(e){console.error("[Cache] Redis get error:",e)}let r=s();if(!r)return null;let o=r.get(a);return o&&o.expires>Date.now()?o.data:(r.delete(a),null)},async set(e,a,n=60){if(!i)return;let r=t+e,o=await this.ensureRedis();if(o)try{await o.setex(r,n,JSON.stringify(a));return}catch(e){console.error("[Cache] Redis set error:",e)}let l=s();l&&l.set(r,{data:a,expires:Date.now()+1e3*n})},async delete(e){if(!i)return;let a=t+e,n=await this.ensureRedis();if(n)try{await n.del(a)}catch(e){console.error("[Cache] Redis del error:",e)}let r=s();r&&r.delete(a)},async clear(){if(!i)return;let e=await this.ensureRedis();if(e)try{let a=await e.keys(t+"*");a.length>0&&await e.del(...a)}catch(e){console.error("[Cache] Redis clear error:",e)}let a=s();a&&a.clear()},async getOrSet(e,t,a=60){let n=await this.get(e);if(null!==n)return n;let r=await t();return await this.set(e,r,a),r},async invalidatePattern(e){if(!i)return;let a=await this.ensureRedis();if(a)try{let n=await a.keys(t+e);n.length>0&&await a.del(...n)}catch(e){console.error("[Cache] Pattern invalidation error:",e)}let n=s();if(n){let a=new RegExp(t+e.replace("*",".*"));for(let e of n.keys())a.test(e)&&n.delete(e)}}}])},950717,e=>e.a(async(t,a)=>{try{var n=e.i(620971),r=e.i(384030),i=e.i(738597);e.i(688768);var s=e.i(257357),o=e.i(748846),l=e.i(841195),c=e.i(254799),d=t([r,i]);[r,i]=d.then?(await d)():d;let p=l.z.object({type:l.z.enum(["performance","engagement","difficulty","recommendations"]),courseId:l.z.string().optional(),studentIds:l.z.array(l.z.string()).optional(),timeRange:l.z.enum(["week","month","semester"]).default("month"),context:l.z.string().optional()});async function u(e,t){return[{studentName:"Alice Zhang",scores:[85,88,92,90],attendance:95,participation:90},{studentName:"Bob Li",scores:[72,75,78,80],attendance:85,participation:70},{studentName:"Carol Wang",scores:[90,88,85,87],attendance:98,participation:85},{studentName:"David Chen",scores:[65,68,70,72],attendance:75,participation:60},{studentName:"Emma Liu",scores:[95,96,94,98],attendance:100,participation:95}]}let h=(0,r.withAuth)(async(e,t)=>{let a=t.user.id;try{var r,l;let t,d,h=await e.json(),m=p.safeParse(h);if(!m.success)return n.NextResponse.json({error:"Invalid request",details:m.error.format()},{status:400});let g=m.data,f=await u(a,g);if(0===f.length)return n.NextResponse.json({error:"No data available for analysis"},{status:404});let y=(r=g.type,l=g.context,t=f.map(e=>`- ${e.studentName}: Scores [${e.scores.join(", ")}], Attendance ${e.attendance}%, Participation ${e.participation}%`).join("\n"),d=`Analyze the following student performance data:

${t}

${l?`Additional Context: ${l}`:""}
`,({performance:`${d}

Provide a comprehensive performance analysis including:
1. Overall class performance summary
2. Individual student highlights (top performers, those needing support)
3. Score trends over time
4. Correlation between attendance/participation and scores
5. 3-5 specific, actionable recommendations

Format as structured analysis with clear headings.`,engagement:`${d}

Analyze student engagement patterns:
1. Identify students with declining engagement
2. Correlate participation with performance
3. Highlight attendance concerns
4. Suggest engagement strategies for different student profiles
5. Early warning signs to watch for

Focus on actionable insights for improving engagement.`,difficulty:`${d}

Analyze where students are struggling:
1. Identify topics/concepts causing difficulty (based on score patterns)
2. Students who may need additional support
3. Prerequisites that might be missing
4. Suggested remediation approaches
5. Differentiation strategies

Be specific about what to teach differently.`,recommendations:`${d}

Based on this data, provide teaching recommendations:
1. Instructional strategies to improve outcomes
2. How to support struggling students
3. Ways to challenge high performers
4. Assessment adjustments
5. Teaching methods to try

Prioritize recommendations by expected impact.`})[r]),R=await (0,o.generateWithFallback)(y,{temperature:.5,maxTokens:2e3}),w=function(e,t){let a=e.split("\n").filter(e=>e.trim()),n=[],r=[],i=[],s="";for(let e of a){let t=e.trim();if(t.match(/^(findings|key findings|analysis|observations)/i)){s="findings";continue}if(t.match(/^(recommendations|suggestions|advice)/i)){s="recommendations";continue}if(t.match(/^(action items|next steps|to do)/i)){s="actions";continue}if(t.startsWith("-")||t.startsWith("•")||/^\d+\./.test(t)){let e=t.replace(/^[-•\d.\s]+/,"").trim();if("findings"===s)n.push(e);else if("recommendations"===s)r.push(e);else if("actions"===s){let a=t.toLowerCase().includes("urgent")||t.toLowerCase().includes("immediate")?"high":t.toLowerCase().includes("consider")||t.toLowerCase().includes("optional")?"low":"medium";i.push({priority:a,action:e})}}}return{summary:a.slice(0,3).join(" ").slice(0,200),keyFindings:n.slice(0,6),recommendations:r.slice(0,5),actionItems:i.length>0?i:[{priority:"high",action:"Review analysis with students"},{priority:"medium",action:"Implement suggested strategies"}],trends:[{direction:"improving",metric:"Average scores",description:"Overall upward trend"}]}}(R.content,g.type);try{await i.drizzleDb.insert(s.aIAssistantInsight).values({id:(0,c.randomUUID)(),sessionId:h.sessionId||"temp",type:"student_analysis",title:`${g.type.charAt(0).toUpperCase()+g.type.slice(1)} Analysis`,content:w.summary,relatedData:{analysisType:g.type,timeRange:g.timeRange,studentCount:f.length},applied:!1})}catch{}return n.NextResponse.json({analysis:w,rawResponse:R.content,metadata:{type:g.type,studentCount:f.length,provider:R.provider,latencyMs:R.latencyMs,generatedAt:new Date().toISOString()}})}catch(e){return console.error("Analysis error:",e),n.NextResponse.json({error:"Failed to generate analysis"},{status:500})}},{role:"TUTOR"});e.s(["POST",0,h]),a()}catch(e){a(e)}},!1),305934,e=>e.a(async(t,a)=>{try{var n=e.i(78315),r=e.i(586961),i=e.i(196657),s=e.i(899733),o=e.i(233979),l=e.i(631683),c=e.i(840960),d=e.i(711373),u=e.i(699699),p=e.i(521140),h=e.i(205260),m=e.i(500249),g=e.i(431740),f=e.i(82608),y=e.i(635207),R=e.i(193695);e.i(708038);var w=e.i(447430),v=e.i(950717),C=t([v]);[v]=C.then?(await C)():C;let E=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/tutor/ai-assistant/analyze/route",pathname:"/api/tutor/ai-assistant/analyze",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/ai-assistant/analyze/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:_,workUnitAsyncStorage:b,serverHooks:P}=E;function x(){return(0,i.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:b})}async function A(e,t,a){E.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/tutor/ai-assistant/analyze/route";n=n.replace(/\/index$/,"")||"/";let i=await E.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:C,nextConfig:x,parsedUrl:A,isDraftMode:_,prerenderManifest:b,routerServerContext:P,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,resolvedPathname:T,clientReferenceManifest:D,serverActionsManifest:I}=i,O=(0,c.normalizeAppPath)(n),k=!!(b.dynamicRoutes[O]||b.routes[T]),z=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,A,!1):t.end("This page could not be found"),null);if(k&&!_){let e=!!b.routes[T],t=b.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await z();throw new R.NoFallbackError}}let U=null;!k||E.isDev||_||(U=T,U="/index"===U?"/":U);let $=!0===E.isDev||!k,j=k&&!$;I&&D&&(0,l.setManifestsSingleton)({page:n,clientReferenceManifest:D,serverActionsManifest:I});let q=e.method||"GET",H=(0,o.getTracer)(),M=H.getActiveScopeSpan(),F={params:C,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,r)=>E.onRequestError(e,t,n,r,P)},sharedContext:{buildId:v}},B=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let i=async e=>E.handle(K,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${n}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var o,c;let d=async({previousCacheEntry:r})=>{try{if(!l&&N&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let o=F.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let c=F.renderOpts.collectedTags;if(!k)return await (0,m.sendResponse)(B,L,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:N})},!1,P),t}},u=await E.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!k)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&k||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(B,L,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};M?await c(M):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},c))}catch(t){if(t instanceof R.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:N})},!1,P),k)throw t;return await (0,m.sendResponse)(B,L,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>x,"routeModule",()=>E,"serverHooks",()=>P,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>b]),a()}catch(e){a(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=06824a82-25f7-7a42-df76-003d79d2d730
//# sourceMappingURL=%5Broot-of-the-server%5D__391b2a26._.js.map