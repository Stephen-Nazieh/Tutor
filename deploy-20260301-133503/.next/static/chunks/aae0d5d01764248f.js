;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="fbe6b65c-9295-e75c-9a30-0f7ec20f016e")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,985213,e=>{"use strict";var t=e.i(251474),r=e.i(800592),a=e.i(177873),n=e.i(196415),i=e.i(870368),s=e.i(587604),l=e.i(785784),o=e.i(252186);function c({roomId:e}){let[c,d]=(0,r.useState)(""),[u,f]=(0,r.useState)(""),[p,h]=(0,r.useState)("Idle"),[m,g]=(0,r.useState)("unknown"),[b,y]=(0,r.useState)(null),w=async e=>{let t=e.target.files?.[0];if(!t)return;let r=new FormData;r.append("file",t),h("Extracting text...");let a=await fetch("/api/pdf-tutoring/extract",{method:"POST",body:r}),n=await a.json();d(n.markdown||n.text||""),g(n.parser||"unknown"),y(n.technologyCheck||null),h(a.ok?"Text extracted":"Extraction failed")},x=async e=>{let t=e.target.files?.[0];if(!t)return;let r=new FormData;r.append("file",t),h("Preprocessing image...");let a=await fetch("/api/pdf-tutoring/preprocess",{method:"POST",body:r});if(!a.ok)return void h("Preprocess failed");let n=await a.blob();f(URL.createObjectURL(n)),h("Image preprocessed")};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"AI Tutoring Engine - PDF Workbench"})}),(0,t.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(l.Badge,{variant:"outline",children:["Room: ",e]}),(0,t.jsx)(l.Badge,{children:p})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2 rounded-md border p-3",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Document Pipeline"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)(l.Badge,{variant:"secondary",children:["Parser: ",m]}),b&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Badge,{variant:b.unpdfAvailable?"default":"outline",children:["unpdf ",b.unpdfAvailable?"on":"off"]}),(0,t.jsxs)(l.Badge,{variant:b.pdfParseAvailable?"default":"outline",children:["pdf-parse ",b.pdfParseAvailable?"on":"off"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(s.Input,{type:"file",accept:"application/pdf",onChange:w}),(0,t.jsx)(s.Input,{type:"file",accept:"image/*",onChange:x})]}),c&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.length," chars extracted"]}),(0,t.jsx)(i.Button,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(c),h("Extracted text copied")},children:"Copy text"})]}),(0,t.jsx)("pre",{className:"max-h-48 overflow-auto rounded bg-muted p-2 text-xs whitespace-pre-wrap",children:c})]}),u&&(0,t.jsx)(a.default,{src:u,alt:"Preprocessed homework",width:512,height:320,className:"max-h-48 w-auto rounded border",unoptimized:!0})]}),(0,t.jsxs)("div",{className:"space-y-2 rounded-md border p-3",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Live Collaboration + Marking"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Includes lock/unlock, mode toggles, low-latency sync broadcast, and PDF flattening output."}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>h("Ready for live tutoring"),children:"Prepare Session"})]})]})]})]}),(0,t.jsx)(o.PDFCollaborativeViewer,{roomId:e})]})}e.s(["PDFTutoringWorkbench",()=>c])},3439,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return l}});let a=e.r(800592),n="u"<typeof window,i=n?()=>{}:a.useLayoutEffect,s=n?()=>{}:a.useEffect;function l(e){let{headManager:t,reduceComponentsToState:r}=e;function l(){if(t&&t.mountedInstances){let e=a.Children.toArray(Array.from(t.mountedInstances).filter(Boolean));t.updateHead(r(e))}}return n&&(t?.mountedInstances?.add(e.children),l()),i(()=>(t?.mountedInstances?.add(e.children),()=>{t?.mountedInstances?.delete(e.children)})),i(()=>(t&&(t._pendingUpdate=l),()=>{t&&(t._pendingUpdate=l)})),s(()=>(t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null),()=>{t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null)})),null}},907671,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={default:function(){return m},defaultHead:function(){return u}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let i=e.r(39736),s=e.r(591995),l=e.r(251474),o=s._(e.r(800592)),c=i._(e.r(3439)),d=e.r(928605);function u(){return[(0,l.jsx)("meta",{charSet:"utf-8"},"charset"),(0,l.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function f(e,t){return"string"==typeof t||"number"==typeof t?e:t.type===o.default.Fragment?e.concat(o.default.Children.toArray(t.props.children).reduce((e,t)=>"string"==typeof t||"number"==typeof t?e:e.concat(t),[])):e.concat(t)}e.r(388117);let p=["name","httpEquiv","charSet","itemProp"];function h(e){let t,r,a,n;return e.reduce(f,[]).reverse().concat(u().reverse()).filter((t=new Set,r=new Set,a=new Set,n={},e=>{let i=!0,s=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){s=!0;let r=e.key.slice(e.key.indexOf("$")+1);t.has(r)?i=!1:t.add(r)}switch(e.type){case"title":case"base":r.has(e.type)?i=!1:r.add(e.type);break;case"meta":for(let t=0,r=p.length;t<r;t++){let r=p[t];if(e.props.hasOwnProperty(r))if("charSet"===r)a.has(r)?i=!1:a.add(r);else{let t=e.props[r],a=n[r]||new Set;("name"!==r||!s)&&a.has(t)?i=!1:(a.add(t),n[r]=a)}}}return i})).reverse().map((e,t)=>{let r=e.key||t;return o.default.cloneElement(e,{key:r})})}let m=function({children:e}){let t=(0,o.useContext)(d.HeadManagerContext);return(0,l.jsx)(c.default,{reduceComponentsToState:h,headManager:t,children:e})};("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},908083,(e,t,r)=>{"use strict";function a({widthInt:e,heightInt:t,blurWidth:r,blurHeight:a,blurDataURL:n,objectFit:i}){let s=r?40*r:e,l=a?40*a:t,o=s&&l?`viewBox='0 0 ${s} ${l}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${o}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${o?"none":"contain"===i?"xMidYMid":"cover"===i?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${n}'/%3E%3C/svg%3E`}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getImageBlurSvg",{enumerable:!0,get:function(){return a}})},10673,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={VALID_LOADERS:function(){return i},imageConfigDefault:function(){return s}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let i=["default","imgix","cloudinary","akamai","custom"],s={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,maximumResponseBody:5e7,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},499202,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getImgProps",{enumerable:!0,get:function(){return c}}),e.r(388117);let a=e.r(930273),n=e.r(908083),i=e.r(10673),s=["-moz-initial","fill","none","scale-down",void 0];function l(e){return void 0!==e.default}function o(e){return void 0===e?e:"number"==typeof e?Number.isFinite(e)?e:NaN:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function c({src:e,sizes:t,unoptimized:r=!1,priority:c=!1,preload:d=!1,loading:u,className:f,quality:p,width:h,height:m,fill:g=!1,style:b,overrideSrc:y,onLoad:w,onLoadingComplete:x,placeholder:v="empty",blurDataURL:j,fetchPriority:C,decoding:k="async",layout:S,objectFit:_,objectPosition:P,lazyBoundary:O,lazyRoot:A,...E},N){var I;let R,z,M,{imgConf:D,showAltText:T,blurComplete:B,defaultLoader:$}=N,F=D||i.imageConfigDefault;if("allSizes"in F)R=F;else{let e=[...F.deviceSizes,...F.imageSizes].sort((e,t)=>e-t),t=F.deviceSizes.sort((e,t)=>e-t),r=F.qualities?.sort((e,t)=>e-t);R={...F,allSizes:e,deviceSizes:t,qualities:r}}if(void 0===$)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let W=E.loader||$;delete E.loader,delete E.srcSet;let L="__next_img_default"in W;if(L){if("custom"===R.loader)throw Object.defineProperty(Error(`Image with src "${e}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let e=W;W=t=>{let{config:r,...a}=t;return e(a)}}if(S){"fill"===S&&(g=!0);let e={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[S];e&&(b={...b,...e});let r={responsive:"100vw",fill:"100vw"}[S];r&&!t&&(t=r)}let U="",H=o(h),q=o(m);if((I=e)&&"object"==typeof I&&(l(I)||void 0!==I.src)){let t=l(e)?e.default:e;if(!t.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!t.height||!t.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(z=t.blurWidth,M=t.blurHeight,j=j||t.blurDataURL,U=t.src,!g)if(H||q){if(H&&!q){let e=H/t.width;q=Math.round(t.height*e)}else if(!H&&q){let e=q/t.height;H=Math.round(t.width*e)}}else H=t.width,q=t.height}let V=!c&&!d&&("lazy"===u||void 0===u);(!(e="string"==typeof e?e:U)||e.startsWith("data:")||e.startsWith("blob:"))&&(r=!0,V=!1),R.unoptimized&&(r=!0),L&&!R.dangerouslyAllowSVG&&e.split("?",1)[0].endsWith(".svg")&&(r=!0);let G=o(p),J=Object.assign(g?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:_,objectPosition:P}:{},T?{}:{color:"transparent"},b),X=B||"empty"===v?null:"blur"===v?`url("data:image/svg+xml;charset=utf-8,${(0,n.getImageBlurSvg)({widthInt:H,heightInt:q,blurWidth:z,blurHeight:M,blurDataURL:j||"",objectFit:J.objectFit})}")`:`url("${v}")`,Y=s.includes(J.objectFit)?"fill"===J.objectFit?"100% 100%":"cover":J.objectFit,K=X?{backgroundSize:Y,backgroundPosition:J.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:X}:{},Q=function({config:e,src:t,unoptimized:r,width:n,quality:i,sizes:s,loader:l}){if(r){let e=(0,a.getDeploymentId)();if(t.startsWith("/")&&!t.startsWith("//")&&e){let r=t.includes("?")?"&":"?";t=`${t}${r}dpl=${e}`}return{src:t,srcSet:void 0,sizes:void 0}}let{widths:o,kind:c}=function({deviceSizes:e,allSizes:t},r,a){if(a){let r=/(^|\s)(1?\d?\d)vw/g,n=[];for(let e;e=r.exec(a);)n.push(parseInt(e[2]));if(n.length){let r=.01*Math.min(...n);return{widths:t.filter(t=>t>=e[0]*r),kind:"w"}}return{widths:t,kind:"w"}}return"number"!=typeof r?{widths:e,kind:"w"}:{widths:[...new Set([r,2*r].map(e=>t.find(t=>t>=e)||t[t.length-1]))],kind:"x"}}(e,n,s),d=o.length-1;return{sizes:s||"w"!==c?s:"100vw",srcSet:o.map((r,a)=>`${l({config:e,src:t,quality:i,width:r})} ${"w"===c?r:a+1}${c}`).join(", "),src:l({config:e,src:t,quality:i,width:o[d]})}}({config:R,src:e,unoptimized:r,width:H,quality:G,sizes:t,loader:W}),Z=V?"lazy":u;return{props:{...E,loading:Z,fetchPriority:C,width:H,height:q,decoding:k,className:f,style:{...J,...K},sizes:Q.sizes,srcSet:Q.srcSet,src:y||Q.src},meta:{unoptimized:r,preload:d||c,placeholder:v,fill:g}}}},25252,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ImageConfigContext",{enumerable:!0,get:function(){return i}});let a=e.r(39736)._(e.r(800592)),n=e.r(10673),i=a.default.createContext(n.imageConfigDefault)},276813,(e,t,r)=>{"use strict";function a(e,t){let r=e||75;return t?.qualities?.length?t.qualities.reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e,0):r}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"findClosestQuality",{enumerable:!0,get:function(){return a}})},204996,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s}});let a=e.r(276813),n=e.r(930273);function i({config:e,src:t,width:r,quality:i}){if(t.startsWith("/")&&t.includes("?")&&e.localPatterns?.length===1&&"**"===e.localPatterns[0].pathname&&""===e.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${t}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let s=(0,a.findClosestQuality)(i,e),l=(0,n.getDeploymentId)();return`${e.path}?url=${encodeURIComponent(t)}&w=${r}&q=${s}${t.startsWith("/")&&l?`&dpl=${l}`:""}`}i.__next_img_default=!0;let s=i},894533,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Image",{enumerable:!0,get:function(){return x}});let a=e.r(39736),n=e.r(591995),i=e.r(251474),s=n._(e.r(800592)),l=a._(e.r(312515)),o=a._(e.r(907671)),c=e.r(499202),d=e.r(10673),u=e.r(25252);e.r(388117);let f=e.r(549916),p=a._(e.r(204996)),h=e.r(741299),m={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function g(e,t,r,a,n,i,s){let l=e?.src;e&&e["data-loaded-src"]!==l&&(e["data-loaded-src"]=l,("decode"in e?e.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(e.parentElement&&e.isConnected){if("empty"!==t&&n(!0),r?.current){let t=new Event("load");Object.defineProperty(t,"target",{writable:!1,value:e});let a=!1,n=!1;r.current({...t,nativeEvent:t,currentTarget:e,target:e,isDefaultPrevented:()=>a,isPropagationStopped:()=>n,persist:()=>{},preventDefault:()=>{a=!0,t.preventDefault()},stopPropagation:()=>{n=!0,t.stopPropagation()}})}a?.current&&a.current(e)}}))}function b(e){return s.use?{fetchPriority:e}:{fetchpriority:e}}"u"<typeof window&&(globalThis.__NEXT_IMAGE_IMPORTED=!0);let y=(0,s.forwardRef)(({src:e,srcSet:t,sizes:r,height:a,width:n,decoding:l,className:o,style:c,fetchPriority:d,placeholder:u,loading:f,unoptimized:p,fill:m,onLoadRef:y,onLoadingCompleteRef:w,setBlurComplete:x,setShowAltText:v,sizesInput:j,onLoad:C,onError:k,...S},_)=>{let P=(0,s.useCallback)(e=>{e&&(k&&(e.src=e.src),e.complete&&g(e,u,y,w,x,p,j))},[e,u,y,w,x,k,p,j]),O=(0,h.useMergedRef)(_,P);return(0,i.jsx)("img",{...S,...b(d),loading:f,width:n,height:a,decoding:l,"data-nimg":m?"fill":"1",className:o,style:c,sizes:r,srcSet:t,src:e,ref:O,onLoad:e=>{g(e.currentTarget,u,y,w,x,p,j)},onError:e=>{v(!0),"empty"!==u&&x(!0),k&&k(e)}})});function w({isAppRouter:e,imgAttributes:t}){let r={as:"image",imageSrcSet:t.srcSet,imageSizes:t.sizes,crossOrigin:t.crossOrigin,referrerPolicy:t.referrerPolicy,...b(t.fetchPriority)};return e&&l.default.preload?(l.default.preload(t.src,r),null):(0,i.jsx)(o.default,{children:(0,i.jsx)("link",{rel:"preload",href:t.srcSet?void 0:t.src,...r},"__nimg-"+t.src+t.srcSet+t.sizes)})}let x=(0,s.forwardRef)((e,t)=>{let r=(0,s.useContext)(f.RouterContext),a=(0,s.useContext)(u.ImageConfigContext),n=(0,s.useMemo)(()=>{let e=m||a||d.imageConfigDefault,t=[...e.deviceSizes,...e.imageSizes].sort((e,t)=>e-t),r=e.deviceSizes.sort((e,t)=>e-t),n=e.qualities?.sort((e,t)=>e-t);return{...e,allSizes:t,deviceSizes:r,qualities:n,localPatterns:"u"<typeof window?a?.localPatterns:e.localPatterns}},[a]),{onLoad:l,onLoadingComplete:o}=e,h=(0,s.useRef)(l);(0,s.useEffect)(()=>{h.current=l},[l]);let g=(0,s.useRef)(o);(0,s.useEffect)(()=>{g.current=o},[o]);let[b,x]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),{props:C,meta:k}=(0,c.getImgProps)(e,{defaultLoader:p.default,imgConf:n,blurComplete:b,showAltText:v});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y,{...C,unoptimized:k.unoptimized,placeholder:k.placeholder,fill:k.fill,onLoadRef:h,onLoadingCompleteRef:g,setBlurComplete:x,setShowAltText:j,sizesInput:e.sizes,ref:t}),k.preload?(0,i.jsx)(w,{isAppRouter:!r,imgAttributes:C}):null]})});("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},663716,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={default:function(){return d},getImageProps:function(){return c}};for(var n in a)Object.defineProperty(r,n,{enumerable:!0,get:a[n]});let i=e.r(39736),s=e.r(499202),l=e.r(894533),o=i._(e.r(204996));function c(e){let{props:t}=(0,s.getImgProps)(e,{defaultLoader:o.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let d=l.Image},177873,(e,t,r)=>{t.exports=e.r(663716)},249453,e=>{"use strict";let t=(0,e.i(879191).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],249453)},145451,e=>{"use strict";let t=(0,e.i(879191).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],145451)},896098,e=>{"use strict";let t=(0,e.i(879191).default)("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);e.s(["Unlock",()=>t],896098)},252186,102037,e=>{"use strict";var t=e.i(251474),r=e.i(800592),a=e.i(624842),n=e.i(870368),i=e.i(785784),s=e.i(156155),l=e.i(587604),o=e.i(825627),c=e.i(896098),d=e.i(249453),u=e.i(145451),f=e.i(783393);function p(t,a={}){let n=(0,r.useRef)(null),[i,s]=(0,r.useState)(null),[l,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(t)return(async()=>{let r=await e.A(913435).then(e=>e.getSocketToken());if(!r)return;let i=(0,f.io)({path:"/api/socket",transports:["websocket","polling"],timeout:2e4,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:500,auth:{token:r}});n.current=i,i.on("connect",()=>{o(!0),s(i),t&&a.userId&&a.role&&i.emit("join_class",{roomId:t,userId:a.userId,name:a.name||a.role,role:a.role})}),i.on("disconnect",()=>{o(!1),s(null)}),i.on("connect_error",e=>{console.warn("Socket connection error:",e?.message||e),o(!1)})})(),()=>{n.current?.disconnect(),n.current=null}},[t,a.name,a.role,a.userId]),{socket:i,isConnected:l}}function h(e,t){return Number.isFinite(e)&&Number.isFinite(t)&&!(t<=0)?Math.max(0,Math.min(100,e/t*100)):0}function m(e,t){return Number.isFinite(e)&&Number.isFinite(t)&&!(t<=0)?e/100*t:0}async function g(e){try{let t=Function("name","return import(name)");return await t(e)}catch{return null}}function b({roomId:f,role:b="tutor",initialPdfUrl:y,forceLocked:w,showLockControl:x,showCollabStatus:v=!0,showAiActions:j=!0,capabilities:C}){let{data:k}=(0,a.useSession)(),S=(0,r.useRef)(null),_=(0,r.useRef)(null),P=(0,r.useRef)(null),O=(0,r.useRef)(null),A=(0,r.useRef)(0),E=(0,r.useRef)(!1),[N,I]=(0,r.useState)("original"),[R,z]=(0,r.useState)(null),[M,D]=(0,r.useState)(null),[T,B]=(0,r.useState)(1),[$,F]=(0,r.useState)(1),[W,L]=(0,r.useState)(""),[U,H]=(0,r.useState)(""),[q,V]=(0,r.useState)(!1),[G,J]=(0,r.useState)("draw"),[X,Y]=(0,r.useState)("#ef4444"),[K,Q]=(0,r.useState)(2),Z=k?.user?.id,ee=k?.user?.name||"Tutor",et=(0,r.useMemo)(()=>({draw:C?.draw??!0,erase:C?.erase??!0,select:C?.select??!0,text:C?.text??!0,shapes:C?.shapes??!0,clear:C?.clear??!0,flatten:C?.flatten??!0}),[C]),er=(0,r.useCallback)((e,t,r)=>{let a={...e,..."number"==typeof e.left?{left:m(e.left,t)}:{},..."number"==typeof e.top?{top:m(e.top,r)}:{},..."number"==typeof e.width?{width:m(e.width,t)}:{},..."number"==typeof e.height?{height:m(e.height,r)}:{},..."number"==typeof e.radius?{radius:m(e.radius,Math.min(t,r))}:{},..."number"==typeof e.strokeWidth?{strokeWidth:m(e.strokeWidth,Math.min(t,r))}:{},..."number"==typeof e.fontSize?{fontSize:m(e.fontSize,r)}:{}};return Array.isArray(a.points)&&(a.points=a.points.map(e=>({x:m(e.x,t),y:m(e.y,r)}))),Array.isArray(a.path)&&(a.path=a.path.map(e=>{if(!Array.isArray(e)||e.length<3)return e;let[a,...n]=e,i=[String(a)];for(let e=0;e<n.length;e+=2){let a=Number(n[e]),s=Number(n[e+1]);i.push(m(a,t),m(s,r))}return i})),a},[]),ea=(0,r.useCallback)((e,t,r)=>{let a=e.toObject(["id","type","left","top","width","height","radius","scaleX","scaleY","strokeWidth","fontSize","angle","fill","stroke","text","path","points"]),n={...a,id:a.id||`${Date.now()}-${Math.random().toString(16).slice(2)}`,..."number"==typeof a.left?{left:h(a.left,t)}:{},..."number"==typeof a.top?{top:h(a.top,r)}:{},..."number"==typeof a.width?{width:h(a.width,t)}:{},..."number"==typeof a.height?{height:h(a.height,r)}:{},..."number"==typeof a.radius?{radius:h(a.radius,Math.min(t,r))}:{},..."number"==typeof a.strokeWidth?{strokeWidth:h(a.strokeWidth,Math.min(t,r))}:{},..."number"==typeof a.fontSize?{fontSize:h(a.fontSize,r)}:{}};return Array.isArray(n.points)&&(n.points=n.points.map(e=>({x:h(e.x,t),y:h(e.y,r)}))),Array.isArray(n.path)&&(n.path=n.path.map(e=>{if(!Array.isArray(e)||e.length<3)return e;let[a,...n]=e,i=[String(a)];for(let e=0;e<n.length;e+=2){let a=Number(n[e]),s=Number(n[e+1]);i.push(h(a,t),h(s,r))}return i})),n},[]),en=(0,r.useCallback)(async e=>{if(e.page!==T)return;let t=P.current;if(t&&e.actorId!==Z){E.current=!0;try{if("removed"===e.action&&e.objectId){let r=t.getObjects().find(t=>t.id===e.objectId);r&&(t.remove(r),t.renderAll());return}if(!e.object)return;let r=t.getWidth(),a=t.getHeight(),n=er(e.object,r,a);if(!n.id)return;let i=t.getObjects().find(e=>e.id===n.id);if(i){i.set(n),i.setCoords(),t.renderAll();return}let s=await g("fabric"),l=s?.fabric||s,o=l?.util?.enlivenObjects;"function"==typeof o&&o([n],e=>{e?.[0]&&(t.add(e[0]),t.renderAll())})}finally{setTimeout(()=>{E.current=!1},16)}}},[er,T,Z]),{isConnected:ei,isLocked:es,latencyMs:el,participants:eo,emitCanvasEvent:ec,setLock:ed}=function({roomId:e,userId:t,name:a,role:n="tutor",onCanvasEvent:i,onCanvasState:s,onPresenceState:l}){let{socket:o,isConnected:c}=p(e,{userId:t,name:a,role:n}),[d,u]=(0,r.useState)(!1),[f,h]=(0,r.useState)(null),[m,g]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!o||!e)return;o.emit("pdf_join_room",{roomId:e,userId:t,name:a,role:n});let r=e=>{"number"==typeof e.sentAt&&h(Math.max(0,Date.now()-e.sentAt)),i?.(e)},c=t=>{t.roomId===e&&u(t.locked)},d=t=>{t.roomId===e&&s?.(t)},f=t=>{t.roomId===e&&(g(t.participants||[]),l?.(t))};return o.on("pdf_canvas_event",r),o.on("pdf_lock_state",c),o.on("pdf_canvas_state",d),o.on("pdf_presence_state",f),o.emit("pdf_request_state",{roomId:e}),()=>{o.off("pdf_canvas_event",r),o.off("pdf_lock_state",c),o.off("pdf_canvas_state",d),o.off("pdf_presence_state",f)}},[o,e,t,a,n,i,s,l]);let b=(0,r.useCallback)(r=>{o&&e&&o.emit("pdf_canvas_event",{roomId:e,actorId:t,sentAt:Date.now(),...r})},[o,e,t]),y=(0,r.useCallback)(t=>{o&&e&&o.emit("pdf_lock_toggle",{roomId:e,locked:t})},[o,e]);return(0,r.useMemo)(()=>({socket:o,isConnected:c,isLocked:d,latencyMs:f,participants:m,emitCanvasEvent:b,setLock:y}),[o,c,d,f,m,b,y])}({roomId:f,userId:Z,name:ee,role:b,onCanvasEvent:en,onCanvasState:(0,r.useCallback)(async e=>{let t=P.current;if(!t)return;let r=new Map;for(let t of e.events)if(t.page===T&&t.objectId){if("removed"===t.action){r.delete(t.objectId);continue}r.set(t.objectId,t)}E.current=!0;try{t.clear();let e=t.getWidth(),a=t.getHeight(),n=await g("fabric"),i=n?.fabric||n,s=i?.util?.enlivenObjects;if("function"!=typeof s)return;let l=Array.from(r.values()).map(e=>e.object).filter(e=>!!e).map(t=>er(t,e,a));s(l,e=>{e.forEach(e=>t.add(e)),t.renderAll()})}finally{setTimeout(()=>{E.current=!1},16)}},[er,T])}),eu="boolean"==typeof w?w:es,ef=et.draw&&!eu,ep=et.erase&&!eu,eh=et.select&&!eu;(0,r.useEffect)(()=>{"draw"!==G||et.draw?"erase"!==G||et.erase?"select"!==G||et.select||J(et.draw?"draw":"erase"):J(et.draw?"draw":"select"):J(et.erase?"erase":"select")},[et.draw,et.erase,et.select,G]);let em=(0,r.useCallback)(async(e,t)=>{let r=S.current;if(!r||!e)return;let a=++A.current;if(O.current){try{O.current.cancel?.()}catch{}O.current=null}let n=await e.getPage(t),i=n.getViewport({scale:1.35});r.width=i.width,r.height=i.height;let s=r.getContext("2d");if(!s)return;let l=n.render({canvasContext:s,viewport:i});O.current=l;try{await l.promise}catch(e){if(e?.name==="RenderingCancelledException")return;throw e}finally{O.current===l&&(O.current=null)}if(A.current!==a)return;let o=_.current;o&&(o.width=i.width,o.height=i.height,o.style.width=`${i.width}px`,o.style.height=`${i.height}px`),P.current&&(P.current.setDimensions({width:i.width,height:i.height}),P.current.renderAll())},[]),eg=(0,r.useCallback)(async()=>{if(_.current&&!P.current)try{let e=await g("fabric"),t=e?.fabric||e;if(!t?.Canvas){console.error("[PDFCollaborativeViewer] fabric library not found. Please run: npm install fabric"),V(!1);return}let r=new t.Canvas(_.current,{isDrawingMode:!0,selection:!0});r.freeDrawingBrush.width=2,r.freeDrawingBrush.color="#ef4444",P.current=r,V(!0);let a=(e,t)=>{if(!t||E.current)return;let a=r.getWidth(),n=r.getHeight(),i=ea(t,a,n);t.id=i.id,ec({page:T,action:e,object:i,objectId:i.id})};return r.on("path:created",e=>{e?.path&&a("created",e.path)}),r.on("object:modified",e=>a("modified",e?.target)),r.on("object:removed",e=>a("removed",e?.target)),()=>{r.dispose(),P.current=null,V(!1)}}catch(e){console.error("[PDFCollaborativeViewer] Error initializing fabric:",e),V(!1)}},[ec,T,ea]);(0,r.useEffect)(()=>{let e;return eg().then(t=>{"function"==typeof t&&(e=t)}).catch(()=>{V(!1)}),()=>{if(O.current){try{O.current.cancel?.()}catch{}O.current=null}e?.()}},[eg]),(0,r.useEffect)(()=>{if(P.current){let e="draw"===G&&ef||"erase"===G&&ep;P.current.isDrawingMode=e,P.current.selection=eh,P.current.freeDrawingBrush&&(P.current.freeDrawingBrush.width=K,P.current.freeDrawingBrush.color="erase"===G?"#ffffff":X)}},[ef,ep,eh,X,K,G]),(0,r.useEffect)(()=>{M&&em(M,T)},[M,T,em]);let eb=async t=>{let r=t.target.files?.[0];if(!r)return;let a=await r.arrayBuffer();z(a);let n=await e.A(212496),i=n.GlobalWorkerOptions;i&&!i.workerSrc&&(i.workerSrc="/pdf.worker.min.mjs");let s=await n.getDocument({data:a}).promise;D(s),F(s.numPages),B(1),await em(s,1)};(0,r.useEffect)(()=>{if(!y)return;let t=!1;return(async()=>{try{let r=await fetch(y,{credentials:"include"});if(!r.ok)return;let a=await r.arrayBuffer();if(t)return;z(a);let n=await e.A(212496),i=n.GlobalWorkerOptions;i&&!i.workerSrc&&(i.workerSrc="/pdf.worker.min.mjs");let s=await n.getDocument({data:a}).promise;if(t)return;D(s),F(s.numPages),B(1),await em(s,1)}catch{}})(),()=>{t=!0}},[y,em]);let ey=async()=>{let e=S.current?.toDataURL("image/png");if(!e)return;let t=await fetch("/api/pdf-tutoring/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageDataUrl:e})}),r=await t.json();L(r.markdown||r.content||""),I("cleaned")},ew=async()=>{let e=S.current?.toDataURL("image/png");if(!e)return;let t=await fetch("/api/pdf-tutoring/mark",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageDataUrl:e,rubric:"Award partial credit for correct setup and intermediate algebraic transformations."})}),r=await t.json();H(JSON.stringify(r.result||r,null,2)),I("marked")},ex=async()=>{let e=P.current;if(!e||!U)return;let t=null;try{t=JSON.parse(U)}catch{return}let r=Array.isArray(t?.mistakeLocations)?t.mistakeLocations:[];if(0===r.length)return;let a=await g("fabric"),n=a?.fabric||a;if(!n?.Circle)return;let i=e.getWidth(),s=e.getHeight();r.forEach((t,r)=>{let a="number"==typeof t?.x?t.x:40+30*r,l="number"==typeof t?.y?t.y:40+22*r,o=a<=100?m(a,i):a,c=l<=100?m(l,s):l,d=new n.Circle({id:`ai-mistake-${Date.now()}-${r}`,left:Math.max(8,o-18),top:Math.max(8,c-18),radius:18,fill:"rgba(239,68,68,0.06)",stroke:"#ef4444",strokeWidth:2,selectable:!0});e.add(d)}),e.renderAll()},ev=async()=>{if(!R||!P.current)return;let e=new Uint8Array(R),t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);let r=btoa(t),a=P.current,n={originalPdfBase64:r,fabric:{page:T,width:a.getWidth(),height:a.getHeight(),objects:a.getObjects().map(e=>ea(e,a.getWidth(),a.getHeight()))}},i=await fetch("/api/pdf-tutoring/flatten",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)return;let s=await i.blob(),l=URL.createObjectURL(s);window.open(l,"_blank","noopener,noreferrer")},ej=async()=>{let e=P.current;if(!e||eu||!et.text)return;let t=await g("fabric"),r=t?.fabric||t;if(!r?.IText)return;let a=new r.IText("Type here",{id:`text-${Date.now()}`,left:48,top:48,fill:"#ef4444",fontSize:20,editable:!0});e.add(a),e.setActiveObject(a),a.enterEditing?.(),e.renderAll()},eC=async()=>{let e=P.current;if(!e||eu||!et.shapes)return;let t=await g("fabric"),r=t?.fabric||t;if(!r?.Rect)return;let a=new r.Rect({id:`rect-${Date.now()}`,left:48,top:48,width:140,height:90,fill:"transparent",stroke:X,strokeWidth:K});e.add(a),e.setActiveObject(a),e.renderAll()},ek=async()=>{let e=P.current;if(!e||eu||!et.shapes)return;let t=await g("fabric"),r=t?.fabric||t;if(!r?.Circle)return;let a=new r.Circle({id:`circle-${Date.now()}`,left:48,top:48,radius:55,fill:"transparent",stroke:X,strokeWidth:K});e.add(a),e.setActiveObject(a),e.renderAll()},eS=(0,r.useCallback)(async()=>{let e=P.current;e&&await fetch("/api/pdf-tutoring/snapshots",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:f,page:T,width:e.getWidth(),height:e.getHeight(),objects:e.getObjects().map(t=>ea(t,e.getWidth(),e.getHeight()))})})},[f,T,ea]);(0,r.useEffect)(()=>{if("tutor"!==b)return;let e=setInterval(()=>{let e=P.current;e&&0!==(e.getObjects?.()||[]).length&&eS()},6e4);return()=>clearInterval(e)},[b,eS]);let e_=async()=>{let e=P.current;if(!e)return;let t=await fetch(`/api/pdf-tutoring/snapshots?roomId=${encodeURIComponent(f)}&limit=1`,{credentials:"include"});if(!t.ok)return;let r=await t.json(),a=r?.snapshots?.[0],n=a?.pages?.[0];if(!n?.objects||!Array.isArray(n.objects))return;e.clear();let i=e.getWidth(),s=e.getHeight(),l=await g("fabric"),o=l?.fabric||l,c=o?.util?.enlivenObjects;"function"!=typeof c||c(n.objects.map(e=>er(e,i,s)),t=>{t.forEach(t=>e.add(t)),e.renderAll()})},eP=(0,r.useMemo)(()=>ei?null!==el&&el>50?(0,t.jsxs)(i.Badge,{variant:"secondary",children:["Sync ",el,"ms"]}):(0,t.jsx)(i.Badge,{variant:"default",children:"Sync <50ms"}):(0,t.jsx)(i.Badge,{variant:"destructive",children:"Offline"}),[ei,el]),eO=(0,r.useMemo)(()=>{let e=eo.length,t=eo.filter(e=>"tutor"===e.role).length;return{total:e,tutors:t,students:e-t}},[eo]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(l.Input,{type:"file",accept:"application/pdf",onChange:eb,className:"max-w-sm"}),v&&eP,v&&(0,t.jsxs)(i.Badge,{variant:"outline",children:["Live: ",eO.total," (",eO.tutors," tutor, ",eO.students," students)"]}),v&&(0,t.jsx)(i.Badge,{variant:es?"destructive":"secondary",children:eu?"Canvas Locked":"Canvas Unlocked"}),(x??"tutor"===b)&&(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>ed(!eu),children:[eu?(0,t.jsx)(c.Unlock,{className:"w-4 h-4 mr-2"}):(0,t.jsx)(o.Lock,{className:"w-4 h-4 mr-2"}),eu?"Unlock Canvas":"Lock Canvas"]}),j&&(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:ey,children:[(0,t.jsx)(u.RefreshCw,{className:"w-4 h-4 mr-2"}),"AI Cleaned Text"]}),j&&(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:ew,children:"Run AI Marking"}),j&&(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:ex,children:"Apply AI Error Circles"}),et.text&&(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:ej,disabled:eu,children:"Add Text"}),et.shapes&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:eC,disabled:eu,children:"Rectangle"}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:ek,disabled:eu,children:"Circle"})]}),(0,t.jsx)(n.Button,{variant:"draw"===G?"default":"outline",size:"sm",onClick:()=>J("draw"),disabled:!ef,children:"Draw"}),(0,t.jsx)(n.Button,{variant:"erase"===G?"default":"outline",size:"sm",onClick:()=>J("erase"),disabled:!ep,children:"Erase"}),(0,t.jsx)(n.Button,{variant:"select"===G?"default":"outline",size:"sm",onClick:()=>J("select"),disabled:!eh,children:"Select"}),(0,t.jsxs)("label",{className:"flex items-center gap-1 text-xs",children:["Color",(0,t.jsx)("input",{type:"color",value:X,onChange:e=>Y(e.target.value),disabled:eu||!ef&&!ep,className:"h-7 w-10 rounded border"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1 text-xs",children:["Width",(0,t.jsx)("input",{type:"range",min:1,max:10,step:1,value:K,onChange:e=>Q(Number(e.target.value)),disabled:eu||!ef&&!ep}),(0,t.jsx)("span",{children:K})]}),et.clear&&(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>{let e=P.current;e&&!eu&&et.clear&&(e.clear(),e.renderAll())},disabled:eu,children:"Clear"}),"tutor"===b&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:eS,children:"Save Snapshot"}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:e_,children:"Load Latest Snapshot"})]}),et.flatten&&(0,t.jsx)(n.Button,{size:"sm",onClick:ev,children:"Flatten PDF"})]}),(0,t.jsx)(s.Tabs,{value:N,onValueChange:e=>I(e),children:(0,t.jsxs)(s.TabsList,{children:[(0,t.jsx)(s.TabsTrigger,{value:"original",children:"Original View"}),j&&(0,t.jsx)(s.TabsTrigger,{value:"cleaned",children:"AI Cleaned Text"}),(0,t.jsx)(s.TabsTrigger,{value:"marked",children:"Marked Feedback"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",disabled:T<=1,onClick:()=>B(e=>e-1),children:"Prev"}),(0,t.jsxs)("span",{className:"text-sm",children:["Page ",T," / ",$]}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",disabled:T>=$,onClick:()=>B(e=>e+1),children:"Next"}),!q&&(0,t.jsx)(i.Badge,{variant:"secondary",children:"Install `fabric` package to enable drawing sync"})]}),"original"===N&&(0,t.jsxs)("div",{className:"relative inline-block border rounded-md overflow-hidden bg-white",children:[(0,t.jsx)("canvas",{ref:S,className:"block"}),(0,t.jsx)("canvas",{ref:_,className:"absolute inset-0"})]}),"cleaned"===N&&j&&(0,t.jsx)("pre",{className:"rounded-md border bg-muted p-4 text-xs whitespace-pre-wrap",children:W||"No cleaned text generated yet."}),"marked"===N&&(0,t.jsx)("pre",{className:"rounded-md border bg-muted p-4 text-xs whitespace-pre-wrap",children:U||"No marking feedback generated yet."}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(d.Upload,{className:"w-3.5 h-3.5"}),"Coordinates are normalized as 0-100 percentages before sync for cross-device consistency."]})]})}e.s(["useSimpleSocket",()=>p],102037),e.s(["PDFCollaborativeViewer",()=>b],252186)}]);

//# debugId=fbe6b65c-9295-e75c-9a30-0f7ec20f016e
//# sourceMappingURL=e273cf81fe1af06c.js.map