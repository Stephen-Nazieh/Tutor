;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="7882d9ff-36e0-99dd-9bff-7ae92aa3a01d")}catch(e){}}();
module.exports=[902157,(e,t,i)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},750227,(e,t,i)=>{t.exports=e.x("node:path",()=>require("node:path"))},450869,e=>{"use strict";let t="tutorme:query:",i=null,r=null,s=!1,a=!(void 0!==globalThis.EdgeRuntime||"u">typeof process&&0);function n(){return a?(r||(r=new Map),r):null}async function o(){if(!a)return null;if(s)return i;try{let t=process.env.REDIS_URL;if(!t)return console.log("[DB] Redis URL not configured, using in-memory cache"),s=!0,null;let{Redis:r}=await e.A(443460);return(i=new r(t,{retryStrategy:e=>Math.min(50*e,2e3),maxRetriesPerRequest:3})).on("error",e=>{console.error("[Redis] Connection error:",e),i=null}),console.log("[DB] Redis cache initialized"),s=!0,i}catch(e){return console.warn("[DB] Failed to initialize Redis, using in-memory cache"),s=!0,null}}if(a)try{let{drizzleDb:t}=e.r(738597);console.log("[DB] Drizzle client (default db) initialized")}catch(e){console.error("[DB] Failed to initialize Drizzle:",e)}e.s(["cache",0,{ensureRedis:async()=>a?(s||await o(),i):null,async get(e){if(!a)return null;let i=t+e,r=await this.ensureRedis();if(r)try{let e=await r.get(i);if(e)return JSON.parse(e)}catch(e){console.error("[Cache] Redis get error:",e)}let s=n();if(!s)return null;let o=s.get(i);return o&&o.expires>Date.now()?o.data:(s.delete(i),null)},async set(e,i,r=60){if(!a)return;let s=t+e,o=await this.ensureRedis();if(o)try{await o.setex(s,r,JSON.stringify(i));return}catch(e){console.error("[Cache] Redis set error:",e)}let l=n();l&&l.set(s,{data:i,expires:Date.now()+1e3*r})},async delete(e){if(!a)return;let i=t+e,r=await this.ensureRedis();if(r)try{await r.del(i)}catch(e){console.error("[Cache] Redis del error:",e)}let s=n();s&&s.delete(i)},async clear(){if(!a)return;let e=await this.ensureRedis();if(e)try{let i=await e.keys(t+"*");i.length>0&&await e.del(...i)}catch(e){console.error("[Cache] Redis clear error:",e)}let i=n();i&&i.clear()},async getOrSet(e,t,i=60){let r=await this.get(e);if(null!==r)return r;let s=await t();return await this.set(e,s,i),s},async invalidatePattern(e){if(!a)return;let i=await this.ensureRedis();if(i)try{let r=await i.keys(t+e);r.length>0&&await i.del(...r)}catch(e){console.error("[Cache] Pattern invalidation error:",e)}let r=n();if(r){let i=new RegExp(t+e.replace("*",".*"));for(let e of r.keys())i.test(e)&&r.delete(e)}}}])},917126,e=>{"use strict";let t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,i=/\s*on\w+\s*=\s*["'][^"']*["']/gi,r=/javascript\s*:/gi,s=/data\s*:\s*[^,]*\s*,/gi,a=/<(?:iframe|object|embed|form|meta|link)\b[^>]*>/gi;function n(e){return"string"!=typeof e?"":e.replace(t,"").replace(a,"").replace(i,"").replace(r,"").replace(s,"")}function o(e,t=5e4){let i=n(e);return i.length<=t?i:i.slice(0,t)}e.s(["sanitizeHtml",()=>n,"sanitizeHtmlWithMax",()=>o])},765433,e=>e.a(async(t,i)=>{try{var r=e.i(738597);e.i(688768);var s=e.i(257357),a=t([r]);async function n(e,t,i){try{await r.drizzleDb.insert(s.userActivityLog).values({id:crypto.randomUUID(),userId:e,action:t,metadata:i??{}})}catch(e){console.error("Audit log failed:",e)}}[r]=a.then?(await a)():a,e.s(["AUDIT_ACTIONS",0,{PROFILE_VIEW:"audit_profile_view",PROFILE_UPDATE:"audit_profile_update",DATA_EXPORT:"audit_data_export",DATA_DELETE:"audit_data_delete",PAYMENT_CREATE:"audit_payment_create",PAYMENT_REFUND:"audit_payment_refund",PAYMENT_ALERT:"audit_payment_alert",COURSE_SHARE:"audit_course_share",ADMIN_ACCESS:"audit_admin_access",SENSITIVE_ACCESS:"audit_sensitive_access"},"logAudit",()=>n]),i()}catch(e){i(e)}},!1),190735,e=>e.a(async(t,i)=>{try{var r=e.i(254799),s=(e.i(909105),e.i(738597));e.i(688768);var a=e.i(257357),n=e.i(765433),o=t([s,n]);async function l(e,t,i){try{let o=i??{};t&&await (0,n.logAudit)(t,`security_${e}`,o),await s.drizzleDb.insert(a.securityEvent).values({id:r.default.randomUUID(),eventType:`security_${e}`,metadata:o})}catch(e){console.error("[SecurityAudit] logSecurityEvent failed:",e)}}[s,n]=o.then?(await o)():o,e.s(["logSecurityEvent",()=>l]),i()}catch(e){i(e)}},!1),528678,e=>e.a(async(t,i)=>{try{var r=e.i(190735),s=t([r]);[r]=s.then?(await s)():s,e.s(["securityLogger",0,{logEvent(e){let t=e.severity??"LOW";(0,r.logSecurityEvent)(e.eventType,void 0,{description:e.description,severity:t,...e.metadata}).catch(e=>console.error("Security log failed:",e))}}]),i()}catch(e){i(e)}},!1),930140,e=>e.a(async(t,i)=>{try{var r=e.i(917126),s=e.i(254799),a=e.i(528678),n=t([a]);[a]=n.then?(await n)():n;class o{static sanitizeAiInput(e){if(!e||"string"!=typeof e)return"";try{let t=e.trim(),i=[/ignore.*all.*previous.*instructions/gi,/forget.*everything.*above/gi,/disregard.*above/gi,/you are now.*admin/gi,/your role is now.*system/gi,/from now on.*you are.*developer/gi,/new instructions.*ignore.*previous/gi,/system prompt.*override/gi,/override.*all.*security.*rules/gi];for(let e of i)t=t.replace(e,"[REMOVED]");let s=[/assistant.*you.*are.*now/gi,/you.*are.*now.*assistant.*system/gi,/mode.*system.*administrator/gi,/bypass.*all.*restrictions/gi,/unlock.*all.*capabilities/gi];for(let e of s)t=t.replace(e,"[REMOVED]");let n=[/exec\s*\(/gi,/system\s*\(/gi,/shell\s*\(/gi,/exec\s+/gi,/system\s+/gi,/shell\s+/gi,/bash\.*execute/gi,/powershell\.*run/gi];for(let e of n)t=t.replace(e,"[REMOVED]");for(let e of[/<script.*?>/gi,/javascript:\.*\(/gi,/vbscript:\.*\(/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/eval\s*\(/gi])t=t.replace(e,"[REMOVED]");for(let e of[/sudo/gi,/admin/gi,/system.*override/gi,/override.*security.*settings/gi,/disable.*all.*protections/gi])t=t.replace(e,"[REMOVED]");return(t=(0,r.sanitizeHtml)(t)).length>3e3&&(t=t.substring(0,3e3)+" [TRUNCATED FOR SECURITY]"),a.securityLogger.logEvent({eventType:"AI_INPUT_SANITIZED",description:"AI input underwent security sanitization",metadata:{originalLength:e.length,sanitizedLength:t.length,patternsRemoved:i.length+s.length+n.length}}),t.trim()}catch(e){return a.securityLogger.logEvent({eventType:"AI_SECURITY_ERROR",description:"AI input sanitization error occurred",severity:"MEDIUM",metadata:{error:e.message}}),""}}static createStudentHash(e){if(!e||"string"!=typeof e)return"anonymous_student";try{let t=process.env.NEXTAUTH_SECRET||"default_secret";return s.default.createHash("sha256").update(e).update(t).digest("hex").substring(0,16)}catch(e){return a.securityLogger.logEvent({eventType:"STUDENT_HASH_ERROR",description:"Student hash creation failed",severity:"LOW",metadata:{error:e.message}}),"anonymous_student"}}static async validateAiResponse(e){let t=[],i="LOW";if(!e||"string"!=typeof e)return{isValid:!1,issues:["AI response is invalid"],severity:"HIGH"};for(let r of[/suicide(\.*|\s+)+support/gi,/self.?harm(\.*|\s+)+advice/gi,/violence(\.*|\s+)+instructions/gi,/how.?to.?harm.+yourself/gi,/end.?it.?all/gi])if(r.test(e)){t.push("AI response contains inappropriate or harmful content"),i="CRITICAL";break}for(let r of[/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/i,/\b\d{3}[-.\s]?\d{3}[-.\s]?\d{4}\b/g,/\b\d{3}-\d{2}-\d{4}\b/g])r.test(e)&&(t.push("AI response contains potential personal information"),i="CRITICAL"===i?"CRITICAL":"HIGH");for(let r of((e.includes("System:")||e.includes("Instruction:"))&&(t.push("AI response may contain system instruction leakage"),i="CRITICAL"===i?"CRITICAL":"HIGH"),[/eval\s*\(/gi,/system\s*\(/gi,/download.*malicious/gi,/install.*virus/gi]))r.test(e)&&(t.push("AI response contains potentially malicious content"),i="CRITICAL");return e.length>5e3&&(t.push("AI response exceeds safe length limits"),i="CRITICAL"===i?"CRITICAL":"HIGH"),t.length>0&&a.securityLogger.logEvent({eventType:"AI_RESPONSE_VALIDATION",description:"AI response failed security validation",severity:i,metadata:{issues:t,responseLength:e.length}}),{isValid:0===t.length,issues:t,severity:i}}static createSafeTutoringPrompt(e,t,i,r){let s=this.createStudentHash(e),a=this.sanitizeAiInput(r);return 0===a.length?{systemPrompt:this.createProtectedSystemPrompt(t,i),userPrompt:"Student provided invalid input - please redirect to proper input format"}:{systemPrompt:this.createProtectedSystemPrompt(t,i,s),userPrompt:`Student ${s} asks: "${a}"`}}static createProtectedSystemPrompt(e,t,i){return`
You are an AI tutor specializing in ${e} for ${t} level students.

SAFETY RULES STRICTLY ENFORCED:
1. **NEVER** provide direct answers - use Socratic method (guiding questions)
2. **NEVER** give private information or personal data
3. **NEVER** provide medical, legal, or financial advice
4. **NEVER** generate harmful or inappropriate content
5. **NEVER** give instructions for self-harm or dangerous activities
6. **ALWAYS** maintain educational focus and age-appropriate language
7. **ALWAYS** escalate concerning content to human supervision
8. **ALWAYS** encourage students to discover solutions through guided learning

RESPONSE GUIDELINES:
- Use only educational, age-appropriate language
- Ask questions to guide discovery
- Provide examples when helpful
- Adapt to student${i?` ${i}`:""}'s responses
- Never complete assignments for students
- Always check for understanding

CURRENT CONTEXT:
- Subject: ${e}
- Level: ${t}
- Anonymized Student ID: ${i||"anonymous"}
- Current Date: ${new Date().toISOString()}
`.trim()}}e.s(["AISecurityManager",()=>o]),i()}catch(e){i(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=7882d9ff-36e0-99dd-9bff-7ae92aa3a01d
//# sourceMappingURL=%5Broot-of-the-server%5D__8a862075._.js.map