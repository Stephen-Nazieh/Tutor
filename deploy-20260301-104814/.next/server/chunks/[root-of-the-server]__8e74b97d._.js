;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="431afce2-a9ef-6943-d6b3-f0d0ad3ce51d")}catch(e){}}();
module.exports=[917126,e=>{"use strict";let t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,r=/\s*on\w+\s*=\s*["'][^"']*["']/gi,i=/javascript\s*:/gi,a=/data\s*:\s*[^,]*\s*,/gi,n=/<(?:iframe|object|embed|form|meta|link)\b[^>]*>/gi;function s(e){return"string"!=typeof e?"":e.replace(t,"").replace(n,"").replace(r,"").replace(i,"").replace(a,"")}function o(e,t=5e4){let r=s(e);return r.length<=t?r:r.slice(0,t)}e.s(["sanitizeHtml",()=>s,"sanitizeHtmlWithMax",()=>o])},226266,e=>e.a(async(t,r)=>{try{var i=e.i(620971),a=e.i(384030),n=e.i(738597);e.i(688768);var s=e.i(257357),o=e.i(909105),l=e.i(917126),d=t([a,n]);async function u(e,t){try{let[e]=await n.drizzleDb.select().from(s.profile).where((0,o.eq)(s.profile.userId,t.user.id)).limit(1);return i.NextResponse.json({profile:e??null,userId:t.user.id,email:t.user.email??null,role:t.user.role??null})}catch(e){return console.error("Profile fetch error:",e),i.NextResponse.json({error:"Failed to fetch profile"},{status:500})}}async function c(e,t){try{let r=await (0,a.requireCsrf)(e);if(r)return r;let d=await e.json(),{name:u,bio:c,credentials:p,subjects:f,availability:h,hourlyRate:m,gradeLevel:v,subjectsOfInterest:R,preferredLanguages:g,paidClassesEnabled:w,paymentGatewayPreference:y,currency:E}=d,b={};void 0!==u&&(b.name=(0,l.sanitizeHtml)(String(u)).trim().slice(0,100)||null),void 0!==c&&(b.bio=(0,l.sanitizeHtmlWithMax)(c,2e3)),void 0!==d.avatarUrl&&(b.avatarUrl=(0,l.sanitizeHtml)(String(d.avatarUrl)).trim()||null),void 0!==d.timezone&&(b.timezone=(0,l.sanitizeHtml)(String(d.timezone)).trim()),void 0!==d.emailNotifications&&(b.emailNotifications=!!d.emailNotifications),void 0!==d.smsNotifications&&(b.smsNotifications=!!d.smsNotifications),void 0!==d.isOnboarded&&(b.isOnboarded=!!d.isOnboarded),!0===d.tosAccepted&&(b.tosAccepted=!0,b.tosAcceptedAt=new Date),void 0!==v&&(b.gradeLevel=v.toString()),void 0!==R&&(b.subjectsOfInterest=R),void 0!==g&&(b.preferredLanguages=Array.isArray(g)?g:[]),void 0!==d.learningGoals&&(b.learningGoals=Array.isArray(d.learningGoals)?d.learningGoals:[]),void 0!==m&&(b.hourlyRate=m),void 0!==f&&(b.specialties=f),void 0!==w&&(b.paidClassesEnabled=!!w),void 0!==y&&(b.paymentGatewayPreference=""===y?null:y),void 0!==E&&(b.currency=""===E?null:E),void 0!==p&&(b.credentials=(0,l.sanitizeHtmlWithMax)(p,2e3)),void 0!==h&&(b.availability=h);let[A]=await n.drizzleDb.select().from(s.profile).where((0,o.eq)(s.profile.userId,t.user.id)).limit(1);A?await n.drizzleDb.update(s.profile).set(b).where((0,o.eq)(s.profile.userId,t.user.id)):await n.drizzleDb.insert(s.profile).values({id:crypto.randomUUID(),userId:t.user.id,timezone:b.timezone??"UTC",emailNotifications:b.emailNotifications??!0,smsNotifications:b.smsNotifications??!1,tosAccepted:b.tosAccepted??!1,isOnboarded:b.isOnboarded??!1,paidClassesEnabled:b.paidClassesEnabled??!1,subjectsOfInterest:b.subjectsOfInterest??[],preferredLanguages:b.preferredLanguages??[],learningGoals:b.learningGoals??[],specialties:b.specialties??[],...b});let[_]=await n.drizzleDb.select().from(s.profile).where((0,o.eq)(s.profile.userId,t.user.id)).limit(1);return i.NextResponse.json({profile:_})}catch(e){return console.error("Profile update error:",e),i.NextResponse.json({error:"Failed to update profile"},{status:500})}}[a,n]=d.then?(await d)():d;let p=(0,a.withAuth)(u),f=(0,a.withAuth)(c);e.s(["GET",0,p,"PUT",0,f]),r()}catch(e){r(e)}},!1),493871,e=>e.a(async(t,r)=>{try{var i=e.i(78315),a=e.i(586961),n=e.i(196657),s=e.i(899733),o=e.i(233979),l=e.i(631683),d=e.i(840960),u=e.i(711373),c=e.i(699699),p=e.i(521140),f=e.i(205260),h=e.i(500249),m=e.i(431740),v=e.i(82608),R=e.i(635207),g=e.i(193695);e.i(708038);var w=e.i(447430),y=e.i(226266),E=t([y]);[y]=E.then?(await E)():E;let _=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/user/profile/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:C,workUnitAsyncStorage:x,serverHooks:N}=_;function b(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:x})}async function A(e,t,r){_.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/user/profile/route";i=i.replace(/\/index$/,"")||"/";let n=await _.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:b,parsedUrl:A,isDraftMode:C,prerenderManifest:x,routerServerContext:N,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,resolvedPathname:T,clientReferenceManifest:I,serverActionsManifest:S}=n,H=(0,d.normalizeAppPath)(i),z=!!(x.dynamicRoutes[H]||x.routes[T]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(z&&!C){let e=!!x.routes[T],t=x.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let D=null;!z||_.isDev||C||(D=T,D="/index"===D?"/":D);let k=!0===_.isDev||!z,j=z&&!k;S&&I&&(0,l.setManifestsSingleton)({page:i,clientReferenceManifest:I,serverActionsManifest:S});let q=e.method||"GET",M=(0,o.getTracer)(),K=M.getActiveScopeSpan(),G={params:E,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,a)=>_.onRequestError(e,t,i,a,N)},sharedContext:{buildId:y}},F=new u.NodeNextRequest(e),L=new u.NodeNextResponse(t),$=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let n=async e=>_.handle($,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${i}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var o,d;let u=async({previousCacheEntry:a})=>{try{if(!l&&P&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(s);e.fetchMetrics=G.renderOpts.fetchMetrics;let o=G.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let d=G.renderOpts.collectedTags;if(!z)return await (0,h.sendResponse)(F,L,i,G.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,a=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,N),t}},c=await _.handleResponse({req:e,nextConfig:b,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!z)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&z||p.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(F,L,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};K?await d(K):await M.withPropagatedContext(e.headers,()=>M.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${i}`,kind:o.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,N),z)throw t;return await (0,h.sendResponse)(F,L,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>b,"routeModule",()=>_,"serverHooks",()=>N,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>x]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=431afce2-a9ef-6943-d6b3-f0d0ad3ce51d
//# sourceMappingURL=%5Broot-of-the-server%5D__8e74b97d._.js.map