;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="caba0194-82d8-eeff-91dc-b31198badfa2")}catch(e){}}();
module.exports=[366503,e=>e.a(async(t,r)=>{try{var a=e.i(620971),o=e.i(909105),l=e.i(997103),n=e.i(320947),u=e.i(738597);e.i(688768);var i=e.i(257357),s=e.i(257649),c=t([u]);function d(e){return(e||"").trim().toLowerCase()}async function p(e){let t=d(e.nextUrl.searchParams.get("q")),r=d(e.nextUrl.searchParams.get("subject")),c=d(e.nextUrl.searchParams.get("sort"))||"popular",p=(0,s.shouldUseMockPublicTutors)()||"1"===e.nextUrl.searchParams.get("mock"),m=await u.drizzleDb.select({id:i.user.id,name:i.profile.name,username:i.profile.username,bio:i.profile.bio,avatarUrl:i.profile.avatarUrl,specialties:i.profile.specialties,hourlyRate:i.profile.hourlyRate}).from(i.user).innerJoin(i.profile,(0,o.eq)(i.profile.userId,i.user.id)).where((0,o.and)((0,o.eq)(i.user.role,"TUTOR"),n.sql`${i.profile.username} IS NOT NULL`)).limit(300),h=m.map(e=>e.id);if(0===h.length)return a.NextResponse.json({tutors:[],total:0,availableSubjects:[],source:"db"});let f=await u.drizzleDb.select().from(i.curriculum).where((0,o.and)((0,o.eq)(i.curriculum.isPublished,!0),n.sql`${i.curriculum.creatorId} IS NOT NULL`,(0,o.inArray)(i.curriculum.creatorId,h))).orderBy((0,l.desc)(i.curriculum.updatedAt)),R=f.map(e=>e.id),w=new Map;for(let e of f){if(!e.creatorId)continue;let t=w.get(e.creatorId)??[];t.length<100&&t.push(e),w.set(e.creatorId,t)}let C=new Map,g=new Map,v=new Map,b=[];if(R.length>0){for(let e of b=await u.drizzleDb.select({curriculumId:i.curriculumModule.curriculumId,id:i.curriculumModule.id}).from(i.curriculumModule).where((0,o.inArray)(i.curriculumModule.curriculumId,R)))C.set(e.curriculumId,(C.get(e.curriculumId)??0)+1);for(let e of(await u.drizzleDb.select({curriculumId:i.curriculumEnrollment.curriculumId}).from(i.curriculumEnrollment).where((0,o.inArray)(i.curriculumEnrollment.curriculumId,R))))g.set(e.curriculumId,(g.get(e.curriculumId)??0)+1);for(let e of(await u.drizzleDb.select({moduleId:i.curriculumLesson.moduleId}).from(i.curriculumLesson).where((0,o.inArray)(i.curriculumLesson.moduleId,b.map(e=>e.id)))))v.set(e.moduleId,(v.get(e.moduleId)??0)+1)}let A=new Map;for(let e of R){let t=b.filter(t=>t.curriculumId===e).map(e=>e.id).reduce((e,t)=>e+(v.get(t)??0),0);A.set(e,t)}let E=m.map(e=>{let t=e.username??"";if(!t)return null;let r=(w.get(e.id)??[]).map(e=>({id:e.id,name:e.name,subject:e.subject,gradeLevel:e.gradeLevel,difficulty:e.difficulty,enrollmentCount:g.get(e.id)??0,moduleCount:C.get(e.id)??0,lessonCount:A.get(e.id)??0,updatedAt:e.updatedAt})),a=r.reduce((e,t)=>e+t.enrollmentCount,0),o=Array.from(new Set(r.map(e=>e.subject))).sort((e,t)=>e.localeCompare(t)),l=r[0]?.updatedAt?r[0].updatedAt.toISOString():null;return{id:e.id,name:e.name??"Tutor",username:t,bio:e.bio??"",avatarUrl:e.avatarUrl??null,specialties:e.specialties??[],hourlyRate:e.hourlyRate??null,courseCount:r.length,totalEnrollments:a,subjects:o,latestCourseUpdatedAt:l,coursePreview:r.slice(0,4).map(e=>({...e,updatedAt:e.updatedAt.toISOString()}))}}).filter(e=>!!e),y=E.filter(e=>{let a=!t||e.name.toLowerCase().includes(t)||e.username.toLowerCase().includes(t)||e.bio.toLowerCase().includes(t)||e.subjects.some(e=>e.toLowerCase().includes(t))||e.specialties.some(e=>e.toLowerCase().includes(t)),o=!r||e.subjects.some(e=>e.toLowerCase()===r);return a&&o});if(0===y.length&&p){let e=s.MOCK_TUTORS.map(e=>{let t=e.courses.reduce((e,t)=>e+t.enrollmentCount,0),r=Array.from(new Set(e.courses.map(e=>e.subject)));return{id:e.id,name:e.name,username:e.username,bio:e.bio,avatarUrl:e.avatarUrl,specialties:e.specialties,hourlyRate:e.hourlyRate,courseCount:e.courses.length,totalEnrollments:t,subjects:r,latestCourseUpdatedAt:e.courses[0]?.updatedAt||null,coursePreview:e.courses.slice(0,4).map(e=>({id:e.id,name:e.name,subject:e.subject,gradeLevel:e.gradeLevel,difficulty:e.difficulty,enrollmentCount:e.enrollmentCount,moduleCount:e.moduleCount,lessonCount:e.lessonCount,updatedAt:e.updatedAt}))}});return a.NextResponse.json({tutors:e,total:e.length,availableSubjects:Array.from(new Set(e.flatMap(e=>e.subjects))).sort((e,t)=>e.localeCompare(t)),source:"mock"})}return y.sort((e,t)=>"newest"===c?Date.parse(t.latestCourseUpdatedAt||"1970-01-01")-Date.parse(e.latestCourseUpdatedAt||"1970-01-01"):"courses"===c?t.courseCount-e.courseCount||t.totalEnrollments-e.totalEnrollments:"rate"===c?(e.hourlyRate??Number.MAX_SAFE_INTEGER)-(t.hourlyRate??Number.MAX_SAFE_INTEGER):t.totalEnrollments-e.totalEnrollments||t.courseCount-e.courseCount),a.NextResponse.json({tutors:y,total:y.length,availableSubjects:Array.from(new Set(E.flatMap(e=>e.subjects))).sort((e,t)=>e.localeCompare(t)),source:"db"})}[u]=c.then?(await c)():c,e.s(["GET",()=>p]),r()}catch(e){r(e)}},!1),954625,e=>e.a(async(t,r)=>{try{var a=e.i(78315),o=e.i(586961),l=e.i(196657),n=e.i(899733),u=e.i(233979),i=e.i(631683),s=e.i(840960),c=e.i(711373),d=e.i(699699),p=e.i(521140),m=e.i(205260),h=e.i(500249),f=e.i(431740),R=e.i(82608),w=e.i(635207),C=e.i(193695);e.i(708038);var g=e.i(447430),v=e.i(366503),b=t([v]);[v]=b.then?(await b)():b;let y=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/public/tutors/route",pathname:"/api/public/tutors",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/public/tutors/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:I,workUnitAsyncStorage:x,serverHooks:S}=y;function A(){return(0,l.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:x})}async function E(e,t,r){y.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/public/tutors/route";a=a.replace(/\/index$/,"")||"/";let l=await y.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!l)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:b,nextConfig:A,parsedUrl:E,isDraftMode:I,prerenderManifest:x,routerServerContext:S,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,resolvedPathname:U,clientReferenceManifest:P,serverActionsManifest:O}=l,M=(0,s.normalizeAppPath)(a),_=!!(x.dynamicRoutes[M]||x.routes[U]),j=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,E,!1):t.end("This page could not be found"),null);if(_&&!I){let e=!!x.routes[U],t=x.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await j();throw new C.NoFallbackError}}let L=null;!_||y.isDev||I||(L=U,L="/index"===L?"/":L);let D=!0===y.isDev||!_,q=_&&!D;O&&P&&(0,i.setManifestsSingleton)({page:a,clientReferenceManifest:P,serverActionsManifest:O});let k=e.method||"GET",H=(0,u.getTracer)(),z=H.getActiveScopeSpan(),K={params:b,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>y.onRequestError(e,t,a,o,S)},sharedContext:{buildId:v}},$=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let l=async e=>y.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${k} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${a}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),s=async n=>{var u,s;let c=async({previousCacheEntry:o})=>{try{if(!i&&T&&N&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await l(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let u=K.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let s=K.renderOpts.collectedTags;if(!_)return await (0,h.sendResponse)($,F,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);s&&(t[w.NEXT_CACHE_TAGS_HEADER]=s),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,o=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:T})},!1,S),t}},d=await y.handleResponse({req:e,nextConfig:A,cacheKey:L,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:i});if(!_)return null;if((null==d||null==(u=d.value)?void 0:u.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(s=d.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&_||p.delete(w.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)($,F,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};z?await s(z):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${k} ${a}`,kind:u.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},s))}catch(t){if(t instanceof C.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:T})},!1,S),_)throw t;return await (0,h.sendResponse)($,F,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>A,"routeModule",()=>y,"serverHooks",()=>S,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>x]),r()}catch(e){r(e)}},!1)];

//# debugId=caba0194-82d8-eeff-91dc-b31198badfa2
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_0cd43b8e._.js.map