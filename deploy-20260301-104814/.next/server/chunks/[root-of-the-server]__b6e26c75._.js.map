{
  "version": 3,
  "sources": [],
  "debugId": "eed74375-0e78-0912-e643-0f9b59201415",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/db/index.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/ai/teaching-prompts/common.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/ai/teaching-prompts/prompt-builder.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-require-imports */\n\n/**\n * Database Client with Connection Pooling\n * \n * Features:\n * - Connection pooling for high concurrency (100+ users)\n * - Query caching with Redis\n * - Read replica support for scaling\n * - N+1 query prevention with dataloaders\n * \n * Note: Redis is lazily initialized to avoid bundling issues\n */\n\n// Connection pool configuration\nconst POOL_CONFIG = {\n  // Connection pool settings for 100+ concurrent users\n  min: 5,                    // Minimum connections\n  max: 50,                   // Maximum connections (supports 100+ concurrent users)\n  idleTimeoutMillis: 30000,  // Close idle connections after 30s\n  connectionTimeoutMillis: 5000, // Connection timeout\n  allowExitOnIdle: false,    // Keep pool alive\n}\n\n// Query cache configuration\nconst CACHE_CONFIG = {\n  ttl: 60,                   // Default cache TTL in seconds\n  staleWhileRevalidate: 30,  // Serve stale data while refreshing\n  prefix: 'tutorme:query:',  // Cache key prefix\n}\n\nlet db: any\nlet redis: any | null = null\nlet queryCache: Map<string, { data: any; expires: number }> | null = null\nlet redisInitialized = false\n\n// Safe check for server-side environment (not Edge Runtime)\n// Edge Runtime (used by Next.js middleware) doesn't support Prisma Client\nconst isEdgeRuntime = typeof (globalThis as any).EdgeRuntime !== 'undefined' || \n  (typeof process !== 'undefined' && process.env.NEXT_RUNTIME === 'edge')\nconst isServer = typeof window === 'undefined' && !isEdgeRuntime\n\n// Initialize in-memory cache only on server\nfunction getQueryCache() {\n  if (!isServer) return null\n  if (!queryCache) {\n    queryCache = new Map()\n  }\n  return queryCache\n}\n\n// Initialize Redis client if available (server-side only)\nasync function initRedis() {\n  if (!isServer) return null\n  if (redisInitialized) return redis\n  \n  try {\n    const redisUrl = process.env.REDIS_URL\n    if (!redisUrl) {\n      console.log('[DB] Redis URL not configured, using in-memory cache')\n      redisInitialized = true\n      return null\n    }\n    \n    // Dynamic import to avoid bundling issues\n    const { Redis } = await import('ioredis')\n    redis = new Redis(redisUrl, {\n      retryStrategy: (times) => Math.min(times * 50, 2000),\n      maxRetriesPerRequest: 3,\n    })\n    \n    redis.on('error', (err: any) => {\n      console.error('[Redis] Connection error:', err)\n      redis = null\n    })\n    \n    console.log('[DB] Redis cache initialized')\n    redisInitialized = true\n    return redis\n  } catch (e) {\n    console.warn('[DB] Failed to initialize Redis, using in-memory cache')\n    redisInitialized = true\n    return null\n  }\n}\n\n// Use Drizzle as the default database (server-side only)\nif (isServer) {\n  try {\n    const { drizzleDb } = require('./drizzle')\n    db = drizzleDb\n    console.log('[DB] Drizzle client (default db) initialized')\n  } catch (e) {\n    console.error('[DB] Failed to initialize Drizzle:', e)\n    db = {\n      $connect: async () => {},\n      $disconnect: async () => {},\n    } as any\n  }\n} else {\n  db = {\n    $connect: async () => {},\n    $disconnect: async () => {},\n  } as any\n}\n\n/**\n * Cache utilities\n */\nexport const cache = {\n  /**\n   * Ensure Redis is initialized\n   */\n  async ensureRedis() {\n    if (!isServer) return null\n    if (!redisInitialized) {\n      await initRedis()\n    }\n    return redis\n  },\n\n  /**\n   * Get cached value\n   */\n  async get<T>(key: string): Promise<T | null> {\n    if (!isServer) return null\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    // Try Redis first\n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const value = await client.get(fullKey)\n        if (value) return JSON.parse(value)\n      } catch (e) {\n        console.error('[Cache] Redis get error:', e)\n      }\n    }\n    \n    // Fallback to in-memory cache\n    const cache = getQueryCache()\n    if (!cache) return null\n    \n    const cached = cache.get(fullKey)\n    if (cached && cached.expires > Date.now()) {\n      return cached.data\n    }\n    \n    cache.delete(fullKey)\n    return null\n  },\n  \n  /**\n   * Set cached value\n   */\n  async set<T>(key: string, value: T, ttlSeconds = CACHE_CONFIG.ttl): Promise<void> {\n    if (!isServer) return\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    // Try Redis first\n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        await client.setex(fullKey, ttlSeconds, JSON.stringify(value))\n        return\n      } catch (e) {\n        console.error('[Cache] Redis set error:', e)\n      }\n    }\n    \n    // Fallback to in-memory cache\n    const cache = getQueryCache()\n    if (cache) {\n      cache.set(fullKey, {\n        data: value,\n        expires: Date.now() + ttlSeconds * 1000\n      })\n    }\n  },\n  \n  /**\n   * Delete cached value\n   */\n  async delete(key: string): Promise<void> {\n    if (!isServer) return\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        await client.del(fullKey)\n      } catch (e) {\n        console.error('[Cache] Redis del error:', e)\n      }\n    }\n    \n    const cache = getQueryCache()\n    if (cache) cache.delete(fullKey)\n  },\n  \n  /**\n   * Clear all cached values\n   */\n  async clear(): Promise<void> {\n    if (!isServer) return\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const keys = await client.keys(CACHE_CONFIG.prefix + '*')\n        if (keys.length > 0) {\n          await client.del(...keys)\n        }\n      } catch (e) {\n        console.error('[Cache] Redis clear error:', e)\n      }\n    }\n    \n    const cache = getQueryCache()\n    if (cache) cache.clear()\n  },\n  \n  /**\n   * Get or set cached value\n   */\n  async getOrSet<T>(\n    key: string,\n    factory: () => Promise<T>,\n    ttlSeconds = CACHE_CONFIG.ttl\n  ): Promise<T> {\n    const cached = await this.get<T>(key)\n    if (cached !== null) return cached\n    \n    const value = await factory()\n    await this.set(key, value, ttlSeconds)\n    return value\n  },\n\n  /**\n   * Invalidate cache for a pattern\n   */\n  async invalidatePattern(pattern: string): Promise<void> {\n    if (!isServer) return\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const keys = await client.keys(CACHE_CONFIG.prefix + pattern)\n        if (keys.length > 0) {\n          await client.del(...keys)\n        }\n      } catch (e) {\n        console.error('[Cache] Pattern invalidation error:', e)\n      }\n    }\n    \n    // Clear in-memory cache matching pattern\n    const cache = getQueryCache()\n    if (cache) {\n      const regex = new RegExp(CACHE_CONFIG.prefix + pattern.replace('*', '.*'))\n      for (const key of cache.keys()) {\n        if (regex.test(key)) cache.delete(key)\n      }\n    }\n  }\n}\n\n/**\n * Query optimization utilities\n */\nexport const queryOptimizer = {\n  /**\n   * Batch load function for N+1 prevention\n   */\n  async batchLoad<T>(\n    ids: string[],\n    fetchFn: (ids: string[]) => Promise<T[]>,\n    getId: (item: T) => string\n  ): Promise<(T | null)[]> {\n    if (!isServer) return ids.map(() => null)\n    if (ids.length === 0) return []\n    \n    // Deduplicate IDs\n    const uniqueIds = [...new Set(ids)]\n    \n    // Fetch all items in one query\n    const items = await fetchFn(uniqueIds)\n    \n    // Create lookup map\n    const itemMap = new Map(items.map(item => [getId(item), item]))\n    \n    // Return items in original order\n    return ids.map(id => itemMap.get(id) || null)\n  },\n  \n  /**\n   * Wrap a query with caching\n   */\n  async cachedQuery<T>(\n    cacheKey: string,\n    queryFn: () => Promise<T>,\n    ttlSeconds = CACHE_CONFIG.ttl\n  ): Promise<T> {\n    return cache.getOrSet(cacheKey, queryFn, ttlSeconds)\n  }\n}\n\n/**\n * Read replica support (for future scaling)\n */\nexport const readReplica = {\n  /**\n   * Check if read replicas are configured\n   */\n  isConfigured(): boolean {\n    return isServer && !!process.env.DATABASE_READ_REPLICA_URL\n  },\n  \n  /**\n   * Get read-only database client\n   * Falls back to primary if replicas not configured\n   */\n  getClient() {\n    // For now, return the same client\n    // In production, this would return a connection to the read replica\n    return db\n  }\n}\n\nexport { db }\n/** Alias for code that imports prisma from @/lib/db — now points to Drizzle */\nexport const prisma = db\n\n// Server-only code that needs Drizzle: import { drizzleDb } from '@/lib/db/drizzle'\n// Legacy Prisma (scripts, pipl-compliance): import { prismaLegacyClient } from '@/lib/db/prisma-legacy'\n","/**\n * Common Prompts for AI Tutor\n * Base prompts that apply to all subjects\n */\n\nexport interface TeachingModeConfig {\n  name: string\n  description: string\n  systemPrompt: string\n  responseFormat: string\n  useSocraticMethod: boolean\n}\n\n// Common teaching modes available for all subjects\nexport const commonTeachingModes: Record<string, TeachingModeConfig> = {\n  socratic: {\n    name: 'Socratic Mode',\n    description: 'Learn by answering guided questions',\n    systemPrompt: `You are a Socratic tutor. Your role is to guide students to discover answers themselves through questioning.\n\nRules:\n1. NEVER give direct answers\n2. Ask 1-2 guiding questions at a time\n3. Build on what the student already knows\n4. Use \"What do you think...?\" or \"Why do you think...?\" style questions\n5. If stuck, provide a hint, not the answer\n6. Celebrate correct thinking with encouragement\n\nCurrent teaching style: Teaching like a {{teachingAge}}-year-old with a {{voiceGender}} {{voiceAccent}} voice.`,\n    responseFormat: `Respond in a conversational, encouraging tone. Keep responses to 2-3 sentences maximum. End with a question that guides the student forward.`,\n    useSocraticMethod: true\n  },\n  \n  direct: {\n    name: 'Direct Teaching',\n    description: 'Clear explanations with examples',\n    systemPrompt: `You are a direct, clear tutor who explains concepts thoroughly.\n\nRules:\n1. Give clear, concise explanations\n2. Use examples to illustrate concepts\n3. Define technical terms when first used\n4. Structure: Concept → Explanation → Example\n5. Check for understanding: \"Does that make sense?\"\n6. Invite follow-up questions\n\nCurrent teaching style: Teaching like a {{teachingAge}}-year-old with a {{voiceGender}} {{voiceAccent}} voice.`,\n    responseFormat: `Provide a 3-5 sentence explanation with one concrete example. Use formatting (bold for key terms) for clarity.`,\n    useSocraticMethod: false\n  },\n  \n  lesson: {\n    name: 'Full Lesson',\n    description: 'Complete structured lesson on a topic',\n    systemPrompt: `You are conducting a structured lesson. Teach the topic comprehensively.\n\nStructure your response:\n1. **Introduction**: Why this matters (1-2 sentences)\n2. **Key Concept**: Clear explanation with definition\n3. **Example**: Step-by-step worked example\n4. **Practice**: One exercise for the student to try\n5. **Summary**: Key takeaways\n\nRules:\n- Be thorough but concise\n- Use the whiteboard for formulas/key points\n- Progress gradually from simple to complex\n- Pause for understanding\n\nCurrent teaching style: Teaching like a {{teachingAge}}-year-old with a {{voiceGender}} {{voiceAccent}} voice.`,\n    responseFormat: `Follow the 5-part structure above. Use markdown headers (##) for each section. Include a practice problem at the end.`,\n    useSocraticMethod: false\n  },\n  \n  practice: {\n    name: 'Practice Problems',\n    description: 'Focus on exercises and problem-solving',\n    systemPrompt: `You are a practice coach. Focus on problem-solving and skill building.\n\nRules:\n1. Present one problem at a time\n2. Let the student attempt first\n3. If stuck, give hints progressively\n4. Celebrate correct answers\n5. Explain the reasoning after success\n6. Gradually increase difficulty\n\nCurrent teaching style: Teaching like a {{teachingAge}}-year-old with a {{voiceGender}} {{voiceAccent}} voice.`,\n    responseFormat: `Present one clear problem. Wait for the student's attempt before giving feedback. Use encouraging language.`,\n    useSocraticMethod: true\n  }\n}\n\n// Template replacement function\nexport function fillTemplate(template: string, variables: Record<string, string | number>): string {\n  return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\n    return variables[key]?.toString() || match\n  })\n}\n\n// Build system prompt for a subject and mode\nexport function buildSystemPrompt(\n  mode: string,\n  subject: string,\n  variables: {\n    teachingAge: number\n    voiceGender: string\n    voiceAccent: string\n  },\n  subjectContext?: string\n): string {\n  const modeConfig = commonTeachingModes[mode] || commonTeachingModes.socratic\n  \n  let prompt = fillTemplate(modeConfig.systemPrompt, variables)\n  \n  if (subjectContext) {\n    prompt += `\\n\\n## Subject Context\\n${subjectContext}`\n  }\n  \n  prompt += `\\n\\n## Response Format\\n${modeConfig.responseFormat}`\n  \n  return prompt\n}\n","/**\n * Prompt Builder for AI Tutor\n * Builds layered prompts with personality, gamification, and mission context\n */\n\nimport { commonTeachingModes, fillTemplate } from './common'\nimport { subjectPrompts } from './index'\n\nexport interface PromptConfig {\n  language: 'en' | 'zh'\n  teachingMode: string\n  personality: 'friendly_mentor' | 'strict_coach' | 'corporate_trainer' | 'funny_teacher' | 'calm_professor'\n  gamification: {\n    level: number\n    xp: number\n    streakDays: number\n    skills: Record<string, number>\n  }\n  mission?: {\n    worldId: string\n    worldName: string\n    worldEmoji: string\n    missionId: string\n    missionTitle: string\n    missionObjective: string\n    missionType: string\n    vocabulary?: string[]\n    grammarFocus?: string\n    difficulty: string\n  }\n  tier: 'FREE' | 'BASIC' | 'PREMIUM'\n  chatHistory: Array<{ role: string; content: string }>\n  userMessage: string\n}\n\nconst personalityPrompts: Record<string, string> = {\n  friendly_mentor: `You are a warm, encouraging tutor who believes in the student's potential. \nTone: Supportive, patient, optimistic\nStyle: Use \"we\" and \"let's\", celebrate small wins, offer reassurance\nExample: \"That's a great start! Let's build on that idea together.\"`,\n\n  strict_coach: `You are a disciplined tutor who pushes students to excel.\nTone: Direct, challenging, results-focused\nStyle: Set high expectations, give constructive criticism, demand effort\nExample: \"Good, but you can do better. Try again with more precision.\"`,\n\n  corporate_trainer: `You are a professional tutor focused on practical skills.\nTone: Professional, efficient, goal-oriented\nStyle: Use business analogies, focus on outcomes, be concise\nExample: \"Let's optimize your approach. Here's the most efficient method.\"`,\n\n  funny_teacher: `You are an entertaining tutor who makes learning fun.\nTone: Playful, energetic, uses humor\nStyle: Use analogies, jokes, memes references (when appropriate)\nExample: \"Math is like a puzzle, but instead of losing pieces, you lose... wait, that's depressing. Let's try again!\"`,\n\n  calm_professor: `You are a knowledgeable, serene tutor who explains deeply.\nTone: Calm, thoughtful, philosophical\nStyle: Deep explanations, historical context, \"big picture\" thinking\nExample: \"Consider this concept from first principles. What is the fundamental nature of...\"`\n}\n\nexport function buildCompletePrompt(config: PromptConfig): string {\n  const parts: string[] = []\n  \n  // 1. Core Identity\n  parts.push(`You are an AI tutor helping a student learn.`)\n  \n  // 2. Teaching Mode\n  const mode = commonTeachingModes[config.teachingMode] || commonTeachingModes.socratic\n  parts.push(`\\n## Teaching Mode: ${mode.name}`)\n  parts.push(mode.systemPrompt)\n  \n  // 3. Personality Layer\n  const personality = personalityPrompts[config.personality] || personalityPrompts.friendly_mentor\n  parts.push(`\\n## Your Personality`)\n  parts.push(personality)\n  \n  // 4. Gamification Context\n  parts.push(`\\n## Student Progress`)\n  parts.push(`- Level: ${config.gamification.level}`)\n  parts.push(`- XP: ${config.gamification.xp}`)\n  parts.push(`- Streak: ${config.gamification.streakDays} days`)\n  if (Object.keys(config.gamification.skills).length > 0) {\n    parts.push(`- Skills: ${JSON.stringify(config.gamification.skills)}`)\n  }\n  \n  // 5. Mission Context (if provided)\n  if (config.mission) {\n    parts.push(`\\n## Current Mission`)\n    parts.push(`World: ${config.mission.worldEmoji} ${config.mission.worldName}`)\n    parts.push(`Mission: ${config.mission.missionTitle}`)\n    parts.push(`Objective: ${config.mission.missionObjective}`)\n    parts.push(`Type: ${config.mission.missionType}`)\n    parts.push(`Difficulty: ${config.mission.difficulty}`)\n    if (config.mission.vocabulary?.length) {\n      parts.push(`Vocabulary focus: ${config.mission.vocabulary.join(', ')}`)\n    }\n    if (config.mission.grammarFocus) {\n      parts.push(`Grammar focus: ${config.mission.grammarFocus}`)\n    }\n  }\n  \n  // 6. Tier Controls\n  parts.push(`\\n## Tier Settings`)\n  if (config.tier === 'FREE') {\n    parts.push(`- Response limit: 300 tokens`)\n    parts.push(`- Available modes: socratic, direct`)\n  } else if (config.tier === 'BASIC') {\n    parts.push(`- Response limit: 800 tokens`)\n    parts.push(`- Available modes: socratic, direct, lesson`)\n  } else {\n    parts.push(`- Response limit: 2048 tokens`)\n    parts.push(`- All features enabled`)\n  }\n  \n  // 7. Language\n  parts.push(`\\n## Language`)\n  parts.push(config.language === 'zh' ? 'Respond in Chinese (中文)' : 'Respond in English')\n  \n  // 8. Response Format\n  parts.push(`\\n## Response Format`)\n  parts.push(mode.responseFormat)\n  \n  // 9. Chat History\n  if (config.chatHistory.length > 0) {\n    parts.push(`\\n## Conversation History`)\n    config.chatHistory.slice(-5).forEach(msg => {\n      parts.push(`${msg.role === 'user' ? 'Student' : 'Tutor'}: ${msg.content}`)\n    })\n  }\n  \n  // 10. Current Message\n  parts.push(`\\n## Current Message`)\n  parts.push(`Student: ${config.userMessage}`)\n  parts.push(`\\nTutor:`)\n  \n  return parts.join('\\n')\n}\n"],"names":[],"mappings":"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"}}]
}