;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d556b872-36c1-3acb-9a4d-cdf8e6be54c6")}catch(e){}}();
module.exports=[340749,a=>{"use strict";var b=a.i(260576),c=a.i(741510),d=a.i(454069),e=a.i(88684),f=a.i(113098),g=a.i(849639),h=a.i(300052),i=a.i(472513),j=a.i(254919),k=a.i(293357);let l=(0,k.default)("maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),m=(0,k.default)("skip-back",[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]]),n=(0,k.default)("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]);var o=a.i(290385),p=a.i(856187);let q=(0,k.default)("battery-low",[["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]]),r=(0,k.default)("picture-in-picture",[["path",{d:"M2 10h6V4",key:"zwrco"}],["path",{d:"m2 4 6 6",key:"ug085t"}],["path",{d:"M21 10V7a2 2 0 0 0-2-2h-7",key:"git5jr"}],["path",{d:"M3 14v2a2 2 0 0 0 2 2h3",key:"1f7fh3"}],["rect",{x:"12",y:"14",width:"10",height:"7",rx:"1",key:"1wjs3o"}]]),s={quickCheck:"éšå ‚å°æµ‹",takeQuiz:"å¼€å§‹ç­”é¢˜",skipForNow:"æš‚ä¸ç­”é¢˜",skipWithNote:"è·³è¿‡å¹¶å¤‡æ³¨",play:"æ’­æ”¾",pause:"æš‚åœ",speed:"å€é€Ÿ",fullscreen:"å…¨å±",pip:"ç”»ä¸­ç”»",quality:"ç”»è´¨",auto:"è‡ªåŠ¨"};function t({videoUrl:a,title:d,onProgress:f,onQuizTrigger:k,onQuizSkip:t,onPlay:u,onPause:v,onSeek:w,onComplete:x,quizTimestamps:y=[],videoVariants:z,locale:A="zh"}){let B=(0,c.useRef)(null),C=(0,c.useRef)(null),D="zh"===A?s:{quickCheck:"Quick Check!",takeQuiz:"Take Quiz",skipForNow:"Skip for Now",skipWithNote:"Skip with note",play:"Play",pause:"Pause",speed:"Speed",fullscreen:"Fullscreen",pip:"Picture-in-picture",quality:"Quality",auto:"Auto"},E=z?Object.keys(z).sort((a,b)=>parseInt(b,10)-parseInt(a,10)):[],[F,G]=(0,c.useState)(E[0]??"auto"),H="auto"!==F&&z?.[F]?z[F]:a,[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(0),[M,N]=(0,c.useState)(0),[O,P]=(0,c.useState)(1),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(""),[aa,ab]=(0,c.useState)(new Set),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(!1),[ai,aj]=(0,c.useState)(!1),[ak,al]=(0,c.useState)(!1),am=(0,c.useRef)(0),an=(0,c.useRef)(new Set);(0,c.useEffect)(()=>{let a=window.matchMedia("(max-width: 640px)");af(a.matches);let b=()=>af(a.matches);return a.addEventListener("change",b),()=>a.removeEventListener("change",b)},[]),(0,c.useEffect)(()=>{if("u"<typeof navigator||!("getBattery"in navigator))return;let a=navigator;a.getBattery?.().then(a=>{ah(a.level<.2),a.addEventListener?.("levelchange",()=>ah(a.level<.2))}).catch(()=>{})},[]),(0,c.useEffect)(()=>{let a=B.current;if(!a)return;let b=()=>{L(a.currentTime);let b=Math.floor(a.currentTime/5);ab(a=>new Set([...a,b])),f?.({currentTime:a.currentTime,duration:a.duration||0,percentage:a.duration?a.currentTime/a.duration*100:0}),y.forEach(b=>{.5>Math.abs(a.currentTime-b)&&!an.current.has(b)&&(an.current.add(b),a.pause(),J(!1),Z(b),X(!0),k?.(b))})},c=()=>{N(a.duration)},d=()=>{J(!1),x?.()};return a.addEventListener("timeupdate",b),a.addEventListener("loadedmetadata",c),a.addEventListener("ended",d),()=>{a.removeEventListener("timeupdate",b),a.removeEventListener("loadedmetadata",c),a.removeEventListener("ended",d)}},[f,k,x,y]);let ao=(0,c.useCallback)(()=>{let a=B.current;a&&(I?(a.pause(),v?.(a.currentTime)):(a.play(),u?.(a.currentTime)),J(!I))},[I,u,v]),ap=a=>{let b=B.current;b&&(b.currentTime=Math.max(0,Math.min(M,b.currentTime+a)))},aq=a=>{let b=B.current;b&&(b.volume=a,P(a),R(0===a))},ar=(0,c.useCallback)(async()=>{let a=B.current;if(a&&document.pictureInPictureEnabled)try{document.pictureInPictureElement?(await document.exitPictureInPicture(),aj(!1)):(await a.requestPictureInPicture(),aj(!0))}catch{aj(!1)}},[]);(0,c.useEffect)(()=>{let a=B.current;if(!a)return;let b=()=>aj(!0),c=()=>aj(!1);return a.addEventListener("enterpictureinpicture",b),a.addEventListener("leavepictureinpicture",c),()=>{a.removeEventListener("enterpictureinpicture",b),a.removeEventListener("leavepictureinpicture",c)}},[]),(0,c.useEffect)(()=>{let a=C.current;if(!a)return;let b=a=>{if(!(a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement)&&B.current)switch(a.key){case" ":a.preventDefault(),ao();break;case"ArrowLeft":a.preventDefault(),ap(-10);break;case"ArrowRight":a.preventDefault(),ap(10);break;case"ArrowUp":a.preventDefault(),aq(Math.min(1,O+.1));break;case"ArrowDown":a.preventDefault(),aq(Math.max(0,O-.1))}};return a.setAttribute("tabIndex","0"),a.addEventListener("keydown",b),()=>a.removeEventListener("keydown",b)},[O,ao]);let as=a=>{let b=Math.floor(a/60),c=Math.floor(a%60);return`${b}:${c.toString().padStart(2,"0")}`};M&&aa.size;let at=ae?+!!ac:void 0;return(0,b.jsxs)("div",{ref:C,className:"relative bg-black rounded-lg overflow-hidden group",children:[(0,b.jsx)("div",{className:"w-full aspect-video sm:aspect-video max-h-[70vh] sm:max-h-none",children:(0,b.jsx)("video",{ref:B,src:H,className:"w-full h-full object-contain",onClick:()=>ae?ad(a=>!a):ao(),onTouchStart:a=>{am.current=a.touches[0].clientX,ae&&ad(a=>!a)},onTouchEnd:a=>{let b=a.changedTouches[0].clientX-am.current;if(Math.abs(b)>50&&M){let a=B.current;a&&(a.currentTime=Math.max(0,Math.min(M,a.currentTime+(b>0?10:-10))))}},playsInline:!0})}),ag&&I&&(0,b.jsxs)("div",{className:"absolute top-2 left-2 right-2 z-10 flex items-center gap-2 rounded bg-black/70 px-3 py-2 text-sm text-white",children:[(0,b.jsx)(q,{className:"h-4 w-4 shrink-0"}),(0,b.jsx)("span",{children:"çœç”µï¼šå¯é™ä½Žæ’­æ”¾é€Ÿåº¦æˆ–äº®åº¦ä»¥èŠ‚çœç”µé‡"})]}),W&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-20 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full text-center",children:[(0,b.jsx)(p.MessageSquare,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-bold mb-2",children:D.quickCheck}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"zh"===A?"æ¥æ£€éªŒä¸€ä¸‹åˆšæ‰çš„å†…å®¹å§ã€‚":"Let's test your understanding of what you just watched."}),t&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-left text-sm text-gray-600 mb-1",children:"zh"===A?"è·³è¿‡å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰":"Skip note (optional)"}),(0,b.jsx)("textarea",{value:$,onChange:a=>_(a.target.value.slice(0,300)),placeholder:"zh"===A?"ä¾‹å¦‚ï¼šç¨åŽå†åš":"e.g. Do later",className:"w-full min-h-[44px] px-3 py-2 border rounded-md text-sm",rows:2})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 justify-center",children:[(0,b.jsx)(e.Button,{variant:"outline",className:"touch-target min-h-[44px]",onClick:()=>{null!=Y&&t&&t(Y,$||void 0),X(!1),_(""),B.current?.play(),J(!0)},children:t&&$?D.skipWithNote:D.skipForNow}),(0,b.jsx)(e.Button,{className:"touch-target min-h-[44px]",onClick:()=>{X(!1),_(""),null!=Y&&k?.(Y)},children:D.takeQuiz})]})]})}),(0,b.jsxs)("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity duration-200 sm:opacity-0 sm:group-hover:opacity-100 ${ae?"rounded-t-xl pb-safe":""}`,style:void 0!==at?{opacity:at}:void 0,children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("input",{type:"range",min:"0",max:"100",value:M?K/M*100:0,onChange:a=>(a=>{let b=B.current;if(!b)return;let c=b.currentTime,d=a/100*M;b.currentTime=d,L(d),w?.(c,d)})(Number(a.target.value)),className:"w-full h-2 sm:h-1 py-2 sm:py-0 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500 [&::-webkit-slider-thumb]:h-5 [&::-webkit-slider-thumb]:w-5 sm:[&::-webkit-slider-thumb]:h-3 sm:[&::-webkit-slider-thumb]:w-3 touch-manipulation"}),(0,b.jsxs)("div",{className:"flex justify-between text-xs text-white mt-1",children:[(0,b.jsx)("span",{children:as(K)}),(0,b.jsx)("span",{children:as(M)})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:ao,className:"text-white hover:bg-white/20",children:I?(0,b.jsx)(h.Pause,{className:"w-5 h-5"}):(0,b.jsx)(g.Play,{className:"w-5 h-5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:()=>ap(-10),className:"text-white hover:bg-white/20",children:(0,b.jsx)(m,{className:"w-5 h-5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:()=>ap(10),className:"text-white hover:bg-white/20",children:(0,b.jsx)(n,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:()=>{let a=B.current;a&&(a.muted=!Q,R(!Q))},className:"text-white hover:bg-white/20",children:Q?(0,b.jsx)(j.VolumeX,{className:"w-5 h-5"}):(0,b.jsx)(i.Volume2,{className:"w-5 h-5"})}),(0,b.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:Q?0:O,onChange:a=>aq(Number(a.target.value)),className:"hidden sm:block w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-white"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",onClick:()=>V(!U),className:`text-white hover:bg-white/20 ${ae?"min-h-[44px] min-w-[44px]":""}`,children:[(0,b.jsx)(o.Settings,{className:"w-4 h-4 mr-1"}),S,"x"]}),U&&(0,b.jsx)("div",{className:"absolute bottom-full right-0 mb-2 bg-black/90 rounded-lg p-2 min-w-[100px]",children:[.5,.75,1,1.25,1.5,2].map(a=>(0,b.jsxs)("button",{onClick:()=>{let b;(b=B.current)&&(b.playbackRate=a,T(a),V(!1))},className:`block w-full text-left px-3 py-2 sm:py-1 text-sm rounded min-h-[44px] sm:min-h-0 flex items-center ${S===a?"bg-blue-500 text-white":"text-white hover:bg-white/20"}`,children:[a,"x"]},a))})]}),"u">typeof document&&document.pictureInPictureEnabled&&(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:ar,className:"text-white hover:bg-white/20",title:D.pip,children:(0,b.jsx)(r,{className:`w-5 h-5 ${ai?"text-blue-400":""}`})}),(0,b.jsx)(e.Button,{variant:"ghost",size:ae?"icon-touch":"icon",onClick:()=>{let a=C.current;a&&(document.fullscreenElement?document.exitFullscreen():a.requestFullscreen())},className:"text-white hover:bg-white/20",title:D.fullscreen,children:(0,b.jsx)(l,{className:"w-5 h-5"})})]})]})]}),E.length>0&&(0,b.jsxs)("div",{className:"absolute top-2 right-2 z-10",children:[(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{al(a=>!a),V(!1)},className:"text-white hover:bg-white/20",children:[D.quality," ","auto"===F?D.auto:F+"p"]}),ak&&(0,b.jsx)("div",{className:"absolute right-0 top-full mt-1 bg-black/90 rounded p-2 min-w-[80px]",children:["auto",...E].map(a=>(0,b.jsx)("button",{onClick:()=>{G(a),al(!1)},className:`block w-full text-left text-sm px-2 py-1 rounded text-white ${F===a?"bg-blue-500":"hover:bg-white/20"}`,children:"auto"===a?D.auto:a+"p"},a))})]}),(0,b.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gray-800",children:y.map((a,c)=>(0,b.jsx)("div",{className:"absolute top-0 w-1 h-full bg-yellow-500",style:{left:`${a/M*100}%`},title:`Quiz at ${as(a)}`},c))})]})}var u=a.i(981354),v=a.i(185407),w=a.i(595484),x=a.i(143650),y=a.i(50730),z=a.i(342621);function A({videoId:a,currentTime:d,onSeekToTimestamp:g}){let[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(!0);(0,c.useEffect)(()=>{let b=localStorage.getItem(`notes-${a}`);if(b)try{let a=JSON.parse(b);i(a.map(a=>({...a,createdAt:new Date(a.createdAt)})))}catch{console.error("Failed to load notes")}},[a]),(0,c.useEffect)(()=>{h.length>0&&localStorage.setItem(`notes-${a}`,JSON.stringify(h))},[h,a]);let n=()=>{if(!j.trim())return;let a={id:Date.now().toString(),timestamp:d,content:j,createdAt:new Date};i(b=>[...b,a].sort((a,b)=>a.timestamp-b.timestamp)),k("")},o=a=>{let b=Math.floor(a/60),c=Math.floor(a%60);return`${b}:${c.toString().padStart(2,"0")}`};return l?(0,b.jsxs)(f.Card,{className:"w-80 h-full flex flex-col",children:[(0,b.jsxs)(f.CardHeader,{className:"pb-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(f.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,b.jsx)(z.BookOpen,{className:"w-5 h-5"}),"Notes"]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>m(!1),children:"Hide"})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[h.length," note",1!==h.length?"s":""]})]}),(0,b.jsxs)(f.CardContent,{className:"flex-1 flex flex-col",children:[(0,b.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,b.jsx)(y.Clock,{className:"w-4 h-4"}),(0,b.jsxs)("span",{children:["At ",o(d)]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(u.Input,{placeholder:"Add a note...",value:j,onChange:a=>k(a.target.value),onKeyPress:a=>"Enter"===a.key&&n()}),(0,b.jsx)(e.Button,{size:"icon",onClick:n,disabled:!j.trim(),children:(0,b.jsx)(w.Plus,{className:"w-4 h-4"})})]})]}),(0,b.jsx)(v.ScrollArea,{className:"flex-1 -mx-2 px-2",children:(0,b.jsx)("div",{className:"space-y-3",children:0===h.length?(0,b.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,b.jsx)(z.BookOpen,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,b.jsx)("p",{className:"text-sm",children:"No notes yet"}),(0,b.jsx)("p",{className:"text-xs",children:"Click + to add a note at the current timestamp"})]}):h.map(a=>(0,b.jsxs)("div",{className:"border rounded-lg p-3 group hover:border-blue-300 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("button",{onClick:()=>g(a.timestamp),className:"flex items-center gap-1 text-sm font-medium text-blue-600 hover:text-blue-800",children:[(0,b.jsx)(y.Clock,{className:"w-3 h-3"}),o(a.timestamp)]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100",onClick:()=>{var b;return b=a.id,void i(a=>a.filter(a=>a.id!==b))},children:(0,b.jsx)(x.Trash2,{className:"w-3 h-3 text-red-500"})})]}),(0,b.jsx)("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:a.content}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:a.createdAt.toLocaleDateString()})]},a.id))})})]})]}):(0,b.jsxs)(e.Button,{variant:"outline",className:"h-full w-10 flex flex-col items-center py-4",onClick:()=>m(!0),children:[(0,b.jsx)(z.BookOpen,{className:"w-5 h-5 mb-2"}),(0,b.jsx)("span",{className:"text-xs writing-mode-vertical rotate-180",style:{writingMode:"vertical-rl"},children:"Notes"})]})}function B({title:a,questions:d,onSubmit:f,onSkip:g,locale:h="zh"}){let[i,j]=(0,c.useState)({}),[k,l]=(0,c.useState)(!1),m="zh"===h?{title:"éšå ‚å°æµ‹",submit:"æäº¤",skip:"è·³è¿‡",done:"å®Œæˆ"}:{title:"Quick Check",submit:"Submit",skip:"Skip",done:"Done"};return 0===d.length?(0,b.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-30 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md text-center",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"zh"===h?"æš‚æ— é¢˜ç›®":"No questions."}),(0,b.jsx)(e.Button,{onClick:g,children:m.skip})]})}):(0,b.jsx)("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-30 p-4 overflow-auto",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(p.MessageSquare,{className:"w-8 h-8 text-blue-500 shrink-0"}),(0,b.jsx)("h3",{className:"text-lg font-bold",children:a||m.title})]}),(0,b.jsx)("div",{className:"space-y-4",children:d.map((a,c)=>(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsxs)("p",{className:"font-medium text-gray-900 mb-2",children:[c+1,". ",a.question]}),a.options&&a.options.length>0?(0,b.jsx)("div",{className:"space-y-2",children:a.options.map((a,d)=>(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,b.jsx)("input",{type:"radio",name:`q-${c}`,checked:i[c]===String(d),onChange:()=>j(a=>({...a,[c]:String(d)})),className:"rounded"}),(0,b.jsx)("span",{children:a})]},d))}):(0,b.jsx)("input",{type:"text",value:i[c]??"",onChange:a=>j(b=>({...b,[c]:a.target.value})),placeholder:"zh"===h?"è¾“å…¥ç­”æ¡ˆ":"Your answer",className:"w-full border rounded px-3 py-2 text-sm"})]},c))}),(0,b.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:g,children:m.skip}),(0,b.jsx)(e.Button,{onClick:()=>{l(!0),f(i)},disabled:k,children:k?m.done:m.submit})]})]})})}var C=a.i(656247),D=a.i(815350),E=a.i(646962),F=a.i(395261),G=a.i(494176);let H={id:"welcome",role:"assistant",content:"Hi! I'm your AI tutor. I'm here to help you learn using the Socratic method - I'll guide you to answers rather than giving them directly. What would you like to explore?",timestamp:new Date};function I({context:a,className:d}){let[g,h]=(0,c.useState)(!1),i=(0,c.useRef)(null),{messages:j,input:k,setInput:l,isLoading:m,sendMessage:n,handleKeyPress:o}=function(a){let[b,d]=(0,c.useState)([H]),[e,f]=(0,c.useState)(""),[g,h]=(0,c.useState)(!1),i=(0,c.useCallback)(async()=>{let c=e.trim();if(!c||g)return;let i={id:Date.now().toString(),role:"user",content:c,timestamp:new Date};d(a=>[...a,i]),f(""),h(!0);try{let e=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c,subject:a?.subject,context:{...a,previousMessages:b.slice(-5).map(a=>({role:a.role,content:a.content}))}})}),f=await e.json(),g={id:(Date.now()+1).toString(),role:"assistant",content:f.response||"I apologize, but I am having trouble responding right now. Please try again.",timestamp:new Date,hintType:f.hintType,relevantConcepts:f.relevantConcepts};d(a=>[...a,g])}catch{let a={id:(Date.now()+1).toString(),role:"assistant",content:"I apologize, but I am having trouble responding right now. Please try again.",timestamp:new Date};d(b=>[...b,a])}finally{h(!1)}},[e,g,b,a]),j=(0,c.useCallback)(a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),i())},[i]);return{messages:b,input:e,setInput:f,isLoading:g,sendMessage:i,handleKeyPress:j}}(a);return(0,c.useEffect)(()=>{i.current?.scrollIntoView({behavior:"smooth"})},[j]),(0,b.jsxs)("div",{className:(0,G.cn)("fixed bottom-4 right-4 z-50",d),children:[g&&(0,b.jsxs)(f.Card,{className:"w-96 h-[500px] mb-4 flex flex-col shadow-2xl border-2 border-blue-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-blue-500 text-white rounded-t-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(E.Bot,{className:"w-5 h-5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:"AI Tutor"}),(0,b.jsxs)("p",{className:"text-xs text-blue-100",children:[a?.subject||"General"," Help"]})]})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>h(!1),className:"text-white hover:bg-blue-600",children:(0,b.jsx)(C.X,{className:"w-4 h-4"})})]}),(0,b.jsx)(v.ScrollArea,{className:"flex-1 p-4",children:(0,b.jsxs)("div",{className:"space-y-4",children:[j.map(a=>(0,b.jsx)(J,{message:a},a.id)),m&&(0,b.jsx)(K,{}),(0,b.jsx)("div",{ref:i})]})}),(0,b.jsxs)("div",{className:"p-4 border-t",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(u.Input,{placeholder:"Ask your question...",value:k,onChange:a=>l(a.target.value),onKeyPress:o,disabled:m,className:"flex-1"}),(0,b.jsx)(e.Button,{onClick:n,disabled:!k.trim()||m,size:"icon",children:(0,b.jsx)(D.Send,{className:"w-4 h-4"})})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"AI uses Socratic method - guiding you to answers"})]})]}),(0,b.jsx)(e.Button,{onClick:()=>h(!g),className:(0,G.cn)("rounded-full w-14 h-14 shadow-lg transition-all",g?"bg-gray-600 hover:bg-gray-700":"bg-blue-500 hover:bg-blue-600"),children:g?(0,b.jsx)(C.X,{className:"w-6 h-6"}):(0,b.jsx)(p.MessageSquare,{className:"w-6 h-6"})})]})}function J({message:a}){return(0,b.jsxs)("div",{className:(0,G.cn)("flex gap-2","user"===a.role?"justify-end":"justify-start"),children:["assistant"===a.role&&(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(E.Bot,{className:"w-4 h-4 text-blue-600"})}),(0,b.jsxs)("div",{className:(0,G.cn)("max-w-[80%] rounded-lg p-3","user"===a.role?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:[(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.content}),a.hintType&&(0,b.jsxs)("span",{className:(0,G.cn)("inline-block text-xs px-2 py-0.5 rounded-full mt-2","socratic"===a.hintType&&"bg-purple-100 text-purple-700","encouragement"===a.hintType&&"bg-green-100 text-green-700","direct"===a.hintType&&"bg-orange-100 text-orange-700","clarification"===a.hintType&&"bg-blue-100 text-blue-700"),children:["socratic"===a.hintType&&"ðŸ’¡ Socratic","encouragement"===a.hintType&&"â­ Encouragement","direct"===a.hintType&&"ðŸ“– Direct","clarification"===a.hintType&&"â“ Clarification"]}),a.relevantConcepts&&a.relevantConcepts.length>0&&(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:a.relevantConcepts.map((a,c)=>(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-50 text-blue-600 rounded",children:a},c))}),(0,b.jsx)("p",{className:(0,G.cn)("text-xs mt-1","user"===a.role?"text-blue-100":"text-gray-500"),children:a.timestamp.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]}),"user"===a.role&&(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(F.User,{className:"w-4 h-4 text-gray-600"})})]})}function K(){return(0,b.jsxs)("div",{className:"flex gap-2 justify-start",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(E.Bot,{className:"w-4 h-4 text-blue-600"})}),(0,b.jsx)("div",{className:"bg-gray-100 rounded-lg p-3",children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),(0,b.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-100"}),(0,b.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-200"})]})})]})}var L=a.i(238341),M=a.i(706562),N=a.i(619886),O=a.i(901138),P=a.i(52028);function Q(){let a=(0,d.useParams)(),g=a?.contentId,[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),u=(0,c.useRef)(null),v=(0,c.useRef)([]),w=(0,c.useRef)(null),x=(0,c.useRef)({progress:0,lastPosition:0}),y=(0,c.useCallback)(async()=>{if(u.current)return u.current;let a=await fetch("/api/csrf"),b=await a.json().catch(()=>({}));return u.current=b?.token??null,u.current},[]),z=(0,c.useCallback)(async()=>{if(0===v.current.length)return;let a=[...v.current];v.current=[];let b=await y();fetch(`/api/content/${g}/watch-events`,{method:"POST",headers:{"Content-Type":"application/json",...b&&{"X-CSRF-Token":b}},body:JSON.stringify({events:a}),credentials:"include"}).catch(()=>{})},[g,y]),C=(0,c.useCallback)(async(a,b)=>{x.current={progress:a,lastPosition:b};let c=await y();fetch("/api/progress",{method:"POST",headers:{"Content-Type":"application/json",...c&&{"X-CSRF-Token":c}},body:JSON.stringify({contentId:g,progress:Math.round(a),lastPosition:b,completed:a>=99}),credentials:"include"}).catch(()=>{})},[g,y]);(0,c.useEffect)(()=>{if(!g){m("No content ID provided"),k(!1);return}fetch(`/api/content/${g}`).then(async a=>{if(!a.ok)throw Error((await a.json().catch(()=>({error:"Unknown error"}))).error||`HTTP ${a.status}`);return a.json()}).then(a=>{a.content?i(a.content):m("Content not found"),k(!1)}).catch(a=>{m(a.message),k(!1)})},[g]),(0,c.useEffect)(()=>{g&&fetch("/api/bookmarks").then(a=>a.json()).then(a=>{q(a.bookmarks?.some(a=>a.contentId===g))}).catch(()=>{})},[g]),(0,c.useEffect)(()=>{let a=w.current;return()=>{a&&clearTimeout(a)}},[]);let D=(0,c.useCallback)(async(a,b)=>{let c=await y();await fetch(`/api/content/${g}/quiz-skip`,{method:"POST",headers:{"Content-Type":"application/json",...c&&{"X-CSRF-Token":c}},body:JSON.stringify({videoTimestampSeconds:a,note:b}),credentials:"include"}).catch(()=>{})},[g,y]),E=async()=>{try{(await fetch("/api/bookmarks",{method:p?"DELETE":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentId:g})})).ok&&q(!p)}catch(a){console.error("Bookmark error:",a)}};return j?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading lesson..."})]})}):l||!h?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,b.jsx)(f.Card,{className:"max-w-md w-full",children:(0,b.jsxs)(f.CardContent,{className:"pt-8 pb-8 text-center",children:[(0,b.jsx)(N.AlertCircle,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Content Not Found"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:l||"The lesson does not exist."}),(0,b.jsx)(P.default,{href:"/student/dashboard",children:(0,b.jsx)(e.Button,{children:"Back to Dashboard"})})]})})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("header",{className:"bg-white border-b sticky top-0 z-40 safe-top",children:(0,b.jsxs)("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(P.default,{href:"/student/dashboard",children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(M.ChevronLeft,{className:"w-5 h-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-bold",children:h.topic}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:h.subject})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:E,className:p?"text-yellow-500":"text-gray-400",title:p?"Remove bookmark":"Add bookmark",children:(0,b.jsx)(O.Bookmark,{className:`w-5 h-5 ${p?"fill-current":""}`})})]}),(0,b.jsx)(L.UserNav,{})]})}),(0,b.jsx)("main",{className:"container mx-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 relative",children:[h.videoUrl?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t,{videoUrl:h.videoUrl,title:h.topic,videoVariants:h.videoVariants,quizTimestamps:h.quizTimestamps??[],onProgress:a=>{o(a.currentTime),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{C(a.percentage,Math.floor(a.currentTime)),w.current=null},5e3)},onPlay:a=>{v.current.push({eventType:"play",videoSeconds:a})},onPause:a=>{v.current.push({eventType:"pause",videoSeconds:a}),z()},onSeek:(a,b)=>{v.current.push({eventType:"seek",videoSeconds:b,metadata:{fromTime:a,toTime:b}})},onComplete:()=>{v.current.push({eventType:"complete",videoSeconds:h.duration||0}),z(),C(100,h.duration||0)},onQuizTrigger:a=>{s(h.quizCheckpoints?.find(b=>2>Math.abs(b.videoTimestampSec-a))??null)},onQuizSkip:D,locale:"zh"}),r&&(0,b.jsx)(B,{title:r.title??void 0,questions:r.questions,locale:"zh",onSubmit:()=>{s(null)},onSkip:()=>s(null)})]}):(0,b.jsx)(f.Card,{children:(0,b.jsx)(f.CardContent,{className:"py-8 text-center text-gray-500",children:"æš‚æ— è§†é¢‘é“¾æŽ¥ã€‚è¯·å…ˆä¸Šä¼ æˆ–è®¾ç½®è§†é¢‘åœ°å€ã€‚"})}),(0,b.jsxs)(f.Card,{className:"mt-6",children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"About This Lesson"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("p",{className:"text-gray-700",children:h.transcript||"â€”"}),(0,b.jsxs)("p",{className:"text-sm text-gray-400 mt-4",children:["Duration: ",h.duration?Math.floor(h.duration/60):0," minutes"]})]})]})]}),(0,b.jsx)("div",{children:(0,b.jsx)(A,{videoId:g,currentTime:n,onSeekToTimestamp:a=>console.log("Seek to:",a)})})]})}),(0,b.jsx)(I,{context:{videoTitle:h.topic,currentTimestamp:n,subject:h.subject}})]})}a.s(["default",()=>Q],340749)}];

//# debugId=d556b872-36c1-3acb-9a4d-cdf8e6be54c6
//# sourceMappingURL=286d7_tutorme-app_src_app_%5Blocale%5D_student_learn_%5BcontentId%5D_page_tsx_5c4b3470._.js.map