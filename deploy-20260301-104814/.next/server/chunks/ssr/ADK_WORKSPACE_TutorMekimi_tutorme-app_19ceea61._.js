;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="aaba1c82-b0c7-afa0-1b5c-17d9e2cdb7cb")}catch(e){}}();
module.exports=[680233,a=>{"use strict";var b=a.i(741510),c=a.i(591137);function d(d){let e=(0,b.useRef)(null),[f,g]=(0,b.useState)(!1),[h,i]=(0,b.useState)(null);(0,b.useEffect)(()=>{let b;return(async()=>{let f=await a.A(443374).then(a=>a.getSocketToken());f?(e.current=b=(0,c.io)({path:"/api/socket",transports:["websocket","polling"],auth:{token:f}}),b.on("connect",()=>{console.log("Socket connected:",b.id),g(!0),i(null),d?.roomId&&d.userId&&d.name&&d.role&&b.emit("join_class",{roomId:d.roomId,userId:d.userId,name:d.name,role:d.role,tutorId:d.tutorId})}),b.on("disconnect",()=>{console.log("Socket disconnected"),g(!1)}),b.on("connect_error",a=>{console.error("Socket connection error:",a),i(a.message),g(!1)}),b.on("room_state",a=>{d?.onRoomState?.(a)}),b.on("student_joined",a=>{d?.onStudentJoined?.(a.state)}),b.on("student_left",a=>{d?.onStudentLeft?.(a.userId)}),b.on("student_state_update",a=>{d?.onStudentStateUpdate?.(a)}),b.on("student_distress",a=>{d?.onStudentDistress?.(a)}),b.on("chat_message",a=>{d?.onChatMessage?.(a)}),b.on("tutor_broadcast",a=>{d?.onTutorBroadcast?.(a)}),b.on("ai_hint",a=>{d?.onAIHint?.(a)}),b.on("whiteboard_update",a=>{d?.onWhiteboardUpdate?.(a)}),b.on("code_update",a=>{d?.onCodeUpdate?.(a)}),b.on("breakout_invite",a=>{d?.onBreakoutInvite?.(a)}),b.on("breakout_room_update",a=>{d?.onBreakoutRoomUpdate?.(a.rooms)}),b.on("breakout_message",a=>{d?.onBreakoutMessage?.(a)}),b.on("notification",a=>{d?.onNotification?.(a)})):i("Authentication required")})(),()=>{e.current&&(e.current.disconnect(),e.current=null)}},[d?.roomId,d?.userId,d?.name,d?.role,d?.tutorId]);let j=(0,b.useCallback)(a=>{e.current?.emit("chat_message",{text:a})},[]),k=(0,b.useCallback)(a=>{e.current?.emit("whiteboard_update",{strokes:a})},[]),l=(0,b.useCallback)((a,b)=>{e.current?.emit("code_update",{content:a,language:b})},[]),m=(0,b.useCallback)(a=>{e.current?.emit("activity_ping",a)},[]),n=(0,b.useCallback)((a,b="all")=>{e.current?.emit("tutor_broadcast",{text:a,targetGroup:b})},[]),o=(0,b.useCallback)((a,b,c)=>{e.current?.emit("push_hint",{targetUserId:a,hint:b,type:c})},[]),p=(0,b.useCallback)((a,b)=>{e.current?.emit("breakout_invite",{targetUserId:a,roomId:b})},[]),q=(0,b.useCallback)(a=>{e.current?.emit("breakout_broadcast",{message:a})},[]),r=(0,b.useCallback)(a=>{e.current?.emit("close_breakout",{breakoutRoomId:a})},[]),s=(0,b.useCallback)((a,b)=>{e.current?.emit("extend_breakout_time",{breakoutRoomId:a,minutes:b})},[]),t=(0,b.useCallback)((a,b)=>{e.current?.emit("breakout_message",{breakoutRoomId:a,message:b})},[]),u=(0,b.useCallback)((a,b)=>{e.current?.emit("request_help",{breakoutRoomId:a,reason:b})},[]);return{socket:e.current,isConnected:f,error:h,sendChatMessage:j,sendWhiteboardUpdate:k,sendCodeUpdate:l,sendActivityPing:m,sendBroadcast:n,pushHint:o,inviteToBreakout:p,sendBreakoutBroadcast:q,closeBreakoutRoom:r,extendBreakoutTime:s,sendBreakoutMessage:t,requestHelp:u}}a.s(["useSocket",()=>d])},700857,a=>{"use strict";let b=(0,a.i(293357).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);a.s(["Square",()=>b],700857)},832692,a=>{"use strict";let b=(0,a.i(293357).default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);a.s(["Grid3X3",()=>b],832692)},74469,660192,a=>{"use strict";var b=a.i(293357);let c=(0,b.default)("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);a.s(["Pin",()=>c],74469);let d=(0,b.default)("pin-off",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M15 9.34V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H7.89",key:"znwnzq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h11",key:"c9qhm2"}]]);a.s(["PinOff",()=>d],660192)},951869,a=>{"use strict";let b=(0,a.i(293357).default)("file-up",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);a.s(["FileUp",()=>b],951869)},639928,a=>{"use strict";let b=(0,a.i(293357).default)("mouse-pointer-2",[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]]);a.s(["MousePointer2",()=>b],639928)},177650,351531,924381,549155,737725,854257,a=>{"use strict";var b=a.i(293357);let c=(0,b.default)("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);a.s(["MinusCircle",()=>c],177650);let d=(0,b.default)("rectangle-horizontal",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}]]);a.s(["RectangleHorizontal",()=>d],351531);let e=(0,b.default)("triangle",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]);a.s(["Triangle",()=>e],924381);let f=(0,b.default)("highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);a.s(["Highlighter",()=>f],549155);let g=(0,b.default)("dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);a.s(["Dot",()=>g],737725);let h=(0,b.default)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);a.s(["Move",()=>h],854257)},254454,34462,273489,a=>{"use strict";var b=a.i(260576),c=a.i(741510),d=a.i(326684),e=a.i(333340),f=a.i(88684),g=a.i(113098),h=a.i(868606),i=a.i(878677),j=a.i(185407),k=a.i(263805),l=a.i(365134),m=a.i(106466),n=a.i(263531),o=a.i(143650),p=a.i(849639),q=a.i(700857),r=a.i(147779),s=a.i(294532),t=a.i(615443),u=a.i(19926),v=a.i(178499),w=a.i(748151),y=a.i(609931),z=a.i(819517),A=a.i(639928),B=a.i(74469),C=a.i(660192),D=a.i(595484),E=a.i(706562),F=a.i(892094),G=a.i(640132),H=a.i(226886),I=a.i(85961),J=a.i(832692),K=a.i(68366),L=a.i(908819),M=a.i(177650),N=a.i(987386),O=a.i(351531),P=a.i(879442),Q=a.i(924381),R=a.i(102710),S=a.i(549155),T=a.i(737725),U=a.i(854257),V=a.i(951869),W=a.i(628810),W=W,X=a.i(36094),Y=a.i(293357);let Z=(0,Y.default)("bring-to-front",[["rect",{x:"8",y:"8",width:"8",height:"8",rx:"2",key:"yj20xf"}],["path",{d:"M4 10a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2",key:"1ltk23"}],["path",{d:"M14 20a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2",key:"1q24h9"}]]),$=(0,Y.default)("send-to-back",[["rect",{x:"14",y:"14",width:"8",height:"8",rx:"2",key:"1b0bso"}],["rect",{x:"2",y:"2",width:"8",height:"8",rx:"2",key:"1x09vl"}],["path",{d:"M7 14v1a2 2 0 0 0 2 2h1",key:"pao6x6"}],["path",{d:"M14 7h1a2 2 0 0 1 2 2v1",key:"19tdru"}]]),_=(0,Y.default)("group",[["path",{d:"M3 7V5c0-1.1.9-2 2-2h2",key:"adw53z"}],["path",{d:"M17 3h2c1.1 0 2 .9 2 2v2",key:"an4l38"}],["path",{d:"M21 17v2c0 1.1-.9 2-2 2h-2",key:"144t0e"}],["path",{d:"M7 21H5c-1.1 0-2-.9-2-2v-2",key:"rtnfgi"}],["rect",{width:"7",height:"5",x:"7",y:"7",rx:"1",key:"1eyiv7"}],["rect",{width:"7",height:"5",x:"10",y:"12",rx:"1",key:"1qlmkx"}]]),aa=(0,Y.default)("ungroup",[["rect",{width:"8",height:"6",x:"5",y:"4",rx:"1",key:"nzclkv"}],["rect",{width:"8",height:"6",x:"11",y:"14",rx:"1",key:"4tytwb"}]]);var ab=a.i(879511);let ac=(0,Y.default)("text-align-start",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]]),ad=(0,Y.default)("text-align-center",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]]),ae=(0,Y.default)("text-align-end",[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]]),af=(0,Y.default)("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);a.s(["Gauge",()=>af],34462);var ag=a.i(682412),ah=a.i(846438);function ai(a,b,e){let f=(0,c.useCallback)((a,b)=>{if(!b.length)return a;let c=!1,d=new Map(a.map(a=>[a.id,a]));return b.forEach(a=>{if("delete"===a.kind){a.strokeId&&d.has(a.strokeId)&&(d.delete(a.strokeId),c=!0);return}let b=a.stroke;if(!b)return;let e=d.get(b.id),f=b.updatedAt||b.createdAt||0,g=e?.updatedAt||e?.createdAt||0;(!e||f>=g&&JSON.stringify(e)!==JSON.stringify(b))&&(d.set(b.id,b),c=!0)}),c?Array.from(d.values()):a},[]),{data:g}=(0,d.useSession)(),{socket:h,isConnected:i}=(0,ag.useSimpleSocket)(a||"",{userId:g?.user?.id,name:g?.user?.name||e,role:e}),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(new Map),[p,q]=(0,c.useState)("private"),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)([]),[y,z]=(0,c.useState)(new Map),[A,B]=(0,c.useState)(new Map),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(new Map),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)([{id:"tutor-broadcast",label:"Tutor Broadcast",visible:!0,locked:!1},{id:"tutor-private",label:"Tutor Private",visible:!0,locked:!1},{id:"student-personal",label:"Student Personal",visible:!0,locked:!1},{id:"shared-group",label:"Shared Group",visible:!0,locked:!1}]),[M,N]=(0,c.useState)("tutor"===e?"tutor-broadcast":"student-personal"),[O,P]=(0,c.useState)("none"),[Q,R]=(0,c.useState)({enabled:!1,x:160,y:120,width:420,height:220,mode:"rectangle"}),[S,T]=(0,c.useState)([]),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)([]),[Y,Z]=(0,c.useState)({mutedStudentIds:[],studentStrokeWindowLimit:80,strokeWindowMs:5e3,lockedLayers:[]}),$=(0,c.useRef)([]),_=(0,c.useRef)([]),aa=(0,c.useRef)(null),ab=(0,c.useRef)(0),ac=(0,c.useRef)({student:0,tutor:0});(0,c.useEffect)(()=>{$.current=j},[j]);let ad=(0,c.useCallback)(()=>{if(!h||!a||!g?.user?.id||!_.current.length)return;let b=new Map;_.current.forEach(a=>{"delete"===a.kind&&a.strokeId?b.set(a.strokeId,a):"upsert"===a.kind&&a.stroke&&b.set(a.stroke.id,a)}),_.current=[];let c=Array.from(b.values());c.length&&("student"===e?h.emit("lcwb_student_stroke_ops",{roomId:a,userId:g.user.id,ops:c,visibility:p}):"tutor"===e&&h.emit("lcwb_tutor_stroke_ops",{roomId:a,ops:c}))},[e,a,g,h,p]),ae=(0,c.useCallback)(a=>{!a.length||((_.current.push(...a),_.current.length>=120)?ad():aa.current||(aa.current=setTimeout(()=>{aa.current=null,ad()},28)))},[ad]);(0,c.useEffect)(()=>()=>{aa.current&&(clearTimeout(aa.current),aa.current=null),ad()},[ad]),(0,c.useEffect)(()=>{if(!b||!h||!i)return;let c=g?.user?.id;c&&("student"===e&&h.emit("lcwb_student_join",{roomId:a,userId:c,name:g?.user?.name||"Student"}),h.emit("lcwb_sync_request",{roomId:a,userId:c}),h.emit("lcwb_replay_request",{roomId:a,userId:c,scope:"tutor"===e?"tutor":"student",sinceSeq:"tutor"===e?ac.current.tutor:ac.current.student}),"student"===e&&h.emit("lcwb_replay_request",{roomId:a,userId:c,scope:"tutor",sinceSeq:ac.current.tutor}))},[b,a,h,i,e,g]),(0,c.useEffect)(()=>{if(h)return h.on("lcwb_tutor_broadcasting",()=>{}),h.on("lcwb_tutor_broadcast_stopped",()=>{m([])}),h.on("lcwb_tutor_stroke",a=>{m(b=>[...b,a])}),h.on("lcwb_tutor_strokes_reset",a=>{m(a.strokes||[])}),h.on("lcwb_tutor_stroke_ops",a=>{let b=Math.max(0,...(a.ops||[]).map(a=>a._seq||0));b>0&&(ac.current.tutor=Math.max(ac.current.tutor,b)),m(b=>f(b,a.ops||[]))}),h.on("lcwb_student_whiteboard_state",a=>{o(b=>{let c=new Map(b),d=c.get(a.studentId);return d?(d.strokes=a.strokes,d.lastActivity=new Date,c.set(a.studentId,d)):c.set(a.studentId,{studentId:a.studentId,studentName:"Student",whiteboardId:"",visibility:"tutor-only",strokes:a.strokes,lastActivity:new Date}),c})}),h.on("lcwb_student_whiteboard_created",a=>{w(b=>[...new Set([...b,a.studentId])]),o(b=>new Map(b.set(a.studentId,{studentId:a.studentId,studentName:a.name,whiteboardId:"",visibility:"private",strokes:[],lastActivity:new Date})))}),h.on("lcwb_student_stroke",a=>{o(b=>{let c=b.get(a.studentId);return c?(c.strokes.push(a.stroke),c.lastActivity=new Date,new Map(b)):b})}),h.on("lcwb_student_strokes_reset",a=>{o(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&(d.strokes=a.strokes||[],d.lastActivity=new Date,c.set(a.studentId,d)),c})}),h.on("lcwb_student_stroke_ops",a=>{let b=Math.max(0,...(a.ops||[]).map(a=>a._seq||0));b>0&&g?.user?.id===a.studentId&&(ac.current.student=Math.max(ac.current.student,b)),o(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&(d.strokes=f(d.strokes,a.ops||[]),d.lastActivity=new Date,c.set(a.studentId,d)),c})}),h.on("lcwb_student_visibility_changed",a=>{o(b=>{let c=b.get(a.studentId);return c?(c.visibility=a.visibility,new Map(b)):b})}),h.on("lcwb_student_public",a=>{w(b=>[...new Set([...b,a.studentId])])}),h.on("lcwb_public_student_stroke",a=>{o(b=>{let c=b.get(a.studentId);return c?(c.strokes.push(a.stroke),new Map(b)):b})}),h.on("lcwb_public_student_strokes_reset",a=>{o(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&(d.strokes=a.strokes||[],c.set(a.studentId,d)),c})}),h.on("lcwb_public_student_stroke_ops",a=>{o(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&(d.strokes=f(d.strokes,a.ops||[]),c.set(a.studentId,d)),c})}),h.on("lcwb_replay_ops",a=>{if("tutor"===a.scope){ac.current.tutor=Math.max(ac.current.tutor,a.latestSeq||0),m(b=>f(b,a.ops||[]));return}let b=g?.user?.id;b&&(!a.userId||a.userId===b)&&(ac.current.student=Math.max(ac.current.student,a.latestSeq||0),k(b=>f(b,a.ops||[])))}),h.on("lcwb_selection_presence_update",a=>{a?.userId&&a.userId!==g?.user?.id&&B(b=>{let c=new Map(b);return c.set(a.userId,a),c})}),h.on("lcwb_selection_presence_remove",a=>{a?.userId&&B(b=>{if(!b.has(a.userId))return b;let c=new Map(b);return c.delete(a.userId),c})}),h.on("lcwb_branch_list",a=>{D(a.branches||[])}),h.on("lcwb_tutor_viewing",()=>{}),h.on("lcwb_tutor_stopped_viewing",()=>{}),h.on("lcwb_tutor_annotation",a=>{k(b=>[...b,a.stroke])}),h.on("lcwb_sync_response",a=>{k(a.strokes)}),h.on("lcwb_cursor_update",a=>{z(b=>{let c=new Map(b);return c.set(a.userId,a),c})}),h.on("lcwb_cursor_remove",a=>{z(b=>{let c=new Map(b);return c.delete(a.userId),c})}),h.on("lcwb_layer_locked",a=>{F(a.locked)}),h.on("lcwb_layer_config",a=>{L(b=>b.map(b=>({...b,visible:a.visibility[b.id]??b.visible,locked:a.lockedLayers.includes(b.id)})))}),h.on("lcwb_student_submitted",a=>{"tutor"===e&&ah.toast.success(`${a.studentName} submitted their board`),H(b=>{let c=new Map(b);return c.set(a.studentId,{studentId:a.studentId,studentName:a.studentName,submittedAt:a.submittedAt,strokeCount:a.strokeCount,reviewed:!1}),c})}),h.on("lcwb_submission_reviewed",a=>{"student"===e&&g?.user?.id===a.studentId&&(J(!1),ah.toast.success("Your board was reviewed by the tutor")),"tutor"===e&&H(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&c.set(a.studentId,{...d,reviewed:!0}),c})}),h.on("lcwb_moderation_state",a=>{Z(a)}),h.on("lcwb_moderation_warning",a=>{ah.toast.warning(a.message||"Board action blocked by moderation settings")}),h.on("lcwb_assignment_overlay",a=>{P(a.overlay)}),h.on("lcwb_spotlight_update",a=>{R(a)}),h.on("lcwb_ai_region_hint",a=>{X(b=>[a,...b].slice(0,20))}),h.on("lcwb_snapshot_created",a=>{T(b=>[a,...b].slice(0,80))}),h.on("lcwb_snapshot_timeline",a=>{T(a.snapshots)}),h.on("lcwb_breakout_promoted",a=>{"tutor"===e&&m(b=>[...b,...a.strokes])}),h.on("lcwb_ai_region_error",a=>{ah.toast.error(a.message||"Failed to get AI hint")}),h.on("lcwb_export_attached",a=>{ah.toast.success(`Export "${a.name}" attached by tutor`)}),h.on("lcwb_student_cleared_own",a=>{"tutor"===e&&o(b=>{let c=new Map(b),d=c.get(a.studentId);return d&&(d.strokes=[],c.set(a.studentId,d)),c}),"student"===e&&g?.user?.id===a.studentId&&(k([]),ah.toast.info("Your board was cleared"))}),()=>{h.off("lcwb_tutor_broadcasting"),h.off("lcwb_tutor_broadcast_stopped"),h.off("lcwb_tutor_stroke"),h.off("lcwb_tutor_strokes_reset"),h.off("lcwb_tutor_stroke_ops"),h.off("lcwb_student_whiteboard_created"),h.off("lcwb_student_stroke"),h.off("lcwb_student_strokes_reset"),h.off("lcwb_student_stroke_ops"),h.off("lcwb_student_visibility_changed"),h.off("lcwb_student_public"),h.off("lcwb_public_student_stroke"),h.off("lcwb_public_student_strokes_reset"),h.off("lcwb_public_student_stroke_ops"),h.off("lcwb_replay_ops"),h.off("lcwb_selection_presence_update"),h.off("lcwb_selection_presence_remove"),h.off("lcwb_branch_list"),h.off("lcwb_tutor_viewing"),h.off("lcwb_tutor_stopped_viewing"),h.off("lcwb_tutor_annotation"),h.off("lcwb_sync_response"),h.off("lcwb_student_whiteboard_state"),h.off("lcwb_cursor_update"),h.off("lcwb_cursor_remove"),h.off("lcwb_layer_locked"),h.off("lcwb_layer_config"),h.off("lcwb_student_submitted"),h.off("lcwb_submission_reviewed"),h.off("lcwb_moderation_state"),h.off("lcwb_moderation_warning"),h.off("lcwb_assignment_overlay"),h.off("lcwb_spotlight_update"),h.off("lcwb_ai_region_hint"),h.off("lcwb_snapshot_created"),h.off("lcwb_snapshot_timeline"),h.off("lcwb_breakout_promoted"),h.off("lcwb_ai_region_error"),h.off("lcwb_export_attached"),h.off("lcwb_student_cleared_own")}},[f,e,g?.user?.id,h]),(0,c.useEffect)(()=>{let a=setInterval(()=>{let a=Date.now()-5e3;z(b=>{let c=new Map(b),d=!1;return c.forEach((b,e)=>{b.lastUpdated<a&&(c.delete(e),d=!0)}),d?c:b})},2e3);return()=>clearInterval(a)},[]);let af=(0,c.useCallback)(()=>{if("tutor"===e){if(!h||!i)return void ah.toast.warning("Connect to the class first");if(!b||!a)return void ah.toast.warning("Session or room not ready");h.emit("lcwb_broadcast_start",{roomId:a,whiteboardId:g?.user?.id}),s(!0)}},[h,i,e,a,b,g]),ai=(0,c.useCallback)(()=>{h&&"tutor"===e&&(h.emit("lcwb_broadcast_stop",{roomId:a}),s(!1))},[h,e,a]),aj=(0,c.useCallback)(b=>{h&&"tutor"===e&&h.emit("lcwb_stroke_broadcast",{roomId:a,stroke:b})},[h,e,a]),ak=(0,c.useCallback)(b=>{if(h&&g?.user?.id&&("student"!==e||!E)){if("student"===e&&Y.lockedLayers.includes(M))return void ah.toast.warning("This layer is locked by the tutor");k(a=>[...a,b]),h.emit("lcwb_student_update",{roomId:a,userId:g.user.id,stroke:{...b,layerId:b.layerId||M},visibility:p}),"student"===e&&I&&J(!1)}},[h,g,e,E,a,p,I,M,Y.lockedLayers]),al=(0,c.useCallback)(b=>{if(!h||"tutor"!==e)return;let c={...b,layerId:b.layerId||M};k(a=>[...a,c]),(r||"tutor-broadcast"===c.layerId)&&h.emit("lcwb_stroke_broadcast",{roomId:a,stroke:c})},[h,e,M,r,a]),am=(0,c.useCallback)(b=>{h&&"student"===e&&g?.user?.id&&(q(b),h.emit("lcwb_visibility_change",{roomId:a,userId:g.user.id,visibility:b}))},[h,e,a,g]),an=(0,c.useCallback)(b=>{h&&"tutor"===e&&(t&&h.emit("lcwb_tutor_stop_view",{roomId:a,studentId:t}),h.emit("lcwb_tutor_view_student",{roomId:a,studentId:b}),u(b))},[h,e,a,t]),ao=(0,c.useCallback)(()=>{h&&"tutor"===e&&t&&(h.emit("lcwb_tutor_stop_view",{roomId:a,studentId:t}),u(null))},[h,e,a,t]),ap=(0,c.useCallback)((b,c)=>{h&&"tutor"===e&&h.emit("lcwb_tutor_annotate",{roomId:a,studentId:b,stroke:c})},[h,e,a]),aq=(0,c.useCallback)(a=>{a?k(b=>b.filter(b=>b.pageId!==a)):k([])},[]),ar=(0,c.useCallback)(a=>{k(b=>{if(!a)return b.slice(0,-1);let c=[...b].reverse().findIndex(b=>b.pageId===a);if(c<0)return b;let d=b.length-1-c;return b.filter((a,b)=>b!==d)})},[]),as=(0,c.useCallback)((b,c,d="cursor")=>{h&&g?.user?.id&&a&&h.emit("lcwb_cursor_update",{roomId:a,userId:g.user.id,name:g.user.name||e,role:e,x:b,y:c,pointerMode:d,lastUpdated:Date.now()})},[h,g,a,e]),at=(0,c.useCallback)((b,c,d="#2563eb")=>{h&&a&&g?.user?.id&&h.emit("lcwb_selection_presence_update",{roomId:a,userId:g.user.id,name:g.user.name||e,role:e,strokeIds:b,pageId:c,color:d,updatedAt:Date.now()})},[a,e,g,h]),au=(0,c.useCallback)(b=>{h&&a&&g?.user?.id&&b.trim()&&h.emit("lcwb_branch_create",{roomId:a,scope:"tutor"===e?"tutor":"student",userId:g.user.id,branchName:b.trim()})},[a,e,g,h]),av=(0,c.useCallback)(b=>{h&&a&&g?.user?.id&&b.trim()&&h.emit("lcwb_branch_switch",{roomId:a,scope:"tutor"===e?"tutor":"student",userId:g.user.id,branchName:b.trim()})},[a,e,g,h]),aw=(0,c.useCallback)(b=>{if("tutor"===e){if(!h||!i)return void ah.toast.warning("Connect to the class first");if(!a)return void ah.toast.warning("Room not ready");F(b),h.emit("lcwb_layer_lock",{roomId:a,locked:b})}},[h,i,e,a]),ax=(0,c.useCallback)(b=>{if(L(b),!h||!a||"tutor"!==e)return;let c=b.reduce((a,b)=>(a[b.id]=b.visible,a),{});h.emit("lcwb_layer_config_update",{roomId:a,visibility:c,lockedLayers:b.filter(a=>a.locked).map(a=>a.id)})},[h,a,e]),ay=(0,c.useCallback)((b,c)=>{L(d=>{let f=d.map(a=>a.id===b?{...a,locked:c}:a);if(h&&a&&"tutor"===e){let b=f.reduce((a,b)=>(a[b.id]=b.visible,a),{});h.emit("lcwb_layer_config_update",{roomId:a,visibility:b,lockedLayers:f.filter(a=>a.locked).map(a=>a.id)})}return f})},[h,a,e]),az=(0,c.useCallback)(()=>{h&&"student"===e&&g?.user?.id&&a&&(h.emit("lcwb_student_submit",{roomId:a,studentId:g.user.id,studentName:g.user.name||"Student",strokeCount:$.current.length,submittedAt:Date.now()}),J(!0),ah.toast.success("Board submitted to tutor"))},[h,e,g,a]),aA=(0,c.useCallback)(b=>{h&&"tutor"===e&&a&&(h.emit("lcwb_tutor_mark_reviewed",{roomId:a,studentId:b}),H(a=>{let c=new Map(a),d=c.get(b);return d&&c.set(b,{...d,reviewed:!0}),c}))},[h,e,a]),aB=(0,c.useCallback)((a,b)=>{H(c=>{let d=new Map(c),e=d.get(a);return e&&d.set(a,{...e,pinned:b}),d})},[]),aC=(0,c.useCallback)(()=>{h&&"tutor"===e&&a&&(Array.from(G.values()).filter(a=>!a.reviewed).forEach(b=>{h.emit("lcwb_tutor_mark_reviewed",{roomId:a,studentId:b.studentId})}),H(a=>{let b=new Map(a);return b.forEach((a,c)=>{b.set(c,{...a,reviewed:!0})}),b}))},[h,e,a,G]),aD=(0,c.useCallback)((b,c)=>{if(!h||"tutor"!==e||!a)return;let d=new Set(Y.mutedStudentIds);c&&d.add(b),c||d.delete(b),h.emit("lcwb_tutor_moderation_update",{roomId:a,mutedStudentIds:Array.from(d),studentStrokeWindowLimit:Y.studentStrokeWindowLimit,strokeWindowMs:Y.strokeWindowMs,lockedLayers:Y.lockedLayers})},[h,e,a,Y]),aE=(0,c.useCallback)((b,c=Y.strokeWindowMs)=>{h&&"tutor"===e&&a&&h.emit("lcwb_tutor_moderation_update",{roomId:a,mutedStudentIds:Y.mutedStudentIds,studentStrokeWindowLimit:b,strokeWindowMs:c,lockedLayers:Y.lockedLayers})},[h,e,a,Y]),aF=(0,c.useCallback)(()=>{h&&a&&g?.user?.id&&(k(a=>a.filter(a=>a.userId!==g.user.id)),h.emit("lcwb_clear_own",{roomId:a,userId:g.user.id}))},[h,a,g]),aG=(0,c.useCallback)(b=>{k(c=>{let d="function"==typeof b?b(c):b;if(h&&a&&g?.user?.id){let a=new Map(c.map(a=>[a.id,a])),b=new Map(d.map(a=>[a.id,a])),e=[];if(b.forEach((b,c)=>{let d=a.get(c);d&&JSON.stringify(d)===JSON.stringify(b)||(ab.current+=1,e.push({kind:"upsert",stroke:b,opId:`${g.user.id}:${Date.now()}:${ab.current}:${c}:u`,sentAt:Date.now(),baseVersion:d?.updatedAt||d?.createdAt||0}))}),a.forEach((a,c)=>{b.has(c)||(ab.current+=1,e.push({kind:"delete",strokeId:c,opId:`${g.user.id}:${Date.now()}:${ab.current}:${c}:d`,sentAt:Date.now()}))}),!e.length)return c;ae(e)}return d})},[ae,a,g,h]),aH=(0,c.useCallback)(b=>{P(b),h&&"tutor"===e&&a&&h.emit("lcwb_assignment_overlay",{roomId:a,overlay:b})},[h,e,a]),aI=(0,c.useCallback)(b=>{R(b),h&&"tutor"===e&&a&&h.emit("lcwb_spotlight_update",{roomId:a,...b})},[h,e,a]),aJ=(0,c.useCallback)((b,c)=>{h&&a&&h.emit("lcwb_ai_region_request",{roomId:a,region:b,context:c})},[h,a]),aK=(0,c.useCallback)(b=>{h&&a&&h.emit("lcwb_snapshot_capture",{roomId:a,strokes:b})},[h,a]),aL=(0,c.useCallback)(()=>{h&&a&&h.emit("lcwb_snapshot_request",{roomId:a})},[h,a]),aM=(0,c.useCallback)((b,c,d)=>{h&&"tutor"===e&&a&&h.emit("lcwb_breakout_promote",{mainRoomId:a,breakoutRoomId:b,sourceStudentId:d,strokes:c})},[h,e,a]),aN=(0,c.useCallback)(c=>{h&&"tutor"===e&&a&&h.emit("lcwb_export_attach",{roomId:a,sessionId:b,studentId:c.studentId,format:c.format,fileName:c.fileName,dataUrl:c.dataUrl})},[h,e,a,b]);return(0,c.useEffect)(()=>{if(!a||!h)return;let b=setInterval(()=>{j.length>0&&h.emit("lcwb_snapshot_capture",{roomId:a,strokes:j})},12e4);return()=>clearInterval(b)},[a,h,e,j]),{myStrokes:j,tutorStrokes:l,studentWhiteboards:n,visibility:p,isBroadcasting:r,viewingStudentId:t,activeStudentBoards:v,isConnected:i,remoteCursors:y,remoteSelections:Array.from(A.values()),isLayerLocked:E,submissions:Array.from(G.values()).sort((a,b)=>b.submittedAt-a.submittedAt),hasSubmitted:I,layerConfig:K,activeLayerId:M,assignmentOverlay:O,spotlight:Q,snapshots:[...S].sort((a,b)=>b.createdAt-a.createdAt),timelineIndex:U,aiRegionHints:W,moderationState:Y,availableBranches:C,startBroadcast:af,stopBroadcast:ai,broadcastStroke:aj,addStroke:ak,addTutorStroke:al,changeVisibility:am,viewStudentWhiteboard:an,stopViewingStudent:ao,annotateOnStudentBoard:ap,clearMyWhiteboard:aq,undoLastStroke:ar,updateCursor:as,updateSelectionPresence:at,toggleLayerLock:aw,submitMyBoard:az,markSubmissionReviewed:aA,markAllSubmissionsReviewed:aC,pinSubmission:aB,setLayerConfig:ax,setActiveLayerId:N,setLayerLock:ay,setDrawMuteForStudent:aD,updateStrokeRateLimit:aE,clearOwnStrokes:aF,replaceMyStrokes:aG,setAssignmentOverlayMode:aH,updateSpotlight:aI,requestAIRegionHint:aJ,captureSnapshot:aK,requestSnapshotTimeline:aL,setTimelineIndex:V,promoteBreakoutBoard:aM,exportAndAttachBoard:aN,createBoardBranch:au,switchBoardBranch:av}}var aj=a.i(494176),ak=a.i(206209),al=a.i(342621),am=a.i(450331),an=a.i(479680),ao=a.i(102355);function ap({buttonClassName:a,initialCourseId:d,classSubject:g,onMakeVisibleToStudents:h}){let[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null),[w,y]=(0,c.useState)(0),[z,A]=(0,c.useState)(720),B=(0,c.useRef)(!1),C=(0,c.useMemo)(()=>k.find(a=>a.id===m)||null,[k,m]),D=(0,c.useCallback)(async()=>{p(!0);try{let a=await fetch("/api/tutor/courses",{credentials:"include"});if(!a.ok)throw Error("Failed to load courses");let b=await a.json(),c=Array.isArray(b.courses)?b.courses:[];l(c);let e=d&&c.some(a=>a.id===d)?d:null;e?n(e):!m&&c.length>0&&n(c[0].id)}catch{l([])}finally{p(!1)}},[m,d]),E=(0,c.useCallback)(async a=>{if(a){r(!0);try{let b=await fetch(`/api/tutor/courses/${a}/curriculum`,{credentials:"include"});if(!b.ok)throw Error("Failed to load course builder data");let c=await b.json();v(Array.isArray(c.modules)?c.modules:[]),y(a=>a+1)}catch{v([]),ah.toast.error("Failed to load course content")}finally{r(!1)}}},[]);(0,c.useEffect)(()=>{D()},[D]),(0,c.useEffect)(()=>{i&&m&&E(m)},[i,m,E]);let F=async(a,b)=>{if(m){t(!0);try{let c=await fetch("/api/csrf",{credentials:"include"}),d=await c.json().catch(()=>({})),e=d?.token??null,f=await fetch(`/api/tutor/courses/${m}/curriculum`,{method:"PUT",headers:{"Content-Type":"application/json",...e&&{"X-CSRF-Token":e}},credentials:"include",body:JSON.stringify({modules:a,developmentMode:b?.developmentMode??"single",previewDifficulty:b?.previewDifficulty??"all"})}),g=await f.json().catch(()=>({}));if(!f.ok)return void ah.toast.error(g.error??"Failed to save curriculum");v(a),ah.toast.success(`Curriculum saved — ${g.moduleCount??a.length} modules`)}catch{ah.toast.error("Failed to save curriculum")}finally{t(!1)}}},G=C?.name??(g?`${g} Class`:"Course Builder");(0,c.useEffect)(()=>{let a=()=>{let a=window.innerWidth,b=Math.round(.48*a);A(Math.max(420,Math.min(Math.max(620,a-280),b)))};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,c.useEffect)(()=>{let a=a=>{B.current&&A(Math.max(420,Math.min(Math.max(620,window.innerWidth-240),a.clientX)))},b=a=>{if(!B.current)return;let b=a.touches[0];b&&A(Math.max(420,Math.min(Math.max(620,window.innerWidth-240),b.clientX)))},c=()=>{B.current=!1,document.body.style.userSelect="",document.body.style.cursor=""};return window.addEventListener("mousemove",a),window.addEventListener("touchmove",b,{passive:!0}),window.addEventListener("mouseup",c),window.addEventListener("touchend",c),()=>{window.removeEventListener("mousemove",a),window.removeEventListener("touchmove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchend",c)}},[]);let H=()=>{B.current=!0,document.body.style.userSelect="none",document.body.style.cursor="col-resize"};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",className:a,onClick:()=>j(!0),children:[(0,b.jsx)(al.BookOpen,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"max-w-[220px] truncate",children:G})]}),i&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,b.jsx)("button",{type:"button","aria-label":"Close course builder panel overlay",className:"absolute inset-0 bg-black/65",onClick:()=>j(!1)}),(0,b.jsxs)("div",{className:"absolute inset-y-0 left-0 flex h-full border-r bg-background shadow-xl",style:{width:`${z}px`},children:[(0,b.jsx)("button",{type:"button","aria-label":"Resize course builder panel",onMouseDown:H,onTouchStart:H,className:"absolute right-0 top-0 z-20 h-full w-3 cursor-col-resize border-r border-transparent bg-transparent transition-colors hover:border-blue-300"}),(0,b.jsxs)("div",{className:"flex h-full min-w-0 flex-1 flex-col",children:[(0,b.jsxs)("div",{className:"border-b px-6 py-4",children:[(0,b.jsx)("div",{className:"text-lg font-semibold",children:"Live Course Builder Panel"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"This is the same builder as Course Builder page. Changes stay in sync."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 border-b px-6 py-3",children:[(0,b.jsx)("div",{className:"w-[360px]",children:(0,b.jsxs)(ak.Select,{value:m,onValueChange:n,children:[(0,b.jsx)(ak.SelectTrigger,{children:(0,b.jsx)(ak.SelectValue,{placeholder:o?"Loading courses…":"Select a course"})}),(0,b.jsx)(ak.SelectContent,{children:k.map(a=>(0,b.jsx)(ak.SelectItem,{value:a.id,children:a.name},a.id))})]})}),(0,b.jsxs)(f.Button,{type:"button",variant:"outline",size:"sm",disabled:!m||q,onClick:()=>E(m),children:[(0,b.jsx)(am.RefreshCw,{className:"w-4 h-4 mr-2"}),q?"Syncing…":"Sync"]}),s&&(0,b.jsx)(e.Badge,{variant:"secondary",children:"Saving…"})]}),(0,b.jsx)("div",{className:"min-h-0 flex-1 overflow-hidden",children:m?q||null===u?(0,b.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,b.jsx)(an.Loader2,{className:"h-6 w-6 animate-spin text-blue-500"})}):(0,b.jsx)("div",{className:"h-full overflow-auto px-4 py-4",children:(0,b.jsx)(ao.CourseBuilder,{courseId:m,courseName:C?.name,panelMode:"live-class",initialModules:u,onSave:F,onMakeVisibleToStudents:a=>{j(!1),h?.(a)}},`${m}:${w}`)}):(0,b.jsx)("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Select a course to open the builder."})}),(0,b.jsx)("button",{type:"button",className:"absolute right-4 top-4 rounded border border-border bg-background px-2 py-1 text-xs text-muted-foreground hover:text-foreground",onClick:()=>j(!1),children:"Close"})]})]})]})]})}var aq=a.i(40719);let ar=["#111827","#2563EB","#7C3AED","#059669","#DC2626","#EA580C","#0891B2","#CA8A04","#6B7280"],as={pencil:{width:2,opacity:.82,strokeType:"pencil"},pen:{width:3,opacity:1,strokeType:"pen"},marker:{width:6,opacity:.9,strokeType:"marker"},highlighter:{width:16,opacity:.22,strokeType:"highlighter"},calligraphy:{width:5,opacity:.95,strokeType:"calligraphy"},eraser:{width:24,opacity:1,strokeType:"eraser"},line:{width:3,opacity:1,strokeType:"shape"},arrow:{width:3,opacity:1,strokeType:"shape"},rectangle:{width:3,opacity:1,strokeType:"shape"},circle:{width:3,opacity:1,strokeType:"shape"},triangle:{width:3,opacity:1,strokeType:"shape"},connector:{width:3,opacity:1,strokeType:"shape"},text:{width:3,opacity:1,strokeType:"text"},laser:{width:3,opacity:1,strokeType:"pen"},hand:{width:3,opacity:1,strokeType:"pen"},select:{width:3,opacity:1,strokeType:"pen"}},at="page-1";function au({roomId:a,sessionId:d,initialCourseId:g,classSubject:Y,students:ag,onDocumentVisibleToStudents:ah}){let ak=(0,c.useRef)(null),al=(0,c.useRef)(null),[am,an]=(0,c.useState)("pen"),[ao,au]=(0,c.useState)("#111827"),[ax,ay]=(0,c.useState)("#111827"),[az,aA]=(0,c.useState)(3),[aB,aC]=(0,c.useState)(!1),[aD,aE]=(0,c.useState)([]),[aF,aG]=(0,c.useState)(null),[aH,aI]=(0,c.useState)(null),[aJ,aK]=(0,c.useState)(null),[aL,aM]=(0,c.useState)(null),[aN,aO]=(0,c.useState)(22),[aP,aQ]=(0,c.useState)({scale:1,offsetX:0,offsetY:0}),[aR,aS]=(0,c.useState)(!1),aT=(0,c.useRef)(null),[aU,aV]=(0,c.useState)(null),[aW,aX]=(0,c.useState)(new Set),[aY,aZ]=(0,c.useState)("rect"),[a$,a_]=(0,c.useState)("intersect"),[a0,a1]=(0,c.useState)(null),[a2,a3]=(0,c.useState)(!1),[a4,a5]=(0,c.useState)(null),a6=(0,c.useRef)(null),[a7,a8]=(0,c.useState)(!1),a9=(0,c.useRef)(null),[ba,bb]=(0,c.useState)(null),bc=(0,c.useRef)(null),bd=(0,c.useRef)(new Map),[be,bf]=(0,c.useState)(!0),[bg,bh]=(0,c.useState)(!0),[bi,bj]=(0,c.useState)(20),[bk,bl]=(0,c.useState)(""),[bm,bn]=(0,c.useState)([]),[bo,bp]=(0,c.useState)(null),[bq,br]=(0,c.useState)("plain"),[bs,bt]=(0,c.useState)({bold:!1,italic:!1,align:"left"}),[bu,bv]=(0,c.useState)(1),[bw,bx]=(0,c.useState)(!0),[by,bz]=(0,c.useState)(!1),[bA,bB]=(0,c.useState)(0),[bC,bD]=(0,c.useState)(""),[bE,bF]=(0,c.useState)([]),[bG,bH]=(0,c.useState)(""),[bI,bJ]=(0,c.useState)("my-board"),[bK,bL]=(0,c.useState)("all"),[bM,bN]=(0,c.useState)(null),[bO,bP]=(0,c.useState)(!1),[bQ,bR]=(0,c.useState)(null),[bS,bT]=(0,c.useState)(!1),[bU,bV]=(0,c.useState)([{id:at,label:"Page 1"}]),[bW,bX]=(0,c.useState)(at),{myStrokes:bY,studentWhiteboards:bZ,isBroadcasting:b$,isConnected:b_,viewingStudentId:b0,activeStudentBoards:b1,remoteCursors:b2,remoteSelections:b3,startBroadcast:b4,stopBroadcast:b5,viewStudentWhiteboard:b6,stopViewingStudent:b7,isLayerLocked:b8,submissions:b9,toggleLayerLock:ca,markSubmissionReviewed:cb,markAllSubmissionsReviewed:cc,pinSubmission:cd,clearMyWhiteboard:ce,replaceMyStrokes:cf,undoLastStroke:cg,updateCursor:ch,updateSelectionPresence:ci,addTutorStroke:cj,layerConfig:ck,activeLayerId:cl,setLayerConfig:cm,setActiveLayerId:cn,setLayerLock:co,moderationState:cp,setDrawMuteForStudent:cq,updateStrokeRateLimit:cr,assignmentOverlay:cs,setAssignmentOverlayMode:ct,spotlight:cu,updateSpotlight:cv,requestAIRegionHint:cw,aiRegionHints:cx,snapshots:cy,availableBranches:cz,requestSnapshotTimeline:cA,promoteBreakoutBoard:cB,exportAndAttachBoard:cC,createBoardBranch:cD,switchBoardBranch:cE}=ai(a,d,"tutor"),cF=new Map(b9.map(a=>[a.studentId,a])),cG=b9.filter(a=>!a.reviewed),cH=bM?cF.get(bM):void 0,cI=bM?ag.find(a=>a.id===bM):void 0,cJ=bM?bZ.get(bM):void 0,cK=ag.filter(a=>{let b=cF.get(a.id);return"all"===bK||("submitted"===bK?!!b:"pending"===bK?!!(b&&!b.reviewed):!!(b&&b.reviewed))}),cL=(0,c.useMemo)(()=>null!==bQ?cy[bQ]?.strokes||[]:bY,[bQ,cy,bY]),cM=(0,c.useMemo)(()=>cL.filter(a=>(a.pageId||at)===bW),[cL,bW]),cN=(0,c.useMemo)(()=>bU.findIndex(a=>a.id===bW),[bU,bW]),cO=(0,c.useCallback)(a=>{bN(a),bP(!0),b6(a)},[b6]),cP=(0,c.useCallback)(()=>{if(!bM)return;let a=cG.findIndex(a=>a.studentId===bM),b=cG[a+1]||cG[0];b&&(bN(b.studentId),b6(b.studentId))},[cG,bM,b6]),cQ=(0,c.useCallback)(()=>{if(!bM||0===cG.length)return;let a=cG.findIndex(a=>a.studentId===bM),b=a>0?cG[a-1]:cG[cG.length-1];b&&(bN(b.studentId),b6(b.studentId))},[cG,bM,b6]);(0,c.useEffect)(()=>{if(!bO)return;let a=a=>{a.target?.tagName!=="INPUT"&&a.target?.tagName!=="TEXTAREA"&&("r"===a.key.toLowerCase()&&cH&&!cH.reviewed&&(a.preventDefault(),cb(cH.studentId)),"j"===a.key.toLowerCase()&&(a.preventDefault(),cP()),"k"===a.key.toLowerCase()&&(a.preventDefault(),cQ()))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[bO,cb,cP,cQ,cH]);let cR=(0,c.useMemo)(()=>new Set(["line","arrow","rectangle","circle","triangle","connector"]),[]),cS=(0,c.useMemo)(()=>new Set(["pencil","pen","marker","highlighter","calligraphy","eraser"]),[]),cT=(0,c.useCallback)((a,b,c,d,e)=>{let f=Math.min(c.x,d.x),g=Math.min(c.y,d.y),h=Math.abs(d.x-c.x),i=Math.abs(d.y-c.y);if(a.save(),a.globalAlpha=e.opacity??1,a.strokeStyle=e.color,a.lineWidth=e.width,a.lineCap="round",a.lineJoin="round","line"===b||"arrow"===b||"connector"===b){if(a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(d.x,d.y),a.stroke(),"connector"===b&&(a.beginPath(),a.arc(c.x,c.y,Math.max(3,e.width),0,2*Math.PI),a.arc(d.x,d.y,Math.max(3,e.width),0,2*Math.PI),a.fillStyle=e.color,a.fill()),"arrow"===b){let b=Math.atan2(d.y-c.y,d.x-c.x),f=Math.max(10,4*e.width);a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(d.x-f*Math.cos(b-Math.PI/6),d.y-f*Math.sin(b-Math.PI/6)),a.lineTo(d.x-f*Math.cos(b+Math.PI/6),d.y-f*Math.sin(b+Math.PI/6)),a.closePath(),a.fillStyle=e.color,a.fill()}}else"rectangle"===b?a.strokeRect(f,g,h,i):"circle"===b?(a.beginPath(),a.ellipse(f+h/2,g+i/2,Math.max(2,h/2),Math.max(2,i/2),0,0,2*Math.PI),a.stroke()):"triangle"===b&&(a.beginPath(),a.moveTo(f+h/2,g),a.lineTo(f+h,g+i),a.lineTo(f,g+i),a.closePath(),a.stroke());a.restore()},[]),cU=(0,c.useCallback)((a,b)=>{if("text"===b.type){let c=b.points[0];if(!c||!b.text)return;a.save(),a.fillStyle=b.color,a.globalAlpha=b.opacity??1;let d=b.textStyle?.bold?"700":"400",e=b.textStyle?.italic?"italic":"normal";a.font=`${e} ${d} ${b.fontSize||aN}px ${b.fontFamily||"ui-sans-serif, system-ui, sans-serif"}`,a.textBaseline="top",a.textAlign=b.textStyle?.align||"left",a.fillText(b.text,c.x,c.y),a.restore();return}if("shape"===b.type&&b.shapeType&&b.points.length>=2){if("connector"===b.shapeType){a.save(),a.globalAlpha=b.opacity??1,a.strokeStyle=b.color,a.lineWidth=b.width,a.lineJoin="round",a.lineCap="round",a.beginPath(),b.points.forEach((b,c)=>{0===c?a.moveTo(b.x,b.y):a.lineTo(b.x,b.y)}),a.stroke();let c=b.points[0],d=b.points[b.points.length-1];a.beginPath(),a.arc(c.x,c.y,Math.max(3,b.width),0,2*Math.PI),a.arc(d.x,d.y,Math.max(3,b.width),0,2*Math.PI),a.fillStyle=b.color,a.fill(),a.restore();return}cT(a,b.shapeType,b.points[0],b.points[b.points.length-1],b);return}if(!(b.points.length<2)){a.save(),a.globalAlpha=b.opacity??1,a.strokeStyle=b.color,a.lineCap="calligraphy"===b.type?"square":"round",a.lineJoin="round";for(let c=1;c<b.points.length;c+=1){let d=b.points[c-1],e=b.points[c],f="number"==typeof e.pressure?e.pressure:.5;a.lineWidth=Math.max(1,b.width*(.55+.9*f)),"pencil"===b.type?a.setLineDash([1,1.5]):a.setLineDash([]),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(e.x,e.y),a.stroke()}a.restore()}},[cT,aN]),cV=(0,c.useCallback)(a=>{if("text"===a.type){let b=a.points[0];if(!b)return null;let c=Math.max(80,(a.text?.length||0)*(.55*(a.fontSize||aN))),d=1.4*(a.fontSize||aN);return{x:b.x,y:b.y,width:c,height:d}}if(!a.points.length)return null;let b=a.points.map(a=>a.x),c=a.points.map(a=>a.y),d=Math.min(...b),e=Math.min(...c),f=Math.max(...b),g=Math.max(...c),h=Math.max(8,a.width);return{x:d-h,y:e-h,width:f-d+2*h,height:g-e+2*h}},[aN]),cW=(0,c.useCallback)((a,b)=>{let c=!1;for(let d=0,e=b.length-1;d<b.length;e=d++){let f=b[d].x,g=b[d].y,h=b[e].x,i=b[e].y;g>a.y!=i>a.y&&a.x<(h-f)*(a.y-g)/(i-g||1e-6)+f&&(c=!c)}return c},[]),cX=(0,c.useCallback)((a,b,c)=>{let d=c.map(a=>({x:a.x-18,y:a.y-18,width:a.width+36,height:a.height+36})),e=c=>{let d=c?{x:b.x,y:a.y}:{x:a.x,y:b.y};return[a,d,b]},f=[e(!0),e(!1),[a,{x:a.x,y:a.y-80},{x:b.x,y:a.y-80},b],[a,{x:a.x,y:a.y+80},{x:b.x,y:a.y+80},b],[a,{x:a.x-80,y:a.y},{x:a.x-80,y:b.y},b],[a,{x:a.x+80,y:a.y},{x:a.x+80,y:b.y},b]].map(a=>({path:a,ok:a.every((b,c)=>{let e;return 0===c||(e=a[c-1],d.every(a=>{let c,d,f,g;return c=Math.min(e.x,b.x),d=Math.max(e.x,b.x),f=Math.min(e.y,b.y),g=Math.max(e.y,b.y),!(d>=a.x)||!(c<=a.x+a.width)||!(g>=a.y)||!(f<=a.y+a.height)}))}),cost:a.reduce((b,c,d)=>0===d?0:b+Math.abs(c.x-a[d-1].x)+Math.abs(c.y-a[d-1].y),0)})).filter(a=>a.ok).sort((a,b)=>a.cost-b.cost);return(f[0]?.path||e(!0)).map(a=>({x:a.x,y:a.y}))},[]),cY=(0,c.useCallback)(a=>({top:{x:a.x+a.width/2,y:a.y},right:{x:a.x+a.width,y:a.y+a.height/2},bottom:{x:a.x+a.width/2,y:a.y+a.height},left:{x:a.x,y:a.y+a.height/2},center:{x:a.x+a.width/2,y:a.y+a.height/2}}),[]),cZ=(0,c.useCallback)((a,b)=>{let c=cY(b),d="center",e=c.center,f=1/0;return Object.keys(c).forEach(b=>{let g=c[b],h=g.x-a.x,i=g.y-a.y,j=Math.sqrt(h*h+i*i);j<f&&(f=j,d=b,e=g)}),{port:d,anchor:e,distance:f}},[cY]),c$=(0,c.useCallback)((a,b)=>{let c={anchor:a,distance:1/0};return(b.filter(a=>"connector"!==a.shapeType).forEach(b=>{let d=cV(b);if(!d)return;let e=cZ(a,d);e.distance<c.distance&&(c={strokeId:b.id,port:e.port,anchor:e.anchor,distance:e.distance})}),c.distance<=56&&c.strokeId&&c.port)?{point:c.anchor,sourceStrokeId:c.strokeId,sourcePort:c.port}:{point:a}},[cZ,cV]),c_=(0,c.useCallback)(a=>{let b=cM.filter(b=>a.has(b.id)).map(a=>cV(a)).filter(a=>!!a);if(!b.length)return null;let c=Math.min(...b.map(a=>a.x)),d=Math.min(...b.map(a=>a.y));return{x:c,y:d,width:Math.max(...b.map(a=>a.x+a.width))-c,height:Math.max(...b.map(a=>a.y+a.height))-d}},[cM,cV]),c0=(0,c.useCallback)((a,b)=>{0!==aW.size&&cf(c=>c.map(c=>aW.has(c.id)&&(c.pageId||at)===bW?{...c,points:c.points.map(c=>({...c,x:be?Math.round((c.x+a)/bi)*bi:c.x+a,y:be?Math.round((c.y+b)/bi)*bi:c.y+b}))}:c))},[bW,bi,cf,aW,be]),c1=(0,c.useCallback)(a=>{if(0===aW.size)return;let b=c_(aW);if(!b)return;let c=b.x+b.width/2,d=b.y+b.height/2;cf(b=>b.map(b=>aW.has(b.id)&&(b.pageId||at)===bW?{...b,points:b.points.map(b=>({...b,x:be?Math.round((c+(b.x-c)*a)/bi)*bi:c+(b.x-c)*a,y:be?Math.round((d+(b.y-d)*a)/bi)*bi:d+(b.y-d)*a}))}:b))},[bW,c_,bi,cf,aW,be]),c2=(0,c.useCallback)((a,b)=>{let c={at:Date.now(),action:a,details:b};bF(a=>[c,...a].slice(0,80)),bH(`${a}${b?`: ${b}`:""}`)},[]),c3=(0,c.useCallback)(a=>{cf(b=>b.map((b,c)=>!aW.has(b.id)||(b.pageId||at)!==bW||b.locked?b:a(b,c)))},[bW,cf,aW]),c4=(0,c.useCallback)(()=>{if(aW.size<2)return;let a=`group-${Date.now()}`;c3(b=>({...b,groupId:a,updatedAt:Date.now()})),c2("Grouped selection",a)},[c2,aW.size,c3]),c5=(0,c.useCallback)(()=>{0!==aW.size&&(c3(a=>({...a,groupId:void 0,updatedAt:Date.now()})),c2("Ungrouped selection"))},[c2,aW.size,c3]),c6=(0,c.useCallback)(a=>{c3(b=>({...b,locked:a,updatedAt:Date.now()})),c2(a?"Locked selection":"Unlocked selection")},[c2,c3]),c7=(0,c.useCallback)(()=>{0!==aW.size&&(cf(a=>{let b=a.filter(a=>aW.has(a.id)&&(a.pageId||at)===bW).map(a=>({...a,id:`${a.id}-dup-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,points:a.points.map(a=>({...a,x:a.x+24,y:a.y+24})),zIndex:(a.zIndex||0)+1,locked:!1,createdAt:Date.now(),updatedAt:Date.now()}));return[...a,...b]}),c2("Duplicated selection"))},[bW,c2,cf,aW]),c8=(0,c.useCallback)(a=>{cf(b=>{let c=Math.max(0,...b.map(a=>a.zIndex||0)),d=Math.min(0,...b.map(a=>a.zIndex||0));return b.map(b=>{if(!aW.has(b.id)||(b.pageId||at)!==bW)return b;let e=b.zIndex||0;return"front"===a?{...b,zIndex:c+1,updatedAt:Date.now()}:"forward"===a?{...b,zIndex:e+1,updatedAt:Date.now()}:{...b,zIndex:d-1,updatedAt:Date.now()}})}),c2("Reordered selection",a)},[bW,c2,cf,aW]),c9=(0,c.useCallback)(()=>{aW.size&&(cf(a=>{let b=Math.max(0,...a.map(a=>a.zIndex||0)),c=a.filter(a=>aW.has(a.id)).map((a,c)=>({...a,id:`${a.id}-exemplar-${Date.now()}-${c}`,layerId:"tutor-broadcast",zIndex:b+10+c,updatedAt:Date.now(),createdAt:Date.now()}));return[...a,...c]}),c2("Pushed exemplar to broadcast layer"))},[c2,cf,aW]),da=(0,c.useCallback)(()=>{cv({...cu,enabled:!0,x:Math.max(0,-aP.offsetX/Math.max(.1,aP.scale)),y:Math.max(0,-aP.offsetY/Math.max(.1,aP.scale)),width:420/Math.max(.6,aP.scale),height:260/Math.max(.6,aP.scale)}),c2("Broadcasted viewport")},[c2,cu,cv,aP.offsetX,aP.offsetY,aP.scale]),db=(0,c.useCallback)(()=>{let b=cM.map(a=>{if("text"===a.type){let b=a.points[0];return b&&a.text?`<text x="${b.x}" y="${b.y}" fill="${a.color}" font-size="${a.fontSize||20}">${a.text.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</text>`:""}let b=a.points.map((a,b)=>`${0===b?"M":"L"} ${a.x} ${a.y}`).join(" ");return`<path d="${b}" fill="none" stroke="${a.color}" stroke-width="${a.width}" stroke-linecap="round" stroke-linejoin="round" />`}).join("\n"),c=new Blob([`<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900" viewBox="0 0 1600 900">${b}</svg>`],{type:"image/svg+xml"}),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`whiteboard_${a}_${Date.now()}.svg`,e.click(),URL.revokeObjectURL(d),c2("Exported SVG")},[cM,c2,a]),dc=(0,c.useCallback)(a=>{let b=cM.find(a=>aW.has(a.id));if(!b)return;let c=new Set;cM.forEach(d=>{"color"===a&&d.color===b.color&&c.add(d.id),"type"===a&&d.type===b.type&&c.add(d.id),"layer"===a&&(d.layerId||"tutor-broadcast")===(b.layerId||"tutor-broadcast")&&c.add(d.id)}),aX(c)},[cM,aW]),dd=(0,c.useMemo)(()=>c_(aW),[c_,aW]),de=(0,c.useMemo)(()=>{if(1!==aW.size)return null;let a=Array.from(aW)[0],b=cM.find(b=>b.id===a);return!b||"connector"!==b.shapeType||b.points.length<2?null:b},[cM,aW]),df=(0,c.useCallback)((a,b)=>{let c=a.points[0],d=a.points[a.points.length-1];if(a.sourceStrokeId&&a.sourcePort){let d=b.find(b=>b.id===a.sourceStrokeId),e=d?cV(d):null;e&&(c=cY(e)[a.sourcePort])}if(a.targetStrokeId&&a.targetPort){let c=b.find(b=>b.id===a.targetStrokeId),e=c?cV(c):null;e&&(d=cY(e)[a.targetPort])}return{source:{x:c.x*aP.scale+aP.offsetX,y:c.y*aP.scale+aP.offsetY},target:{x:d.x*aP.scale+aP.offsetX,y:d.y*aP.scale+aP.offsetY}}},[cY,cV,aP.offsetX,aP.offsetY,aP.scale]),dg=(0,c.useCallback)((a,b)=>{if(!de)return null;let c=df(de,cM);return 10>=Math.hypot(a-c.source.x,b-c.source.y)?{strokeId:de.id,endpoint:"source"}:10>=Math.hypot(a-c.target.x,b-c.target.y)?{strokeId:de.id,endpoint:"target"}:null},[cM,de,df]);(0,c.useEffect)(()=>{ci(Array.from(aW),bW,"#0ea5e9")},[bW,aW,ci]),(0,c.useEffect)(()=>{cf(a=>{let b=a.filter(a=>(a.pageId||at)===bW),c=new Map(b.map(a=>[a.id,a])),d=b.filter(a=>"connector"!==a.shapeType).map(a=>cV(a)).filter(a=>!!a),e=!1,f=[];return a.forEach(a=>{if((a.pageId||at)!==bW||"connector"!==a.shapeType||!a.sourceStrokeId||!a.targetStrokeId||!a.sourcePort||!a.targetPort)return void f.push(a);let b=c.get(a.sourceStrokeId),g=c.get(a.targetStrokeId);if(!b||!g){e=!0;return}let h=cV(b),i=cV(g);if(!h||!i)return void f.push(a);let j=cX(cY(h)[a.sourcePort],cY(i)[a.targetPort],d);a.points.length===j.length&&a.points.every((a,b)=>{let c=j[b];return .5>Math.abs(a.x-c.x)&&.5>Math.abs(a.y-c.y)})?f.push(a):(e=!0,f.push({...a,points:j,updatedAt:Date.now()}))}),e?f:a})},[bW,cM,cY,cV,cf,cX]);let dh=(0,c.useCallback)((a,b)=>{if(!dd)return null;for(let c of[{id:"nw",x:dd.x,y:dd.y},{id:"ne",x:dd.x+dd.width,y:dd.y},{id:"sw",x:dd.x,y:dd.y+dd.height},{id:"se",x:dd.x+dd.width,y:dd.y+dd.height}]){let d={x:c.x*aP.scale+aP.offsetX,y:c.y*aP.scale+aP.offsetY},e=a-d.x,f=b-d.y;if(10>=Math.sqrt(e*e+f*f))return c.id}let c={x:(dd.x+dd.width/2)*aP.scale+aP.offsetX,y:(dd.y-36)*aP.scale+aP.offsetY},d=a-c.x,e=b-c.y;return 11>=Math.sqrt(d*d+e*e)?"rotate":null},[dd,aP.offsetX,aP.offsetY,aP.scale]),di=(0,c.useCallback)(()=>{let a=ak.current,b=a?.getContext("2d");if(!a||!b)return;if(b.fillStyle="#ffffff",b.fillRect(0,0,a.width,a.height),bg){b.save(),b.strokeStyle="rgba(148, 163, 184, 0.18)",b.lineWidth=1;for(let c=0;c<a.width;c+=bi)b.beginPath(),b.moveTo(c,0),b.lineTo(c,a.height),b.stroke();for(let c=0;c<a.height;c+=bi)b.beginPath(),b.moveTo(0,c),b.lineTo(a.width,c),b.stroke();b.restore()}b.save(),b.translate(aP.offsetX,aP.offsetY),b.scale(aP.scale,aP.scale);let c=new Set(ck.filter(a=>a.visible).map(a=>a.id)),d={left:-aP.offsetX/aP.scale,top:-aP.offsetY/aP.scale,right:(a.width-aP.offsetX)/aP.scale,bottom:(a.height-aP.offsetY)/aP.scale},e=a=>!a||a.x<=d.right&&a.x+a.width>=d.left&&a.y<=d.bottom&&a.y+a.height>=d.top;if([...cM].sort((a,b)=>(a.zIndex||0)-(b.zIndex||0)).forEach(a=>{let d=a.layerId||"tutor-broadcast",f=cV(a);e(f)&&c.has(d)&&(cU(b,a),a.locked&&f&&(b.save(),b.strokeStyle="rgba(220, 38, 38, 0.7)",b.setLineDash([4,4]),b.lineWidth=1,b.strokeRect(f.x,f.y,f.width,f.height),b.restore()),aW.has(a.id)&&f&&(b.save(),b.strokeStyle="#2563eb",b.setLineDash([6,4]),b.lineWidth=1.5/Math.max(.4,aP.scale),b.strokeRect(f.x,f.y,f.width,f.height),b.restore()))}),b3.forEach(a=>{a.pageId&&a.pageId!==bW||a.strokeIds.forEach(c=>{let d=cM.find(a=>a.id===c);if(!d)return;let f=cV(d);f&&e(f)&&(b.save(),b.strokeStyle=a.color||"#f59e0b",b.setLineDash([4,4]),b.lineWidth=1.25/Math.max(.4,aP.scale),b.strokeRect(f.x,f.y,f.width,f.height),b.restore())})}),aB&&aD.length>1&&cS.has(am)&&cU(b,{id:"preview",points:aD,color:"eraser"===am?"#ffffff":ao,width:"eraser"===am?as.eraser.width:az,opacity:as[am].opacity,type:as[am].strokeType,userId:"preview"}),aF&&aH&&cR.has(am)){let a=as[am];cT(b,am,aF,aH,{color:ao,width:Math.max(1,az),opacity:a.opacity})}if(aJ){b.save(),b.globalAlpha=.9;let a=b.createRadialGradient(aJ.x,aJ.y,1,aJ.x,aJ.y,28);a.addColorStop(0,"rgba(239,68,68,0.95)"),a.addColorStop(1,"rgba(239,68,68,0)"),b.fillStyle=a,b.beginPath(),b.arc(aJ.x,aJ.y,28,0,2*Math.PI),b.fill(),b.restore()}if(b.restore(),aU){b.save(),b.strokeStyle="#2563eb",b.fillStyle="rgba(37, 99, 235, 0.08)",b.setLineDash([6,3]);let a=Math.min(aU.x,aU.x+aU.width),c=Math.min(aU.y,aU.y+aU.height),d=Math.abs(aU.width),e=Math.abs(aU.height);b.strokeRect(a,c,d,e),b.fillRect(a,c,d,e),b.restore()}if(a0&&a0.length>1&&(b.save(),b.strokeStyle="#2563eb",b.fillStyle="rgba(37, 99, 235, 0.08)",b.setLineDash([6,3]),b.beginPath(),a0.forEach((a,c)=>{let d={x:a.x*aP.scale+aP.offsetX,y:a.y*aP.scale+aP.offsetY};0===c?b.moveTo(d.x,d.y):b.lineTo(d.x,d.y)}),b.closePath(),b.stroke(),b.fill(),b.restore()),dd){let a=[{x:dd.x,y:dd.y},{x:dd.x+dd.width,y:dd.y},{x:dd.x,y:dd.y+dd.height},{x:dd.x+dd.width,y:dd.y+dd.height}];b.save(),b.fillStyle="#2563eb",a.forEach(a=>{let c=a.x*aP.scale+aP.offsetX,d=a.y*aP.scale+aP.offsetY;b.beginPath(),b.arc(c,d,5,0,2*Math.PI),b.fill()});let c=(dd.x+dd.width/2)*aP.scale+aP.offsetX,d=dd.y*aP.scale+aP.offsetY,e=(dd.y-36)*aP.scale+aP.offsetY;b.strokeStyle="#2563eb",b.beginPath(),b.moveTo(c,d),b.lineTo(c,e+8),b.stroke(),b.beginPath(),b.arc(c,e,6,0,2*Math.PI),b.fillStyle="#0ea5e9",b.fill(),b.restore()}if(de){let a=df(de,cM);b.save(),b.fillStyle="#0ea5e9",b.strokeStyle="#0369a1",b.lineWidth=2,b.beginPath(),b.arc(a.source.x,a.source.y,7,0,2*Math.PI),b.fill(),b.stroke(),b.fillStyle="#22c55e",b.strokeStyle="#15803d",b.beginPath(),b.arc(a.target.x,a.target.y,7,0,2*Math.PI),b.fill(),b.stroke(),b.restore()}},[bW,cM,de,az,ao,aD,cT,cU,cS,df,cV,bi,bg,aB,a0,aJ,ck,b3,dd,aW,aU,aH,aF,cR,am,aP.offsetX,aP.offsetY,aP.scale]);(0,c.useEffect)(()=>{let a=ak.current;if(!a)return;let b=()=>{let b=a.parentElement;b&&(a.width=b.clientWidth,a.height=b.clientHeight),di()};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[di]),(0,c.useEffect)(()=>{di()},[di]);let dj=a=>{let b=ak.current;if(!b)return{x:0,y:0};let c=b.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top;return{x:(d-aP.offsetX)/aP.scale,y:(e-aP.offsetY)/aP.scale,pressure:"mouse"===a.pointerType?.5:a.pressure||.5}},dk=(0,c.useCallback)(a=>({x:a.x*aP.scale+aP.offsetX,y:a.y*aP.scale+aP.offsetY}),[aP.offsetX,aP.offsetY,aP.scale]),dl=a=>{if(a.currentTarget.releasePointerCapture(a.pointerId),aR){aS(!1),aT.current=null;return}if(ba)return void bb(null);if(aU){let a=Math.min(aU.x,aU.x+aU.width),b=Math.min(aU.y,aU.y+aU.height),c=Math.abs(aU.width),d=Math.abs(aU.height),e=new Set;cM.forEach(f=>{let g=cV(f);if(!g)return;let h=dk({x:g.x,y:g.y}),i=dk({x:g.x+g.width,y:g.y+g.height}),j=h.x<a+c&&i.x>a&&h.y<b+d&&i.y>b,k=h.x>=a&&i.x<=a+c&&h.y>=b&&i.y<=b+d;("intersect"===a$&&j||"contain"===a$&&k)&&e.add(f.id)}),aX(e),aV(null);return}if(a0&&a0.length>2){let a=new Set;cM.forEach(b=>{b.points.some(a=>cW({x:a.x,y:a.y},a0))&&a.add(b.id)}),aX(a),a1(null);return}if(a7){a8(!1),a9.current=null,bd.current.clear(),c2("Rotated selection");return}if(a4){a5(null),a6.current=null,bd.current.clear(),c2("Scaled selection");return}if(a2){a3(!1),bc.current=null,bd.current.clear(),c2("Moved selection");return}if("laser"===am)return void aK(null);if(!aB)return;if(cR.has(am)&&aF&&aH){let a=as[am],b="connector"===am?c$(aF,cM):{point:aF},c="connector"===am?c$(aH,cM):{point:aH},d=b.point,e=c.point,f="connector"===am?cX(d,e,cM.filter(a=>"connector"!==a.shapeType).map(a=>cV(a)).filter(a=>!!a)):[d,e];cj({id:Date.now().toString(),points:f,color:ao,width:Math.max(1,az),opacity:a.opacity,shapeType:am,type:"shape",userId:"tutor",pageId:bW,zIndex:Math.max(0,...cM.map(a=>a.zIndex||0))+1,createdAt:Date.now(),updatedAt:Date.now(),sourceStrokeId:"connector"===am?b.sourceStrokeId:void 0,targetStrokeId:"connector"===am?c.sourceStrokeId:void 0,sourcePort:"connector"===am?b.sourcePort:void 0,targetPort:"connector"===am?c.sourcePort:void 0}),"connector"===am&&c2("Added orthogonal connector"),aG(null),aI(null),aC(!1);return}if(0===aD.length)return void aC(!1);let b=as[am];cj({id:Date.now().toString(),points:aD,color:"eraser"===am?"#ffffff":ao,width:"eraser"===am?b.width:az,opacity:b.opacity,type:b.strokeType,userId:"tutor",pageId:bW,zIndex:Math.max(0,...cM.map(a=>a.zIndex||0))+1,createdAt:Date.now(),updatedAt:Date.now()}),aC(!1),aE([])},dm=(0,c.useCallback)(a=>{a.preventDefault();let b=a.deltaY<0?1.08:.92,c=Math.min(3,Math.max(.35,aP.scale*b)),d=ak.current;if(!d)return;let e=d.getBoundingClientRect(),f=a.clientX-e.left,g=a.clientY-e.top,h=(f-aP.offsetX)/aP.scale,i=(g-aP.offsetY)/aP.scale;aQ({scale:c,offsetX:f-h*c,offsetY:g-i*c})},[aP.offsetX,aP.offsetY,aP.scale]);(0,c.useEffect)(()=>{cA()},[cA]);let dn=()=>{let b=ak.current;if(!b)return;let c=b.toDataURL("image/png");cC({format:"png",fileName:`whiteboard_${a}_${Date.now()}.png`,dataUrl:c,studentId:bM||void 0})},dp=(0,c.useCallback)(()=>{if(!dd||!ak.current)return;let b=ak.current,c=document.createElement("canvas"),d=Math.round(dd.x*aP.scale+aP.offsetX),e=Math.round(dd.y*aP.scale+aP.offsetY),f=Math.max(1,Math.round(dd.width*aP.scale)),g=Math.max(1,Math.round(dd.height*aP.scale));c.width=f,c.height=g;let h=c.getContext("2d");h&&(h.drawImage(b,d,e,f,g,0,0,f,g),cC({format:"png",fileName:`whiteboard_selection_${a}_${Date.now()}.png`,dataUrl:c.toDataURL("image/png"),studentId:bM||void 0}))},[cC,bM,a,dd,aP.offsetX,aP.offsetY,aP.scale]),dq=(0,c.useCallback)(()=>{bV(a=>{let b=a.length+1,c=`page-${b}`,d=[...a,{id:c,label:`Page ${b}`}];return bX(c),d})},[]),dr=(0,c.useCallback)(a=>{let b=bU.findIndex(a=>a.id===bW);!(b<0)&&("prev"===a&&b>0&&bX(bU[b-1].id),"next"===a&&b<bU.length-1&&bX(bU[b+1].id))},[bW,bU]);(0,c.useEffect)(()=>{let a=as[am];a&&("eraser"===am||"highlighter"===am||"marker"===am||"calligraphy"===am||"pencil"===am||"pen"===am)&&aA(a.width)},[am]),(0,c.useEffect)(()=>()=>{bo?.src&&URL.revokeObjectURL(bo.src)},[bo]);let ds=(0,c.useCallback)(()=>{if(!aL||!aL.value.trim())return void aM(null);let a=aL.value.trim(),b="latex"===bq?`$$${a}$$`:"code"===bq?`\`\`\`
${a}
\`\`\``:"table"===bq?`| Column A | Column B |
|---|---|
| ${a} |  |`:a;cj({id:Date.now().toString(),points:[{x:aL.x,y:aL.y}],color:ao,width:1,opacity:1,type:"text",text:b,fontSize:aN,fontFamily:"sticky"===bq?"Caveat, ui-sans-serif, system-ui, sans-serif":"Inter, Segoe UI, system-ui, sans-serif",textStyle:bs,userId:"tutor",pageId:bW,zIndex:Math.max(0,...cM.map(a=>a.zIndex||0))+1,createdAt:Date.now(),updatedAt:Date.now()}),aM(null),c2("Added text",bq)},[bW,cM,cj,ao,aN,c2,aL,bq,bs]),dt=(0,c.useCallback)(()=>{let a=bk.trim()||`Checkpoint ${new Date().toLocaleTimeString()}`;bn(b=>[{id:`${Date.now()}`,name:a,createdAt:Date.now()},...b].slice(0,30)),cA(),c2("Saved checkpoint",a),bl("")},[bk,c2,cA]);(0,c.useEffect)(()=>{let a=a=>{if(a.target?.tagName==="INPUT"||a.target?.tagName==="TEXTAREA")return;let b=a.shiftKey?20:6,c=a.key.toLowerCase();"v"===c&&an("select"),"p"===c&&an("pen"),"e"===c&&an("eraser"),"t"===c&&an("text"),"h"===c&&an("hand"),aW.size>0&&("ArrowUp"===a.key&&(a.preventDefault(),c0(0,-b)),"ArrowDown"===a.key&&(a.preventDefault(),c0(0,b)),"ArrowLeft"===a.key&&(a.preventDefault(),c0(-b,0)),"ArrowRight"===a.key&&(a.preventDefault(),c0(b,0)),"+"===a.key&&(a.preventDefault(),c1(1.08)),"-"===a.key&&(a.preventDefault(),c1(.92))),(a.metaKey||a.ctrlKey)&&"z"===c&&(a.preventDefault(),cg(bW))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[bW,c0,c1,aW.size,cg]),(0,c.useEffect)(()=>{let a=0,b=performance.now(),c=0,d=e=>{c+=1,e-b>=1e3&&(bB(Math.round(1e3*c/(e-b))),c=0,b=e),a=requestAnimationFrame(d)};return a=requestAnimationFrame(d),()=>cancelAnimationFrame(a)},[]),(0,c.useEffect)(()=>{if(!bG)return;let a=window.setTimeout(()=>bH(""),1200);return()=>window.clearTimeout(a)},[bG]);let du=(0,c.useCallback)(a=>{let b=["#2563eb","#7c3aed","#059669","#dc2626","#ea580c","#0891b2","#ca8a04"],c=0;for(let b=0;b<a.length;b+=1)c=31*c+a.charCodeAt(b)|0;return b[Math.abs(c)%b.length]},[]);return(0,b.jsxs)("div",{className:"flex flex-col h-full bg-white rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(z.Palette,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"font-medium",children:"Whiteboard"}),b$&&(0,b.jsxs)(e.Badge,{variant:"destructive",className:"animate-pulse",children:[(0,b.jsx)(p.Play,{className:"w-3 h-3 mr-1"}),"Broadcasting"]}),b0&&(0,b.jsxs)(e.Badge,{variant:"secondary",children:[(0,b.jsx)(s.Eye,{className:"w-3 h-3 mr-1"}),"Viewing Student"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:b8?"destructive":"outline",size:"sm",disabled:!b_,title:b_?b8?"Unlock so students can draw again":"Lock student boards so only you can draw":"Connect to the class to lock student boards",onClick:()=>ca(!b8),children:b8?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Lock,{className:"w-4 h-4 mr-2"}),"Unlock Student Layers"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.Unlock,{className:"w-4 h-4 mr-2"}),"Lock Student Layers"]})}),b$?(0,b.jsxs)(f.Button,{variant:"destructive",size:"sm",onClick:b5,title:"Stop sending your board to students",children:[(0,b.jsx)(q.Square,{className:"w-4 h-4 mr-2"}),"Stop Broadcast"]}):(0,b.jsxs)(f.Button,{variant:"default",size:"sm",disabled:!b_,title:b_?"Send your whiteboard to all students in real time":"Connect to the class to broadcast your board",onClick:b4,children:[(0,b.jsx)(p.Play,{className:"w-4 h-4 mr-2"}),"Broadcast"]})]})]}),(0,b.jsx)("div",{className:"space-y-2 border-b bg-slate-50/95 px-4 py-2 backdrop-blur",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[{id:"pencil",icon:l.Pencil,label:"Pencil"},{id:"pen",icon:R.PenLine,label:"Pen"},{id:"marker",icon:T.Dot,label:"Marker"},{id:"highlighter",icon:S.Highlighter,label:"Highlighter"},{id:"calligraphy",icon:M.MinusCircle,label:"Calligraphy"},{id:"eraser",icon:m.Eraser,label:"Eraser"}].map(({id:a,icon:c,label:d})=>(0,b.jsx)("button",{onClick:()=>an(a),className:(0,aj.cn)("rounded-md px-2 py-1.5 transition-colors",am===a?"bg-blue-100 text-blue-700":"text-slate-600 hover:bg-slate-100"),title:d,children:(0,b.jsx)(c,{className:"h-4 w-4"})},a))}),(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[{id:"line",icon:y.Minus,label:"Line"},{id:"arrow",icon:N.ArrowRight,label:"Arrow"},{id:"rectangle",icon:O.RectangleHorizontal,label:"Rectangle"},{id:"circle",icon:P.Circle,label:"Circle"},{id:"triangle",icon:Q.Triangle,label:"Triangle"},{id:"connector",icon:ab.Link2,label:"Connector"},{id:"text",icon:L.Type,label:"Text"},{id:"laser",icon:K.Ban,label:"Laser Pointer"},{id:"select",icon:A.MousePointer2,label:"Select"},{id:"hand",icon:U.Move,label:"Pan"}].map(({id:a,icon:c,label:d})=>(0,b.jsx)("button",{onClick:()=>an(a),className:(0,aj.cn)("rounded-md px-2 py-1.5 transition-colors",am===a?"bg-indigo-100 text-indigo-700":"text-slate-600 hover:bg-slate-100"),title:d,children:(0,b.jsx)(c,{className:"h-4 w-4"})},a))}),(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[ar.map(a=>(0,b.jsx)("button",{onClick:()=>au(a),className:(0,aj.cn)("h-6 w-6 rounded-full border transition-all",ao===a?"scale-110 border-slate-600":"border-transparent"),style:{backgroundColor:a},title:a},a)),(0,b.jsx)("input",{type:"color",value:ax,onChange:a=>{ay(a.target.value),au(a.target.value)},className:"h-6 w-8 cursor-pointer rounded border bg-transparent p-0",title:"Custom color"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Stroke"}),(0,b.jsx)(i.Slider,{value:[az],onValueChange:([a])=>aA(a),min:1,max:32,step:1,className:"w-24"}),(0,b.jsx)("span",{className:"w-7 text-xs font-medium text-slate-600",children:az})]}),"text"===am&&(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Font"}),(0,b.jsx)(i.Slider,{value:[aN],onValueChange:([a])=>aO(a),min:14,max:56,step:1,className:"w-24"}),(0,b.jsx)("span",{className:"w-7 text-xs font-medium text-slate-600",children:aN})]}),"text"===am&&(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:["plain","latex","code","table","sticky"].map(a=>(0,b.jsx)(f.Button,{variant:bq===a?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs capitalize",title:`Text preset: ${a}`,"aria-label":`Text preset: ${a}`,onClick:()=>br(a),children:a},a))}),"text"===am&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)(f.Button,{size:"sm",variant:bs.bold?"default":"ghost",className:"h-7 px-2 text-xs",title:"Bold text",onClick:()=>bt(a=>({...a,bold:!a.bold})),children:"B"}),(0,b.jsx)(f.Button,{size:"sm",variant:bs.italic?"default":"ghost",className:"h-7 px-2 text-xs italic",title:"Italic text",onClick:()=>bt(a=>({...a,italic:!a.italic})),children:"I"}),(0,b.jsx)(f.Button,{size:"sm",variant:"left"===bs.align?"default":"ghost",className:"h-7 px-2 text-xs",title:"Align left",onClick:()=>bt(a=>({...a,align:"left"})),children:(0,b.jsx)(ac,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(f.Button,{size:"sm",variant:"center"===bs.align?"default":"ghost",className:"h-7 px-2 text-xs",title:"Align center",onClick:()=>bt(a=>({...a,align:"center"})),children:(0,b.jsx)(ad,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(f.Button,{size:"sm",variant:"right"===bs.align?"default":"ghost",className:"h-7 px-2 text-xs",title:"Align right",onClick:()=>bt(a=>({...a,align:"right"})),children:(0,b.jsx)(ae,{className:"h-3.5 w-3.5"})})]}),"select"===am&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)(f.Button,{variant:"rect"===aY?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Selection mode: rectangle",onClick:()=>aZ("rect"),children:"Rect"}),(0,b.jsx)(f.Button,{variant:"lasso"===aY?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Selection mode: lasso",onClick:()=>aZ("lasso"),children:"Lasso"}),(0,b.jsx)(f.Button,{variant:"intersect"===a$?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select items that intersect selection area",onClick:()=>a_("intersect"),children:"Intersect"}),(0,b.jsx)(f.Button,{variant:"contain"===a$?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select only items fully contained in selection area",onClick:()=>a_("contain"),children:"Contain"})]}),aW.size>0&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection up",onClick:()=>c0(0,-10),children:"Up"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection left",onClick:()=>c0(-10,0),children:"Left"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection right",onClick:()=>c0(10,0),children:"Right"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection down",onClick:()=>c0(0,10),children:"Down"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Scale selected items down",onClick:()=>c1(.9),children:"Scale -"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Scale selected items up",onClick:()=>c1(1.1),children:"Scale +"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all with same color",onClick:()=>dc("color"),children:"Same Color"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all with same stroke type",onClick:()=>dc("type"),children:"Same Type"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all in same layer",onClick:()=>dc("layer"),children:"Same Layer"}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Duplicate selection",onClick:c7,children:[(0,b.jsx)(X.Copy,{className:"mr-1 h-3.5 w-3.5"})," Dup"]}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Group selected objects",onClick:c4,children:[(0,b.jsx)(_,{className:"mr-1 h-3.5 w-3.5"})," Group"]}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Ungroup selected objects",onClick:c5,children:[(0,b.jsx)(aa,{className:"mr-1 h-3.5 w-3.5"})," Ungroup"]}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Bring selected to front",onClick:()=>c8("front"),children:[(0,b.jsx)(Z,{className:"mr-1 h-3.5 w-3.5"})," Front"]}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Bring selected forward",onClick:()=>c8("forward"),children:[(0,b.jsx)(N.ArrowRight,{className:"mr-1 h-3.5 w-3.5"})," Forward"]}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Send selected to back",onClick:()=>c8("back"),children:[(0,b.jsx)($,{className:"mr-1 h-3.5 w-3.5"})," Back"]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Lock selected objects",onClick:()=>c6(!0),children:"Lock"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Unlock selected objects",onClick:()=>c6(!1),children:"Unlock"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Push selection as class exemplar",onClick:c9,children:"Exemplar"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)("input",{value:bC,onChange:a=>bD(a.target.value),placeholder:"Branch name",className:"h-7 w-28 rounded border px-2 text-xs"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>{bC.trim()&&(cD(bC),bD(""))},title:"Create board branch",children:"Branch"}),cz.length>0&&(0,b.jsxs)("select",{className:"h-7 rounded border px-2 text-xs",onChange:a=>a.target.value&&cE(a.target.value),defaultValue:"","aria-label":"Switch board branch",children:[(0,b.jsx)("option",{value:"",disabled:!0,children:"Switch branch"}),cz.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-1 rounded-md border bg-white px-1 py-1 shadow-sm",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>dr("prev"),disabled:cN<=0,children:(0,b.jsx)(E.ChevronLeft,{className:"w-4 h-4"})}),(0,b.jsx)("span",{className:"min-w-[72px] text-center text-xs font-medium",children:bU.find(a=>a.id===bW)?.label||"Page"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>dr("next"),disabled:cN>=bU.length-1,children:(0,b.jsx)(F.ChevronRight,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:dq,children:(0,b.jsx)(D.Plus,{className:"w-4 h-4"})})]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>cg(bW),children:[(0,b.jsx)(n.Undo,{className:"mr-1 h-4 w-4"})," Undo"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>ce(bW),children:[(0,b.jsx)(o.Trash2,{className:"mr-1 h-4 w-4"})," Clear"]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>bT(a=>!a),children:bS?"Standard":"High Contrast"}),(0,b.jsx)(f.Button,{variant:be?"default":"outline",size:"sm",title:"Toggle snap-to-grid",onClick:()=>bf(a=>!a),children:"Snap"}),(0,b.jsx)(f.Button,{variant:bg?"default":"outline",size:"sm",title:"Show or hide grid",onClick:()=>bh(a=>!a),children:"Grid"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Grid"}),(0,b.jsx)(i.Slider,{value:[bi],onValueChange:([a])=>bj(a),min:8,max:64,step:2,className:"w-20"}),(0,b.jsx)("span",{className:"w-7 text-xs font-medium text-slate-600",children:bi})]}),(0,b.jsxs)("label",{className:"inline-flex",children:[(0,b.jsx)("input",{type:"file",accept:"image/*,application/pdf",className:"hidden",onChange:a=>{let b=a.target.files?.[0];if(!b)return;let c=URL.createObjectURL(b);bp({kind:b.type.includes("pdf")?"pdf":"image",src:c,name:b.name}),bv(1),c2("Imported asset",b.name),a.currentTarget.value=""}}),(0,b.jsxs)("span",{className:"inline-flex h-9 cursor-pointer items-center rounded-md border px-3 text-sm",children:[(0,b.jsx)(V.FileUp,{className:"mr-1 h-4 w-4"})," Import"]})]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",title:"Export full whiteboard page",onClick:dn,children:[(0,b.jsx)(G.Download,{className:"mr-1 h-4 w-4"})," Export"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",title:"Export as SVG vectors",onClick:db,children:[(0,b.jsx)(G.Download,{className:"mr-1 h-4 w-4"})," SVG"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",title:"Export current selection",onClick:dp,disabled:!dd,children:[(0,b.jsx)(G.Download,{className:"mr-1 h-4 w-4"})," Export Sel"]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",title:"Broadcast current viewport focus to class",onClick:da,children:"Broadcast View"}),(0,b.jsx)(f.Button,{variant:bw?"default":"outline",size:"sm",title:"Toggle collaboration minimap",onClick:()=>bx(a=>!a),children:"Minimap"}),(0,b.jsxs)(f.Button,{variant:by?"default":"outline",size:"sm",title:"Toggle performance HUD",onClick:()=>bz(a=>!a),children:[(0,b.jsx)(af,{className:"mr-1 h-4 w-4"})," Perf"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("input",{value:bk,onChange:a=>bl(a.target.value),placeholder:"Checkpoint",className:"h-7 w-28 rounded border px-2 text-xs"}),(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",className:"h-7 text-xs",title:"Save named checkpoint",onClick:dt,children:[(0,b.jsx)(W.default,{className:"mr-1 h-3.5 w-3.5"})," Save"]})]}),(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:[Math.round(100*aP.scale),"%"]}),aW.size>0&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:"text-xs",children:[aW.size," selected"]}),(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:["CP ",bm.length]})]})}),(0,b.jsx)("div",{className:"flex-1 flex overflow-hidden",children:(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsxs)(h.Tabs,{value:bI,onValueChange:bJ,className:"h-full",children:[(0,b.jsxs)(h.TabsList,{className:"absolute top-2 left-2 z-10",children:[(0,b.jsx)(h.TabsTrigger,{value:"my-board",children:"My Board"}),(0,b.jsxs)(h.TabsTrigger,{value:"student-boards",children:[(0,b.jsx)(r.Users,{className:"w-4 h-4 mr-2"}),"Students (",b1.length,")"]}),(0,b.jsx)(h.TabsTrigger,{value:"pdf-board",children:"PDF Tutoring"})]}),(0,b.jsx)(h.TabsContent,{value:"my-board",className:"h-full m-0",children:(0,b.jsxs)("div",{className:"h-full p-4",children:[(0,b.jsxs)("div",{ref:al,className:(0,aj.cn)("relative w-full h-full",bS&&"contrast-125 saturate-150"),children:[(0,b.jsx)("div",{className:"absolute left-2 top-14 z-20",children:(0,b.jsx)(ap,{initialCourseId:g,classSubject:Y,onMakeVisibleToStudents:ah})}),(0,b.jsx)("canvas",{ref:ak,onPointerDown:a=>{a.currentTarget.setPointerCapture(a.pointerId);let b=dj(a),c=dk(b);if("hand"===am){aS(!0),aT.current={x:a.clientX,y:a.clientY,offsetX:aP.offsetX,offsetY:aP.offsetY};return}if("select"===am){let d=dg(c.x,c.y);if(d)return void bb(d);if(a.altKey){let a=[...cM].reverse().find(a=>{let c=cV(a);return!!c&&b.x>=c.x&&b.x<=c.x+c.width&&b.y>=c.y&&b.y<=c.y+c.height});a&&aX(b=>{let c=new Set(b);return c.has(a.id)?c.delete(a.id):c.add(a.id),c});return}let e=dh(c.x,c.y);if(e&&dd){let a=dd.x+dd.width/2,c=dd.y+dd.height/2;if(bd.current=new Map(cM.filter(a=>aW.has(a.id)).map(a=>[a.id,a.points.map(a=>({...a}))])),"rotate"===e)a9.current={centerX:a,centerY:c,startAngle:Math.atan2(b.y-c,b.x-a)},a8(!0);else{let d=Math.max(1,Math.hypot(b.x-a,b.y-c));a6.current={centerX:a,centerY:c,startDist:d},a5(e)}return}if(cM.some(a=>{if(!aW.has(a.id))return!1;let c=cV(a);return!!c&&b.x>=c.x&&b.x<=c.x+c.width&&b.y>=c.y&&b.y<=c.y+c.height})){let a=new Map;cM.forEach(b=>{aW.has(b.id)&&a.set(b.id,b.points.map(a=>({...a})))}),bd.current=a,bc.current=b,a3(!0)}else"lasso"===aY?(a1([b]),aV(null)):(aV({x:c.x,y:c.y,width:0,height:0}),a1(null));return}if("text"===am)return void aM({x:b.x,y:b.y,value:""});if("laser"===am){aK(b),ch(b.x,b.y,"laser");return}if(cR.has(am)){aC(!0),aG(b),aI(b);return}cS.has(am)&&(aC(!0),aE([b]))},onPointerMove:a=>{if(aR&&aT.current){let b=a.clientX-aT.current.x,c=a.clientY-aT.current.y;aQ(a=>({...a,offsetX:aT.current.offsetX+b,offsetY:aT.current.offsetY+c}));return}let b=dj(a);if(ch(b.x,b.y,"laser"===am?"laser":"cursor"),ba)return void cf(a=>{let c=a.filter(a=>(a.pageId||at)===bW),d=c.filter(a=>"connector"!==a.shapeType).map(a=>cV(a)).filter(a=>!!a),e=c.filter(a=>a.id!==ba.strokeId);return a.map(a=>{if(a.id!==ba.strokeId||"connector"!==a.shapeType)return a;let c=c$(b,e),f="source"===ba.endpoint?c.point:a.points[0],g="target"===ba.endpoint?c.point:a.points[a.points.length-1];return{...a,points:cX(f,g,d),sourceStrokeId:"source"===ba.endpoint?c.sourceStrokeId:a.sourceStrokeId,sourcePort:"source"===ba.endpoint?c.sourcePort:a.sourcePort,targetStrokeId:"target"===ba.endpoint?c.sourceStrokeId:a.targetStrokeId,targetPort:"target"===ba.endpoint?c.sourcePort:a.targetPort,updatedAt:Date.now()}})});if(a7&&a9.current){let{centerX:a,centerY:c,startAngle:d}=a9.current,e=Math.atan2(b.y-c,b.x-a)-d;cf(b=>b.map(b=>{if(!aW.has(b.id)||(b.pageId||at)!==bW)return b;let d=bd.current.get(b.id);return d?{...b,rotation:((b.rotation||0)+180*e/Math.PI)%360,updatedAt:Date.now(),points:d.map(b=>{let d=b.x-a,f=b.y-c;return{...b,x:a+d*Math.cos(e)-f*Math.sin(e),y:c+d*Math.sin(e)+f*Math.cos(e)}})}:b}));return}if(a4&&a6.current){let{centerX:a,centerY:c,startDist:d}=a6.current,e=Math.max(1,Math.hypot(b.x-a,b.y-c))/d;cf(b=>b.map(b=>{if(!aW.has(b.id)||(b.pageId||at)!==bW)return b;let d=bd.current.get(b.id);return d?{...b,points:d.map(b=>({...b,x:be?Math.round((a+(b.x-a)*e)/bi)*bi:a+(b.x-a)*e,y:be?Math.round((c+(b.y-c)*e)/bi)*bi:c+(b.y-c)*e}))}:b}));return}if(a2&&bc.current){let a=b.x-bc.current.x,c=b.y-bc.current.y;cf(b=>b.map(b=>{if(!aW.has(b.id)||(b.pageId||at)!==bW)return b;let d=bd.current.get(b.id);return d?{...b,points:d.map(b=>({...b,x:be?Math.round((b.x+a)/bi)*bi:b.x+a,y:be?Math.round((b.y+c)/bi)*bi:b.y+c}))}:b}));return}if(aU){let a=dk(b);aV(b=>b?{...b,width:a.x-b.x,height:a.y-b.y}:b);return}if(a0)return void a1(a=>a?[...a,b]:a);if("laser"===am)return void aK(b);if(aB){if(cR.has(am))return void aI(b);aE(a=>{let c=a[a.length-1];if(c){let d=b.x-c.x,e=b.y-c.y;if(d*d+e*e<.7)return a}return[...a,b]})}},onPointerUp:dl,onPointerLeave:dl,onWheel:dm,className:(0,aj.cn)("w-full h-full border rounded-lg bg-white",(cS.has(am)||cR.has(am)||"text"===am)&&"cursor-crosshair","laser"===am&&"cursor-none","hand"===am&&"cursor-grab","select"===am&&"cursor-default"),"aria-label":"Tutor whiteboard canvas"}),bo?.kind==="image"&&(0,b.jsx)("img",{src:bo.src,alt:bo.name,className:"pointer-events-none absolute inset-0 h-full w-full rounded-lg object-contain opacity-30"}),bo?.kind==="pdf"&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("iframe",{src:`${bo.src}#page=${bu}`,title:bo.name,className:"pointer-events-none absolute inset-0 h-full w-full rounded-lg opacity-25"}),(0,b.jsxs)("div",{className:"absolute right-3 top-16 z-30 flex items-center gap-1 rounded-md bg-white/90 p-1",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"ghost",className:"h-7 px-2",onClick:()=>bv(a=>Math.max(1,a-1)),children:"Prev"}),(0,b.jsxs)("span",{className:"text-xs font-medium",children:["PDF p.",bu]}),(0,b.jsx)(f.Button,{size:"sm",variant:"ghost",className:"h-7 px-2",onClick:()=>bv(a=>a+1),children:"Next"})]})]}),aL&&(0,b.jsx)("div",{className:"absolute z-30",style:{left:aL.x,top:aL.y},children:(0,b.jsxs)("div",{className:"w-80 rounded-md border border-slate-300 bg-white/95 p-2 shadow-lg",children:[(0,b.jsx)("textarea",{autoFocus:!0,value:aL.value,rows:4,onChange:a=>aM(b=>b?{...b,value:a.target.value}:b),onKeyDown:a=>{(a.metaKey||a.ctrlKey)&&"Enter"===a.key&&(a.preventDefault(),ds()),"Escape"===a.key&&(a.preventDefault(),aM(null))},placeholder:"Type here... (Cmd/Ctrl + Enter to place)",className:"w-full resize-none rounded-md border border-slate-200 bg-white p-2 text-sm outline-none ring-offset-2 focus:ring-2"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-end gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>aM(null),children:"Cancel"}),(0,b.jsx)(f.Button,{size:"sm",onClick:ds,children:"Place"})]})]})}),Array.from(b2.values()).map(a=>(0,b.jsxs)("div",{className:"absolute pointer-events-none z-10",style:{left:a.x,top:a.y,transform:"translate(-50%, -50%)"},children:["laser"===a.pointerMode?(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-red-500/30 ring-2 ring-red-500/60 blur-[1px]"}):(0,b.jsx)("div",{className:"h-2.5 w-2.5 rounded-full border border-white shadow",style:{backgroundColor:du(a.userId)}}),(0,b.jsxs)("div",{className:"mt-1 whitespace-nowrap rounded px-1.5 py-0.5 text-[10px] text-white",style:{backgroundColor:du(a.userId)},children:[a.name," ",Date.now()-a.lastUpdated>2e3?"(idle)":""]})]},a.userId)),cu.enabled&&(0,b.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/35"}),(0,b.jsx)("div",{className:(0,aj.cn)("absolute border-2 border-yellow-300 shadow-[0_0_0_9999px_rgba(0,0,0,0.35)]","pen"===cu.mode?"rounded-full":"rounded-md"),style:{left:cu.x,top:cu.y,width:cu.width,height:cu.height}})]}),bw&&(0,b.jsxs)("div",{className:"absolute bottom-3 right-3 z-30 h-28 w-44 rounded-md border bg-white/90 p-2",children:[(0,b.jsx)("div",{className:"mb-1 text-[10px] font-semibold uppercase text-slate-500",children:"Presence Minimap"}),(0,b.jsxs)("div",{className:"relative h-[88px] w-full overflow-hidden rounded bg-slate-100",children:[(0,b.jsx)("div",{className:"absolute border border-blue-500/70 bg-blue-200/20",style:{left:`${Math.max(0,Math.min(92,-aP.offsetX/1600*100))}%`,top:`${Math.max(0,Math.min(92,-aP.offsetY/900*100))}%`,width:`${Math.max(8,Math.min(100,420/Math.max(.4,aP.scale)/16))}%`,height:`${Math.max(8,Math.min(100,240/Math.max(.4,aP.scale)/9))}%`}}),Array.from(b2.values()).map(a=>(0,b.jsx)("div",{className:"absolute h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-white",style:{left:`${Math.max(0,Math.min(100,a.x/1600*100))}%`,top:`${Math.max(0,Math.min(100,a.y/900*100))}%`,backgroundColor:du(a.userId)}},`mini-${a.userId}`))]})]}),by&&(0,b.jsxs)("div",{className:"absolute bottom-3 left-3 z-30 rounded-md border bg-white/90 px-2 py-1 text-xs",children:["FPS ",bA," | Strokes ",cM.length," | Cursors ",b2.size]}),(0,b.jsx)("div",{className:"sr-only","aria-live":"polite",children:bG})]}),(0,b.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-md border p-2",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-sm font-semibold",children:[(0,b.jsx)(J.Grid3X3,{className:"w-4 h-4"}),"Layer Model"]}),(0,b.jsx)("div",{className:"space-y-2",children:ck.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs",children:[(0,b.jsx)("button",{className:(0,aj.cn)("rounded border px-2 py-1",cl===a.id?"bg-blue-100 border-blue-400":"bg-white"),onClick:()=>cn(a.id),children:a.label}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{size:"sm",variant:a.visible?"default":"outline",className:"h-6 px-2 text-[11px]",onClick:()=>cm(ck.map(b=>b.id===a.id?{...b,visible:!b.visible}:b)),children:a.visible?"Visible":"Hidden"}),(0,b.jsx)(f.Button,{size:"sm",variant:a.locked?"destructive":"outline",className:"h-6 px-2 text-[11px]",onClick:()=>co(a.id,!a.locked),children:a.locked?"Locked":"Unlocked"})]})]},a.id))})]}),(0,b.jsxs)("div",{className:"rounded-md border p-2",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-sm font-semibold",children:[(0,b.jsx)(H.Sparkles,{className:"w-4 h-4"}),"Spotlight + AI"]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:cu.enabled?"default":"outline",onClick:()=>cv({...cu,enabled:!cu.enabled}),children:cu.enabled?"Disable Spotlight":"Enable Spotlight"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>cv({...cu,mode:"rectangle"===cu.mode?"pen":"rectangle",width:"rectangle"===cu.mode?160:420,height:"rectangle"===cu.mode?160:220}),children:"Spotlight Pen Mode"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>cw({x:cu.x,y:cu.y,width:cu.width,height:cu.height},"Tutor review request"),children:"AI Region Hint"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>ct("none"),children:"Template: None"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>ct("graph-paper"),children:"Template: Graph"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>ct("coordinate-plane"),children:"Template: Coordinate"})]})]}),(0,b.jsxs)("div",{className:"rounded-md border p-2",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-sm font-semibold",children:[(0,b.jsx)(I.Clock3,{className:"w-4 h-4"}),"Timeline + Export"]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsxs)("p",{children:[cy.length," snapshots in timeline"]}),(0,b.jsxs)("p",{className:"text-[11px] text-gray-500",children:["Delta vs live: ",Math.max(0,bY.length-(null!==bQ?cy[bQ]?.strokes.length||0:bY.length))," stroke(s)"]}),(0,b.jsxs)("p",{className:"text-[11px] text-gray-500",children:["Active page strokes: ",cM.length]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"range",min:0,max:Math.max(0,cy.length-1),value:bQ??0,onChange:a=>bR(Number(a.target.value)),disabled:0===cy.length,className:"w-full"}),(0,b.jsx)(f.Button,{size:"sm",variant:"ghost",onClick:()=>bR(null),children:"Live"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:cA,children:"Refresh Timeline"}),(0,b.jsxs)(f.Button,{size:"sm",onClick:dn,children:[(0,b.jsx)(G.Download,{className:"w-3.5 h-3.5 mr-1"}),"Export Attach"]})]})]})]}),(0,b.jsxs)("div",{className:"rounded-md border p-2",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-sm font-semibold",children:[(0,b.jsx)(I.Clock3,{className:"w-4 h-4"}),"Audit Trail"]}),(0,b.jsx)("div",{className:"max-h-24 space-y-1 overflow-auto text-[11px]",children:0===bE.length?(0,b.jsx)("p",{className:"text-slate-500",children:"No actions yet."}):bE.map(a=>(0,b.jsxs)("div",{className:"rounded border px-2 py-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.action}),a.details?(0,b.jsx)("p",{className:"text-slate-500",children:a.details}):null,(0,b.jsx)("p",{className:"text-[10px] text-slate-400",children:new Date(a.at).toLocaleTimeString()})]},`${a.at}-${a.action}`))})]})]})]})}),(0,b.jsx)(h.TabsContent,{value:"student-boards",className:"h-full m-0",children:(0,b.jsxs)(j.ScrollArea,{className:"h-full p-4 space-y-4",children:[b9.length>0&&(0,b.jsxs)("div",{className:"mb-4 border rounded-lg p-3 bg-amber-50/50",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Submission Queue"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(e.Badge,{variant:"secondary",children:[cG.length," pending"]}),cG.length>1&&(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:cc,children:"Mark All Reviewed"})]})]}),(0,b.jsx)("div",{className:"space-y-2",children:b9.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-md border bg-white px-2 py-1.5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.studentName}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[a.strokeCount," strokes • ",new Date(a.submittedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>b6(a.studentId),children:"View"}),(0,b.jsx)(f.Button,{variant:"secondary",size:"sm",onClick:()=>cO(a.studentId),children:"Review"}),(0,b.jsxs)(f.Button,{variant:a.pinned?"default":"outline",size:"sm",onClick:()=>cd(a.studentId,!a.pinned),children:[a.pinned?(0,b.jsx)(C.PinOff,{className:"w-3.5 h-3.5 mr-1"}):(0,b.jsx)(B.Pin,{className:"w-3.5 h-3.5 mr-1"}),a.pinned?"Unpin":"Pin"]}),a.reviewed?(0,b.jsxs)(e.Badge,{className:"bg-green-100 text-green-700 border-green-200",children:[(0,b.jsx)(w.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Reviewed"]}):(0,b.jsx)(f.Button,{size:"sm",onClick:()=>cb(a.studentId),children:"Mark Reviewed"})]})]},a.studentId))})]}),(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Student Boards"}),(0,b.jsxs)("div",{className:"flex items-center gap-1 flex-wrap justify-end",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"all"===bK?"default":"outline",onClick:()=>bL("all"),children:"All"}),(0,b.jsx)(f.Button,{size:"sm",variant:"submitted"===bK?"default":"outline",onClick:()=>bL("submitted"),children:"Submitted Only"}),(0,b.jsx)(f.Button,{size:"sm",variant:"pending"===bK?"default":"outline",onClick:()=>bL("pending"),children:"Pending"}),(0,b.jsx)(f.Button,{size:"sm",variant:"reviewed"===bK?"default":"outline",onClick:()=>bL("reviewed"),children:"Reviewed"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[cK.map(a=>{let c=bZ.get(a.id),d=b0===a.id,g=cF.get(a.id);return(0,b.jsxs)("div",{className:(0,aj.cn)("border rounded-lg p-3 cursor-pointer transition-all",d?"ring-2 ring-blue-500":"hover:border-blue-300",c?.visibility==="private"&&"opacity-50"),onClick:()=>{c&&"private"!==c.visibility&&b6(a.id)},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"font-medium text-sm",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[g&&(0,b.jsx)(e.Badge,{className:(0,aj.cn)("text-xs",g.reviewed?"bg-green-100 text-green-700 border-green-200":"bg-amber-100 text-amber-700 border-amber-200"),children:g.reviewed?"Reviewed":"Submitted"}),c&&(0,b.jsxs)(e.Badge,{variant:"public"===c.visibility?"default":"secondary",className:"text-xs",children:["public"===c.visibility?(0,b.jsx)(s.Eye,{className:"w-3 h-3 mr-1"}):(0,b.jsx)(t.EyeOff,{className:"w-3 h-3 mr-1"}),c.visibility]}),!c&&(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs",children:"No activity"}),(0,b.jsxs)(f.Button,{size:"sm",variant:cp.mutedStudentIds.includes(a.id)?"destructive":"outline",className:"h-6 px-2 text-[11px]",onClick:b=>{b.stopPropagation(),cq(a.id,!cp.mutedStudentIds.includes(a.id))},children:[(0,b.jsx)(K.Ban,{className:"w-3 h-3 mr-1"}),cp.mutedStudentIds.includes(a.id)?"Muted":"Mute"]})]})]}),(0,b.jsx)("div",{className:"h-24 bg-gray-50 rounded border flex items-center justify-center",children:c&&c.strokes.length>0?(0,b.jsx)(av,{strokes:c.strokes}):(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"Empty"})}),d&&(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"flex-1",onClick:a=>{a.stopPropagation(),b7()},children:"Stop Viewing"}),g&&(0,b.jsx)(f.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:b=>{b.stopPropagation(),cO(a.id)},children:"Open Review"})]})]},a.id)}),0===cK.length&&(0,b.jsx)("div",{className:"col-span-3 border rounded-lg p-6 text-center text-sm text-gray-500",children:"No submitted boards yet."})]}),(0,b.jsxs)("div",{className:"mt-4 rounded-md border p-3 bg-muted/20",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Moderation + Overlay + Breakout Sync"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsx)("p",{className:"font-medium",children:"Anti-spam stroke throttle"}),(0,b.jsx)(i.Slider,{value:[cp.studentStrokeWindowLimit],onValueChange:([a])=>cr(a),min:20,max:200,step:5}),(0,b.jsxs)("p",{children:[cp.studentStrokeWindowLimit," strokes / 5s"]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsx)("p",{className:"font-medium",children:"Assignment overlay"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:["none","graph-paper","geometry-grid","coordinate-plane","chemistry-structure"].map(a=>(0,b.jsx)(f.Button,{size:"sm",variant:cs===a?"default":"outline",className:"h-6 px-2 text-[11px]",onClick:()=>ct(a),children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,b.jsx)("p",{className:"font-medium",children:"Breakout board sync"}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>cB("breakout-demo",cM),children:"Promote Best Board to Main Room"})]})]}),cx.length>0&&(0,b.jsxs)("div",{className:"mt-3 rounded border bg-white p-2",children:[(0,b.jsx)("p",{className:"text-xs font-semibold mb-1",children:"AI Board Insight"}),(0,b.jsx)("p",{className:"text-xs text-gray-700",children:cx[0].hint}),(0,b.jsx)("p",{className:"text-[11px] text-amber-700 mt-1",children:cx[0].misconception})]})]})]})}),(0,b.jsx)(h.TabsContent,{value:"pdf-board",className:"h-full m-0",children:(0,b.jsx)("div",{className:"h-full overflow-auto p-4",children:(0,b.jsx)(aq.PDFTutoringWorkbench,{roomId:`${a}:pdf`})})})]})})}),(0,b.jsx)(k.Dialog,{open:bO,onOpenChange:a=>{bP(a),a||bN(null)},children:(0,b.jsxs)(k.DialogContent,{className:"max-w-5xl max-h-[88vh] overflow-hidden p-0",children:[(0,b.jsxs)(k.DialogHeader,{className:"border-b px-6 py-4",children:[(0,b.jsx)(k.DialogTitle,{children:"Tutor Review Panel"}),(0,b.jsx)(k.DialogDescription,{children:"Review submitted student work against your board and close feedback loops quickly. Shortcuts: `J` next, `K` previous, `R` mark reviewed."})]}),bM&&cI?(0,b.jsxs)("div",{className:"space-y-4 overflow-y-auto px-6 py-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border bg-muted/40 px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium",children:cI.name}),cH?(0,b.jsx)(e.Badge,{className:(0,aj.cn)(cH.reviewed?"bg-green-100 text-green-700 border-green-200":"bg-amber-100 text-amber-700 border-amber-200"),children:cH.reviewed?"Reviewed":"Pending review"}):(0,b.jsx)(e.Badge,{variant:"outline",children:"No submission metadata"})]}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:cH?`${cH.strokeCount} strokes • ${new Date(cH.submittedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:"No timestamp available"})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Student Board"}),(0,b.jsxs)(e.Badge,{variant:"secondary",children:[cJ?.strokes.length??0," strokes"]})]}),(0,b.jsx)(aw,{strokes:cJ?.strokes??[]})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"Tutor Board Reference"}),(0,b.jsxs)(e.Badge,{variant:"secondary",children:[bY.length," strokes"]})]}),(0,b.jsx)(aw,{strokes:cM})]})]})]}):(0,b.jsx)("div",{className:"m-6 rounded-md border p-6 text-sm text-gray-500",children:"Pick a student submission to begin review."}),(0,b.jsx)(k.DialogFooter,{className:"border-t px-6 py-4",children:(0,b.jsxs)("div",{className:"flex w-full flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:cQ,disabled:0===cG.length,children:"Previous Pending (K)"}),(0,b.jsx)(f.Button,{variant:"secondary",onClick:cP,disabled:0===cG.length,children:"Next Pending (J)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[bM&&(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{b6(bM),bJ("student-boards"),bP(!1)},children:"Jump to Live Board"}),cH&&!cH.reviewed&&(0,b.jsx)(f.Button,{onClick:()=>cb(cH.studentId),children:"Mark Reviewed (R)"})]})]})})]})})]})}function av({strokes:a}){let d=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=d.current,c=b?.getContext("2d");b&&c&&(c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height),a.forEach(a=>{a.points.length<2||(c.beginPath(),c.moveTo(a.points[0].x/4,a.points[0].y/4),a.points.forEach((a,b)=>{b>0&&c.lineTo(a.x/4,a.y/4)}),c.strokeStyle=a.color,c.lineWidth=Math.max(1,a.width/4),c.lineCap="round",c.stroke())}))},[a]),(0,b.jsx)("canvas",{ref:d,width:150,height:100,className:"w-full h-full"})}function aw({strokes:a}){let d=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=d.current,c=b?.getContext("2d");if(!b||!c||(c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height),0===a.length))return;let e=a.flatMap(a=>a.points);if(0===e.length)return;let f=Math.min(...e.map(a=>a.x)),g=Math.min(...e.map(a=>a.y)),h=Math.max(...e.map(a=>a.x)),i=Math.max(...e.map(a=>a.y)),j=Math.max(1,h-f),k=Math.max(1,i-g),l=Math.max(.2,Math.min((b.width-32)/j,(b.height-32)/k)),m=(b.width-j*l)/2-f*l,n=(b.height-k*l)/2-g*l;a.forEach(a=>{a.points.length<2||(c.beginPath(),c.moveTo(a.points[0].x*l+m,a.points[0].y*l+n),a.points.forEach((a,b)=>{b>0&&c.lineTo(a.x*l+m,a.y*l+n)}),c.strokeStyle=a.color,c.lineWidth=Math.max(1,a.width*l*.6),c.lineCap="round",c.lineJoin="round",c.stroke())})},[a]),(0,b.jsx)("div",{className:"h-64 w-full rounded-md border bg-white",children:(0,b.jsx)("canvas",{ref:d,width:600,height:320,className:"h-full w-full"})})}var ax=a.i(101259),ay=a.i(962337);let az=(0,Y.default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var aA=a.i(801728);let aB=(0,Y.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);a.s(["ChevronUp",()=>aB],273489);let aC=["#111827","#2563EB","#7C3AED","#059669","#DC2626","#EA580C","#0891B2","#CA8A04","#6B7280"],aD={pencil:{width:2,opacity:.82,strokeType:"pencil"},pen:{width:3,opacity:1,strokeType:"pen"},marker:{width:6,opacity:.9,strokeType:"marker"},highlighter:{width:16,opacity:.22,strokeType:"highlighter"},calligraphy:{width:5,opacity:.95,strokeType:"calligraphy"},eraser:{width:24,opacity:1,strokeType:"eraser"},line:{width:3,opacity:1,strokeType:"shape"},arrow:{width:3,opacity:1,strokeType:"shape"},rectangle:{width:3,opacity:1,strokeType:"shape"},circle:{width:3,opacity:1,strokeType:"shape"},triangle:{width:3,opacity:1,strokeType:"shape"},connector:{width:3,opacity:1,strokeType:"shape"},text:{width:3,opacity:1,strokeType:"text"},laser:{width:3,opacity:1,strokeType:"pen"},hand:{width:3,opacity:1,strokeType:"pen"},select:{width:3,opacity:1,strokeType:"pen"}};function aE({roomId:a,sessionId:g,mode:h="floating",visibleTaskShares:j=[],onOpenTask:k}){let{data:p}=(0,d.useSession)(),q=p?.user?.id,s=(0,c.useRef)(null),v=(0,c.useRef)(null),[B,C]=(0,c.useState)("pen"),[D,E]=(0,c.useState)("#111827"),[F,G]=(0,c.useState)("#111827"),[H,I]=(0,c.useState)(3),[J,K]=(0,c.useState)(!1),[M,V]=(0,c.useState)([]),[W,X]=(0,c.useState)(null),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(20),[ae,af]=(0,c.useState)({scale:1,offsetX:0,offsetY:0}),[ag,ah]=(0,c.useState)(!1),ak=(0,c.useRef)(null),[al,am]=(0,c.useState)(null),[an,ao]=(0,c.useState)(new Set),[ap,aq]=(0,c.useState)("rect"),[ar,as]=(0,c.useState)("intersect"),[at,au]=(0,c.useState)(null),[av,aw]=(0,c.useState)(!1),[aE,aF]=(0,c.useState)(null),aG=(0,c.useRef)(null),[aH,aI]=(0,c.useState)(!1),aJ=(0,c.useRef)(null),[aK,aL]=(0,c.useState)(null),aM=(0,c.useRef)(null),aN=(0,c.useRef)(new Map),[aO,aP]=(0,c.useState)(!1),[aQ,aR]=(0,c.useState)(!0),[aS,aT]=(0,c.useState)(!0),[aU,aV]=(0,c.useState)(!1),[aW,aX]=(0,c.useState)(1),[aY,aZ]=(0,c.useState)(!0),[a$,a_]=(0,c.useState)(!0),[a0,a1]=(0,c.useState)(20),[a2,a3]=(0,c.useState)(!1),[a4,a5]=(0,c.useState)("plain"),[a6,a7]=(0,c.useState)(""),[a8,a9]=(0,c.useState)(!1),ba=(0,c.useRef)(0),bb=(0,c.useRef)("mouse"),bc=(0,c.useMemo)(()=>new Set(["line","arrow","rectangle","circle","triangle","connector"]),[]),bd=(0,c.useMemo)(()=>new Set(["pencil","pen","marker","highlighter","calligraphy","eraser"]),[]),{myStrokes:be,tutorStrokes:bf,visibility:bg,isConnected:bh,remoteCursors:bi,remoteSelections:bj,isLayerLocked:bk,hasSubmitted:bl,addStroke:bm,changeVisibility:bn,submitMyBoard:bo,undoLastStroke:bp,updateCursor:bq,updateSelectionPresence:br,clearOwnStrokes:bs,replaceMyStrokes:bt,assignmentOverlay:bu,spotlight:bv,activeLayerId:bw,setActiveLayerId:bx,availableBranches:by,createBoardBranch:bz,switchBoardBranch:bA}=ai(a,g,"student"),bB=(0,c.useCallback)((a,b,c,d,e)=>{let f=Math.min(c.x,d.x),g=Math.min(c.y,d.y),h=Math.abs(d.x-c.x),i=Math.abs(d.y-c.y);if(a.save(),a.globalAlpha=e.opacity??1,a.strokeStyle=e.color,a.lineWidth=e.width,a.lineCap="round",a.lineJoin="round","line"===b||"arrow"===b||"connector"===b){if(a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(d.x,d.y),a.stroke(),"connector"===b&&(a.beginPath(),a.arc(c.x,c.y,Math.max(3,e.width),0,2*Math.PI),a.arc(d.x,d.y,Math.max(3,e.width),0,2*Math.PI),a.fillStyle=e.color,a.fill()),"arrow"===b){let b=Math.atan2(d.y-c.y,d.x-c.x),f=Math.max(10,4*e.width);a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(d.x-f*Math.cos(b-Math.PI/6),d.y-f*Math.sin(b-Math.PI/6)),a.lineTo(d.x-f*Math.cos(b+Math.PI/6),d.y-f*Math.sin(b+Math.PI/6)),a.closePath(),a.fillStyle=e.color,a.fill()}}else"rectangle"===b?a.strokeRect(f,g,h,i):"circle"===b?(a.beginPath(),a.ellipse(f+h/2,g+i/2,Math.max(2,h/2),Math.max(2,i/2),0,0,2*Math.PI),a.stroke()):"triangle"===b&&(a.beginPath(),a.moveTo(f+h/2,g),a.lineTo(f+h,g+i),a.lineTo(f,g+i),a.closePath(),a.stroke());a.restore()},[]),bC=(0,c.useCallback)((a,b,c=1)=>{if("text"===b.type){let d=b.points[0];if(!d||!b.text)return;a.save(),a.fillStyle=b.color,a.globalAlpha=(b.opacity??1)*c;let e=b.textStyle?.bold?"700":"400",f=b.textStyle?.italic?"italic":"normal";a.font=`${f} ${e} ${b.fontSize||ac}px ${b.fontFamily||"Inter, Segoe UI, system-ui, sans-serif"}`,a.textBaseline="top",a.textAlign=b.textStyle?.align||"left",a.fillText(b.text,d.x,d.y),a.restore();return}if("shape"===b.type&&b.shapeType&&b.points.length>=2){if("connector"===b.shapeType){a.save(),a.globalAlpha=(b.opacity??1)*c,a.strokeStyle=b.color,a.lineWidth=b.width,a.lineJoin="round",a.lineCap="round",a.beginPath(),b.points.forEach((b,c)=>{0===c?a.moveTo(b.x,b.y):a.lineTo(b.x,b.y)}),a.stroke();let d=b.points[0],e=b.points[b.points.length-1];a.beginPath(),a.arc(d.x,d.y,Math.max(3,b.width),0,2*Math.PI),a.arc(e.x,e.y,Math.max(3,b.width),0,2*Math.PI),a.fillStyle=b.color,a.fill(),a.restore();return}bB(a,b.shapeType,b.points[0],b.points[b.points.length-1],{color:b.color,width:b.width,opacity:(b.opacity??1)*c});return}if(!(b.points.length<2)){a.save(),a.globalAlpha=(b.opacity??1)*c,a.strokeStyle=b.color,a.lineCap="calligraphy"===b.type?"square":"round",a.lineJoin="round";for(let c=1;c<b.points.length;c+=1){let d=b.points[c-1],e=b.points[c],f="number"==typeof e.pressure?e.pressure:.5;a.lineWidth=Math.max(1,b.width*(.55+.9*f)),"pencil"===b.type?a.setLineDash([1,1.5]):a.setLineDash([]),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(e.x,e.y),a.stroke()}a.restore()}},[bB,ac]),bD=(0,c.useCallback)(a=>{if("text"===a.type){let b=a.points[0];if(!b)return null;let c=Math.max(80,(a.text?.length||0)*(.55*(a.fontSize||ac))),d=1.4*(a.fontSize||ac);return{x:b.x,y:b.y,width:c,height:d}}if(!a.points.length)return null;let b=a.points.map(a=>a.x),c=a.points.map(a=>a.y),d=Math.min(...b),e=Math.min(...c),f=Math.max(...b),g=Math.max(...c),h=Math.max(8,a.width);return{x:d-h,y:e-h,width:f-d+2*h,height:g-e+2*h}},[ac]),bE=(0,c.useCallback)((a,b)=>{let c=!1;for(let d=0,e=b.length-1;d<b.length;e=d++){let f=b[d].x,g=b[d].y,h=b[e].x,i=b[e].y;g>a.y!=i>a.y&&a.x<(h-f)*(a.y-g)/(i-g||1e-6)+f&&(c=!c)}return c},[]),bF=(0,c.useCallback)((a,b,c)=>{let d=c.map(a=>({x:a.x-18,y:a.y-18,width:a.width+36,height:a.height+36})),e=c=>{let d=c?{x:b.x,y:a.y}:{x:a.x,y:b.y};return[a,d,b]},f=[e(!0),e(!1),[a,{x:a.x,y:a.y-80},{x:b.x,y:a.y-80},b],[a,{x:a.x,y:a.y+80},{x:b.x,y:a.y+80},b],[a,{x:a.x-80,y:a.y},{x:a.x-80,y:b.y},b],[a,{x:a.x+80,y:a.y},{x:a.x+80,y:b.y},b]].map(a=>({path:a,ok:a.every((b,c)=>{let e;return 0===c||(e=a[c-1],d.every(a=>{let c,d,f,g;return c=Math.min(e.x,b.x),d=Math.max(e.x,b.x),f=Math.min(e.y,b.y),g=Math.max(e.y,b.y),!(d>=a.x)||!(c<=a.x+a.width)||!(g>=a.y)||!(f<=a.y+a.height)}))}),cost:a.reduce((b,c,d)=>0===d?0:b+Math.abs(c.x-a[d-1].x)+Math.abs(c.y-a[d-1].y),0)})).filter(a=>a.ok).sort((a,b)=>a.cost-b.cost);return(f[0]?.path||e(!0)).map(a=>({x:a.x,y:a.y}))},[]),bG=(0,c.useCallback)(a=>({top:{x:a.x+a.width/2,y:a.y},right:{x:a.x+a.width,y:a.y+a.height/2},bottom:{x:a.x+a.width/2,y:a.y+a.height},left:{x:a.x,y:a.y+a.height/2},center:{x:a.x+a.width/2,y:a.y+a.height/2}}),[]),bH=(0,c.useCallback)((a,b)=>{let c=bG(b),d="center",e=c.center,f=1/0;return Object.keys(c).forEach(b=>{let g=c[b],h=g.x-a.x,i=g.y-a.y,j=Math.sqrt(h*h+i*i);j<f&&(f=j,d=b,e=g)}),{port:d,anchor:e,distance:f}},[bG]),bI=(0,c.useCallback)((a,b)=>{let c={anchor:a,distance:1/0};return(b.filter(a=>"connector"!==a.shapeType).forEach(b=>{let d=bD(b);if(!d)return;let e=bH(a,d);e.distance<c.distance&&(c={strokeId:b.id,port:e.port,anchor:e.anchor,distance:e.distance})}),c.distance<=56&&c.strokeId&&c.port)?{point:c.anchor,sourceStrokeId:c.strokeId,sourcePort:c.port}:{point:a}},[bH,bD]),bJ=(0,c.useCallback)(a=>{let b=be.filter(b=>a.has(b.id)).map(a=>bD(a)).filter(a=>!!a);if(!b.length)return null;let c=Math.min(...b.map(a=>a.x)),d=Math.min(...b.map(a=>a.y));return{x:c,y:d,width:Math.max(...b.map(a=>a.x+a.width))-c,height:Math.max(...b.map(a=>a.y+a.height))-d}},[bD,be]),bK=(0,c.useCallback)((a,b)=>{bk||0===an.size||bt(c=>c.map(c=>an.has(c.id)?{...c,points:c.points.map(c=>({...c,x:aY?Math.round((c.x+a)/a0)*a0:c.x+a,y:aY?Math.round((c.y+b)/a0)*a0:c.y+b}))}:c))},[a0,bk,bt,an,aY]),bL=(0,c.useCallback)(a=>{if(bk||0===an.size)return;let b=bJ(an);if(!b)return;let c=b.x+b.width/2,d=b.y+b.height/2;bt(b=>b.map(b=>an.has(b.id)?{...b,points:b.points.map(b=>({...b,x:aY?Math.round((c+(b.x-c)*a)/a0)*a0:c+(b.x-c)*a,y:aY?Math.round((d+(b.y-d)*a)/a0)*a0:d+(b.y-d)*a}))}:b))},[bJ,a0,bk,bt,an,aY]),bM=(0,c.useCallback)(a=>{let b=be.find(a=>an.has(a.id));if(!b)return;let c=new Set;be.forEach(d=>{"color"===a&&d.color===b.color&&c.add(d.id),"type"===a&&d.type===b.type&&c.add(d.id),"layer"===a&&(d.layerId||"student-personal")===(b.layerId||"student-personal")&&c.add(d.id)}),ao(c)},[be,an]),bN=(0,c.useMemo)(()=>bJ(an),[bJ,an]),bO=(0,c.useMemo)(()=>{if(1!==an.size)return null;let a=Array.from(an)[0],b=be.find(b=>b.id===a);return!b||"connector"!==b.shapeType||b.points.length<2?null:b},[be,an]),bP=(0,c.useCallback)((a,b)=>{let c=a.points[0],d=a.points[a.points.length-1];if(a.sourceStrokeId&&a.sourcePort){let d=b.find(b=>b.id===a.sourceStrokeId),e=d?bD(d):null;e&&(c=bG(e)[a.sourcePort])}if(a.targetStrokeId&&a.targetPort){let c=b.find(b=>b.id===a.targetStrokeId),e=c?bD(c):null;e&&(d=bG(e)[a.targetPort])}return{source:{x:c.x*ae.scale+ae.offsetX,y:c.y*ae.scale+ae.offsetY},target:{x:d.x*ae.scale+ae.offsetX,y:d.y*ae.scale+ae.offsetY}}},[bG,bD,ae.offsetX,ae.offsetY,ae.scale]),bQ=(0,c.useCallback)((a,b)=>{if(!bO)return null;let c=bP(bO,be);return 10>=Math.hypot(a-c.source.x,b-c.source.y)?{strokeId:bO.id,endpoint:"source"}:10>=Math.hypot(a-c.target.x,b-c.target.y)?{strokeId:bO.id,endpoint:"target"}:null},[bO,bP,be]);(0,c.useEffect)(()=>{br(Array.from(an),void 0,"#f59e0b")},[an,br]),(0,c.useEffect)(()=>{bt(a=>{let b=new Map(a.map(a=>[a.id,a])),c=a.filter(a=>"connector"!==a.shapeType).map(a=>bD(a)).filter(a=>!!a),d=!1,e=[];return a.forEach(a=>{if("connector"!==a.shapeType||!a.sourceStrokeId||!a.targetStrokeId||!a.sourcePort||!a.targetPort)return void e.push(a);let f=b.get(a.sourceStrokeId),g=b.get(a.targetStrokeId);if(!f||!g){d=!0;return}let h=bD(f),i=bD(g);if(!h||!i)return void e.push(a);let j=bF(bG(h)[a.sourcePort],bG(i)[a.targetPort],c);a.points.length===j.length&&a.points.every((a,b)=>{let c=j[b];return .5>Math.abs(a.x-c.x)&&.5>Math.abs(a.y-c.y)})?e.push(a):(d=!0,e.push({...a,points:j,updatedAt:Date.now()}))}),d?e:a})},[bG,bD,be,bt,bF]);let bR=(0,c.useCallback)((a,b)=>{if(!bN)return null;for(let c of[{id:"nw",x:bN.x,y:bN.y},{id:"ne",x:bN.x+bN.width,y:bN.y},{id:"sw",x:bN.x,y:bN.y+bN.height},{id:"se",x:bN.x+bN.width,y:bN.y+bN.height}]){let d=c.x*ae.scale+ae.offsetX,e=c.y*ae.scale+ae.offsetY,f=a-d,g=b-e;if(10>=Math.sqrt(f*f+g*g))return c.id}let c={x:(bN.x+bN.width/2)*ae.scale+ae.offsetX,y:(bN.y-36)*ae.scale+ae.offsetY},d=a-c.x,e=b-c.y;return 11>=Math.sqrt(d*d+e*e)?"rotate":null},[bN,ae.offsetX,ae.offsetY,ae.scale]),bS=(0,c.useCallback)(()=>{let a=s.current,b=a?.getContext("2d");if(!a||!b)return;if(b.fillStyle="#ffffff",b.fillRect(0,0,a.width,a.height),a$){b.save(),b.strokeStyle="rgba(148, 163, 184, 0.18)",b.lineWidth=1;for(let c=0;c<a.width;c+=a0)b.beginPath(),b.moveTo(c,0),b.lineTo(c,a.height),b.stroke();for(let c=0;c<a.height;c+=a0)b.beginPath(),b.moveTo(0,c),b.lineTo(a.width,c),b.stroke();b.restore()}b.save(),b.translate(ae.offsetX,ae.offsetY),b.scale(ae.scale,ae.scale);let c={left:-ae.offsetX/ae.scale,top:-ae.offsetY/ae.scale,right:(a.width-ae.offsetX)/ae.scale,bottom:(a.height-ae.offsetY)/ae.scale},d=a=>!a||a.x<=c.right&&a.x+a.width>=c.left&&a.y<=c.bottom&&a.y+a.height>=c.top;if(aQ&&bf.forEach(a=>{d(bD(a))&&bC(b,a,.5)}),be.forEach(a=>{let c=bD(a);d(c)&&(bC(b,a,1),an.has(a.id)&&c&&(b.save(),b.strokeStyle="#2563eb",b.setLineDash([6,4]),b.lineWidth=1.5/Math.max(.4,ae.scale),b.strokeRect(c.x,c.y,c.width,c.height),b.restore()))}),bj.forEach(a=>{a.strokeIds.forEach(c=>{let e=be.find(a=>a.id===c)||bf.find(a=>a.id===c);if(!e)return;let f=bD(e);f&&d(f)&&(b.save(),b.strokeStyle=a.color||"#f59e0b",b.setLineDash([4,4]),b.lineWidth=1.25/Math.max(.4,ae.scale),b.strokeRect(f.x,f.y,f.width,f.height),b.restore())})}),J&&M.length>1&&bd.has(B)&&bC(b,{id:"preview",points:M,color:"eraser"===B?"#ffffff":D,width:"eraser"===B?aD.eraser.width:H,opacity:aD[B].opacity,type:aD[B].strokeType,userId:"preview"},1),W&&Y&&bc.has(B)){let a=aD[B];bB(b,B,W,Y,{color:D,width:Math.max(1,H),opacity:a.opacity})}if($){b.save(),b.globalAlpha=.9;let a=b.createRadialGradient($.x,$.y,1,$.x,$.y,28);a.addColorStop(0,"rgba(239,68,68,0.95)"),a.addColorStop(1,"rgba(239,68,68,0)"),b.fillStyle=a,b.beginPath(),b.arc($.x,$.y,28,0,2*Math.PI),b.fill(),b.restore()}if(b.restore(),al){b.save(),b.strokeStyle="#2563eb",b.fillStyle="rgba(37, 99, 235, 0.08)",b.setLineDash([6,3]);let a=Math.min(al.x,al.x+al.width),c=Math.min(al.y,al.y+al.height),d=Math.abs(al.width),e=Math.abs(al.height);b.strokeRect(a,c,d,e),b.fillRect(a,c,d,e),b.restore()}if(at&&at.length>1&&(b.save(),b.strokeStyle="#2563eb",b.fillStyle="rgba(37, 99, 235, 0.08)",b.setLineDash([6,3]),b.beginPath(),at.forEach((a,c)=>{let d={x:a.x*ae.scale+ae.offsetX,y:a.y*ae.scale+ae.offsetY};0===c?b.moveTo(d.x,d.y):b.lineTo(d.x,d.y)}),b.closePath(),b.stroke(),b.fill(),b.restore()),bN){let a=[{x:bN.x,y:bN.y},{x:bN.x+bN.width,y:bN.y},{x:bN.x,y:bN.y+bN.height},{x:bN.x+bN.width,y:bN.y+bN.height}];b.save(),b.fillStyle="#2563eb",a.forEach(a=>{let c=a.x*ae.scale+ae.offsetX,d=a.y*ae.scale+ae.offsetY;b.beginPath(),b.arc(c,d,5,0,2*Math.PI),b.fill()});let c=(bN.x+bN.width/2)*ae.scale+ae.offsetX,d=bN.y*ae.scale+ae.offsetY,e=(bN.y-36)*ae.scale+ae.offsetY;b.strokeStyle="#2563eb",b.beginPath(),b.moveTo(c,d),b.lineTo(c,e+8),b.stroke(),b.beginPath(),b.arc(c,e,6,0,2*Math.PI),b.fillStyle="#0ea5e9",b.fill(),b.restore()}if(bO){let a=bP(bO,be);b.save(),b.fillStyle="#0ea5e9",b.strokeStyle="#0369a1",b.lineWidth=2,b.beginPath(),b.arc(a.source.x,a.source.y,7,0,2*Math.PI),b.fill(),b.stroke(),b.fillStyle="#22c55e",b.strokeStyle="#15803d",b.beginPath(),b.arc(a.target.x,a.target.y,7,0,2*Math.PI),b.fill(),b.stroke(),b.restore()}},[bO,H,D,M,bB,bC,bd,bP,bD,a0,a$,J,at,$,be,bj,bN,an,al,Y,W,bc,aQ,B,bf,ae.offsetX,ae.offsetY,ae.scale]),bT=(0,c.useCallback)(()=>{switch(bu){case"graph-paper":return"linear-gradient(to right, rgba(59,130,246,0.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(59,130,246,0.15) 1px, transparent 1px)";case"geometry-grid":return"linear-gradient(45deg, rgba(16,185,129,0.16) 1px, transparent 1px), linear-gradient(-45deg, rgba(16,185,129,0.16) 1px, transparent 1px)";case"coordinate-plane":return"linear-gradient(to right, rgba(107,114,128,0.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(107,114,128,0.15) 1px, transparent 1px), linear-gradient(to right, transparent calc(50% - 1px), rgba(239,68,68,0.35) calc(50% - 1px), rgba(239,68,68,0.35) calc(50% + 1px), transparent calc(50% + 1px)), linear-gradient(to bottom, transparent calc(50% - 1px), rgba(239,68,68,0.35) calc(50% - 1px), rgba(239,68,68,0.35) calc(50% + 1px), transparent calc(50% + 1px))";case"chemistry-structure":return"radial-gradient(circle at 20px 20px, rgba(245,158,11,0.18) 2px, transparent 2px), radial-gradient(circle at 60px 40px, rgba(245,158,11,0.18) 2px, transparent 2px), radial-gradient(circle at 100px 20px, rgba(245,158,11,0.18) 2px, transparent 2px)";default:return"none"}},[bu]);(0,c.useEffect)(()=>{let a=s.current,b=v.current;if(!a||!b)return;let c=()=>{a.width=b.clientWidth,a.height=b.clientHeight,bS()};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[bS]),(0,c.useEffect)(()=>{bS()},[bS]);let bU=a=>{let b=s.current;if(!b)return{x:0,y:0};let c=b.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top;return{x:(d-ae.offsetX)/ae.scale,y:(e-ae.offsetY)/ae.scale,pressure:"mouse"===a.pointerType?.5:a.pressure||.5}},bV=(0,c.useCallback)(a=>({x:a.x*ae.scale+ae.offsetX,y:a.y*ae.scale+ae.offsetY}),[ae.offsetX,ae.offsetY,ae.scale]),bW=(0,c.useCallback)(()=>{if(!aa||!aa.value.trim())return void ab(null);let a=aa.value.trim(),b="latex"===a4?`$$${a}$$`:"code"===a4?`\`\`\`
${a}
\`\`\``:"table"===a4?`| Column A | Column B |
|---|---|
| ${a} |  |`:a;bm({id:Date.now().toString(),points:[{x:aa.x,y:aa.y}],color:D,width:1,opacity:1,type:"text",text:b,fontSize:ac,fontFamily:"Inter, Segoe UI, system-ui, sans-serif",userId:q||"student",layerId:bw}),ab(null)},[bw,bm,D,ac,q,aa,a4]),bX=a=>{if(a.currentTarget.releasePointerCapture(a.pointerId),ag){ah(!1),ak.current=null;return}if(aK)return void aL(null);if(al){let a=Math.min(al.x,al.x+al.width),b=Math.min(al.y,al.y+al.height),c=Math.abs(al.width),d=Math.abs(al.height),e=new Set;be.forEach(f=>{let g=bD(f);if(!g)return;let h=bV({x:g.x,y:g.y}),i=bV({x:g.x+g.width,y:g.y+g.height}),j=h.x<a+c&&i.x>a&&h.y<b+d&&i.y>b,k=h.x>=a&&i.x<=a+c&&h.y>=b&&i.y<=b+d;("intersect"===ar&&j||"contain"===ar&&k)&&e.add(f.id)}),ao(e),am(null);return}if(at&&at.length>2){let a=new Set;be.forEach(b=>{b.points.some(a=>bE({x:a.x,y:a.y},at))&&a.add(b.id)}),ao(a),au(null);return}if(aH){aI(!1),aJ.current=null,aN.current.clear();return}if(aE){aF(null),aG.current=null,aN.current.clear();return}if(av){aw(!1),aM.current=null,aN.current.clear();return}if("laser"===B)return void _(null);if(!J)return;if(bc.has(B)&&W&&Y){let a=aD[B],b="connector"===B?bI(W,be):{point:W},c="connector"===B?bI(Y,be):{point:Y},d=b.point,e=c.point,f="connector"===B?bF(d,e,be.filter(a=>"connector"!==a.shapeType).map(a=>bD(a)).filter(a=>!!a)):[d,e];bm({id:Date.now().toString(),points:f,color:D,width:Math.max(1,H),opacity:a.opacity,shapeType:B,type:"shape",userId:q||"student",layerId:bw,sourceStrokeId:"connector"===B?b.sourceStrokeId:void 0,targetStrokeId:"connector"===B?c.sourceStrokeId:void 0,sourcePort:"connector"===B?b.sourcePort:void 0,targetPort:"connector"===B?c.sourcePort:void 0}),X(null),Z(null),K(!1);return}if(0===M.length)return void K(!1);let b=aD[B];bm({id:Date.now().toString(),points:M,color:"eraser"===B?"#ffffff":D,width:"eraser"===B?b.width:H,opacity:b.opacity,type:b.strokeType,userId:q||"student",layerId:bw}),K(!1),V([])},bY=(0,c.useCallback)(a=>{a.preventDefault();let b=a.deltaY<0?1.08:.92,c=Math.min(3,Math.max(.35,ae.scale*b)),d=s.current;if(!d)return;let e=d.getBoundingClientRect(),f=a.clientX-e.left,g=a.clientY-e.top,h=(f-ae.offsetX)/ae.scale,i=(g-ae.offsetY)/ae.scale;af({scale:c,offsetX:f-h*c,offsetY:g-i*c})},[ae.offsetX,ae.offsetY,ae.scale]);(0,c.useEffect)(()=>{if(!a2)return;let a=Array.from(bi.values()).find(a=>"tutor"===a.role);a&&af(b=>({...b,offsetX:(s.current?.width||0)/2-a.x*b.scale,offsetY:(s.current?.height||0)/2-a.y*b.scale}))},[a2,bi]),(0,c.useEffect)(()=>{let a=a=>{if(a.target?.tagName==="INPUT"||a.target?.tagName==="TEXTAREA")return;let b=a.shiftKey?20:6,c=a.key.toLowerCase();"v"===c&&C("select"),"p"===c&&C("pen"),"e"===c&&C("eraser"),"t"===c&&C("text"),"l"===c&&C("laser"),"h"===c&&C("hand"),an.size>0&&("ArrowUp"===a.key&&(a.preventDefault(),bK(0,-b)),"ArrowDown"===a.key&&(a.preventDefault(),bK(0,b)),"ArrowLeft"===a.key&&(a.preventDefault(),bK(-b,0)),"ArrowRight"===a.key&&(a.preventDefault(),bK(b,0)),"+"===a.key&&(a.preventDefault(),bL(1.08)),"-"===a.key&&(a.preventDefault(),bL(.92))),(a.ctrlKey||a.metaKey)&&"z"===a.key.toLowerCase()&&(a.preventDefault(),bp()),(a.ctrlKey||a.metaKey)&&"x"===a.key.toLowerCase()&&(a.preventDefault(),bs())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[bs,bK,bL,an.size,bp]),(0,c.useEffect)(()=>{let a=aD[B];a&&("eraser"===B||"highlighter"===B||"marker"===B||"calligraphy"===B||"pencil"===B||"pen"===B)&&I(a.width)},[B]),(0,c.useEffect)(()=>{af(a=>({...a,scale:aW}))},[aW]);let bZ=(0,c.useCallback)(a=>{let b=["#2563eb","#7c3aed","#059669","#dc2626","#ea580c","#0891b2","#ca8a04"],c=0;for(let b=0;b<a.length;b+=1)c=31*c+a.charCodeAt(b)|0;return b[Math.abs(c)%b.length]},[]),b$=()=>{switch(bg){case"private":return"Private";case"tutor-only":return"Tutor Only";case"public":return"Class Visible"}};return"floating"===h&&aO?(0,b.jsx)("div",{className:"fixed bottom-4 right-4 bg-white border rounded-lg shadow-lg p-3 z-50",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(z.Palette,{className:"w-5 h-5"}),(0,b.jsx)("span",{className:"font-medium",children:"My Whiteboard"}),(0,b.jsx)(e.Badge,{variant:"public"===bg?"default":"secondary",className:"text-xs",children:b$()}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>aP(!1),children:(0,b.jsx)(aB,{className:"w-4 h-4"})})]})}):(0,b.jsxs)("div",{className:(0,aj.cn)("bg-white border rounded-lg shadow-2xl flex flex-col","floating"===h?"fixed bottom-4 right-4 w-96 z-50":"w-full h-full"),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b bg-gray-50 rounded-t-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(z.Palette,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"font-medium text-sm",children:"My Whiteboard"}),bk&&(0,b.jsxs)(e.Badge,{variant:"destructive",className:"text-xs",children:[(0,b.jsx)(u.Lock,{className:"w-3 h-3 mr-1"}),"Locked"]}),bl&&(0,b.jsxs)(e.Badge,{className:"text-xs bg-green-100 text-green-700 border-green-200",children:[(0,b.jsx)(w.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Submitted"]}),!bh&&(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs text-red-500",children:"Offline"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>aT(a=>!a),"aria-label":"Toggle stylus priority",children:aS?"Stylus Priority":"Touch Enabled"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>aV(a=>!a),"aria-label":"Toggle high contrast",children:aU?"Standard":"High Contrast"}),(0,b.jsxs)(ax.Sheet,{open:a8,onOpenChange:a9,children:[(0,b.jsx)(ax.SheetTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:j.length>0?"default":"ghost",size:"sm",className:(0,aj.cn)("h-7 text-xs",j.length>0&&"animate-pulse"),children:j.length>0?`Live Tasks (${j.length})`:"Tasks (0)"})}),(0,b.jsxs)(ax.SheetContent,{side:"right",className:"w-[420px] sm:w-[520px]",children:[(0,b.jsx)(ax.SheetHeader,{children:(0,b.jsx)(ax.SheetTitle,{children:"Visible Tasks"})}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:0===j.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No visible tasks yet."}):j.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.description||"Tutor shared task document"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(e.Badge,{variant:"outline",children:a.visibleToAll?"Class Visible":"Private"}),(0,b.jsx)(e.Badge,{variant:"secondary",children:a.allowCollaborativeWrite?"Collaborative":"Read only"}),a.submissions?.some(a=>a.userId===q)&&(0,b.jsx)(e.Badge,{className:"bg-green-100 text-green-700 border-green-200",children:"Submitted"})]}),(0,b.jsx)(f.Button,{size:"sm",onClick:()=>{k?.(a.shareId),a9(!1)},children:"Open Task"})]})]},a.shareId))})]})]}),(0,b.jsxs)(ay.DropdownMenu,{children:[(0,b.jsx)(ay.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"h-7 text-xs",children:[(()=>{switch(bg){case"private":return(0,b.jsx)(t.EyeOff,{className:"w-4 h-4 mr-2"});case"tutor-only":return(0,b.jsx)(az,{className:"w-4 h-4 mr-2"});case"public":return(0,b.jsx)(r.Users,{className:"w-4 h-4 mr-2"})}})(),b$(),(0,b.jsx)(aA.ChevronDown,{className:"w-3 h-3 ml-1"})]})}),(0,b.jsxs)(ay.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(ay.DropdownMenuItem,{onClick:()=>bn("private"),children:[(0,b.jsx)(t.EyeOff,{className:"w-4 h-4 mr-2"}),"Private (Only Me)"]}),(0,b.jsxs)(ay.DropdownMenuItem,{onClick:()=>bn("tutor-only"),children:[(0,b.jsx)(az,{className:"w-4 h-4 mr-2"}),"Tutor Can View"]}),(0,b.jsxs)(ay.DropdownMenuItem,{onClick:()=>bn("public"),children:[(0,b.jsx)(r.Users,{className:"w-4 h-4 mr-2"}),"Class Can View"]})]})]}),"floating"===h&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7",onClick:()=>aP(!0),children:(0,b.jsx)(aA.ChevronDown,{className:"w-4 h-4"})})]})]}),j.length>0&&(0,b.jsxs)("div",{className:"border-b bg-blue-50 px-3 py-2 text-xs text-blue-800",children:["Tutor shared ",j.length," live task",j.length>1?"s":"",". Click"," ",(0,b.jsx)("span",{className:"font-semibold",children:"Live Tasks"})," to open and work on your copy."]}),(0,b.jsx)("div",{className:"space-y-2 border-b bg-slate-50/95 px-3 py-2 backdrop-blur",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[{id:"pencil",icon:l.Pencil,label:"Pencil"},{id:"pen",icon:R.PenLine,label:"Pen"},{id:"marker",icon:T.Dot,label:"Marker"},{id:"highlighter",icon:S.Highlighter,label:"Highlighter"},{id:"calligraphy",icon:y.Minus,label:"Calligraphy"},{id:"eraser",icon:m.Eraser,label:"Eraser"}].map(({id:a,icon:c,label:d})=>(0,b.jsx)("button",{onClick:()=>C(a),className:(0,aj.cn)("rounded-md px-2 py-1.5 transition-colors",B===a?"bg-blue-100 text-blue-700":"text-slate-600 hover:bg-slate-100"),title:d,"aria-label":d,children:(0,b.jsx)(c,{className:"h-4 w-4"})},a))}),(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[{id:"line",icon:y.Minus,label:"Line"},{id:"arrow",icon:N.ArrowRight,label:"Arrow"},{id:"rectangle",icon:O.RectangleHorizontal,label:"Rectangle"},{id:"circle",icon:P.Circle,label:"Circle"},{id:"triangle",icon:Q.Triangle,label:"Triangle"},{id:"connector",icon:N.ArrowRight,label:"Connector"},{id:"text",icon:L.Type,label:"Text"},{id:"laser",icon:T.Dot,label:"Laser Pointer"},{id:"select",icon:A.MousePointer2,label:"Select"},{id:"hand",icon:U.Move,label:"Pan"}].map(({id:a,icon:c,label:d})=>(0,b.jsx)("button",{onClick:()=>C(a),className:(0,aj.cn)("rounded-md px-2 py-1.5 transition-colors",B===a?"bg-indigo-100 text-indigo-700":"text-slate-600 hover:bg-slate-100"),title:d,"aria-label":d,children:(0,b.jsx)(c,{className:"h-4 w-4"})},a))}),(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[aC.map(a=>(0,b.jsx)("button",{onClick:()=>E(a),className:(0,aj.cn)("h-5 w-5 rounded-full border transition-all",D===a?"scale-110 border-slate-600":"border-transparent"),style:{backgroundColor:a},title:a},a)),(0,b.jsx)("input",{type:"color",value:F,onChange:a=>{G(a.target.value),E(a.target.value)},className:"h-5 w-7 cursor-pointer rounded border bg-transparent p-0",title:"Custom color"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Stroke"}),(0,b.jsx)(i.Slider,{value:[H],onValueChange:([a])=>I(a),min:1,max:32,step:1,className:"w-20"}),(0,b.jsx)("span",{className:"w-6 text-xs font-medium text-slate-600",children:H})]}),"text"===B&&(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Font"}),(0,b.jsx)(i.Slider,{value:[ac],onValueChange:([a])=>ad(a),min:14,max:56,step:1,className:"w-20"}),(0,b.jsx)("span",{className:"w-6 text-xs font-medium text-slate-600",children:ac})]}),"text"===B&&(0,b.jsx)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:["plain","latex","code","table","sticky"].map(a=>(0,b.jsx)(f.Button,{variant:a4===a?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs capitalize",title:`Text preset: ${a}`,"aria-label":`Text preset: ${a}`,onClick:()=>a5(a),children:a},a))}),"select"===B&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)(f.Button,{variant:"rect"===ap?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Selection mode: rectangle",onClick:()=>aq("rect"),children:"Rect"}),(0,b.jsx)(f.Button,{variant:"lasso"===ap?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Selection mode: lasso",onClick:()=>aq("lasso"),children:"Lasso"}),(0,b.jsx)(f.Button,{variant:"intersect"===ar?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select items that intersect selection area",onClick:()=>as("intersect"),children:"Intersect"}),(0,b.jsx)(f.Button,{variant:"contain"===ar?"default":"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select only items fully contained in selection area",onClick:()=>as("contain"),children:"Contain"})]}),an.size>0&&(0,b.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border bg-white p-1 shadow-sm",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection up",onClick:()=>bK(0,-10),disabled:bk,children:"Up"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection left",onClick:()=>bK(-10,0),disabled:bk,children:"Left"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection right",onClick:()=>bK(10,0),disabled:bk,children:"Right"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Nudge selection down",onClick:()=>bK(0,10),disabled:bk,children:"Down"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Scale selected items down",onClick:()=>bL(.9),disabled:bk,children:"Scale -"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Scale selected items up",onClick:()=>bL(1.1),disabled:bk,children:"Scale +"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all with same color",onClick:()=>bM("color"),disabled:bk,children:"Same Color"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all with same stroke type",onClick:()=>bM("type"),disabled:bk,children:"Same Type"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",title:"Select all in same layer",onClick:()=>bM("layer"),disabled:bk,children:"Same Layer"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{size:"sm",variant:1===aW?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>aX(1),children:"100%"}),(0,b.jsx)(f.Button,{size:"sm",variant:1.25===aW?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>aX(1.25),children:"125%"}),(0,b.jsx)(f.Button,{size:"sm",variant:1.5===aW?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>aX(1.5),children:"150%"})]}),(0,b.jsx)(f.Button,{size:"sm",variant:aY?"default":"outline",className:"h-7 px-2 text-xs",title:"Toggle snap-to-grid",onClick:()=>aZ(a=>!a),children:"Snap"}),(0,b.jsx)(f.Button,{size:"sm",variant:a$?"default":"outline",className:"h-7 px-2 text-xs",title:"Show or hide grid",onClick:()=>a_(a=>!a),children:"Grid"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border bg-white px-2 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"text-xs text-slate-500",children:"Grid"}),(0,b.jsx)(i.Slider,{value:[a0],onValueChange:([a])=>a1(a),min:8,max:64,step:2,className:"w-20"}),(0,b.jsx)("span",{className:"w-6 text-xs font-medium text-slate-600",children:a0})]}),(0,b.jsx)(f.Button,{size:"sm",variant:a2?"default":"outline",className:"h-7 px-2 text-xs",title:"Center viewport on tutor cursor",onClick:()=>a3(a=>!a),children:"Follow Tutor"}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"student-personal"===bw?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>bx("student-personal"),children:"My Layer"}),(0,b.jsx)(f.Button,{size:"sm",variant:"shared-group"===bw?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>bx("shared-group"),children:"Shared Layer"})]}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:[Math.round(100*ae.scale),"%"]}),an.size>0&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:"text-xs",children:[an.size," selected"]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:bo,disabled:bk||0===be.length||bl,children:bl?"Submitted":"Submit"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>bp(),disabled:bk,children:(0,b.jsx)(n.Undo,{className:"w-3.5 h-3.5"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:bs,disabled:bk,children:(0,b.jsx)(o.Trash2,{className:"w-3.5 h-3.5"})})]})]})}),bf.length>0&&(0,b.jsxs)("div",{className:"px-3 py-1.5 border-b bg-blue-50 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-xs text-blue-700",children:[bf.length," strokes from tutor"]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>aR(!aQ),children:aQ?"Hide":"Show"})]}),(0,b.jsx)("div",{ref:v,className:(0,aj.cn)("p-3","floating"===h?"h-64":"h-full min-h-[380px]"),children:(0,b.jsxs)("div",{className:(0,aj.cn)("relative w-full h-full overflow-hidden",aU&&"contrast-150 saturate-150"),style:{backgroundImage:bT(),backgroundSize:"chemistry-structure"===bu?"120px 80px":"geometry-grid"===bu?"24px 24px":"20px 20px"},children:[(0,b.jsx)("canvas",{ref:s,onPointerDown:a=>{if(bb.current=a.pointerType,bk||aS&&"touch"===bb.current)return;a.currentTarget.setPointerCapture(a.pointerId);let b=bU(a),c=bV(b);if("hand"===B){ah(!0),ak.current={x:a.clientX,y:a.clientY,offsetX:ae.offsetX,offsetY:ae.offsetY};return}if("select"===B){let d=bQ(c.x,c.y);if(d)return void aL(d);if(a.altKey){let a=[...be].reverse().find(a=>{let c=bD(a);return!!c&&b.x>=c.x&&b.x<=c.x+c.width&&b.y>=c.y&&b.y<=c.y+c.height});a&&ao(b=>{let c=new Set(b);return c.has(a.id)?c.delete(a.id):c.add(a.id),c});return}let e=bR(c.x,c.y);if(e&&bN){let a=bN.x+bN.width/2,c=bN.y+bN.height/2;if(aN.current=new Map(be.filter(a=>an.has(a.id)).map(a=>[a.id,a.points.map(a=>({...a}))])),"rotate"===e)aJ.current={centerX:a,centerY:c,startAngle:Math.atan2(b.y-c,b.x-a)},aI(!0);else{let d=Math.max(1,Math.hypot(b.x-a,b.y-c));aG.current={centerX:a,centerY:c,startDist:d},aF(e)}return}if(be.some(a=>{if(!an.has(a.id))return!1;let c=bD(a);return!!c&&b.x>=c.x&&b.x<=c.x+c.width&&b.y>=c.y&&b.y<=c.y+c.height})){let a=new Map;be.forEach(b=>{an.has(b.id)&&a.set(b.id,b.points.map(a=>({...a})))}),aN.current=a,aM.current=b,aw(!0)}else"lasso"===ap?(au([b]),am(null)):(am({x:c.x,y:c.y,width:0,height:0}),au(null));return}if("text"===B)return void ab({x:b.x,y:b.y,value:""});if("laser"===B){_(b),bq(b.x,b.y,"laser");return}if(bc.has(B)){K(!0),X(b),Z(b);return}bd.has(B)&&(K(!0),V([b]),bq(b.x,b.y))},onPointerMove:a=>{if(ag&&ak.current){let b=a.clientX-ak.current.x,c=a.clientY-ak.current.y;af(a=>({...a,offsetX:ak.current.offsetX+b,offsetY:ak.current.offsetY+c}));return}let b=bU(a),c=Date.now();if(c-ba.current>50&&(bq(b.x,b.y,"laser"===B?"laser":"cursor"),ba.current=c),aK)return void bt(a=>{let c=a.filter(a=>"connector"!==a.shapeType).map(a=>bD(a)).filter(a=>!!a),d=a.filter(a=>a.id!==aK.strokeId);return a.map(a=>{if(a.id!==aK.strokeId||"connector"!==a.shapeType)return a;let e=bI(b,d),f="source"===aK.endpoint?e.point:a.points[0],g="target"===aK.endpoint?e.point:a.points[a.points.length-1];return{...a,points:bF(f,g,c),sourceStrokeId:"source"===aK.endpoint?e.sourceStrokeId:a.sourceStrokeId,sourcePort:"source"===aK.endpoint?e.sourcePort:a.sourcePort,targetStrokeId:"target"===aK.endpoint?e.sourceStrokeId:a.targetStrokeId,targetPort:"target"===aK.endpoint?e.sourcePort:a.targetPort,updatedAt:Date.now()}})});if(aH&&aJ.current){let{centerX:a,centerY:c,startAngle:d}=aJ.current,e=Math.atan2(b.y-c,b.x-a)-d;bt(b=>b.map(b=>{if(!an.has(b.id))return b;let d=aN.current.get(b.id);return d?{...b,rotation:((b.rotation||0)+180*e/Math.PI)%360,updatedAt:Date.now(),points:d.map(b=>{let d=b.x-a,f=b.y-c;return{...b,x:a+d*Math.cos(e)-f*Math.sin(e),y:c+d*Math.sin(e)+f*Math.cos(e)}})}:b}));return}if(aE&&aG.current){let{centerX:a,centerY:c,startDist:d}=aG.current,e=Math.max(1,Math.hypot(b.x-a,b.y-c))/d;bt(b=>b.map(b=>{if(!an.has(b.id))return b;let d=aN.current.get(b.id);return d?{...b,points:d.map(b=>({...b,x:aY?Math.round((a+(b.x-a)*e)/a0)*a0:a+(b.x-a)*e,y:aY?Math.round((c+(b.y-c)*e)/a0)*a0:c+(b.y-c)*e}))}:b}));return}if(av&&aM.current){let a=b.x-aM.current.x,c=b.y-aM.current.y;bt(b=>b.map(b=>{if(!an.has(b.id))return b;let d=aN.current.get(b.id);return d?{...b,points:d.map(b=>({...b,x:aY?Math.round((b.x+a)/a0)*a0:b.x+a,y:aY?Math.round((b.y+c)/a0)*a0:b.y+c}))}:b}));return}if(al){let a=bV(b);am(b=>b?{...b,width:a.x-b.x,height:a.y-b.y}:b);return}if(at)return void au(a=>a?[...a,b]:a);if("laser"===B)return void _(b);if(J){if(bc.has(B))return void Z(b);V(a=>{let c=a[a.length-1];if(c){let d=b.x-c.x,e=b.y-c.y;if(d*d+e*e<.7)return a}return[...a,b]})}},onPointerUp:bX,onPointerLeave:bX,onWheel:bY,className:(0,aj.cn)("w-full h-full border rounded bg-white",bk?"cursor-not-allowed":"laser"===B?"cursor-none":"hand"===B?"cursor-grab":"select"===B?"cursor-default":"cursor-crosshair"),"aria-label":"Student whiteboard canvas"}),aa&&(0,b.jsx)("div",{className:"absolute z-30",style:{left:aa.x,top:aa.y},children:(0,b.jsxs)("div",{className:"w-72 rounded-md border border-slate-300 bg-white/95 p-2 shadow-lg",children:[(0,b.jsx)("textarea",{autoFocus:!0,value:aa.value,rows:4,onChange:a=>ab(b=>b?{...b,value:a.target.value}:b),onKeyDown:a=>{(a.metaKey||a.ctrlKey)&&"Enter"===a.key&&(a.preventDefault(),bW()),"Escape"===a.key&&(a.preventDefault(),ab(null))},placeholder:"Type here... (Cmd/Ctrl + Enter to place)",className:"w-full resize-none rounded-md border border-slate-200 bg-white p-2 text-sm outline-none ring-offset-2 focus:ring-2"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-end gap-2",children:[(0,b.jsx)(f.Button,{size:"sm",variant:"outline",onClick:()=>ab(null),children:"Cancel"}),(0,b.jsx)(f.Button,{size:"sm",onClick:bW,children:"Place"})]})]})}),bv.enabled&&(0,b.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/30"}),(0,b.jsx)("div",{className:(0,aj.cn)("absolute border-2 border-yellow-300 shadow-[0_0_0_9999px_rgba(0,0,0,0.32)]","pen"===bv.mode?"rounded-full":"rounded-md"),style:{left:bv.x,top:bv.y,width:bv.width,height:bv.height}})]}),Array.from(bi.values()).filter(a=>a.userId!==q).map(a=>(0,b.jsxs)("div",{className:"absolute pointer-events-none z-10",style:{left:a.x,top:a.y,transform:"translate(-50%, -50%)"},children:["laser"===a.pointerMode?(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-red-500/30 ring-2 ring-red-500/60 blur-[1px]"}):(0,b.jsx)("div",{className:"h-2.5 w-2.5 rounded-full border border-white shadow",style:{backgroundColor:bZ(a.userId)}}),(0,b.jsxs)("div",{className:"mt-1 whitespace-nowrap rounded px-1.5 py-0.5 text-[10px] text-white",style:{backgroundColor:bZ(a.userId)},children:[a.name," ",Date.now()-a.lastUpdated>2e3?"(idle)":""]})]},a.userId))]})})]})}var aF=a.i(508544),aG=a.i(354248),aH=a.i(529004);function aI({open:a,onOpenChange:c,share:d,viewerRole:f,canManageShare:g=!1,onVisibilityChange:h,onWriteAccessChange:i,onCollaborationPolicyChange:j,onSubmitToTutor:l,hasSubmitted:m=!1}){if(!d)return null;let n=(d.mimeType||"").includes("pdf")||d.fileUrl.toLowerCase().includes(".pdf"),o=!d.allowCollaborativeWrite&&!g,p={allowDrawing:d.collaborationPolicy?.allowDrawing??!0,allowTyping:d.collaborationPolicy?.allowTyping??!0,allowShapes:d.collaborationPolicy?.allowShapes??!0};return(0,b.jsx)(k.Dialog,{open:a,onOpenChange:c,children:(0,b.jsx)(k.DialogContent,{className:"max-h-[92vh] w-[95vw] max-w-[1300px] overflow-hidden p-0",children:(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b.jsxs)(k.DialogHeader,{className:"border-b px-5 py-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.DialogTitle,{children:d.title}),(0,b.jsxs)(e.Badge,{variant:"outline",children:["Owner: ",d.ownerName]}),(0,b.jsx)(e.Badge,{variant:d.visibleToAll?"default":"secondary",children:d.visibleToAll?"Visible to class":"Private copy"}),(0,b.jsxs)(e.Badge,{variant:"outline",children:["Submissions: ",d.submissions?.length||0]})]}),(0,b.jsx)(k.DialogDescription,{children:d.description||"Shared live document session"})]}),g&&(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 border-b px-5 py-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Switch,{checked:d.visibleToAll,onCheckedChange:h}),(0,b.jsx)(aH.Label,{children:"Visible to everyone in this live class"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Switch,{checked:d.allowCollaborativeWrite,onCheckedChange:i}),(0,b.jsx)(aH.Label,{children:"Allow others to write/type on this document"})]}),(0,b.jsxs)("div",{className:"col-span-full grid grid-cols-1 gap-3 rounded-md border bg-muted/20 px-3 py-2 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Switch,{checked:p.allowDrawing,onCheckedChange:a=>j?.({...p,allowDrawing:a}),disabled:!d.allowCollaborativeWrite}),(0,b.jsx)(aH.Label,{children:"Allow drawing"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Switch,{checked:p.allowTyping,onCheckedChange:a=>j?.({...p,allowTyping:a}),disabled:!d.allowCollaborativeWrite}),(0,b.jsx)(aH.Label,{children:"Allow typing"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aG.Switch,{checked:p.allowShapes,onCheckedChange:a=>j?.({...p,allowShapes:a}),disabled:!d.allowCollaborativeWrite}),(0,b.jsx)(aH.Label,{children:"Allow shapes"})]})]})]}),!g&&l&&(0,b.jsx)("div",{className:"border-b px-5 py-3",children:(0,b.jsx)("button",{type:"button",onClick:l,disabled:m,className:"rounded border px-3 py-1.5 text-sm hover:bg-muted disabled:opacity-60",children:m?"Submitted to Tutor":"Submit to Tutor"})}),(0,b.jsx)("div",{className:"min-h-0 flex-1 overflow-auto p-0",children:n?(0,b.jsx)(aF.PDFCollaborativeViewer,{roomId:d.pdfRoomId,role:f,initialPdfUrl:d.fileUrl,forceLocked:o,showLockControl:g,showCollabStatus:"tutor"===f,showAiActions:"tutor"===f,capabilities:{draw:g||d.allowCollaborativeWrite&&p.allowDrawing,erase:g||d.allowCollaborativeWrite&&p.allowDrawing,text:g||d.allowCollaborativeWrite&&p.allowTyping,shapes:g||d.allowCollaborativeWrite&&p.allowShapes,select:g||d.allowCollaborativeWrite,clear:g||d.allowCollaborativeWrite}}):(0,b.jsxs)("div",{className:"m-4 rounded-lg border bg-muted/20 p-4 text-sm",children:[(0,b.jsx)("p",{className:"font-medium",children:"This file is not a PDF."}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Open the source file in a new tab. PDF canvas annotation is available for PDF files."}),(0,b.jsx)("a",{href:d.fileUrl,target:"_blank",rel:"noreferrer",className:"mt-3 inline-block text-blue-600 underline",children:"Open source file"})]})})]})})})}var aJ=a.i(923266),aK=a.i(957512);function aL({sessionId:a,roomId:i,initialCourseId:j,classSubject:k,students:l,isSocketConnected:m}){let{data:n}=(0,d.useSession)(),o=n?.user?.role==="TUTOR",p=n?.user?.id,q=n?.user?.name||(o?"Tutor":"Student"),t=o?"tutor":"student",{socket:u}=(0,ag.useSimpleSocket)(i,{userId:p,name:q,role:t}),[v,w]=(0,c.useState)({}),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!1),C=(0,c.useRef)(new Set),D=(0,c.useMemo)(()=>l.filter(a=>"online"===a.status).length,[l]),E=(0,c.useCallback)(a=>{u&&u.emit("live_doc_share_update",a)},[u]),F=(0,c.useCallback)(a=>{if(!p||!a.sourceDocument)return;let b=`share-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,c={shareId:b,classRoomId:i,ownerId:p,ownerName:q,title:a.title,description:a.description,fileUrl:a.sourceDocument.fileUrl,mimeType:a.sourceDocument.mimeType,pdfRoomId:`${i}:pdf-share:${p}:${b}`,visibleToAll:!0,allowCollaborativeWrite:!0,collaborationPolicy:{allowDrawing:!0,allowTyping:!0,allowShapes:!0},active:!0,submissions:[],updatedAt:Date.now()};w(a=>({...a,[b]:c})),E(c),z(b)},[E,i,p,q]),G=(0,c.useCallback)(async a=>{if(u&&p){B(!0);try{let b=new FormData;b.append("file",a);let c=await fetch("/api/uploads/documents",{method:"POST",credentials:"include",body:b});if(!c.ok)return;let d=await c.json(),e=`share-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,f={shareId:e,classRoomId:i,ownerId:p,ownerName:q,title:a.name,description:"Student shared document",fileUrl:d.url,mimeType:a.type,pdfRoomId:`${i}:pdf-share:${p}:${e}`,visibleToAll:!0,allowCollaborativeWrite:!0,collaborationPolicy:{allowDrawing:!0,allowTyping:!0,allowShapes:!0},active:!0,updatedAt:Date.now()};E(f),z(e)}finally{B(!1)}}},[E,i,u,p,q]);(0,c.useEffect)(()=>{if(!u||!i)return;let a=a=>{a.classRoomId===i&&(w(b=>({...b,[a.shareId]:a})),a.active&&(a.visibleToAll||a.ownerId===p)&&!C.current.has(a.shareId)&&(C.current.add(a.shareId),ah.toast.info(`Live task available: ${a.title}. Open from Tasks.`)),a.active&&(a.visibleToAll||a.ownerId===p)&&z(a.shareId))},b=a=>{a.classRoomId===i&&w(b=>{let c=b[a.shareId];if(!c)return b;let d=c.submissions||[];return d.some(b=>b.userId===a.userId)?b:{...b,[a.shareId]:{...c,submissions:[...d,{userId:a.userId,userName:a.userName,submittedAt:a.submittedAt}],updatedAt:Date.now()}}})},c=a=>{if(a.classRoomId!==i)return;let b={};a.shares.forEach(a=>{b[a.shareId]=a}),w(b)};return u.on("live_doc_share_update",a),u.on("live_doc_share_state",c),u.on("live_doc_task_submitted",b),u.emit("live_doc_share_state_request",{classRoomId:i}),()=>{u.off("live_doc_share_update",a),u.off("live_doc_share_state",c),u.off("live_doc_task_submitted",b)}},[u,i,p]);let H=y&&v[y]||null,I=!!(H&&p&&H.ownerId===p),J=(0,c.useMemo)(()=>Object.values(v).filter(a=>a.active&&(a.visibleToAll||a.ownerId===p)).sort((a,b)=>b.updatedAt-a.updatedAt),[v,p]),K=(0,c.useCallback)(a=>{H&&I&&E({...H,collaborationPolicy:a})},[H,I,E]);return o?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"h-full grid grid-cols-1 xl:grid-cols-[1fr_300px] gap-4",children:[(0,b.jsx)("div",{className:"min-h-0",children:(0,b.jsx)(au,{roomId:i,sessionId:a,initialCourseId:j,classSubject:k,students:l.map(a=>({id:a.id,name:a.name})),onDocumentVisibleToStudents:F})}),(0,b.jsxs)(g.Card,{className:"min-h-0 overflow-hidden",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-3",children:[(0,b.jsxs)(g.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(aJ.Layers,{className:"w-4 h-4 text-blue-600"}),"Multi-Layer Controls"]}),(0,b.jsx)(g.CardDescription,{children:"Broadcast your board and monitor student boards in real time."})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-gray-50 border",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Socket"}),(0,b.jsx)(e.Badge,{variant:m?"default":"secondary",children:m?"Connected":"Offline"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-gray-50 border",children:[(0,b.jsxs)("span",{className:"text-gray-600 flex items-center gap-1",children:[(0,b.jsx)(r.Users,{className:"w-3 h-3"}),"Online Students"]}),(0,b.jsx)("span",{className:"font-medium",children:D})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-gray-50 border",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Total Boards"}),(0,b.jsx)("span",{className:"font-medium",children:l.length+1})]}),(0,b.jsxs)("div",{className:"pt-2 space-y-2 text-xs text-gray-600",children:[(0,b.jsxs)("p",{className:"flex items-start gap-1",children:[(0,b.jsx)(aK.Radio,{className:"w-3 h-3 mt-0.5 text-red-500"}),(0,b.jsx)("strong",{children:"Broadcast"}),": send your whiteboard to all students in real time."]}),(0,b.jsxs)("p",{className:"flex items-start gap-1",children:[(0,b.jsx)(s.Eye,{className:"w-3 h-3 mt-0.5 text-blue-500"}),(0,b.jsx)("strong",{children:"Lock Student Layers"}),": prevent students from drawing until you unlock."]}),(0,b.jsxs)("p",{className:"flex items-start gap-1",children:[(0,b.jsx)(s.Eye,{className:"w-3 h-3 mt-0.5 text-muted-foreground"}),"Switch to ",(0,b.jsx)("strong",{children:"Students"})," to review individual work quickly."]})]})]})]})]}),(0,b.jsx)(aI,{open:!!H,onOpenChange:a=>{a||z(null)},share:H,viewerRole:"tutor",canManageShare:I,onVisibilityChange:a=>{H&&I&&E({...H,visibleToAll:a,active:a})},onWriteAccessChange:a=>{H&&I&&E({...H,allowCollaborativeWrite:a})},onCollaborationPolicyChange:K})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.Card,{className:"h-full",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-3",children:[(0,b.jsxs)(g.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,b.jsx)(aJ.Layers,{className:"w-4 h-4 text-blue-600"}),"Collaborative Whiteboard"]}),(0,b.jsx)(g.CardDescription,{children:"Draw on your own layer while viewing tutor annotations in real time."}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(f.Button,{size:"sm",variant:"outline",disabled:A,asChild:!0,children:(0,b.jsxs)("label",{className:"cursor-pointer",children:[A?"Sharing...":"Share My Document",(0,b.jsx)("input",{type:"file",className:"hidden",accept:".pdf,.txt,.md,.doc,.docx,image/*",onChange:a=>{let b=a.target.files?.[0];b&&(G(b),a.currentTarget.value="")}})]})})})]}),(0,b.jsx)(g.CardContent,{className:"h-[calc(100%-84px)] p-3",children:(0,b.jsxs)(h.Tabs,{defaultValue:"student-board",className:"h-full",children:[(0,b.jsxs)(h.TabsList,{className:"mb-2",children:[(0,b.jsx)(h.TabsTrigger,{value:"student-board",children:"Whiteboard"}),(0,b.jsx)(h.TabsTrigger,{value:"student-pdf",children:"PDF Tutoring"})]}),(0,b.jsx)(h.TabsContent,{value:"student-board",className:"h-[calc(100%-40px)] m-0",children:(0,b.jsx)(aE,{roomId:i,sessionId:a,mode:"embedded",visibleTaskShares:J,onOpenTask:a=>z(a)})}),(0,b.jsx)(h.TabsContent,{value:"student-pdf",className:"h-[calc(100%-40px)] m-0 overflow-auto",children:(0,b.jsx)(aF.PDFCollaborativeViewer,{roomId:`${i}:pdf`,role:"student"})})]})})]}),(0,b.jsx)(aI,{open:!!H,onOpenChange:a=>{a||z(null)},share:H,viewerRole:t,canManageShare:I,onVisibilityChange:a=>{H&&I&&E({...H,visibleToAll:a,active:a})},onWriteAccessChange:a=>{H&&I&&E({...H,allowCollaborativeWrite:a})},onCollaborationPolicyChange:K,onSubmitToTutor:()=>{u&&H&&p&&u.emit("live_doc_task_submit",{classRoomId:i,shareId:H.shareId,userId:p,userName:q})},hasSubmitted:!!H?.submissions?.some(a=>a.userId===p)})]})}a.s(["MultiLayerWhiteboardInterface",()=>aL],254454)},110857,(a,b,c)=>{var d,e,f,g="__lodash_hash_undefined__",h="[object Arguments]",i="[object Array]",j="[object Boolean]",k="[object Date]",l="[object Error]",m="[object Function]",n="[object Map]",o="[object Number]",p="[object Object]",q="[object Promise]",r="[object RegExp]",s="[object Set]",t="[object String]",u="[object WeakMap]",v="[object ArrayBuffer]",w="[object DataView]",y=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[h]=A[i]=A[v]=A[j]=A[w]=A[k]=A[l]=A[m]=A[n]=A[o]=A[p]=A[r]=A[s]=A[t]=A[u]=!1;var B=a.g&&a.g.Object===Object&&a.g,C="object"==typeof self&&self&&self.Object===Object&&self,D=B||C||Function("return this")(),E=c&&!c.nodeType&&c,F=E&&b&&!b.nodeType&&b,G=F&&F.exports===E,H=G&&B.process,I=function(){try{return H&&H.binding&&H.binding("util")}catch(a){}}(),J=I&&I.isTypedArray;function K(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function L(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var M=Array.prototype,N=Function.prototype,O=Object.prototype,P=D["__core-js_shared__"],Q=N.toString,R=O.hasOwnProperty,S=(d=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",T=O.toString,U=RegExp("^"+Q.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=G?D.Buffer:void 0,W=D.Symbol,X=D.Uint8Array,Y=O.propertyIsEnumerable,Z=M.splice,$=W?W.toStringTag:void 0,_=Object.getOwnPropertySymbols,aa=V?V.isBuffer:void 0,ab=(e=Object.keys,f=Object,function(a){return e(f(a))}),ac=aA(D,"DataView"),ad=aA(D,"Map"),ae=aA(D,"Promise"),af=aA(D,"Set"),ag=aA(D,"WeakMap"),ah=aA(Object,"create"),ai=aD(ac),aj=aD(ad),ak=aD(ae),al=aD(af),am=aD(ag),an=W?W.prototype:void 0,ao=an?an.valueOf:void 0;function ap(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function aq(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function ar(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function as(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new ar;++b<c;)this.add(a[b])}function at(a){var b=this.__data__=new aq(a);this.size=b.size}function au(a,b){for(var c=a.length;c--;)if(aE(a[c][0],b))return c;return -1}function av(a){var b;return null==a?void 0===a?"[object Undefined]":"[object Null]":$&&$ in Object(a)?function(a){var b=R.call(a,$),c=a[$];try{a[$]=void 0;var d=!0}catch(a){}var e=T.call(a);return d&&(b?a[$]=c:delete a[$]),e}(a):(b=a,T.call(b))}function aw(a){return aL(a)&&av(a)==h}function ax(a,b,c,d,e,f){var g=1&c,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var k=-1,l=!0,m=2&c?new as:void 0;for(f.set(a,b),f.set(b,a);++k<h;){var n=a[k],o=b[k];if(d)var p=g?d(o,n,k,b,a,f):d(n,o,k,a,b,f);if(void 0!==p){if(p)continue;l=!1;break}if(m){if(!function(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}(b,function(a,b){if(!m.has(b)&&(n===a||e(n,a,c,d,f)))return m.push(b)})){l=!1;break}}else if(!(n===o||e(n,o,c,d,f))){l=!1;break}}return f.delete(a),f.delete(b),l}function ay(a){var b;return b=aN(a),aG(a)?b:function(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}(b,aB(a))}function az(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function aA(a,b){var c,d=null==a?void 0:a[b];return!(!aK(d)||(c=d,S&&S in c))&&(aI(d)?U:y).test(aD(d))?d:void 0}ap.prototype.clear=function(){this.__data__=ah?ah(null):{},this.size=0},ap.prototype.delete=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=!!b,b},ap.prototype.get=function(a){var b=this.__data__;if(ah){var c=b[a];return c===g?void 0:c}return R.call(b,a)?b[a]:void 0},ap.prototype.has=function(a){var b=this.__data__;return ah?void 0!==b[a]:R.call(b,a)},ap.prototype.set=function(a,b){var c=this.__data__;return this.size+=+!this.has(a),c[a]=ah&&void 0===b?g:b,this},aq.prototype.clear=function(){this.__data__=[],this.size=0},aq.prototype.delete=function(a){var b=this.__data__,c=au(b,a);return!(c<0)&&(c==b.length-1?b.pop():Z.call(b,c,1),--this.size,!0)},aq.prototype.get=function(a){var b=this.__data__,c=au(b,a);return c<0?void 0:b[c][1]},aq.prototype.has=function(a){return au(this.__data__,a)>-1},aq.prototype.set=function(a,b){var c=this.__data__,d=au(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this},ar.prototype.clear=function(){this.size=0,this.__data__={hash:new ap,map:new(ad||aq),string:new ap}},ar.prototype.delete=function(a){var b=az(this,a).delete(a);return this.size-=!!b,b},ar.prototype.get=function(a){return az(this,a).get(a)},ar.prototype.has=function(a){return az(this,a).has(a)},ar.prototype.set=function(a,b){var c=az(this,a),d=c.size;return c.set(a,b),this.size+=+(c.size!=d),this},as.prototype.add=as.prototype.push=function(a){return this.__data__.set(a,g),this},as.prototype.has=function(a){return this.__data__.has(a)},at.prototype.clear=function(){this.__data__=new aq,this.size=0},at.prototype.delete=function(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c},at.prototype.get=function(a){return this.__data__.get(a)},at.prototype.has=function(a){return this.__data__.has(a)},at.prototype.set=function(a,b){var c=this.__data__;if(c instanceof aq){var d=c.__data__;if(!ad||d.length<199)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new ar(d)}return c.set(a,b),this.size=c.size,this};var aB=_?function(a){return null==a?[]:function(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}(_(a=Object(a)),function(b){return Y.call(a,b)})}:function(){return[]},aC=av;function aD(a){if(null!=a){try{return Q.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function aE(a,b){return a===b||a!=a&&b!=b}(ac&&aC(new ac(new ArrayBuffer(1)))!=w||ad&&aC(new ad)!=n||ae&&aC(ae.resolve())!=q||af&&aC(new af)!=s||ag&&aC(new ag)!=u)&&(aC=function(a){var b=av(a),c=b==p?a.constructor:void 0,d=c?aD(c):"";if(d)switch(d){case ai:return w;case aj:return n;case ak:return q;case al:return s;case am:return u}return b});var aF=aw(function(){return arguments}())?aw:function(a){return aL(a)&&R.call(a,"callee")&&!Y.call(a,"callee")},aG=Array.isArray,aH=aa||function(){return!1};function aI(a){if(!aK(a))return!1;var b=av(a);return b==m||"[object GeneratorFunction]"==b||"[object AsyncFunction]"==b||"[object Proxy]"==b}function aJ(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=0x1fffffffffffff}function aK(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function aL(a){return null!=a&&"object"==typeof a}var aM=J?function(a){return J(a)}:function(a){return aL(a)&&aJ(a.length)&&!!A[av(a)]};function aN(a){return null!=a&&aJ(a.length)&&!aI(a)?function(a,b){var c,d,e=aG(a),f=!e&&aF(a),g=!e&&!f&&aH(a),h=!e&&!f&&!g&&aM(a),i=e||f||g||h,j=i?function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}(a.length,String):[],k=j.length;for(var l in a){R.call(a,l)&&!(i&&("length"==l||g&&("offset"==l||"parent"==l)||h&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||(c=l,(d=null==(d=k)?0x1fffffffffffff:d)&&("number"==typeof c||z.test(c))&&c>-1&&c%1==0&&c<d)))&&j.push(l)}return j}(a):function(a){if(c=(b=a)&&b.constructor,b!==("function"==typeof c&&c.prototype||O))return ab(a);var b,c,d=[];for(var e in Object(a))R.call(a,e)&&"constructor"!=e&&d.push(e);return d}(a)}b.exports=function(a,b){return function a(b,c,d,e,f){return b===c||(null!=b&&null!=c&&(aL(b)||aL(c))?function(a,b,c,d,e,f){var g=aG(a),m=aG(b),q=g?i:aC(a),u=m?i:aC(b);q=q==h?p:q,u=u==h?p:u;var y=q==p,z=u==p,A=q==u;if(A&&aH(a)){if(!aH(b))return!1;g=!0,y=!1}if(A&&!y)return f||(f=new at),g||aM(a)?ax(a,b,c,d,e,f):function(a,b,c,d,e,f,g){switch(c){case w:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer,b=b.buffer;case v:if(a.byteLength!=b.byteLength||!f(new X(a),new X(b)))break;return!0;case j:case k:case o:return aE(+a,+b);case l:return a.name==b.name&&a.message==b.message;case r:case t:return a==b+"";case n:var h=K;case s:var i=1&d;if(h||(h=L),a.size!=b.size&&!i)break;var m=g.get(a);if(m)return m==b;d|=2,g.set(a,b);var p=ax(h(a),h(b),d,e,f,g);return g.delete(a),p;case"[object Symbol]":if(ao)return ao.call(a)==ao.call(b)}return!1}(a,b,q,c,d,e,f);if(!(1&c)){var B=y&&R.call(a,"__wrapped__"),C=z&&R.call(b,"__wrapped__");if(B||C){var D=B?a.value():a,E=C?b.value():b;return f||(f=new at),e(D,E,c,d,f)}}return!!A&&(f||(f=new at),function(a,b,c,d,e,f){var g=1&c,h=ay(a),i=h.length;if(i!=ay(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:R.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){var o=a[k=h[j]],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(void 0===q?o===p||e(o,p,c,d,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}(a,b,c,d,e,f))}(b,c,d,e,a,f):b!=b&&c!=c)}(a,b)}},826882,(a,b,c)=>{var d,e,f,g="__lodash_hash_undefined__",h="[object Arguments]",i="[object Array]",j="[object Boolean]",k="[object Date]",l="[object Error]",m="[object Function]",n="[object Map]",o="[object Number]",p="[object Object]",q="[object Promise]",r="[object RegExp]",s="[object Set]",t="[object String]",u="[object WeakMap]",v="[object ArrayBuffer]",w="[object DataView]",y=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[h]=A[i]=A[v]=A[j]=A[w]=A[k]=A[l]=A[m]=A[n]=A[o]=A[p]=A[r]=A[s]=A[t]=A[u]=!1;var B=a.g&&a.g.Object===Object&&a.g,C="object"==typeof self&&self&&self.Object===Object&&self,D=B||C||Function("return this")(),E=c&&!c.nodeType&&c,F=E&&b&&!b.nodeType&&b,G=F&&F.exports===E&&B.process,H=function(){try{return G&&G.binding("util")}catch(a){}}(),I=H&&H.isTypedArray;function J(a){var b=!1;if(null!=a&&"function"!=typeof a.toString)try{b=!!(a+"")}catch(a){}return b}function K(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function L(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var M=Array.prototype,N=Function.prototype,O=Object.prototype,P=D["__core-js_shared__"],Q=(d=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",R=N.toString,S=O.hasOwnProperty,T=O.toString,U=RegExp("^"+R.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=D.Symbol,W=D.Uint8Array,X=O.propertyIsEnumerable,Y=M.splice,Z=(e=Object.keys,f=Object,function(a){return e(f(a))}),$=at(D,"DataView"),_=at(D,"Map"),aa=at(D,"Promise"),ab=at(D,"Set"),ac=at(D,"WeakMap"),ad=at(Object,"create"),ae=av($),af=av(_),ag=av(aa),ah=av(ab),ai=av(ac),aj=V?V.prototype:void 0,ak=aj?aj.valueOf:void 0;function al(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function am(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function an(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function ao(a){var b=-1,c=a?a.length:0;for(this.__data__=new an;++b<c;)this.add(a[b])}function ap(a){this.__data__=new am(a)}function aq(a,b){for(var c=a.length;c--;)if(aw(a[c][0],b))return c;return -1}function ar(a,b,c,d,e,f){var g=2&e,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var k=-1,l=!0,m=1&e?new ao:void 0;for(f.set(a,b),f.set(b,a);++k<h;){var n=a[k],o=b[k];if(d)var p=g?d(o,n,k,b,a,f):d(n,o,k,a,b,f);if(void 0!==p){if(p)continue;l=!1;break}if(m){if(!function(a,b){for(var c=-1,d=a?a.length:0;++c<d;)if(b(a[c],c,a))return!0;return!1}(b,function(a,b){if(!m.has(b)&&(n===a||c(n,a,d,e,f)))return m.add(b)})){l=!1;break}}else if(!(n===o||c(n,o,d,e,f))){l=!1;break}}return f.delete(a),f.delete(b),l}function as(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function at(a,b){var c,d=null==a?void 0:a[b];return!(!aB(d)||(c=d,Q&&Q in c))&&(az(d)||J(d)?U:y).test(av(d))?d:void 0}al.prototype.clear=function(){this.__data__=ad?ad(null):{}},al.prototype.delete=function(a){return this.has(a)&&delete this.__data__[a]},al.prototype.get=function(a){var b=this.__data__;if(ad){var c=b[a];return c===g?void 0:c}return S.call(b,a)?b[a]:void 0},al.prototype.has=function(a){var b=this.__data__;return ad?void 0!==b[a]:S.call(b,a)},al.prototype.set=function(a,b){return this.__data__[a]=ad&&void 0===b?g:b,this},am.prototype.clear=function(){this.__data__=[]},am.prototype.delete=function(a){var b=this.__data__,c=aq(b,a);return!(c<0)&&(c==b.length-1?b.pop():Y.call(b,c,1),!0)},am.prototype.get=function(a){var b=this.__data__,c=aq(b,a);return c<0?void 0:b[c][1]},am.prototype.has=function(a){return aq(this.__data__,a)>-1},am.prototype.set=function(a,b){var c=this.__data__,d=aq(c,a);return d<0?c.push([a,b]):c[d][1]=b,this},an.prototype.clear=function(){this.__data__={hash:new al,map:new(_||am),string:new al}},an.prototype.delete=function(a){return as(this,a).delete(a)},an.prototype.get=function(a){return as(this,a).get(a)},an.prototype.has=function(a){return as(this,a).has(a)},an.prototype.set=function(a,b){return as(this,a).set(a,b),this},ao.prototype.add=ao.prototype.push=function(a){return this.__data__.set(a,g),this},ao.prototype.has=function(a){return this.__data__.has(a)},ap.prototype.clear=function(){this.__data__=new am},ap.prototype.delete=function(a){return this.__data__.delete(a)},ap.prototype.get=function(a){return this.__data__.get(a)},ap.prototype.has=function(a){return this.__data__.has(a)},ap.prototype.set=function(a,b){var c=this.__data__;if(c instanceof am){var d=c.__data__;if(!_||d.length<199)return d.push([a,b]),this;c=this.__data__=new an(d)}return c.set(a,b),this};var au=function(a){return T.call(a)};function av(a){if(null!=a){try{return R.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function aw(a,b){return a===b||a!=a&&b!=b}($&&au(new $(new ArrayBuffer(1)))!=w||_&&au(new _)!=n||aa&&au(aa.resolve())!=q||ab&&au(new ab)!=s||ac&&au(new ac)!=u)&&(au=function(a){var b=T.call(a),c=b==p?a.constructor:void 0,d=c?av(c):void 0;if(d)switch(d){case ae:return w;case af:return n;case ag:return q;case ah:return s;case ai:return u}return b});var ax=Array.isArray;function ay(a){return null!=a&&aA(a.length)&&!az(a)}function az(a){var b=aB(a)?T.call(a):"";return b==m||"[object GeneratorFunction]"==b}function aA(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=0x1fffffffffffff}function aB(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function aC(a){return!!a&&"object"==typeof a}var aD=I?function(a){return I(a)}:function(a){return aC(a)&&aA(a.length)&&!!A[T.call(a)]};function aE(a){return ay(a)?function(a,b){var c,d,e,f,g=ax(a)||aC(d=c=a)&&ay(d)&&S.call(c,"callee")&&(!X.call(c,"callee")||T.call(c)==h)?function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}(a.length,String):[],i=g.length,j=!!i;for(var k in a){S.call(a,k)&&!(j&&("length"==k||(e=k,(f=null==(f=i)?0x1fffffffffffff:f)&&("number"==typeof e||z.test(e))&&e>-1&&e%1==0&&e<f)))&&g.push(k)}return g}(a):function(a){if(c=(b=a)&&b.constructor,b!==("function"==typeof c&&c.prototype||O))return Z(a);var b,c,d=[];for(var e in Object(a))S.call(a,e)&&"constructor"!=e&&d.push(e);return d}(a)}b.exports=function(a,b,c){var d=(c="function"==typeof c?c:void 0)?c(a,b):void 0;return void 0===d?function a(b,c,d,e,f){return b===c||(null!=b&&null!=c&&(aB(b)||aC(c))?function(a,b,c,d,e,f){var g=ax(a),m=ax(b),q=i,u=i;g||(q=(q=au(a))==h?p:q),m||(u=(u=au(b))==h?p:u);var y=q==p&&!J(a),z=u==p&&!J(b),A=q==u;if(A&&!y)return f||(f=new ap),g||aD(a)?ar(a,b,c,d,e,f):function(a,b,c,d,e,f,g){switch(c){case w:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer,b=b.buffer;case v:if(a.byteLength!=b.byteLength||!d(new W(a),new W(b)))break;return!0;case j:case k:case o:return aw(+a,+b);case l:return a.name==b.name&&a.message==b.message;case r:case t:return a==b+"";case n:var h=K;case s:var i=2&f;if(h||(h=L),a.size!=b.size&&!i)break;var m=g.get(a);if(m)return m==b;f|=1,g.set(a,b);var p=ar(h(a),h(b),d,e,f,g);return g.delete(a),p;case"[object Symbol]":if(ak)return ak.call(a)==ak.call(b)}return!1}(a,b,q,c,d,e,f);if(!(2&e)){var B=y&&S.call(a,"__wrapped__"),C=z&&S.call(b,"__wrapped__");if(B||C){var D=B?a.value():a,E=C?b.value():b;return f||(f=new ap),c(D,E,d,e,f)}}return!!A&&(f||(f=new ap),function(a,b,c,d,e,f){var g=2&e,h=aE(a),i=h.length;if(i!=aE(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:S.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){var o=a[k=h[j]],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(void 0===q?o===p||c(o,p,d,e,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}(a,b,c,d,e,f))}(b,c,a,d,e,f):b!=b&&c!=c)}(a,b,c):!!d}},715732,(a,b,c)=>{var d="Expected a function",e=0/0,f=/^\s+|\s+$/g,g=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,i=/^0o[0-7]+$/i,j=parseInt,k=a.g&&a.g.Object===Object&&a.g,l="object"==typeof self&&self&&self.Object===Object&&self,m=k||l||Function("return this")(),n=Object.prototype.toString,o=Math.max,p=Math.min,q=function(){return m.Date.now()};function r(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function s(a){if("number"==typeof a)return a;if("symbol"==typeof(b=a)||b&&"object"==typeof b&&"[object Symbol]"==n.call(b))return e;if(r(a)){var b,c="function"==typeof a.valueOf?a.valueOf():a;a=r(c)?c+"":c}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(f,"");var d=h.test(a);return d||i.test(a)?j(a.slice(2),d?2:8):g.test(a)?e:+a}b.exports=function(a,b,c){var e=!0,f=!0;if("function"!=typeof a)throw TypeError(d);return r(c)&&(e="leading"in c?!!c.leading:e,f="trailing"in c?!!c.trailing:f),function(a,b,c){var e,f,g,h,i,j,k=0,l=!1,m=!1,n=!0;if("function"!=typeof a)throw TypeError(d);function t(b){var c=e,d=f;return e=f=void 0,k=b,h=a.apply(d,c)}function u(a){var c=a-j,d=a-k;return void 0===j||c>=b||c<0||m&&d>=g}function v(){var a,c,d,e=q();if(u(e))return w(e);i=setTimeout(v,(a=e-j,c=e-k,d=b-a,m?p(d,g-c):d))}function w(a){return(i=void 0,n&&e)?t(a):(e=f=void 0,h)}function y(){var a,c=q(),d=u(c);if(e=arguments,f=this,j=c,d){if(void 0===i)return k=a=j,i=setTimeout(v,b),l?t(a):h;if(m)return i=setTimeout(v,b),t(j)}return void 0===i&&(i=setTimeout(v,b)),h}return b=s(b)||0,r(c)&&(l=!!c.leading,g=(m="maxWait"in c)?o(s(c.maxWait)||0,b):g,n="trailing"in c?!!c.trailing:n),y.cancel=function(){void 0!==i&&clearTimeout(i),k=0,e=j=f=i=void 0},y.flush=function(){return void 0===i?h:w(q())},y}(a,b,{leading:e,maxWait:b,trailing:f})}},500872,(a,b,c)=>{var d,e="__lodash_hash_undefined__",f=/^\[object .+?Constructor\]$/,g=a.g&&a.g.Object===Object&&a.g,h="object"==typeof self&&self&&self.Object===Object&&self,i=g||h||Function("return this")();function j(a,b){return!!(a?a.length:0)&&function(a,b,c){if(b!=b){for(var d=k,e=a.length,f=-1;++f<e;)if(d(a[f],f,a))return f;return -1}for(var g=-1,h=a.length;++g<h;)if(a[g]===b)return g;return -1}(a,b,0)>-1}function k(a){return a!=a}function l(a,b){return a.has(b)}function m(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}var n=Array.prototype,o=Function.prototype,p=Object.prototype,q=i["__core-js_shared__"],r=(d=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"",s=o.toString,t=p.hasOwnProperty,u=p.toString,v=RegExp("^"+s.call(t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=n.splice,y=I(i,"Map"),z=I(i,"Set"),A=I(Object,"create");function B(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function C(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function D(a){var b=-1,c=a?a.length:0;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function E(a){var b=-1,c=a?a.length:0;for(this.__data__=new D;++b<c;)this.add(a[b])}function F(a,b){for(var c,d,e=a.length;e--;){if(c=a[e][0],c===(d=b)||c!=c&&d!=d)return e}return -1}B.prototype.clear=function(){this.__data__=A?A(null):{}},B.prototype.delete=function(a){return this.has(a)&&delete this.__data__[a]},B.prototype.get=function(a){var b=this.__data__;if(A){var c=b[a];return c===e?void 0:c}return t.call(b,a)?b[a]:void 0},B.prototype.has=function(a){var b=this.__data__;return A?void 0!==b[a]:t.call(b,a)},B.prototype.set=function(a,b){return this.__data__[a]=A&&void 0===b?e:b,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(a){var b=this.__data__,c=F(b,a);return!(c<0)&&(c==b.length-1?b.pop():w.call(b,c,1),!0)},C.prototype.get=function(a){var b=this.__data__,c=F(b,a);return c<0?void 0:b[c][1]},C.prototype.has=function(a){return F(this.__data__,a)>-1},C.prototype.set=function(a,b){var c=this.__data__,d=F(c,a);return d<0?c.push([a,b]):c[d][1]=b,this},D.prototype.clear=function(){this.__data__={hash:new B,map:new(y||C),string:new B}},D.prototype.delete=function(a){return H(this,a).delete(a)},D.prototype.get=function(a){return H(this,a).get(a)},D.prototype.has=function(a){return H(this,a).has(a)},D.prototype.set=function(a,b){return H(this,a).set(a,b),this},E.prototype.add=E.prototype.push=function(a){return this.__data__.set(a,e),this},E.prototype.has=function(a){return this.__data__.has(a)};var G=z&&1/m(new z([,-0]))[1]==1/0?function(a){return new z(a)}:function(){};function H(a,b){var c,d,e=a.__data__;return("string"==(d=typeof(c=b))||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==c:null===c)?e["string"==typeof b?"string":"hash"]:e.map}function I(a,b){var c,d,e,g=null==a?void 0:a[b];return!(!J(g)||(c=g,r&&r in c))&&("[object Function]"==(e=J(d=g)?u.call(d):"")||"[object GeneratorFunction]"==e||function(a){var b=!1;if(null!=a&&"function"!=typeof a.toString)try{b=!!(a+"")}catch(a){}return b}(g)?v:f).test(function(a){if(null!=a){try{return s.call(a)}catch(a){}try{return a+""}catch(a){}}return""}(g))?g:void 0}function J(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=function(a){return a&&a.length?function(a,b,c){var d=-1,e=j,f=a.length,g=!0,h=[],i=h;if(f>=200){var k=G(a);if(k)return m(k);g=!1,e=l,i=new E}else i=h;a:for(;++d<f;){var n=a[d],o=n;if(n=0!==n?n:0,g&&o==o){for(var p=i.length;p--;)if(i[p]===o)continue a;h.push(n)}else e(i,o,void 0)||(i!==h&&i.push(o),h.push(n))}return h}(a):[]}},518850,(a,b,c)=>{!function(){"use strict";var c={}.hasOwnProperty;function d(){for(var a="",b=0;b<arguments.length;b++){var f=arguments[b];f&&(a=e(a,function(a){if("string"==typeof a||"number"==typeof a)return a;if("object"!=typeof a)return"";if(Array.isArray(a))return d.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var b="";for(var f in a)c.call(a,f)&&a[f]&&(b=e(b,f));return b}(f)))}return a}function e(a,b){return b?a?a+" "+b:a+b:a}if(b.exports)d.default=d,b.exports=d;else if("function"==typeof define&&"object"==typeof define.amd&&define.amd)void 0!==d&&a.v(d);else window.classNames=d}()},875096,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e="~";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(a,b,c,d,f){if("function"!=typeof c)throw TypeError("The listener must be a function");var h=new g(c,d||a,f),i=e?e+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],h]:a._events[i].push(h):(a._events[i]=h,a._eventsCount++),a}function i(a,b){0==--a._eventsCount?a._events=new f:delete a._events[b]}function j(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1)),j.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)d.call(a,b)&&c.push(e?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},j.prototype.listeners=function(a){var b=e?e+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,f=c.length,g=Array(f);d<f;d++)g[d]=c[d].fn;return g},j.prototype.listenerCount=function(a){var b=e?e+a:a,c=this._events[b];return c?c.fn?1:c.length:0},j.prototype.emit=function(a,b,c,d,f,g){var h=e?e+a:a;if(!this._events[h])return!1;var i,j,k=this._events[h],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,f),!0;case 6:return k.fn.call(k.context,b,c,d,f,g),!0}for(j=1,i=Array(l-1);j<l;j++)i[j-1]=arguments[j];k.fn.apply(k.context,i)}else{var m,n=k.length;for(j=0;j<n;j++)switch(k[j].once&&this.removeListener(a,k[j].fn,void 0,!0),l){case 1:k[j].fn.call(k[j].context);break;case 2:k[j].fn.call(k[j].context,b);break;case 3:k[j].fn.call(k[j].context,b,c);break;case 4:k[j].fn.call(k[j].context,b,c,d);break;default:if(!i)for(m=1,i=Array(l-1);m<l;m++)i[m-1]=arguments[m];k[j].fn.apply(k[j].context,i)}}return!0},j.prototype.on=function(a,b,c){return h(this,a,b,c,!1)},j.prototype.once=function(a,b,c){return h(this,a,b,c,!0)},j.prototype.removeListener=function(a,b,c,d){var f=e?e+a:a;if(!this._events[f])return this;if(!b)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||i(this,f);else{for(var h=0,j=[],k=g.length;h<k;h++)(g[h].fn!==b||d&&!g[h].once||c&&g[h].context!==c)&&j.push(g[h]);j.length?this._events[f]=1===j.length?j[0]:j:i(this,f)}return this},j.prototype.removeAllListeners=function(a){var b;return a?(b=e?e+a:a,this._events[b]&&i(this,b)):(this._events=new f,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=e,j.EventEmitter=j,b.exports=j},312221,(a,b,c)=>{"use strict";function d(a,b){var c=a.length;for(a.push(b);0<c;){var d=c-1>>>1,e=a[d];if(0<g(e,b))a[d]=b,a[c]=e,c=d;else break}}function e(a){return 0===a.length?null:a[0]}function f(a){if(0===a.length)return null;var b=a[0],c=a.pop();if(c!==b){a[0]=c;for(var d=0,e=a.length,f=e>>>1;d<f;){var h=2*(d+1)-1,i=a[h],j=h+1,k=a[j];if(0>g(i,c))j<e&&0>g(k,i)?(a[d]=k,a[j]=c,d=j):(a[d]=i,a[h]=c,d=h);else if(j<e&&0>g(k,c))a[d]=k,a[j]=c,d=j;else break}}return b}function g(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}if(c.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var h,i=performance;c.unstable_now=function(){return i.now()}}else{var j=Date,k=j.now();c.unstable_now=function(){return j.now()-k}}var l=[],m=[],n=1,o=null,p=3,q=!1,r=!1,s=!1,t=!1,u="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,w="u">typeof setImmediate?setImmediate:null;function y(a){for(var b=e(m);null!==b;){if(null===b.callback)f(m);else if(b.startTime<=a)f(m),b.sortIndex=b.expirationTime,d(l,b);else break;b=e(m)}}function z(a){if(s=!1,y(a),!r)if(null!==e(l))r=!0,A||(A=!0,h());else{var b=e(m);null!==b&&I(z,b.startTime-a)}}var A=!1,B=-1,C=5,D=-1;function E(){return!!t||!(c.unstable_now()-D<C)}function F(){if(t=!1,A){var a=c.unstable_now();D=a;var b=!0;try{b:{r=!1,s&&(s=!1,v(B),B=-1),q=!0;var d=p;try{c:{for(y(a),o=e(l);null!==o&&!(o.expirationTime>a&&E());){var g=o.callback;if("function"==typeof g){o.callback=null,p=o.priorityLevel;var i=g(o.expirationTime<=a);if(a=c.unstable_now(),"function"==typeof i){o.callback=i,y(a),b=!0;break c}o===e(l)&&f(l),y(a)}else f(l);o=e(l)}if(null!==o)b=!0;else{var j=e(m);null!==j&&I(z,j.startTime-a),b=!1}}break b}finally{o=null,p=d,q=!1}}}finally{b?h():A=!1}}}if("function"==typeof w)h=function(){w(F)};else if("u">typeof MessageChannel){var G=new MessageChannel,H=G.port2;G.port1.onmessage=F,h=function(){H.postMessage(null)}}else h=function(){u(F,0)};function I(a,b){B=u(function(){a(c.unstable_now())},b)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(a){a.callback=null},c.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<a?Math.floor(1e3/a):5},c.unstable_getCurrentPriorityLevel=function(){return p},c.unstable_next=function(a){switch(p){case 1:case 2:case 3:var b=3;break;default:b=p}var c=p;p=b;try{return a()}finally{p=c}},c.unstable_requestPaint=function(){t=!0},c.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=p;p=a;try{return b()}finally{p=c}},c.unstable_scheduleCallback=function(a,b,f){var g=c.unstable_now();switch(f="object"==typeof f&&null!==f&&"number"==typeof(f=f.delay)&&0<f?g+f:g,a){case 1:var i=-1;break;case 2:i=250;break;case 5:i=0x3fffffff;break;case 4:i=1e4;break;default:i=5e3}return i=f+i,a={id:n++,callback:b,priorityLevel:a,startTime:f,expirationTime:i,sortIndex:-1},f>g?(a.sortIndex=f,d(m,a),null===e(l)&&a===e(m)&&(s?(v(B),B=-1):s=!0,I(z,f-g))):(a.sortIndex=i,d(l,a),r||q||(r=!0,A||(A=!0,h()))),a},c.unstable_shouldYield=E,c.unstable_wrapCallback=function(a){var b=p;return function(){var c=p;p=b;try{return a.apply(this,arguments)}finally{p=c}}}},497156,(a,b,c)=>{"use strict";b.exports=a.r(312221)},14957,(a,b,c)=>{"use strict";var d=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),j=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),n=Symbol.for("react.lazy"),o=Symbol.for("react.activity"),p=Symbol.for("react.view_transition"),q=Symbol.iterator,r={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},s=Object.assign,t={};function u(a,b,c){this.props=a,this.context=b,this.refs=t,this.updater=c||r}function v(){}function w(a,b,c){this.props=a,this.context=b,this.refs=t,this.updater=c||r}u.prototype.isReactComponent={},u.prototype.setState=function(a,b){if("object"!=typeof a&&"function"!=typeof a&&null!=a)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,b,"setState")},u.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},v.prototype=u.prototype;var y=w.prototype=new v;y.constructor=w,s(y,u.prototype),y.isPureReactComponent=!0;var z=Array.isArray;function A(){}var B={H:null,A:null,T:null,S:null},C=Object.prototype.hasOwnProperty;function D(a,b,c){var e=c.ref;return{$$typeof:d,type:a,key:b,ref:void 0!==e?e:null,props:c}}function E(a){return"object"==typeof a&&null!==a&&a.$$typeof===d}var F=/\/+/g;function G(a,b){var c,d;return"object"==typeof a&&null!==a&&null!=a.key?(c=""+a.key,d={"=":"=0",":":"=2"},"$"+c.replace(/[=:]/g,function(a){return d[a]})):b.toString(36)}function H(a,b,c){if(null==a)return a;var f=[],g=0;return!function a(b,c,f,g,h){var i,j,k,l=typeof b;("undefined"===l||"boolean"===l)&&(b=null);var m=!1;if(null===b)m=!0;else switch(l){case"bigint":case"string":case"number":m=!0;break;case"object":switch(b.$$typeof){case d:case e:m=!0;break;case n:return a((m=b._init)(b._payload),c,f,g,h)}}if(m)return h=h(b),m=""===g?"."+G(b,0):g,z(h)?(f="",null!=m&&(f=m.replace(F,"$&/")+"/"),a(h,c,f,"",function(a){return a})):null!=h&&(E(h)&&(i=h,j=f+(null==h.key||b&&b.key===h.key?"":(""+h.key).replace(F,"$&/")+"/")+m,h=D(i.type,j,i.props)),c.push(h)),1;m=0;var o=""===g?".":g+":";if(z(b))for(var p=0;p<b.length;p++)l=o+G(g=b[p],p),m+=a(g,c,f,l,h);else if("function"==typeof(p=null===(k=b)||"object"!=typeof k?null:"function"==typeof(k=q&&k[q]||k["@@iterator"])?k:null))for(b=p.call(b),p=0;!(g=b.next()).done;)l=o+G(g=g.value,p++),m+=a(g,c,f,l,h);else if("object"===l){if("function"==typeof b.then)return a(function(a){switch(a.status){case"fulfilled":return a.value;case"rejected":throw a.reason;default:switch("string"==typeof a.status?a.then(A,A):(a.status="pending",a.then(function(b){"pending"===a.status&&(a.status="fulfilled",a.value=b)},function(b){"pending"===a.status&&(a.status="rejected",a.reason=b)})),a.status){case"fulfilled":return a.value;case"rejected":throw a.reason}}throw a}(b),c,f,g,h);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(c=String(b))?"object with keys {"+Object.keys(b).join(", ")+"}":c)+"). If you meant to render a collection of children, use an array instead.")}return m}(a,f,"","",function(a){return b.call(c,a,g++)}),f}function I(a){if(-1===a._status){var b=a._result;(b=b()).then(function(b){(0===a._status||-1===a._status)&&(a._status=1,a._result=b)},function(b){(0===a._status||-1===a._status)&&(a._status=2,a._result=b)}),-1===a._status&&(a._status=0,a._result=b)}if(1===a._status)return a._result.default;throw a._result}var J="function"==typeof reportError?reportError:function(a){"object"==typeof process&&"function"==typeof process.emit?process.emit("uncaughtException",a):console.error(a)};function K(a){var b=B.T,c={};c.types=null!==b?b.types:null,B.T=c;try{var d=a(),e=B.S;null!==e&&e(c,d),"object"==typeof d&&null!==d&&"function"==typeof d.then&&d.then(A,J)}catch(a){J(a)}finally{null!==b&&null!==c.types&&(b.types=c.types),B.T=b}}function L(a){var b=B.T;if(null!==b){var c=b.types;null===c?b.types=[a]:-1===c.indexOf(a)&&c.push(a)}else K(L.bind(null,a))}c.Activity=o,c.Children={map:H,forEach:function(a,b,c){H(a,function(){b.apply(this,arguments)},c)},count:function(a){var b=0;return H(a,function(){b++}),b},toArray:function(a){return H(a,function(a){return a})||[]},only:function(a){if(!E(a))throw Error("React.Children.only expected to receive a single React element child.");return a}},c.Component=u,c.Fragment=f,c.Profiler=h,c.PureComponent=w,c.StrictMode=g,c.Suspense=l,c.ViewTransition=p,c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,c.__COMPILER_RUNTIME={__proto__:null,c:function(a){return B.H.useMemoCache(a)}},c.addTransitionType=L,c.cache=function(a){return function(){return a.apply(null,arguments)}},c.cacheSignal=function(){return null},c.cloneElement=function(a,b,c){if(null==a)throw Error("The argument must be a React element, but you passed "+a+".");var d=s({},a.props),e=a.key;if(null!=b)for(f in void 0!==b.key&&(e=""+b.key),b)C.call(b,f)&&"key"!==f&&"__self"!==f&&"__source"!==f&&("ref"!==f||void 0!==b.ref)&&(d[f]=b[f]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var g=Array(f),h=0;h<f;h++)g[h]=arguments[h+2];d.children=g}return D(a.type,e,d)},c.createContext=function(a){return(a={$$typeof:j,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider=a,a.Consumer={$$typeof:i,_context:a},a},c.createElement=function(a,b,c){var d,e={},f=null;if(null!=b)for(d in void 0!==b.key&&(f=""+b.key),b)C.call(b,d)&&"key"!==d&&"__self"!==d&&"__source"!==d&&(e[d]=b[d]);var g=arguments.length-2;if(1===g)e.children=c;else if(1<g){for(var h=Array(g),i=0;i<g;i++)h[i]=arguments[i+2];e.children=h}if(a&&a.defaultProps)for(d in g=a.defaultProps)void 0===e[d]&&(e[d]=g[d]);return D(a,f,e)},c.createRef=function(){return{current:null}},c.forwardRef=function(a){return{$$typeof:k,render:a}},c.isValidElement=E,c.lazy=function(a){return{$$typeof:n,_payload:{_status:-1,_result:a},_init:I}},c.memo=function(a,b){return{$$typeof:m,type:a,compare:void 0===b?null:b}},c.startTransition=K,c.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},c.use=function(a){return B.H.use(a)},c.useActionState=function(a,b,c){return B.H.useActionState(a,b,c)},c.useCallback=function(a,b){return B.H.useCallback(a,b)},c.useContext=function(a){return B.H.useContext(a)},c.useDebugValue=function(){},c.useDeferredValue=function(a,b){return B.H.useDeferredValue(a,b)},c.useEffect=function(a,b){return B.H.useEffect(a,b)},c.useEffectEvent=function(a){return B.H.useEffectEvent(a)},c.useId=function(){return B.H.useId()},c.useImperativeHandle=function(a,b,c){return B.H.useImperativeHandle(a,b,c)},c.useInsertionEffect=function(a,b){return B.H.useInsertionEffect(a,b)},c.useLayoutEffect=function(a,b){return B.H.useLayoutEffect(a,b)},c.useMemo=function(a,b){return B.H.useMemo(a,b)},c.useOptimistic=function(a,b){return B.H.useOptimistic(a,b)},c.useReducer=function(a,b,c){return B.H.useReducer(a,b,c)},c.useRef=function(a){return B.H.useRef(a)},c.useState=function(a){return B.H.useState(a)},c.useSyncExternalStore=function(a,b,c){return B.H.useSyncExternalStore(a,b,c)},c.useTransition=function(){return B.H.useTransition()},c.version="19.3.0-canary-f93b9fd4-20251217"},148407,(a,b,c)=>{"use strict";b.exports=a.r(14957)},497255,(a,b,c)=>{"use strict";var d=a.r(148407);function e(a){var b="https://react.dev/errors/"+a;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(){}var g={d:{f:f,r:function(){throw Error(e(522))},D:f,C:f,L:f,m:f,X:f,S:f,M:f},p:0,findDOMNode:null},h=Symbol.for("react.portal"),i=Symbol.for("react.optimistic_key"),j=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function k(a,b){return"font"===a?"":"string"==typeof b?"use-credentials"===b?b:"":void 0}c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g,c.createPortal=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!b||1!==b.nodeType&&9!==b.nodeType&&11!==b.nodeType)throw Error(e(299));return function(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:h,key:null==d?null:d===i?i:""+d,children:a,containerInfo:b,implementation:c}}(a,b,null,c)},c.flushSync=function(a){var b=j.T,c=g.p;try{if(j.T=null,g.p=2,a)return a()}finally{j.T=b,g.p=c,g.d.f()}},c.preconnect=function(a,b){"string"==typeof a&&(b=b?"string"==typeof(b=b.crossOrigin)?"use-credentials"===b?b:"":void 0:null,g.d.C(a,b))},c.prefetchDNS=function(a){"string"==typeof a&&g.d.D(a)},c.preinit=function(a,b){if("string"==typeof a&&b&&"string"==typeof b.as){var c=b.as,d=k(c,b.crossOrigin),e="string"==typeof b.integrity?b.integrity:void 0,f="string"==typeof b.fetchPriority?b.fetchPriority:void 0;"style"===c?g.d.S(a,"string"==typeof b.precedence?b.precedence:void 0,{crossOrigin:d,integrity:e,fetchPriority:f}):"script"===c&&g.d.X(a,{crossOrigin:d,integrity:e,fetchPriority:f,nonce:"string"==typeof b.nonce?b.nonce:void 0})}},c.preinitModule=function(a,b){if("string"==typeof a)if("object"==typeof b&&null!==b){if(null==b.as||"script"===b.as){var c=k(b.as,b.crossOrigin);g.d.M(a,{crossOrigin:c,integrity:"string"==typeof b.integrity?b.integrity:void 0,nonce:"string"==typeof b.nonce?b.nonce:void 0})}}else null==b&&g.d.M(a)},c.preload=function(a,b){if("string"==typeof a&&"object"==typeof b&&null!==b&&"string"==typeof b.as){var c=b.as,d=k(c,b.crossOrigin);g.d.L(a,c,{crossOrigin:d,integrity:"string"==typeof b.integrity?b.integrity:void 0,nonce:"string"==typeof b.nonce?b.nonce:void 0,type:"string"==typeof b.type?b.type:void 0,fetchPriority:"string"==typeof b.fetchPriority?b.fetchPriority:void 0,referrerPolicy:"string"==typeof b.referrerPolicy?b.referrerPolicy:void 0,imageSrcSet:"string"==typeof b.imageSrcSet?b.imageSrcSet:void 0,imageSizes:"string"==typeof b.imageSizes?b.imageSizes:void 0,media:"string"==typeof b.media?b.media:void 0})}},c.preloadModule=function(a,b){if("string"==typeof a)if(b){var c=k(b.as,b.crossOrigin);g.d.m(a,{as:"string"==typeof b.as&&"script"!==b.as?b.as:void 0,crossOrigin:c,integrity:"string"==typeof b.integrity?b.integrity:void 0})}else g.d.m(a)},c.requestFormReset=function(a){g.d.r(a)},c.unstable_batchedUpdates=function(a,b){return a(b)},c.useFormState=function(a,b,c){return j.H.useFormState(a,b,c)},c.useFormStatus=function(){return j.H.useHostTransitionStatus()},c.version="19.3.0-canary-f93b9fd4-20251217"},702761,(a,b,c)=>{"use strict";!function a(){if("u">typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(a){console.error(a)}}(),b.exports=a.r(497255)},371374,(a,b,c)=>{"use strict";var d=a.r(497156),e=a.r(148407),f=a.r(702761);function g(a){var b="https://react.dev/errors/"+a;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType)}function i(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do 0!=(4098&(b=a).flags)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function j(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&null!==(a=a.alternate)&&(b=a.memoizedState),null!==b)return b.dehydrated}return null}function k(a){if(31===a.tag){var b=a.memoizedState;if(null===b&&null!==(a=a.alternate)&&(b=a.memoizedState),null!==b)return b.dehydrated}return null}function l(a){if(i(a)!==a)throw Error(g(188))}function m(a,b,c,d,e,f){for(;null!==a;){if(5===a.tag&&c(a,d,e,f)||(22!==a.tag||null===a.memoizedState)&&(b||5!==a.tag)&&m(a.child,b,c,d,e,f))return!0;a=a.sibling}return!1}function n(a){for(a=a.return;null!==a;){if(3===a.tag||5===a.tag)return a;a=a.return}return null}function o(a){switch(a.tag){case 5:return a.stateNode;case 3:return a.stateNode.containerInfo;default:throw Error(g(559))}}var p=null,q=null;function r(a){return p=a,!0}function s(a,b,c){return a===c||a===b&&(p=a,!0)}function t(a,b,c){return a===c?(q=a,!1):a===b&&(null!==q&&(p=a),!0)}function u(a){if(null===a)return null;do a=null===a?null:a.return;while(a&&5!==a.tag&&27!==a.tag&&3!==a.tag)return a||null}function v(a,b,c){for(var d=0,e=a;e;e=c(e))d++;e=0;for(var f=b;f;f=c(f))e++;for(;0<d-e;)a=c(a),d--;for(;0<e-d;)b=c(b),e--;for(;d--;){if(a===b||null!==b&&a===b.alternate)return a;a=c(a),b=c(b)}return null}var w=Object.assign,y=Symbol.for("react.element"),z=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),F=Symbol.for("react.context"),G=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),J=Symbol.for("react.memo"),K=Symbol.for("react.lazy");Symbol.for("react.scope");var L=Symbol.for("react.activity"),M=Symbol.for("react.legacy_hidden");Symbol.for("react.tracing_marker");var N=Symbol.for("react.memo_cache_sentinel"),O=Symbol.for("react.view_transition"),P=Symbol.iterator;function Q(a){return null===a||"object"!=typeof a?null:"function"==typeof(a=P&&a[P]||a["@@iterator"])?a:null}var R=Symbol.for("react.client.reference"),S=Array.isArray,T=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U=f.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},W=[],X=-1;function Y(a){return{current:a}}function Z(a){0>X||(a.current=W[X],W[X]=null,X--)}function $(a,b){W[++X]=a.current,a.current=b}var _=Y(null),aa=Y(null),ab=Y(null),ac=Y(null);function ad(a,b){switch($(ab,b),$(aa,a),$(_,null),b.nodeType){case 9:case 11:a=(a=b.documentElement)&&(a=a.namespaceURI)?j6(a):0;break;default:if(a=b.tagName,b=b.namespaceURI)a=j7(b=j6(b),a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Z(_),$(_,a)}function ae(){Z(_),Z(aa),Z(ab)}function af(a){var b=a.memoizedState;null!==b&&(le._currentValue=b.memoizedState,$(ac,a));var c=j7(b=_.current,a.type);b!==c&&($(aa,a),$(_,c))}function ag(a){aa.current===a&&(Z(_),Z(aa)),ac.current===a&&(Z(ac),le._currentValue=V)}function ah(a){if(void 0===bT)try{throw Error()}catch(a){var b=a.stack.trim().match(/\n( *(at )?)/);bT=b&&b[1]||"",bU=-1<a.stack.indexOf("\n    at")?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+bT+a+bU}var ai=!1;function aj(a,b){if(!a||ai)return"";ai=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(b){var c=function(){throw Error()};if(Object.defineProperty(c.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(c,[])}catch(a){var d=a}Reflect.construct(a,[],c)}else{try{c.call()}catch(a){d=a}a.call(c.prototype)}}else{try{throw Error()}catch(a){d=a}(c=a())&&"function"==typeof c.catch&&c.catch(function(){})}}catch(a){if(a&&d&&"string"==typeof a.stack)return[a.stack,d.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var e=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");e&&e.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var f=d.DetermineComponentFrameRoot(),g=f[0],h=f[1];if(g&&h){var i=g.split("\n"),j=h.split("\n");for(e=d=0;d<i.length&&!i[d].includes("DetermineComponentFrameRoot");)d++;for(;e<j.length&&!j[e].includes("DetermineComponentFrameRoot");)e++;if(d===i.length||e===j.length)for(d=i.length-1,e=j.length-1;1<=d&&0<=e&&i[d]!==j[e];)e--;for(;1<=d&&0<=e;d--,e--)if(i[d]!==j[e]){if(1!==d||1!==e)do if(d--,e--,0>e||i[d]!==j[e]){var k="\n"+i[d].replace(" at new "," at ");return a.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",a.displayName)),k}while(1<=d&&0<=e)break}}}finally{ai=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?ah(c):""}function ak(a){try{var b="",c=null;do b+=function(a,b){switch(a.tag){case 26:case 27:case 5:return ah(a.type);case 16:return ah("Lazy");case 13:return a.child!==b&&null!==b?ah("Suspense Fallback"):ah("Suspense");case 19:return ah("SuspenseList");case 0:case 15:return aj(a.type,!1);case 11:return aj(a.type.render,!1);case 1:return aj(a.type,!0);case 31:return ah("Activity");case 30:return ah("ViewTransition");default:return""}}(a,c),c=a,a=a.return;while(a)return b}catch(a){return"\nError generating stack: "+a.message+"\n"+a.stack}}var al=Object.prototype.hasOwnProperty,am=d.unstable_scheduleCallback,an=d.unstable_cancelCallback,ao=d.unstable_shouldYield,ap=d.unstable_requestPaint,aq=d.unstable_now,ar=d.unstable_getCurrentPriorityLevel,as=d.unstable_ImmediatePriority,at=d.unstable_UserBlockingPriority,au=d.unstable_NormalPriority,av=d.unstable_LowPriority,aw=d.unstable_IdlePriority,ax=(d.log,d.unstable_setDisableYieldValue,null),ay=null,az=Math.clz32?Math.clz32:function(a){return 0==(a>>>=0)?32:31-(aA(a)/aB|0)|0},aA=Math.log,aB=Math.LN2,aC=256,aD=262144,aE=4194304;function aF(a){var b=42&a;if(0!==b)return b;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&a;case 262144:case 524288:case 1048576:case 2097152:return 3932160&a;case 4194304:case 8388608:case 0x1000000:case 0x2000000:return 0x3c00000&a;case 0x4000000:return 0x4000000;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0;default:return a}}function aG(a,b,c){var d=a.pendingLanes;if(0===d)return 0;var e=0,f=a.suspendedLanes,g=a.pingedLanes;a=a.warmLanes;var h=0x7ffffff&d;return 0!==h?0!=(d=h&~f)?e=aF(d):0!=(g&=h)?e=aF(g):c||0!=(c=h&~a)&&(e=aF(c)):0!=(h=d&~f)?e=aF(h):0!==g?e=aF(g):c||0!=(c=d&~a)&&(e=aF(c)),0===e?0:0!==b&&b!==e&&0==(b&f)&&((f=e&-e)>=(c=b&-b)||32===f&&0!=(4194048&c))?b:e}function aH(a,b){return 0==(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&b)}function aI(){var a=aE;return 0==(0x3c00000&(aE<<=1))&&(aE=4194304),a}function aJ(a){for(var b=[],c=0;31>c;c++)b.push(a);return b}function aK(a,b){a.pendingLanes|=b,0x10000000!==b&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function aL(a,b,c){a.pendingLanes|=b,a.suspendedLanes&=~b;var d=31-az(b);a.entangledLanes|=b,a.entanglements[d]=0x40000000|a.entanglements[d]|261930&c}function aM(a,b){var c=a.entangledLanes|=b;for(a=a.entanglements;c;){var d=31-az(c),e=1<<d;e&b|a[d]&b&&(a[d]|=b),c&=~e}}function aN(a,b){var c=b&-b;return 0!=((c=0!=(42&c)?1:aO(c))&(a.suspendedLanes|b))?0:c}function aO(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:a=128;break;case 0x10000000:a=0x8000000;break;default:a=0}return a}function aP(a){return 2<(a&=-a)?8<a?0!=(0x7ffffff&a)?32:0x10000000:8:2}function aQ(){var a=U.p;return 0!==a?a:void 0===(a=window.event)?32:lt(a.type)}function aR(a,b){var c=U.p;try{return U.p=a,b()}finally{U.p=c}}var aS=Math.random().toString(36).slice(2),aT="__reactFiber$"+aS,aU="__reactProps$"+aS,aV="__reactContainer$"+aS,aW="__reactEvents$"+aS,aX="__reactListeners$"+aS,aY="__reactHandles$"+aS,aZ="__reactResources$"+aS,a$="__reactMarker$"+aS;function a_(a){delete a[aT],delete a[aU],delete a[aW],delete a[aX],delete a[aY]}function a0(a){var b;if(b=a[aT])return b;for(var c=a.parentNode;c;){if(b=c[aV]||c[aT]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=kJ(a);null!==a;){if(c=a[aT])return c;a=kJ(a)}return b}c=(a=c).parentNode}return null}function a1(a){if(a=a[aT]||a[aV]){var b=a.tag;if(5===b||6===b||13===b||31===b||26===b||27===b||3===b)return a}return null}function a2(a){var b=a.tag;if(5===b||26===b||27===b||6===b)return a.stateNode;throw Error(g(33))}function a3(a){var b=a[aZ];return b||(b=a[aZ]={hoistableStyles:new Map,hoistableScripts:new Map}),b}function a4(a){a[a$]=!0}var a5=new Set,a6={};function a7(a,b){a8(a,b),a8(a+"Capture",b)}function a8(a,b){for(a6[a]=b,a=0;a<b.length;a++)a5.add(b[a])}var a9=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ba={},bb={},bc=!1;function bd(){var a=bc;return bc=!1,a}function be(a,b,c){if(al.call(bb,b)||!al.call(ba,b)&&(a9.test(b)?bb[b]=!0:(ba[b]=!0,!1)))if(null===c)a.removeAttribute(b);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(b);return;case"boolean":var d=b.toLowerCase().slice(0,5);if("data-"!==d&&"aria-"!==d)return void a.removeAttribute(b)}a.setAttribute(b,""+c)}}function bf(a,b,c){if(null===c)a.removeAttribute(b);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(b);return}a.setAttribute(b,""+c)}}function bg(a,b,c,d){if(null===d)a.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(b,c,""+d)}}function bh(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return a;default:return""}}function bi(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function bj(a){if(!a._valueTracker){var b=bi(a)?"checked":"value";a._valueTracker=function(a,b,c){var d=Object.getOwnPropertyDescriptor(a.constructor.prototype,b);if(!a.hasOwnProperty(b)&&void 0!==d&&"function"==typeof d.get&&"function"==typeof d.set){var e=d.get,f=d.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){c=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:d.enumerable}),{getValue:function(){return c},setValue:function(a){c=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}(a,b,""+a[b])}}function bk(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=bi(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function bl(a){if(void 0===(a=a||("u">typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}var bm=/[\n"\\]/g;function bn(a){return a.replace(bm,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function bo(a,b,c,d,e,f,g,h){a.name="",null!=g&&"function"!=typeof g&&"symbol"!=typeof g&&"boolean"!=typeof g?a.type=g:a.removeAttribute("type"),null!=b?"number"===g?(0===b&&""===a.value||a.value!=b)&&(a.value=""+bh(b)):a.value!==""+bh(b)&&(a.value=""+bh(b)):"submit"!==g&&"reset"!==g||a.removeAttribute("value"),null!=b?bq(a,g,bh(b)):null!=c?bq(a,g,bh(c)):null!=d&&a.removeAttribute("value"),null==e&&null!=f&&(a.defaultChecked=!!f),null!=e&&(a.checked=e&&"function"!=typeof e&&"symbol"!=typeof e),null!=h&&"function"!=typeof h&&"symbol"!=typeof h&&"boolean"!=typeof h?a.name=""+bh(h):a.removeAttribute("name")}function bp(a,b,c,d,e,f,g,h){if(null!=f&&"function"!=typeof f&&"symbol"!=typeof f&&"boolean"!=typeof f&&(a.type=f),null!=b||null!=c){if(("submit"===f||"reset"===f)&&null==b)return void bj(a);c=null!=c?""+bh(c):"",b=null!=b?""+bh(b):c,h||b===a.value||(a.value=b),a.defaultValue=b}d="function"!=typeof(d=null!=d?d:e)&&"symbol"!=typeof d&&!!d,a.checked=h?a.checked:!!d,a.defaultChecked=!!d,null!=g&&"function"!=typeof g&&"symbol"!=typeof g&&"boolean"!=typeof g&&(a.name=g),bj(a)}function bq(a,b,c){"number"===b&&bl(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function br(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(e=0,c=""+bh(c),b=null;e<a.length;e++){if(a[e].value===c){a[e].selected=!0,d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function bs(a,b,c){if(null!=b&&((b=""+bh(b))!==a.value&&(a.value=b),null==c)){a.defaultValue!==b&&(a.defaultValue=b);return}a.defaultValue=null!=c?""+bh(c):""}function bt(a,b,c,d){if(null==b){if(null!=d){if(null!=c)throw Error(g(92));if(S(d)){if(1<d.length)throw Error(g(93));d=d[0]}c=d}null==c&&(c=""),b=c}a.defaultValue=c=bh(b),(d=a.textContent)===c&&""!==d&&null!==d&&(a.value=d),bj(a)}function bu(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b}var bv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bw(a,b,c){var d=0===b.indexOf("--");null==c||"boolean"==typeof c||""===c?d?a.setProperty(b,""):"float"===b?a.cssFloat="":a[b]="":d?a.setProperty(b,c):"number"!=typeof c||0===c||bv.has(b)?"float"===b?a.cssFloat=c:a[b]=(""+c).trim():a[b]=c+"px"}function bx(a,b,c){if(null!=b&&"object"!=typeof b)throw Error(g(62));if(a=a.style,null!=c){for(var d in c)!c.hasOwnProperty(d)||null!=b&&b.hasOwnProperty(d)||(0===d.indexOf("--")?a.setProperty(d,""):"float"===d?a.cssFloat="":a[d]="",bc=!0);for(var e in b)d=b[e],b.hasOwnProperty(e)&&c[e]!==d&&(bw(a,e,d),bc=!0)}else for(var f in b)b.hasOwnProperty(f)&&bw(a,f,b[f])}function by(a){if(-1===a.indexOf("-"))return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bz=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),bA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bB(a){return bA.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function bC(){}var bD=null;function bE(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}var bF=null,bG=null;function bH(a){var b=a1(a);if(b&&(a=b.stateNode)){var c=a[aU]||null;switch(a=b.stateNode,b.type){case"input":if(bo(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+bn(""+b)+'"][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=d[aU]||null;if(!e)throw Error(g(90));bo(d,e.value,e.defaultValue,e.defaultValue,e.checked,e.defaultChecked,e.type,e.name)}}for(b=0;b<c.length;b++)(d=c[b]).form===a.form&&bk(d)}break;case"textarea":bs(a,c.value,c.defaultValue);break;case"select":null!=(b=c.value)&&br(a,!!c.multiple,b,!1)}}}var bI=!1;function bJ(a,b,c){if(bI)return a(b,c);bI=!0;try{return a(b)}finally{if(bI=!1,(null!==bF||null!==bG)&&(i$(),bF&&(b=bF,a=bG,bG=bF=null,bH(b),a)))for(b=0;b<a.length;b++)bH(a[b])}}function bK(a,b){var c=a.stateNode;if(null===c)return null;var d=c[aU]||null;if(null===d)return null;switch(c=d[b],b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d="button"!==(a=a.type)&&"input"!==a&&"select"!==a&&"textarea"!==a),a=!d;break;default:a=!1}if(a)return null;if(c&&"function"!=typeof c)throw Error(g(231,b,typeof c));return c}var bL=null,bM=null,bN=null;function bO(){if(bN)return bN;var a,b,c=bM,d=c.length,e="value"in bL?bL.value:bL.textContent,f=e.length;for(a=0;a<d&&c[a]===e[a];a++);var g=d-a;for(b=1;b<=g&&c[d-b]===e[f-b];b++);return bN=e.slice(a,1<b?1-b:void 0)}function bP(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}function bQ(){return!0}function bR(){return!1}function bS(a){function b(b,c,d,e,f){for(var g in this._reactName=b,this._targetInst=d,this.type=c,this.nativeEvent=e,this.target=f,this.currentTarget=null,a)a.hasOwnProperty(g)&&(b=a[g],this[g]=b?b(e):e[g]);return this.isDefaultPrevented=(null!=e.defaultPrevented?e.defaultPrevented:!1===e.returnValue)?bQ:bR,this.isPropagationStopped=bR,this}return w(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!=typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=bQ)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!=typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=bQ)},persist:function(){},isPersistent:bQ}),b}var bT,bU,bV,bW,bX,bY={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bZ=bS(bY),b$=w({},bY,{view:0,detail:0}),b_=bS(b$),b0=w({},b$,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cb,button:0,buttons:0,relatedTarget:function(a){return void 0===a.relatedTarget?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==bX&&(bX&&"mousemove"===a.type?(bV=a.screenX-bX.screenX,bW=a.screenY-bX.screenY):bW=bV=0,bX=a),bV)},movementY:function(a){return"movementY"in a?a.movementY:bW}}),b1=bS(b0),b2=bS(w({},b0,{dataTransfer:0})),b3=bS(w({},b$,{relatedTarget:0})),b4=bS(w({},bY,{animationName:0,elapsedTime:0,pseudoElement:0})),b5=bS(w({},bY,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}})),b6=bS(w({},bY,{data:0})),b7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},b9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ca(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=b9[a])&&!!b[a]}function cb(){return ca}var cc=bS(w({},b$,{key:function(a){if(a.key){var b=b7[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=bP(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?b8[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cb,charCode:function(a){return"keypress"===a.type?bP(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?bP(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}})),cd=bS(w({},b0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ce=bS(w({},b$,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cb})),cf=bS(w({},bY,{propertyName:0,elapsedTime:0,pseudoElement:0})),cg=bS(w({},b0,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0})),ch=bS(w({},bY,{newState:0,oldState:0})),ci=[9,13,27,32];function cj(a,b){switch(a){case"keyup":return -1!==ci.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}var ck=!1,cl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cm(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!cl[a.type]:"textarea"===b}function cn(a,b,c,d){bF?bG?bG.push(d):bG=[d]:bF=d,0<(b=jU(b,"onChange")).length&&(c=new bZ("onChange","change",null,c,d),a.push({event:c,listeners:b}))}var co=null,cp=null;function cq(a){jM(a,0)}function cr(a){if(bk(a2(a)))return a}function cs(a,b){if("change"===a)return b}function ct(){co&&(co.detachEvent("onpropertychange",cu),cp=co=null)}function cu(a){if("value"===a.propertyName&&cr(cp)){var b=[];cn(b,cp,a,bE(a)),bJ(cq,b)}}function cv(a,b,c){"focusin"===a?(ct(),co=b,cp=c,co.attachEvent("onpropertychange",cu)):"focusout"===a&&ct()}function cw(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return cr(cp)}function cx(a,b){if("click"===a)return cr(b)}function cy(a,b){if("input"===a||"change"===a)return cr(b)}var cz="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b};function cA(a,b){if(cz(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var e=c[d];if(!al.call(b,e)||!cz(a[e],b[e]))return!1}return!0}function cB(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function cC(a,b){var c,d=cB(a);for(a=0;d;){if(3===d.nodeType){if(c=a+d.textContent.length,a<=b&&c>=b)return{node:d,offset:b-a};a=c}b:{for(;d;){if(d.nextSibling){d=d.nextSibling;break b}d=d.parentNode}d=void 0}d=cB(d)}}function cD(a){a=null!=a&&null!=a.ownerDocument&&null!=a.ownerDocument.defaultView?a.ownerDocument.defaultView:window;for(var b=bl(a.document);b instanceof a.HTMLIFrameElement;){try{var c="string"==typeof b.contentWindow.location.href}catch(a){c=!1}if(c)a=b.contentWindow;else break;b=bl(a.document)}return b}function cE(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var cF=null,cG=null,cH=null,cI=!1;function cJ(a,b,c){var d=c.window===c?c.document:9===c.nodeType?c:c.ownerDocument;cI||null==cF||cF!==bl(d)||(d="selectionStart"in(d=cF)&&cE(d)?{start:d.selectionStart,end:d.selectionEnd}:{anchorNode:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset},cH&&cA(cH,d)||(cH=d,0<(d=jU(cG,"onSelect")).length&&(b=new bZ("onSelect","select",null,b,c),a.push({event:b,listeners:d}),b.target=cF)))}function cK(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var cL={animationend:cK("Animation","AnimationEnd"),animationiteration:cK("Animation","AnimationIteration"),animationstart:cK("Animation","AnimationStart"),transitionrun:cK("Transition","TransitionRun"),transitionstart:cK("Transition","TransitionStart"),transitioncancel:cK("Transition","TransitionCancel"),transitionend:cK("Transition","TransitionEnd")},cM={},cN={};function cO(a){if(cM[a])return cM[a];if(!cL[a])return a;var b,c=cL[a];for(b in c)if(c.hasOwnProperty(b)&&b in cN)return cM[a]=c[b];return a}var cP=cO("animationend"),cQ=cO("animationiteration"),cR=cO("animationstart"),cS=cO("transitionrun"),cT=cO("transitionstart"),cU=cO("transitioncancel"),cV=cO("transitionend"),cW=new Map,cX="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cY(a,b){cW.set(a,b),a7(b,[a])}cX.push("scrollEnd");var cZ=0;function c$(a,b){return null!=a.name&&"auto"!==a.name?a.name:null!==b.autoName?b.autoName:b.autoName=a="_"+(a=iI.identifierPrefix)+"t_"+(cZ++).toString(32)+"_"}function c_(a){if(null==a||"string"==typeof a)return a;var b=null,c=iQ;if(null!==c)for(var d=0;d<c.length;d++){var e=a[c[d]];if(null!=e){if("none"===e)return"none";b=null==b?e:b+" "+e}}return null==b?a.default:b}function c0(a,b){return a=c_(a),null==(b=c_(b))?"auto"===a?null:a:"auto"===b?null:b}var c1="function"==typeof reportError?reportError:function(a){"object"==typeof process&&"function"==typeof process.emit?process.emit("uncaughtException",a):console.error(a)},c2=[],c3=0,c4=0;function c5(){for(var a=c3,b=c4=c3=0;b<a;){var c=c2[b];c2[b++]=null;var d=c2[b];c2[b++]=null;var e=c2[b];c2[b++]=null;var f=c2[b];if(c2[b++]=null,null!==d&&null!==e){var g=d.pending;null===g?e.next=e:(e.next=g.next,g.next=e),d.pending=e}0!==f&&c9(c,e,f)}}function c6(a,b,c,d){c2[c3++]=a,c2[c3++]=b,c2[c3++]=c,c2[c3++]=d,c4|=d,a.lanes|=d,null!==(a=a.alternate)&&(a.lanes|=d)}function c7(a,b,c,d){return c6(a,b,c,d),da(a)}function c8(a,b){return c6(a,null,null,b),da(a)}function c9(a,b,c){a.lanes|=c;var d=a.alternate;null!==d&&(d.lanes|=c);for(var e=!1,f=a.return;null!==f;)f.childLanes|=c,null!==(d=f.alternate)&&(d.childLanes|=c),22===f.tag&&(null===(a=f.stateNode)||1&a._visibility||(e=!0)),a=f,f=f.return;return 3===a.tag?(f=a.stateNode,e&&null!==b&&(e=31-az(c),null===(d=(a=f.hiddenUpdates)[e])?a[e]=[b]:d.push(b),b.lane=0x20000000|c),f):null}function da(a){if(50<iR)throw iR=0,iS=null,Error(g(185));for(var b=a.return;null!==b;)b=(a=b).return;return 3===a.tag?a.stateNode:null}var db={};function dc(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dd(a,b,c,d){return new dc(a,b,c,d)}function de(a){return!(!(a=a.prototype)||!a.isReactComponent)}function df(a,b){var c=a.alternate;return null===c?((c=dd(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=0x7e00000&a.flags,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{lanes:b.lanes,firstContext:b.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function dg(a,b){a.flags&=0x7e00002;var c=a.alternate;return null===c?(a.childLanes=0,a.lanes=b,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,a.dependencies=null===(b=c.dependencies)?null:{lanes:b.lanes,firstContext:b.firstContext}),a}function dh(a,b,c,d,e,f){var h=0;if(d=a,"function"==typeof a)de(a)&&(h=1);else if("string"==typeof a)h=!function(a,b,c){if(1===c||null!=b.itemProp)return!1;switch(a){case"meta":case"title":return!0;case"style":if("string"!=typeof b.precedence||"string"!=typeof b.href||""===b.href)break;return!0;case"link":if("string"!=typeof b.rel||"string"!=typeof b.href||""===b.href||b.onLoad||b.onError)break;if("stylesheet"===b.rel)return a=b.disabled,"string"==typeof b.precedence&&null==a;return!0;case"script":if(b.async&&"function"!=typeof b.async&&"symbol"!=typeof b.async&&!b.onLoad&&!b.onError&&b.src&&"string"==typeof b.src)return!0}return!1}(a,c,_.current)?"html"===a||"head"===a||"body"===a?27:5:26;else b:switch(a){case L:return(a=dd(31,c,b,e)).elementType=L,a.lanes=f,a;case B:return di(c.children,e,f,b);case C:h=8,e|=24;break;case D:return(a=dd(12,c,b,2|e)).elementType=D,a.lanes=f,a;case H:return(a=dd(13,c,b,e)).elementType=H,a.lanes=f,a;case I:return(a=dd(19,c,b,e)).elementType=I,a.lanes=f,a;case M:case O:return(a=dd(30,c,b,a=32|e)).elementType=O,a.lanes=f,a.stateNode={autoName:null,paired:null,clones:null,ref:null},a;default:if("object"==typeof a&&null!==a)switch(a.$$typeof){case F:h=10;break b;case E:h=9;break b;case G:h=11;break b;case J:h=14;break b;case K:h=16,d=null;break b}h=29,c=Error(g(130,null===a?"null":typeof a,"")),d=null}return(b=dd(h,c,b,e)).elementType=a,b.type=d,b.lanes=f,b}function di(a,b,c,d){return(a=dd(7,a,d,b)).lanes=c,a}function dj(a,b,c){return(a=dd(6,a,null,b)).lanes=c,a}function dk(a){var b=dd(18,null,null,0);return b.stateNode=a,b}function dl(a,b,c){return(b=dd(4,null!==a.children?a.children:[],a.key,b)).lanes=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}var dm=new WeakMap;function dn(a,b){if("object"==typeof a&&null!==a){var c=dm.get(a);return void 0!==c?c:(b={value:a,source:b,stack:ak(b)},dm.set(a,b),b)}return{value:a,source:b,stack:ak(b)}}var dp=[],dq=0,dr=null,ds=0,dt=[],du=0,dv=null,dw=1,dx="";function dy(a,b){dp[dq++]=ds,dp[dq++]=dr,dr=a,ds=b}function dz(a,b,c){dt[du++]=dw,dt[du++]=dx,dt[du++]=dv,dv=a;var d=dw;a=dx;var e=32-az(d)-1;d&=~(1<<e),c+=1;var f=32-az(b)+e;if(30<f){var g=e-e%5;f=(d&(1<<g)-1).toString(32),d>>=g,e-=g,dw=1<<32-az(b)+e|c<<e|d,dx=f+a}else dw=1<<f|c<<e|d,dx=a}function dA(a){null!==a.return&&(dy(a,1),dz(a,1,0))}function dB(a){for(;a===dr;)dr=dp[--dq],dp[dq]=null,ds=dp[--dq],dp[dq]=null;for(;a===dv;)dv=dt[--du],dt[du]=null,dx=dt[--du],dt[du]=null,dw=dt[--du],dt[du]=null}function dC(a,b){dt[du++]=dw,dt[du++]=dx,dt[du++]=dv,dw=b.id,dx=b.overflow,dv=a}var dD=null,dE=null,dF=!1,dG=null,dH=!1,dI=Error(g(519));function dJ(a){var b=Error(g(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML",""));throw dP(dn(b,a)),dI}function dK(a){var b=a.stateNode,c=a.type,d=a.memoizedProps;switch(b[aT]=a,b[aU]=d,c){case"dialog":jN("cancel",b),jN("close",b);break;case"iframe":case"object":case"embed":jN("load",b);break;case"video":case"audio":for(c=0;c<jK.length;c++)jN(jK[c],b);break;case"source":jN("error",b);break;case"img":case"image":case"link":jN("error",b),jN("load",b);break;case"details":jN("toggle",b);break;case"input":jN("invalid",b),bp(b,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":jN("invalid",b);break;case"textarea":jN("invalid",b),bt(b,d.value,d.defaultValue,d.children)}"string"!=typeof(c=d.children)&&"number"!=typeof c&&"bigint"!=typeof c||b.textContent===""+c||!0===d.suppressHydrationWarning||j$(b.textContent,c)?(null!=d.popover&&(jN("beforetoggle",b),jN("toggle",b)),null!=d.onScroll&&jN("scroll",b),null!=d.onScrollEnd&&jN("scrollend",b),null!=d.onClick&&(b.onclick=bC),b=!0):b=!1,b||dJ(a,!0)}function dL(a){for(dD=a.return;dD;)switch(dD.tag){case 5:case 31:case 13:dH=!1;return;case 27:case 3:dH=!0;return;default:dD=dD.return}}function dM(a){if(a!==dD)return!1;if(!dF)return dL(a),dF=!0,!1;var b,c=a.tag;if((b=3!==c&&27!==c)&&((b=5===c)&&(b="form"===(b=a.type)||"button"===b||j8(a.type,a.memoizedProps)),b=!b),b&&dE&&dJ(a),dL(a),13===c){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(g(317));dE=kI(a)}else if(31===c){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(g(317));dE=kI(a)}else 27===c?(c=dE,kf(a.type)?(a=kH,kH=null,dE=a):dE=c):dE=dD?kG(a.stateNode.nextSibling):null;return!0}function dN(){dE=dD=null,dF=!1}function dO(){var a=dG;return null!==a&&(null===iA?iA=a:iA.push.apply(iA,a),dG=null),a}function dP(a){null===dG?dG=[a]:dG.push(a)}var dQ=Y(null),dR=null,dS=null;function dT(a,b,c){$(dQ,b._currentValue),b._currentValue=c}function dU(a){a._currentValue=dQ.current,Z(dQ)}function dV(a,b,c){for(;null!==a;){var d=a.alternate;if((a.childLanes&b)!==b?(a.childLanes|=b,null!==d&&(d.childLanes|=b)):null!==d&&(d.childLanes&b)!==b&&(d.childLanes|=b),a===c)break;a=a.return}}function dW(a,b,c,d){var e=a.child;for(null!==e&&(e.return=a);null!==e;){var f=e.dependencies;if(null!==f){var h=e.child;f=f.firstContext;b:for(;null!==f;){var i=f;f=e;for(var j=0;j<b.length;j++)if(i.context===b[j]){f.lanes|=c,null!==(i=f.alternate)&&(i.lanes|=c),dV(f.return,c,a),d||(h=null);break b}f=i.next}}else if(18===e.tag){if(null===(h=e.return))throw Error(g(341));h.lanes|=c,null!==(f=h.alternate)&&(f.lanes|=c),dV(h,c,a),h=null}else h=e.child;if(null!==h)h.return=e;else for(h=e;null!==h;){if(h===a){h=null;break}if(null!==(e=h.sibling)){e.return=h.return,h=e;break}h=h.return}e=h}}function dX(a,b,c,d){a=null;for(var e=b,f=!1;null!==e;){if(!f){if(0!=(524288&e.flags))f=!0;else if(0!=(262144&e.flags))break}if(10===e.tag){var h=e.alternate;if(null===h)throw Error(g(387));if(null!==(h=h.memoizedProps)){var i=e.type;cz(e.pendingProps.value,h.value)||(null!==a?a.push(i):a=[i])}}else if(e===ac.current){if(null===(h=e.alternate))throw Error(g(387));h.memoizedState.memoizedState!==e.memoizedState.memoizedState&&(null!==a?a.push(le):a=[le])}e=e.return}null!==a&&dW(b,a,c,d),b.flags|=262144}function dY(a){for(a=a.firstContext;null!==a;){if(!cz(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function dZ(a){dR=a,dS=null,null!==(a=a.dependencies)&&(a.firstContext=null)}function d$(a){return d0(dR,a)}function d_(a,b){return null===dR&&dZ(a),d0(a,b)}function d0(a,b){var c=b._currentValue;if(b={context:b,memoizedValue:c,next:null},null===dS){if(null===a)throw Error(g(308));dS=b,a.dependencies={lanes:0,firstContext:b},a.flags|=524288}else dS=dS.next=b;return c}var d1="u">typeof AbortController?AbortController:function(){var a=[],b=this.signal={aborted:!1,addEventListener:function(b,c){a.push(c)}};this.abort=function(){b.aborted=!0,a.forEach(function(a){return a()})}},d2=d.unstable_scheduleCallback,d3=d.unstable_NormalPriority,d4={$$typeof:F,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function d5(){return{controller:new d1,data:new Map,refCount:0}}function d6(a){a.refCount--,0===a.refCount&&d2(d3,function(){a.controller.abort()})}function d7(a,b){if(0!=(4194048&a.pendingLanes)){var c=a.transitionTypes;for(null===c&&(c=a.transitionTypes=[]),a=0;a<b.length;a++){var d=b[a];-1===c.indexOf(d)&&c.push(d)}}}var d8=null,d9=null,ea=0,eb=0,ec=null;function ed(){if(0==--ea&&(d8=null,null!==d9)){null!==ec&&(ec.status="fulfilled");var a=d9;d9=null,eb=0,ec=null;for(var b=0;b<a.length;b++)(0,a[b])()}}var ee=T.S;T.S=function(a,b){if(iD=aq(),"object"==typeof b&&null!==b&&"function"==typeof b.then&&function(a,b){if(null===d9){var c=d9=[];ea=0,eb=jF(),ec={status:"pending",value:void 0,then:function(a){c.push(a)}}}ea++,b.then(ed,ed)}(0,b),null!==d8)for(var c=js;null!==c;)d7(c,d8),c=c.next;if(null!==(c=a.types)){for(var d=js;null!==d;)d7(d,c),d=d.next;if(0!==eb){null===(d=d8)&&(d=d8=[]);for(var e=0;e<c.length;e++){var f=c[e];-1===d.indexOf(f)&&d.push(f)}}}null!==ee&&ee(a,b)};var ef=Y(null);function eg(){var a=ef.current;return null!==a?a:ij.pooledCache}function eh(a,b){null===b?$(ef,ef.current):$(ef,b.pool)}function ei(){var a=eg();return null===a?null:{parent:d4._currentValue,pool:a}}var ej=Error(g(460)),ek=Error(g(474)),el=Error(g(542)),em={then:function(){}};function en(a){return"fulfilled"===(a=a.status)||"rejected"===a}function eo(a,b,c){switch(void 0===(c=a[c])?a.push(b):c!==b&&(b.then(bC,bC),b=c),b.status){case"fulfilled":return b.value;case"rejected":throw es(a=b.reason),a;default:if("string"==typeof b.status)b.then(bC,bC);else{if(null!==(a=ij)&&100<a.shellSuspendCounter)throw Error(g(482));(a=b).status="pending",a.then(function(a){if("pending"===b.status){var c=b;c.status="fulfilled",c.value=a}},function(a){if("pending"===b.status){var c=b;c.status="rejected",c.reason=a}})}switch(b.status){case"fulfilled":return b.value;case"rejected":throw es(a=b.reason),a}throw eq=b,ej}}function ep(a){try{return(0,a._init)(a._payload)}catch(a){if(null!==a&&"object"==typeof a&&"function"==typeof a.then)throw eq=a,ej;throw a}}var eq=null;function er(){if(null===eq)throw Error(g(459));var a=eq;return eq=null,a}function es(a){if(a===ej||a===el)throw Error(g(483))}var et=null,eu=0;function ev(a){var b=eu;return eu+=1,null===et&&(et=[]),eo(et,a,b)}function ew(a,b){a.ref=void 0!==(b=b.props.ref)?b:null}function ex(a,b){if(b.$$typeof===y)throw Error(g(525));throw Error(g(31,"[object Object]"===(a=Object.prototype.toString.call(b))?"object with keys {"+Object.keys(b).join(", ")+"}":a))}function ey(a){function b(b,c){if(a){var d=b.deletions;null===d?(b.deletions=[c],b.flags|=16):d.push(c)}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a){for(var b=new Map;null!==a;)null===a.key?b.set(a.index,a):b.set(a.key,a),a=a.sibling;return b}function e(a,b){return(a=df(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return(b.index=d,a)?null!==(d=b.alternate)?(d=d.index)<c?(b.flags|=0x8000002,c):d:(b.flags|=0x8000002,c):(b.flags|=1048576,c)}function h(b){return a&&null===b.alternate&&(b.flags|=0x8000002),b}function i(a,b,c,d){return null===b||6!==b.tag?(b=dj(c,a.mode,d)).return=a:(b=e(b,c)).return=a,b}function j(a,b,c,d){var f=c.type;return f===B?(ew(a=l(a,b,c.props.children,d,c.key),c),a):(null!==b&&(b.elementType===f||"object"==typeof f&&null!==f&&f.$$typeof===K&&ep(f)===b.type)?ew(b=e(b,c.props),c):ew(b=dh(c.type,c.key,c.props,null,a.mode,d),c),b.return=a,b)}function k(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?(b=dl(c,a.mode,d)).return=a:(b=e(b,c.children||[])).return=a,b}function l(a,b,c,d,f){return null===b||7!==b.tag?(b=di(c,a.mode,d,f)).return=a:(b=e(b,c)).return=a,b}function m(a,b,c){if("string"==typeof b&&""!==b||"number"==typeof b||"bigint"==typeof b)return(b=dj(""+b,a.mode,c)).return=a,b;if("object"==typeof b&&null!==b){switch(b.$$typeof){case z:return ew(c=dh(b.type,b.key,b.props,null,a.mode,c),b),c.return=a,c;case A:return(b=dl(b,a.mode,c)).return=a,b;case K:return m(a,b=ep(b),c)}if(S(b)||Q(b))return(b=di(b,a.mode,c,null)).return=a,b;if("function"==typeof b.then)return m(a,ev(b),c);if(b.$$typeof===F)return m(a,d_(a,b),c);ex(a,b)}return null}function n(a,b,c,d){var e=null!==b?b.key:null;if("string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c)return null!==e?null:i(a,b,""+c,d);if("object"==typeof c&&null!==c){switch(c.$$typeof){case z:return c.key===e?j(a,b,c,d):null;case A:return c.key===e?k(a,b,c,d):null;case K:return n(a,b,c=ep(c),d)}if(S(c)||Q(c))return null!==e?null:l(a,b,c,d,null);if("function"==typeof c.then)return n(a,b,ev(c),d);if(c.$$typeof===F)return n(a,b,d_(a,c),d);ex(a,c)}return null}function o(a,b,c,d,e){if("string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d)return i(b,a=a.get(c)||null,""+d,e);if("object"==typeof d&&null!==d){switch(d.$$typeof){case z:return j(b,a=a.get(null===d.key?c:d.key)||null,d,e);case A:return k(b,a=a.get(null===d.key?c:d.key)||null,d,e);case K:return o(a,b,c,d=ep(d),e)}if(S(d)||Q(d))return l(b,a=a.get(c)||null,d,e,null);if("function"==typeof d.then)return o(a,b,c,ev(d),e);if(d.$$typeof===F)return o(a,b,c,d_(b,d),e);ex(b,d)}return null}return function(i,j,k,l){try{eu=0;var p=function i(j,k,l,p){if("object"==typeof l&&null!==l&&l.type===B&&null===l.key&&void 0===l.props.ref&&(l=l.props.children),"object"==typeof l&&null!==l){switch(l.$$typeof){case z:b:{for(var q=l.key;null!==k;){if(k.key===q){if((q=l.type)===B){if(7===k.tag){c(j,k.sibling),ew(p=e(k,l.props.children),l),p.return=j,j=p;break b}}else if(k.elementType===q||"object"==typeof q&&null!==q&&q.$$typeof===K&&ep(q)===k.type){c(j,k.sibling),ew(p=e(k,l.props),l),p.return=j,j=p;break b}c(j,k);break}b(j,k),k=k.sibling}l.type===B?ew(p=di(l.props.children,j.mode,p,l.key),l):ew(p=dh(l.type,l.key,l.props,null,j.mode,p),l),p.return=j,j=p}return h(j);case A:b:{for(q=l.key;null!==k;){if(k.key===q)if(4===k.tag&&k.stateNode.containerInfo===l.containerInfo&&k.stateNode.implementation===l.implementation){c(j,k.sibling),(p=e(k,l.children||[])).return=j,j=p;break b}else{c(j,k);break}b(j,k),k=k.sibling}(p=dl(l,j.mode,p)).return=j,j=p}return h(j);case K:return i(j,k,l=ep(l),p)}if(S(l))return function(e,g,h,i){for(var j=null,k=null,l=g,p=g=0,q=null;null!==l&&p<h.length;p++){l.index>p?(q=l,l=null):q=l.sibling;var r=n(e,l,h[p],i);if(null===r){null===l&&(l=q);break}a&&l&&null===r.alternate&&b(e,l),g=f(r,g,p),null===k?j=r:k.sibling=r,k=r,l=q}if(p===h.length)return c(e,l),dF&&dy(e,p),j;if(null===l){for(;p<h.length;p++)null!==(l=m(e,h[p],i))&&(g=f(l,g,p),null===k?j=l:k.sibling=l,k=l);return dF&&dy(e,p),j}for(l=d(l);p<h.length;p++)null!==(q=o(l,e,p,h[p],i))&&(a&&null!==(r=q.alternate)&&l.delete(null===r.key?p:r.key),g=f(q,g,p),null===k?j=q:k.sibling=q,k=q);return a&&l.forEach(function(a){return b(e,a)}),dF&&dy(e,p),j}(j,k,l,p);if(Q(l)){if("function"!=typeof(q=Q(l)))throw Error(g(150));return function(e,h,i,j){if(null==i)throw Error(g(151));for(var k=null,l=null,p=h,q=h=0,r=null,s=i.next();null!==p&&!s.done;q++,s=i.next()){p.index>q?(r=p,p=null):r=p.sibling;var t=n(e,p,s.value,j);if(null===t){null===p&&(p=r);break}a&&p&&null===t.alternate&&b(e,p),h=f(t,h,q),null===l?k=t:l.sibling=t,l=t,p=r}if(s.done)return c(e,p),dF&&dy(e,q),k;if(null===p){for(;!s.done;q++,s=i.next())null!==(s=m(e,s.value,j))&&(h=f(s,h,q),null===l?k=s:l.sibling=s,l=s);return dF&&dy(e,q),k}for(p=d(p);!s.done;q++,s=i.next())null!==(s=o(p,e,q,s.value,j))&&(a&&null!==(r=s.alternate)&&p.delete(null===r.key?q:r.key),h=f(s,h,q),null===l?k=s:l.sibling=s,l=s);return a&&p.forEach(function(a){return b(e,a)}),dF&&dy(e,q),k}(j,k,l=q.call(l),p)}if("function"==typeof l.then)return i(j,k,ev(l),p);if(l.$$typeof===F)return i(j,k,d_(j,l),p);ex(j,l)}return"string"==typeof l&&""!==l||"number"==typeof l||"bigint"==typeof l?(l=""+l,null!==k&&6===k.tag?(c(j,k.sibling),(p=e(k,l)).return=j):(c(j,k),(p=dj(l,j.mode,p)).return=j),h(j=p)):c(j,k)}(i,j,k,l);return et=null,p}catch(a){if(a===ej||a===el)throw a;var q=dd(29,a,null,i.mode);return q.lanes=l,q.return=i,q}finally{}}}var ez=ey(!0),eA=ey(!1),eB=!1;function eC(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function eD(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function eE(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function eF(a,b,c){var d=a.updateQueue;if(null===d)return null;if(d=d.shared,0!=(2&ii)){var e=d.pending;return null===e?b.next=b:(b.next=e.next,e.next=b),d.pending=b,b=da(a),c9(a,null,c),b}return c6(a,d,b,c),da(a)}function eG(a,b,c){if(null!==(b=b.updateQueue)&&(b=b.shared,0!=(4194048&c))){var d=b.lanes;d&=a.pendingLanes,c|=d,b.lanes=c,aM(a,c)}}function eH(a,b){var c=a.updateQueue,d=a.alternate;if(null!==d&&c===(d=d.updateQueue)){var e=null,f=null;if(null!==(c=c.firstBaseUpdate)){do{var g={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};null===f?e=f=g:f=f.next=g,c=c.next}while(null!==c)null===f?e=f=b:f=f.next=b}else e=f=b;c={baseState:d.baseState,firstBaseUpdate:e,lastBaseUpdate:f,shared:d.shared,callbacks:d.callbacks},a.updateQueue=c;return}null===(a=c.lastBaseUpdate)?c.firstBaseUpdate=b:a.next=b,c.lastBaseUpdate=b}var eI=!1;function eJ(){if(eI){var a=ec;if(null!==a)throw a}}function eK(a,b,c,d){eI=!1;var e=a.updateQueue;eB=!1;var f=e.firstBaseUpdate,g=e.lastBaseUpdate,h=e.shared.pending;if(null!==h){e.shared.pending=null;var i=h,j=i.next;i.next=null,null===g?f=j:g.next=j,g=i;var k=a.alternate;null!==k&&(h=(k=k.updateQueue).lastBaseUpdate)!==g&&(null===h?k.firstBaseUpdate=j:h.next=j,k.lastBaseUpdate=i)}if(null!==f){var l=e.baseState;for(g=0,k=j=i=null,h=f;;){var m=-0x20000001&h.lane,n=m!==h.lane;if(n?(il&m)===m:(d&m)===m){0!==m&&m===eb&&(eI=!0),null!==k&&(k=k.next={lane:0,tag:h.tag,payload:h.payload,callback:null,next:null});b:{var o=a,p=h;switch(m=b,p.tag){case 1:if("function"==typeof(o=p.payload)){l=o.call(c,l,m);break b}l=o;break b;case 3:o.flags=-65537&o.flags|128;case 0:if(null==(m="function"==typeof(o=p.payload)?o.call(c,l,m):o))break b;l=w({},l,m);break b;case 2:eB=!0}}null!==(m=h.callback)&&(a.flags|=64,n&&(a.flags|=8192),null===(n=e.callbacks)?e.callbacks=[m]:n.push(m))}else n={lane:m,tag:h.tag,payload:h.payload,callback:h.callback,next:null},null===k?(j=k=n,i=l):k=k.next=n,g|=m;if(null===(h=h.next))if(null===(h=e.shared.pending))break;else h=(n=h).next,n.next=null,e.lastBaseUpdate=n,e.shared.pending=null}null===k&&(i=l),e.baseState=i,e.firstBaseUpdate=j,e.lastBaseUpdate=k,null===f&&(e.shared.lanes=0),iu|=g,a.lanes=g,a.memoizedState=l}}function eL(a,b){if("function"!=typeof a)throw Error(g(191,a));a.call(b)}function eM(a,b){var c=a.callbacks;if(null!==c)for(a.callbacks=null,a=0;a<c.length;a++)eL(c[a],b)}var eN=Y(null),eO=Y(0);function eP(a,b){$(eO,a=is),$(eN,b),is=a|b.baseLanes}function eQ(){$(eO,is),$(eN,eN.current)}function eR(){is=eO.current,Z(eN),Z(eO)}var eS=Y(null),eT=null;function eU(a){var b=a.alternate;$(eZ,1&eZ.current),$(eS,a),null===eT&&(null===b||null!==eN.current?eT=a:null!==b.memoizedState&&(eT=a))}function eV(a){$(eZ,eZ.current),$(eS,a),null===eT&&(eT=a)}function eW(a){22===a.tag?($(eZ,eZ.current),$(eS,a),null===eT&&(eT=a)):eX()}function eX(){$(eZ,eZ.current),$(eS,eS.current)}function eY(a){Z(eS),eT===a&&(eT=null),Z(eZ)}var eZ=Y(0);function e$(a,b){$(eS,eS.current),$(eZ,b)}function e_(a){Z(eZ),Z(eS),eT===a&&(eT=null)}function e0(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||kE(c)||kF(c)))return b}else if(19===b.tag&&"independent"!==b.memoizedProps.revealOrder){if(0!=(128&b.flags))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var e1=0,e2=null,e3=null,e4=null,e5=!1,e6=!1,e7=!1,e8=0,e9=0,fa=null,fb=0;function fc(){throw Error(g(321))}function fd(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!cz(a[c],b[c]))return!1;return!0}function fe(a,b,c,d,e,f){return e1=f,e2=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,T.H=null===a||null===a.memoizedState?gk:gl,e7=!1,f=c(d,e),e7=!1,e6&&(f=fg(b,c,d,e)),ff(a),f}function ff(a){T.H=gj;var b=null!==e3&&null!==e3.next;if(e1=0,e4=e3=e2=null,e5=!1,e9=0,fa=null,b)throw Error(g(300));null===a||gB||null!==(a=a.dependencies)&&dY(a)&&(gB=!0)}function fg(a,b,c,d){e2=a;var e=0;do{if(e6&&(fa=null),e9=0,e6=!1,25<=e)throw Error(g(301));if(e+=1,e4=e3=null,null!=a.updateQueue){var f=a.updateQueue;f.lastEffect=null,f.events=null,f.stores=null,null!=f.memoCache&&(f.memoCache.index=0)}T.H=gm,f=b(c,d)}while(e6)return f}function fh(){var a=T.H,b=a.useState()[0];return b="function"==typeof b.then?fo(b):b,a=a.useState()[0],(null!==e3?e3.memoizedState:null)!==a&&(e2.flags|=1024),b}function fi(){var a=0!==e8;return e8=0,a}function fj(a,b,c){b.updateQueue=a.updateQueue,b.flags&=-2053,a.lanes&=~c}function fk(a){if(e5){for(a=a.memoizedState;null!==a;){var b=a.queue;null!==b&&(b.pending=null),a=a.next}e5=!1}e1=0,e4=e3=e2=null,e6=!1,e9=e8=0,fa=null}function fl(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===e4?e2.memoizedState=e4=a:e4=e4.next=a,e4}function fm(){if(null===e3){var a=e2.alternate;a=null!==a?a.memoizedState:null}else a=e3.next;var b=null===e4?e2.memoizedState:e4.next;if(null!==b)e4=b,e3=a;else{if(null===a){if(null===e2.alternate)throw Error(g(467));throw Error(g(310))}a={memoizedState:(e3=a).memoizedState,baseState:e3.baseState,baseQueue:e3.baseQueue,queue:e3.queue,next:null},null===e4?e2.memoizedState=e4=a:e4=e4.next=a}return e4}function fn(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fo(a){var b=e9;return e9+=1,null===fa&&(fa=[]),a=eo(fa,a,b),b=e2,null===(null===e4?b.memoizedState:e4.next)&&(T.H=null===(b=b.alternate)||null===b.memoizedState?gk:gl),a}function fp(a){if(null!==a&&"object"==typeof a){if("function"==typeof a.then)return fo(a);if(a.$$typeof===F)return d$(a)}throw Error(g(438,String(a)))}function fq(a){var b=null,c=e2.updateQueue;if(null!==c&&(b=c.memoCache),null==b){var d=e2.alternate;null!==d&&null!==(d=d.updateQueue)&&null!=(d=d.memoCache)&&(b={data:d.data.map(function(a){return a.slice()}),index:0})}if(null==b&&(b={data:[],index:0}),null===c&&(c=fn(),e2.updateQueue=c),c.memoCache=b,void 0===(c=b.data[b.index]))for(c=b.data[b.index]=Array(a),d=0;d<a;d++)c[d]=N;return b.index++,c}function fr(a,b){return"function"==typeof b?b(a):b}function fs(a){return ft(fm(),e3,a)}function ft(a,b,c){var d=a.queue;if(null===d)throw Error(g(311));d.lastRenderedReducer=c;var e=a.baseQueue,f=d.pending;if(null!==f){if(null!==e){var h=e.next;e.next=f.next,f.next=h}b.baseQueue=e=f,d.pending=null}if(f=a.baseState,null===e)a.memoizedState=f;else{b=e.next;var i=h=null,j=null,k=b,l=!1;do{var m=-0x20000001&k.lane;if(m!==k.lane?(il&m)===m:(e1&m)===m){var n=k.revertLane;if(0===n)null!==j&&(j=j.next={lane:0,revertLane:0,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),m===eb&&(l=!0);else if((e1&n)===n){k=k.next,n===eb&&(l=!0);continue}else m={lane:0,revertLane:k.revertLane,gesture:null,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},null===j?(i=j=m,h=f):j=j.next=m,e2.lanes|=n,iu|=n;m=k.action,e7&&c(f,m),f=k.hasEagerState?k.eagerState:c(f,m)}else n={lane:m,revertLane:k.revertLane,gesture:k.gesture,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null},null===j?(i=j=n,h=f):j=j.next=n,e2.lanes|=m,iu|=m;k=k.next}while(null!==k&&k!==b)if(null===j?h=f:j.next=i,!cz(f,a.memoizedState)&&(gB=!0,l&&null!==(c=ec)))throw c;a.memoizedState=f,a.baseState=h,a.baseQueue=j,d.lastRenderedState=f}return null===e&&(d.lanes=0),[a.memoizedState,d.dispatch]}function fu(a){var b=fm(),c=b.queue;if(null===c)throw Error(g(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var h=e=e.next;do f=a(f,h.action),h=h.next;while(h!==e)cz(f,b.memoizedState)||(gB=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function fv(a,b,c){var d=e2,e=fm(),f=dF;if(f){if(void 0===c)throw Error(g(407));c=c()}else c=b();var h=!cz((e3||e).memoizedState,c);if(h&&(e.memoizedState=c,gB=!0),e=e.queue,fU(fy.bind(null,d,e,a),[a]),e.getSnapshot!==b||h||null!==e4&&1&e4.memoizedState.tag){if(d.flags|=2048,fP(9,{destroy:void 0},fx.bind(null,d,e,c,b),null),null===ij)throw Error(g(349));f||0!=(127&e1)||fw(d,b,c)}return c}function fw(a,b,c){a.flags|=16384,a={getSnapshot:b,value:c},null===(b=e2.updateQueue)?(b=fn(),e2.updateQueue=b,b.stores=[a]):null===(c=b.stores)?b.stores=[a]:c.push(a)}function fx(a,b,c,d){b.value=c,b.getSnapshot=d,fz(b)&&fA(a)}function fy(a,b,c){return c(function(){fz(b)&&fA(a)})}function fz(a){var b=a.getSnapshot;a=a.value;try{var c=b();return!cz(a,c)}catch(a){return!0}}function fA(a){var b=c8(a,2);null!==b&&iW(b,a,2)}function fB(a){var b=fl();return"function"==typeof a&&(a=a()),b.memoizedState=b.baseState=a,b.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:a},b}function fC(a,b,c,d){return a.baseState=c,ft(a,e3,"function"==typeof d?d:fr)}function fD(a,b,c,d,e){if(gg(a))throw Error(g(485));if(null!==(a=b.action)){var f={payload:e,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){f.listeners.push(a)}};null!==T.T?c(!0):f.isTransition=!1,d(f),null===(c=b.pending)?(f.next=b.pending=f,fE(b,f)):(f.next=c.next,b.pending=c.next=f)}}function fE(a,b){var c=b.action,d=b.payload,e=a.state;if(b.isTransition){var f=T.T,g={};g.types=null!==f?f.types:null,T.T=g;try{var h=c(e,d),i=T.S;null!==i&&i(g,h),fF(a,b,h)}catch(c){fH(a,b,c)}finally{null!==f&&null!==g.types&&(f.types=g.types),T.T=f}}else try{f=c(e,d),fF(a,b,f)}catch(c){fH(a,b,c)}}function fF(a,b,c){null!==c&&"object"==typeof c&&"function"==typeof c.then?c.then(function(c){fG(a,b,c)},function(c){return fH(a,b,c)}):fG(a,b,c)}function fG(a,b,c){b.status="fulfilled",b.value=c,fI(b),a.state=c,null!==(b=a.pending)&&((c=b.next)===b?a.pending=null:(c=c.next,b.next=c,fE(a,c)))}function fH(a,b,c){var d=a.pending;if(a.pending=null,null!==d){d=d.next;do b.status="rejected",b.reason=c,fI(b),b=b.next;while(b!==d)}a.action=null}function fI(a){a=a.listeners;for(var b=0;b<a.length;b++)(0,a[b])()}function fJ(a,b){return b}function fK(a,b){if(dF){var c=ij.formState;if(null!==c){b:{var d=e2;if(dF){if(dE){c:{for(var e=dE,f=dH;8!==e.nodeType;)if(!f||null===(e=kG(e.nextSibling))){e=null;break c}e="F!"===(f=e.data)||"F"===f?e:null}if(e){dE=kG(e.nextSibling),d="F!"===e.data;break b}}dJ(d)}d=!1}d&&(b=c[0])}}return(c=fl()).memoizedState=c.baseState=b,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fJ,lastRenderedState:b},c.queue=d,c=gd.bind(null,e2,d),d.dispatch=c,d=fB(!1),f=gf.bind(null,e2,!1,d.queue),d=fl(),e={state:b,dispatch:null,action:a,pending:null},d.queue=e,c=fD.bind(null,e2,e,f,c),e.dispatch=c,d.memoizedState=a,[b,c,!1]}function fL(a){return fM(fm(),e3,a)}function fM(a,b,c){if(b=ft(a,b,fJ)[0],a=fs(fr)[0],"object"==typeof b&&null!==b&&"function"==typeof b.then)try{var d=fo(b)}catch(a){if(a===ej)throw el;throw a}else d=b;var e=(b=fm()).queue,f=e.dispatch;return c!==b.memoizedState&&(e2.flags|=2048,fP(9,{destroy:void 0},fN.bind(null,e,c),null)),[d,f,a]}function fN(a,b){a.action=b}function fO(a){var b=fm(),c=e3;if(null!==c)return fM(b,c,a);fm(),b=b.memoizedState;var d=(c=fm()).queue.dispatch;return c.memoizedState=a,[b,d,!1]}function fP(a,b,c,d){return a={tag:a,create:c,deps:d,inst:b,next:null},null===(b=e2.updateQueue)&&(b=fn(),e2.updateQueue=b),null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function fQ(){return fm().memoizedState}function fR(a,b,c,d){var e=fl();e2.flags|=a,e.memoizedState=fP(1|b,{destroy:void 0},c,void 0===d?null:d)}function fS(a,b,c,d){var e=fm();d=void 0===d?null:d;var f=e.memoizedState.inst;null!==e3&&null!==d&&fd(d,e3.memoizedState.deps)?e.memoizedState=fP(b,f,c,d):(e2.flags|=a,e.memoizedState=fP(1|b,f,c,d))}function fT(a,b){fR(8390656,8,a,b)}function fU(a,b){fS(2048,8,a,b)}function fV(a){var b=fm().memoizedState,c={ref:b,nextImpl:a};e2.flags|=4;var d=e2.updateQueue;if(null===d)d=fn(),e2.updateQueue=d,d.events=[c];else{var e=d.events;null===e?d.events=[c]:e.push(c)}return function(){if(0!=(2&ii))throw Error(g(440));return b.impl.apply(void 0,arguments)}}function fW(a,b){return fS(4,2,a,b)}function fX(a,b){return fS(4,4,a,b)}function fY(a,b){if("function"==typeof b){var c=b(a=a());return function(){"function"==typeof c?c():b(null)}}if(null!=b)return b.current=a=a(),function(){b.current=null}}function fZ(a,b,c){c=null!=c?c.concat([a]):null,fS(4,4,fY.bind(null,b,a),c)}function f$(){}function f_(a,b){var c=fm();b=void 0===b?null:b;var d=c.memoizedState;return null!==b&&fd(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function f0(a,b){var c=fm();b=void 0===b?null:b;var d=c.memoizedState;return null!==b&&fd(b,d[1])?d[0]:(c.memoizedState=[d=a(),b],d)}function f1(a,b,c){return void 0===c||0!=(0x40000000&e1)&&0==(261930&il)?a.memoizedState=b:(a.memoizedState=c,a=iU(),e2.lanes|=a,iu|=a,c)}function f2(a,b,c,d){return cz(c,b)?c:null!==eN.current?(cz(a=f1(a,c,d),b)||(gB=!0),a):0==(42&e1)||0!=(0x40000000&e1)&&0==(261930&il)?(gB=!0,a.memoizedState=c):(a=iU(),e2.lanes|=a,iu|=a,b)}function f3(a,b,c,d,e){var f=U.p;U.p=0!==f&&8>f?f:8;var g=T.T,h={};h.types=null!==g?g.types:null,T.T=h,gf(a,!1,b,c);try{var i=e(),j=T.S;if(null!==j&&j(h,i),null!==i&&"object"==typeof i&&"function"==typeof i.then){var k,l,m=(k=[],l={status:"pending",value:null,reason:null,then:function(a){k.push(a)}},i.then(function(){l.status="fulfilled",l.value=d;for(var a=0;a<k.length;a++)(0,k[a])(d)},function(a){for(l.status="rejected",l.reason=a,a=0;a<k.length;a++)(0,k[a])(void 0)}),l);ge(a,b,m,iT(a))}else ge(a,b,d,iT(a))}catch(c){ge(a,b,{then:function(){},status:"rejected",reason:c},iT())}finally{U.p=f,null!==g&&null!==h.types&&(g.types=h.types),T.T=g}}function f4(){}function f5(a,b,c,d){if(5!==a.tag)throw Error(g(476));var e=f6(a).queue;f3(a,e,b,V,null===c?f4:function(){return f7(a),c(d)})}function f6(a){var b=a.memoizedState;if(null!==b)return b;var c={};return(b={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:V},next:null}).next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fr,lastRenderedState:c},next:null},a.memoizedState=b,null!==(a=a.alternate)&&(a.memoizedState=b),b}function f7(a){var b=f6(a);null===b.next&&(b=a.alternate.memoizedState),ge(a,b.next.queue,{},iT())}function f8(){return d$(le)}function f9(){return fm().memoizedState}function ga(){return fm().memoizedState}function gb(a){for(var b=a.return;null!==b;){switch(b.tag){case 24:case 3:var c=iT(),d=eF(b,a=eE(c),c);null!==d&&(iW(d,b,c),eG(d,b,c)),b={cache:d5()},a.payload=b;return}b=b.return}}function gc(a,b,c){var d=iT();c={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},gg(a)?gh(b,c):null!==(c=c7(a,b,c,d))&&(iW(c,a,d),gi(c,b,d))}function gd(a,b,c){ge(a,b,c,iT())}function ge(a,b,c,d){var e={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(gg(a))gh(b,e);else{var f=a.alternate;if(0===a.lanes&&(null===f||0===f.lanes)&&null!==(f=b.lastRenderedReducer))try{var g=b.lastRenderedState,h=f(g,c);if(e.hasEagerState=!0,e.eagerState=h,cz(h,g))return c6(a,b,e,0),null===ij&&c5(),!1}catch(a){}finally{}if(null!==(c=c7(a,b,e,d)))return iW(c,a,d),gi(c,b,d),!0}return!1}function gf(a,b,c,d){if(d={lane:2,revertLane:jF(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},gg(a)){if(b)throw Error(g(479))}else null!==(b=c7(a,c,d,2))&&iW(b,a,2)}function gg(a){var b=a.alternate;return a===e2||null!==b&&b===e2}function gh(a,b){e6=e5=!0;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}function gi(a,b,c){if(0!=(4194048&c)){var d=b.lanes;d&=a.pendingLanes,b.lanes=c|=d,aM(a,c)}}var gj={readContext:d$,use:fp,useCallback:fc,useContext:fc,useEffect:fc,useImperativeHandle:fc,useLayoutEffect:fc,useInsertionEffect:fc,useMemo:fc,useReducer:fc,useRef:fc,useState:fc,useDebugValue:fc,useDeferredValue:fc,useTransition:fc,useSyncExternalStore:fc,useId:fc,useHostTransitionStatus:fc,useFormState:fc,useActionState:fc,useOptimistic:fc,useMemoCache:fc,useCacheRefresh:fc};gj.useEffectEvent=fc;var gk={readContext:d$,use:fp,useCallback:function(a,b){return fl().memoizedState=[a,void 0===b?null:b],a},useContext:d$,useEffect:fT,useImperativeHandle:function(a,b,c){c=null!=c?c.concat([a]):null,fR(4194308,4,fY.bind(null,b,a),c)},useLayoutEffect:function(a,b){return fR(4194308,4,a,b)},useInsertionEffect:function(a,b){fR(4,2,a,b)},useMemo:function(a,b){var c=fl();b=void 0===b?null:b;var d=a();return c.memoizedState=[d,b],d},useReducer:function(a,b,c){var d=fl();if(void 0!==c)var e=c(b);else e=b;return d.memoizedState=d.baseState=e,d.queue=a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:e},a=a.dispatch=gc.bind(null,e2,a),[d.memoizedState,a]},useRef:function(a){return fl().memoizedState={current:a}},useState:function(a){var b=(a=fB(a)).queue,c=gd.bind(null,e2,b);return b.dispatch=c,[a.memoizedState,c]},useDebugValue:f$,useDeferredValue:function(a,b){return f1(fl(),a,b)},useTransition:function(){var a=fB(!1);return a=f3.bind(null,e2,a.queue,!0,!1),fl().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,b,c){var d=e2,e=fl();if(dF){if(void 0===c)throw Error(g(407));c=c()}else{if(c=b(),null===ij)throw Error(g(349));0!=(127&il)||fw(d,b,c)}e.memoizedState=c;var f={value:c,getSnapshot:b};return e.queue=f,fT(fy.bind(null,d,f,a),[a]),d.flags|=2048,fP(9,{destroy:void 0},fx.bind(null,d,f,c,b),null),c},useId:function(){var a=fl(),b=ij.identifierPrefix;if(dF){var c=dx,d=dw;b="_"+b+"R_"+(c=(d&~(1<<32-az(d)-1)).toString(32)+c),0<(c=e8++)&&(b+="H"+c.toString(32)),b+="_"}else b="_"+b+"r_"+(c=fb++).toString(32)+"_";return a.memoizedState=b},useHostTransitionStatus:f8,useFormState:fK,useActionState:fK,useOptimistic:function(a){var b=fl();b.memoizedState=b.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return b.queue=c,b=gf.bind(null,e2,!0,c),c.dispatch=b,[a,b]},useMemoCache:fq,useCacheRefresh:function(){return fl().memoizedState=gb.bind(null,e2)},useEffectEvent:function(a){var b=fl(),c={impl:a};return b.memoizedState=c,function(){if(0!=(2&ii))throw Error(g(440));return c.impl.apply(void 0,arguments)}}},gl={readContext:d$,use:fp,useCallback:f_,useContext:d$,useEffect:fU,useImperativeHandle:fZ,useInsertionEffect:fW,useLayoutEffect:fX,useMemo:f0,useReducer:fs,useRef:fQ,useState:function(){return fs(fr)},useDebugValue:f$,useDeferredValue:function(a,b){return f2(fm(),e3.memoizedState,a,b)},useTransition:function(){var a=fs(fr)[0],b=fm().memoizedState;return["boolean"==typeof a?a:fo(a),b]},useSyncExternalStore:fv,useId:f9,useHostTransitionStatus:f8,useFormState:fL,useActionState:fL,useOptimistic:function(a,b){return fC(fm(),e3,a,b)},useMemoCache:fq,useCacheRefresh:ga};gl.useEffectEvent=fV;var gm={readContext:d$,use:fp,useCallback:f_,useContext:d$,useEffect:fU,useImperativeHandle:fZ,useInsertionEffect:fW,useLayoutEffect:fX,useMemo:f0,useReducer:fu,useRef:fQ,useState:function(){return fu(fr)},useDebugValue:f$,useDeferredValue:function(a,b){var c=fm();return null===e3?f1(c,a,b):f2(c,e3.memoizedState,a,b)},useTransition:function(){var a=fu(fr)[0],b=fm().memoizedState;return["boolean"==typeof a?a:fo(a),b]},useSyncExternalStore:fv,useId:f9,useHostTransitionStatus:f8,useFormState:fO,useActionState:fO,useOptimistic:function(a,b){var c=fm();return null!==e3?fC(c,e3,a,b):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:fq,useCacheRefresh:ga};function gn(a,b,c,d){c=null==(c=c(d,b=a.memoizedState))?b:w({},b,c),a.memoizedState=c,0===a.lanes&&(a.updateQueue.baseState=c)}gm.useEffectEvent=fV;var go={enqueueSetState:function(a,b,c){a=a._reactInternals;var d=iT(),e=eE(d);e.payload=b,null!=c&&(e.callback=c),null!==(b=eF(a,e,d))&&(iW(b,a,d),eG(b,a,d))},enqueueReplaceState:function(a,b,c){a=a._reactInternals;var d=iT(),e=eE(d);e.tag=1,e.payload=b,null!=c&&(e.callback=c),null!==(b=eF(a,e,d))&&(iW(b,a,d),eG(b,a,d))},enqueueForceUpdate:function(a,b){a=a._reactInternals;var c=iT(),d=eE(c);d.tag=2,null!=b&&(d.callback=b),null!==(b=eF(a,d,c))&&(iW(b,a,c),eG(b,a,c))}};function gp(a,b,c,d,e,f,g){return"function"==typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||!cA(c,d)||!cA(e,f)}function gq(a,b,c,d){a=b.state,"function"==typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"==typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&go.enqueueReplaceState(b,b.state,null)}function gr(a,b){var c=b;if("ref"in b)for(var d in c={},b)"ref"!==d&&(c[d]=b[d]);if(a=a.defaultProps)for(var e in c===b&&(c=w({},c)),a)void 0===c[e]&&(c[e]=a[e]);return c}function gs(a){c1(a)}function gt(a){console.error(a)}function gu(a){c1(a)}function gv(a,b){try{(0,a.onUncaughtError)(b.value,{componentStack:b.stack})}catch(a){setTimeout(function(){throw a})}}function gw(a,b,c){try{(0,a.onCaughtError)(c.value,{componentStack:c.stack,errorBoundary:1===b.tag?b.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function gx(a,b,c){return(c=eE(c)).tag=3,c.payload={element:null},c.callback=function(){gv(a,b)},c}function gy(a){return(a=eE(a)).tag=3,a}function gz(a,b,c,d){var e=c.type.getDerivedStateFromError;if("function"==typeof e){var f=d.value;a.payload=function(){return e(f)},a.callback=function(){gw(b,c,d)}}var g=c.stateNode;null!==g&&"function"==typeof g.componentDidCatch&&(a.callback=function(){gw(b,c,d),"function"!=typeof e&&(null===iG?iG=new Set([this]):iG.add(this));var a=d.stack;this.componentDidCatch(d.value,{componentStack:null!==a?a:""})})}var gA=Error(g(461)),gB=!1;function gC(a,b,c,d){b.child=null===a?eA(b,null,c,d):ez(b,a.child,c,d)}function gD(a,b,c,d,e){c=c.render;var f=b.ref;if("ref"in d){var g={};for(var h in d)"ref"!==h&&(g[h]=d[h])}else g=d;return(dZ(b),d=fe(a,b,c,g,f,e),h=fi(),null===a||gB)?(dF&&h&&dA(b),b.flags|=1,gC(a,b,d,e),b.child):(fj(a,b,e),g0(a,b,e))}function gE(a,b,c,d,e){if(null===a){var f=c.type;return"function"!=typeof f||de(f)||void 0!==f.defaultProps||null!==c.compare?((a=dh(c.type,null,d,b,b.mode,e)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=f,gF(a,b,f,d,e))}if(f=a.child,!g1(a,e)){var g=f.memoizedProps;if((c=null!==(c=c.compare)?c:cA)(g,d)&&a.ref===b.ref)return g0(a,b,e)}return b.flags|=1,(a=df(f,d)).ref=b.ref,a.return=b,b.child=a}function gF(a,b,c,d,e){if(null!==a){var f=a.memoizedProps;if(cA(f,d)&&a.ref===b.ref)if(gB=!1,b.pendingProps=d=f,!g1(a,e))return b.lanes=a.lanes,g0(a,b,e);else 0!=(131072&a.flags)&&(gB=!0)}return gM(a,b,c,d,e)}function gG(a,b,c,d){var e=d.children,f=null!==a?a.memoizedState:null;if(null===a&&null===b.stateNode&&(b.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===d.mode){if(0!=(128&b.flags)){if(f=null!==f?f.baseLanes|c:c,null!==a){for(e=0,d=b.child=a.child;null!==d;)e=e|d.lanes|d.childLanes,d=d.sibling;d=e&~f}else d=0,b.child=null;return gI(a,b,f,c,d)}if(0==(0x20000000&c))return d=b.lanes=0x20000000,gI(a,b,null!==f?f.baseLanes|c:c,c,d);b.memoizedState={baseLanes:0,cachePool:null},null!==a&&eh(b,null!==f?f.cachePool:null),null!==f?eP(b,f):eQ(),eW(b)}else null!==f?(eh(b,f.cachePool),eP(b,f),eX(),b.memoizedState=null):(null!==a&&eh(b,null),eQ(),eX());return gC(a,b,e,c),b.child}function gH(a,b){return null!==a&&22===a.tag||null!==b.stateNode||(b.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),b.sibling}function gI(a,b,c,d,e){var f=eg();return b.memoizedState={baseLanes:c,cachePool:f=null===f?null:{parent:d4._currentValue,pool:f}},null!==a&&eh(b,null),eQ(),eW(b),null!==a&&dX(a,b,d,!0),b.childLanes=e,null}function gJ(a,b){return(b=gV({mode:b.mode,children:b.children},a.mode)).ref=a.ref,a.child=b,b.return=a,b}function gK(a,b,c){return ez(b,a.child,null,c),a=gJ(b,b.pendingProps),a.flags|=2,eY(b),b.memoizedState=null,a}function gL(a,b){var c=b.ref;if(null===c)null!==a&&null!==a.ref&&(b.flags|=4194816);else{if("function"!=typeof c&&"object"!=typeof c)throw Error(g(284));(null===a||a.ref!==c)&&(b.flags|=4194816)}}function gM(a,b,c,d,e){return(dZ(b),c=fe(a,b,c,d,void 0,e),d=fi(),null===a||gB)?(dF&&d&&dA(b),b.flags|=1,gC(a,b,c,e),b.child):(fj(a,b,e),g0(a,b,e))}function gN(a,b,c,d,e,f){return(dZ(b),b.updateQueue=null,c=fg(b,d,c,e),ff(a),d=fi(),null===a||gB)?(dF&&d&&dA(b),b.flags|=1,gC(a,b,c,f),b.child):(fj(a,b,f),g0(a,b,f))}function gO(a,b,c,d,e){if(dZ(b),null===b.stateNode){var f=db,g=c.contextType;"object"==typeof g&&null!==g&&(f=d$(g)),b.memoizedState=null!==(f=new c(d,f)).state&&void 0!==f.state?f.state:null,f.updater=go,b.stateNode=f,f._reactInternals=b,(f=b.stateNode).props=d,f.state=b.memoizedState,f.refs={},eC(b),g=c.contextType,f.context="object"==typeof g&&null!==g?d$(g):db,f.state=b.memoizedState,"function"==typeof(g=c.getDerivedStateFromProps)&&(gn(b,c,g,d),f.state=b.memoizedState),"function"==typeof c.getDerivedStateFromProps||"function"==typeof f.getSnapshotBeforeUpdate||"function"!=typeof f.UNSAFE_componentWillMount&&"function"!=typeof f.componentWillMount||(g=f.state,"function"==typeof f.componentWillMount&&f.componentWillMount(),"function"==typeof f.UNSAFE_componentWillMount&&f.UNSAFE_componentWillMount(),g!==f.state&&go.enqueueReplaceState(f,f.state,null),eK(b,d,f,e),eJ(),f.state=b.memoizedState),"function"==typeof f.componentDidMount&&(b.flags|=4194308),d=!0}else if(null===a){f=b.stateNode;var h=b.memoizedProps,i=gr(c,h);f.props=i;var j=f.context,k=c.contextType;g=db,"object"==typeof k&&null!==k&&(g=d$(k));var l=c.getDerivedStateFromProps;k="function"==typeof l||"function"==typeof f.getSnapshotBeforeUpdate,h=b.pendingProps!==h,k||"function"!=typeof f.UNSAFE_componentWillReceiveProps&&"function"!=typeof f.componentWillReceiveProps||(h||j!==g)&&gq(b,f,d,g),eB=!1;var m=b.memoizedState;f.state=m,eK(b,d,f,e),eJ(),j=b.memoizedState,h||m!==j||eB?("function"==typeof l&&(gn(b,c,l,d),j=b.memoizedState),(i=eB||gp(b,c,i,d,m,j,g))?(k||"function"!=typeof f.UNSAFE_componentWillMount&&"function"!=typeof f.componentWillMount||("function"==typeof f.componentWillMount&&f.componentWillMount(),"function"==typeof f.UNSAFE_componentWillMount&&f.UNSAFE_componentWillMount()),"function"==typeof f.componentDidMount&&(b.flags|=4194308)):("function"==typeof f.componentDidMount&&(b.flags|=4194308),b.memoizedProps=d,b.memoizedState=j),f.props=d,f.state=j,f.context=g,d=i):("function"==typeof f.componentDidMount&&(b.flags|=4194308),d=!1)}else{f=b.stateNode,eD(a,b),k=gr(c,g=b.memoizedProps),f.props=k,l=b.pendingProps,m=f.context,j=c.contextType,i=db,"object"==typeof j&&null!==j&&(i=d$(j)),(j="function"==typeof(h=c.getDerivedStateFromProps)||"function"==typeof f.getSnapshotBeforeUpdate)||"function"!=typeof f.UNSAFE_componentWillReceiveProps&&"function"!=typeof f.componentWillReceiveProps||(g!==l||m!==i)&&gq(b,f,d,i),eB=!1,m=b.memoizedState,f.state=m,eK(b,d,f,e),eJ();var n=b.memoizedState;g!==l||m!==n||eB||null!==a&&null!==a.dependencies&&dY(a.dependencies)?("function"==typeof h&&(gn(b,c,h,d),n=b.memoizedState),(k=eB||gp(b,c,k,d,m,n,i)||null!==a&&null!==a.dependencies&&dY(a.dependencies))?(j||"function"!=typeof f.UNSAFE_componentWillUpdate&&"function"!=typeof f.componentWillUpdate||("function"==typeof f.componentWillUpdate&&f.componentWillUpdate(d,n,i),"function"==typeof f.UNSAFE_componentWillUpdate&&f.UNSAFE_componentWillUpdate(d,n,i)),"function"==typeof f.componentDidUpdate&&(b.flags|=4),"function"==typeof f.getSnapshotBeforeUpdate&&(b.flags|=1024)):("function"!=typeof f.componentDidUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=4),"function"!=typeof f.getSnapshotBeforeUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=1024),b.memoizedProps=d,b.memoizedState=n),f.props=d,f.state=n,f.context=i,d=k):("function"!=typeof f.componentDidUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=4),"function"!=typeof f.getSnapshotBeforeUpdate||g===a.memoizedProps&&m===a.memoizedState||(b.flags|=1024),d=!1)}return f=d,gL(a,b),d=0!=(128&b.flags),f||d?(f=b.stateNode,c=d&&"function"!=typeof c.getDerivedStateFromError?null:f.render(),b.flags|=1,null!==a&&d?(b.child=ez(b,a.child,null,e),b.child=ez(b,null,c,e)):gC(a,b,c,e),b.memoizedState=f.state,a=b.child):a=g0(a,b,e),a}function gP(a,b,c,d){return dN(),b.flags|=256,gC(a,b,c,d),b.child}var gQ={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function gR(a){return{baseLanes:a,cachePool:ei()}}function gS(a,b,c){return a=null!==a?a.childLanes&~c:0,b&&(a|=ix),a}function gT(a,b,c){var d,e=b.pendingProps,f=!1,h=0!=(128&b.flags);if((d=h)||(d=(null===a||null!==a.memoizedState)&&0!=(2&eZ.current)),d&&(f=!0,b.flags&=-129),d=0!=(32&b.flags),b.flags&=-33,null===a){if(dF){if(f?eU(b):eX(),(a=dE)?null!==(a=null!==(a=kD(a,dH))&&"&"!==a.data?a:null)&&(b.memoizedState={dehydrated:a,treeContext:null!==dv?{id:dw,overflow:dx}:null,retryLane:0x20000000,hydrationErrors:null},(c=dk(a)).return=b,b.child=c,dD=b,dE=null):a=null,null===a)throw dJ(b);return kF(a)?b.lanes=32:b.lanes=0x20000000,null}var i=e.children;return(e=e.fallback,f)?(eX(),i=gV({mode:"hidden",children:i},f=b.mode),e=di(e,f,c,null),i.return=b,e.return=b,i.sibling=e,b.child=i,(e=b.child).memoizedState=gR(c),e.childLanes=gS(a,d,c),b.memoizedState=gQ,gH(null,e)):(eU(b),gU(b,i))}var j=a.memoizedState;if(null!==j&&null!==(i=j.dehydrated)){if(h)256&b.flags?(eU(b),b.flags&=-257,b=gW(a,b,c)):null!==b.memoizedState?(eX(),b.child=a.child,b.flags|=128,b=null):(eX(),i=e.fallback,f=b.mode,e=gV({mode:"visible",children:e.children},f),i=di(i,f,c,null),i.flags|=2,e.return=b,i.return=b,e.sibling=i,b.child=e,ez(b,a.child,null,c),(e=b.child).memoizedState=gR(c),e.childLanes=gS(a,d,c),b.memoizedState=gQ,b=gH(null,e));else if(eU(b),kF(i)){if(d=i.nextSibling&&i.nextSibling.dataset)var k=d.dgst;d=k,(e=Error(g(419))).stack="",e.digest=d,dP({value:e,source:null,stack:null}),b=gW(a,b,c)}else if(gB||dX(a,b,c,!1),d=0!=(c&a.childLanes),gB||d){if(null!==(d=ij)&&0!==(e=aN(d,c))&&e!==j.retryLane)throw j.retryLane=e,c8(a,e),iW(d,a,e),gA;kE(i)||i5(),b=gW(a,b,c)}else kE(i)?(b.flags|=192,b.child=a.child,b=null):(a=j.treeContext,dE=kG(i.nextSibling),dD=b,dF=!0,dG=null,dH=!1,null!==a&&dC(b,a),b=gU(b,e.children),b.flags|=4096);return b}return f?(eX(),i=e.fallback,f=b.mode,k=(j=a.child).sibling,(e=df(j,{mode:"hidden",children:e.children})).subtreeFlags=0x7e00000&j.subtreeFlags,null!==k?i=df(k,i):(i=di(i,f,c,null),i.flags|=2),i.return=b,e.return=b,e.sibling=i,b.child=e,gH(null,e),e=b.child,null===(i=a.child.memoizedState)?i=gR(c):(null!==(f=i.cachePool)?(j=d4._currentValue,f=f.parent!==j?{parent:j,pool:j}:f):f=ei(),i={baseLanes:i.baseLanes|c,cachePool:f}),e.memoizedState=i,e.childLanes=gS(a,d,c),b.memoizedState=gQ,gH(a.child,e)):(eU(b),a=(c=a.child).sibling,(c=df(c,{mode:"visible",children:e.children})).return=b,c.sibling=null,null!==a&&(null===(d=b.deletions)?(b.deletions=[a],b.flags|=16):d.push(a)),b.child=c,b.memoizedState=null,c)}function gU(a,b){return(b=gV({mode:"visible",children:b},a.mode)).return=a,a.child=b}function gV(a,b){return(a=dd(22,a,null,b)).lanes=0,a}function gW(a,b,c){return ez(b,a.child,null,c),a=gU(b,b.pendingProps.children),a.flags|=2,b.memoizedState=null,a}function gX(a,b,c){a.lanes|=b;var d=a.alternate;null!==d&&(d.lanes|=b),dV(a.return,b,c)}function gY(a){for(var b=null;null!==a;){var c=a.alternate;null!==c&&null===e0(c)&&(b=a),a=a.sibling}return b}function gZ(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:e,treeForkCount:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailMode=e,g.treeForkCount=f)}function g$(a){var b=a.child;for(a.child=null;null!==b;){var c=b.sibling;b.sibling=a.child,a.child=b,b=c}}function g_(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;d=d.children;var g=eZ.current;if(128&b.flags)return e$(b,g),null;var h=0!=(2&g);if(h?(g=1&g|2,b.flags|=128):g&=1,e$(b,g),"backwards"===e&&null!==a?(g$(a),gC(a,b,d,c),g$(a)):gC(a,b,d,c),d=dF?ds:0,!h&&null!==a&&0!=(128&a.flags))b:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&gX(a,c,b);else if(19===a.tag)gX(a,c,b);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break;for(;null===a.sibling;){if(null===a.return||a.return===b)break b;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(e){case"backwards":null===(c=gY(b.child))?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null,g$(b)),gZ(b,!0,e,null,f,d);break;case"unstable_legacy-backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===e0(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}gZ(b,!0,c,null,f,d);break;case"together":gZ(b,!1,null,null,void 0,d);break;case"independent":b.memoizedState=null;break;default:null===(c=gY(b.child))?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),gZ(b,!1,e,c,f,d)}return b.child}function g0(a,b,c){if(null!==a&&(b.dependencies=a.dependencies),iu|=b.lanes,0==(c&b.childLanes)){if(null===a)return null;else if(dX(a,b,c,!1),0==(c&b.childLanes))return null}if(null!==a&&b.child!==a.child)throw Error(g(153));if(null!==b.child){for(c=df(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=df(a,a.pendingProps)).return=b;c.sibling=null}return b.child}function g1(a,b){return 0!=(a.lanes&b)||!!(null!==(a=a.dependencies)&&dY(a))}function g2(a,b,c){if(null!==a)if(a.memoizedProps!==b.pendingProps)gB=!0;else{if(!g1(a,c)&&0==(128&b.flags))return gB=!1,function(a,b,c){switch(b.tag){case 3:ad(b,b.stateNode.containerInfo),dT(b,d4,a.memoizedState.cache),dN();break;case 27:case 5:af(b);break;case 4:ad(b,b.stateNode.containerInfo);break;case 10:dT(b,b.type,b.memoizedProps.value);break;case 31:if(null!==b.memoizedState)return b.flags|=128,eV(b),null;break;case 13:var d=b.memoizedState;if(null!==d){if(null!==d.dehydrated)return eU(b),b.flags|=128,null;if(0!=(c&b.child.childLanes))return gT(a,b,c);return eU(b),null!==(a=g0(a,b,c))?a.sibling:null}eU(b);break;case 19:if(128&b.flags)return g_(a,b,c);var e=0!=(128&a.flags);if((d=0!=(c&b.childLanes))||(dX(a,b,c,!1),d=0!=(c&b.childLanes)),e){if(d)return g_(a,b,c);b.flags|=128}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null,e.lastEffect=null),e$(b,eZ.current),!d)return null;break;case 22:return b.lanes=0,gG(a,b,c,b.pendingProps);case 24:dT(b,d4,a.memoizedState.cache)}return g0(a,b,c)}(a,b,c);gB=0!=(131072&a.flags)}else gB=!1,dF&&0!=(1048576&b.flags)&&dz(b,ds,b.index);switch(b.lanes=0,b.tag){case 16:b:{var d=b.pendingProps;if(a=ep(b.elementType),b.type=a,"function"==typeof a)de(a)?(d=gr(a,d),b.tag=1,b=gO(null,b,a,d,c)):(b.tag=0,b=gM(null,b,a,d,c));else{if(null!=a){var e=a.$$typeof;if(e===G){b.tag=11,b=gD(null,b,a,d,c);break b}if(e===J){b.tag=14,b=gE(null,b,a,d,c);break b}}throw Error(g(306,b=function a(b){if(null==b)return null;if("function"==typeof b)return b.$$typeof===R?null:b.displayName||b.name||null;if("string"==typeof b)return b;switch(b){case B:return"Fragment";case D:return"Profiler";case C:return"StrictMode";case H:return"Suspense";case I:return"SuspenseList";case L:return"Activity";case O:return"ViewTransition"}if("object"==typeof b)switch(b.$$typeof){case A:return"Portal";case F:return b.displayName||"Context";case E:return(b._context.displayName||"Context")+".Consumer";case G:var c=b.render;return(b=b.displayName)||(b=""!==(b=c.displayName||c.name||"")?"ForwardRef("+b+")":"ForwardRef"),b;case J:return null!==(c=b.displayName||null)?c:a(b.type)||"Memo";case K:c=b._payload,b=b._init;try{return a(b(c))}catch(a){}}return null}(a)||a,""))}}return b;case 0:return gM(a,b,b.type,b.pendingProps,c);case 1:return e=gr(d=b.type,b.pendingProps),gO(a,b,d,e,c);case 3:b:{if(ad(b,b.stateNode.containerInfo),null===a)throw Error(g(387));d=b.pendingProps;var f=b.memoizedState;e=f.element,eD(a,b),eK(b,d,null,c);var h=b.memoizedState;if(dT(b,d4,d=h.cache),d!==f.cache&&dW(b,[d4],c,!0),eJ(),d=h.element,f.isDehydrated)if(f={element:d,isDehydrated:!1,cache:h.cache},b.updateQueue.baseState=f,b.memoizedState=f,256&b.flags){b=gP(a,b,d,c);break b}else if(d!==e){dP(e=dn(Error(g(424)),b)),b=gP(a,b,d,c);break b}else for(dE=kG((a=9===(a=b.stateNode.containerInfo).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).firstChild),dD=b,dF=!0,dG=null,dH=!0,c=eA(b,null,d,c),b.child=c;c;)c.flags=-3&c.flags|4096,c=c.sibling;else{if(dN(),d===e){b=g0(a,b,c);break b}gC(a,b,d,c)}b=b.child}return b;case 26:return gL(a,b),null===a?(c=kS(b.type,null,b.pendingProps,null))?b.memoizedState=c:dF||(c=b.type,a=b.pendingProps,(d=j5(ab.current).createElement(c))[aT]=b,d[aU]=a,j1(d,c,a),a4(d),b.stateNode=d):b.memoizedState=kS(b.type,a.memoizedProps,b.pendingProps,a.memoizedState),null;case 27:return af(b),null===a&&dF&&(d=b.stateNode=kK(b.type,b.pendingProps,ab.current),dD=b,dH=!0,e=dE,kf(b.type)?(kH=e,dE=kG(d.firstChild)):dE=e),gC(a,b,b.pendingProps.children,c),gL(a,b),null===a&&(b.flags|=4194304),b.child;case 5:return null===a&&dF&&((e=d=dE)&&(null!==(d=function(a,b,c,d){for(;1===a.nodeType;){if(a.nodeName.toLowerCase()!==b.toLowerCase()){if(!d&&("INPUT"!==a.nodeName||"hidden"!==a.type))break}else if(d){if(!a[a$])switch(b){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if("stylesheet"===(e=a.getAttribute("rel"))&&a.hasAttribute("data-precedence")||e!==c.rel||a.getAttribute("href")!==(null==c.href||""===c.href?null:c.href)||a.getAttribute("crossorigin")!==(null==c.crossOrigin?null:c.crossOrigin)||a.getAttribute("title")!==(null==c.title?null:c.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(((e=a.getAttribute("src"))!==(null==c.src?null:c.src)||a.getAttribute("type")!==(null==c.type?null:c.type)||a.getAttribute("crossorigin")!==(null==c.crossOrigin?null:c.crossOrigin))&&e&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else{if("input"!==b||"hidden"!==a.type)return a;var e=null==c.name?null:""+c.name;if("hidden"===c.type&&a.getAttribute("name")===e)return a}if(null===(a=kG(a.nextSibling)))break}return null}(d,b.type,b.pendingProps,dH))?(b.stateNode=d,dD=b,dE=kG(d.firstChild),dH=!1,e=!0):e=!1),e||dJ(b)),af(b),e=b.type,f=b.pendingProps,h=null!==a?a.memoizedProps:null,d=f.children,j8(e,f)?d=null:null!==h&&j8(e,h)&&(b.flags|=32),null!==b.memoizedState&&(le._currentValue=e=fe(a,b,fh,null,null,c)),gL(a,b),gC(a,b,d,c),b.child;case 6:return null===a&&dF&&((a=c=dE)&&(null!==(c=function(a,b,c){if(""===b)return null;for(;3!==a.nodeType;)if((1!==a.nodeType||"INPUT"!==a.nodeName||"hidden"!==a.type)&&!c||null===(a=kG(a.nextSibling)))return null;return a}(c,b.pendingProps,dH))?(b.stateNode=c,dD=b,dE=null,a=!0):a=!1),a||dJ(b)),null;case 13:return gT(a,b,c);case 4:return ad(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=ez(b,null,d,c):gC(a,b,d,c),b.child;case 11:return gD(a,b,b.type,b.pendingProps,c);case 7:return d=b.pendingProps,gL(a,b),gC(a,b,d,c),b.child;case 8:case 12:return gC(a,b,b.pendingProps.children,c),b.child;case 10:return d=b.pendingProps,dT(b,b.type,d.value),gC(a,b,d.children,c),b.child;case 9:return e=b.type._context,d=b.pendingProps.children,dZ(b),d=d(e=d$(e)),b.flags|=1,gC(a,b,d,c),b.child;case 14:return gE(a,b,b.type,b.pendingProps,c);case 15:return gF(a,b,b.type,b.pendingProps,c);case 19:return g_(a,b,c);case 31:var i=a,j=b,k=c,l=j.pendingProps,m=0!=(128&j.flags);if(j.flags&=-129,null===i){if(dF){if("hidden"===l.mode)return i=gJ(j,l),j.lanes=0x20000000,gH(null,i);if(eV(j),(i=dE)?null!==(i=null!==(i=kD(i,dH))&&"&"===i.data?i:null)&&(j.memoizedState={dehydrated:i,treeContext:null!==dv?{id:dw,overflow:dx}:null,retryLane:0x20000000,hydrationErrors:null},(k=dk(i)).return=j,j.child=k,dD=j,dE=null):i=null,null===i)throw dJ(j);return j.lanes=0x20000000,null}return gJ(j,l)}var n=i.memoizedState;if(null!==n){var o=n.dehydrated;if(eV(j),m)if(256&j.flags)j.flags&=-257,j=gK(i,j,k);else if(null!==j.memoizedState)j.child=i.child,j.flags|=128,j=null;else throw Error(g(558));else if(gB||dX(i,j,k,!1),m=0!=(k&i.childLanes),gB||m){if(null!==(l=ij)&&0!==(o=aN(l,k))&&o!==n.retryLane)throw n.retryLane=o,c8(i,o),iW(l,i,o),gA;i5(),j=gK(i,j,k)}else i=n.treeContext,dE=kG(o.nextSibling),dD=j,dF=!0,dG=null,dH=!1,null!==i&&dC(j,i),j=gJ(j,l),j.flags|=4096;return j}return(i=df(i.child,{mode:l.mode,children:l.children})).ref=j.ref,j.child=i,i.return=j,i;case 22:return gG(a,b,c,b.pendingProps);case 24:return dZ(b),d=d$(d4),null===a?(null===(e=eg())&&(e=ij,f=d5(),e.pooledCache=f,f.refCount++,null!==f&&(e.pooledCacheLanes|=c),e=f),b.memoizedState={parent:d,cache:e},eC(b),dT(b,d4,e)):(0!=(a.lanes&c)&&(eD(a,b),eK(b,null,null,c),eJ()),e=a.memoizedState,f=b.memoizedState,e.parent!==d?(e={parent:d,cache:d},b.memoizedState=e,0===b.lanes&&(b.memoizedState=b.updateQueue.baseState=e),dT(b,d4,d)):(dT(b,d4,d=f.cache),d!==e.cache&&dW(b,[d4],c,!0))),gC(a,b,b.pendingProps.children,c),b.child;case 30:return null!=(d=b.pendingProps).name&&"auto"!==d.name?b.flags|=null===a?0x1202000:0x1200000:dF&&dA(b),null!==a&&a.memoizedProps.name!==d.name?b.flags|=4194816:gL(a,b),gC(a,b,d.children,c),b.child;case 29:throw b.pendingProps}throw Error(g(156,b.tag))}function g3(a){a.flags|=4}function g4(a,b,c,d,e){var f;if((f=0!=(32&a.mode))&&(f=null===c?k3(b,d):k3(b,d)&&(d.src!==c.src||d.srcSet!==c.srcSet)),f){if(a.flags|=0x1000000,(0x13ffff40&e)===e)if(a.stateNode.complete)a.flags|=8192;else if(i2())a.flags|=8192;else throw eq=em,ek}else a.flags&=-0x1000001}function g5(a,b){if("stylesheet"!==b.type||0!=(4&b.state.loading))a.flags&=-0x1000001;else if(a.flags|=0x1000000,!k4(b))if(i2())a.flags|=8192;else throw eq=em,ek}function g6(a,b){null!==b&&(a.flags|=4),16384&a.flags&&(b=22!==a.tag?aI():0x20000000,a.lanes|=b,iy|=b)}function g7(a,b){if(!dF)switch(a.tailMode){case"visible":break;case"collapsed":for(var c=a.tail,d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null;break;default:for(c=null,b=a.tail;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null}}function g8(a){var b=null!==a.alternate&&a.alternate.child===a.child,c=0,d=0;if(b)for(var e=a.child;null!==e;)c|=e.lanes|e.childLanes,d|=0x7e00000&e.subtreeFlags,d|=0x7e00000&e.flags,e.return=a,e=e.sibling;else for(e=a.child;null!==e;)c|=e.lanes|e.childLanes,d|=e.subtreeFlags,d|=e.flags,e.return=a,e=e.sibling;return a.subtreeFlags|=d,a.childLanes=c,b}function g9(a,b){switch(dB(b),b.tag){case 3:dU(d4),ae();break;case 26:case 27:case 5:ag(b);break;case 4:ae();break;case 31:null!==b.memoizedState&&eY(b);break;case 13:eY(b);break;case 19:e_(b);break;case 10:dU(b.type);break;case 22:case 23:eY(b),eR(),null!==a&&Z(ef);break;case 24:dU(d4)}}function ha(a,b){try{var c=b.updateQueue,d=null!==c?c.lastEffect:null;if(null!==d){var e=d.next;c=e;do{if((c.tag&a)===a){d=void 0;var f=c.create;c.inst.destroy=d=f()}c=c.next}while(c!==e)}}catch(a){jm(b,b.return,a)}}function hb(a,b,c){try{var d=b.updateQueue,e=null!==d?d.lastEffect:null;if(null!==e){var f=e.next;d=f;do{if((d.tag&a)===a){var g=d.inst,h=g.destroy;if(void 0!==h){g.destroy=void 0,e=b;try{h()}catch(a){jm(e,c,a)}}}d=d.next}while(d!==f)}}catch(a){jm(b,b.return,a)}}function hc(a){var b=a.updateQueue;if(null!==b){var c=a.stateNode;try{eM(b,c)}catch(b){jm(a,a.return,b)}}}function hd(a,b,c){c.props=gr(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(c){jm(a,b,c)}}function he(a,b){try{var c=a.ref;if(null!==c){switch(a.tag){case 26:case 27:case 5:var d=a.stateNode;break;case 30:var e=a.stateNode,f=c$(a.memoizedProps,e);(null===e.ref||e.ref.name!==f)&&(e.ref=kp(f)),d=e.ref;break;case 7:null===a.stateNode&&(a.stateNode=new kq(a)),d=a.stateNode;break;default:d=a.stateNode}"function"==typeof c?a.refCleanup=c(d):c.current=d}}catch(c){jm(a,b,c)}}function hf(a,b){var c=a.ref,d=a.refCleanup;if(null!==c)if("function"==typeof d)try{d()}catch(c){jm(a,b,c)}finally{a.refCleanup=null,null!=(a=a.alternate)&&(a.refCleanup=null)}else if("function"==typeof c)try{c(null)}catch(c){jm(a,b,c)}else c.current=null}function hg(a){var b=a.type,c=a.memoizedProps,d=a.stateNode;try{switch(b){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(b){jm(a,a.return,b)}}function hh(a,b,c){try{var d=a.stateNode;(function(a,b,c,d){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var e=null,f=null,h=null,i=null,j=null,k=null,l=null;for(o in c){var m=c[o];if(c.hasOwnProperty(o)&&null!=m)switch(o){case"checked":case"value":break;case"defaultValue":j=m;default:d.hasOwnProperty(o)||j_(a,b,o,null,d,m)}}for(var n in d){var o=d[n];if(m=c[n],d.hasOwnProperty(n)&&(null!=o||null!=m))switch(n){case"type":o!==m&&(bc=!0),f=o;break;case"name":o!==m&&(bc=!0),e=o;break;case"checked":o!==m&&(bc=!0),k=o;break;case"defaultChecked":o!==m&&(bc=!0),l=o;break;case"value":o!==m&&(bc=!0),h=o;break;case"defaultValue":o!==m&&(bc=!0),i=o;break;case"children":case"dangerouslySetInnerHTML":if(null!=o)throw Error(g(137,b));break;default:o!==m&&j_(a,b,n,o,d,m)}}bo(a,h,i,j,k,l,f,e);return;case"select":for(f in o=h=i=n=null,c)if(j=c[f],c.hasOwnProperty(f)&&null!=j)switch(f){case"value":break;case"multiple":o=j;default:d.hasOwnProperty(f)||j_(a,b,f,null,d,j)}for(e in d)if(f=d[e],j=c[e],d.hasOwnProperty(e)&&(null!=f||null!=j))switch(e){case"value":f!==j&&(bc=!0),n=f;break;case"defaultValue":f!==j&&(bc=!0),i=f;break;case"multiple":f!==j&&(bc=!0),h=f;default:f!==j&&j_(a,b,e,f,d,j)}b=i,c=h,d=o,null!=n?br(a,!!c,n,!1):!!d!=!!c&&(null!=b?br(a,!!c,b,!0):br(a,!!c,c?[]:"",!1));return;case"textarea":for(i in o=n=null,c)if(e=c[i],c.hasOwnProperty(i)&&null!=e&&!d.hasOwnProperty(i))switch(i){case"value":case"children":break;default:j_(a,b,i,null,d,e)}for(h in d)if(e=d[h],f=c[h],d.hasOwnProperty(h)&&(null!=e||null!=f))switch(h){case"value":e!==f&&(bc=!0),n=e;break;case"defaultValue":e!==f&&(bc=!0),o=e;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=e)throw Error(g(91));break;default:e!==f&&j_(a,b,h,e,d,f)}bs(a,n,o);return;case"option":for(var p in c)n=c[p],c.hasOwnProperty(p)&&null!=n&&!d.hasOwnProperty(p)&&("selected"===p?a.selected=!1:j_(a,b,p,null,d,n));for(j in d)n=d[j],o=c[j],d.hasOwnProperty(j)&&n!==o&&(null!=n||null!=o)&&("selected"===j?(n!==o&&(bc=!0),a.selected=n&&"function"!=typeof n&&"symbol"!=typeof n):j_(a,b,j,n,d,o));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var q in c)n=c[q],c.hasOwnProperty(q)&&null!=n&&!d.hasOwnProperty(q)&&j_(a,b,q,null,d,n);for(k in d)if(n=d[k],o=c[k],d.hasOwnProperty(k)&&n!==o&&(null!=n||null!=o))switch(k){case"children":case"dangerouslySetInnerHTML":if(null!=n)throw Error(g(137,b));break;default:j_(a,b,k,n,d,o)}return;default:if(by(b)){for(var r in c)n=c[r],c.hasOwnProperty(r)&&void 0!==n&&!d.hasOwnProperty(r)&&j0(a,b,r,void 0,d,n);for(l in d)n=d[l],o=c[l],d.hasOwnProperty(l)&&n!==o&&(void 0!==n||void 0!==o)&&j0(a,b,l,n,d,o);return}}for(var s in c)n=c[s],c.hasOwnProperty(s)&&null!=n&&!d.hasOwnProperty(s)&&j_(a,b,s,null,d,n);for(m in d)n=d[m],o=c[m],d.hasOwnProperty(m)&&n!==o&&(null!=n||null!=o)&&j_(a,b,m,n,d,o)})(d,a.type,c,b),d[aU]=b}catch(b){jm(a,a.return,b)}}function hi(a,b){if(5===a.tag&&null===a.alternate&&null!==b)for(var c=0;c<b.length;c++)kB(a.stateNode,b[c])}function hj(a){for(var b=a.return;null!==b;){if(hl(b)){var c=a.stateNode,d=b.stateNode._eventListeners;if(null!==d)for(var e=0;e<d.length;e++){var f=d[e];c.removeEventListener(f.type,f.listener,f.optionsOrUseCapture)}}if(hk(b))break;b=b.return}}function hk(a){return 5===a.tag||3===a.tag||26===a.tag||27===a.tag&&kf(a.type)||4===a.tag}function hl(a){return a&&7===a.tag&&null!==a.stateNode}function hm(a){b:for(;;){for(;null===a.sibling;){if(null===a.return||hk(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;5!==a.tag&&6!==a.tag&&18!==a.tag;){if(27===a.tag&&kf(a.type)||2&a.flags||null===a.child||4===a.tag)continue b;a.child.return=a,a=a.child}if(!(2&a.flags))return a.stateNode}}function hn(a,b,c,d){var e=a.tag;if(5===e||6===e)e=a.stateNode,b?c.insertBefore(e,b):c.appendChild(e),hi(a,d),bc=!0;else if(4!==e&&(27===e&&kf(a.type)&&(c=a.stateNode),null!==(a=a.child)))for(hn(a,b,c,d),a=a.sibling;null!==a;)hn(a,b,c,d),a=a.sibling}function ho(a){var b=a.stateNode,c=a.memoizedProps;try{for(var d=a.type,e=b.attributes;e.length;)b.removeAttributeNode(e[0]);j1(b,d,c),b[aT]=a,b[aU]=c}catch(b){jm(a,a.return,b)}}var hp=!1,hq=null;function hr(a){(30===a.tag||0!=(0x2000000&a.subtreeFlags))&&(hp=!0)}var hs=null;function ht(){var a=hs;return hs=null,a}var hu=0;function hv(a,b,c,d,e){return hu=0,function a(b,c,d,e,f){for(var g=!1;null!==b;){if(5===b.tag){var h=b.stateNode;if(null!==e){var i=kl(h);e.push(i),i.view&&(g=!0)}else g||kl(h).view&&(g=!0);hp=!0,ki(h,0===hu?c:c+"_"+hu,d),hu++}else(22!==b.tag||null===b.memoizedState)&&(30===b.tag&&f||a(b.child,c,d,e,f)&&(g=!0));b=b.sibling}return g}(a.child,b,c,d,e)}function hw(a,b){for(;null!==a;)5===a.tag?kj(a.stateNode,a.memoizedProps):(22!==a.tag||null===a.memoizedState)&&(30===a.tag&&b||hw(a.child,b)),a=a.sibling}function hx(a){if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if((22!==a.tag||null===a.memoizedState)&&(hx(a),30===a.tag&&0!=(0x1200000&a.flags)&&a.stateNode.paired)){var b=a.memoizedProps;if(null==b.name||"auto"===b.name)throw Error(g(544));var c=b.name;"none"!==(b=c0(b.default,b.share))&&(hv(a,c,b,null,!1)||hw(a.child,!1))}a=a.sibling}}function hy(a,b){if(30===a.tag){var c=a.stateNode,d=a.memoizedProps,e=c$(d,c),f=c0(d.default,c.paired?d.share:d.enter);"none"!==f?hv(a,e,f,null,!1)?(hx(a),c.paired||b||iV(a,d.onEnter)):hw(a.child,!1):hx(a)}else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hy(a,b),a=a.sibling;else hx(a)}function hz(a){if(null!==hq&&0!==hq.size){var b=hq;if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if(22!==a.tag||null===a.memoizedState){if(30===a.tag&&0!=(0x1200000&a.flags)){var c=a.memoizedProps,d=c.name;if(null!=d&&"auto"!==d){var e=b.get(d);if(void 0!==e){var f=c0(c.default,c.share);if("none"!==f&&(hv(a,d,f,null,!1)?(e.paired=f=a.stateNode,f.paired=e,iV(a,c.onShare)):hw(a.child,!1)),b.delete(d),0===b.size)break}}}hz(a)}a=a.sibling}}}function hA(a){if(30===a.tag){var b=a.memoizedProps,c=c$(b,a.stateNode),d=null!==hq?hq.get(c):void 0,e=c0(b.default,void 0!==d?b.share:b.exit);"none"!==e&&(hv(a,c,e,null,!1)?void 0!==d?(d.paired=e=a.stateNode,e.paired=d,hq.delete(c),iV(a,b.onShare)):iV(a,b.onExit):hw(a.child,!1)),null!==hq&&hz(a)}else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hA(a),a=a.sibling;else null!==hq&&hz(a)}function hB(a){if(0!=(0x1200000&a.subtreeFlags))for(a=a.child;null!==a;){if(22!==a.tag||null===a.memoizedState){if(30===a.tag&&0!=(0x1200000&a.flags)){var b=a.stateNode;null!==b.paired&&(b.paired=null,hw(a.child,!1))}hB(a)}a=a.sibling}}function hC(a){if(30===a.tag)a.stateNode.paired=null,hw(a.child,!1),hB(a);else if(0!=(0x2000000&a.subtreeFlags))for(a=a.child;null!==a;)hC(a),a=a.sibling;else hB(a)}function hD(a,b,c,d,e,f,g){for(var h=!1;null!==b;){if(5===b.tag){var i=b.stateNode;if(null!==f&&hu<f.length){var j,k=f[hu],l=kl(i);if((k.view||l.view)&&(h=!0),j=0==(4&a.flags))if(l.clip)j=!0;else{j=k.rect;var m=l.rect;j=j.y!==m.y||j.x!==m.x||j.height!==m.height||j.width!==m.width}j&&(a.flags|=4),l.abs?l=!k.abs:(k=k.rect,l=l.rect,l=k.height!==l.height||k.width!==l.width),l&&(a.flags|=32)}else a.flags|=32;0!=(4&a.flags)&&ki(i,0===hu?c:c+"_"+hu,e),h&&0!=(4&a.flags)||(null===hs&&(hs=[]),hs.push(i,d,b.memoizedProps)),hu++}else(22!==b.tag||null===b.memoizedState)&&(30===b.tag&&g?a.flags|=32&b.flags:hD(a,b.child,c,d,e,f,g)&&(h=!0));b=b.sibling}return h}var hE=!1,hF=!1,hG=!1,hH=!1,hI="function"==typeof WeakSet?WeakSet:Set,hJ=null,hK=!1,hL=!1,hM=!1,hN=!1;function hO(a){for(;null!==hJ;){var b=hJ,c=a,d=b.alternate,e=b.flags;switch(b.tag){case 0:case 11:case 15:if(0!=(4&e)&&null!==(d=null!==(d=b.updateQueue)?d.events:null))for(c=0;c<d.length;c++)(e=d[c]).ref.impl=e.nextImpl;break;case 1:if(0!=(1024&e)&&null!==d){c=void 0,e=d.memoizedProps,d=d.memoizedState;var f=b.stateNode;try{var h=gr(b.type,e);c=f.getSnapshotBeforeUpdate(h,d),f.__reactInternalSnapshotBeforeUpdate=c}catch(a){jm(b,b.return,a)}}break;case 3:if(0!=(1024&e)){if(9===(c=(d=b.stateNode.containerInfo).nodeType))kC(d);else if(1===c)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":kC(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;case 30:c&&null!==d&&(c=c$(d.memoizedProps,d.stateNode),"none"!==(e=c0((e=b.memoizedProps).default,e.update))&&hv(d,c,e,d.memoizedState=[],!0));break;default:if(0!=(1024&e))throw Error(g(163))}if(null!==(d=b.sibling)){d.return=b.return,hJ=d;break}hJ=b.return}}function hP(a,b,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:h2(a,c),4&d&&ha(5,c);break;case 1:if(h2(a,c),4&d)if(a=c.stateNode,null===b)try{a.componentDidMount()}catch(a){jm(c,c.return,a)}else{var e=gr(c.type,b.memoizedProps);b=b.memoizedState;try{a.componentDidUpdate(e,b,a.__reactInternalSnapshotBeforeUpdate)}catch(a){jm(c,c.return,a)}}64&d&&hc(c),512&d&&he(c,c.return);break;case 3:if(h2(a,c),64&d&&null!==(a=c.updateQueue)){if(b=null,null!==c.child)switch(c.child.tag){case 27:case 5:case 1:b=c.child.stateNode}try{eM(a,b)}catch(a){jm(c,c.return,a)}}break;case 27:null===b&&4&d&&ho(c);case 26:case 5:h2(a,c),null===b&&4&d&&hg(c),512&d&&he(c,c.return);break;case 12:h2(a,c);break;case 31:h2(a,c),4&d&&hV(a,c);break;case 13:h2(a,c),4&d&&hW(a,c),64&d&&null!==(a=c.memoizedState)&&null!==(a=a.dehydrated)&&function(a,b){var c=a.ownerDocument;if("$~"===a.data)a._reactRetry=b;else if("$?"!==a.data||"loading"!==c.readyState)b();else{var d=function(){b(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),a._reactRetry=d}}(a,c=jq.bind(null,c));break;case 22:if(!(d=null!==c.memoizedState||hE)){b=null!==b&&null!==b.memoizedState||hF,e=hE;var f=hF;hE=d,(hF=b)&&!f?function a(b,c,d){for(d=d&&0!=(8772&c.subtreeFlags),c=c.child;null!==c;){var e=c.alternate,f=b,g=c,h=g.flags;switch(g.tag){case 0:case 11:case 15:a(f,g,d),ha(4,g);break;case 1:if(a(f,g,d),"function"==typeof(f=(e=g).stateNode).componentDidMount)try{f.componentDidMount()}catch(a){jm(e,e.return,a)}if(null!==(f=(e=g).updateQueue)){var i=e.stateNode;try{var j=f.shared.hiddenCallbacks;if(null!==j)for(f.shared.hiddenCallbacks=null,f=0;f<j.length;f++)eL(j[f],i)}catch(a){jm(e,e.return,a)}}d&&64&h&&hc(g),he(g,g.return);break;case 27:ho(g);case 26:case 5:if(5===g.tag){i=g;for(var k=i.return;null!==k&&(hl(k)&&kB(i.stateNode,k.stateNode),!hk(k));)k=k.return}a(f,g,d),d&&null===e&&4&h&&hg(g),he(g,g.return);break;case 12:a(f,g,d);break;case 31:a(f,g,d),d&&4&h&&hV(f,g);break;case 13:a(f,g,d),d&&4&h&&hW(f,g);break;case 22:null===g.memoizedState&&a(f,g,d),he(g,g.return);break;case 30:a(f,g,d),he(g,g.return);break;case 7:he(g,g.return);default:a(f,g,d)}c=c.sibling}}(a,c,0!=(8772&c.subtreeFlags)):h2(a,c),hE=e,hF=f}break;case 30:h2(a,c),512&d&&he(c,c.return);break;case 7:512&d&&he(c,c.return);default:h2(a,c)}}function hQ(a,b){for(a=a.child;null!==a;)(function a(b,c){switch(b.tag){case 5:case 26:try{var d=b.stateNode;if(c){var e=d.style;"function"==typeof e.setProperty?e.setProperty("display","none","important"):e.display="none"}else{var f=b.stateNode,g=b.memoizedProps.style,h=null!=g&&g.hasOwnProperty("display")?g.display:null;f.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(a){jm(b,b.return,a)}!function b(c,d){if(0x4000000&c.subtreeFlags)for(c=c.child;null!==c;){b:{var e=c;switch(e.tag){case 4:a(e,d);break b;case 22:null===e.memoizedState&&b(e,d);break b;default:b(e,d)}}c=c.sibling}}(b,c);break;case 6:try{b.stateNode.nodeValue=c?"":b.memoizedProps,bc=!0}catch(a){jm(b,b.return,a)}break;case 18:try{var i=b.stateNode;c?kh(i,!0):kh(b.stateNode,!1)}catch(a){jm(b,b.return,a)}break;case 22:case 23:null===b.memoizedState&&hQ(b,c);break;default:hQ(b,c)}})(a,b),a=a.sibling}var hR=null,hS=!1;function hT(a,b,c){for(c=c.child;null!==c;)hU(a,b,c),c=c.sibling}function hU(a,b,c){if(ay&&"function"==typeof ay.onCommitFiberUnmount)try{ay.onCommitFiberUnmount(ax,c)}catch(a){}switch(c.tag){case 26:hF||hf(c,b),hT(a,b,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode).parentNode.removeChild(c);break;case 27:hF||hf(c,b);var d=hR,e=hS;kf(c.type)&&(hR=c.stateNode,hS=!1),hT(a,b,c),kL(c.stateNode),hR=d,hS=e;break;case 5:hF||hf(c,b),5===c.tag&&hj(c);case 6:if(d=hR,e=hS,hR=null,hT(a,b,c),hR=d,hS=e,null!==hR)if(hS)try{(9===hR.nodeType?hR.body:"HTML"===hR.nodeName?hR.ownerDocument.body:hR).removeChild(c.stateNode),bc=!0}catch(a){jm(c,b,a)}else try{hR.removeChild(c.stateNode),bc=!0}catch(a){jm(c,b,a)}break;case 18:null!==hR&&(hS?(kg(9===(a=hR).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a,c.stateNode),lL(a)):kg(hR,c.stateNode));break;case 4:d=hR,e=hS,hR=c.stateNode.containerInfo,hS=!0,hT(a,b,c),hR=d,hS=e;break;case 0:case 11:case 14:case 15:hb(2,c,b),hF||hb(4,c,b),hT(a,b,c);break;case 1:hF||(hf(c,b),"function"==typeof(d=c.stateNode).componentWillUnmount&&hd(c,b,d)),hT(a,b,c);break;case 21:default:hT(a,b,c);break;case 22:hF=(d=hF)||null!==c.memoizedState,hT(a,b,c),hF=d;break;case 30:hf(c,b),hT(a,b,c);break;case 7:hF||hf(c,b),hT(a,b,c)}}function hV(a,b){if(null===b.memoizedState&&null!==(a=b.alternate)&&null!==(a=a.memoizedState)){a=a.dehydrated;try{lL(a)}catch(a){jm(b,b.return,a)}}}function hW(a,b){if(null===b.memoizedState&&null!==(a=b.alternate)&&null!==(a=a.memoizedState)&&null!==(a=a.dehydrated))try{lL(a)}catch(a){jm(b,b.return,a)}}function hX(a,b){var c=function(a){switch(a.tag){case 31:case 13:case 19:var b=a.stateNode;return null===b&&(b=a.stateNode=new hI),b;case 22:return null===(b=(a=a.stateNode)._retryCache)&&(b=a._retryCache=new hI),b;default:throw Error(g(435,a.tag))}}(a);b.forEach(function(b){if(!c.has(b)){c.add(b);var d=jr.bind(null,a,b);b.then(d,d)}})}function hY(a,b,c){var d=b.deletions;if(null!==d)for(var e=0;e<d.length;e++){var f=d[e],h=a,i=b,j=i;b:for(;null!==j;){switch(j.tag){case 27:if(kf(j.type)){hR=j.stateNode,hS=!1;break b}break;case 5:hR=j.stateNode,hS=!1;break b;case 3:case 4:hR=j.stateNode.containerInfo,hS=!0;break b}j=j.return}if(null===hR)throw Error(g(160));hU(h,i,f),hR=null,hS=!1,null!==(h=f.alternate)&&(h.return=null),f.return=null}if(13886&b.subtreeFlags)for(b=b.child;null!==b;)h$(b,a,c),b=b.sibling}var hZ=null;function h$(a,b,c){var d=a.alternate,e=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:hY(b,a,c),h_(a),4&e&&(hb(3,a,a.return),ha(3,a),hb(5,a,a.return));break;case 1:hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),64&e&&hE&&null!==(a=a.updateQueue)&&null!==(d=a.callbacks)&&(b=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=null===b?d:b.concat(d));break;case 26:var f=hZ;if(hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),4&e)if(c=null!==d?d.memoizedState:null,b=a.memoizedState,null===d)if(null===b)if(null===a.stateNode){b:{d=a.type,b=a.memoizedProps,c=f.ownerDocument||f;c:switch(d){case"title":(!(e=c.getElementsByTagName("title")[0])||e[a$]||e[aT]||"http://www.w3.org/2000/svg"===e.namespaceURI||e.hasAttribute("itemprop"))&&(e=c.createElement(d),c.head.insertBefore(e,c.querySelector("head > title"))),j1(e,d,b),e[aT]=a,a4(e),d=e;break b;case"link":if(f=k1("link","href",c).get(d+(b.href||""))){for(var h=0;h<f.length;h++)if((e=f[h]).getAttribute("href")===(null==b.href||""===b.href?null:b.href)&&e.getAttribute("rel")===(null==b.rel?null:b.rel)&&e.getAttribute("title")===(null==b.title?null:b.title)&&e.getAttribute("crossorigin")===(null==b.crossOrigin?null:b.crossOrigin)){f.splice(h,1);break c}}j1(e=c.createElement(d),d,b),c.head.appendChild(e);break;case"meta":if(f=k1("meta","content",c).get(d+(b.content||""))){for(h=0;h<f.length;h++)if((e=f[h]).getAttribute("content")===(null==b.content?null:""+b.content)&&e.getAttribute("name")===(null==b.name?null:b.name)&&e.getAttribute("property")===(null==b.property?null:b.property)&&e.getAttribute("http-equiv")===(null==b.httpEquiv?null:b.httpEquiv)&&e.getAttribute("charset")===(null==b.charSet?null:b.charSet)){f.splice(h,1);break c}}j1(e=c.createElement(d),d,b),c.head.appendChild(e);break;default:throw Error(g(468,d))}e[aT]=a,a4(e),d=e}a.stateNode=d}else k2(f,a.type,a.stateNode);else a.stateNode=kY(f,b,a.memoizedProps);else c!==b?(null===c?null!==d.stateNode&&(d=d.stateNode).parentNode.removeChild(d):c.count--,null===b?k2(f,a.type,a.stateNode):kY(f,b,a.memoizedProps)):null===b&&null!==a.stateNode&&hh(a,a.memoizedProps,d.memoizedProps);break;case 27:hY(b,a,c),h_(a),512&e&&(hF||null===d||hf(d,d.return)),null!==d&&4&e&&hh(a,a.memoizedProps,d.memoizedProps);break;case 5:if(f=hG,hG=!1,hY(b,a,c),hG=f,h_(a),512&e&&(hF||null===d||hf(d,d.return)),32&a.flags){b=a.stateNode;try{bu(b,""),bc=!0}catch(b){jm(a,a.return,b)}}4&e&&null!=a.stateNode&&(b=a.memoizedProps,hh(a,b,null!==d?d.memoizedProps:b)),1024&e&&(hH=!0);break;case 6:if(hY(b,a,c),h_(a),4&e){if(null===a.stateNode)throw Error(g(162));d=a.memoizedProps,b=a.stateNode;try{b.nodeValue=d,bc=!0}catch(b){jm(a,a.return,b)}}break;case 3:if(bc=!1,k0=null,f=hZ,hZ=kO(b.containerInfo),hY(b,a,c),hZ=f,h_(a),4&e&&null!==d&&d.memoizedState.isDehydrated)try{lL(b.containerInfo)}catch(b){jm(a,a.return,b)}hH&&(hH=!1,function a(b){if(1024&b.subtreeFlags)for(b=b.child;null!==b;){var c=b;a(c),5===c.tag&&1024&c.flags&&c.stateNode.reset(),b=b.sibling}}(a)),bc=!1;break;case 4:d=hG,hG=hE,e=bd(),f=hZ,hZ=kO(a.stateNode.containerInfo),hY(b,a,c),h_(a),hZ=f,bc&&hL&&(hM=!0),bc=e,hG=d;break;case 12:hY(b,a,c),h_(a);break;case 31:case 19:hY(b,a,c),h_(a),4&e&&null!==(d=a.updateQueue)&&(a.updateQueue=null,hX(a,d));break;case 13:hY(b,a,c),h_(a),8192&a.child.flags&&null!==a.memoizedState!=(null!==d&&null!==d.memoizedState)&&(iC=aq()),4&e&&null!==(d=a.updateQueue)&&(a.updateQueue=null,hX(a,d));break;case 22:f=null!==a.memoizedState,h=null!==d&&null!==d.memoizedState;var i=hE,j=hF,k=hG;hE=i||f,hG=k||f,hF=j||h,hY(b,a,c),hF=j,hG=k,hE=i,h_(a),8192&e&&((b=a.stateNode)._visibility=f?-2&b._visibility:1|b._visibility,f&&(null===d||h||hE||hF||function a(b){for(b=b.child;null!==b;){var c=b;switch(c.tag){case 0:case 11:case 14:case 15:hb(4,c,c.return),a(c);break;case 1:hf(c,c.return);var d=c.stateNode;"function"==typeof d.componentWillUnmount&&hd(c,c.return,d),a(c);break;case 27:kL(c.stateNode);case 26:case 5:hf(c,c.return),5===c.tag&&hj(c),a(c);break;case 22:null===c.memoizedState&&a(c);break;case 30:hf(c,c.return),a(c);break;case 7:hf(c,c.return);default:a(c)}b=b.sibling}}(a)),!f&&hG||hQ(a,f)),4&e&&null!==(d=a.updateQueue)&&null!==(b=d.retryQueue)&&(d.retryQueue=null,hX(a,b));break;case 30:512&e&&(hF||null===d||hf(d,d.return)),e=bd(),f=hL,h=(0x13ffff00&c)===c,i=a.memoizedProps,hL=h&&"none"!==c0(i.default,i.update),hY(b,a,c),h_(a),h&&null!==d&&bc&&(a.flags|=4),hL=f,bc=e;break;case 21:break;case 7:d&&null!==d.stateNode&&(d.stateNode._fragmentFiber=a);default:hY(b,a,c),h_(a)}}function h_(a){var b=a.flags;if(2&b){try{for(var c,d=null,e=a.return;null!==e;){if(hl(e)){var f=e.stateNode;null===d?d=[f]:d.push(f)}if(hk(e)){c=e;break}e=e.return}if(null==c)throw Error(g(160));switch(c.tag){case 27:var h=c.stateNode,i=hm(a);hn(a,i,h,d);break;case 5:var j=c.stateNode;32&c.flags&&(bu(j,""),c.flags&=-33);var k=hm(a);hn(a,k,j,d);break;case 3:case 4:var l=c.stateNode.containerInfo,m=hm(a);!function a(b,c,d,e){var f=b.tag;if(5===f||6===f)f=b.stateNode,c?(9===d.nodeType?d.body:"HTML"===d.nodeName?d.ownerDocument.body:d).insertBefore(f,c):((c=9===d.nodeType?d.body:"HTML"===d.nodeName?d.ownerDocument.body:d).appendChild(f),null!=(d=d._reactRootContainer)||null!==c.onclick||(c.onclick=bC)),hi(b,e),bc=!0;else if(4!==f&&(27===f&&kf(b.type)&&(d=b.stateNode,c=null),null!==(b=b.child)))for(a(b,c,d,e),b=b.sibling;null!==b;)a(b,c,d,e),b=b.sibling}(a,m,l,d);break;default:throw Error(g(161))}}catch(b){jm(a,a.return,b)}a.flags&=-3}4096&b&&(a.flags&=-4097)}function h0(a,b){if(9270&b.subtreeFlags)for(b=b.child;null!==b;)h1(b,a),b=b.sibling;else!function a(b,c){for(b=b.child;null!==b;){if(30===b.tag){var d=b.memoizedProps,e=b.stateNode,f=c$(d,e),g=c0(d.default,d.update);if(c)var h=null===(e=e.clones)?null:e.map(km);else h=b.memoizedState,b.memoizedState=null;e=b;var i=b.child;hu=0,f=hD(e,i,f,f,g,h,!1),0!=(4&b.flags)&&f&&(c||iV(b,d.onUpdate))}else 0!=(0x2000000&b.subtreeFlags)&&a(b,c);b=b.sibling}}(b,!1)}function h1(a,b){var c=a.alternate;if(null===c)hy(a,!1);else switch(a.tag){case 3:if(hN=hK=!1,ht(),h0(b,a),!hK&&!hM){if(null!==(a=hs))for(var d=0;d<a.length;d+=3){c=a[d];var e=a[d+1];kj(c,a[d+2]),null!==(c=c.ownerDocument.documentElement)&&c.animate({opacity:[0,0],pointerEvents:["none","none"]},{duration:0,fill:"forwards",pseudoElement:"::view-transition-group("+e+")"})}null!==(a=9===(a=b.containerInfo).nodeType?a.documentElement:a.ownerDocument.documentElement)&&""===a.style.viewTransitionName&&(a.style.viewTransitionName="none",a.animate({opacity:[0,0],pointerEvents:["none","none"]},{duration:0,fill:"forwards",pseudoElement:"::view-transition-group(root)"}),a.animate({width:[0,0],height:[0,0]},{duration:0,fill:"forwards",pseudoElement:"::view-transition"})),hN=!0}hs=null;break;case 5:default:h0(b,a);break;case 4:d=hK,hK=!1,h0(b,a),hK&&(hM=!0),hK=d;break;case 22:null===a.memoizedState&&(null!==c.memoizedState?hy(a,!1):h0(b,a));break;case 30:d=hK,e=ht(),hK=!1,h0(b,a),hK&&(a.flags|=4);var f=a.memoizedProps,g=a.stateNode;b=c$(f,g),g=c$(c.memoizedProps,g);var h=c0(f.default,f.update);"none"===h?b=!1:(f=c.memoizedState,c.memoizedState=null,c=a.child,hu=0,b=hD(a,c,b,g,h,f,!0),hu!==(null===f?0:f.length)&&(a.flags|=32)),0!=(4&a.flags)&&b?(iV(a,a.memoizedProps.onUpdate),hs=e):null!==e&&(e.push.apply(e,hs),hs=e),hK=0!=(32&a.flags)||d}}function h2(a,b){if(8772&b.subtreeFlags)for(b=b.child;null!==b;)hP(a,b.alternate,b),b=b.sibling}function h3(a,b){var c=null;null!==a&&null!==a.memoizedState&&null!==a.memoizedState.cachePool&&(c=a.memoizedState.cachePool.pool),a=null,null!==b.memoizedState&&null!==b.memoizedState.cachePool&&(a=b.memoizedState.cachePool.pool),a!==c&&(null!=a&&a.refCount++,null!=c&&d6(c))}function h4(a,b){a=null,null!==b.alternate&&(a=b.alternate.memoizedState.cache),(b=b.memoizedState.cache)!==a&&(b.refCount++,null!=a&&d6(a))}function h5(a,b,c,d){var e=(0x13ffff00&c)===c;if(b.subtreeFlags&(e?10262:10256))for(b=b.child;null!==b;)h6(a,b,c,d),b=b.sibling;else e&&function a(b){for(b=b.child;null!==b;)30===b.tag?hw(b.child,!1):0!=(0x2000000&b.subtreeFlags)&&a(b),b=b.sibling}(b)}function h6(a,b,c,d){var e=(0x13ffff00&c)===c;e&&null===b.alternate&&null!==b.return&&null!==b.return.alternate&&hC(b);var f=b.flags;switch(b.tag){case 0:case 11:case 15:h5(a,b,c,d),2048&f&&ha(9,b);break;case 1:case 31:case 13:default:h5(a,b,c,d);break;case 3:h5(a,b,c,d),e&&hN&&("root"===(a=9===(a=a.containerInfo).nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).style.viewTransitionName&&(a.style.viewTransitionName=""),null!==(a=a.ownerDocument.documentElement)&&"none"===a.style.viewTransitionName&&(a.style.viewTransitionName="")),2048&f&&(f=null,null!==b.alternate&&(f=b.alternate.memoizedState.cache),(b=b.memoizedState.cache)!==f&&(b.refCount++,null!=f&&d6(f)));break;case 12:if(2048&f){h5(a,b,c,d),f=b.stateNode;try{var g=b.memoizedProps,h=g.id,i=g.onPostCommit;"function"==typeof i&&i(h,null===b.alternate?"mount":"update",f.passiveEffectDuration,-0)}catch(a){jm(b,b.return,a)}}else h5(a,b,c,d);break;case 23:break;case 22:g=b.stateNode,h=b.alternate,null!==b.memoizedState?(e&&null!==h&&null===h.memoizedState&&hC(h),2&g._visibility?h5(a,b,c,d):h7(a,b)):(e&&null!==h&&null!==h.memoizedState&&hC(b),2&g._visibility?h5(a,b,c,d):(g._visibility|=2,function a(b,c,d,e,f){for(f=f&&0!=(10256&c.subtreeFlags),c=c.child;null!==c;){var g=c,h=g.flags;switch(g.tag){case 0:case 11:case 15:a(b,g,d,e,f),ha(8,g);break;case 23:break;case 22:var i=g.stateNode;null!==g.memoizedState?2&i._visibility?a(b,g,d,e,f):h7(b,g):(i._visibility|=2,a(b,g,d,e,f)),f&&2048&h&&h3(g.alternate,g);break;case 24:a(b,g,d,e,f),f&&2048&h&&h4(g.alternate,g);break;default:a(b,g,d,e,f)}c=c.sibling}}(a,b,c,d,0!=(10256&b.subtreeFlags)))),2048&f&&h3(h,b);break;case 24:h5(a,b,c,d),2048&f&&h4(b.alternate,b);break;case 30:e&&null!==(f=b.alternate)&&(hw(f.child,!0),hw(b.child,!0)),h5(a,b,c,d)}}function h7(a,b){if(10256&b.subtreeFlags)for(b=b.child;null!==b;){var c=b,d=c.flags;switch(c.tag){case 22:h7(a,c),2048&d&&h3(c.alternate,c);break;case 24:h7(a,c),2048&d&&h4(c.alternate,c);break;default:h7(a,c)}b=b.sibling}}var h8=8192;function h9(a,b,c){if(a.subtreeFlags&h8)for(a=a.child;null!==a;)ia(a,b,c),a=a.sibling}function ia(a,b,c){switch(a.tag){case 26:h9(a,b,c),a.flags&h8&&(null!==a.memoizedState?function(a,b,c,d){if("stylesheet"===c.type&&("string"!=typeof d.media||!1!==matchMedia(d.media).matches)&&0==(4&c.state.loading)){if(null===c.instance){var e=kT(d.href),f=b.querySelector(kU(e));if(f){null!==(b=f._p)&&"object"==typeof b&&"function"==typeof b.then&&(a.count++,a=k9.bind(a),b.then(a,a)),c.state.loading|=4,c.instance=f,a4(f);return}f=b.ownerDocument||b,d=kV(d),(e=kM.get(e))&&k$(d,e),a4(f=f.createElement("link"));var g=f;g._p=new Promise(function(a,b){g.onload=a,g.onerror=b}),j1(f,"link",d),c.instance=f}null===a.stylesheets&&(a.stylesheets=new Map),a.stylesheets.set(c,b),(b=c.state.preload)&&0==(3&c.state.loading)&&(a.count++,c=k9.bind(a),b.addEventListener("load",c),b.addEventListener("error",c))}}(c,hZ,a.memoizedState,a.memoizedProps):(a=a.stateNode,(0x13ffff40&b)===b&&k6(c,a)));break;case 5:h9(a,b,c),a.flags&h8&&(a=a.stateNode,(0x13ffff40&b)===b&&k6(c,a));break;case 3:case 4:var d=hZ;hZ=kO(a.stateNode.containerInfo),h9(a,b,c),hZ=d;break;case 22:null===a.memoizedState&&(null!==(d=a.alternate)&&null!==d.memoizedState?(d=h8,h8=0x1000000,h9(a,b,c),h8=d):h9(a,b,c));break;case 30:if(0!=(a.flags&h8)&&null!=(d=a.memoizedProps.name)&&"auto"!==d){var e=a.stateNode;e.paired=null,null===hq&&(hq=new Map),hq.set(d,e)}h9(a,b,c);break;default:h9(a,b,c)}}function ib(a){var b=a.alternate;if(null!==b&&null!==(a=b.child)){b.child=null;do b=a.sibling,a.sibling=null,a=b;while(null!==a)}}function ic(a){var b=a.deletions;if(0!=(16&a.flags)){if(null!==b)for(var c=0;c<b.length;c++){var d=b[c];hJ=d,ie(d,a)}ib(a)}if(10256&a.subtreeFlags)for(a=a.child;null!==a;)id(a),a=a.sibling}function id(a){switch(a.tag){case 0:case 11:case 15:ic(a),2048&a.flags&&hb(9,a,a.return);break;case 3:case 12:default:ic(a);break;case 22:var b=a.stateNode;null!==a.memoizedState&&2&b._visibility&&(null===a.return||13!==a.return.tag)?(b._visibility&=-3,function a(b){var c=b.deletions;if(0!=(16&b.flags)){if(null!==c)for(var d=0;d<c.length;d++){var e=c[d];hJ=e,ie(e,b)}ib(b)}for(b=b.child;null!==b;){switch((c=b).tag){case 0:case 11:case 15:hb(8,c,c.return),a(c);break;case 22:2&(d=c.stateNode)._visibility&&(d._visibility&=-3,a(c));break;default:a(c)}b=b.sibling}}(a)):ic(a)}}function ie(a,b){for(;null!==hJ;){var c=hJ;switch(c.tag){case 0:case 11:case 15:hb(8,c,b);break;case 23:case 22:if(null!==c.memoizedState&&null!==c.memoizedState.cachePool){var d=c.memoizedState.cachePool.pool;null!=d&&d.refCount++}break;case 24:d6(c.memoizedState.cache)}if(null!==(d=c.child))d.return=c,hJ=d;else for(c=a;null!==hJ;){var e=(d=hJ).sibling,f=d.return;if(!function a(b){var c=b.alternate;null!==c&&(b.alternate=null,a(c)),b.child=null,b.deletions=null,b.sibling=null,5===b.tag&&null!==(c=b.stateNode)&&a_(c),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}(d),d===c){hJ=null;break}if(null!==e){e.return=f,hJ=e;break}hJ=f}}}var ig={getCacheForType:function(a){var b=d$(d4),c=b.data.get(a);return void 0===c&&(c=a(),b.data.set(a,c)),c},cacheSignal:function(){return d$(d4).controller.signal}},ih="function"==typeof WeakMap?WeakMap:Map,ii=0,ij=null,ik=null,il=0,im=0,io=null,ip=!1,iq=!1,ir=!1,is=0,it=0,iu=0,iv=0,iw=0,ix=0,iy=0,iz=null,iA=null,iB=!1,iC=0,iD=0,iE=1/0,iF=null,iG=null,iH=0,iI=null,iJ=null,iK=0,iL=0,iM=null,iN=null,iO=null,iP=null,iQ=null,iR=0,iS=null;function iT(){return 0!=(2&ii)&&0!==il?il&-il:null!==T.T?jF():aQ()}function iU(){if(0===ix)if(0==(0x20000000&il)||dF){var a=aD;0==(3932160&(aD<<=1))&&(aD=262144),ix=a}else ix=0x20000000;return null!==(a=eS.current)&&(a.flags|=32),ix}function iV(a,b){if(null!=b){var c=a.stateNode,d=c.ref;null===d&&(d=c.ref=kp(c$(a.memoizedProps,c))),null===iP&&(iP=[]),iP.push(b.bind(null,d))}}function iW(a,b,c){(a===ij&&(2===im||9===im)||null!==a.cancelPendingCommit)&&(i0(a,0),iZ(a,il,ix,!1)),aK(a,c),(0==(2&ii)||a!==ij)&&(a===ij&&(0==(2&ii)&&(iv|=c),4===it&&iZ(a,il,ix,!1)),jy(a))}function iX(a,b,c){if(0!=(6&ii))throw Error(g(327));for(var d=!c&&0==(127&b)&&0==(b&a.expiredLanes)||aH(a,b),e=d?function(a,b){var c=ii;ii|=2;var d=i3(),e=i4();ij!==a||il!==b?(iF=null,iE=aq()+500,i0(a,b)):iq=aH(a,b);b:for(;;)try{if(0!==im&&null!==ik){b=ik;var f=io;c:switch(im){case 1:im=0,io=null,i9(a,b,f,1);break;case 2:case 9:if(en(f)){im=0,io=null,i8(b);break}b=function(){2!==im&&9!==im||ij!==a||(im=7),jy(a)},f.then(b,b);break b;case 3:im=7;break b;case 4:im=5;break b;case 7:en(f)?(im=0,io=null,i8(b)):(im=0,io=null,i9(a,b,f,7));break;case 5:var h=null;switch(ik.tag){case 26:h=ik.memoizedState;case 5:case 27:var i=ik;if(h?k4(h):i.stateNode.complete){im=0,io=null;var j=i.sibling;if(null!==j)ik=j;else{var k=i.return;null!==k?(ik=k,ja(k)):ik=null}break c}}im=0,io=null,i9(a,b,f,5);break;case 6:im=0,io=null,i9(a,b,f,6);break;case 8:i_(),it=6;break b;default:throw Error(g(462))}}for(;null!==ik&&!ao();)i7(ik);break}catch(b){i1(a,b)}return(dS=dR=null,T.H=d,T.A=e,ii=c,null!==ik)?0:(ij=null,il=0,c5(),it)}(a,b):i6(a,b,!0),f=d;;){if(0===e)iq&&!d&&iZ(a,b,0,!1);else{if(c=a.current.alternate,f&&!function(a){for(var b=a;;){var c=b.tag;if((0===c||11===c||15===c)&&16384&b.flags&&null!==(c=b.updateQueue)&&null!==(c=c.stores))for(var d=0;d<c.length;d++){var e=c[d],f=e.getSnapshot;e=e.value;try{if(!cz(f(),e))return!1}catch(a){return!1}}if(c=b.child,16384&b.subtreeFlags&&null!==c)c.return=b,b=c;else{if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}(c)){e=i6(a,b,!1),f=!1;continue}if(2===e){if(f=b,a.errorRecoveryDisabledLanes&f)var h=0;else h=0!=(h=-0x20000001&a.pendingLanes)?h:0x20000000&h?0x20000000:0;if(0!==h){b=h;b:{e=iz;var i=a.current.memoizedState.isDehydrated;if(i&&(i0(a,h).flags|=256),2!==(h=i6(a,h,!1))){if(ir&&!i){a.errorRecoveryDisabledLanes|=f,iv|=f,e=4;break b}f=iA,iA=e,null!==f&&(null===iA?iA=f:iA.push.apply(iA,f))}e=h}if(f=!1,2!==e)continue}}if(1===e){i0(a,0),iZ(a,b,0,!0);break}b:{switch(d=a,f=e){case 0:case 1:throw Error(g(345));case 4:if((4194048&b)!==b&&(0x3c00000&b)!==b)break;case 6:iZ(d,b,ix,!ip);break b;case 2:iA=null;break;case 3:case 5:break;default:throw Error(g(329))}if((0x3c00000&b)===b&&10<(e=iC+300-aq())){if(iZ(d,b,ix,!ip),0!==aG(d,0,!0))break b;iK=b,d.timeoutHandle=ka(iY.bind(null,d,c,iA,iF,iB,b,ix,iv,iy,ip,f,"Throttled",-0,0),e);break b}iY(d,c,iA,iF,iB,b,ix,iv,iy,ip,f,null,-0,0)}}break}jy(a)}function iY(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.timeoutHandle=-1;var o,p,q=b.subtreeFlags,r=(0x13ffff00&f)===f;if(l=null,(r||8192&q||0x1002000==(0x1002000&q))&&(hq=null,ia(b,f,l={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:bC}),r&&(q=l,null!=(r=(9===(r=a.containerInfo).nodeType?r:r.ownerDocument).__reactViewTransition)&&(q.count++,q.waitingForViewTransition=!0,q=k9.bind(q),r.finished.then(q,q))),null!==(o=l,p=q=(0x3c00000&f)===f?iC-aq():(4194048&f)===f?iD-aq():0,o.stylesheets&&0===o.count&&lc(o,o.stylesheets),q=0<o.count||0<o.imgCount?function(a){var b=setTimeout(function(){if(o.stylesheets&&lc(o,o.stylesheets),o.unsuspend){var a=o.unsuspend;o.unsuspend=null,a()}},6e4+p);0<o.imgBytes&&0===k7&&(k7=62500*function(){if("function"==typeof performance.getEntriesByType){for(var a=0,b=0,c=performance.getEntriesByType("resource"),d=0;d<c.length;d++){var e=c[d],f=e.transferSize,g=e.initiatorType,h=e.duration;if(f&&h&&j2(g)){for(g=0,h=e.responseEnd,d+=1;d<c.length;d++){var i=c[d],j=i.startTime;if(j>h)break;var k=i.transferSize,l=i.initiatorType;k&&j2(l)&&(g+=k*((i=i.responseEnd)<h?1:(h-j)/(i-j)))}if(--d,b+=8*(f+g)/(e.duration/1e3),10<++a)break}}if(0<a)return b/a/1e6}return navigator.connection&&"number"==typeof(a=navigator.connection.downlink)?a:5}());var c=setTimeout(function(){if(o.waitingForImages=!1,0===o.count&&(o.stylesheets&&lc(o,o.stylesheets),o.unsuspend)){var a=o.unsuspend;o.unsuspend=null,a()}},(o.imgBytes>k7?50:800)+p);return o.unsuspend=a,function(){o.unsuspend=null,clearTimeout(b),clearTimeout(c)}}:null))){iK=f,a.cancelPendingCommit=q(jc.bind(null,a,b,f,c,d,e,g,h,i,k,l,null,m,n)),iZ(a,f,g,!j);return}jc(a,b,f,c,d,e,g,h,i,k,l)}function iZ(a,b,c,d){b&=~iw,b&=~iv,a.suspendedLanes|=b,a.pingedLanes&=~b,d&&(a.warmLanes|=b),d=a.expirationTimes;for(var e=b;0<e;){var f=31-az(e),g=1<<f;d[f]=-1,e&=~g}0!==c&&aL(a,c,b)}function i$(){return 0!=(6&ii)||(jz(0,!1),!1)}function i_(){if(null!==ik){if(0===im)var a=ik.return;else a=ik,dS=dR=null,fk(a),et=null,eu=0,a=ik;for(;null!==a;)g9(a.alternate,a),a=a.return;ik=null}}function i0(a,b){var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,kb(c)),null!==(c=a.cancelPendingCommit)&&(a.cancelPendingCommit=null,c()),iK=0,i_(),ij=a,ik=c=df(a.current,null),il=b,im=0,io=null,ip=!1,iq=aH(a,b),ir=!1,iy=ix=iw=iv=iu=it=0,iA=iz=null,iB=!1,0!=(8&b)&&(b|=32&b);var d=a.entangledLanes;if(0!==d)for(a=a.entanglements,d&=b;0<d;){var e=31-az(d),f=1<<e;b|=a[e],d&=~f}return is=b,c5(),c}function i1(a,b){e2=null,T.H=gj,b===ej||b===el?(b=er(),im=3):b===ek?(b=er(),im=4):im=b===gA?8:null!==b&&"object"==typeof b&&"function"==typeof b.then?6:1,io=b,null===ik&&(it=1,gv(a,dn(b,a.current)))}function i2(){var a=eS.current;return null===a||((4194048&il)===il?null===eT:((0x3c00000&il)===il||0!=(0x20000000&il))&&a===eT)}function i3(){var a=T.H;return T.H=gj,null===a?gj:a}function i4(){var a=T.A;return T.A=ig,a}function i5(){it=4,ip||(4194048&il)!==il&&null!==eS.current||(iq=!0),0==(0x7ffffff&iu)&&0==(0x7ffffff&iv)||null===ij||iZ(ij,il,ix,!1)}function i6(a,b,c){var d=ii;ii|=2;var e=i3(),f=i4();(ij!==a||il!==b)&&(iF=null,i0(a,b)),b=!1;var g=it;b:for(;;)try{if(0!==im&&null!==ik){var h=ik,i=io;switch(im){case 8:i_(),g=6;break b;case 3:case 2:case 9:case 6:null===eS.current&&(b=!0);var j=im;if(im=0,io=null,i9(a,h,i,j),c&&iq){g=0;break b}break;default:j=im,im=0,io=null,i9(a,h,i,j)}}(function(){for(;null!==ik;)i7(ik)})(),g=it;break}catch(b){i1(a,b)}return b&&a.shellSuspendCounter++,dS=dR=null,ii=d,T.H=e,T.A=f,null===ik&&(ij=null,il=0,c5()),g}function i7(a){var b=g2(a.alternate,a,is);a.memoizedProps=a.pendingProps,null===b?ja(a):ik=b}function i8(a){var b=a,c=b.alternate;switch(b.tag){case 15:case 0:b=gN(c,b,b.pendingProps,b.type,void 0,il);break;case 11:b=gN(c,b,b.pendingProps,b.type.render,b.ref,il);break;case 5:fk(b);default:g9(c,b),b=g2(c,b=ik=dg(b,is),is)}a.memoizedProps=a.pendingProps,null===b?ja(a):ik=b}function i9(a,b,c,d){dS=dR=null,fk(b),et=null,eu=0;var e=b.return;try{if(function(a,b,c,d,e){if(c.flags|=32768,null!==d&&"object"==typeof d&&"function"==typeof d.then){if(null!==(b=c.alternate)&&dX(b,c,e,!0),null!==(c=eS.current)){switch(c.tag){case 31:case 13:case 19:return null===eT?i5():null===c.alternate&&0===it&&(it=3),c.flags&=-257,c.flags|=65536,c.lanes=e,d===em?c.flags|=16384:(null===(b=c.updateQueue)?c.updateQueue=new Set([d]):b.add(d),jn(a,d,e)),!1;case 22:return c.flags|=65536,d===em?c.flags|=16384:(null===(b=c.updateQueue)?(b={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=b):null===(c=b.retryQueue)?b.retryQueue=new Set([d]):c.add(d),jn(a,d,e)),!1}throw Error(g(435,c.tag))}return jn(a,d,e),i5(),!1}if(dF)return null!==(b=eS.current)?(0==(65536&b.flags)&&(b.flags|=256),b.flags|=65536,b.lanes=e,d!==dI&&dP(dn(a=Error(g(422),{cause:d}),c))):(d!==dI&&dP(dn(b=Error(g(423),{cause:d}),c)),a=a.current.alternate,a.flags|=65536,e&=-e,a.lanes|=e,d=dn(d,c),e=gx(a.stateNode,d,e),eH(a,e),4!==it&&(it=2)),!1;var f=Error(g(520),{cause:d});if(f=dn(f,c),null===iz?iz=[f]:iz.push(f),4!==it&&(it=2),null===b)return!0;d=dn(d,c),c=b;do{switch(c.tag){case 3:return c.flags|=65536,a=e&-e,c.lanes|=a,a=gx(c.stateNode,d,a),eH(c,a),!1;case 1:if(b=c.type,f=c.stateNode,0==(128&c.flags)&&("function"==typeof b.getDerivedStateFromError||null!==f&&"function"==typeof f.componentDidCatch&&(null===iG||!iG.has(f))))return c.flags|=65536,e&=-e,c.lanes|=e,gz(e=gy(e),a,c,d),eH(c,e),!1;break;case 22:if(null!==c.memoizedState)return c.flags|=65536,!1}c=c.return}while(null!==c)return!1}(a,e,b,c,il)){it=1,gv(a,dn(c,a.current)),ik=null;return}}catch(b){if(null!==e)throw ik=e,b;it=1,gv(a,dn(c,a.current)),ik=null;return}32768&b.flags?(dF||1===d?a=!0:iq||0!=(0x20000000&il)?a=!1:(ip=a=!0,(2===d||9===d||3===d||6===d)&&null!==(d=eS.current)&&13===d.tag&&(d.flags|=16384)),jb(b,a)):ja(b)}function ja(a){var b=a;do{if(0!=(32768&b.flags))return void jb(b,ip);a=b.return;var c=function(a,b,c){var d=b.pendingProps;switch(dB(b),b.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return g8(b),null;case 3:return c=b.stateNode,d=null,null!==a&&(d=a.memoizedState.cache),b.memoizedState.cache!==d&&(b.flags|=2048),dU(d4),ae(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(null===a||null===a.child)&&(dM(b)?g3(b):null===a||a.memoizedState.isDehydrated&&0==(256&b.flags)||(b.flags|=1024,dO())),g8(b),null;case 26:var e=b.type,f=b.memoizedState;return null===a?(g3(b),null!==f?(g8(b),g5(b,f)):(g8(b),g4(b,e,null,d,c))):f?f!==a.memoizedState?(g3(b),g8(b),g5(b,f)):(g8(b),b.flags&=-0x1000001):((a=a.memoizedProps)!==d&&g3(b),g8(b),g4(b,e,a,d,c)),null;case 27:if(ag(b),c=ab.current,e=b.type,null!==a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if(!d){if(null===b.stateNode)throw Error(g(166));return g8(b),b.subtreeFlags&=-0x2000001,null}a=_.current,dM(b)?dK(b,a):(b.stateNode=a=kK(e,d,c),g3(b))}return g8(b),b.subtreeFlags&=-0x2000001,null;case 5:if(ag(b),e=b.type,null!==a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if(!d){if(null===b.stateNode)throw Error(g(166));return g8(b),b.subtreeFlags&=-0x2000001,null}if(f=_.current,dM(b))dK(b,f);else{var h=j5(ab.current);switch(f){case 1:f=h.createElementNS("http://www.w3.org/2000/svg",e);break;case 2:f=h.createElementNS("http://www.w3.org/1998/Math/MathML",e);break;default:switch(e){case"svg":f=h.createElementNS("http://www.w3.org/2000/svg",e);break;case"math":f=h.createElementNS("http://www.w3.org/1998/Math/MathML",e);break;case"script":(f=h.createElement("div")).innerHTML="<script></script>",f=f.removeChild(f.firstChild);break;case"select":f="string"==typeof d.is?h.createElement("select",{is:d.is}):h.createElement("select"),d.multiple?f.multiple=!0:d.size&&(f.size=d.size);break;default:f="string"==typeof d.is?h.createElement(e,{is:d.is}):h.createElement(e)}}f[aT]=b,f[aU]=d;b:for(h=b.child;null!==h;){if(5===h.tag||6===h.tag)f.appendChild(h.stateNode);else if(4!==h.tag&&27!==h.tag&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===b)break;for(;null===h.sibling;){if(null===h.return||h.return===b)break b;h=h.return}h.sibling.return=h.return,h=h.sibling}switch(b.stateNode=f,j1(f,e,d),e){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break;case"img":d=!0;break;default:d=!1}d&&g3(b)}}return g8(b),b.subtreeFlags&=-0x2000001,g4(b,b.type,null===a?null:a.memoizedProps,b.pendingProps,c),null;case 6:if(a&&null!=b.stateNode)a.memoizedProps!==d&&g3(b);else{if("string"!=typeof d&&null===b.stateNode)throw Error(g(166));if(a=ab.current,dM(b)){if(a=b.stateNode,c=b.memoizedProps,d=null,null!==(e=dD))switch(e.tag){case 27:case 5:d=e.memoizedProps}a[aT]=b,(a=!!(a.nodeValue===c||null!==d&&!0===d.suppressHydrationWarning||j$(a.nodeValue,c)))||dJ(b,!0)}else(a=j5(a).createTextNode(d))[aT]=b,b.stateNode=a}return g8(b),null;case 31:if(c=b.memoizedState,null===a||null!==a.memoizedState){if(d=dM(b),null!==c){if(null===a){if(!d)throw Error(g(318));if(!(a=null!==(a=b.memoizedState)?a.dehydrated:null))throw Error(g(557));a[aT]=b}else dN(),0==(128&b.flags)&&(b.memoizedState=null),b.flags|=4;g8(b),a=!1}else c=dO(),null!==a&&null!==a.memoizedState&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a){if(256&b.flags)return eY(b),b;return eY(b),null}if(0!=(128&b.flags))throw Error(g(558))}return g8(b),null;case 13:if(d=b.memoizedState,null===a||null!==a.memoizedState&&null!==a.memoizedState.dehydrated){if(e=dM(b),null!==d&&null!==d.dehydrated){if(null===a){if(!e)throw Error(g(318));if(!(e=null!==(e=b.memoizedState)?e.dehydrated:null))throw Error(g(317));e[aT]=b}else dN(),0==(128&b.flags)&&(b.memoizedState=null),b.flags|=4;g8(b),e=!1}else e=dO(),null!==a&&null!==a.memoizedState&&(a.memoizedState.hydrationErrors=e),e=!0;if(!e){if(256&b.flags)return eY(b),b;return eY(b),null}}if(eY(b),0!=(128&b.flags))return b.lanes=c,b;return c=null!==d,a=null!==a&&null!==a.memoizedState,c&&(d=b.child,e=null,null!==d.alternate&&null!==d.alternate.memoizedState&&null!==d.alternate.memoizedState.cachePool&&(e=d.alternate.memoizedState.cachePool.pool),f=null,null!==d.memoizedState&&null!==d.memoizedState.cachePool&&(f=d.memoizedState.cachePool.pool),f!==e&&(d.flags|=2048)),c!==a&&c&&(b.child.flags|=8192),g6(b,b.updateQueue),g8(b),null;case 4:return ae(),null===a&&jQ(b.stateNode.containerInfo),b.flags|=0x4000000,g8(b),null;case 10:return dU(b.type),g8(b),null;case 19:if(e_(b),null===(d=b.memoizedState))return g8(b),null;if(e=0!=(128&b.flags),null===(f=d.rendering))if(e)g7(d,!1);else{if(0!==it||null!==a&&0!=(128&a.flags))for(a=b.child;null!==a;){if(null!==(f=e0(a))){for(b.flags|=128,g7(d,!1),b.updateQueue=a=f.updateQueue,g6(b,a),b.subtreeFlags=0,a=c,c=b.child;null!==c;)dg(c,a),c=c.sibling;return e$(b,1&eZ.current|2),dF&&dy(b,d.treeForkCount),b.child}a=a.sibling}null!==d.tail&&aq()>iE&&(b.flags|=128,e=!0,g7(d,!1),b.lanes=4194304)}else{if(!e)if(null!==(a=e0(f))){if(b.flags|=128,e=!0,b.updateQueue=a=a.updateQueue,g6(b,a),g7(d,!0),null===d.tail&&"collapsed"!==d.tailMode&&"visible"!==d.tailMode&&!f.alternate&&!dF)return g8(b),null}else 2*aq()-d.renderingStartTime>iE&&0x20000000!==c&&(b.flags|=128,e=!0,g7(d,!1),b.lanes=4194304);d.isBackwards?(f.sibling=b.child,b.child=f):(null!==(a=d.last)?a.sibling=f:b.child=f,d.last=f)}if(null!==d.tail){a=d.tail;b:{for(c=a;null!==c;){if(null!==c.alternate){c=!1;break b}c=c.sibling}c=!0}return d.rendering=a,d.tail=a.sibling,d.renderingStartTime=aq(),a.sibling=null,f=eZ.current,f=e?1&f|2:1&f,"visible"===d.tailMode||"collapsed"===d.tailMode||!c||dF?e$(b,f):(c=f,$(eS,b),$(eZ,c),null===eT&&(eT=b)),dF&&dy(b,d.treeForkCount),a}return g8(b),null;case 22:case 23:return eY(b),eR(),d=null!==b.memoizedState,null!==a?null!==a.memoizedState!==d&&(b.flags|=8192):d&&(b.flags|=8192),d?0!=(0x20000000&c)&&0==(128&b.flags)&&(g8(b),6&b.subtreeFlags&&(b.flags|=8192)):g8(b),null!==(c=b.updateQueue)&&g6(b,c.retryQueue),c=null,null!==a&&null!==a.memoizedState&&null!==a.memoizedState.cachePool&&(c=a.memoizedState.cachePool.pool),d=null,null!==b.memoizedState&&null!==b.memoizedState.cachePool&&(d=b.memoizedState.cachePool.pool),d!==c&&(b.flags|=2048),null!==a&&Z(ef),null;case 24:return c=null,null!==a&&(c=a.memoizedState.cache),b.memoizedState.cache!==c&&(b.flags|=2048),dU(d4),g8(b),null;case 25:return null;case 30:return b.flags|=0x2000000,g8(b),null}throw Error(g(156,b.tag))}(b.alternate,b,is);if(null!==c){ik=c;return}if(null!==(b=b.sibling)){ik=b;return}ik=b=a}while(null!==b)0===it&&(it=5)}function jb(a,b){do{var c=function(a,b){switch(dB(b),b.tag){case 1:return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 3:return dU(d4),ae(),0!=(65536&(a=b.flags))&&0==(128&a)?(b.flags=-65537&a|128,b):null;case 26:case 27:case 5:return ag(b),null;case 31:if(null!==b.memoizedState){if(eY(b),null===b.alternate)throw Error(g(340));dN()}return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 13:if(eY(b),null!==(a=b.memoizedState)&&null!==a.dehydrated){if(null===b.alternate)throw Error(g(340));dN()}return 65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 19:return e_(b),65536&(a=b.flags)?(b.flags=-65537&a|128,null!==(a=b.memoizedState)&&(a.rendering=null,a.tail=null),b.flags|=4,b):null;case 4:return ae(),null;case 10:return dU(b.type),null;case 22:case 23:return eY(b),eR(),null!==a&&Z(ef),65536&(a=b.flags)?(b.flags=-65537&a|128,b):null;case 24:return dU(d4),null;default:return null}}(a.alternate,a);if(null!==c){c.flags&=32767,ik=c;return}if(null!==(c=a.return)&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!b&&null!==(a=a.sibling)){ik=a;return}ik=a=c}while(null!==a)it=6,ik=null}function jc(a,b,c,d,e,f,h,i,j,k,l){a.cancelPendingCommit=null;do jj();while(0!==iH)if(0!=(6&ii))throw Error(g(327));if(null!==b){var m;if(b===a.current)throw Error(g(177));if(!function(a,b,c,d,e,f){var g=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var h=a.entanglements,i=a.expirationTimes,j=a.hiddenUpdates;for(c=g&~c;0<c;){var k=31-az(c),l=1<<k;h[k]=0,i[k]=-1;var m=j[k];if(null!==m)for(j[k]=null,k=0;k<m.length;k++){var n=m[k];null!==n&&(n.lane&=-0x20000001)}c&=~l}0!==d&&aL(a,d,0),0!==f&&0===e&&0!==a.tag&&(a.suspendedLanes|=f&~(g&~b))}(a,c,f=b.lanes|b.childLanes|c4,h,i,j),a===ij&&(ik=ij=null,il=0),iJ=b,iI=a,iK=c,iL=f,iM=e,iN=d,iP=null,(0x13ffff00&c)===c?(m=a.transitionTypes,a.transitionTypes=null,iQ=m,d=10262):(iQ=null,d=10256),0!=(b.subtreeFlags&d)||0!=(b.flags&d)?(a.callbackNode=null,a.callbackPriority=0,am(au,function(){return jk(),null})):(a.callbackNode=null,a.callbackPriority=0),hp=!1,d=0!=(13878&b.flags),0!=(13878&b.subtreeFlags)||d){d=T.T,T.T=null,e=U.p,U.p=2,h=ii,ii|=4;try{!function(a,b,c){if(a=a.containerInfo,j3=lm,cE(a=cD(a))){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else b:{var e=(d=(d=a.ownerDocument)&&d.defaultView||window).getSelection&&d.getSelection();if(e&&0!==e.rangeCount){d=e.anchorNode;var f,g=e.anchorOffset,h=e.focusNode;e=e.focusOffset;try{d.nodeType,h.nodeType}catch(a){d=null;break b}var i=0,j=-1,k=-1,l=0,m=0,n=a,o=null;c:for(;;){for(;n!==d||0!==g&&3!==n.nodeType||(j=i+g),n!==h||0!==e&&3!==n.nodeType||(k=i+e),3===n.nodeType&&(i+=n.nodeValue.length),null!==(f=n.firstChild);)o=n,n=f;for(;;){if(n===a)break c;if(o===d&&++l===g&&(j=i),o===h&&++m===e&&(k=i),null!==(f=n.nextSibling))break;o=(n=o).parentNode}n=f}d=-1===j||-1===k?null:{start:j,end:k}}else d=null}d=d||{start:0,end:0}}else d=null;for(j4={focusedElem:a,selectionRange:d},lm=!1,c=(0x13ffff00&c)===c,hJ=b,b=c?9270:1028;null!==hJ;){if(a=hJ,c&&null!==(d=a.deletions))for(g=0;g<d.length;g++)c&&hA(d[g]);if(null===a.alternate&&0!=(2&a.flags))c&&hr(a),hO(c);else{if(22===a.tag){if(d=a.alternate,null!==a.memoizedState){null!==d&&null===d.memoizedState&&c&&hA(d),hO(c);continue}else if(null!==d&&null!==d.memoizedState){c&&hr(a),hO(c);continue}}d=a.child,0!=(a.subtreeFlags&b)&&null!==d?(d.return=a,hJ=d):(c&&function a(b){for(b=b.child;null!==b;){if(30===b.tag){var c=b.memoizedProps,d=c$(c,b.stateNode);c=c0(c.default,c.update),b.flags&=-5,"none"!==c&&hv(b,d,c,b.memoizedState=[],!1)}else 0!=(0x2000000&b.subtreeFlags)&&a(b);b=b.sibling}}(a),hO(c))}}hq=null}(a,b,c)}finally{ii=h,U.p=e,T.T=d}}iH=1,(b=hp)?iO=function(a,b,c,d,e,f,g,h,i){var j=9===b.nodeType?b:b.ownerDocument;try{var k=j.startViewTransition({update:function(){var b=j.defaultView,c=b.navigation&&b.navigation.transition,g=j.fonts.status;d();var h=[];if("loaded"===g&&(j.documentElement.clientHeight,"loading"===j.fonts.status&&h.push(j.fonts.ready)),g=h.length,null!==a)for(var i=a.suspenseyImages,k=0,l=0;l<i.length;l++){var m=i[l];if(!m.complete){var n=m.getBoundingClientRect();if(0<n.bottom&&0<n.right&&n.top<b.innerHeight&&n.left<b.innerWidth){if((k+=k5(m))>k7){h.length=g;break}m=new Promise(kn.bind(m)),h.push(m)}}}return 0<h.length?(b=Promise.race([Promise.all(h),new Promise(function(a){return setTimeout(a,500)})]).then(e,e),(c?Promise.allSettled([c.finished,b]):b).then(f,f)):(e(),c)?c.finished.then(f,f):void f()},types:c});j.__reactViewTransition=k;var l=[];return k.ready.then(function(){for(var a=j.documentElement.getAnimations({subtree:!0}),b=0;b<a.length;b++){var c=a[b],d=c.effect,e=d.pseudoElement;if(null!=e&&e.startsWith("::view-transition")){l.push(c),c=d.getKeyframes();for(var f=e=void 0,h=!0,i=0;i<c.length;i++){var k=c[i],m=k.width;if(void 0===e)e=m;else if(e!==m){h=!1;break}if(m=k.height,void 0===f)f=m;else if(f!==m){h=!1;break}delete k.width,delete k.height,"none"===k.transform&&delete k.transform}h&&void 0!==e&&void 0!==f&&(d.setKeyframes(c),(h=getComputedStyle(d.target,d.pseudoElement)).width!==e||h.height!==f)&&((h=c[0]).width=e,h.height=f,(h=c[c.length-1]).width=e,h.height=f,d.setKeyframes(c))}}g()},function(a){j.__reactViewTransition===k&&(j.__reactViewTransition=null);try{"object"==typeof a&&null!==a&&"InvalidStateError"===a.name&&("View transition was skipped because document visibility state is hidden."===a.message||"Skipping view transition because document visibility state has become hidden."===a.message||"Skipping view transition because viewport size changed."===a.message||"Transition was aborted because of invalid state"===a.message)&&(a=null),null!==a&&i(a)}finally{d(),e(),g()}}),k.finished.finally(function(){for(var a=0;a<l.length;a++)l[a].cancel();j.__reactViewTransition===k&&(j.__reactViewTransition=null),h()}),k}catch(a){return d(),e(),g(),null}}(l,a.containerInfo,iQ,jf,jg,je,jh,jk,jd,null,null):(jf(),jg(),jh())}}function jd(a){0!==iH&&(0,iI.onRecoverableError)(a,{componentStack:null})}function je(){3===iH&&(iH=0,h1(iJ,iI),iH=4)}function jf(){if(1===iH){iH=0;var a=iI,b=iJ,c=iK,d=0!=(13878&b.flags);if(0!=(13878&b.subtreeFlags)||d){d=T.T,T.T=null;var e=U.p;U.p=2;var f=ii;ii|=4;try{hL=hM=!1,h$(b,a,c),c=j4;var g=cD(a.containerInfo),h=c.focusedElem,i=c.selectionRange;if(g!==h&&h&&h.ownerDocument&&function a(b,c){return!!b&&!!c&&(b===c||(!b||3!==b.nodeType)&&(c&&3===c.nodeType?a(b,c.parentNode):"contains"in b?b.contains(c):!!b.compareDocumentPosition&&!!(16&b.compareDocumentPosition(c))))}(h.ownerDocument.documentElement,h)){if(null!==i&&cE(h)){var j=i.start,k=i.end;if(void 0===k&&(k=j),"selectionStart"in h)h.selectionStart=j,h.selectionEnd=Math.min(k,h.value.length);else{var l=h.ownerDocument||document,m=l&&l.defaultView||window;if(m.getSelection){var n=m.getSelection(),o=h.textContent.length,p=Math.min(i.start,o),q=void 0===i.end?p:Math.min(i.end,o);!n.extend&&p>q&&(g=q,q=p,p=g);var r=cC(h,p),s=cC(h,q);if(r&&s&&(1!==n.rangeCount||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)){var t=l.createRange();t.setStart(r.node,r.offset),n.removeAllRanges(),p>q?(n.addRange(t),n.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),n.addRange(t))}}}}for(l=[],n=h;n=n.parentNode;)1===n.nodeType&&l.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"==typeof h.focus&&h.focus(),h=0;h<l.length;h++){var u=l[h];u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}lm=!!j3,j4=j3=null}finally{ii=f,U.p=e,T.T=d}}a.current=b,iH=2}}function jg(){if(2===iH){iH=0;var a=iI,b=iJ,c=0!=(8772&b.flags);if(0!=(8772&b.subtreeFlags)||c){c=T.T,T.T=null;var d=U.p;U.p=2;var e=ii;ii|=4;try{hP(a,b.alternate,b)}finally{ii=e,U.p=d,T.T=c}}iH=3}}function jh(){if(4===iH||3===iH){iH=0,iO=null,ap();var a=iI,b=iJ,c=iK,d=iN,e=(0x13ffff00&c)===c?10262:10256;if(0!=(b.subtreeFlags&e)||0!=(b.flags&e)?iH=5:(iH=0,iJ=iI=null,ji(a,a.pendingLanes)),0===(e=a.pendingLanes)&&(iG=null),aP(c),b=b.stateNode,ay&&"function"==typeof ay.onCommitFiberRoot)try{ay.onCommitFiberRoot(ax,b,void 0,128==(128&b.current.flags))}catch(a){}if(null!==d){b=T.T,e=U.p,U.p=2,T.T=null;try{for(var f=a.onRecoverableError,g=0;g<d.length;g++){var h=d[g];f(h.value,{componentStack:h.stack})}}finally{T.T=b,U.p=e}}if(d=iP,f=iQ,iQ=null,null!==d)for(iP=null,null===f&&(f=[]),h=0;h<d.length;h++)(0,d[h])(f);0!=(3&iK)&&jj(),jy(a),e=a.pendingLanes,0!=(261930&c)&&0!=(42&e)?a===iS?iR++:(iR=0,iS=a):iR=0,jz(0,!1)}}function ji(a,b){0==(a.pooledCacheLanes&=b)&&null!=(b=a.pooledCache)&&(a.pooledCache=null,d6(b))}function jj(){return null!==iO&&(iO.skipTransition(),iO=null),jf(),jg(),jh(),jk()}function jk(){if(5!==iH)return!1;var a=iI,b=iL;iL=0;var c=aP(iK),d=T.T,e=U.p;try{U.p=32>c?32:c,T.T=null,c=iM,iM=null;var f=iI,h=iK;if(iH=0,iJ=iI=null,iK=0,0!=(6&ii))throw Error(g(331));var i=ii;if(ii|=4,id(f.current),h6(f,f.current,h,c),ii=i,jz(0,!1),ay&&"function"==typeof ay.onPostCommitFiberRoot)try{ay.onPostCommitFiberRoot(ax,f)}catch(a){}return!0}finally{U.p=e,T.T=d,ji(a,b)}}function jl(a,b,c){b=dn(c,b),b=gx(a.stateNode,b,2),null!==(a=eF(a,b,2))&&(aK(a,2),jy(a))}function jm(a,b,c){if(3===a.tag)jl(a,a,c);else for(;null!==b;){if(3===b.tag){jl(b,a,c);break}if(1===b.tag){var d=b.stateNode;if("function"==typeof b.type.getDerivedStateFromError||"function"==typeof d.componentDidCatch&&(null===iG||!iG.has(d))){a=dn(c,a),null!==(d=eF(b,c=gy(2),2))&&(gz(c,d,b,a),aK(d,2),jy(d));break}}b=b.return}}function jn(a,b,c){var d=a.pingCache;if(null===d){d=a.pingCache=new ih;var e=new Set;d.set(b,e)}else void 0===(e=d.get(b))&&(e=new Set,d.set(b,e));e.has(c)||(ir=!0,e.add(c),a=jo.bind(null,a,b,c),b.then(a,a))}function jo(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,ij===a&&(il&c)===c&&(4===it||3===it&&(0x3c00000&il)===il&&300>aq()-iC?0==(2&ii)&&i0(a,0):iw|=c,iy===il&&(iy=0)),jy(a)}function jp(a,b){0===b&&(b=aI()),null!==(a=c8(a,b))&&(aK(a,b),jy(a))}function jq(a){var b=a.memoizedState,c=0;null!==b&&(c=b.retryLane),jp(a,c)}function jr(a,b){var c=0;switch(a.tag){case 31:case 13:var d=a.stateNode,e=a.memoizedState;null!==e&&(c=e.retryLane);break;case 19:d=a.stateNode;break;case 22:d=a.stateNode._retryCache;break;default:throw Error(g(314))}null!==d&&d.delete(b),jp(a,c)}var js=null,jt=null,ju=!1,jv=!1,jw=!1,jx=0;function jy(a){a!==jt&&null===a.next&&(null===jt?js=jt=a:jt=jt.next=a),jv=!0,ju||(ju=!0,kd(function(){0!=(6&ii)?am(as,jA):jB()}))}function jz(a,b){if(!jw&&jv){jw=!0;do for(var c=!1,d=js;null!==d;){if(!b)if(0!==a){var e=d.pendingLanes;if(0===e)var f=0;else{var g=d.suspendedLanes,h=d.pingedLanes;f=0xc000095&(f=(1<<31-az(42|a)+1)-1&(e&~(g&~h)))?0xc000095&f|1:f?2|f:0}0!==f&&(c=!0,jE(d,f))}else f=il,0==(3&(f=aG(d,d===ij?f:0,null!==d.cancelPendingCommit||-1!==d.timeoutHandle)))||aH(d,f)||(c=!0,jE(d,f));d=d.next}while(c)jw=!1}}function jA(){jB()}function jB(){jv=ju=!1;var a,b=0;0===jx||((a=window.event)&&"popstate"===a.type?a===j9||(j9=a,0):(j9=null,1))||(b=jx);for(var c=aq(),d=null,e=js;null!==e;){var f=e.next,g=jC(e,c);0===g?(e.next=null,null===d?js=f:d.next=f,null===f&&(jt=d)):(d=e,(0!==b||0!=(3&g))&&(jv=!0)),e=f}0!==iH&&5!==iH||jz(b,!1),0!==jx&&(jx=0)}function jC(a,b){for(var c=a.suspendedLanes,d=a.pingedLanes,e=a.expirationTimes,f=-0x3c00001&a.pendingLanes;0<f;){var g=31-az(f),h=1<<g,i=e[g];-1===i?(0==(h&c)||0!=(h&d))&&(e[g]=function(a,b){switch(a){case 1:case 2:case 4:case 8:case 64:return b+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;default:return -1}}(h,b)):i<=b&&(a.expiredLanes|=h),f&=~h}if(b=ij,c=il,c=aG(a,a===b?c:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle),d=a.callbackNode,0===c||a===b&&(2===im||9===im)||null!==a.cancelPendingCommit)return null!==d&&null!==d&&an(d),a.callbackNode=null,a.callbackPriority=0;if(0==(3&c)||aH(a,c)){if((b=c&-c)===a.callbackPriority)return b;switch(null!==d&&an(d),aP(c)){case 2:case 8:c=at;break;case 32:default:c=au;break;case 0x10000000:c=aw}return c=am(c,d=jD.bind(null,a)),a.callbackPriority=b,a.callbackNode=c,b}return null!==d&&null!==d&&an(d),a.callbackPriority=2,a.callbackNode=null,2}function jD(a,b){if(0!==iH&&5!==iH)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(jj()&&a.callbackNode!==c)return null;var d=il;return 0===(d=aG(a,a===ij?d:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle))?null:(iX(a,d,b),jC(a,aq()),null!=a.callbackNode&&a.callbackNode===c?jD.bind(null,a):null)}function jE(a,b){if(jj())return null;iX(a,b,!0)}function jF(){if(0===jx){var a=eb;0===a&&(a=aC,0==(261888&(aC<<=1))&&(aC=256)),jx=a}return jx}function jG(a){return null==a||"symbol"==typeof a||"boolean"==typeof a?null:"function"==typeof a?a:bB(""+a)}function jH(a,b){var c=b.ownerDocument.createElement("input");return c.name=b.name,c.value=b.value,a.id&&c.setAttribute("form",a.id),b.parentNode.insertBefore(c,b),a=new FormData(a),c.parentNode.removeChild(c),a}for(var jI=0;jI<cX.length;jI++){var jJ=cX[jI];cY(jJ.toLowerCase(),"on"+(jJ[0].toUpperCase()+jJ.slice(1)))}cY(cP,"onAnimationEnd"),cY(cQ,"onAnimationIteration"),cY(cR,"onAnimationStart"),cY("dblclick","onDoubleClick"),cY("focusin","onFocus"),cY("focusout","onBlur"),cY(cS,"onTransitionRun"),cY(cT,"onTransitionStart"),cY(cU,"onTransitionCancel"),cY(cV,"onTransitionEnd"),a8("onMouseEnter",["mouseout","mouseover"]),a8("onMouseLeave",["mouseout","mouseover"]),a8("onPointerEnter",["pointerout","pointerover"]),a8("onPointerLeave",["pointerout","pointerover"]),a7("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a7("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a7("onBeforeInput",["compositionend","keypress","textInput","paste"]),a7("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a7("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a7("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jK="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jK));function jM(a,b){b=0!=(4&b);for(var c=0;c<a.length;c++){var d=a[c],e=d.event;d=d.listeners;b:{var f=void 0;if(b)for(var g=d.length-1;0<=g;g--){var h=d[g],i=h.instance,j=h.currentTarget;if(h=h.listener,i!==f&&e.isPropagationStopped())break b;f=h,e.currentTarget=j;try{f(e)}catch(a){c1(a)}e.currentTarget=null,f=i}else for(g=0;g<d.length;g++){if(i=(h=d[g]).instance,j=h.currentTarget,h=h.listener,i!==f&&e.isPropagationStopped())break b;f=h,e.currentTarget=j;try{f(e)}catch(a){c1(a)}e.currentTarget=null,f=i}}}}function jN(a,b){var c=b[aW];void 0===c&&(c=b[aW]=new Set);var d=a+"__bubble";c.has(d)||(jR(b,a,2,!1),c.add(d))}function jO(a,b,c){var d=0;b&&(d|=4),jR(c,a,d,b)}var jP="_reactListening"+Math.random().toString(36).slice(2);function jQ(a){if(!a[jP]){a[jP]=!0,a5.forEach(function(b){"selectionchange"!==b&&(jL.has(b)||jO(b,!1,a),jO(b,!0,a))});var b=9===a.nodeType?a:a.ownerDocument;null===b||b[jP]||(b[jP]=!0,jO("selectionchange",!1,b))}}function jR(a,b,c,d){switch(lt(b)){case 2:var e=ln;break;case 8:e=lo;break;default:e=lp}c=e.bind(null,b,c,a),e=void 0,d?void 0!==e?a.addEventListener(b,c,{capture:!0,passive:e}):a.addEventListener(b,c,!0):void 0!==e?a.addEventListener(b,c,{passive:e}):a.addEventListener(b,c,!1)}function jS(a,b,c,d,e){var f=d;if(0==(1&b)&&0==(2&b)&&null!==d)b:for(;;){if(null===d)return;var g=d.tag;if(3===g||4===g){var h=d.stateNode.containerInfo;if(h===e)break;if(4===g)for(g=d.return;null!==g;){var j=g.tag;if((3===j||4===j)&&g.stateNode.containerInfo===e)return;g=g.return}for(;null!==h;){if(null===(g=a0(h)))return;if(5===(j=g.tag)||6===j||26===j||27===j){d=f=g;continue b}h=h.parentNode}}d=d.return}bJ(function(){var d=f,e=bE(c),g=[];b:{var h=cW.get(a);if(void 0!==h){var j=bZ,k=a;switch(a){case"keypress":if(0===bP(c))break b;case"keydown":case"keyup":j=cc;break;case"focusin":k="focus",j=b3;break;case"focusout":k="blur",j=b3;break;case"beforeblur":case"afterblur":j=b3;break;case"click":if(2===c.button)break b;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=b1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=b2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=ce;break;case cP:case cQ:case cR:j=b4;break;case cV:j=cf;break;case"scroll":case"scrollend":j=b_;break;case"wheel":j=cg;break;case"copy":case"cut":case"paste":j=b5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=cd;break;case"toggle":case"beforetoggle":j=ch}var l=0!=(4&b),m=!l&&("scroll"===a||"scrollend"===a),n=l?null!==h?h+"Capture":null:h;l=[];for(var o,p=d;null!==p;){var q=p;if(o=q.stateNode,5!==(q=q.tag)&&26!==q&&27!==q||null===o||null===n||null!=(q=bK(p,n))&&l.push(jT(p,q,o)),m)break;p=p.return}0<l.length&&(h=new j(h,k,null,c,e),g.push({event:h,listeners:l}))}}if(0==(7&b)){j="mouseover"===a||"pointerover"===a,h="mouseout"===a||"pointerout"===a,!(j&&c!==bD&&(k=c.relatedTarget||c.fromElement)&&(a0(k)||k[aV]))&&(h||j)&&(k=e.window===e?e:(j=e.ownerDocument)?j.defaultView||j.parentWindow:window,h?(j=c.relatedTarget||c.toElement,h=d,null!==(j=j?a0(j):null)&&(m=i(j),l=j.tag,j!==m||5!==l&&27!==l&&6!==l)&&(j=null)):(h=null,j=d),h!==j&&(l=b1,q="onMouseLeave",n="onMouseEnter",p="mouse",("pointerout"===a||"pointerover"===a)&&(l=cd,q="onPointerLeave",n="onPointerEnter",p="pointer"),m=null==h?k:a2(h),o=null==j?k:a2(j),(k=new l(q,p+"leave",h,c,e)).target=m,k.relatedTarget=o,q=null,a0(e)===d&&((l=new l(n,p+"enter",j,c,e)).target=o,l.relatedTarget=m,q=l),m=q,l=h&&j?v(h,j,jV):null,null!==h&&jW(g,k,h,l,!1),null!==j&&null!==m&&jW(g,m,j,l,!0)));b:{if("select"===(j=(h=d?a2(d):window).nodeName&&h.nodeName.toLowerCase())||"input"===j&&"file"===h.type)var r,s,t,u=cs;else if(cm(h))if(1){u=cw;var w=cv}else u=cy;else(j=h.nodeName)&&"input"===j.toLowerCase()&&("checkbox"===h.type||"radio"===h.type)?u=cx:d&&by(d.elementType)&&(u=cs);if(u&&(u=u(a,d))){cn(g,u,c,e);break b}w&&w(a,h,d),"focusout"===a&&d&&"number"===h.type&&null!=d.memoizedProps.value&&bq(h,"number",h.value)}switch(w=d?a2(d):window,a){case"focusin":(cm(w)||"true"===w.contentEditable)&&(cF=w,cG=d,cH=null);break;case"focusout":cH=cG=cF=null;break;case"mousedown":cI=!0;break;case"contextmenu":case"mouseup":case"dragend":cI=!1,cJ(g,c,e);break;case"selectionchange":0;case"keydown":case"keyup":cJ(g,c,e)}ck?cj(a,c)&&(t="onCompositionEnd"):"keydown"===a&&229===c.keyCode&&(t="onCompositionStart"),t&&0<(w=jU(d,t)).length&&(t=new b6(t,a,null,c,e),g.push({event:t,listeners:w}),s?t.data=s:null!==(s="object"==typeof(r=(r=c).detail)&&"data"in r?r.data:null)&&(t.data=s)),(s=function(a,b){if(ck)return"compositionend"===a||cj(a,b)?(a=bO(),bN=bM=bL=null,ck=!1,a):null;switch(a){case"paste":default:return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return b.data}}(a,c))&&0<(t=jU(d,"onBeforeInput")).length&&(w=new b6("onBeforeInput","beforeinput",null,c,e),g.push({event:w,listeners:t}),w.data=s);var y=a;if("submit"===y&&d&&d.stateNode===e){var z=jG((e[aU]||null).action),A=c.submitter;A&&null!==(y=(y=A[aU]||null)?jG(y.formAction):A.getAttribute("formAction"))&&(z=y,A=null);var B=new bZ("action","action",null,c,e);g.push({event:B,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(0!==jx){var a=A?jH(e,A):new FormData(e);f5(d,{pending:!0,data:a,method:e.method,action:z},null,a)}}else"function"==typeof z&&(B.preventDefault(),f5(d,{pending:!0,data:a=A?jH(e,A):new FormData(e),method:e.method,action:z},z,a))},currentTarget:e}]})}}jM(g,b)})}function jT(a,b,c){return{instance:a,listener:b,currentTarget:c}}function jU(a,b){for(var c=b+"Capture",d=[];null!==a;){var e=a,f=e.stateNode;if(5!==(e=e.tag)&&26!==e&&27!==e||null===f||(null!=(e=bK(a,c))&&d.unshift(jT(a,e,f)),null!=(e=bK(a,b))&&d.push(jT(a,e,f))),3===a.tag)return d;a=a.return}return[]}function jV(a){if(null===a)return null;do a=a.return;while(a&&5!==a.tag&&27!==a.tag)return a||null}function jW(a,b,c,d,e){for(var f=b._reactName,g=[];null!==c&&c!==d;){var h=c,i=h.alternate,j=h.stateNode;if(h=h.tag,null!==i&&i===d)break;5!==h&&26!==h&&27!==h||null===j||(i=j,e?null!=(j=bK(c,f))&&g.unshift(jT(c,j,i)):e||null!=(j=bK(c,f))&&g.push(jT(c,j,i))),c=c.return}0!==g.length&&a.push({event:b,listeners:g})}var jX=/\r\n?/g,jY=/\u0000|\uFFFD/g;function jZ(a){return("string"==typeof a?a:""+a).replace(jX,"\n").replace(jY,"")}function j$(a,b){return b=jZ(b),jZ(a)===b}function j_(a,b,c,d,e,f){switch(c){case"children":if("string"==typeof d)"body"===b||"textarea"===b&&""===d||bu(a,d);else{if("number"!=typeof d&&"bigint"!=typeof d)return;"body"!==b&&bu(a,""+d)}break;case"className":bf(a,"class",d);break;case"tabIndex":bf(a,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":bf(a,c,d);break;case"style":bx(a,d,f);return;case"data":if("object"!==b){bf(a,"data",d);break}case"src":case"href":if(""===d&&("a"!==b||"href"!==c)||null==d||"function"==typeof d||"symbol"==typeof d||"boolean"==typeof d){a.removeAttribute(c);break}d=bB(""+d),a.setAttribute(c,d);break;case"action":case"formAction":if("function"==typeof d){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof f&&("formAction"===c?("input"!==b&&j_(a,b,"name",e.name,e,null),j_(a,b,"formEncType",e.formEncType,e,null),j_(a,b,"formMethod",e.formMethod,e,null),j_(a,b,"formTarget",e.formTarget,e,null)):(j_(a,b,"encType",e.encType,e,null),j_(a,b,"method",e.method,e,null),j_(a,b,"target",e.target,e,null))),null==d||"symbol"==typeof d||"boolean"==typeof d){a.removeAttribute(c);break}d=bB(""+d),a.setAttribute(c,d);break;case"onClick":null!=d&&(a.onclick=bC);return;case"onScroll":null!=d&&jN("scroll",a);return;case"onScrollEnd":null!=d&&jN("scrollend",a);return;case"dangerouslySetInnerHTML":if(null!=d){if("object"!=typeof d||!("__html"in d))throw Error(g(61));if(null!=(c=d.__html)){if(null!=e.children)throw Error(g(60));a.innerHTML=c}}break;case"multiple":a.multiple=d&&"function"!=typeof d&&"symbol"!=typeof d;break;case"muted":a.muted=d&&"function"!=typeof d&&"symbol"!=typeof d;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==d||"function"==typeof d||"boolean"==typeof d||"symbol"==typeof d){a.removeAttribute("xlink:href");break}c=bB(""+d),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,""+d):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":!0===d?a.setAttribute(c,""):!1!==d&&null!=d&&"function"!=typeof d&&"symbol"!=typeof d?a.setAttribute(c,d):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":null!=d&&"function"!=typeof d&&"symbol"!=typeof d&&!isNaN(d)&&1<=d?a.setAttribute(c,d):a.removeAttribute(c);break;case"rowSpan":case"start":null==d||"function"==typeof d||"symbol"==typeof d||isNaN(d)?a.removeAttribute(c):a.setAttribute(c,d);break;case"popover":jN("beforetoggle",a),jN("toggle",a),be(a,"popover",d);break;case"xlinkActuate":bg(a,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":bg(a,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":bg(a,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":bg(a,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":bg(a,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":bg(a,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":bg(a,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":bg(a,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":bg(a,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":be(a,"is",d);break;case"innerText":case"textContent":return;default:if(2<c.length&&("o"===c[0]||"O"===c[0])&&("n"===c[1]||"N"===c[1]))return;be(a,c=bz.get(c)||c,d)}bc=!0}function j0(a,b,c,d,e,f){switch(c){case"style":bx(a,d,f);return;case"dangerouslySetInnerHTML":if(null!=d){if("object"!=typeof d||!("__html"in d))throw Error(g(61));if(null!=(c=d.__html)){if(null!=e.children)throw Error(g(60));a.innerHTML=c}}break;case"children":if("string"==typeof d)bu(a,d);else{if("number"!=typeof d&&"bigint"!=typeof d)return;bu(a,""+d)}break;case"onScroll":null!=d&&jN("scroll",a);return;case"onScrollEnd":null!=d&&jN("scrollend",a);return;case"onClick":null!=d&&(a.onclick=bC);return;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":return;default:if(!a6.hasOwnProperty(c))b:{if("o"===c[0]&&"n"===c[1]&&(e=c.endsWith("Capture"),b=c.slice(2,e?c.length-7:void 0),"function"==typeof(f=null!=(f=a[aU]||null)?f[c]:null)&&a.removeEventListener(b,f,e),"function"==typeof d)){"function"!=typeof f&&null!==f&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(b,d,e);break b}bc=!0,c in a?a[c]=d:!0===d?a.setAttribute(c,""):be(a,c,d)}return}bc=!0}function j1(a,b,c){switch(b){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jN("error",a),jN("load",a);var d,e=!1,f=!1;for(d in c)if(c.hasOwnProperty(d)){var h=c[d];if(null!=h)switch(d){case"src":e=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(g(137,b));default:j_(a,b,d,h,c,null)}}f&&j_(a,b,"srcSet",c.srcSet,c,null),e&&j_(a,b,"src",c.src,c,null);return;case"input":jN("invalid",a);var i=d=h=f=null,j=null,k=null;for(e in c)if(c.hasOwnProperty(e)){var l=c[e];if(null!=l)switch(e){case"name":f=l;break;case"type":h=l;break;case"checked":j=l;break;case"defaultChecked":k=l;break;case"value":d=l;break;case"defaultValue":i=l;break;case"children":case"dangerouslySetInnerHTML":if(null!=l)throw Error(g(137,b));break;default:j_(a,b,e,l,c,null)}}bp(a,d,i,j,k,h,f,!1);return;case"select":for(f in jN("invalid",a),e=h=d=null,c)if(c.hasOwnProperty(f)&&null!=(i=c[f]))switch(f){case"value":d=i;break;case"defaultValue":h=i;break;case"multiple":e=i;default:j_(a,b,f,i,c,null)}b=d,c=h,a.multiple=!!e,null!=b?br(a,!!e,b,!1):null!=c&&br(a,!!e,c,!0);return;case"textarea":for(h in jN("invalid",a),d=f=e=null,c)if(c.hasOwnProperty(h)&&null!=(i=c[h]))switch(h){case"value":e=i;break;case"defaultValue":f=i;break;case"children":d=i;break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(g(91));break;default:j_(a,b,h,i,c,null)}bt(a,e,f,d);return;case"option":for(j in c)c.hasOwnProperty(j)&&null!=(e=c[j])&&("selected"===j?a.selected=e&&"function"!=typeof e&&"symbol"!=typeof e:j_(a,b,j,e,c,null));return;case"dialog":jN("beforetoggle",a),jN("toggle",a),jN("cancel",a),jN("close",a);break;case"iframe":case"object":jN("load",a);break;case"video":case"audio":for(e=0;e<jK.length;e++)jN(jK[e],a);break;case"image":jN("error",a),jN("load",a);break;case"details":jN("toggle",a);break;case"embed":case"source":case"link":jN("error",a),jN("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(k in c)if(c.hasOwnProperty(k)&&null!=(e=c[k]))switch(k){case"children":case"dangerouslySetInnerHTML":throw Error(g(137,b));default:j_(a,b,k,e,c,null)}return;default:if(by(b)){for(l in c)c.hasOwnProperty(l)&&void 0!==(e=c[l])&&j0(a,b,l,e,c,void 0);return}}for(i in c)c.hasOwnProperty(i)&&null!=(e=c[i])&&j_(a,b,i,e,c,null)}function j2(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var j3=null,j4=null;function j5(a){return 9===a.nodeType?a:a.ownerDocument}function j6(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function j7(a,b){if(0===a)switch(b){case"svg":return 1;case"math":return 2;default:return 0}return 1===a&&"foreignObject"===b?0:a}function j8(a,b){return"textarea"===a||"noscript"===a||"string"==typeof b.children||"number"==typeof b.children||"bigint"==typeof b.children||"object"==typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var j9=null,ka="function"==typeof setTimeout?setTimeout:void 0,kb="function"==typeof clearTimeout?clearTimeout:void 0,kc="function"==typeof Promise?Promise:void 0,kd="function"==typeof queueMicrotask?queueMicrotask:void 0!==kc?function(a){return kc.resolve(null).then(a).catch(ke)}:ka;function ke(a){setTimeout(function(){throw a})}function kf(a){return"head"===a}function kg(a,b){var c=b,d=0;do{var e=c.nextSibling;if(a.removeChild(c),e&&8===e.nodeType)if("/$"===(c=e.data)||"/&"===c){if(0===d){a.removeChild(e),lL(b);return}d--}else if("$"===c||"$?"===c||"$~"===c||"$!"===c||"&"===c)d++;else if("html"===c)kL(a.ownerDocument.documentElement);else if("head"===c){kL(c=a.ownerDocument.head);for(var f=c.firstChild;f;){var g=f.nextSibling,h=f.nodeName;f[a$]||"SCRIPT"===h||"STYLE"===h||"LINK"===h&&"stylesheet"===f.rel.toLowerCase()||c.removeChild(f),f=g}}else"body"===c&&kL(a.ownerDocument.body);c=e}while(c)lL(b)}function kh(a,b){var c=a;a=0;do{var d=c.nextSibling;if(1===c.nodeType?b?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",""===c.getAttribute("style")&&c.removeAttribute("style")):3===c.nodeType&&(b?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),d&&8===d.nodeType)if("/$"===(c=d.data))if(0===a)break;else a--;else"$"!==c&&"$?"!==c&&"$~"!==c&&"$!"!==c||a++;c=d}while(c)}function ki(a,b,c){if(b=CSS.escape(b)!==b?"r-"+btoa(b).replace(/=/g,""):b,a.style.viewTransitionName=b,null!=c&&(a.style.viewTransitionClass=c),"inline"===(c=getComputedStyle(a)).display){if(1===(b=a.getClientRects()).length)var d=1;else for(var e=d=0;e<b.length;e++){var f=b[e];0<f.width&&0<f.height&&d++}1===d&&((a=a.style).display=1===b.length?"inline-block":"block",a.marginTop="-"+c.paddingTop,a.marginBottom="-"+c.paddingBottom)}}function kj(a,b){a=a.style;var c=null!=(b=b.style)?b.hasOwnProperty("viewTransitionName")?b.viewTransitionName:b.hasOwnProperty("view-transition-name")?b["view-transition-name"]:null:null;a.viewTransitionName=null==c||"boolean"==typeof c?"":(""+c).trim(),c=null!=b?b.hasOwnProperty("viewTransitionClass")?b.viewTransitionClass:b.hasOwnProperty("view-transition-class")?b["view-transition-class"]:null:null,a.viewTransitionClass=null==c||"boolean"==typeof c?"":(""+c).trim(),"inline-block"===a.display&&(null==b?a.display=a.margin="":(c=b.display,a.display=null==c||"boolean"==typeof c?"":c,null!=(c=b.margin)?a.margin=c:(c=b.hasOwnProperty("marginTop")?b.marginTop:b["margin-top"],a.marginTop=null==c||"boolean"==typeof c?"":c,b=b.hasOwnProperty("marginBottom")?b.marginBottom:b["margin-bottom"],a.marginBottom=null==b||"boolean"==typeof b?"":b)))}function kk(a,b,c){return c=c.ownerDocument.defaultView,{rect:a,abs:"absolute"===b.position||"fixed"===b.position,clip:"none"!==b.clipPath||"visible"!==b.overflow||"none"!==b.filter||"none"!==b.mask||"none"!==b.mask||"0px"!==b.borderRadius,view:0<=a.bottom&&0<=a.right&&a.top<=c.innerHeight&&a.left<=c.innerWidth}}function kl(a){return kk(a.getBoundingClientRect(),getComputedStyle(a),a)}function km(a){var b=a.getBoundingClientRect();return kk(b=new DOMRect(b.x+2e4,b.y+2e4,b.width,b.height),getComputedStyle(a),a)}function kn(a){this.addEventListener("load",a),this.addEventListener("error",a)}function ko(a,b){this._scope=document.documentElement,this._selector="::view-transition-"+a+"("+b+")"}function kp(a){return{name:a,group:new ko("group",a),imagePair:new ko("image-pair",a),old:new ko("old",a),new:new ko("new",a)}}function kq(a){this._fragmentFiber=a,this._observers=this._eventListeners=null}function kr(a,b,c,d){return o(a).addEventListener(b,c,d),!1}function ks(a,b,c,d){return o(a).removeEventListener(b,c,d),!1}function kt(a){return null==a?"0":"boolean"==typeof a?"c="+(a?"1":"0"):"c="+(a.capture?"1":"0")+"&o="+(a.once?"1":"0")+"&p="+(a.passive?"1":"0")}function ku(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if(f.type===b&&f.listener===c&&kt(f.optionsOrUseCapture)===kt(d))return e}return -1}function kv(a,b){var c=a=o(a),d=b;function e(){f=!0}var f=!1;try{c.addEventListener("focus",e),(c.focus||HTMLElement.prototype.focus).call(c,d)}finally{c.removeEventListener("focus",e)}return f}function kw(a,b){return b.push(a),!1}function kx(a){return(a=o(a))===a.ownerDocument.activeElement&&(a.blur(),!0)}function ky(a,b){return a=o(a),b.observe(a),!1}function kz(a,b){return a=o(a),b.unobserve(a),!1}function kA(a,b){return a=o(a),b.push.apply(b,a.getClientRects()),!1}function kB(a,b){var c=b._eventListeners;if(null!==c)for(var d=0;d<c.length;d++){var e=c[d];a.addEventListener(e.type,e.listener,e.optionsOrUseCapture)}null!==b._observers&&b._observers.forEach(function(b){b.observe(a)})}function kC(a){var b=a.firstChild;for(b&&10===b.nodeType&&(b=b.nextSibling);b;){var c=b;switch(b=b.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":kC(c),a_(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===c.rel.toLowerCase())continue}a.removeChild(c)}}function kD(a,b){for(;8!==a.nodeType;)if((1!==a.nodeType||"INPUT"!==a.nodeName||"hidden"!==a.type)&&!b||null===(a=kG(a.nextSibling)))return null;return a}function kE(a){return"$?"===a.data||"$~"===a.data}function kF(a){return"$!"===a.data||"$?"===a.data&&"loading"!==a.ownerDocument.readyState}function kG(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break;if(8===b){if("$"===(b=a.data)||"$!"===b||"$?"===b||"$~"===b||"&"===b||"F!"===b||"F"===b)break;if("/$"===b||"/&"===b)return null}}return a}ko.prototype.animate=function(a,b){return(b="number"==typeof b?{duration:b}:w({},b)).pseudoElement=this._selector,this._scope.animate(a,b)},ko.prototype.getAnimations=function(){for(var a=this._scope,b=this._selector,c=a.getAnimations({subtree:!0}),d=[],e=0;e<c.length;e++){var f=c[e].effect;null!==f&&f.target===a&&f.pseudoElement===b&&d.push(c[e])}return d},ko.prototype.getComputedStyle=function(){return getComputedStyle(this._scope,this._selector)},kq.prototype.addEventListener=function(a,b,c){null===this._eventListeners&&(this._eventListeners=[]);var d=this._eventListeners;-1===ku(d,a,b,c)&&(d.push({type:a,listener:b,optionsOrUseCapture:c}),m(this._fragmentFiber.child,!1,kr,a,b,c)),this._eventListeners=d},kq.prototype.removeEventListener=function(a,b,c){var d=this._eventListeners;null!=d&&0<d.length&&(m(this._fragmentFiber.child,!1,ks,a,b,c),a=ku(d,a,b,c),null!==this._eventListeners&&this._eventListeners.splice(a,1))},kq.prototype.dispatchEvent=function(a){var b=n(this._fragmentFiber);if(null===b)return!0;b=o(b);var c=this._eventListeners;if(null!==c&&0<c.length||!a.bubbles){var d=document.createTextNode("");if(c)for(var e=0;e<c.length;e++){var f=c[e];d.addEventListener(f.type,f.listener,f.optionsOrUseCapture)}if(b.appendChild(d),a=d.dispatchEvent(a),c)for(e=0;e<c.length;e++)f=c[e],d.removeEventListener(f.type,f.listener,f.optionsOrUseCapture);return b.removeChild(d),a}return b.dispatchEvent(a)},kq.prototype.focus=function(a){m(this._fragmentFiber.child,!0,kv,a,void 0,void 0)},kq.prototype.focusLast=function(a){var b=[];m(this._fragmentFiber.child,!0,kw,b,void 0,void 0);for(var c=b.length-1;0<=c&&!kv(b[c],a);c--);},kq.prototype.blur=function(){m(this._fragmentFiber.child,!1,kx,void 0,void 0,void 0)},kq.prototype.observeUsing=function(a){null===this._observers&&(this._observers=new Set),this._observers.add(a),m(this._fragmentFiber.child,!1,ky,a,void 0,void 0)},kq.prototype.unobserveUsing=function(a){var b=this._observers;null!==b&&b.has(a)&&(b.delete(a),m(this._fragmentFiber.child,!1,kz,a,void 0,void 0))},kq.prototype.getClientRects=function(){var a=[];return m(this._fragmentFiber.child,!1,kA,a,void 0,void 0),a},kq.prototype.getRootNode=function(a){var b=n(this._fragmentFiber);return null===b?this:o(b).getRootNode(a)},kq.prototype.compareDocumentPosition=function(a){var b=n(this._fragmentFiber);if(null===b)return Node.DOCUMENT_POSITION_DISCONNECTED;var c=[];m(this._fragmentFiber.child,!1,kw,c,void 0,void 0);var d=o(b);if(0===c.length){c=this._fragmentFiber;var e=d.compareDocumentPosition(a);return b=e,d===a?b=Node.DOCUMENT_POSITION_CONTAINS:e&Node.DOCUMENT_POSITION_CONTAINED_BY&&(m(c.sibling,!1,r),c=p,p=null,b=null===c?Node.DOCUMENT_POSITION_PRECEDING:0===(a=o(c).compareDocumentPosition(a))||a&Node.DOCUMENT_POSITION_FOLLOWING?Node.DOCUMENT_POSITION_FOLLOWING:Node.DOCUMENT_POSITION_PRECEDING),b|Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC}b=o(c[0]),e=o(c[c.length-1]);for(var f=o(c[0]),g=!1,h=this._fragmentFiber.return;null!==h&&(4===h.tag&&(g=!0),3!==h.tag&&5!==h.tag);)h=h.return;if(null==(f=g?f.parentElement:d))return Node.DOCUMENT_POSITION_DISCONNECTED;d=f.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY,f=f.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY,g=b.compareDocumentPosition(a);var i=e.compareDocumentPosition(a);return h=g&Node.DOCUMENT_POSITION_CONTAINED_BY||i&Node.DOCUMENT_POSITION_CONTAINED_BY,i=d&&f&&g&Node.DOCUMENT_POSITION_FOLLOWING&&i&Node.DOCUMENT_POSITION_PRECEDING,(b=d&&b===a||f&&e===a||h||i?Node.DOCUMENT_POSITION_CONTAINED_BY:(d||b!==a)&&(f||e!==a)?g:Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)&Node.DOCUMENT_POSITION_DISCONNECTED||b&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC||function(a,b,c,d,e){var f=a0(e);if(a&Node.DOCUMENT_POSITION_CONTAINED_BY){if(c=!!f)b:{for(;null!==f;){if(7===f.tag&&(f===b||f.alternate===b)){c=!0;break b}f=f.return}c=!1}return c}if(a&Node.DOCUMENT_POSITION_CONTAINS){if(null===f)return f=e.ownerDocument,e===f||e===f.body;b:{for(f=b,b=n(b);null!==f;){if((5===f.tag||3===f.tag)&&(f===b||f.alternate===b)){f=!0;break b}f=f.return}f=!1}return f}return a&Node.DOCUMENT_POSITION_PRECEDING?((b=!!f)&&!(b=f===c)&&(null===(b=v(c,f,u))?b=!1:(m(b,!0,s,f,c),f=p,p=null,b=null!==f)),b):!!(a&Node.DOCUMENT_POSITION_FOLLOWING)&&((b=!!f)&&!(b=f===d)&&(null===(b=v(d,f,u))?b=!1:(m(b,!0,t,f,d),f=p,q=p=null,b=null!==f)),b)}(b,this._fragmentFiber,c[0],c[c.length-1],a)?b:Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC},kq.prototype.scrollIntoView=function(a){if("object"==typeof a)throw Error(g(566));var b=[];m(this._fragmentFiber.child,!1,kw,b,void 0,void 0);var c=!1!==a;if(0===b.length){b=this._fragmentFiber;var d=[null,null],e=n(b);null!==e&&function a(b,c,d){for(var e=3<arguments.length&&void 0!==arguments[3]&&arguments[3];null!==d;){if(d===c)if(e=!0,!d.sibling)return!0;else d=d.sibling;if(5===d.tag){if(e)return b[1]=d,!0;b[0]=d}else if((22!==d.tag||null===d.memoizedState)&&a(b,c,d.child,e))return!0;d=d.sibling}return!1}(d,b,e.child),null!==(c=c?d[1]||d[0]||n(this._fragmentFiber):d[0]||d[1])&&o(c).scrollIntoView(a)}else for(d=c?b.length-1:0;d!==(c?-1:b.length);)o(b[d]).scrollIntoView(a),d+=c?-1:1};var kH=null;function kI(a){a=a.nextSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("/$"===c||"/&"===c){if(0===b)return kG(a.nextSibling);b--}else"$"!==c&&"$!"!==c&&"$?"!==c&&"$~"!==c&&"&"!==c||b++}a=a.nextSibling}return null}function kJ(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if("$"===c||"$!"===c||"$?"===c||"$~"===c||"&"===c){if(0===b)return a;b--}else"/$"!==c&&"/&"!==c||b++}a=a.previousSibling}return null}function kK(a,b,c){switch(b=j5(c),a){case"html":if(!(a=b.documentElement))throw Error(g(452));return a;case"head":if(!(a=b.head))throw Error(g(453));return a;case"body":if(!(a=b.body))throw Error(g(454));return a;default:throw Error(g(451))}}function kL(a){for(var b=a.attributes;b.length;)a.removeAttributeNode(b[0]);a_(a)}var kM=new Map,kN=new Set;function kO(a){return"function"==typeof a.getRootNode?a.getRootNode():9===a.nodeType?a:a.ownerDocument}var kP=U.d;U.d={f:function(){var a=kP.f(),b=i$();return a||b},r:function(a){var b=a1(a);null!==b&&5===b.tag&&"form"===b.type?f7(b):kP.r(a)},D:function(a){kP.D(a),kR("dns-prefetch",a,null)},C:function(a,b){kP.C(a,b),kR("preconnect",a,b)},L:function(a,b,c){if(kP.L(a,b,c),kQ&&a&&b){var d='link[rel="preload"][as="'+bn(b)+'"]';"image"===b&&c&&c.imageSrcSet?(d+='[imagesrcset="'+bn(c.imageSrcSet)+'"]',"string"==typeof c.imageSizes&&(d+='[imagesizes="'+bn(c.imageSizes)+'"]')):d+='[href="'+bn(a)+'"]';var e=d;switch(b){case"style":e=kT(a);break;case"script":e=kW(a)}kM.has(e)||(a=w({rel:"preload",href:"image"===b&&c&&c.imageSrcSet?void 0:a,as:b},c),kM.set(e,a),null!==kQ.querySelector(d)||"style"===b&&kQ.querySelector(kU(e))||"script"===b&&kQ.querySelector(kX(e))||(j1(b=kQ.createElement("link"),"link",a),a4(b),kQ.head.appendChild(b)))}},m:function(a,b){if(kP.m(a,b),kQ&&a){var c=b&&"string"==typeof b.as?b.as:"script",d='link[rel="modulepreload"][as="'+bn(c)+'"][href="'+bn(a)+'"]',e=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":e=kW(a)}if(!kM.has(e)&&(a=w({rel:"modulepreload",href:a},b),kM.set(e,a),null===kQ.querySelector(d))){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(kQ.querySelector(kX(e)))return}j1(c=kQ.createElement("link"),"link",a),a4(c),kQ.head.appendChild(c)}}},X:function(a,b){if(kP.X(a,b),kQ&&a){var c=a3(kQ).hoistableScripts,d=kW(a),e=c.get(d);e||((e=kQ.querySelector(kX(d)))||(a=w({src:a,async:!0},b),(b=kM.get(d))&&k_(a,b),a4(e=kQ.createElement("script")),j1(e,"link",a),kQ.head.appendChild(e)),e={type:"script",instance:e,count:1,state:null},c.set(d,e))}},S:function(a,b,c){if(kP.S(a,b,c),kQ&&a){var d=a3(kQ).hoistableStyles,e=kT(a);b=b||"default";var f=d.get(e);if(!f){var g={loading:0,preload:null};if(f=kQ.querySelector(kU(e)))g.loading=5;else{a=w({rel:"stylesheet",href:a,"data-precedence":b},c),(c=kM.get(e))&&k$(a,c);var h=f=kQ.createElement("link");a4(h),j1(h,"link",a),h._p=new Promise(function(a,b){h.onload=a,h.onerror=b}),h.addEventListener("load",function(){g.loading|=1}),h.addEventListener("error",function(){g.loading|=2}),g.loading|=4,kZ(f,b,kQ)}f={type:"stylesheet",instance:f,count:1,state:g},d.set(e,f)}}},M:function(a,b){if(kP.M(a,b),kQ&&a){var c=a3(kQ).hoistableScripts,d=kW(a),e=c.get(d);e||((e=kQ.querySelector(kX(d)))||(a=w({src:a,async:!0,type:"module"},b),(b=kM.get(d))&&k_(a,b),a4(e=kQ.createElement("script")),j1(e,"link",a),kQ.head.appendChild(e)),e={type:"script",instance:e,count:1,state:null},c.set(d,e))}}};var kQ="u"<typeof document?null:document;function kR(a,b,c){if(kQ&&"string"==typeof b&&b){var d=bn(b);d='link[rel="'+a+'"][href="'+d+'"]',"string"==typeof c&&(d+='[crossorigin="'+c+'"]'),kN.has(d)||(kN.add(d),a={rel:a,crossOrigin:c,href:b},null===kQ.querySelector(d)&&(j1(b=kQ.createElement("link"),"link",a),a4(b),kQ.head.appendChild(b)))}}function kS(a,b,c,d){var e=(e=ab.current)?kO(e):null;if(!e)throw Error(g(446));switch(a){case"meta":case"title":return null;case"style":return"string"==typeof c.precedence&&"string"==typeof c.href?(b=kT(c.href),(d=(c=a3(e).hoistableStyles).get(b))||(d={type:"style",instance:null,count:0,state:null},c.set(b,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===c.rel&&"string"==typeof c.href&&"string"==typeof c.precedence){a=kT(c.href);var f,h,i,j,k=a3(e).hoistableStyles,l=k.get(a);if(l||(e=e.ownerDocument||e,l={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(a,l),(k=e.querySelector(kU(a)))&&!k._p&&(l.instance=k,l.state.loading=5),kM.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},kM.set(a,c),k||(f=e,h=a,i=c,j=l.state,f.querySelector('link[rel="preload"][as="style"]['+h+"]")?j.loading=1:(j.preload=h=f.createElement("link"),h.addEventListener("load",function(){return j.loading|=1}),h.addEventListener("error",function(){return j.loading|=2}),j1(h,"link",i),a4(h),f.head.appendChild(h))))),b&&null===d)throw Error(g(528,""));return l}if(b&&null!==d)throw Error(g(529,""));return null;case"script":return b=c.async,"string"==typeof(c=c.src)&&b&&"function"!=typeof b&&"symbol"!=typeof b?(b=kW(c),(d=(c=a3(e).hoistableScripts).get(b))||(d={type:"script",instance:null,count:0,state:null},c.set(b,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(g(444,a))}}function kT(a){return'href="'+bn(a)+'"'}function kU(a){return'link[rel="stylesheet"]['+a+"]"}function kV(a){return w({},a,{"data-precedence":a.precedence,precedence:null})}function kW(a){return'[src="'+bn(a)+'"]'}function kX(a){return"script[async]"+a}function kY(a,b,c){if(b.count++,null===b.instance)switch(b.type){case"style":var d=a.querySelector('style[data-href~="'+bn(c.href)+'"]');if(d)return b.instance=d,a4(d),d;var e=w({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return a4(d=(a.ownerDocument||a).createElement("style")),j1(d,"style",e),kZ(d,c.precedence,a),b.instance=d;case"stylesheet":e=kT(c.href);var f=a.querySelector(kU(e));if(f)return b.state.loading|=4,b.instance=f,a4(f),f;d=kV(c),(e=kM.get(e))&&k$(d,e),a4(f=(a.ownerDocument||a).createElement("link"));var h=f;return h._p=new Promise(function(a,b){h.onload=a,h.onerror=b}),j1(f,"link",d),b.state.loading|=4,kZ(f,c.precedence,a),b.instance=f;case"script":if(f=kW(c.src),e=a.querySelector(kX(f)))return b.instance=e,a4(e),e;return d=c,(e=kM.get(f))&&k_(d=w({},c),e),a4(e=(a=a.ownerDocument||a).createElement("script")),j1(e,"link",d),a.head.appendChild(e),b.instance=e;case"void":return null;default:throw Error(g(443,b.type))}return"stylesheet"===b.type&&0==(4&b.state.loading)&&(d=b.instance,b.state.loading|=4,kZ(d,c.precedence,a)),b.instance}function kZ(a,b,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),e=d.length?d[d.length-1]:null,f=e,g=0;g<d.length;g++){var h=d[g];if(h.dataset.precedence===b)f=h;else if(f!==e)break}f?f.parentNode.insertBefore(a,f.nextSibling):(b=9===c.nodeType?c.head:c).insertBefore(a,b.firstChild)}function k$(a,b){null==a.crossOrigin&&(a.crossOrigin=b.crossOrigin),null==a.referrerPolicy&&(a.referrerPolicy=b.referrerPolicy),null==a.title&&(a.title=b.title)}function k_(a,b){null==a.crossOrigin&&(a.crossOrigin=b.crossOrigin),null==a.referrerPolicy&&(a.referrerPolicy=b.referrerPolicy),null==a.integrity&&(a.integrity=b.integrity)}var k0=null;function k1(a,b,c){if(null===k0){var d=new Map,e=k0=new Map;e.set(c,d)}else(d=(e=k0).get(c))||(d=new Map,e.set(c,d));if(d.has(a))return d;for(d.set(a,null),c=c.getElementsByTagName(a),e=0;e<c.length;e++){var f=c[e];if(!(f[a$]||f[aT]||"link"===a&&"stylesheet"===f.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==f.namespaceURI){var g=f.getAttribute(b)||"";g=a+g;var h=d.get(g);h?h.push(f):d.set(g,[f])}}return d}function k2(a,b,c){(a=a.ownerDocument||a).head.insertBefore(c,"title"===b?a.querySelector("head > title"):null)}function k3(a,b){return"img"===a&&null!=b.src&&""!==b.src&&null==b.onLoad&&"lazy"!==b.loading}function k4(a){return"stylesheet"!==a.type||0!=(3&a.state.loading)}function k5(a){return(a.width||100)*(a.height||100)*("number"==typeof devicePixelRatio?devicePixelRatio:1)*.25}function k6(a,b){"function"==typeof b.decode&&(a.imgCount++,b.complete||(a.imgBytes+=k5(b),a.suspenseyImages.push(b)),a=la.bind(a),b.decode().then(a,a))}var k7=0;function k8(a){if(0===a.count&&(0===a.imgCount||!a.waitingForImages)){if(a.stylesheets)lc(a,a.stylesheets);else if(a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}}}function k9(){this.count--,k8(this)}function la(){this.imgCount--,k8(this)}var lb=null;function lc(a,b){a.stylesheets=null,null!==a.unsuspend&&(a.count++,lb=new Map,b.forEach(ld,a),lb=null,k9.call(a))}function ld(a,b){if(!(4&b.state.loading)){var c=lb.get(a);if(c)var d=c.get(null);else{c=new Map,lb.set(a,c);for(var e=a.querySelectorAll("link[data-precedence],style[data-precedence]"),f=0;f<e.length;f++){var g=e[f];("LINK"===g.nodeName||"not all"!==g.getAttribute("media"))&&(c.set(g.dataset.precedence,g),d=g)}d&&c.set(null,d)}g=(e=b.instance).getAttribute("data-precedence"),(f=c.get(g)||d)===d&&c.set(null,e),c.set(g,e),this.count++,d=k9.bind(this),e.addEventListener("load",d),e.addEventListener("error",d),f?f.parentNode.insertBefore(e,f.nextSibling):(a=9===a.nodeType?a.head:a).insertBefore(e,a.firstChild),b.state.loading|=4}}var le={$$typeof:F,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function lf(a,b,c,d,e,f,g,h,i){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=aJ(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aJ(0),this.hiddenUpdates=aJ(null),this.identifierPrefix=d,this.onUncaughtError=e,this.onCaughtError=f,this.onRecoverableError=g,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=i,this.transitionTypes=null,this.incompleteTransitions=new Map}function lg(a,b,c,d,e,f,g,h,i,j,k,l){return a=new lf(a,b,c,g,i,j,k,l,h),b=1,!0===f&&(b|=24),f=dd(3,null,null,b),a.current=f,f.stateNode=a,b=d5(),b.refCount++,a.pooledCache=b,b.refCount++,f.memoizedState={element:d,isDehydrated:c,cache:b},eC(f),a}function lh(a,b,c,d,e,f){e=e?db:db,null===d.context?d.context=e:d.pendingContext=e,(d=eE(b)).payload={element:c},null!==(f=void 0===f?null:f)&&(d.callback=f),null!==(c=eF(a,d,b))&&(iW(c,a,b),eG(c,a,b))}function li(a,b){if(null!==(a=a.memoizedState)&&null!==a.dehydrated){var c=a.retryLane;a.retryLane=0!==c&&c<b?c:b}}function lj(a,b){li(a,b),(a=a.alternate)&&li(a,b)}function lk(a){if(13===a.tag||31===a.tag){var b=c8(a,0x4000000);null!==b&&iW(b,a,0x4000000),lj(a,0x4000000)}}function ll(a){if(13===a.tag||31===a.tag){var b=iT(),c=c8(a,b=aO(b));null!==c&&iW(c,a,b),lj(a,b)}}var lm=!0;function ln(a,b,c,d){var e=T.T;T.T=null;var f=U.p;try{U.p=2,lp(a,b,c,d)}finally{U.p=f,T.T=e}}function lo(a,b,c,d){var e=T.T;T.T=null;var f=U.p;try{U.p=8,lp(a,b,c,d)}finally{U.p=f,T.T=e}}function lp(a,b,c,d){if(lm){var e=lq(d);if(null===e)jS(a,b,d,lr,c),lC(a,d);else if(function(a,b,c,d,e){switch(b){case"focusin":return lv=lD(lv,a,b,c,d,e),!0;case"dragenter":return lw=lD(lw,a,b,c,d,e),!0;case"mouseover":return lx=lD(lx,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return ly.set(f,lD(ly.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,lz.set(f,lD(lz.get(f)||null,a,b,c,d,e)),!0}return!1}(e,a,b,c,d))d.stopPropagation();else if(lC(a,d),4&b&&-1<lB.indexOf(a)){for(;null!==e;){var f=a1(e);if(null!==f)switch(f.tag){case 3:if((f=f.stateNode).current.memoizedState.isDehydrated){var g=aF(f.pendingLanes);if(0!==g){var h=f;for(h.pendingLanes|=2,h.entangledLanes|=2;g;){var i=1<<31-az(g);h.entanglements[1]|=i,g&=~i}jy(f),0==(6&ii)&&(iE=aq()+500,jz(0,!1))}}break;case 31:case 13:null!==(h=c8(f,2))&&iW(h,f,2),i$(),lj(f,2)}if(null===(f=lq(d))&&jS(a,b,d,lr,c),f===e)break;e=f}null!==e&&d.stopPropagation()}else jS(a,b,d,null,c)}}function lq(a){return ls(a=bE(a))}var lr=null;function ls(a){if(lr=null,null!==(a=a0(a))){var b=i(a);if(null===b)a=null;else{var c=b.tag;if(13===c){if(null!==(a=j(b)))return a;a=null}else if(31===c){if(null!==(a=k(b)))return a;a=null}else if(3===c){if(b.stateNode.current.memoizedState.isDehydrated)return 3===b.tag?b.stateNode.containerInfo:null;a=null}else b!==a&&(a=null)}}return lr=a,null}function lt(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"resize":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ar()){case as:return 2;case at:return 8;case au:case av:return 32;case aw:return 0x10000000;default:return 32}default:return 32}}var lu=!1,lv=null,lw=null,lx=null,ly=new Map,lz=new Map,lA=[],lB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function lC(a,b){switch(a){case"focusin":case"focusout":lv=null;break;case"dragenter":case"dragleave":lw=null;break;case"mouseover":case"mouseout":lx=null;break;case"pointerover":case"pointerout":ly.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":lz.delete(b.pointerId)}}function lD(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a={blockedOn:b,domEventName:c,eventSystemFlags:d,nativeEvent:f,targetContainers:[e]},null!==b&&null!==(b=a1(b))&&lk(b)):(a.eventSystemFlags|=d,b=a.targetContainers,null!==e&&-1===b.indexOf(e)&&b.push(e)),a}function lE(a){var b=a0(a.target);if(null!==b){var c=i(b);if(null!==c){if(13===(b=c.tag)){if(null!==(b=j(c))){a.blockedOn=b,aR(a.priority,function(){ll(c)});return}}else if(31===b){if(null!==(b=k(c))){a.blockedOn=b,aR(a.priority,function(){ll(c)});return}}else if(3===b&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=3===c.tag?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function lF(a){if(null!==a.blockedOn)return!1;for(var b=a.targetContainers;0<b.length;){var c=lq(a.nativeEvent);if(null!==c)return null!==(b=a1(c))&&lk(b),a.blockedOn=c,!1;var d=new(c=a.nativeEvent).constructor(c.type,c);bD=d,c.target.dispatchEvent(d),bD=null,b.shift()}return!0}function lG(a,b,c){lF(a)&&c.delete(b)}function lH(){lu=!1,null!==lv&&lF(lv)&&(lv=null),null!==lw&&lF(lw)&&(lw=null),null!==lx&&lF(lx)&&(lx=null),ly.forEach(lG),lz.forEach(lG)}function lI(a,b){a.blockedOn===b&&(a.blockedOn=null,lu||(lu=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,lH)))}var lJ=null;function lK(a){lJ!==a&&(lJ=a,d.unstable_scheduleCallback(d.unstable_NormalPriority,function(){lJ===a&&(lJ=null);for(var b=0;b<a.length;b+=3){var c=a[b],d=a[b+1],e=a[b+2];if("function"!=typeof d)if(null===ls(d||c))continue;else break;var f=a1(c);null!==f&&(a.splice(b,3),b-=3,f5(f,{pending:!0,data:e,method:c.method,action:d},d,e))}}))}function lL(a){function b(b){return lI(b,a)}null!==lv&&lI(lv,a),null!==lw&&lI(lw,a),null!==lx&&lI(lx,a),ly.forEach(b),lz.forEach(b);for(var c=0;c<lA.length;c++){var d=lA[c];d.blockedOn===a&&(d.blockedOn=null)}for(;0<lA.length&&null===(c=lA[0]).blockedOn;)lE(c),null===c.blockedOn&&lA.shift();if(null!=(c=(a.ownerDocument||a).$$reactFormReplay))for(d=0;d<c.length;d+=3){var e=c[d],f=c[d+1],g=e[aU]||null;if("function"==typeof f)g||lK(c);else if(g){var h=null;if(f&&f.hasAttribute("formAction")){if(e=f,g=f[aU]||null)h=g.formAction;else if(null!==ls(e))continue}else h=g.action;"function"==typeof h?c[d+1]=h:(c.splice(d,3),d-=3),lK(c)}}}function lM(){function a(a){a.canIntercept&&"react-transition"===a.info&&a.intercept({handler:function(){return new Promise(function(a){return e=a})},focusReset:"manual",scroll:"manual"})}function b(){null!==e&&(e(),e=null),d||setTimeout(c,20)}function c(){if(!d&&!navigation.transition){var a=navigation.currentEntry;a&&null!=a.url&&navigation.navigate(a.url,{state:a.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var d=!1,e=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",b),navigation.addEventListener("navigateerror",b),setTimeout(c,100),function(){d=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",b),navigation.removeEventListener("navigateerror",b),null!==e&&(e(),e=null)}}}function lN(a){this._internalRoot=a}function lO(a){this._internalRoot=a}lO.prototype.render=lN.prototype.render=function(a){var b=this._internalRoot;if(null===b)throw Error(g(409));lh(b.current,iT(),a,b,null,null)},lO.prototype.unmount=lN.prototype.unmount=function(){var a=this._internalRoot;if(null!==a){this._internalRoot=null;var b=a.containerInfo;lh(a.current,2,null,a,null,null),i$(),b[aV]=null}},lO.prototype.unstable_scheduleHydration=function(a){if(a){var b=aQ();a={blockedOn:null,target:a,priority:b};for(var c=0;c<lA.length&&0!==b&&b<lA[c].priority;c++);lA.splice(c,0,a),0===c&&lE(a)}};var lP=e.version;if("19.3.0-canary-f93b9fd4-20251217"!==lP)throw Error(g(527,lP,"19.3.0-canary-f93b9fd4-20251217"));if(U.findDOMNode=function(a){var b=a._reactInternals;if(void 0===b){if("function"==typeof a.render)throw Error(g(188));throw Error(g(268,a=Object.keys(a).join(",")))}return null===(a=null!==(a=function(a){var b=a.alternate;if(!b){if(null===(b=i(a)))throw Error(g(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return l(e),a;if(f===d)return l(e),b;f=f.sibling}throw Error(g(188))}if(c.return!==d.return)c=e,d=f;else{for(var h=!1,j=e.child;j;){if(j===c){h=!0,c=e,d=f;break}if(j===d){h=!0,d=e,c=f;break}j=j.sibling}if(!h){for(j=f.child;j;){if(j===c){h=!0,c=f,d=e;break}if(j===d){h=!0,d=f,c=e;break}j=j.sibling}if(!h)throw Error(g(189))}}if(c.alternate!==d)throw Error(g(190))}if(3!==c.tag)throw Error(g(188));return c.stateNode.current===c?a:b}(b))?function a(b){var c=b.tag;if(5===c||26===c||27===c||6===c)return b;for(b=b.child;null!==b;){if(null!==(c=a(b)))return c;b=b.sibling}return null}(a):null)?null:a.stateNode},"u">typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lQ=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lQ.isDisabled&&lQ.supportsFiber)try{ax=lQ.inject({bundleType:0,version:"19.3.0-canary-f93b9fd4-20251217",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.3.0-canary-f93b9fd4-20251217"}),ay=lQ}catch(a){}}c.createRoot=function(a,b){if(!h(a))throw Error(g(299));var c=!1,d="",e=gs,f=gt,i=gu;return null!=b&&(!0===b.unstable_strictMode&&(c=!0),void 0!==b.identifierPrefix&&(d=b.identifierPrefix),void 0!==b.onUncaughtError&&(e=b.onUncaughtError),void 0!==b.onCaughtError&&(f=b.onCaughtError),void 0!==b.onRecoverableError&&(i=b.onRecoverableError)),b=lg(a,1,!1,null,null,c,d,null,e,f,i,lM),a[aV]=b.current,jQ(a),new lN(b)},c.hydrateRoot=function(a,b,c){if(!h(a))throw Error(g(299));var d,e=!1,f="",i=gs,j=gt,k=gu,l=null;return null!=c&&(!0===c.unstable_strictMode&&(e=!0),void 0!==c.identifierPrefix&&(f=c.identifierPrefix),void 0!==c.onUncaughtError&&(i=c.onUncaughtError),void 0!==c.onCaughtError&&(j=c.onCaughtError),void 0!==c.onRecoverableError&&(k=c.onRecoverableError),void 0!==c.formState&&(l=c.formState)),(b=lg(a,1,!0,b,null!=c?c:null,e,f,l,i,j,k,lM)).context=(d=null,db),c=b.current,(f=eE(e=aO(e=iT()))).callback=null,eF(c,f,e),c=e,b.current.lanes=c,aK(b,c),jy(b),a[aV]=b.current,jQ(a),new lO(b)},c.version="19.3.0-canary-f93b9fd4-20251217"},454947,(a,b,c)=>{"use strict";!function a(){if("u">typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(a){console.error(a)}}(),b.exports=a.r(371374)},645125,(a,b,c)=>{},238005,(a,b,c)=>{var d=function(){var a=String.fromCharCode,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",d={};function e(a,b){if(!d[a]){d[a]={};for(var c=0;c<a.length;c++)d[a][a.charAt(c)]=c}return d[a][b]}var f={compressToBase64:function(a){if(null==a)return"";var c=f._compress(a,6,function(a){return b.charAt(a)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(a){return null==a?"":""==a?null:f._decompress(a.length,32,function(c){return e(b,a.charAt(c))})},compressToUTF16:function(b){return null==b?"":f._compress(b,15,function(b){return a(b+32)})+" "},decompressFromUTF16:function(a){return null==a?"":""==a?null:f._decompress(a.length,16384,function(b){return a.charCodeAt(b)-32})},compressToUint8Array:function(a){for(var b=f.compress(a),c=new Uint8Array(2*b.length),d=0,e=b.length;d<e;d++){var g=b.charCodeAt(d);c[2*d]=g>>>8,c[2*d+1]=g%256}return c},decompressFromUint8Array:function(b){if(null==b)return f.decompress(b);for(var c=Array(b.length/2),d=0,e=c.length;d<e;d++)c[d]=256*b[2*d]+b[2*d+1];var g=[];return c.forEach(function(b){g.push(a(b))}),f.decompress(g.join(""))},compressToEncodedURIComponent:function(a){return null==a?"":f._compress(a,6,function(a){return c.charAt(a)})},decompressFromEncodedURIComponent:function(a){return null==a?"":""==a?null:(a=a.replace(/ /g,"+"),f._decompress(a.length,32,function(b){return e(c,a.charAt(b))}))},compress:function(b){return f._compress(b,16,function(b){return a(b)})},_compress:function(a,b,c){if(null==a)return"";var d,e,f,g={},h={},i="",j="",k="",l=2,m=3,n=2,o=[],p=0,q=0;for(f=0;f<a.length;f+=1)if(i=a.charAt(f),Object.prototype.hasOwnProperty.call(g,i)||(g[i]=m++,h[i]=!0),j=k+i,Object.prototype.hasOwnProperty.call(g,j))k=j;else{if(Object.prototype.hasOwnProperty.call(h,k)){if(256>k.charCodeAt(0)){for(d=0;d<n;d++)p<<=1,q==b-1?(q=0,o.push(c(p)),p=0):q++;for(d=0,e=k.charCodeAt(0);d<8;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}else{for(d=0,e=1;d<n;d++)p=p<<1|e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e=0;for(d=0,e=k.charCodeAt(0);d<16;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}0==--l&&(l=Math.pow(2,n),n++),delete h[k]}else for(d=0,e=g[k];d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;0==--l&&(l=Math.pow(2,n),n++),g[j]=m++,k=String(i)}if(""!==k){if(Object.prototype.hasOwnProperty.call(h,k)){if(256>k.charCodeAt(0)){for(d=0;d<n;d++)p<<=1,q==b-1?(q=0,o.push(c(p)),p=0):q++;for(d=0,e=k.charCodeAt(0);d<8;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}else{for(d=0,e=1;d<n;d++)p=p<<1|e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e=0;for(d=0,e=k.charCodeAt(0);d<16;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1}0==--l&&(l=Math.pow(2,n),n++),delete h[k]}else for(d=0,e=g[k];d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;0==--l&&(l=Math.pow(2,n),n++)}for(d=0,e=2;d<n;d++)p=p<<1|1&e,q==b-1?(q=0,o.push(c(p)),p=0):q++,e>>=1;for(;;){if(p<<=1,q==b-1){o.push(c(p));break}q++}return o.join("")},decompress:function(a){return null==a?"":""==a?null:f._decompress(a.length,32768,function(b){return a.charCodeAt(b)})},_decompress:function(b,c,d){var e,f,g,h,i,j,k,l=[],m=4,n=4,o=3,p="",q=[],r={val:d(0),position:c,index:1};for(e=0;e<3;e+=1)l[e]=e;for(g=0,i=4,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;switch(g){case 0:for(g=0,i=256,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;k=a(g);break;case 1:for(g=0,i=65536,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;k=a(g);break;case 2:return""}for(l[3]=k,f=k,q.push(k);;){if(r.index>b)return"";for(g=0,i=Math.pow(2,o),j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;switch(k=g){case 0:for(g=0,i=256,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;l[n++]=a(g),k=n-1,m--;break;case 1:for(g=0,i=65536,j=1;j!=i;)h=r.val&r.position,r.position>>=1,0==r.position&&(r.position=c,r.val=d(r.index++)),g|=(h>0)*j,j<<=1;l[n++]=a(g),k=n-1,m--;break;case 2:return q.join("")}if(0==m&&(m=Math.pow(2,o),o++),l[k])p=l[k];else{if(k!==n)return null;p=f+f.charAt(0)}q.push(p),l[n++]=f+p.charAt(0),m--,f=p,0==m&&(m=Math.pow(2,o),o++)}}};return f}();if("function"==typeof define&&define.amd)a.r,void 0!==d&&a.v(d);else null!=b?b.exports=d:"u">typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return d})},870769,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;var r,s,t,u,v,w,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS=a.i(260576),bT=a.i(741510);let bU="__TLDRAW_LIBRARY_VERSIONS__";function bV(a,b,c){if(!a||!b||!c)throw Error("Missing name/version/module system in built version of tldraw library");let d=function(){if(globalThis[bU])return globalThis[bU];let a={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,bU,{value:a,writable:!1,configurable:!1,enumerable:!1}),a}();if(d.versions.push({name:a,version:b,modules:c}),!d.scheduledNotice)try{d.scheduledNotice=setTimeout(()=>{d.scheduledNotice=null,bW(d)},100)}catch{bW(d)}}function bW(a){if(!a.versions.length||a.didWarn)return;let b=a.versions.sort((a,b)=>bX(a.version,b.version)),c=b[b.length-1].version,d=new Set,e=new Map;for(let a of b){if(e.has(a.name)){d.delete(a.name),b$(e,a.name,new Set).add(a.version);continue}a.version===c?d.add(a.name):(d.delete(a.name),b$(e,a.name,new Set).add(a.version))}if(e.size>0){console.log([`${bZ("[tldraw]",["bold","bgRed","textWhite"])} ${bZ("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${bZ(`v${c}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(d,a=>`  \u2022 \u2705 ${bZ(a,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(e,([a,b])=>{let d=Array.from(b).sort(bX).map(a=>bZ(`v${a}`,a===c?["textGreen"]:["textRed"]));return`  \u2022 \u274C ${bZ(a,["bold"])} (${d.join(", ")})`})].join("\n")),a.didWarn=!0;return}let f=new Map;for(let a of b)b$(f,a.name,{version:a.version,modules:[]}).modules.push(a.modules);let g=new Map;for(let[a,b]of f)b.modules.length>1&&g.set(a,b);if(g.size>0){console.log([`${bZ("[tldraw]",["bold","bgRed","textWhite"])} ${bZ("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(g,([a,b])=>{let c=b.modules.map((a,b)=>"esm"===a?`      ${b+1}. ES Modules`:`      ${b+1}. CommonJS`).join("\n");return`  \u2022 \u274C ${bZ(a,["bold"])} v${b.version}: 
${c}`}),"","You should configure your bundler to only import one version of each library."].join("\n")),a.didWarn=!0;return}}function bX(a,b){let c=a.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),d=b.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return c&&d?c[1]!==d[1]?Number(c[1])-Number(d[1]):c[2]!==d[2]?Number(c[2])-Number(d[2]):c[3]!==d[3]?Number(c[3])-Number(d[3]):c[4]&&d[4]?c[4].localeCompare(d[4]):c[4]?1:d[4]?-1:0:a.localeCompare(b)}let bY={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function bZ(a,b=[]){return`\x1b[${b.map(a=>bY[a]).join(";")}m${a}\x1b[m`}function b$(a,b,c){return a.has(b)?a.get(b):(a.set(b,c),c)}var b_=a.i(110857),b0=a.i(826882),b1=a.i(715732),b2=a.i(500872);function b3(a,b){let c=[];d:for(let d of a){for(let a of c)if(b?b(d,a):d===a)continue d;c.push(d)}return c}function b4(a){return a.filter(a=>null!=a)}function b5(a){return a[a.length-1]}function b6(a,b){let c,d=1/0;for(let e of a){let a=b(e);a<d&&(c=e,d=a)}return c}function b7(a,b){if(a===b)return!0;if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!Object.is(a[c],b[c]))return!1;return!0}function b8(a,b,c){let d=new Set(b.map(b=>b[a])),e=[];for(let b of c)d.has(b[a])||e.push(b);for(let a of b)e.push(a);return e}function b9(a){let b=(...c)=>{try{return a(...c)}catch(a){throw a instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(a,b),a}};return b}let ca=()=>{},cb={ok:a=>({ok:!0,value:a}),err:a=>({ok:!1,error:a}),all:a=>a.every(a=>a.ok)?cb.ok(a.map(a=>a.value)):cb.err(a.find(a=>!a.ok)?.error)};function cc(a,b){let c=b&&a&&"object"==typeof a&&b in a?a[b]:a;throw Error(`Unknown switch case ${c}`)}let cd=b9((a,b)=>{if(!a)throw Error(b||"Assertion Error")}),ce=b9((a,b)=>{if(null==a)throw Error(b??"value must be defined");return a});function cf(){let a,b;return Object.assign(new Promise((c,d)=>{a=c,b=d}),{resolve:a,reject:b})}function cg(a){return new Promise(b=>setTimeout(b,a))}function ch(...a){if(2===a.length){let[b,c]=a;c.addInitializer(function(){cd(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");let a=b.bind(this);cd(Reflect.defineProperty(this,c.name,{value:a,writable:!0,configurable:!0}),"Cannot bind a non-configurable class method.")})}else{let[b,c,d]=a;if(!d||"function"!=typeof d.value)throw TypeError(`Only methods can be decorated with @bind. <${c}> is not a method!`);return{configurable:!0,get(){let a=d.value.bind(this);return Object.defineProperty(this,c,{value:a,configurable:!0,writable:!0}),a}}}}class ci{items=new WeakMap;get(a,b){return this.items.has(a)||this.items.set(a,b(a)),this.items.get(a)}}function cj(a,b){let c,d=(...d)=>(c||((c={}).promise=new Promise((a,b)=>{c.resolve=a,c.reject=b})),clearTimeout(c.timeout),c.latestArgs=d,c.timeout=setTimeout(()=>{let b=c;c=void 0;try{b.resolve(a(...b.latestArgs))}catch(a){b.reject(a)}},b),c.promise);return d.cancel=()=>{c&&clearTimeout(c.timeout)},d}let ck=new WeakMap;function cl(a,b){if("object"!=typeof a||null===a)return;let c=ck.get(a);c||(c={tags:{},extras:{}},ck.set(a,c)),b.tags&&(c.tags={...c.tags,...b.tags}),b.extras&&(c.extras={...c.extras,...b.extras})}async function cm(a,b){return window.fetch(a,{referrerPolicy:"strict-origin-when-cross-origin",...b})}let cn=(a,b)=>{let c=new window.Image(a,b);return c.referrerPolicy="strict-origin-when-cross-origin",c};class co{static async urlToArrayBuffer(a){let b=await cm(a);return await b.arrayBuffer()}static async urlToBlob(a){let b=await cm(a);return await b.blob()}static async urlToDataUrl(a){if(a.startsWith("data:"))return a;let b=await co.urlToBlob(a);return await co.blobToDataUrl(b)}static async blobToDataUrl(a){return await new Promise((b,c)=>{if(a){let d=new FileReader;d.onload=()=>b(d.result),d.onerror=a=>c(a),d.onabort=a=>c(a),d.readAsDataURL(a)}})}static async blobToText(a){return await new Promise((b,c)=>{if(a){let d=new FileReader;d.onload=()=>b(d.result),d.onerror=a=>c(a),d.onabort=a=>c(a),d.readAsText(a)}})}static rewriteMimeType(a,b){return a.type===b?a:a instanceof File?new File([a],a.name,{type:b}):new Blob([a],{type:b})}}function cp(a){let b=0;for(let c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return b+""}function cq(a){let b=new DataView(a),c=0;for(let a=0;a<b.byteLength;a++)c=(c<<5)-c+b.getUint8(a)|0;return c+""}let cr=globalThis.crypto,cs=function(a=21){var d;d=a-=0,!b||b.length<d?(b=new Uint8Array(128*d),cr.getRandomValues(b),c=0):c+d>b.length&&(cr.getRandomValues(b),c=0),c+=d;let e="";for(let d=c-a;d<c;d++)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&b[d]];return e};function ct(a,b){let c=0;for(;a[b+c];)c+=a[b+c]+1;return c+1}let cu=[0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d];"u">typeof Int32Array&&(cu=new Int32Array(cu));class cv{static isPng(a,b){return 137===a.getUint8(b+0)&&80===a.getUint8(b+1)&&78===a.getUint8(b+2)&&71===a.getUint8(b+3)&&13===a.getUint8(b+4)&&10===a.getUint8(b+5)&&26===a.getUint8(b+6)&&10===a.getUint8(b+7)||!1}static getChunkType(a,b){return[String.fromCharCode(a.getUint8(b)),String.fromCharCode(a.getUint8(b+1)),String.fromCharCode(a.getUint8(b+2)),String.fromCharCode(a.getUint8(b+3))].join("")}static readChunks(a,b=0){let c={};if(!cv.isPng(a,b))throw Error("Not a PNG");for(b+=8;b<=a.buffer.byteLength;){let d=b,e=a.getInt32(b);b+=4;let f=cv.getChunkType(a,b);if("IDAT"===f&&c[f]){b+=e+4+4;continue}if("IEND"===f)break;c[f]={start:d,dataOffset:b+4,size:e},b+=e+4+4}return c}static parsePhys(a,b){return{ppux:a.getUint32(b),ppuy:a.getUint32(b+4),unit:a.getUint8(b+8)}}static findChunk(a,b){return cv.readChunks(a)[b]}static setPhysChunk(a,b=1,c){let d=46,e=0,f=cv.findChunk(a,"pHYs");f&&(d=f.start,e=f.size);let g=cv.findChunk(a,"IDAT");g&&(d=g.start,e=0);let h=new ArrayBuffer(21),i=new DataView(h);i.setUint32(0,9),i.setUint8(4,112),i.setUint8(5,72),i.setUint8(6,89),i.setUint8(7,115),i.setInt32(8,2835.5*b),i.setInt32(12,2835.5*b),i.setInt8(16,1);let j=new Uint8Array(h.slice(4,17));return i.setInt32(17,((a,b)=>{let c=0===b?0:-1^~~b;for(let b=0;b<a.length;b++)c=cu[(c^a[b])&255]^c>>>8;return -1^c})(j)),new Blob([a.buffer.slice(0,d),h,a.buffer.slice(d+e)],c)}}let cw=Object.freeze(["image/svg+xml"]),cx=Object.freeze(["image/jpeg","image/png","image/webp"]),cy=Object.freeze(["image/gif","image/apng","image/avif"]),cz=Object.freeze([...cx,...cw,...cy]),cA=Object.freeze(["video/mp4","video/webm","video/quicktime"]);Object.freeze([...cz,...cA]).join(",");class cB{static loadVideo(a){return new Promise((b,c)=>{let d=document.createElement("video");d.onloadeddata=()=>b(d),d.onerror=a=>{console.error(a),c(Error("Could not load video"))},d.crossOrigin="anonymous",d.src=a})}static async getVideoFrameAsDataUrl(a,b=0){let c=cf(),d=!1,e=()=>{if(!d)if(!(a.readyState>=a.HAVE_METADATA))return;else d=!0,a.currentTime=b;if(a.readyState>=a.HAVE_CURRENT_DATA){let b=document.createElement("canvas");b.width=a.videoWidth,b.height=a.videoHeight;let d=b.getContext("2d");if(!d)throw Error("Could not get 2d context");d.drawImage(a,0,0),c.resolve(b.toDataURL())}},f=a=>{console.error(a),c.reject(Error("Could not get video frame"))};a.addEventListener("loadedmetadata",e),a.addEventListener("loadeddata",e),a.addEventListener("canplay",e),a.addEventListener("seeked",e),a.addEventListener("error",f),a.addEventListener("stalled",f),e();try{return await c}finally{a.removeEventListener("loadedmetadata",e),a.removeEventListener("loadeddata",e),a.removeEventListener("canplay",e),a.removeEventListener("seeked",e),a.removeEventListener("error",f),a.removeEventListener("stalled",f)}}static getImageAndDimensions(a){return new Promise((b,c)=>{let d=cn();d.onload=()=>{let a;d.naturalWidth?a={w:d.naturalWidth,h:d.naturalHeight}:(document.body.appendChild(d),a={w:d.clientWidth,h:d.clientHeight},document.body.removeChild(d)),b({...a,image:d})},d.onerror=a=>{console.error(a),c(Error("Could not load image"))},d.crossOrigin="anonymous",d.referrerPolicy="strict-origin-when-cross-origin",d.style.visibility="hidden",d.style.position="absolute",d.style.opacity="0",d.style.zIndex="-9999",d.src=a})}static async getVideoSize(a){return cB.usingObjectURL(a,async a=>{let b=await cB.loadVideo(a);return{w:b.videoWidth,h:b.videoHeight}})}static async getImageSize(a){let{w:b,h:c}=await cB.usingObjectURL(a,cB.getImageAndDimensions);try{if("image/png"===a.type){let d=new DataView(await a.arrayBuffer());if(cv.isPng(d,0)){let a=cv.findChunk(d,"pHYs");if(a){let e=cv.parsePhys(d,a.dataOffset);if(1===e.unit&&e.ppux===e.ppuy){let a=Math.max(e.ppux/(72/.0254),1);return{w:Math.round(b/a),h:Math.round(c/a)}}}}}}catch(a){console.error(a)}return{w:b,h:c}}static async isAnimated(a){if("image/gif"===a.type)return function(a){let b,c,d=new Uint8Array(a),e=0,f=0;if("GIF"!==new TextDecoder("ascii").decode(a.slice(0,3)))return!1;for(b=128&d[10],c=7&d[10],e+=6,e+=7,e+=b?3*Math.pow(2,c+1):0;f<2&&e<d.length;)switch(d[e]){case 44:f+=1,b=128&d[e+9],c=7&d[e+9],e+=10,e+=b?3*Math.pow(2,c+1):0,e+=ct(d,e+1)+1;break;case 33:e+=2,e+=ct(d,e);break;default:e=d.length}return f>1}(await a.arrayBuffer());if("image/avif"===a.type)return 44===new Uint8Array(await a.arrayBuffer())[3];if("image/webp"===a.type){let b;return b=new Uint8Array(await a.arrayBuffer()),!(b.length<12)&&87===b[8]&&69===b[9]&&66===b[10]&&80===b[11]&&!!b&&!(b.length<21)&&(b[20]>>1&1)==1}return"image/apng"===a.type&&function(a){let b=new Uint8Array(a);if(!b||!("u">typeof Buffer&&Buffer.isBuffer(b)||b instanceof Uint8Array)||b.length<16||137!==b[0]||80!==b[1]||78!==b[2]||71!==b[3]||13!==b[4]||10!==b[5]||26!==b[6]||10!==b[7])return!1;function c(a,b,d,e,f=1024){if(!b)return -1;let g=(b=RegExp(b,"g")).source.length,h=new TextDecoder,i=a.length;if(void 0===e&&(e=i),d>=i||e<=0||d>=e)return -1;a=a.subarray(d,e);let j=-1,k=0,l=0,m="";a:for(;k<a.length;){let c,d=k+f,e=a.subarray(k,d),i=h.decode(e,{stream:!0}),n=m+i,o=-1;for(;null!==(c=b.exec(n));){j=l+(o=c.index-m.length);break a}k=d,l+=i.length;let p=o>-1?o+g:i.length-g;m=i.slice(p)}return j>=0&&(j+=d>=0?d:i+d),j}let d=c(b,"IDAT",12);return d>=12&&c(b,"acTL",8,d)>=8}(await a.arrayBuffer())}static isAnimatedImageType(a){return cy.includes(a||"")}static isStaticImageType(a){return cx.includes(a||"")}static isVectorImageType(a){return cw.includes(a||"")}static isImageType(a){return cz.includes(a||"")}static async usingObjectURL(a,b){let c=URL.createObjectURL(a);try{return await b(c)}finally{URL.revokeObjectURL(c)}}}function cC(a=""){let b=0,c=0,d=0,e=0;function f(){let a=b^b<<11;return b=c,c=d,d=e,(e^=(e>>>19^a^a>>>8)>>>0)/0x100000000*2}for(let c=0;c<a.length+64;c++)b^=a.charCodeAt(c),f();return f}function cD(a,b,c,d=!1){let[e,f]=b,[g,h]=c,i=g+(a-e)/(f-e)*(h-g);return d?g<h?Math.max(Math.min(i,h),g):Math.max(Math.min(i,g),h):i}function cE(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function cF(a,b){if(cE(a,b))return a[b]}function cG(a){return Object.keys(a)}function cH(a){return Object.values(a)}function cI(a){return Object.entries(a)}function cJ(a){return Object.fromEntries(a)}function cK(a,b){let c={},d=!1;for(let e in a){if(!Object.prototype.hasOwnProperty.call(a,e))continue;let f=a[e];b(e,f)?c[e]=f:d=!0}return d?c:a}function cL(a,b){let c={};for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=b(d,a[d]));return c}function cM(a,b){if(a===b)return!0;let c=Object.keys(a);if(c.length!==Object.keys(b).length)return!1;for(let d of c)if(!cE(b,d)||!Object.is(a[d],b[d]))return!1;return!0}let cN="#40C057",cO="#FFC078";class cP{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(a){this.name=a,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);let a=(performance.now()-this.startTime)/1e3,b=0===a?0:Math.floor(this.frames/a),c=b>55?cN:b>30?cO:"#E03131",d=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${d} %c${b}%c fps`,`color: white; background: ${cN};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${c};color: ${c===cO?"black":"white"};`,"font-weight: normal")}isStarted(){return this.started}}let cQ="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function cR(a,b,c){let d=c[0];if(null!=b&&a>=b)throw Error(a+" >= "+b);if(a.slice(-1)===d||b&&b.slice(-1)===d)throw Error("trailing zero");if(b){let e=0;for(;(a[e]||d)===b[e];)e++;if(e>0)return b.slice(0,e)+cR(a.slice(e),b.slice(e),c)}let e=a?c.indexOf(a[0]):0,f=null!=b?c.indexOf(b[0]):c.length;return f-e>1?c[Math.round(.5*(e+f))]:b&&b.length>1?b.slice(0,1):c[e]+cR(a.slice(1),null,c)}function cS(a){if(a.length!==cT(a[0]))throw Error("invalid integer part of order key: "+a)}function cT(a){if(a>="a"&&a<="z")return a.charCodeAt(0)-97+2;if(a>="A"&&a<="Z")return 90-a.charCodeAt(0)+2;throw Error("invalid order key head: "+a)}function cU(a){let b=cT(a[0]);if(b>a.length)throw Error("invalid order key: "+a);return a.slice(0,b)}function cV(a,b){if(a==="A"+b[0].repeat(26))throw Error("invalid order key: "+a);let c=cU(a);if(a.slice(c.length).slice(-1)===b[0])throw Error("invalid order key: "+a)}function cW(a,b){cS(a);let[c,...d]=a.split(""),e=!0;for(let a=d.length-1;e&&a>=0;a--){let c=b.indexOf(d[a])+1;c===b.length?d[a]=b[0]:(d[a]=b[c],e=!1)}if(!e)return c+d.join("");{if("Z"===c)return"a"+b[0];if("z"===c)return null;let a=String.fromCharCode(c.charCodeAt(0)+1);return a>"a"?d.push(b[0]):d.pop(),a+d.join("")}}function cX(a,b,c=cQ){if(null!=a&&cV(a,c),null!=b&&cV(b,c),null!=a&&null!=b&&a>=b)throw Error(a+" >= "+b);if(null==a){if(null==b)return"a"+c[0];let a=cU(b),d=b.slice(a.length);if(a==="A"+c[0].repeat(26))return a+cR("",d,c);if(a<b)return a;let e=function(a,b){cS(a);let[c,...d]=a.split(""),e=!0;for(let a=d.length-1;e&&a>=0;a--){let c=b.indexOf(d[a])-1;-1===c?d[a]=b.slice(-1):(d[a]=b[c],e=!1)}if(!e)return c+d.join("");{if("a"===c)return"Z"+b.slice(-1);if("A"===c)return null;let a=String.fromCharCode(c.charCodeAt(0)-1);return a<"Z"?d.push(b.slice(-1)):d.pop(),a+d.join("")}}(a,c);if(null==e)throw Error("cannot decrement any more");return e}if(null==b){let b=cU(a),d=a.slice(b.length),e=cW(b,c);return null==e?b+cR(d,null,c):e}let d=cU(a),e=a.slice(d.length),f=cU(b),g=b.slice(f.length);if(d===f)return d+cR(e,g,c);let h=cW(d,c);if(null==h)throw Error("cannot increment any more");return h<b?h:d+cR(e,null,c)}function cY(a,b,c,d=cQ){if(0===c)return[];if(1===c)return[cX(a,b,d)];if(null==b){let e=cX(a,b,d),f=[e];for(let a=0;a<c-1;a++)f.push(e=cX(e,b,d));return f}if(null==a){let e=cX(a,b,d),f=[e];for(let b=0;b<c-1;b++)f.push(e=cX(a,e,d));return f.reverse(),f}let e=Math.floor(c/2),f=cX(a,b,d);return[...cY(a,f,e,d),f,...cY(f,b,c-e-1,d)]}let cZ=()=>.5>Math.random();function c$(a,b){if(!Number.isInteger(b))throw Error(`"${a}" must be an integer, got '${b}'`);if(b<0)throw Error(`"${a}" must be greater than or equal to 0, got '${b}'`)}function c_(a,b,c){let{digits:d,jitterBits:e=30,getRandomBit:f=cZ}=c??{};c$("jitterBits",e);let g=e,h=a,i=b,j=cX(a,b,d);for(;g>0;)1==+!!f()?h=j:i=j,j=cX(h,i,d),g--;return j}let c0=function(a,b,c,d){let{digits:e,jitterBits:f}=d??{};if(c$("n",c),0===c)return[];if(0===f)return cY(a,b,c,e);let g=cY(a,b,c+1,e),h=[];for(let a=0;a<c;a++){let b=g[a],c=g[a+1];h.push(c_(b,c,d))}return h};function c1(a,b,c){return c0(a??null,b??null,c)}function c2(a,b){return c0(a??null,null,b)}function c3(a,b){return c0(a??null,b??null,1)[0]}function c4(a=null){return c0(a,null,1)[0]}function c5(a,b="a1"){return[b,...c0(b,null,a)]}function c6(a,b){return a.index<b.index?-1:+(a.index>b.index)}function c7(a,b){return a.id>b.id?1:-1}function c8(a){try{return localStorage.getItem(a)}catch{return null}}function c9(a,b){try{localStorage.setItem(a,b)}catch{}}function da(a){try{return sessionStorage.getItem(a)}catch{return null}}function db(a,b){try{sessionStorage.setItem(a,b)}catch{}}let dc=()=>"u">typeof process&&!1,dd=a=>.9*Math.floor(1e3/a),de=new class{targetFps;targetTimePerFrame;fpsQueue=[];frameRaf;flushRaf;lastFlushTime;constructor(a=120){this.targetFps=a,this.targetTimePerFrame=dd(a),this.lastFlushTime=-this.targetTimePerFrame}updateTargetFps(a){a!==this.targetFps&&(this.targetFps=a,this.targetTimePerFrame=dd(a),this.lastFlushTime=-this.targetTimePerFrame)}flush(){for(let a of this.fpsQueue.splice(0,this.fpsQueue.length))a()}tick(a=!1){if(this.frameRaf)return;let b=Date.now();if(b-this.lastFlushTime<this.targetTimePerFrame){this.frameRaf=requestAnimationFrame(()=>{this.frameRaf=void 0,this.tick(!0)});return}if(a){if(this.flushRaf)return;this.lastFlushTime=b,this.flush()}else{if(this.flushRaf)return;this.flushRaf=requestAnimationFrame(()=>{this.flushRaf=void 0,this.lastFlushTime=Date.now(),this.flush()})}}fpsThrottle(a){dc();let b=()=>{this.fpsQueue.includes(a)||(this.fpsQueue.push(a),this.tick())};return b.cancel=()=>{let b=this.fpsQueue.indexOf(a);b>-1&&this.fpsQueue.splice(b,1)},b}throttleToNextFrame(a){return dc(),this.fpsQueue.includes(a)||(this.fpsQueue.push(a),this.tick()),()=>{let b=this.fpsQueue.indexOf(a);b>-1&&this.fpsQueue.splice(b,1)}}}(120);function df(a){return de.throttleToNextFrame(a)}class dg{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(a,b,c,...d){let e=window.setTimeout(b,c,d),f=this.timeouts.get(a)??[];return this.timeouts.set(a,[...f,e]),e}setInterval(a,b,c,...d){let e=window.setInterval(b,c,d),f=this.intervals.get(a)??[];return this.intervals.set(a,[...f,e]),e}requestAnimationFrame(a,b){let c=window.requestAnimationFrame(b),d=this.rafs.get(a)??[];return this.rafs.set(a,[...d,c]),c}dispose(a){this.timeouts.get(a)?.forEach(a=>clearTimeout(a)),this.intervals.get(a)?.forEach(a=>clearInterval(a)),this.rafs.get(a)?.forEach(a=>cancelAnimationFrame(a)),this.timeouts.delete(a),this.intervals.delete(a),this.rafs.delete(a)}disposeAll(){for(let a of this.timeouts.keys())this.dispose(a)}forContext(a){return{setTimeout:(b,c,...d)=>this.setTimeout(a,b,c,d),setInterval:(b,c,...d)=>this.setInterval(a,b,c,d),requestAnimationFrame:b=>this.requestAnimationFrame(a,b),dispose:()=>this.dispose(a)}}}let dh=(a,b)=>{try{return new URL(a,b)}catch{return}};function di(a){return void 0!==a}let dj="u">typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:a.g.structuredClone?[a.g.structuredClone,!0]:[a=>a?JSON.parse(JSON.stringify(a)):a,!1],dk=dj[0];dj[1];let dl=Object.getPrototypeOf(dk({})),dm=new Set;function dn(a){return a&&"object"==typeof a&&"parents"in a}function dp(a){for(let b=0,c=a.parents.length;b<c;b++)if(a.parents[b].__unsafe__getWithoutCapture(!0),a.parents[b].lastChangedEpoch!==a.parentEpochs[b])return!0;return!1}function dq(a,b){if(a.children.remove(b)&&a.children.isEmpty&&dn(a))for(let b=0,c=a.parents.length;b<c;b++)dq(a.parents[b],a)}function dr(a,b){if(a.children.add(b)&&dn(a))for(let b=0,c=a.parents.length;b<c;b++)dr(a.parents[b],a)}function ds(a,b){return a===b||Object.is(a,b)||!!(a&&b&&"function"==typeof a.equals&&a.equals(b))}function dt(a,b){let c=Symbol.for(`com.tldraw.state/${a}`),d=globalThis;return d[c]??=b(),d[c]}bV("@tldraw/utils","4.4.0","esm"),a.s([],65820);let du=dt("empty_array",()=>Object.freeze([]));class dv{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(a){if(this.array)return -1===this.array.indexOf(a)&&(this.arraySize<8?(this.array[this.arraySize]=a,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(a)),!0);if(this.set)return!this.set.has(a)&&(this.set.add(a),!0);throw Error("no set or array")}remove(a){if(this.array){let b=this.array.indexOf(a);return -1!==b&&(this.array[b]=void 0,this.arraySize--,b!==this.arraySize&&(this.array[b]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(a)&&(this.set.delete(a),!0);throw Error("no set or array")}visit(a){if(this.array){for(let b=0;b<this.arraySize;b++){let c=this.array[b];void 0!==c&&a(c)}return}if(this.set)return void this.set.forEach(a);throw Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let a=0;a<this.arraySize;a++){let b=this.array[a];void 0!==b&&(yield b)}else if(this.set)yield*this.set;else throw Error("no set or array")}has(a){return this.array?-1!==this.array.indexOf(a):this.set.has(a)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}let dw=Symbol.for("com.tldraw.state/RESET_VALUE");class dx{constructor(a){this.capacity=a,this.buffer=Array(a)}index=0;buffer;pushEntry(a,b,c){if(void 0!==c){if(c===dw)return void this.clear();this.buffer[this.index]=[a,b,c],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(a){let{index:b,capacity:c,buffer:d}=this;for(let e=0;e<c;e++){let f=(b-1+c-e)%c,g=d[f];if(!g)break;let[h,i]=g;if(0===e&&a>=i)return[];if(h<=a&&a<i){let a=e+1,b=Array(a);for(let e=0;e<a;e++)b[e]=d[(f+e)%c][2];return b}}return dw}}class dy{constructor(a,b,c){this.name=a,this.runEffect=b,this._scheduleEffect=c?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new dv;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==dD()){if(this.parents.length&&!dp(this)){this.lastReactedEpoch=dD();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let a=0,b=this.parents.length;a<b;a++)dr(this.parents[a],this)}detach(){this._isActivelyListening=!1;for(let a=0,b=this.parents.length;a<b;a++)dq(this.parents[a],this)}execute(){try{dV(this);let a=dD(),b=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=a,b}finally{dW()}}}let dz=dt("EffectScheduler",()=>dy);function dA(a,b,c){let d=new dz(a,b,c);return d.attach(),d.scheduleEffect(),()=>{d.detach()}}class dB{constructor(a,b){this.parent=a,this.isSync=b}asyncProcessCount=0;initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(dC.globalIsReacting)for(let a of this.initialAtomValues.keys())dG(a);else this.isRoot?dF(this.initialAtomValues.keys()):this.initialAtomValues.forEach((a,b)=>{this.parent.initialAtomValues.has(b)||this.parent.initialAtomValues.set(b,a)})}abort(){dC.globalEpoch++,this.initialAtomValues.forEach((a,b)=>{b.set(a),b.historyBuffer?.clear()}),this.commit()}}let dC=dt("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0}));function dD(){return dC.globalEpoch}function dE(a,b){d=a,function a(b){b.lastTraversedEpoch!==dC.globalEpoch&&(b.lastTraversedEpoch=dC.globalEpoch,b instanceof dz?d.add(b):b.children.visit(a))}(b)}function dF(a){if(dC.globalIsReacting)throw Error("flushChanges cannot be called during a reaction");let b=dC.currentTransaction;try{dC.currentTransaction=null,dC.globalIsReacting=!0,dC.reactionEpoch=dC.globalEpoch;let b=new Set;for(let c of a)c.children.visit(a=>dE(b,a));for(let a of b)a.maybeScheduleEffect();let c=0;for(;dC.cleanupReactors?.size;){if(c++>1e3)throw Error("Reaction update depth limit exceeded");let a=dC.cleanupReactors;for(let b of(dC.cleanupReactors=null,a))b.maybeScheduleEffect()}}finally{dC.cleanupReactors=null,dC.globalIsReacting=!1,dC.currentTransaction=b,d=void 0}}function dG(a){let b=dC.cleanupReactors??=new Set;a.children.visit(a=>dE(b,a))}function dH(a){if(dC.currentTransaction)return a();let b=new dB(dC.currentTransaction,!0);dC.currentTransaction=b;try{let c,d=!1;try{c=a(()=>d=!0)}catch(a){throw b.abort(),a}if(dC.currentTransaction!==b)throw Error("Transaction boundaries overlap");return d?b.abort():b.commit(),c}finally{dC.currentTransaction=b.parent}}let dI=!1,dJ=Symbol.for("com.tldraw.state/UNINITIALIZED"),dK=dt("WithDiff",()=>class{constructor(a,b){this.value=a,this.diff=b}});function dL(a,b){return new dK(a,b)}class dM{constructor(a,b,c){this.name=a,this.derive=b,c?.historyLength&&(this.historyBuffer=new dx(c.historyLength)),this.computeDiff=c?.computeDiff,this.isEqual=c?.isEqual??ds}lastChangedEpoch=-1;lastTraversedEpoch=-1;__debug_ancestor_epochs__=null;lastCheckedEpoch=-1;parentSet=new dv;parents=[];parentEpochs=[];children=new dv;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=dJ;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(a){let b=-1===this.lastChangedEpoch,c=dD();if(!b&&(this.lastCheckedEpoch===c||this.isActivelyListening&&dC.globalIsReacting&&this.lastTraversedEpoch<dC.reactionEpoch||!dp(this))){if(this.lastCheckedEpoch=c,!this.error)return this.state;if(a)return this.state;throw this.error.thrownValue}try{dV(this);let a=this.derive(this.state,this.lastCheckedEpoch),b=a instanceof dK?a.value:a,c=this.state===dJ;if(c||!this.isEqual(b,this.state)){if(this.historyBuffer&&!c){let c=a instanceof dK?a.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,dD(),c??this.computeDiff?.(this.state,b,this.lastCheckedEpoch,dD())??dw)}this.lastChangedEpoch=dD(),this.state=b}return this.error=null,this.lastCheckedEpoch=dD(),this.state}catch(b){if(this.state!==dJ&&(this.state=dJ,this.lastChangedEpoch=dD()),this.lastCheckedEpoch=dD(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:b},!a)throw b;return this.state}finally{dW()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{dX(this)}}getDiffSince(a){return(this.__unsafe__getWithoutCapture(!0),dX(this),a>=this.lastChangedEpoch)?du:this.historyBuffer?.getChangesSince(a)??dw}}let dN=dt("Computed",()=>dM);function dO(a={},b){if(2===b.length){let c,d,[e,f]=b;return cd("method"===f.kind,"@computed can only be used on methods"),c=Symbol.for("__@tldraw/state__computed__"+String(f.name)),(d=function(){let b=this[c];return b||Object.defineProperty(this,c,{enumerable:!1,configurable:!1,writable:!1,value:b=new dN(String(f.name),e.bind(this),a)}),b.get()})[dP]=!0,d}{let[c,d,e]=b;return e.get?(dI||(dI=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(a={},b,c,d){let e=d.get,f=Symbol.for("__@tldraw/state__computed__"+c);return d.get=function(){let b=this[f];return b||Object.defineProperty(this,f,{enumerable:!1,configurable:!1,writable:!1,value:b=new dN(c,e.bind(this),a)}),b.get()},d}(a,0,d,e)):function(a={},b,c,d){let e=d.value,f=Symbol.for("__@tldraw/state__computed__"+c);return d.value=function(){let b=this[f];return b||Object.defineProperty(this,f,{enumerable:!1,configurable:!1,writable:!1,value:b=new dN(c,e.bind(this),a)}),b.get()},d.value[dP]=!0,d}(a,0,d,e)}}let dP="@@__isComputedMethod__@@";function dQ(){if(1==arguments.length){let a=arguments[0];return(...b)=>dO(a,b)}return"string"==typeof arguments[0]?new dN(arguments[0],arguments[1],arguments[2]):dO(void 0,arguments)}function dR(a){return!!(a&&a instanceof dN)}class dS{constructor(a,b){this.below=a,this.child=b}offset=0;maybeRemoved}let dT=dt("capture",()=>({stack:null}));function dU(a){let b=dT.stack;dT.stack=null;try{return a()}finally{dT.stack=b}}function dV(a){if(dT.stack=new dS(dT.stack,a),a.__debug_ancestor_epochs__){let b=a.__debug_ancestor_epochs__;for(let b of(a.__debug_ancestor_epochs__=null,a.parents))b.__unsafe__getWithoutCapture(!0);!function(a,b){let c=function a(b,c){let d={};for(let e=0;e<b.parents.length;e++){let f=b.parents[e];if(!c.has(f))continue;let g=c.get(f);f.lastChangedEpoch!==g&&(dR(f)?d[f.name]=a(f,c):d[f.name]=null)}return d}(a,b);if(0===Object.keys(c).length)return console.log(`Effect(${a.name}) was executed manually.`);let d=dR(a)?`Computed(${a.name}) is recomputing because:`:`Effect(${a.name}) is executing because:`;!function a(b,c){let e="\n"+" ".repeat(c)+"↳ ";for(let[f,g]of Object.entries(b))g?(d+=`${e}Computed(${f}) changed`,a(g,c+2)):d+=`${e}Atom(${f}) changed`}(c,1),console.log(d)}(a,b)}a.parentSet.clear()}function dW(){let a=dT.stack;if(dT.stack=a.below,a.offset<a.child.parents.length){for(let b=a.offset;b<a.child.parents.length;b++){let c=a.child.parents[b];a.child.parentSet.has(c)||dq(c,a.child)}a.child.parents.length=a.offset,a.child.parentEpochs.length=a.offset}if(a.maybeRemoved)for(let b=0;b<a.maybeRemoved.length;b++){let c=a.maybeRemoved[b];a.child.parentSet.has(c)||dq(c,a.child)}a.child.__debug_ancestor_epochs__&&function a(b,c){for(let d=0;d<b.parents.length;d++){let e=b.parents[d],f=b.parentEpochs[d];c.set(e,f),dR(e)&&a(e,c)}return c}(a.child,a.child.__debug_ancestor_epochs__)}function dX(a){if(dT.stack&&!dT.stack.child.parentSet.has(a)){if(dT.stack.child.parentSet.add(a),dT.stack.child.isActivelyListening&&dr(a,dT.stack.child),dT.stack.offset<dT.stack.child.parents.length){let b=dT.stack.child.parents[dT.stack.offset];b!==a&&(dT.stack.maybeRemoved?dT.stack.maybeRemoved.push(b):dT.stack.maybeRemoved=[b])}dT.stack.child.parents[dT.stack.offset]=a,dT.stack.child.parentEpochs[dT.stack.offset]=a.lastChangedEpoch,dT.stack.offset++}}class dY{constructor(a,b,c){if(this.name=a,this.current=b,this.isEqual=c?.isEqual??null,!c)return;c.historyLength&&(this.historyBuffer=new dx(c.historyLength)),this.computeDiff=c.computeDiff}isEqual;computeDiff;lastChangedEpoch=dD();children=new dv;historyBuffer;__unsafe__getWithoutCapture(a){return this.current}get(){return dX(this),this.current}set(a,b){if(this.isEqual?.(this.current,a)??ds(this.current,a))return this.current;dC.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,dD(),b??this.computeDiff?.(this.current,a,this.lastChangedEpoch,dD())??dw),this.lastChangedEpoch=dD();let c=this.current;return this.current=a,dC.currentTransaction?dC.currentTransaction.initialAtomValues.has(this)||dC.currentTransaction.initialAtomValues.set(this,c):dC.globalIsReacting?dG(this):dF([this]),a}update(a){return this.set(a(this.current))}getDiffSince(a){return(dX(this),a>=this.lastChangedEpoch)?du:this.historyBuffer?.getChangesSince(a)??dw}}let dZ=dt("Atom",()=>dY);function d$(a,b,c){return new dZ(a,b,c)}if(1!==dt("apiVersion",()=>1))throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function d_(a,b,c=[]){let d=bT.default.useRef(b);d.current=b;let[e,f,g]=bT.default.useMemo(()=>{let b=null,c=new dz(`useStateTracking(${a})`,()=>d.current?.(),{scheduleEffect(){b?.()}});return[c,a=>(b=a,()=>{b=null}),()=>c.scheduleCount]},[a,...c]);return bT.default.useSyncExternalStore(f,g,g),bT.default.useEffect(()=>(e.attach(),e.maybeScheduleEffect(),()=>{e.detach()}),[e]),e.execute()}bV("@tldraw/state","4.4.0","esm"),a.s([],794534);let d0={apply:(a,b,c)=>d_(a.displayName??a.name??"tracked(???)",()=>a.apply(b,c))},d1=Symbol.for("react.memo"),d2=Symbol.for("react.forward_ref");function d3(a){let b=null,c=a.$$typeof;return(c===d1&&(b=(a=a.type).compare),c===d2)?(0,bT.memo)((0,bT.forwardRef)(new Proxy(a.render,d0))):(0,bT.memo)(new Proxy(a,d0),b)}function d4(a,b,c){return(0,bT.useState)(()=>d$(`useAtom(${a})`,"function"==typeof b?b():b,c))[0]}function d5(){let a=arguments[0],b=arguments[1],c=3==arguments.length?void 0:arguments[2],d=3==arguments.length?arguments[2]:arguments[3];return(0,bT.useMemo)(()=>dQ(`useComputed(${a})`,b,c),d)}function d6(a,b,c=du){(0,bT.useEffect)(()=>{let c=new dz(a,b);return c.attach(),c.execute(),()=>{c.detach()}},c)}function d7(a,b,c=[]){(0,bT.useEffect)(()=>{let c,d=new dz(a,b,{scheduleEffect:a=>{c=df(a)}});return d.attach(),d.execute(),()=>{d.detach(),c?.()}},c)}function d8(){let a=arguments,b=3===a.length?a[2]:[a[0]],c=3===a.length?a[0]:`useValue(${a[0].name})`,{$val:d,subscribe:e,getSnapshot:f}=(0,bT.useMemo)(()=>{let b=1===a.length?a[0]:dQ(c,a[1]);return{$val:b,subscribe:a=>dA(`useValue(${c})`,()=>{try{b.get()}catch{}a()}),getSnapshot:()=>b.lastChangedEpoch}},b);return(0,bT.useSyncExternalStore)(e,f,f),d.__unsafe__getWithoutCapture()}function d9(a){return a>>>1&0x40000000|0xbfffffff&a}bV("@tldraw/state-react","4.4.0","esm"),a.s([],227096);let ea=Object.prototype.valueOf;function eb(a){if(null==a)return ec(a);if("function"==typeof a.hashCode)return d9(a.hashCode(a));let b=(c=a).valueOf!==ea&&"function"==typeof c.valueOf?c.valueOf(c):c;if(null==b)return ec(b);switch(typeof b){case"boolean":return b?0x42108421:0x42108420;case"number":var c,d,e,f,g=b;if(g!=g||g===1/0)return 0;let h=0|g;for(h!==g&&(h^=0xffffffff*g);g>0xffffffff;)g/=0xffffffff,h^=g;return d9(h);case"string":let i;return void 0===(i=ei[d=b])&&(i=ed(d),ej===ek&&(ej=0,ei={}),ei[d]=i,ej++),i;case"object":case"function":let j;return e=b,void 0!==(j=ef.get(e))||(j=ee(),ef.set(e,j)),j;case"symbol":let k;return void 0!==(k=eg[f=b])||(k=ee(),eg[f]=k),k;default:if("function"==typeof b.toString)return ed(b.toString());throw Error("Value type "+typeof b+" cannot be hashed.")}}function ec(a){return null===a?0x42108422:0x42108423}function ed(a){let b=0;for(let c=0;c<a.length;c++)b=31*b+a.charCodeAt(c)|0;return d9(b)}function ee(){let a=++eh;return 0x40000000&eh&&(eh=0),a}let ef=new WeakMap,eg=Object.create(null),eh=0,ei={},ej=0,ek=24e3,el={};function em(){return{value:!1}}function en(a){a&&(a.value=!0)}function eo(a,b=0){return a.slice(b)}class ep{}class eq{_root;size;__ownerID;__hash;__altered;constructor(a){return null==a?eD():a instanceof eq?a:eD().withMutations(b=>{for(let[c,d]of a)b.set(c,d)})}get(a,b){return this._root?this._root.get(0,void 0,a,b):b}set(a,b){return eE(this,a,b)}delete(a){return eE(this,a,el)}deleteAll(a){return this.withMutations(b=>{for(let c of a)b.delete(c)})}__ensureOwner(a){return a===this.__ownerID?this:a?eC(this.size,this._root,a,this.__hash):0===this.size?eD():(this.__ownerID=a,this.__altered=!1,this)}withMutations(a){let b=this.asMutable();return a(b),b.wasAltered()?b.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new ep)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new ew(this,eB,!1)}keys(){return new ew(this,ez,!1)}values(){return new ew(this,eA,!1)}}class er{constructor(a,b){this.ownerID=a,this.entries=b}get(a,b,c,d){let e=this.entries;for(let a=0,b=e.length;a<b;a++)if(Object.is(c,e[a][0]))return e[a][1];return d}update(a,b,c,d,e,f,g){let h=e===el,i=this.entries,j=0,k=i.length;for(;j<k&&!Object.is(d,i[j][0]);j++);let l=j<k;if(l?i[j][1]===e:h)return this;if(en(g),(h||!l)&&en(f),h&&1===i.length)return;if(!l&&!h&&i.length>=eK){var m=a,n=i,o=d,p=e;m||(m=new ep);let b=new ev(m,eb(o),[o,p]);for(let a=0;a<n.length;a++){let c=n[a];b=b.update(m,0,void 0,c[0],c[1])}return b}let q=a&&a===this.ownerID,r=q?i:eo(i);return(l?h?j===k-1?r.pop():r[j]=r.pop():r[j]=[d,e]:r.push([d,e]),q)?(this.entries=r,this):new er(a,r)}}class es{constructor(a,b,c){this.ownerID=a,this.bitmap=b,this.nodes=c}get(a,b,c,d){void 0===b&&(b=eb(c));let e=1<<((0===a?b:b>>>a)&31),f=this.bitmap;return(f&e)==0?d:this.nodes[eI(f&e-1)].get(a+5,b,c,d)}update(a,b,c,d,e,f,g){void 0===c&&(c=eb(d));let h=(0===b?c:c>>>b)&31,i=1<<h,j=this.bitmap,k=(j&i)!=0;if(!k&&e===el)return this;let l=eI(j&i-1),m=this.nodes,n=k?m[l]:void 0,o=eF(n,a,b+5,c,d,e,f,g);if(o===n)return this;if(!k&&o&&m.length>=eL){var p=a,q=m,r=j,s=h,t=o;let b=0,c=Array(32);for(let a=0;0!==r;a++,r>>>=1)c[a]=1&r?q[b++]:void 0;return c[s]=t,new et(p,b+1,c)}if(k&&!o&&2===m.length&&eG(m[1^l]))return m[1^l];if(k&&o&&1===m.length&&eG(o))return o;let u=a&&a===this.ownerID,v=k?o?j:j^i:j|i,w=k?o?eJ(m,l,o,u):function(a,b,c){let d=a.length-1;if(c&&b===d)return a.pop(),a;let e=Array(d),f=0;for(let c=0;c<d;c++)c===b&&(f=1),e[c]=a[c+f];return e}(m,l,u):function(a,b,c,d){let e=a.length+1;if(d&&b+1===e)return a[b]=c,a;let f=Array(e),g=0;for(let d=0;d<e;d++)d===b?(f[d]=c,g=-1):f[d]=a[d+g];return f}(m,l,o,u);return u?(this.bitmap=v,this.nodes=w,this):new es(a,v,w)}}class et{constructor(a,b,c){this.ownerID=a,this.count=b,this.nodes=c}get(a,b,c,d){void 0===b&&(b=eb(c));let e=(0===a?b:b>>>a)&31,f=this.nodes[e];return f?f.get(a+5,b,c,d):d}update(a,b,c,d,e,f,g){void 0===c&&(c=eb(d));let h=(0===b?c:c>>>b)&31,i=e===el,j=this.nodes,k=j[h];if(i&&!k)return this;let l=eF(k,a,b+5,c,d,e,f,g);if(l===k)return this;let m=this.count;if(k){if(!l&&--m<eM)return function(a,b,c,d){let e=0,f=0,g=Array(c);for(let a=0,c=1,h=b.length;a<h;a++,c<<=1){let h=b[a];void 0!==h&&a!==d&&(e|=c,g[f++]=h)}return new es(a,e,g)}(a,j,m,h)}else m++;let n=a&&a===this.ownerID,o=eJ(j,h,l,n);return n?(this.count=m,this.nodes=o,this):new et(a,m,o)}}class eu{constructor(a,b,c){this.ownerID=a,this.keyHash=b,this.entries=c}get(a,b,c,d){let e=this.entries;for(let a=0,b=e.length;a<b;a++)if(Object.is(c,e[a][0]))return e[a][1];return d}update(a,b,c,d,e,f,g){void 0===c&&(c=eb(d));let h=e===el;if(c!==this.keyHash)return h?this:(en(g),en(f),eH(this,a,b,c,[d,e]));let i=this.entries,j=0,k=i.length;for(;j<k&&!Object.is(d,i[j][0]);j++);let l=j<k;if(l?i[j][1]===e:h)return this;if(en(g),(h||!l)&&en(f),h&&2===k)return new ev(a,this.keyHash,i[1^j]);let m=a&&a===this.ownerID,n=m?i:eo(i);return(l?h?j===k-1?n.pop():n[j]=n.pop():n[j]=[d,e]:n.push([d,e]),m)?(this.entries=n,this):new eu(a,this.keyHash,n)}}class ev{constructor(a,b,c){this.ownerID=a,this.keyHash=b,this.entry=c}get(a,b,c,d){return Object.is(c,this.entry[0])?this.entry[1]:d}update(a,b,c,d,e,f,g){let h=e===el,i=Object.is(d,this.entry[0]);return(i?e===this.entry[1]:h)?this:(en(g),h)?void en(f):i?a&&a===this.ownerID?(this.entry[1]=e,this):new ev(a,this.keyHash,[d,e]):(en(f),eH(this,a,b,eb(d),[d,e]))}}class ew{constructor(a,b,c){this._type=b,this._reverse=c,this._stack=a._root&&ey(a._root)}_stack;[Symbol.iterator](){return this}next(){let a=this._type,b=this._stack;for(;b;){let c,d=b.node,e=b.index++;if(d.entry){if(0===e)return ex(a,d.entry)}else if("entries"in d&&d.entries){if(e<=(c=d.entries.length-1))return ex(a,d.entries[this._reverse?c-e:e])}else if(e<=(c=d.nodes.length-1)){let f=d.nodes[this._reverse?c-e:e];if(f){if(f.entry)return ex(a,f.entry);b=this._stack=ey(f,b)}continue}b=this._stack=this._stack.__prev}return{value:void 0,done:!0}}}function ex(a,b){var c,d,e,f;let g;return c=a,d=b[0],e=b[1],g=c===ez?d:c===eA?e:[d,e],f?f.value=g:f={value:g,done:!1},f}function ey(a,b){return{node:a,index:0,__prev:b}}let ez=0,eA=1,eB=2;function eC(a,b,c,d){let e=Object.create(eq.prototype);return e.size=a,e._root=b,e.__ownerID=c,e.__hash=d,e.__altered=!1,e}function eD(){return e||(e=eC(0))}function eE(a,b,c){let d,e;if(a._root){let f=em(),g=em();if(d=eF(a._root,a.__ownerID,0,void 0,b,c,f,g),!g.value)return a;e=a.size+(f.value?c===el?-1:1:0)}else{if(c===el)return a;e=1,d=new er(a.__ownerID,[[b,c]])}return a.__ownerID?(a.size=e,a._root=d,a.__hash=void 0,a.__altered=!0,a):d?eC(e,d):eD()}function eF(a,b,c,d,e,f,g,h){return a?a.update(b,c,d,e,f,g,h):f===el?a:(en(h),en(g),new ev(b,d,[e,f]))}function eG(a){return a.constructor===ev||a.constructor===eu}function eH(a,b,c,d,e){let f;if(a.keyHash===d)return new eu(b,d,[a.entry,e]);let g=(0===c?a.keyHash:a.keyHash>>>c)&31,h=(0===c?d:d>>>c)&31,i=g===h?[eH(a,b,c+5,d,e)]:(f=new ev(b,d,e),g<h?[a,f]:[f,a]);return new es(b,1<<g|1<<h,i)}function eI(a){return a-=a>>1&0x55555555,a=(a=(0x33333333&a)+(a>>2&0x33333333))+(a>>4)&0xf0f0f0f,a+=a>>8,127&(a+=a>>16)}function eJ(a,b,c,d){let e=d?a:eo(a);return e[b]=c,e}let eK=8,eL=16,eM=8;class eN{constructor(a,b){this.name=a;let c=eD();b&&(c=c.withMutations(c=>{for(let[d,e]of b)c.set(d,d$(`${a}:${String(d)}`,e))})),this.atoms=d$(`${a}:atoms`,c)}atoms;getAtom(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return b||void this.atoms.get()}get(a){let b=this.getAtom(a)?.get();return cd(b!==dJ),b}__unsafe__getWithoutCapture(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);if(!b)return;let c=b.__unsafe__getWithoutCapture();return cd(c!==dJ),c}has(a){let b=this.getAtom(a);return!!b&&b.get()!==dJ}__unsafe__hasWithoutCapture(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return!!b&&(cd(b.__unsafe__getWithoutCapture()!==dJ),!0)}set(a,b){let c=this.atoms.__unsafe__getWithoutCapture().get(a);return c?c.set(b):this.atoms.update(c=>c.set(a,d$(`${this.name}:${String(a)}`,b))),this}update(a,b){let c=this.atoms.__unsafe__getWithoutCapture().get(a);if(!c)throw Error(`AtomMap: key ${a} not found`);let d=c.__unsafe__getWithoutCapture();cd(d!==dJ),c.set(b(d))}delete(a){let b=this.atoms.__unsafe__getWithoutCapture().get(a);return!!b&&(dH(()=>{b.set(dJ),this.atoms.update(b=>b.delete(a))}),!0)}deleteMany(a){return dH(()=>{let b=[],c=this.atoms.get().withMutations(c=>{for(let d of a){let a=c.get(d);if(!a)continue;let e=a.get();cd(e!==dJ),b.push([d,e]),c.delete(d),a.set(dJ)}});return b.length&&this.atoms.set(c),b})}clear(){return dH(()=>{for(let a of this.atoms.__unsafe__getWithoutCapture().values())a.set(dJ);this.atoms.set(eD())})}*entries(){for(let[a,b]of this.atoms.get()){let c=b.get();cd(c!==dJ),yield[a,c]}}*keys(){for(let a of this.atoms.get().keys())yield a}*values(){for(let a of this.atoms.get().values()){let b=a.get();cd(b!==dJ),yield b}}get size(){return this.atoms.get().size}forEach(a,b){for(let[c,d]of this.entries())a.call(b,d,c,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"}class eO{constructor(a,b){this.name=a;const c=b?Array.from(b,a=>[a,a]):void 0;this.map=new eN(a,c)}map;add(a){return this.map.set(a,a),this}clear(){this.map.clear()}delete(a){return this.map.delete(a)}forEach(a,b){for(let c of this)a.call(b,c,c,this)}has(a){return this.map.has(a)}get size(){return this.map.size}entries(){return this.map.entries()}keys(){return this.map.keys()}values(){return this.map.keys()}[Symbol.iterator](){return this.map.keys()}[Symbol.toStringTag]="AtomSet"}let eP={get url(){return`file://${a.P("ADK_WORKSPACE/TutorMekimi/tutorme-app/node_modules/@tldraw/store/dist-esm/lib/isDev.mjs")}`}},eQ=!1;try{eQ=!1}catch(a){}try{eQ=eQ||eP.env.DEV||eP.env.TEST||"development"===eP.env.MODE||"test"===eP.env.MODE}catch(a){}function eR(a){if(!eQ)return a;let b=Object.getPrototypeOf(a);if(b&&!(Array.isArray(a)||b===Object.prototype||null===b||b===dl))throw console.error("cannot include non-js data in a record",a),Error("cannot include non-js data in a record");if(Object.isFrozen(a))return a;for(let b of Object.getOwnPropertyNames(a)){let c=a[b];c&&"object"==typeof c&&eR(c)}return Object.freeze(a)}class eS{constructor(a){this.previousValue=a}nextValue;diff;get(){let a=this.diff?.removed?.size??0,b=this.diff?.added?.size??0;if(0!==a||0!==b)return{value:this.nextValue,diff:this.diff}}_add(a,b){this.nextValue??=new Set(this.previousValue),this.nextValue.add(a),this.diff??={},b?this.diff.removed?.delete(a):(this.diff.added??=new Set,this.diff.added.add(a))}add(a){let b=this.previousValue.has(a);if(b){if(!this.diff?.removed?.has(a))return;return this._add(a,b)}this.nextValue?.has(a)||this._add(a,b)}_remove(a,b){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(a),this.diff??={},b?(this.diff.removed??=new Set,this.diff.removed.add(a)):this.diff.added?.delete(a)}remove(a){let b=this.previousValue.has(a);if(!b){if(!this.diff?.added?.has(a))return;return this._remove(a,b)}this.diff?.removed?.has(a)||this._remove(a,b)}}function eT({sequence:a,sequenceId:b,retroactive:c=!0}){let d={sequenceId:b,retroactive:c,sequence:function(a){let b=[];for(let c=a.length-1;c>=0;c--){let d=a[c];if("id"in d)b.unshift(d);else{let a=d.dependsOn,c=b[0];c&&(b[0]={...c,dependsOn:a.concat(c.dependsOn??[])})}}return b}(a)};return eY(d),d}function eU(a,b){return Object.fromEntries(cI(b).map(([b,c])=>[b,`${a}/${c}`]))}function eV(a){return eT({sequenceId:a.sequenceId,retroactive:a.retroactive??!0,sequence:a.sequence.map(b=>"id"in b?{...b,scope:"record",filter:c=>c.typeName===a.recordType&&(b.filter?.(c)??!0)&&(a.filter?.(c)??!0)}:b)})}function eW(a){let[b,c]=a.split("/");return{sequenceId:b,version:parseInt(c)}}function eX(a,b){b&&cd(a.startsWith(b+"/"),`Every migration in sequence '${b}' must have an id starting with '${b}/'. Got invalid id: '${a}'`),cd(a.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${a}'`)}function eY(a){if(cd(!a.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${a.sequenceId}`),cd(a.sequenceId.length,"sequenceId must be a non-empty string"),0===a.sequence.length)return;eX(a.sequence[0].id,a.sequenceId);let b=eW(a.sequence[0].id).version;cd(1===b,`Expected the first migrationId to be '${a.sequenceId}/1' but got '${a.sequence[0].id}'`);for(let c=1;c<a.sequence.length;c++){let d=a.sequence[c].id;eX(d,a.sequenceId);let e=eW(d).version;cd(e===b+1,`Migration id numbers must increase in increments of 1, expected ${a.sequenceId}/${b+1} but got '${a.sequence[c].id}'`),b=e}}var eZ=((r=eZ||{}).IncompatibleSubtype="incompatible-subtype",r.UnknownType="unknown-type",r.TargetVersionTooNew="target-version-too-new",r.TargetVersionTooOld="target-version-too-old",r.MigrationError="migration-error",r.UnrecognizedSubtype="unrecognized-subtype",r);function e$(){return{added:{},updated:{},removed:{}}}function e_(a){let b={added:a.removed,removed:a.added,updated:{}};for(let[c,d]of Object.values(a.updated))b.updated[c.id]=[d,c];return b}function e0(a){return 0===Object.keys(a.added).length&&0===Object.keys(a.updated).length&&0===Object.keys(a.removed).length}function e1(a,b){let c=b?.mutateFirstDiff?a[0]:{added:{},removed:{},updated:{}};return e2(c,b?.mutateFirstDiff?a.slice(1):a),c}function e2(a,b){for(let c of b){for(let[b,d]of cI(c.added))if(a.removed[b]){let c=a.removed[b];delete a.removed[b],c!==d&&(a.updated[b]=[c,d])}else a.added[b]=d;for(let[b,[d,e]]of cI(c.updated)){if(a.added[b]){a.added[b]=e,delete a.updated[b],delete a.removed[b];continue}if(a.updated[b]){a.updated[b]=[a.updated[b][0],e],delete a.removed[b];continue}a.updated[b]=c.updated[b],delete a.removed[b]}for(let[b,d]of cI(c.removed))a.added[b]?delete a.added[b]:a.updated[b]?(a.removed[b]=a.updated[b][0],delete a.updated[b]):a.removed[b]=d}}class e3{constructor(a,b){this.typeName=a,this.createDefaultProperties=b.createDefaultProperties,this.validator=b.validator??{validate:a=>a},this.scope=b.scope??"document",this.ephemeralKeys=b.ephemeralKeys;const c=new Set;if(b.ephemeralKeys)for(const[a,d]of cI(b.ephemeralKeys))d&&c.add(a);this.ephemeralKeySet=c}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(a){let b={...this.createDefaultProperties(),id:"id"in a?a.id:this.createId()};for(let[c,d]of Object.entries(a))void 0!==d&&(b[c]=d);return b.typeName=this.typeName,b}clone(a){return{...dk(a),id:this.createId()}}createId(a){return this.typeName+":"+(a??cs(void 0))}parseId(a){if(!this.isId(a))throw Error(`ID "${a}" is not a valid ID for type "${this.typeName}"`);return a.slice(this.typeName.length+1)}isInstance(a){return a?.typeName===this.typeName}isId(a){if(!a)return!1;for(let b=0;b<this.typeName.length;b++)if(a[b]!==this.typeName[b])return!1;return":"===a[this.typeName.length]}withDefaultProperties(a){return new e3(this.typeName,{createDefaultProperties:a,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(a,b){return b&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(b,a):this.validator.validate(a)}}function e4(a,b){return new e3(a,{createDefaultProperties:()=>({}),validator:b.validator,scope:b.scope,ephemeralKeys:b.ephemeralKeys})}var e5=b_;function e6(a){return"object"==typeof a&&null!==a&&("eq"in a||"neq"in a||"gt"in a)}function e7(a,b){for(let[c,d]of Object.entries(a)){let a=b[c];if(e6(d)){if("eq"in d&&a!==d.eq||"neq"in d&&a===d.neq||"gt"in d&&("number"!=typeof a||a<=d.gt))return!1;continue}if("object"!=typeof a||null===a||!e7(d,a))return!1}return!0}function e8(a,b,c){let d=function a(b,c=""){let d=[];for(let[e,f]of Object.entries(b)){let b=c?`${c}\\${e}`:e;e6(f)?d.push({path:b,matcher:f}):"object"==typeof f&&null!==f&&d.push(...a(f,b))}return d}(c),e=Object.fromEntries(d.map(({path:a})=>[a,new Set]));for(let{path:c,matcher:f}of d){let d=a.index(b,c);if("eq"in f){let a=d.get().get(f.eq);if(a)for(let b of a)e[c].add(b)}else if("neq"in f){for(let[a,b]of d.get())if(a!==f.neq)for(let a of b)e[c].add(a)}else if("gt"in f){for(let[a,b]of d.get())if("number"==typeof a&&a>f.gt)for(let a of b)e[c].add(a)}if(0===e[c].size)return new Set}return function(a){if(0===a.length)return new Set;let b=a[0],c=a.slice(1),d=new Set;for(let a of b)c.every(b=>b.has(a))&&d.add(a);return d}(Object.values(e))}class e9{constructor(a,b){this.recordMap=a,this.history=b}indexCache=new Map;historyCache=new Map;getAllIdsForType(a){let b=new Set;for(let c of this.recordMap.values())c.typeName===a&&b.add(c.id);return b}getRecordById(a,b){let c=this.recordMap.get(b);if(c&&c.typeName===a)return c}getNestedValue(a,b){let c=a;for(let a of b){if(null==c||"object"!=typeof c)return;c=c[a]}return c}filterHistory(a){if(this.historyCache.has(a))return this.historyCache.get(a);let b=dQ("filterHistory:"+a,(b,c)=>{if(b===dJ)return this.history.get();let d=this.history.getDiffSince(c);if(d===dw)return this.history.get();let e={added:{},removed:{},updated:{}},f=0,g=0,h=0;for(let b of d){for(let c of cH(b.added))if(c.typeName===a)if(e.removed[c.id]){let a=e.removed[c.id];delete e.removed[c.id],g--,a!==c&&(e.updated[c.id]=[a,c],h++)}else e.added[c.id]=c,f++;for(let[c,d]of cH(b.updated))d.typeName===a&&(e.added[d.id]?e.added[d.id]=d:e.updated[d.id]?e.updated[d.id]=[e.updated[d.id][0],d]:(e.updated[d.id]=[c,d],h++));for(let c of cH(b.removed))c.typeName===a&&(e.added[c.id]?(delete e.added[c.id],f--):(e.updated[c.id]?(e.removed[c.id]=e.updated[c.id][0],delete e.updated[c.id],h--):e.removed[c.id]=c,g++))}return f||g||h?dL(this.history.get(),e):b},{historyLength:100});return this.historyCache.set(a,b),b}index(a,b){let c=a+":"+b;if(this.indexCache.has(c))return this.indexCache.get(c);let d=this.__uncached_createIndex(a,b);return this.indexCache.set(c,d),d}__uncached_createIndex(a,b){let c=this.filterHistory(a),d=b.split("\\"),e=d.length>1?a=>this.getNestedValue(a,d):a=>a[b],f=()=>{c.get();let b=new Map;for(let c of this.recordMap.values())if(c.typeName===a){let a=e(c);void 0!==a&&(b.has(a)||b.set(a,new Set),b.get(a).add(c.id))}return b};return dQ("index:"+a+":"+b,(b,d)=>{let g,h;if(b===dJ)return f();let i=c.getDiffSince(d);if(i===dw)return f();let j=new Map,k=(a,c)=>{let d=j.get(a);d||(d=new eS(b.get(a)??new Set)),d.add(c),j.set(a,d)},l=(a,c)=>{let d=j.get(a);d||(d=new eS(b.get(a)??new Set)),d.remove(c),j.set(a,d)};for(let b of i){for(let c of cH(b.added))if(c.typeName===a){let a=e(c);void 0!==a&&k(a,c.id)}for(let[c,d]of cH(b.updated))if(d.typeName===a){let a=e(c),b=e(d);a!==b&&(void 0!==a&&l(a,d.id),void 0!==b&&k(b,d.id))}for(let c of cH(b.removed))if(c.typeName===a){let a=e(c);void 0!==a&&l(a,c.id)}}for(let[a,c]of j){let d=c.get();d&&(g||(g=new Map(b)),h||(h=new Map),0===d.value.size?g.delete(a):g.set(a,d.value),h.set(a,d.diff))}return g&&h?dL(g,h):b},{historyLength:100})}record(a,b=()=>({}),c="record:"+a+(b?":"+b.toString():"")){let d=this.ids(a,b,c);return dQ(c,()=>{for(let a of d.get())return this.recordMap.get(a)})}records(a,b=()=>({}),c="records:"+a+(b?":"+b.toString():"")){let d=this.ids(a,b,"ids:"+c);return dQ(c,()=>Array.from(d.get(),a=>this.recordMap.get(a)),{isEqual:b7})}ids(a,b=()=>({}),c="ids:"+a+(b?":"+b.toString():"")){let d=this.filterHistory(a),e=()=>{d.get();let c=b();return 0===Object.keys(c).length?this.getAllIdsForType(a):e8(this,a,c)},f=a=>{let b=e(),c=function(a,b){let c={};for(let d of b)a.has(d)||(c.added??=new Set,c.added.add(d));for(let d of a)b.has(d)||(c.removed??=new Set,c.removed.add(d));return c.added||c.removed?c:void 0}(a,b);return c?dL(b,c):a},g=dQ("ids_query:"+c,b,{isEqual:e5.default});return dQ("query:"+c,(b,c)=>{let h=g.get();if(b===dJ)return e();if(c<g.lastChangedEpoch)return f(b);let i=d.getDiffSince(c);if(i===dw)return f(b);let j=new eS(b);for(let b of i){for(let c of cH(b.added))c.typeName===a&&e7(h,c)&&j.add(c.id);for(let[c,d]of cH(b.updated))d.typeName===a&&(e7(h,d)?j.add(d.id):j.remove(d.id));for(let c of cH(b.removed))c.typeName===a&&j.remove(c.id)}let k=j.get();return k?dL(k.value,k.diff):b},{historyLength:50})}exec(a,b){let c=e8(this,a,b);return 0===c.size?du:Array.from(c,a=>this.recordMap.get(a))}}class fa{constructor(a){this.store=a}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(a){this._isEnabled=a}handleBeforeCreate(a,b){if(!this._isEnabled)return a;let c=this._beforeCreateHandlers[a.typeName];if(c){let d=a;for(let a of c)d=a(d,b);return d}return a}handleAfterCreate(a,b){if(!this._isEnabled)return;let c=this._afterCreateHandlers[a.typeName];if(c)for(let d of c)d(a,b)}handleBeforeChange(a,b,c){if(!this._isEnabled)return b;let d=this._beforeChangeHandlers[b.typeName];if(d){let e=b;for(let b of d)e=b(a,e,c);return e}return b}handleAfterChange(a,b,c){if(!this._isEnabled)return;let d=this._afterChangeHandlers[b.typeName];if(d)for(let e of d)e(a,b,c)}handleBeforeDelete(a,b){if(!this._isEnabled)return!0;let c=this._beforeDeleteHandlers[a.typeName];if(c){for(let d of c)if(!1===d(a,b))return!1}return!0}handleAfterDelete(a,b){if(!this._isEnabled)return;let c=this._afterDeleteHandlers[a.typeName];if(c)for(let d of c)d(a,b)}handleOperationComplete(a){if(this._isEnabled)for(let b of this._operationCompleteHandlers)b(a)}register(a){let b=[];for(let[c,d]of Object.entries(a))d?.beforeCreate&&b.push(this.registerBeforeCreateHandler(c,d.beforeCreate)),d?.afterCreate&&b.push(this.registerAfterCreateHandler(c,d.afterCreate)),d?.beforeChange&&b.push(this.registerBeforeChangeHandler(c,d.beforeChange)),d?.afterChange&&b.push(this.registerAfterChangeHandler(c,d.afterChange)),d?.beforeDelete&&b.push(this.registerBeforeDeleteHandler(c,d.beforeDelete)),d?.afterDelete&&b.push(this.registerAfterDeleteHandler(c,d.afterDelete));return()=>{for(let a of b)a()}}registerBeforeCreateHandler(a,b){return this._beforeCreateHandlers[a]||(this._beforeCreateHandlers[a]=[]),this._beforeCreateHandlers[a].push(b),()=>fb(this._beforeCreateHandlers[a],b)}registerAfterCreateHandler(a,b){return this._afterCreateHandlers[a]||(this._afterCreateHandlers[a]=[]),this._afterCreateHandlers[a].push(b),()=>fb(this._afterCreateHandlers[a],b)}registerBeforeChangeHandler(a,b){return this._beforeChangeHandlers[a]||(this._beforeChangeHandlers[a]=[]),this._beforeChangeHandlers[a].push(b),()=>fb(this._beforeChangeHandlers[a],b)}registerAfterChangeHandler(a,b){return this._afterChangeHandlers[a]||(this._afterChangeHandlers[a]=[]),this._afterChangeHandlers[a].push(b),()=>fb(this._afterChangeHandlers[a],b)}registerBeforeDeleteHandler(a,b){return this._beforeDeleteHandlers[a]||(this._beforeDeleteHandlers[a]=[]),this._beforeDeleteHandlers[a].push(b),()=>fb(this._beforeDeleteHandlers[a],b)}registerAfterDeleteHandler(a,b){return this._afterDeleteHandlers[a]||(this._afterDeleteHandlers[a]=[]),this._afterDeleteHandlers[a].push(b),()=>fb(this._afterDeleteHandlers[a],b)}registerOperationCompleteHandler(a){return this._operationCompleteHandlers.push(a),()=>fb(this._operationCompleteHandlers,a)}}function fb(a,b){let c=a.indexOf(b);c>=0&&a.splice(c,1)}class fc{id;records;history=d$("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new fd;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new fa(this);constructor(a){const{initialData:b,schema:c,id:d}=a;this.id=d??function(a){return cs(void 0)}(),this.schema=c,this.props=a.props,b?this.records=new eN("store",cI(b).map(([a,b])=>[a,eR(this.schema.validateRecord(this,b,"initialize",null))])):this.records=new eN("store"),this.query=new e9(this.records,this.history),this.historyReactor=function(a,b,c){let d=new dz(a,b,c);return{scheduler:d,start:a=>{let b=a?.force??!1;d.attach(),b?d.scheduleEffect():d.maybeScheduleEffect()},stop:()=>{d.detach()}}}("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:a=>this.cancelHistoryReactor=df(a)}),this.scopedTypes={document:new Set(cH(this.schema.types).filter(a=>"document"===a.scope).map(a=>a.typeName)),session:new Set(cH(this.schema.types).filter(a=>"session"===a.scope).map(a=>a.typeName)),presence:new Set(cH(this.schema.types).filter(a=>"presence"===a.scope).map(a=>a.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges())for(let{changes:a,source:b}of this.historyAccumulator.flush()){let c=null,d=null,e=null;for(let{onHistory:f,filters:g}of this.listeners)if("all"===g.source||g.source===b)if("all"!==g.scope)if("document"===g.scope){if(!(d??=this.filterChangesByScope(a,"document")))continue;f({changes:d,source:b})}else if("session"===g.scope){if(!(c??=this.filterChangesByScope(a,"session")))continue;f({changes:c,source:b})}else{if(!(e??=this.filterChangesByScope(a,"presence")))continue;f({changes:e,source:b})}else f({changes:a,source:b})}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(a,b){let c={added:cK(a.added,(a,c)=>this.scopedTypes[b].has(c.typeName)),updated:cK(a.updated,(a,c)=>this.scopedTypes[b].has(c[1].typeName)),removed:cK(a.removed,(a,c)=>this.scopedTypes[b].has(c.typeName))};return 0===Object.keys(c.added).length&&0===Object.keys(c.updated).length&&0===Object.keys(c.removed).length?null:c}updateHistory(a){this.historyAccumulator.add({changes:a,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,a)}validate(a){this.allRecords().forEach(b=>this.schema.validateRecord(this,b,a,null))}put(a,b){this.atomic(()=>{let c,d={},e={},f=!1,g=this.isMergingRemoteChanges?"remote":"user";for(let h=0,i=a.length;h<i;h++){c=a[h];let i=this.records.__unsafe__getWithoutCapture(c.id);if(i){if(c=this.sideEffects.handleBeforeChange(i,c,g),this.schema.validateRecord(this,c,b??"updateRecord",i)===i)continue;c=eR(c),this.records.set(c.id,c),f=!0,d[c.id]=[i,c],this.addDiffForAfterEvent(i,c)}else c=this.sideEffects.handleBeforeCreate(c,g),f=!0,e[(c=eR(c=this.schema.validateRecord(this,c,b??"createRecord",null))).id]=c,this.addDiffForAfterEvent(null,c),this.records.set(c.id,c)}f&&this.updateHistory({added:e,updated:d,removed:{}})})}remove(a){this.atomic(()=>{let b=new Set(a),c=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(let d of a){let a=this.records.__unsafe__getWithoutCapture(d);a&&!1===this.sideEffects.handleBeforeDelete(a,c)&&b.delete(d)}let d=this.records.deleteMany(b);if(0===d.length)return;let e={};for(let[a,b]of d)e[a]=b,this.addDiffForAfterEvent(b,null);this.updateHistory({added:{},updated:{},removed:e})})}get(a){return this.records.get(a)}unsafeGetWithoutCapture(a){return this.records.__unsafe__getWithoutCapture(a)}serialize(a="document"){let b={};for(let[c,d]of this.records)("all"===a||this.scopedTypes[a].has(d.typeName))&&(b[c]=d);return b}getStoreSnapshot(a="document"){return{store:this.serialize(a),schema:this.schema.serialize()}}migrateSnapshot(a){let b=this.schema.migrateStoreSnapshot(a);if("error"===b.type)throw Error(`Failed to migrate snapshot: ${b.reason}`);return{store:b.value,schema:this.schema.serialize()}}loadStoreSnapshot(a){let b=this.schema.migrateStoreSnapshot(a);if("error"===b.type)throw Error(`Failed to migrate snapshot: ${b.reason}`);let c=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(b.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(c)}}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(a,b){let c=this.unsafeGetWithoutCapture(a);c?this.put([b(c)]):console.error(`Record ${a} not found. This is probably an error`)}has(a){return this.records.has(a)}listen(a,b){this._flushHistory();let c={onHistory:a,filters:{source:b?.source??"all",scope:b?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(c),()=>{this.listeners.delete(c),0===this.listeners.size&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(a){if(this.isMergingRemoteChanges)return a();if(this._isInAtomicOp)throw Error("Cannot merge remote changes while in atomic operation");try{this.atomic(a,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(a){let b=[],c=this.historyAccumulator.addInterceptor(a=>b.push(a.changes));try{return dH(a),e1(b)}finally{c()}}applyDiff(a,{runCallbacks:b=!0,ignoreEphemeralKeys:c=!1}={}){this.atomic(()=>{let b=cH(a.added);for(let[d,e]of cH(a.updated)){let a=this.schema.getType(e.typeName);if(c&&a.ephemeralKeySet.size){let c=this.get(e.id);if(!c){b.push(e);continue}let d=null;for(let[b,f]of Object.entries(e))a.ephemeralKeySet.has(b)||Object.is(f,cF(c,b))||(d||(d={...c}),d[b]=f);d&&b.push(d)}else b.push(e)}let d=cG(a.removed);b.length&&this.put(b),d.length&&this.remove(d)},b)}createCache(a){let b=new ci;return{get:c=>{let d=this.records.getAtom(c);if(d)return b.get(d,()=>a(c,d)).get()}}}createComputedCache(a,b,c){return this.createCache((d,e)=>{let f=c?.areRecordsEqual?dQ(`${a}:${d}:isEqual`,()=>e.get(),{isEqual:c.areRecordsEqual}):e;return dQ(a+":"+d,()=>b(f.get()),{isEqual:c?.areResultsEqual})})}_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(a,b){if(cd(this.pendingAfterEvents,"must be in event operation"),a===b||(a&&b&&cd(a.id===b.id),!a&&!b))return;let c=(a||b).id,d=this.pendingAfterEvents.get(c);d?d.after=b:this.pendingAfterEvents.set(c,{before:a,after:b})}flushAtomicCallbacks(a){let b=0,c=a?"remote":"user";for(;this.pendingAfterEvents;){let a=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(++b>100)throw Error("Maximum store update depth exceeded, bailing out");for(let{before:b,after:d}of a.values())b&&d&&b!==d&&!(0,e5.default)(b,d)?this.sideEffects.handleAfterChange(b,d,c):b&&!d?this.sideEffects.handleAfterDelete(b,c):!b&&d&&this.sideEffects.handleAfterCreate(d,c);this.pendingAfterEvents?c="user":this.sideEffects.handleOperationComplete(c)}}}_isInAtomicOp=!1;atomic(a,b=!0,c=!1){return dH(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);let d=this.sideEffects.isEnabled();cd(!c,"cannot call mergeRemoteChanges while in atomic operation");try{return d&&!b&&this.sideEffects.setIsEnabled(!1),a()}finally{this.sideEffects.setIsEnabled(d)}}this.pendingAfterEvents=new Map;let d=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(b??d),this._isInAtomicOp=!0,c&&(this.isMergingRemoteChanges=!0);try{let b=a();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(c),b}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(d),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(a){return this.historyAccumulator.addInterceptor(b=>a(b,this.isMergingRemoteChanges?"remote":"user"))}}class fd{_history=[];_interceptors=new Set;addInterceptor(a){return this._interceptors.add(a),()=>{this._interceptors.delete(a)}}add(a){for(let b of(this._history.push(a),this._interceptors))b(a)}flush(){let a=function(a){let b;if(0===a.length)return[];let c=[],d=[a[0]];for(let e=1,f=a.length;e<f;e++)b=a[e],d[0].source!==b.source&&(c.push(d),d=[]),d.push(b);return c.push(d),eR(c.map(a=>({source:a[0].source,changes:e1(a.map(a=>a.changes))})))}(this._history);return this._history=[],a}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function fe(a,b,c){let d=new ci;return{get:(e,f)=>d.get(e,()=>(e instanceof fc?e:e.store).createComputedCache(a,a=>b(e,a),c)).get(f)}}var e5=b_;class ff{constructor(a,b){for(const c of(this.types=a,this.options=b,b.migrations??[]))cd(!this.migrations[c.sequenceId],`Duplicate migration sequenceId ${c.sequenceId}`),eY(c),this.migrations[c.sequenceId]=c;const c=Object.values(this.migrations).flatMap(a=>a.sequence);for(const a of(this.sortedMigrations=function(a){if(0===a.length)return[];let b=new Map(a.map(a=>[a.id,a])),c=new Map,d=new Map,e=new Map;for(let b of a)d.set(b.id,0),c.set(b.id,new Set),e.set(b.id,new Set);for(let f of a){let{version:a,sequenceId:g}=eW(f.id),h=`${g}/${a-1}`;if(b.has(h)&&(c.get(h).add(f.id),d.set(f.id,d.get(f.id)+1)),f.dependsOn)for(let a of f.dependsOn)b.has(a)&&(c.get(a).add(f.id),e.get(f.id).add(a),d.set(f.id,d.get(f.id)+1))}let f=a.filter(a=>0===d.get(a.id)),g=[],h=new Set;for(;f.length>0;){let a,i=-1/0;for(let b of f){let d=0;for(let a of c.get(b.id)||[])!h.has(a)&&(d+=1,e.get(a).has(b.id)&&(d+=100));(d>i||d===i&&0>b.id.localeCompare(a?.id??""))&&(a=b,i=d)}let j=a;for(let a of(f.splice(f.indexOf(j),1),g.push(j),h.add(j.id),c.get(j.id)||[]))h.has(a)||(d.set(a,d.get(a)-1),0===d.get(a)&&f.push(b.get(a)))}if(g.length!==a.length){let b=a.filter(a=>!h.has(a.id));cd(!1,`Circular dependency in migrations: ${b[0].id}`)}return g}(c),this.sortedMigrations))if(a.dependsOn?.length)for(const b of a.dependsOn)cd(c.find(a=>a.id===b),`Migration '${a.id}' depends on missing migration '${b}'`)}static create(a,b){return new ff(a,b??{})}migrations={};sortedMigrations;migrationCache=new WeakMap;validateRecord(a,b,c,d){try{let a=cF(this.types,b.typeName);if(!a)throw Error(`Missing definition for record type ${b.typeName}`);return a.validate(b,d??void 0)}catch(e){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:a,record:b,phase:c,recordBefore:d,error:e});throw e}}getMigrationsSince(a){let b=this.migrationCache.get(a);if(b)return b;let c=function(a){if(a.schemaVersion>2||a.schemaVersion<1)return cb.err("Bad schema version");if(2===a.schemaVersion)return cb.ok(a);let b={schemaVersion:2,sequences:{"com.tldraw.store":a.storeVersion}};for(let[c,d]of Object.entries(a.recordVersions))if(b.sequences[`com.tldraw.${c}`]=d.version,"subTypeKey"in d)for(let[a,e]of Object.entries(d.subTypeVersions))b.sequences[`com.tldraw.${c}.${a}`]=e;return cb.ok(b)}(a);if(!c.ok)return this.migrationCache.set(a,c),c;let d=c.value,e=new Set(Object.keys(d.sequences).filter(a=>this.migrations[a]));for(let a in this.migrations)void 0===d.sequences[a]&&this.migrations[a].retroactive&&e.add(a);if(0===e.size){let b=cb.ok([]);return this.migrationCache.set(a,b),b}let f=new Set;for(let b of e){let c=d.sequences[b];if("number"!=typeof c&&this.migrations[b].retroactive||0===c){for(let a of this.migrations[b].sequence)f.add(a.id);continue}let e=`${b}/${c}`,g=this.migrations[b].sequence.findIndex(a=>a.id===e);if(-1===g){let b=cb.err("Incompatible schema?");return this.migrationCache.set(a,b),b}for(let a of this.migrations[b].sequence.slice(g+1))f.add(a.id)}let g=cb.ok(this.sortedMigrations.filter(({id:a})=>f.has(a)));return this.migrationCache.set(a,g),g}migratePersistedRecord(a,b,c="up"){let d=this.getMigrationsSince(b);if(!d.ok)return console.error("Error migrating record",d.error),{type:"error",reason:eZ.MigrationError};let e=d.value;if(0===e.length)return{type:"success",value:a};if(!e.every(a=>"record"===a.scope))return{type:"error",reason:"down"===c?eZ.TargetVersionTooOld:eZ.TargetVersionTooNew};if("down"===c){if(!e.every(a=>"record"===a.scope&&a.down))return{type:"error",reason:eZ.TargetVersionTooOld};e=e.slice().reverse()}a=dk(a);try{for(let b of e){if("store"===b.scope||"storage"===b.scope)throw Error();if(!(!b.filter||b.filter(a)))continue;let d=b[c](a);d&&(a=dk(d))}}catch(a){return console.error("Error migrating record",a),{type:"error",reason:eZ.MigrationError}}return{type:"success",value:a}}migrateStorage(a){let b=a.getSchema();cd(b,"Schema is missing.");let c=this.getMigrationsSince(b);if(!c.ok)throw console.error("Error migrating store",c.error),Error(c.error);let d=c.value;if(0!==d.length){for(let b of(a.setSchema(this.serialize()),d))if("record"===b.scope){let c=[];for(let[d,e]of a.entries()){if(!(!b.filter||b.filter(e)))continue;let a=dk(e),f=b.up(a)??a;(0,e5.default)(f,e)||c.push([d,f])}for(let[b,d]of c)a.set(b,d)}else if("store"===b.scope){let c=Object.fromEntries(a.entries()),d=dk(c);for(let[e,f]of Object.entries(d=b.up(d)??d))f&&((0,e5.default)(f,c[e])||a.set(e,f));for(let b of Object.keys(c))d[b]||a.delete(b)}else"storage"===b.scope?b.up(a):cc(b);for(let[b,c]of a.entries())"document"!==this.getType(c.typeName).scope&&a.delete(b)}}migrateStoreSnapshot(a,b){let c=this.getMigrationsSince(a.schema);if(!c.ok)return console.error("Error migrating store",c.error),{type:"error",reason:eZ.MigrationError};if(0===c.value.length)return{type:"success",value:a.store};let d=Object.assign(new Map(cI(a.store).map(eR)),{getSchema:()=>a.schema,setSchema:a=>{}});try{if(this.migrateStorage(d),!b?.mutateInputStore)return{type:"success",value:Object.fromEntries(d.entries())};for(let[b,c]of d.entries())a.store[b]=c;for(let b of Object.keys(a.store))d.has(b)||delete a.store[b];return{type:"success",value:a.store}}catch(a){return console.error("Error migrating store",a),{type:"error",reason:eZ.MigrationError}}}createIntegrityChecker(a){return this.options.createIntegrityChecker?.(a)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:a,sequence:b})=>[a,b.length?eW(b.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:a})=>[a,0]))}}getType(a){let b=cF(this.types,a);return cd(b,"record type does not exists"),b}}bV("@tldraw/store","4.4.0","esm"),a.s([],183851);class fg extends Error{constructor(a,b=[]){const c=function(a){if(!a.length)return null;let b="";for(let c of a)"number"==typeof c?b+=`.${c}`:c.startsWith("(")?b.endsWith(")")?b=`${b.slice(0,-1)}, ${c.slice(1)}`:b+=c:b+=`.${c}`;return(b=b.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?b.slice(1):b}(b),d=a.split("\n").map((a,b)=>0===b?a:`  ${a}`).join("\n");super(b?`At ${c}: ${d}`:d),this.rawMessage=a,this.path=b}name="ValidationError"}function fh(a,b){try{return b()}catch(b){if(b instanceof fg)throw new fg(b.rawMessage,[a,...b.path]);throw new fg(b.toString(),[a])}}function fi(a){if(null===a)return"null";if(Array.isArray(a))return"an array";let b=typeof a;switch(b){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${b}`;case"object":return`an ${b}`;case"undefined":return"undefined";default:cc(b)}}class fj{constructor(a,b,c=!1){this.validationFn=a,this.validateUsingKnownGoodVersionFn=b,this.skipSameValueCheck=c}validate(a){return this.validationFn(a)}validateUsingKnownGoodVersion(a,b){return Object.is(a,b)?a:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(a,b):this.validate(b)}isValid(a){try{return this.validate(a),!0}catch{return!1}}nullable(){return fQ(this)}optional(){return fP(this)}refine(a){return new fj(b=>a(this.validate(b)),(b,c)=>{let d=this.validateUsingKnownGoodVersion(b,c);return Object.is(b,d)?b:a(d)},!0)}check(a,b){return"string"==typeof a?this.refine(c=>(fh(`(check ${a})`,()=>b(c)),c)):this.refine(b=>(a(b),b))}}class fk extends fj{constructor(a){super(b=>{let c=fD.validate(b);for(let b=0;b<c.length;b++)try{a.validate(c[b])}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[b,...a.path]);throw new fg(a.toString(),[b])}return c},(b,c)=>{if(Object.is(b,c))return b;if(!a.validateUsingKnownGoodVersion)return this.validate(c);let d=fD.validate(c),e=b.length!==d.length;for(let c=0;c<d.length;c++){let f=d[c];if(c>=b.length){e=!0;try{a.validate(f)}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[c,...a.path]);throw new fg(a.toString(),[c])}continue}if(!Object.is(b[c],f))try{let d=a.validateUsingKnownGoodVersion(b[c],f);Object.is(d,b[c])||(e=!0)}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[c,...a.path]);throw new fg(a.toString(),[c])}}return e?c:b}),this.itemValidator=a}nonEmpty(){return this.check(a=>{if(0===a.length)throw new fg("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(a=>{if(a.length<=1)throw new fg("Expected an array with length greater than 1")})}}class fl extends fj{constructor(a,b=!1){super(c=>{if("object"!=typeof c||null===c)throw new fg(`Expected object, got ${fi(c)}`);for(let b in a){if(!cE(a,b))continue;let d=a[b];try{d.validate(cF(c,b))}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[b,...a.path]);throw new fg(a.toString(),[b])}}if(!b){for(let b of Object.keys(c))if(!cE(a,b))throw new fg("Unexpected property",[b])}return c},(c,d)=>{if(Object.is(c,d))return c;if("object"!=typeof d||null===d)throw new fg(`Expected object, got ${fi(d)}`);let e=!1;for(let b in a){if(!cE(a,b))continue;let f=a[b],g=cF(c,b),h=cF(d,b);if(!Object.is(g,h))try{let a=f.validateUsingKnownGoodVersion?f.validateUsingKnownGoodVersion(g,h):f.validate(h);Object.is(a,g)||(e=!0)}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[b,...a.path]);throw new fg(a.toString(),[b])}}if(!b){for(let b of Object.keys(d))if(!cE(a,b))throw new fg("Unexpected property",[b])}for(let a of Object.keys(c))if(!cE(d,a)){e=!0;break}return e?d:c}),this.config=a,this.shouldAllowUnknownProperties=b}allowUnknownProperties(){return new fl(this.config,!0)}extend(a){return new fl({...this.config,...a})}}class fm extends fj{constructor(a,b,c,d){super(b=>{this.expectObject(b);let{matchingSchema:c,variant:d}=this.getMatchingSchemaAndVariant(b);return void 0===c?this.unknownValueValidation(b,d):fh(`(${a} = ${d})`,()=>c.validate(b))},(b,c)=>{this.expectObject(c),this.expectObject(b);let{matchingSchema:d,variant:e}=this.getMatchingSchemaAndVariant(c);return void 0===d?this.unknownValueValidation(c,e):cF(b,a)!==cF(c,a)?fh(`(${a} = ${e})`,()=>d.validate(c)):fh(`(${a} = ${e})`,()=>d.validateUsingKnownGoodVersion?d.validateUsingKnownGoodVersion(b,c):d.validate(c))}),this.key=a,this.config=b,this.unknownValueValidation=c,this.useNumberKeys=d}expectObject(a){if("object"!=typeof a||null===a)throw new fg(`Expected an object, got ${fi(a)}`,[])}getMatchingSchemaAndVariant(a){let b=cF(a,this.key);if(this.useNumberKeys||"string"==typeof b){if(this.useNumberKeys){let a=Number(b);if(a-a!=0)throw new fg(`Expected a number for key "${this.key}", got "${b}"`)}}else throw new fg(`Expected a string for key "${this.key}", got ${fi(b)}`);return{matchingSchema:cE(this.config,b)?this.config[b]:void 0,variant:b}}validateUnknownVariants(a){return new fm(this.key,this.config,a,this.useNumberKeys)}}class fn extends fj{constructor(a,b){super(c=>{if("object"!=typeof c||null===c)throw new fg(`Expected object, got ${fi(c)}`);for(let d in c)if(cE(c,d))try{a.validate(d),b.validate(c[d])}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[d,...a.path]);throw new fg(a.toString(),[d])}return c},(c,d)=>{if("object"!=typeof d||null===d)throw new fg(`Expected object, got ${fi(d)}`);let e=!1,f=0;for(let g in d){if(!cE(d,g))continue;f++;let h=d[g];if(!cE(c,g)){e=!0;try{a.validate(g),b.validate(h)}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[g,...a.path]);throw new fg(a.toString(),[g])}continue}let i=c[g];if(!Object.is(i,h))try{let a=b.validateUsingKnownGoodVersion?b.validateUsingKnownGoodVersion(i,h):b.validate(h);Object.is(a,i)||(e=!0)}catch(a){if(a instanceof fg)throw new fg(a.rawMessage,[g,...a.path]);throw new fg(a.toString(),[g])}}if(!e){let a=0;for(let b in c)cE(c,b)&&a++;a!==f&&(e=!0)}return e?d:c}),this.keyValidator=a,this.valueValidator=b}}function fo(a){return new fj(b=>{if(typeof b!==a)throw new fg(`Expected ${a}, got ${fi(b)}`);return b})}let fp=new fj(a=>a),fq=new fj(a=>a),fr=fo("string"),fs=new fj(a=>{if(Number.isFinite(a))return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");throw new fg(`Expected a finite number, got ${a}`)}),ft=new fj(a=>{if(Number.isFinite(a)&&a>=0)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(a<0)throw new fg(`Expected a positive number, got ${a}`);throw new fg(`Expected a finite number, got ${a}`)}),fu=new fj(a=>{if(Number.isFinite(a)&&a>0)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(a<=0)throw new fg(`Expected a non-zero positive number, got ${a}`);throw new fg(`Expected a finite number, got ${a}`)}),fv=new fj(a=>{if(Number.isFinite(a)&&0!==a)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(0===a)throw new fg("Expected a non-zero number, got 0");throw new fg(`Expected a finite number, got ${a}`)}),fw=new fj(a=>{if(Number.isFinite(a)&&a>=0&&a<=1)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");throw new fg(`Expected a number between 0 and 1, got ${a}`)}),fx=new fj(a=>{if(Number.isInteger(a))return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(a-a!=0)throw new fg(`Expected a finite number, got ${a}`);throw new fg(`Expected an integer, got ${a}`)}),fy=new fj(a=>{if(Number.isInteger(a)&&a>=0)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(a-a!=0)throw new fg(`Expected a finite number, got ${a}`);if(a<0)throw new fg(`Expected a positive integer, got ${a}`);throw new fg(`Expected an integer, got ${a}`)}),fz=new fj(a=>{if(Number.isInteger(a)&&a>0)return a;if("number"!=typeof a)throw new fg(`Expected number, got ${fi(a)}`);if(a!=a)throw new fg("Expected a number, got NaN");if(a-a!=0)throw new fg(`Expected a finite number, got ${a}`);if(a<=0)throw new fg(`Expected a non-zero positive integer, got ${a}`);throw new fg(`Expected an integer, got ${a}`)}),fA=fo("boolean"),fB=fo("bigint");function fC(a){return new fj(b=>{if(b!==a)throw new fg(`Expected ${a}, got ${JSON.stringify(b)}`);return a})}let fD=new fj(a=>{if(!Array.isArray(a))throw new fg(`Expected an array, got ${fi(a)}`);return a});function fE(a){return new fk(a)}let fF=new fj(a=>{if("object"!=typeof a||null===a)throw new fg(`Expected object, got ${fi(a)}`);return a});function fG(a){return new fl(a)}function fH(a){return"object"==typeof a&&null!==a&&(Object.getPrototypeOf(a)===Object.prototype||null===Object.getPrototypeOf(a)||Object.getPrototypeOf(a)===dl)}let fI=new fj(a=>{if(function a(b){return null===b||"number"==typeof b||"string"==typeof b||"boolean"==typeof b||(Array.isArray(b)?b.every(a):!!fH(b)&&Object.values(b).every(a))}(a))return a;throw new fg(`Expected json serializable value, got ${typeof a}`)},(a,b)=>{if(Array.isArray(a)&&Array.isArray(b)){let c=a.length!==b.length;for(let d=0;d<b.length;d++){if(d>=a.length){c=!0,fI.validate(b[d]);continue}let e=a[d],f=b[d];!Object.is(e,f)&&(Object.is(fI.validateUsingKnownGoodVersion(e,f),e)||(c=!0))}return c?b:a}if(!(fH(a)&&fH(b)))return fI.validate(b);{let c=!1;for(let d of Object.keys(b)){if(!cE(a,d)){c=!0,fI.validate(b[d]);continue}let e=a[d],f=b[d];!Object.is(e,f)&&(Object.is(fI.validateUsingKnownGoodVersion(e,f),e)||(c=!0))}for(let d of Object.keys(a))if(!cE(b,d)){c=!0;break}return c?b:a}});function fJ(){return fK(fr,fI)}function fK(a,b){return new fn(a,b)}function fL(a,b){return new fm(a,b,(c,d)=>{throw new fg(`Expected one of ${Object.keys(b).map(a=>JSON.stringify(a)).join(" or ")}, got ${JSON.stringify(d)}`,[a])},!1)}function fM(a,b){return new fm(a,b,(c,d)=>{throw new fg(`Expected one of ${Object.keys(b).map(a=>JSON.stringify(a)).join(" or ")}, got ${JSON.stringify(d)}`,[a])},!0)}function fN(a,b){return new fj(c=>fh(a,()=>b.validate(c)),(c,d)=>fh(a,()=>b.validateUsingKnownGoodVersion?b.validateUsingKnownGoodVersion(c,d):b.validate(d)))}function fO(a){return new fj(b=>{if(!a.has(b)){let c=Array.from(a,a=>JSON.stringify(a)).join(" or ");throw new fg(`Expected ${c}, got ${b}`)}return b})}function fP(a){return new fj(b=>{if(void 0!==b)return a.validate(b)},(b,c)=>{if(void 0!==c)return a.validateUsingKnownGoodVersion&&void 0!==b?a.validateUsingKnownGoodVersion(b,c):a.validate(c)},a instanceof fj&&a.skipSameValueCheck)}function fQ(a){return new fj(b=>null===b?null:a.validate(b),(b,c)=>null===c?null:a.validateUsingKnownGoodVersion&&null!==b?a.validateUsingKnownGoodVersion(b,c):a.validate(c),a instanceof fj&&a.skipSameValueCheck)}function fR(...a){return fO(new Set(a))}function fS(a){try{return new URL(a)}catch{if(a.startsWith("/")||a.startsWith("./"))try{return new URL(a,"http://example.com")}catch{}throw new fg(`Expected a valid url, got ${JSON.stringify(a)}`)}}let fT=new Set(["http:","https:","mailto:"]),fU=fr.check(a=>{if(""===a)return;let b=fS(a);if(!fT.has(b.protocol.toLowerCase()))throw new fg(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),fV=new Set(["http:","https:","data:","asset:"]),fW=fr.check(a=>{if(""===a)return;let b=fS(a);if(!fV.has(b.protocol.toLowerCase()))throw new fg(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),fX=fr.check(a=>{if(""!==a&&!fS(a).protocol.toLowerCase().match(/^https?:$/))throw new fg(`Expected a valid url, got ${JSON.stringify(a)} (invalid protocol)`)}),fY=fr.refine(a=>{try{try{c_(a,null)}catch{throw Error("invalid index: "+a)}return a}catch{throw new fg(`Expected an index key, got ${JSON.stringify(a)}`)}});function fZ(a,b){return new fj(c=>{try{return a.validate(c)}catch{return b.validate(c)}})}a.s(["ArrayOfValidator",()=>fk,"DictValidator",()=>fn,"ObjectValidator",()=>fl,"UnionValidator",()=>fm,"ValidationError",()=>fg,"Validator",()=>fj,"any",()=>fq,"array",()=>fD,"arrayOf",()=>fE,"bigint",()=>fB,"boolean",()=>fA,"dict",()=>fK,"httpUrl",()=>fX,"indexKey",()=>fY,"integer",()=>fx,"jsonDict",()=>fJ,"jsonValue",()=>fI,"linkUrl",()=>fU,"literal",()=>fC,"literalEnum",()=>fR,"model",()=>fN,"nonZeroFiniteNumber",()=>fv,"nonZeroInteger",()=>fz,"nonZeroNumber",()=>fu,"nullable",()=>fQ,"number",()=>fs,"numberUnion",()=>fM,"object",()=>fG,"optional",()=>fP,"or",()=>fZ,"positiveInteger",()=>fy,"positiveNumber",()=>ft,"setEnum",()=>fO,"srcUrl",()=>fW,"string",()=>fr,"union",()=>fL,"unitInterval",()=>fw,"unknown",()=>fp,"unknownObject",()=>fF],54540);var f$=a.i(54540);bV("@tldraw/validate","4.4.0","esm"),a.s([],255099);var f_=f$;function f0(a){return f_.string.refine(b=>{if(!b.startsWith(`${a}:`))throw Error(`${a} ID must start with "${a}:"`);return b})}let f1=f0("asset");function f2(a,b){return f_.object({id:f1,typeName:f_.literal("asset"),type:f_.literal(a),props:b,meta:f_.jsonValue})}var f_=f$;let f3=f_.object({x:f_.number,y:f_.number,z:f_.number.optional()}),f4=f_.object({x:f_.number,y:f_.number,w:f_.number,h:f_.number});var f_=f$;let f5=f_.unitInterval,f6=f_.string.refine(a=>{if(!a.startsWith("page:")&&!a.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return a}),f7=f0("shape"),f8=f0("binding");function f9(a){return`binding:${a??cs(void 0)}`}eU("com.tldraw.binding",{}),eV({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});var f_=f$;let ga=f_.object({type:f_.string,content:f_.arrayOf(f_.unknown),attrs:f_.any.optional()});function gb(a){return{type:"doc",content:a.split("\n").map(a=>a?{type:"paragraph",content:[{type:"text",text:a}]}:{type:"paragraph"})}}var f_=f$;class gc{constructor(a,b,c){this.id=a,this.defaultValue=b,this.type=c}static define(a,b){let{defaultValue:c,type:d=f_.any}=b;return new gc(a,c,d)}static defineEnum(a,b){let{defaultValue:c,values:d}=b;return new gd(a,c,d)}setDefaultValue(a){this.defaultValue=a}validate(a){return this.type.validate(a)}validateUsingKnownGoodVersion(a,b){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(a,b):this.validate(b)}}class gd extends gc{constructor(a,b,c){super(a,b,f_.literalEnum(...c)),this.values=c}}let ge=eU("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),gf=eV({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:ge.AddIsLocked,up:a=>{a.isLocked=!1},down:a=>{delete a.isLocked}},{id:ge.HoistOpacity,up:a=>{a.opacity=Number(a.props.opacity??"1"),delete a.props.opacity},down:a=>{let b=a.opacity;delete a.opacity,a.props.opacity=b<.175?"0.1":b<.375?"0.25":b<.625?"0.5":b<.875?"0.75":"1"}},{id:ge.AddMeta,up:a=>{a.meta={}}},{id:ge.AddWhite,up:a=>{},down:a=>{"white"===a.props.color&&(a.props.color="black")}}]});function gg(a){return!!a&&"shape"===a.typeName}function gh(a){return!!a&&a.startsWith("shape:")}function gi(a){return`shape:${a??cs(void 0)}`}function gj(a){let b=new Map;for(let[c,d]of Object.entries(a))if(d instanceof gc){if(b.has(d))throw Error(`Duplicate style prop ${d.id}. Each style prop can only be used once within a shape.`);b.set(d,c)}return b}function gk(a,b){return cL(b,(b,c)=>`com.tldraw.shape.${a}/${c}`)}function gl(a,b){let c=[];for(let[d,{migrations:e}]of Object.entries(b)){let b=`com.tldraw.${a}.${d}`;e?"sequenceId"in e?(cd(b===e.sequenceId,`sequenceId mismatch for ${d} ${e3} migrations. Expected '${b}', got '${e.sequenceId}'`),c.push(e)):"sequence"in e?c.push(eT({sequenceId:b,retroactive:!0,sequence:e.sequence.map(b=>"id"in b?gm(a,d,b):b)})):c.push(eT({sequenceId:b,retroactive:!0,sequence:Object.keys(e.migrators).map(a=>Number(a)).sort((a,b)=>a-b).map(c=>({id:`${b}/${c}`,scope:"record",filter:b=>b.typeName===a&&b.type===d,up:a=>{let b=e.migrators[c].up(a);if(b)return b},down:a=>{let b=e.migrators[c].down(a);if(b)return b}}))})):c.push(eT({sequenceId:b,retroactive:!0,sequence:[]}))}return c}function gm(a,b,c){return{id:c.id,dependsOn:c.dependsOn,scope:"record",filter:c=>c.typeName===a&&c.type===b,up:a=>{let b=c.up(a.props);b&&(a.props=b)},down:"function"==typeof c.down?a=>{let b=c.down(a.props);b&&(a.props=b)}:void 0}}let gn=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],go={id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",linedFill:"#363636",frameHeadingStroke:"#717171",frameHeadingFill:"#ffffff",frameStroke:"#717171",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FCE19C",noteText:"#000000",semi:"#e8e8e8",pattern:"#494949",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8205 0.05)"},blue:{solid:"#4465e9",fill:"#4465e9",linedFill:"#6580ec",frameHeadingStroke:"#6681ec",frameHeadingFill:"#f9fafe",frameStroke:"#6681ec",frameFill:"#f9fafe",frameText:"#000000",noteFill:"#8AA3FF",noteText:"#000000",semi:"#dce1f8",pattern:"#6681ee",highlightSrgb:"#10acff",highlightP3:"color(display-p3 0.308 0.6632 0.9996)"},green:{solid:"#099268",fill:"#099268",linedFill:"#0bad7c",frameHeadingStroke:"#37a684",frameHeadingFill:"#f8fcfa",frameStroke:"#37a684",frameFill:"#f8fcfa",frameText:"#000000",noteFill:"#6FC896",noteText:"#000000",semi:"#d3e9e3",pattern:"#39a785",highlightSrgb:"#00ffc8",highlightP3:"color(display-p3 0.2536 0.984 0.7981)"},grey:{solid:"#9fa8b2",fill:"#9fa8b2",linedFill:"#bbc1c9",frameHeadingStroke:"#aaaaab",frameHeadingFill:"#fbfcfc",frameStroke:"#aaaaab",frameFill:"#fcfcfd",frameText:"#000000",noteFill:"#C0CAD3",noteText:"#000000",semi:"#eceef0",pattern:"#bcc3c9",highlightSrgb:"#cbe7f1",highlightP3:"color(display-p3 0.8163 0.9023 0.9416)"},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",linedFill:"#7abaf5",frameHeadingStroke:"#6cb2f3",frameHeadingFill:"#f8fbfe",frameStroke:"#6cb2f3",frameFill:"#fafcff",frameText:"#000000",noteFill:"#9BC4FD",noteText:"#000000",semi:"#ddedfa",pattern:"#6fbbf8",highlightSrgb:"#00f4ff",highlightP3:"color(display-p3 0.1512 0.9414 0.9996)"},"light-green":{solid:"#4cb05e",fill:"#4cb05e",linedFill:"#7ec88c",frameHeadingStroke:"#6dbe7c",frameHeadingFill:"#f8fcf9",frameStroke:"#6dbe7c",frameFill:"#fafdfa",frameText:"#000000",noteFill:"#98D08A",noteText:"#000000",semi:"#dbf0e0",pattern:"#65cb78",highlightSrgb:"#65f641",highlightP3:"color(display-p3 0.563 0.9495 0.3857)"},"light-red":{solid:"#f87777",fill:"#f87777",linedFill:"#f99a9a",frameHeadingStroke:"#f89090",frameHeadingFill:"#fffafa",frameStroke:"#f89090",frameFill:"#fffbfb",frameText:"#000000",noteFill:"#F7A5A1",noteText:"#000000",semi:"#f4dadb",pattern:"#fe9e9e",highlightSrgb:"#ff7fa3",highlightP3:"color(display-p3 0.9988 0.5301 0.6397)"},"light-violet":{solid:"#e085f4",fill:"#e085f4",linedFill:"#e9abf7",frameHeadingStroke:"#e59bf5",frameHeadingFill:"#fefaff",frameStroke:"#e59bf5",frameFill:"#fefbff",frameText:"#000000",noteFill:"#DFB0F9",noteText:"#000000",semi:"#f5eafa",pattern:"#e9acf8",highlightSrgb:"#ff88ff",highlightP3:"color(display-p3 0.9676 0.5652 0.9999)"},orange:{solid:"#e16919",fill:"#e16919",linedFill:"#ea8643",frameHeadingStroke:"#e68544",frameHeadingFill:"#fef9f6",frameStroke:"#e68544",frameFill:"#fef9f6",frameText:"#000000",noteFill:"#FAA475",noteText:"#000000",semi:"#f8e2d4",pattern:"#f78438",highlightSrgb:"#ffa500",highlightP3:"color(display-p3 0.9988 0.6905 0.266)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#e75f5f",frameHeadingStroke:"#e55757",frameHeadingFill:"#fef7f7",frameStroke:"#e55757",frameFill:"#fef9f9",frameText:"#000000",noteFill:"#FC8282",noteText:"#000000",semi:"#f4dadb",pattern:"#e55959",highlightSrgb:"#ff636e",highlightP3:"color(display-p3 0.9992 0.4376 0.45)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#be68d4",frameHeadingStroke:"#bc62d3",frameHeadingFill:"#fcf7fd",frameStroke:"#bc62d3",frameFill:"#fdf9fd",frameText:"#000000",noteFill:"#DB91FD",noteText:"#000000",semi:"#ecdcf2",pattern:"#bd63d3",highlightSrgb:"#c77cff",highlightP3:"color(display-p3 0.7469 0.5089 0.9995)"},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",linedFill:"#f5c27a",frameHeadingStroke:"#f3bb6c",frameHeadingFill:"#fefcf8",frameStroke:"#f3bb6c",frameFill:"#fffdfa",frameText:"#000000",noteFill:"#FED49A",noteText:"#000000",semi:"#f9f0e6",pattern:"#fecb92",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8705 0.05)"},white:{solid:"#FFFFFF",fill:"#FFFFFF",linedFill:"#ffffff",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#7d7d7d",frameHeadingFill:"#ffffff",frameStroke:"#7d7d7d",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FFFFFF",noteText:"#000000",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}},gp={id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",linedFill:"#ffffff",frameHeadingStroke:"#5c5c5c",frameHeadingFill:"#252525",frameStroke:"#5c5c5c",frameFill:"#0c0c0c",frameText:"#f2f2f2",noteFill:"#2c2c2c",noteText:"#f2f2f2",semi:"#2c3036",pattern:"#989898",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.6225 0.0312)"},blue:{solid:"#4f72fc",fill:"#4f72fc",linedFill:"#3c5cdd",frameHeadingStroke:"#384994",frameHeadingFill:"#1C2036",frameStroke:"#384994",frameFill:"#11141f",frameText:"#f2f2f2",noteFill:"#2A3F98",noteText:"#f2f2f2",semi:"#262d40",pattern:"#3a4b9e",highlightSrgb:"#0079d2",highlightP3:"color(display-p3 0.0032 0.4655 0.7991)"},green:{solid:"#099268",fill:"#099268",linedFill:"#087856",frameHeadingStroke:"#10513C",frameHeadingFill:"#14241f",frameStroke:"#10513C",frameFill:"#0E1614",frameText:"#f2f2f2",noteFill:"#014429",noteText:"#f2f2f2",semi:"#253231",pattern:"#366a53",highlightSrgb:"#009774",highlightP3:"color(display-p3 0.0085 0.582 0.4604)"},grey:{solid:"#9398b0",fill:"#9398b0",linedFill:"#8388a5",frameHeadingStroke:"#42474D",frameHeadingFill:"#23262A",frameStroke:"#42474D",frameFill:"#151719",frameText:"#f2f2f2",noteFill:"#56595F",noteText:"#f2f2f2",semi:"#33373c",pattern:"#7c8187",highlightSrgb:"#9cb4cb",highlightP3:"color(display-p3 0.6299 0.7012 0.7856)"},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",linedFill:"#2793ec",frameHeadingStroke:"#075797",frameHeadingFill:"#142839",frameStroke:"#075797",frameFill:"#0B1823",frameText:"#f2f2f2",noteFill:"#1F5495",noteText:"#f2f2f2",semi:"#2a3642",pattern:"#4d7aa9",highlightSrgb:"#00bdc8",highlightP3:"color(display-p3 0.0023 0.7259 0.7735)"},"light-green":{solid:"#40c057",fill:"#40c057",linedFill:"#37a44b",frameHeadingStroke:"#1C5427",frameHeadingFill:"#18251A",frameStroke:"#1C5427",frameFill:"#0F1911",frameText:"#f2f2f2",noteFill:"#21581D",noteText:"#f2f2f2",semi:"#2a3830",pattern:"#4e874e",highlightSrgb:"#00a000",highlightP3:"color(display-p3 0.2711 0.6172 0.0195)"},"light-red":{solid:"#ff8787",fill:"#ff8787",linedFill:"#ff6666",frameHeadingStroke:"#6f3232",frameHeadingFill:"#341818",frameStroke:"#6f3232",frameFill:"#181212",frameText:"#f2f2f2",noteFill:"#7a3333",noteText:"#f2f2f2",semi:"#3c2b2b",pattern:"#a56767",highlightSrgb:"#db005b",highlightP3:"color(display-p3 0.7849 0.0585 0.3589)"},"light-violet":{solid:"#e599f7",fill:"#e599f7",linedFill:"#dc71f4",frameHeadingStroke:"#6c367a",frameHeadingFill:"#2D2230",frameStroke:"#6c367a",frameFill:"#1C151E",frameText:"#f2f2f2",noteFill:"#762F8E",noteText:"#f2f2f2",semi:"#383442",pattern:"#9770a9",highlightSrgb:"#c400c7",highlightP3:"color(display-p3 0.7024 0.0403 0.753)"},orange:{solid:"#f76707",fill:"#f76707",linedFill:"#f54900",frameHeadingStroke:"#773a0e",frameHeadingFill:"#2f1d13",frameStroke:"#773a0e",frameFill:"#1c1512",frameText:"#f2f2f2",noteFill:"#7c3905",noteText:"#f2f2f2",semi:"#3b2e27",pattern:"#9f552d",highlightSrgb:"#d07a00",highlightP3:"color(display-p3 0.7699 0.4937 0.0085)"},red:{solid:"#e03131",fill:"#e03131",linedFill:"#c31d1d",frameHeadingStroke:"#701e1e",frameHeadingFill:"#301616",frameStroke:"#701e1e",frameFill:"#1b1313",frameText:"#f2f2f2",noteFill:"#7e201f",noteText:"#f2f2f2",semi:"#382726",pattern:"#8f3734",highlightSrgb:"#de002c",highlightP3:"color(display-p3 0.7978 0.0509 0.2035)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",linedFill:"#8f2fa7",frameHeadingStroke:"#6d1583",frameHeadingFill:"#27152e",frameStroke:"#6d1583",frameFill:"#1b0f21",frameText:"#f2f2f2",noteFill:"#5f1c70",noteText:"#f2f2f2",semi:"#342938",pattern:"#763a8b",highlightSrgb:"#9e00ee",highlightP3:"color(display-p3 0.5651 0.0079 0.8986)"},yellow:{solid:"#ffc034",fill:"#ffc034",linedFill:"#ffae00",frameHeadingStroke:"#684e12",frameHeadingFill:"#2a2113",frameStroke:"#684e12",frameFill:"#1e1911",frameText:"#f2f2f2",noteFill:"#8a5e1c",noteText:"#f2f2f2",semi:"#3b352b",pattern:"#fecb92",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.7225 0.0312)"},white:{solid:"#f3f3f3",fill:"#f3f3f3",linedFill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#ffffff",frameHeadingFill:"#ffffff",frameStroke:"#ffffff",frameFill:"#ffffff",frameText:"#000000",noteFill:"#eaeaea",noteText:"#1d1d1d",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}};function gq(a){return a.isDarkMode?gp:go}let gr=gc.defineEnum("tldraw:color",{defaultValue:"black",values:gn}),gs=gc.defineEnum("tldraw:labelColor",{defaultValue:"black",values:gn}),gt=new Set(gn);function gu(a,b,c){return gt.has(b)?a[b][c]:b}let gv=gc.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),gw=gc.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill","lined-fill"]}),gx=gc.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),gy={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},gz=gc.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),gA=gc.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:["arc","elbow"]}),gB=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],gC=gc.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:gB}),gD=gc.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:gB}),gE={kind:gA,labelColor:gs,color:gr,fill:gw,dash:gv,size:gz,arrowheadStart:gC,arrowheadEnd:gD,font:gx,start:f3,end:f3,bend:f_.number,richText:ga,labelPosition:f_.number,scale:f_.nonZeroNumber,elbowMidPoint:f_.number},gF=gk("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6,AddRichText:7,AddRichTextAttrs:8});function gG(a){return gm("shape","arrow",a)}let gH=eT({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[gG({id:gF.AddLabelColor,up:a=>{a.labelColor="black"},down:"retired"}),gG({id:gF.AddIsPrecise,up:({start:a,end:b})=>{"binding"===a.type&&(a.isPrecise=.5!==a.normalizedAnchor.x||.5!==a.normalizedAnchor.y),"binding"===b.type&&(b.isPrecise=.5!==b.normalizedAnchor.x||.5!==b.normalizedAnchor.y)},down:({start:a,end:b})=>{"binding"===a.type&&(a.isPrecise||(a.normalizedAnchor={x:.5,y:.5}),delete a.isPrecise),"binding"===b.type&&(b.isPrecise||(b.normalizedAnchor={x:.5,y:.5}),delete b.isPrecise)}}),gG({id:gF.AddLabelPosition,up:a=>{a.labelPosition=.5},down:a=>{delete a.labelPosition}}),{id:gF.ExtractBindings,scope:"storage",up:a=>{let b=[];for(let c of a.values()){if("shape"!==c.typeName||"arrow"!==c.type)continue;let a=dk(c),{start:d,end:e}=c.props;if("binding"===d.type){let e=f9(),f={typeName:"binding",id:e,type:"arrow",fromId:c.id,toId:d.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:d.normalizedAnchor,isExact:d.isExact,isPrecise:d.isPrecise}};b.push([e,f]),a.props.start={x:0,y:0}}else delete a.props.start.type;if("binding"===e.type){let d=f9(),f={typeName:"binding",id:d,type:"arrow",fromId:c.id,toId:e.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:e.normalizedAnchor,isExact:e.isExact,isPrecise:e.isPrecise}};b.push([d,f]),a.props.end={x:0,y:0}}else delete a.props.end.type;b.push([c.id,a])}for(let[c,d]of b)a.set(c,d)}},gG({id:gF.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}),gG({id:gF.AddElbow,up:a=>{a.kind="arc",a.elbowMidPoint=.5},down:a=>{delete a.kind,delete a.elbowMidPoint}}),gG({id:gF.AddRichText,up:a=>{a.richText=gb(a.text),delete a.text}}),gG({id:gF.AddRichTextAttrs,up:a=>{},down:a=>{a.richText&&"attrs"in a.richText&&delete a.richText.attrs}})]}),gI=f_.literalEnum("center","edge-point","edge","none"),gJ={terminal:f_.literalEnum("start","end"),normalizedAnchor:f3,isExact:f_.boolean,isPrecise:f_.boolean,snap:gI},gK=cL({AddSnap:1},(a,b)=>`com.tldraw.binding.arrow/${b}`),gL={sequence:[{dependsOn:[gF.ExtractBindings]},{id:gK.AddSnap,up:a=>{a.snap="none"},down:a=>{delete a.snap}}]};var f_=f$;let gM=f_.model("camera",f_.object({typeName:f_.literal("camera"),id:f0("camera"),x:f_.number,y:f_.number,z:f_.number,meta:f_.jsonValue})),gN=eV({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:eU("com.tldraw.camera",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),gO=e4("camera",{validator:gM,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}}));var f_=f$;let gP=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),gQ=f_.setEnum(gP),gR=f_.object({type:gQ,rotation:f_.number});var f_=f$;let gS=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),gT=f_.setEnum(gS),gU=new Set(["starting","paused","active","complete","stopping"]),gV=f_.object({id:f_.string,points:f_.arrayOf(f3),size:f_.positiveNumber,color:gT,opacity:f_.number,state:f_.setEnum(gU),delay:f_.number,shrink:f_.number,taper:f_.boolean});var f_=f$;let gW=f0("page"),gX=f_.model("page",f_.object({typeName:f_.literal("page"),id:gW,name:f_.string,index:f_.indexKey,meta:f_.jsonValue})),gY=eV({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:eU("com.tldraw.page",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),gZ=e4("page",{validator:gX,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function g$(a){return gZ.isId(a)}let g_={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1,cameraState:!1};function g0(a){return a?cK(a,a=>g_[a]):null}f0("instance");let g1=eU("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25,AddCameraState:26}),g2=eV({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:g1.AddTransparentExportBgs,up:a=>({...a,exportBackground:!0})},{id:g1.RemoveDialog,up:({dialog:a,...b})=>b},{id:g1.AddToolLockMode,up:a=>({...a,isToolLocked:!1})},{id:g1.RemoveExtraPropsForNextShape,up:({propsForNextShape:a,...b})=>({...b,propsForNextShape:Object.fromEntries(Object.entries(a).filter(([a])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(a)))})},{id:g1.AddLabelColor,up:({propsForNextShape:a,...b})=>({...b,propsForNextShape:{...a,labelColor:"black"}})},{id:g1.AddFollowingUserId,up:a=>({...a,followingUserId:null})},{id:g1.RemoveAlignJustify,up:a=>{let b=a.propsForNextShape.align;return"justify"===b&&(b="start"),{...a,propsForNextShape:{...a.propsForNextShape,align:b}}}},{id:g1.AddZoom,up:a=>({...a,zoomBrush:null})},{id:g1.AddVerticalAlign,up:a=>({...a,propsForNextShape:{...a.propsForNextShape,verticalAlign:"middle"}})},{id:g1.AddScribbleDelay,up:a=>null!==a.scribble?{...a,scribble:{...a.scribble,delay:0}}:{...a}},{id:g1.RemoveUserId,up:({userId:a,...b})=>b},{id:g1.AddIsPenModeAndIsGridMode,up:a=>({...a,isPenMode:!1,isGridMode:!1})},{id:g1.HoistOpacity,up:({propsForNextShape:{opacity:a,...b},...c})=>({...c,opacityForNextShape:Number(a??"1"),propsForNextShape:b})},{id:g1.AddChat,up:a=>({...a,chatMessage:"",isChatting:!1})},{id:g1.AddHighlightedUserIds,up:a=>({...a,highlightedUserIds:[]})},{id:g1.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:a,...b})=>({...b,stylesForNextShape:{}})},{id:g1.AddMeta,up:a=>({...a,meta:{}})},{id:g1.RemoveCursorColor,up:a=>{let{color:b,...c}=a.cursor;return{...a,cursor:c}}},{id:g1.AddLonelyProperties,up:a=>({...a,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:g1.ReadOnlyReadonly,up:({isReadOnly:a,...b})=>({...b,isReadonly:a})},{id:g1.AddHoveringCanvas,up:a=>({...a,isHoveringCanvas:null})},{id:g1.AddScribbles,up:({scribble:a,...b})=>({...b,scribbles:[]})},{id:g1.AddInset,up:a=>({...a,insets:[!1,!1,!1,!1]}),down:({insets:a,...b})=>({...b})},{id:g1.AddDuplicateProps,up:a=>({...a,duplicateProps:null}),down:({duplicateProps:a,...b})=>({...b})},{id:g1.RemoveCanMoveCamera,up:({canMoveCamera:a,...b})=>({...b}),down:a=>({...a,canMoveCamera:!0})},{id:g1.AddCameraState,up:a=>({...a,cameraState:"idle"}),down:({cameraState:a,...b})=>b}]}),g3="instance:instance";var f_=f$;let g4=f_.model("instance_page_state",f_.object({typeName:f_.literal("instance_page_state"),id:f0("instance_page_state"),pageId:gW,selectedShapeIds:f_.arrayOf(f7),hintingShapeIds:f_.arrayOf(f7),erasingShapeIds:f_.arrayOf(f7),hoveredShapeId:f7.nullable(),editingShapeId:f7.nullable(),croppingShapeId:f7.nullable(),focusedGroupId:f7.nullable(),meta:f_.jsonValue})),g5=eU("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),g6=eV({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:g5.AddCroppingId,up(a){a.croppingShapeId=null}},{id:g5.RemoveInstanceIdAndCameraId,up(a){delete a.instanceId,delete a.cameraId}},{id:g5.AddMeta,up:a=>{a.meta={}}},{id:g5.RenameProperties,up:a=>{},down:a=>{}},{id:g5.RenamePropertiesAgain,up:a=>{a.selectedShapeIds=a.selectedIds,delete a.selectedIds,a.hintingShapeIds=a.hintingIds,delete a.hintingIds,a.erasingShapeIds=a.erasingIds,delete a.erasingIds,a.hoveredShapeId=a.hoveredId,delete a.hoveredId,a.editingShapeId=a.editingId,delete a.editingId,a.croppingShapeId=a.croppingShapeId??a.croppingId??null,delete a.croppingId,a.focusedGroupId=a.focusLayerId,delete a.focusLayerId},down:a=>{a.selectedIds=a.selectedShapeIds,delete a.selectedShapeIds,a.hintingIds=a.hintingShapeIds,delete a.hintingShapeIds,a.erasingIds=a.erasingShapeIds,delete a.erasingShapeIds,a.hoveredId=a.hoveredShapeId,delete a.hoveredShapeId,a.editingId=a.editingShapeId,delete a.editingShapeId,a.croppingId=a.croppingShapeId,delete a.croppingShapeId,a.focusLayerId=a.focusedGroupId,delete a.focusedGroupId}}]}),g7=e4("instance_page_state",{validator:g4,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}));var f_=f$;let g8=f_.model("pointer",f_.object({typeName:f_.literal("pointer"),id:f0("pointer"),x:f_.number,y:f_.number,lastActivityTimestamp:f_.number,meta:f_.jsonValue})),g9=eV({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:eU("com.tldraw.pointer",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),ha=e4("pointer",{validator:g8,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),hb=ha.createId("pointer");var f_=f$;let hc=f_.model("instance_presence",f_.object({typeName:f_.literal("instance_presence"),id:f0("instance_presence"),userId:f_.string,userName:f_.string,lastActivityTimestamp:f_.number.nullable(),followingUserId:f_.string.nullable(),cursor:f_.object({x:f_.number,y:f_.number,type:gQ,rotation:f_.number}).nullable(),color:f_.string,camera:f_.object({x:f_.number,y:f_.number,z:f_.number}).nullable(),screenBounds:f4.nullable(),selectedShapeIds:f_.arrayOf(f0("shape")),currentPageId:f0("page"),brush:f4.nullable(),scribbles:f_.arrayOf(gV),chatMessage:f_.string,meta:f_.jsonValue})),hd=eU("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),he=eV({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:hd.AddScribbleDelay,up:a=>{null!==a.scribble&&(a.scribble.delay=0)}},{id:hd.RemoveInstanceId,up:a=>{delete a.instanceId}},{id:hd.AddChatMessage,up:a=>{a.chatMessage=""}},{id:hd.AddMeta,up:a=>{a.meta={}}},{id:hd.RenameSelectedShapeIds,up:a=>{}},{id:hd.NullableCameraCursor,up:a=>{},down:a=>{null===a.camera&&(a.camera={x:0,y:0,z:1}),null===a.lastActivityTimestamp&&(a.lastActivityTimestamp=0),null===a.cursor&&(a.cursor={type:"default",x:0,y:0,rotation:0}),null===a.screenBounds&&(a.screenBounds={x:0,y:0,w:1,h:1})}}]}),hf=e4("instance_presence",{validator:hc,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}));var f_=f$;let hg=f_.model("document",f_.object({typeName:f_.literal("document"),id:f_.literal("document:document"),gridSize:f_.number,name:f_.string,meta:f_.jsonValue})),hh=eU("com.tldraw.document",{AddName:1,AddMeta:2}),hi=eV({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:hh.AddName,up:a=>{a.name=""},down:a=>{delete a.name}},{id:hh.AddMeta,up:a=>{a.meta={}}}]}),hj=e4("document",{validator:hg,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),hk=hj.createId("document");function hl(a){"asset"===a.typeName&&("src"in a&&(a.src="<redacted>"),"src"in a.props&&(a.props.src="<redacted>"))}function hm({error:a,phase:b,record:c,recordBefore:d}){throw cl(a,{tags:{origin:"store.validateRecord",storePhase:b,isExistingValidationIssue:"initialize"===b},extras:{recordBefore:d?hl(dk(d)):void 0,recordAfter:hl(dk(c))}}),a}function hn(a){let b=a.query.ids("page"),c=a.query.records("instance_page_state"),d=()=>{if(!a.has(hk))return a.put([hj.create({id:hk,name:a.props.defaultName})]),d();if(!a.has(hb))return a.put([ha.create({id:hb})]),d();let e=b.get();if(0===e.size)return a.put([gZ.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),d();let f=()=>[...e].map(b=>a.get(b)).sort(c6)[0].id,g=a.get(g3);if(!g)return a.put([a.schema.types.instance.create({id:g3,currentPageId:f(),exportBackground:!0})]),d();if(!e.has(g.currentPageId))return a.put([{...g,currentPageId:f()}]),d();let h=new Set,i=new Set;for(let b of e){let c=g7.createId(b);a.get(c)||h.add(c);let d=gO.createId(b);a.has(d)||i.add(d)}for(let b of(h.size>0&&a.put([...h].map(a=>g7.create({id:a,pageId:g7.parseId(a)}))),i.size>0&&a.put([...i].map(a=>gO.create({id:a}))),c.get())){if(!e.has(b.pageId)){a.remove([b.id]);continue}if(b.croppingShapeId&&!a.has(b.croppingShapeId))return a.put([{...b,croppingShapeId:null}]),d();if(b.focusedGroupId&&!a.has(b.focusedGroupId))return a.put([{...b,focusedGroupId:null}]),d();if(b.hoveredShapeId&&!a.has(b.hoveredShapeId))return a.put([{...b,hoveredShapeId:null}]),d();let c=b.selectedShapeIds.filter(b=>a.has(b));if(c.length!==b.selectedShapeIds.length)return a.put([{...b,selectedShapeIds:c}]),d();let f=b.hintingShapeIds.filter(b=>a.has(b));if(f.length!==b.hintingShapeIds.length)return a.put([{...b,hintingShapeIds:f}]),d();let g=b.erasingShapeIds.filter(b=>a.has(b));if(g.length!==b.erasingShapeIds.length)return a.put([{...b,erasingShapeIds:g}]),d()}};return d}var f_=f$;let ho=f2("bookmark",f_.object({title:f_.string,description:f_.string,image:f_.string,favicon:f_.string,src:f_.srcUrl.nullable()})),hp=eU("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),hq=eV({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:a=>"bookmark"===a.type,sequence:[{id:hp.MakeUrlsValid,up:a=>{f_.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:hp.AddFavicon,up:a=>{f_.srcUrl.isValid(a.props.favicon)||(a.props.favicon="")},down:a=>{delete a.props.favicon}}]});var f_=f$;let hr=f2("image",f_.object({w:f_.number,h:f_.number,name:f_.string,isAnimated:f_.boolean,mimeType:f_.string.nullable(),src:f_.srcUrl.nullable(),fileSize:f_.nonZeroNumber.optional()})),hs=eU("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),ht=eV({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:a=>"image"===a.type,sequence:[{id:hs.AddIsAnimated,up:a=>{a.props.isAnimated=!1},down:a=>{delete a.props.isAnimated}},{id:hs.RenameWidthHeight,up:a=>{a.props.w=a.props.width,a.props.h=a.props.height,delete a.props.width,delete a.props.height},down:a=>{a.props.width=a.props.w,a.props.height=a.props.h,delete a.props.w,delete a.props.h}},{id:hs.MakeUrlsValid,up:a=>{f_.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:hs.AddFileSize,up:a=>{a.props.fileSize=-1},down:a=>{delete a.props.fileSize}},{id:hs.MakeFileSizeOptional,up:a=>{-1===a.props.fileSize&&(a.props.fileSize=void 0)},down:a=>{void 0===a.props.fileSize&&(a.props.fileSize=-1)}}]});var f_=f$;let hu=f2("video",f_.object({w:f_.number,h:f_.number,name:f_.string,isAnimated:f_.boolean,mimeType:f_.string.nullable(),src:f_.srcUrl.nullable(),fileSize:f_.number.optional()})),hv=eU("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),hw=eV({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:a=>"video"===a.type,sequence:[{id:hv.AddIsAnimated,up:a=>{a.props.isAnimated=!1},down:a=>{delete a.props.isAnimated}},{id:hv.RenameWidthHeight,up:a=>{a.props.w=a.props.width,a.props.h=a.props.height,delete a.props.width,delete a.props.height},down:a=>{a.props.width=a.props.w,a.props.height=a.props.h,delete a.props.w,delete a.props.h}},{id:hv.MakeUrlsValid,up:a=>{f_.srcUrl.isValid(a.props.src)||(a.props.src="")},down:a=>{}},{id:hv.AddFileSize,up:a=>{a.props.fileSize=-1},down:a=>{delete a.props.fileSize}},{id:hv.MakeFileSizeOptional,up:a=>{-1===a.props.fileSize&&(a.props.fileSize=void 0)},down:a=>{void 0===a.props.fileSize&&(a.props.fileSize=-1)}}]});var f_=f$;let hx=f_.model("asset",f_.union("type",{image:hr,video:hu,bookmark:ho})),hy=eV({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:eU("com.tldraw.asset",{AddMeta:1}).AddMeta,up:a=>{a.meta={}}}]}),hz=e4("asset",{validator:hx,scope:"document"}).withDefaultProperties(()=>({meta:{}}));var f_=f$;let hA={w:f_.nonZeroNumber,h:f_.nonZeroNumber,assetId:f1.nullable(),url:f_.linkUrl},hB=gk("bookmark",{NullAssetId:1,MakeUrlsValid:2}),hC={sequence:[{id:hB.NullAssetId,up:a=>{void 0===a.assetId&&(a.assetId=null)},down:"retired"},{id:hB.MakeUrlsValid,up:a=>{f_.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}}]};var f_=f$;let hD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hE=new Uint8Array(128);for(let a=0;a<64;a++)hE[hD.charCodeAt(a)]=a;let hF=new Float64Array(31);for(let a=0;a<31;a++)hF[a]=Math.pow(2,a-15);let hG=6103515625e-14/1024,hH=new Float64Array(1024);for(let a=0;a<1024;a++)hH[a]=1+a/1024;let hI="function"==typeof DataView.prototype.getFloat16?function(a,b){return a.getFloat16(b,!0)}:function(a,b){return function(a){let b=a>>15,c=a>>10&31,d=1023&a;if(0===c)return b?-d*hG:d*hG;if(31===c)return d?NaN:b?-1/0:1/0;let e=hF[c]*hH[d];return b?-e:e}(a.getUint16(b,!0))},hJ="function"==typeof DataView.prototype.setFloat16?function(a,b,c){a.setFloat16(b,c,!0)}:function(a,b,c){a.setUint16(b,function(a){if(0===a)return 32768*!!Object.is(a,-0);if(!Number.isFinite(a))return Number.isNaN(a)?32256:a>0?31744:64512;let b=+(a<0),c=Math.floor(Math.log2(a=Math.abs(a))),d=c+15;if(d>=31)return b<<15|31744;if(d<=0)return b<<15|1023&Math.round(16384*a*1024);let e=Math.round(1024*(a/Math.pow(2,c)-1));return e>=1024&&(e=0,++d>=31)?b<<15|31744:b<<15|d<<10|e}(c),!0)},hK="function"==typeof Uint8Array.prototype.toBase64?function(a){return a.toBase64()}:function(a){cd(a.length%3==0,"Uint8Array length must be a multiple of 3");let b="";for(let c=0;c<a.length;c+=3){let d=a[c]<<16|a[c+1]<<8|a[c+2];b+=hD[d>>18&63]+hD[d>>12&63]+hD[d>>6&63]+hD[63&d]}return b},hL="function"==typeof Uint8Array.fromBase64?function(a){return Uint8Array.fromBase64(a)}:function(a){let b=new Uint8Array(Math.floor(3*a.length/4)),c=0;for(let d=0;d<a.length;d+=4){let e=hE[a.charCodeAt(d)]<<18|hE[a.charCodeAt(d+1)]<<12|hE[a.charCodeAt(d+2)]<<6|hE[a.charCodeAt(d+3)];b[c++]=e>>16&255,b[c++]=e>>8&255,b[c++]=255&e}return b};class hM{static _legacyEncodePoint(a,b,c){let d=new Uint8Array(6),e=new DataView(d.buffer);return hJ(e,0,a),hJ(e,2,b),hJ(e,4,c),hK(d)}static _legacyEncodePoints(a){if(0===a.length)return"";let b=new Uint8Array(6*a.length),c=new DataView(b.buffer);for(let b=0;b<a.length;b++){let d=a[b],e=6*b;hJ(c,e,d.x),hJ(c,e+2,d.y),hJ(c,e+4,d.z??.5)}return hK(b)}static _legacyDecodePoints(a){let b=hL(a),c=new DataView(b.buffer,b.byteOffset,b.byteLength),d=[];for(let a=0;a<b.length;a+=6)d.push({x:hI(c,a),y:hI(c,a+2),z:hI(c,a+4)});return d}static encodePoints(a){if(0===a.length)return"";let b=new Uint8Array(12+(a.length-1)*6),c=new DataView(b.buffer),d=a[0];c.setFloat32(0,d.x,!0),c.setFloat32(4,d.y,!0),c.setFloat32(8,d.z??.5,!0);let e=d.x,f=d.y,g=d.z??.5;for(let b=1;b<a.length;b++){let d=a[b],h=d.z??.5,i=12+(b-1)*6;hJ(c,i,d.x-e),hJ(c,i+2,d.y-f),hJ(c,i+4,h-g),e=d.x,f=d.y,g=h}return hK(b)}static decodePoints(a){if(0===a.length)return[];let b=hL(a),c=new DataView(b.buffer,b.byteOffset,b.byteLength),d=[],e=c.getFloat32(0,!0),f=c.getFloat32(4,!0),g=c.getFloat32(8,!0);d.push({x:e,y:f,z:g});for(let a=12;a<b.length;a+=6)e+=hI(c,a),f+=hI(c,a+2),d.push({x:e,y:f,z:g+=hI(c,a+4)});return d}static decodeFirstPoint(a){if(a.length<16)return null;let b=hL(a.slice(0,16)),c=new DataView(b.buffer,b.byteOffset,b.byteLength);return{x:c.getFloat32(0,!0),y:c.getFloat32(4,!0),z:c.getFloat32(8,!0)}}static decodeLastPoint(a){if(a.length<16)return null;let b=hL(a),c=new DataView(b.buffer,b.byteOffset,b.byteLength),d=c.getFloat32(0,!0),e=c.getFloat32(4,!0),f=c.getFloat32(8,!0);for(let a=12;a<b.length;a+=6)d+=hI(c,a),e+=hI(c,a+2),f+=hI(c,a+4);return{x:d,y:e,z:f}}}let hN=f_.object({type:f_.literalEnum("free","straight"),path:f_.string}),hO={color:gr,fill:gw,dash:gv,size:gz,segments:f_.arrayOf(hN),isComplete:f_.boolean,isClosed:f_.boolean,isPen:f_.boolean,scale:f_.nonZeroNumber,scaleX:f_.nonZeroFiniteNumber,scaleY:f_.nonZeroFiniteNumber},hP=gk("draw",{AddInPen:1,AddScale:2,Base64:3,LegacyPointsConversion:4}),hQ={sequence:[{id:hP.AddInPen,up:a=>{let{points:b}=a.segments[0];if(0===b.length){a.isPen=!1;return}let c=0!==b[0].z&&.5!==b[0].z;b[1]&&(c=c&&0!==b[1].z&&.5!==b[1].z),a.isPen=c},down:"retired"},{id:hP.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:hP.Base64,up:a=>{a.segments=a.segments.map(a=>{if(void 0!==a.path)return a;let{points:b,...c}=a,d=Array.isArray(b)?b:hM._legacyDecodePoints(b);return{...c,path:hM.encodePoints(d)}}),a.scaleX=a.scaleX??1,a.scaleY=a.scaleY??1},down:a=>{a.segments=a.segments.map(a=>{let{path:b,...c}=a;return{...c,points:hM.decodePoints(b)}}),delete a.scaleX,delete a.scaleY}},{id:hP.LegacyPointsConversion,up:a=>{a.segments=a.segments.map(a=>{if(void 0!==a.path)return a;let{points:b,...c}=a,d=Array.isArray(b)?b:hM._legacyDecodePoints(b);return{...c,path:hM.encodePoints(d)}})},down:a=>{}}]};var f_=f$;let hR=/(^\/r\/[^/]+\/?$)/,hS=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(hR))return a}},{hostnames:["figma.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/?$/)){let a=b.searchParams.get("url");if(a)return a}}},{hostnames:["google.*"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&b.searchParams.has("center")&&b.searchParams.get("zoom")){let a=b.searchParams.get("zoom"),[c,d]=b.searchParams.get("center").split(",");return`https://www.google.com/maps/@${c},${d},${a}z`}}},{hostnames:["val.town"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/embed\/(.+)\/?/);if(c)return`https://www.val.town/v/${c[1]}`}},{hostnames:["codesandbox.io"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/embed\/([^/]+)\/?/);if(c)return`https://codesandbox.io/s/${c[1]}`}},{hostnames:["codepen.io"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/pen/${d}`}}},{hostnames:["scratch.mit.edu"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=a.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/${c}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&"youtube.com"===b.hostname.replace(/^www./,"")){let a=b.pathname.match(/^\/embed\/([^/]+)\/?/);if(a)return`https://www.youtube.com/watch?v=${a[1]}`}}},{hostnames:["calendar.google.*"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a),c=b?.searchParams.get("src");if(b?.pathname.match(/\/calendar\/embed/)&&c){for(let a of(b.pathname="/calendar/u/0",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("cid",c),b.href}}},{hostnames:["docs.google.*"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/embed\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/embed$/,"/pub"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}}},{hostnames:["gist.github.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!a.split("/").pop())return;return a}}},{hostnames:["replit.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/)&&b.searchParams.has("embed"))return b.searchParams.delete("embed"),b.href}},{hostnames:["felt.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/map\//))return b.pathname=b.pathname.replace(/^\/embed/,""),b.href}},{hostnames:["open.spotify.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/(artist|album)\//))return b.origin+b.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&"player.vimeo.com"===b.hostname){let a=b.pathname.match(/^\/video\/([^/]+)\/?$/);if(a)return"https://vimeo.com/"+a[1]}}},{hostnames:["observablehq.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);return b&&b.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","")}#cell-*`:b&&b.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","/d")}#cell-*`:void 0}},{hostnames:["desmos.com"],canEditWhileLocked:!0,fromEmbedUrl:a=>{let b=dh(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===b.search&&""===b.hash)return a.replace("?embed","")}}],hT={w:f_.nonZeroNumber,h:f_.nonZeroNumber,url:f_.string},hU=gk("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),hV={sequence:[{id:hU.GenOriginalUrlInEmbed,up:a=>{try{let b,c=a.url,d=new URL(c).host.replace("www.","");for(let a of hS)if(a.hostnames.includes(d))try{b=a.fromEmbedUrl(c)}catch(a){console.warn(a)}a.tmpOldUrl=a.url,a.url=b??""}catch{a.url="",a.tmpOldUrl=a.url}},down:"retired"},{id:hU.RemoveDoesResize,up:a=>{delete a.doesResize},down:"retired"},{id:hU.RemoveTmpOldUrl,up:a=>{delete a.tmpOldUrl},down:"retired"},{id:hU.RemovePermissionOverrides,up:a=>{delete a.overridePermissions},down:"retired"}]};var f_=f$;let hW={w:f_.nonZeroNumber,h:f_.nonZeroNumber,name:f_.string,color:f_.literalEnum(...gr.values)},hX={sequence:[{id:gk("frame",{AddColorProp:1}).AddColorProp,up:a=>{a.color="black"},down:a=>{delete a.color}}]};var f_=f$;let hY=gc.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),hZ=gc.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),h$=gc.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),h_={geo:h$,dash:gv,url:f_.linkUrl,w:f_.nonZeroNumber,h:f_.nonZeroNumber,growY:f_.positiveNumber,scale:f_.nonZeroNumber,labelColor:gs,color:gr,fill:gw,size:gz,font:gx,align:hY,verticalAlign:hZ,richText:ga},h0=gk("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10,AddRichTextAttrs:11}),h1={sequence:[{id:h0.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:h0.AddLabelColor,up:a=>{a.labelColor="black"},down:"retired"},{id:h0.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:h0.AddCheckBox,up:a=>{},down:"retired"},{id:h0.AddVerticalAlign,up:a=>{a.verticalAlign="middle"},down:"retired"},{id:h0.MigrateLegacyAlign,up:a=>{let b;switch(a.align){case"start":b="start-legacy";break;case"end":b="end-legacy";break;default:b="middle-legacy"}a.align=b},down:"retired"},{id:h0.AddCloud,up:a=>{},down:"retired"},{id:h0.MakeUrlsValid,up:a=>{f_.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:h0.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:h0.AddRichText,up:a=>{a.richText=gb(a.text),delete a.text}},{id:h0.AddRichTextAttrs,up:a=>{},down:a=>{a.richText&&"attrs"in a.richText&&delete a.richText.attrs}}]},h2={},h3={sequence:[]};var f_=f$;let h4={color:gr,size:gz,segments:f_.arrayOf(hN),isComplete:f_.boolean,isPen:f_.boolean,scale:f_.nonZeroNumber,scaleX:f_.nonZeroFiniteNumber,scaleY:f_.nonZeroFiniteNumber},h5=gk("highlight",{AddScale:1,Base64:2,LegacyPointsConversion:3}),h6={sequence:[{id:h5.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:h5.Base64,up:a=>{a.segments=a.segments.map(a=>{if(void 0!==a.path)return a;let{points:b,...c}=a,d=Array.isArray(b)?b:hM._legacyDecodePoints(b);return{...c,path:hM.encodePoints(d)}}),a.scaleX=a.scaleX??1,a.scaleY=a.scaleY??1},down:a=>{a.segments=a.segments.map(a=>{let{path:b,...c}=a;return{...c,points:hM.decodePoints(b)}}),delete a.scaleX,delete a.scaleY}},{id:h5.LegacyPointsConversion,up:a=>{a.segments=a.segments.map(a=>{if(void 0!==a.path)return a;let{points:b,...c}=a,d=Array.isArray(b)?b:hM._legacyDecodePoints(b);return{...c,path:hM.encodePoints(d)}})},down:a=>{}}]};var f_=f$;let h7=f_.object({topLeft:f3,bottomRight:f3,isCircle:f_.boolean.optional()}),h8={w:f_.nonZeroNumber,h:f_.nonZeroNumber,playing:f_.boolean,url:f_.linkUrl,assetId:f1.nullable(),crop:h7.nullable(),flipX:f_.boolean,flipY:f_.boolean,altText:f_.string},h9=gk("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),ia={sequence:[{id:h9.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:h9.AddCropProp,up:a=>{a.crop=null},down:a=>{delete a.crop}},{id:h9.MakeUrlsValid,up:a=>{f_.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:h9.AddFlipProps,up:a=>{a.flipX=!1,a.flipY=!1},down:a=>{delete a.flipX,delete a.flipY}},{id:h9.AddAltText,up:a=>{a.altText=""},down:a=>{delete a.altText}}]};var f_=f$;let ib=gc.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),ic=f_.object({id:f_.string,index:f_.indexKey,x:f_.number,y:f_.number}),id={color:gr,dash:gv,size:gz,spline:ib,points:f_.dict(f_.string,ic),scale:f_.nonZeroNumber},ie=gk("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),ig={sequence:[{id:ie.AddSnapHandles,up:a=>{for(let b of Object.values(a.handles))b.canSnap=!0},down:"retired"},{id:ie.RemoveExtraHandleProps,up:a=>{a.handles=cJ(Object.values(a.handles).map(a=>[a.index,{x:a.x,y:a.y}]))},down:a=>{let b=Object.entries(a.handles).map(([a,b])=>({index:a,...b})).sort(c6);a.handles=Object.fromEntries(b.map((a,c)=>{let d=0===c?"start":c===b.length-1?"end":`handle:${a.index}`;return[d,{id:d,type:"vertex",canBind:!1,canSnap:!0,index:a.index,x:a.x,y:a.y}]}))}},{id:ie.HandlesToPoints,up:a=>{let b=Object.entries(a.handles).map(([a,{x:b,y:c}])=>({x:b,y:c,index:a})).sort(c6);a.points=b.map(({x:a,y:b})=>({x:a,y:b})),delete a.handles},down:a=>{let b=c5(a.points.length);a.handles=Object.fromEntries(a.points.map((a,c)=>[b[c],{x:a.x,y:a.y}])),delete a.points}},{id:ie.PointIndexIds,up:a=>{let b=c5(a.points.length);a.points=Object.fromEntries(a.points.map((a,c)=>{let d=b[c];return[d,{id:d,index:d,x:a.x,y:a.y}]}))},down:a=>{let b=Object.values(a.points).sort(c6);a.points=b.map(({x:a,y:b})=>({x:a,y:b}))}},{id:ie.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}}]};var f_=f$;let ih={color:gr,labelColor:gs,size:gz,font:gx,fontSizeAdjustment:f_.positiveNumber,align:hY,verticalAlign:hZ,growY:f_.positiveNumber,url:f_.linkUrl,richText:ga,scale:f_.nonZeroNumber},ii=gk("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9,AddRichTextAttrs:10}),ij={sequence:[{id:ii.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:ii.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:ii.MigrateLegacyAlign,up:a=>{switch(a.align){case"start":a.align="start-legacy";return;case"end":a.align="end-legacy";return;default:a.align="middle-legacy";return}},down:"retired"},{id:ii.AddVerticalAlign,up:a=>{a.verticalAlign="middle"},down:"retired"},{id:ii.MakeUrlsValid,up:a=>{f_.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:ii.AddFontSizeAdjustment,up:a=>{a.fontSizeAdjustment=0},down:a=>{delete a.fontSizeAdjustment}},{id:ii.AddScale,up:a=>{a.scale=1},down:a=>{delete a.scale}},{id:ii.AddLabelColor,up:a=>{a.labelColor="black"},down:a=>{delete a.labelColor}},{id:ii.AddRichText,up:a=>{a.richText=gb(a.text),delete a.text}},{id:ii.AddRichTextAttrs,up:a=>{},down:a=>{a.richText&&"attrs"in a.richText&&delete a.richText.attrs}}]};var f_=f$;let ik=gc.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),il={color:gr,size:gz,font:gx,textAlign:ik,w:f_.nonZeroNumber,richText:ga,scale:f_.nonZeroNumber,autoSize:f_.boolean},im=gk("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3,AddRichTextAttrs:4}),io={sequence:[{id:im.RemoveJustify,up:a=>{"justify"===a.align&&(a.align="start")},down:"retired"},{id:im.AddTextAlign,up:a=>{a.textAlign=a.align,delete a.align},down:a=>{a.align=a.textAlign,delete a.textAlign}},{id:im.AddRichText,up:a=>{a.richText=gb(a.text),delete a.text}},{id:im.AddRichTextAttrs,up:a=>{},down:a=>{a.richText&&"attrs"in a.richText&&delete a.richText.attrs}}]};var f_=f$;let ip={w:f_.nonZeroNumber,h:f_.nonZeroNumber,time:f_.number,playing:f_.boolean,autoplay:f_.boolean,url:f_.linkUrl,assetId:f1.nullable(),altText:f_.string},iq=gk("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),ir={sequence:[{id:iq.AddUrlProp,up:a=>{a.url=""},down:"retired"},{id:iq.MakeUrlsValid,up:a=>{f_.linkUrl.isValid(a.url)||(a.url="")},down:a=>{}},{id:iq.AddAltText,up:a=>{a.altText=""},down:a=>{delete a.altText}},{id:iq.AddAutoplay,up:a=>{a.autoplay=!0},down:a=>{delete a.autoplay}}]},is=eU("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4,FixIndexKeys:5}),it=eT({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:is.RemoveCodeAndIconShapeTypes,scope:"storage",up:a=>{for(let[b,c]of a.entries())"shape"===c.typeName&&"type"in c&&("icon"===c.type||"code"===c.type)&&a.delete(b)}},{id:is.AddInstancePresenceType,scope:"storage",up(a){}},{id:is.RemoveTLUserAndPresenceAndAddPointer,scope:"storage",up:a=>{for(let[b,c]of a.entries())c.typeName.match(/^(user|user_presence)$/)&&a.delete(b)}},{id:is.RemoveUserDocument,scope:"storage",up:a=>{for(let[b,c]of a.entries())c.typeName.match("user_document")&&a.delete(b)}},{id:is.FixIndexKeys,scope:"record",up:a=>{if(["shape","page"].includes(a.typeName)&&"index"in a&&(a.index.endsWith("0")&&"a0"!==a.index&&(a.index=a.index.slice(0,-1)+iw(3)),"shape"===a.typeName&&"line"===a.type))for(let[b,c]of cI(a.props.points))c.index.endsWith("0")&&"a0"!==c.index&&(c.index=c.index.slice(0,-1)+iw(3))},down:()=>{}}]}),iu="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",iv=()=>iu.charAt(Math.floor(Math.random()*iu.length)),iw=a=>Array.from({length:a},iv).join(""),ix={arrow:{migrations:gH,props:gE},bookmark:{migrations:hC,props:hA},draw:{migrations:hQ,props:hO},embed:{migrations:hV,props:hT},frame:{migrations:hX,props:hW},geo:{migrations:h1,props:h_},group:{migrations:h3,props:h2},highlight:{migrations:h6,props:h4},image:{migrations:ia,props:h8},line:{migrations:ig,props:id},note:{migrations:ij,props:ih},text:{migrations:io,props:il},video:{migrations:ir,props:ip}},iy={arrow:{migrations:gL,props:gJ}},iz=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"el",label:"Ελληνικά"},{locale:"ru",label:"Русский"},{locale:"uk",label:"Українська"},{locale:"he",label:"עברית"},{locale:"ur",label:"اردو"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ne",label:"नेपाली"},{locale:"mr",label:"मराठी"},{locale:"hi-in",label:"हिन्दी"},{locale:"bn",label:"বাংলা"},{locale:"pa",label:"ਪੰਜਾਬੀ"},{locale:"gu-in",label:"ગુજરાતી"},{locale:"ta",label:"தமிழ்"},{locale:"te",label:"తెలుగు"},{locale:"kn",label:"ಕನ್ನಡ"},{locale:"ml",label:"മലയാളം"},{locale:"th",label:"ภาษาไทย"},{locale:"km-kh",label:"ភាសាខ្មែរ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}],iA={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function iB(){return(0,bS.jsx)("div",{className:"tl-background"})}function iC(a,b,c,d,e,f){(0,bT.useLayoutEffect)(()=>{let g=a.current;if(!g||void 0===b)return;let h=`translate(${b}px, ${c}px)`;void 0!==d&&(h+=` scale(${d})`),void 0!==e&&(h+=` rotate(${e}rad)`),f&&(h+=` translate(${f.x}px, ${f.y}px)`),g.style.transform=h})}bV("@tldraw/tlschema","4.4.0","esm"),a.s([],809962);let iD=a=>a,iE=a=>a*a,iF=a=>a*(2-a),iG=a=>--a*a*a+1,iH=a=>a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,iI=a=>1+--a*a*a*a*a,iJ=a=>Math.sin(a*Math.PI/2);class iK{constructor(a=0,b=0,c=1){this.x=a,this.y=b,this.z=c}get pressure(){return this.z}set(a=this.x,b=this.y,c=this.z){return this.x=a,this.y=b,this.z=c,this}setTo({x:a=0,y:b=0,z:c=1}){return this.x=a,this.y=b,this.z=c,this}rot(a){if(0===a)return this;let{x:b,y:c}=this,d=Math.sin(a),e=Math.cos(a);return this.x=b*e-c*d,this.y=b*d+c*e,this}rotWith(a,b){if(0===b)return this;let c=this.x-a.x,d=this.y-a.y,e=Math.sin(b),f=Math.cos(b);return this.x=a.x+(c*f-d*e),this.y=a.y+(c*e+d*f),this}clone(){let{x:a,y:b,z:c}=this;return new iK(a,b,c)}sub(a){return this.x-=a.x,this.y-=a.y,this}subXY(a,b){return this.x-=a,this.y-=b,this}subScalar(a){return this.x-=a,this.y-=a,this}add(a){return this.x+=a.x,this.y+=a.y,this}addXY(a,b){return this.x+=a,this.y+=b,this}addScalar(a){return this.x+=a,this.y+=a,this}clamp(a,b){return this.x=Math.max(this.x,a),this.y=Math.max(this.y,a),void 0!==b&&(this.x=Math.min(this.x,b),this.y=Math.min(this.y,b)),this}div(a){return this.x/=a,this.y/=a,this}divV(a){return this.x/=a.x,this.y/=a.y,this}mul(a){return this.x*=a,this.y*=a,this}mulV(a){return this.x*=a.x,this.y*=a.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(a,b){let c=iK.Tan(a,this);return this.add(c.mul(b))}neg(){return this.x*=-1,this.y*=-1,this}cross(a){return this.x=this.y*a.z-this.z*a.y,this.y=this.z*a.x-this.x*a.z,this}dpr(a){return iK.Dpr(this,a)}cpr(a){return iK.Cpr(this,a)}len2(){return iK.Len2(this)}len(){return iK.Len(this)}pry(a){return iK.Pry(this,a)}per(){let{x:a,y:b}=this;return this.x=b,this.y=-a,this}uni(){let a=this.len();return 0===a||(this.x/=a,this.y/=a),this}tan(a){return this.sub(a).uni()}dist(a){return iK.Dist(this,a)}distanceToLineSegment(a,b){return iK.DistanceToLineSegment(a,b,this)}slope(a){return iK.Slope(this,a)}snapToGrid(a){return this.x=Math.round(this.x/a)*a,this.y=Math.round(this.y/a)*a,this}angle(a){return iK.Angle(this,a)}toAngle(){return iK.ToAngle(this)}lrp(a,b){return this.x=this.x+(a.x-this.x)*b,this.y=this.y+(a.y-this.y)*b,this}equals(a){return iK.Equals(this,a)}equalsXY(a,b){return iK.EqualsXY(this,a,b)}toFixed(){return this.x=i6(this.x),this.y=i6(this.y),this}toString(){return iK.ToString(iK.ToFixed(this))}toJson(){return iK.ToJson(this)}toArray(){return iK.ToArray(this)}static Add(a,b){return new iK(a.x+b.x,a.y+b.y)}static AddXY(a,b,c){return new iK(a.x+b,a.y+c)}static Sub(a,b){return new iK(a.x-b.x,a.y-b.y)}static SubXY(a,b,c){return new iK(a.x-b,a.y-c)}static AddScalar(a,b){return new iK(a.x+b,a.y+b)}static SubScalar(a,b){return new iK(a.x-b,a.y-b)}static Div(a,b){return new iK(a.x/b,a.y/b)}static Mul(a,b){return new iK(a.x*b,a.y*b)}static DivV(a,b){return new iK(a.x/b.x,a.y/b.y)}static MulV(a,b){return new iK(a.x*b.x,a.y*b.y)}static Neg(a){return new iK(-a.x,-a.y)}static Per(a){return new iK(a.y,-a.x)}static Abs(a){return new iK(Math.abs(a.x),Math.abs(a.y))}static Dist(a,b){return((a.y-b.y)**2+(a.x-b.x)**2)**.5}static ManhattanDist(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)}static DistMin(a,b,c){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)<c**2}static Dist2(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)}static Dpr(a,b){return a.x*b.x+a.y*b.y}static Cross(a,b){return new iK(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z)}static Cpr(a,b){return a.x*b.y-b.x*a.y}static Len2(a){return a.x*a.x+a.y*a.y}static Len(a){return(a.x*a.x+a.y*a.y)**.5}static Pry(a,b){return iK.Dpr(a,b)/iK.Len(b)}static Uni(a){let b=iK.Len(a);return new iK(0===b?0:a.x/b,0===b?0:a.y/b)}static Tan(a,b){return iK.Uni(iK.Sub(a,b))}static Min(a,b){return new iK(Math.min(a.x,b.x),Math.min(a.y,b.y))}static Max(a,b){return new iK(Math.max(a.x,b.x),Math.max(a.y,b.y))}static From({x:a,y:b,z:c=1}){return new iK(a,b,c)}static FromArray(a){return new iK(a[0],a[1])}static Rot(a,b=0){let c=Math.sin(b),d=Math.cos(b);return new iK(a.x*d-a.y*c,a.x*c+a.y*d)}static RotWith(a,b,c){let d=a.x-b.x,e=a.y-b.y,f=Math.sin(c),g=Math.cos(c);return new iK(b.x+(d*g-e*f),b.y+(d*f+e*g))}static NearestPointOnLineThroughPoint(a,b,c){return iK.Mul(b,iK.Sub(c,a).pry(b)).add(a)}static NearestPointOnLineSegment(a,b,c,d=!0){if(iK.Equals(a,c)||iK.Equals(b,c))return iK.From(c);let e=iK.Tan(b,a),f=iK.Add(a,iK.Mul(e,iK.Sub(c,a).pry(e)));if(d){if(f.x<Math.min(a.x,b.x))return iK.Cast(a.x<b.x?a:b);if(f.x>Math.max(a.x,b.x))return iK.Cast(a.x>b.x?a:b);if(f.y<Math.min(a.y,b.y))return iK.Cast(a.y<b.y?a:b);if(f.y>Math.max(a.y,b.y))return iK.Cast(a.y>b.y?a:b)}return f}static DistanceToLineThroughPoint(a,b,c){return iK.Dist(c,iK.NearestPointOnLineThroughPoint(a,b,c))}static DistanceToLineSegment(a,b,c,d=!0){return iK.Dist(c,iK.NearestPointOnLineSegment(a,b,c,d))}static Snap(a,b=1){return new iK(Math.round(a.x/b)*b,Math.round(a.y/b)*b)}static Cast(a){return a instanceof iK?a:iK.From(a)}static Slope(a,b){return a.x===b.y?NaN:(a.y-b.y)/(a.x-b.x)}static IsNaN(a){return isNaN(a.x)||isNaN(a.y)}static Angle(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}static AngleBetween(a,b){let c=a.x*b.x+a.y*b.y,d=Math.sqrt((Math.pow(a.x,2)+Math.pow(a.y,2))*(Math.pow(b.x,2)+Math.pow(b.y,2)));return(a.x*b.y-a.y*b.x<0?-1:1)*Math.acos(iS(c/d,-1,1))}static Lrp(a,b,c){return iK.Sub(b,a).mul(c).add(a)}static Med(a,b){return new iK((a.x+b.x)/2,(a.y+b.y)/2)}static Equals(a,b){return 1e-4>Math.abs(a.x-b.x)&&1e-4>Math.abs(a.y-b.y)}static EqualsXY(a,b,c){return a.x===b&&a.y===c}static Clockwise(a,b,c){return(c.x-a.x)*(b.y-a.y)-(b.x-a.x)*(c.y-a.y)<0}static Rescale(a,b){let c=iK.Len(a);return new iK(b*a.x/c,b*a.y/c)}static ScaleWithOrigin(a,b,c){return iK.Sub(a,c).mul(b).add(c)}static ToFixed(a){return new iK(i6(a.x),i6(a.y))}static ToInt(a){return new iK(parseInt(a.x.toFixed(0)),parseInt(a.y.toFixed(0)),parseInt((a.z??0).toFixed(0)))}static ToCss(a){return`${a.x},${a.y}`}static Nudge(a,b,c){return iK.Add(a,iK.Tan(b,a).mul(c))}static ToString(a){return`${a.x}, ${a.y}`}static ToAngle(a){let b=Math.atan2(a.y,a.x);return b<0&&(b+=2*Math.PI),b}static FromAngle(a,b=1){return new iK(Math.cos(a)*b,Math.sin(a)*b)}static ToArray(a){return[a.x,a.y,a.z]}static ToJson(a){let{x:b,y:c,z:d}=a;return{x:b,y:c,z:d}}static Average(a){let b=a.length,c=new iK(0,0);if(0===b)return c;for(let d=0;d<b;d++)c.add(a[d]);return c.div(b)}static Clamp(a,b,c){return void 0===c?new iK(Math.min(Math.max(a.x,b)),Math.min(Math.max(a.y,b))):new iK(Math.min(Math.max(a.x,b),c),Math.min(Math.max(a.y,b),c))}static PointsBetween(a,b,c=6){let d=[];for(let e=0;e<c;e++){let f=iE(e/(c-1)),g=iK.Lrp(a,b,f);g.z=Math.min(1,.5+.65*Math.abs(.5-iL(f))),d.push(g)}return d}static SnapToGrid(a,b=8){return new iK(Math.round(a.x/b)*b,Math.round(a.y/b)*b)}}let iL=a=>a<.5?2*a*a:-1+(4-2*a)*a;function iM(a){return`${i5(a.x)},${i5(a.y)} `}function iN(a,b){return`${i5((a.x+b.x)/2)},${i5((a.y+b.y)/2)} `}let iO=Math.PI,iP=iO/2,iQ=2*iO,iR=Math.sin;function iS(a,b,c){return Math.max(b,void 0!==c?Math.min(a,c):a)}function iT(a,b=1e10){return a?Math.round(a*b)/b:0}function iU(a,b,c=1e-6){return Math.abs(a-b)<=c}function iV(a,b,c=1e-6){return a<b||iU(a,b,c)}function iW(a){return(a%=iQ)<0?a+=iQ:0===a&&(a=0),a}function iX(a,b){return(a=iW(a))>(b=iW(b))&&(b+=iQ),b-a}function iY(a,b){return iQ-iX(a,b)}function iZ(a,b){let c=(b-a)%iQ;return 2*c%iQ-c}function i$(a,b){let c=iQ/b,d=Math.floor(((iQ+a)%iQ+c/2)/c)*c%iQ;return d<iO&&(d+=iQ),d>iO&&(d-=iQ),d}function i_(a,b){return a===b||iU(a%(Math.PI/2)-b%(Math.PI/2),0)}function i0(a,b,c){return new iK(a.x,a.y).add(iK.FromAngle(c,b))}function i1(a,b,c){let d=a/2,e=b/2,f=[],g=1/0,h=-1/0,i=1/0,j=-1/0;for(let a=0;a<c;a++){let b=-iP+iQ/c*a,k=d+d*Math.cos(b),l=e+e*Math.sin(b);k<g&&(g=k),l<i&&(i=l),k>h&&(h=k),l>j&&(j=l),f.push(new iK(k,l))}let k=h-g,l=j-i;if(0!=a-k||0!=b-l)for(let c=0;c<f.length;c++){let d=f[c];d.x=(d.x-g)/k*a,d.y=(d.y-i)/l*b}return f}function i2(a,b,c,d){let e=Math.max(a,c),f=Math.min(b,d);return e<=f?[e,f]:null}function i3(a,b,c){return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)}function i4(a,b){let c,d,e=0;for(let f=0;f<b.length;f++){if((c=b[f]).x===a.x&&c.y===a.y||(d=b[(f+1)%b.length],iK.Dist(a,c)+iK.Dist(a,d)===iK.Dist(c,d)))return!0;c.y<=a.y?d.y>a.y&&i3(c,d,a)>0&&(e+=1):d.y<=a.y&&0>i3(c,d,a)&&(e-=1)}return 0!==e}function i5(a){return Math.round(1e4*a)/1e4}function i6(a){return Math.round(100*a)/100}let i7=a=>Math.abs(a)<Number.MAX_SAFE_INTEGER;function i8(a,b,c,d){let e;if(Math.abs(a)>iO){e=iZ(b,d);let f=iZ(d,c);return Math.abs(e)<Math.abs(f)?e/a:(a-f)/a}{let c=(e=iZ(b,d))/a;return Math.sign(e)!==Math.sign(a)?+(Math.abs(c)>.5):c}}function i9(a,b,c){let d=-2*(a.x*(b.y-c.y)-a.y*(b.x-c.x)+b.x*c.y-c.x*b.y),e=((a.x*a.x+a.y*a.y)*(c.y-b.y)+(b.x*b.x+b.y*b.y)*(a.y-c.y)+(c.x*c.x+c.y*c.y)*(b.y-a.y))/d,f=((a.x*a.x+a.y*a.y)*(b.x-c.x)+(b.x*b.x+b.y*b.y)*(c.x-a.x)+(c.x*c.x+c.y*c.y)*(a.x-b.x))/d;return Number.isFinite(e)&&Number.isFinite(f)?new iK(e,f):null}let ja=({brush:a,color:b,opacity:c,className:d})=>{let e=(0,bT.useRef)(null);iC(e,a.x,a.y);let f=i5(Math.max(1,a.w)),g=i5(Math.max(1,a.h));return(0,bS.jsx)("svg",{className:"tl-overlays__item",ref:e,"aria-hidden":"true",children:b?(0,bS.jsxs)("g",{className:"tl-brush",opacity:c,children:[(0,bS.jsx)("rect",{width:f,height:g,fill:b,opacity:.75}),(0,bS.jsx)("rect",{width:f,height:g,fill:"none",stroke:b,opacity:.1})]}):(0,bS.jsx)("rect",{className:`tl-brush tl-brush__default ${d}`,width:f,height:g})})};var jb=a.i(518850);let jc=d$("tlenvReactive",{isCoarsePointer:!1}),jd={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},je={duration:0,easing:iH},jf=["top","right","bottom","left"],jg={},jh=jj("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),ji={logPreventDefaults:jj("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:jj("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:jj("logElementRemoves",{defaults:{all:!1}}),debugSvg:jj("debugSvg",{defaults:{all:!1}}),showFps:jj("showFps",{defaults:{all:!1}}),measurePerformance:jj("measurePerformance",{defaults:{all:!1}}),throwToBlob:jj("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:jj("reconnectOnPing",{defaults:{all:!1}}),debugCursors:jj("debugCursors",{defaults:{all:!1}}),forceSrgb:jj("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:jj("debugGeometry",{defaults:{all:!1}}),hideShapes:jj("hideShapes",{defaults:{all:!1}}),editOnType:jj("editOnType",{defaults:{all:!1}}),a11y:jj("a11y",{defaults:{all:!1}}),debugElbowArrows:jj("debugElbowArrows",{defaults:{all:!1}})};if("u">typeof Element){let a=Element.prototype.removeChild;dA("element removal logging",()=>{ji.logElementRemoves.get()?Element.prototype.removeChild=function(b){return console.warn("[tldraw] removing child:",b),a.call(this,b)}:Element.prototype.removeChild=a})}function jj(a,{defaults:b,shouldStoreForSession:c=!0}){var d;let e,f,g;return e=function(a){switch(jk(()=>process.env.TLDRAW_ENV)??jk(()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV)??jk(()=>process.env.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return a.defaults.production??a.defaults.all;case"preview":case"staging":return a.defaults.staging??a.defaults.all;default:return a.defaults.development??a.defaults.all}}(d={name:a,defaults:b,shouldStoreForSession:c}),f=d.shouldStoreForSession?function(a){try{return JSON.parse(da(`tldraw_debug:${a}`)??"null")}catch{return null}}(d.name):null,Object.assign(g=d$(`debug:${d.name}`,f??e),d,{reset:()=>g.set(e)})}function jk(a){try{return a()}catch{return null}}function jl(a){if(a.nodeType===Node.ELEMENT_NODE)return a;if(a.parentElement)return jl(a.parentElement);throw Error("Could not find a parent element of an HTML type!")}function jm(a){a.preventDefault(),ji.logPreventDefaults.get()&&console.warn("preventDefault called on event:",a)}function jn(a,b){if(a.setPointerCapture(b.pointerId),ji.logPointerCaptures.get()){let c=jh.get();c.set(a,(c.get(a)??0)+1),console.warn("setPointerCapture called on element:",a,b)}}function jo(a,b){if(a.hasPointerCapture(b.pointerId)&&(a.releasePointerCapture(b.pointerId),ji.logPointerCaptures.get())){let c=jh.get();1===c.get(a)?c.delete(a):c.has(a)?c.set(a,c.get(a)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",a,b)}}let jp=(a,b,c)=>{a&&a.style.setProperty(b,c)};function jq(a=!1){let{activeElement:b}=document;return!!(b&&(b.isContentEditable||(a?["input","textarea"]:["input","select","button","textarea"]).indexOf(b.tagName.toLowerCase())>-1||b.classList.contains("tlui-slider__thumb")))}let jr=a=>a.ctrlKey||a.metaKey;function js(a,b){return a.markEventAsHandled(b),{point:{x:b.clientX,y:b.clientY,z:b.pressure},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:jr(b),pointerId:b.pointerId,button:b.button,isPen:"pen"===b.pointerType}}function jt(a,b){return jw(`${a}_${b}`)}function ju(a){return jw(`${(0,bT.useId)()}${a??""}`)}function jv(a){let b=ce((0,bT.useContext)(jx));return jw(`${b}_${a}`)}function jw(a){return a.replace(/:/g,"_")}let jx=(0,bT.createContext)(null);function jy({children:a}){let b=ju();return(0,bS.jsx)(jx.Provider,{value:b,children:a})}let jz=(0,bT.createContext)(null);function jA(){let a=bT.default.useContext(jz);if(!a)throw Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return a}function jB(){return bT.default.useContext(jz)}function jC({editor:a,children:b}){return(0,bS.jsx)(jz.Provider,{value:a,children:(0,bS.jsx)(jy,{children:b})})}function jD(){let a=jA(),b=a.getContainer().ownerDocument,c=d8("current tool",()=>a.getCurrentTool(),[a]),d=(0,bT.useMemo)(function(){return{onPointerDown:function(b){a.wasEventAlreadyHandled(b)||(2===b.button?a.dispatch({type:"pointer",target:"canvas",name:"right_click",...js(a,b)}):(0===b.button||1===b.button||5===b.button)&&(jn(b.currentTarget,b),a.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...js(a,b)})))},onPointerUp:function(b){a.wasEventAlreadyHandled(b)||(0===b.button||1===b.button||2===b.button||5===b.button)&&(jo(b.currentTarget,b),a.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...js(a,b)}))},onPointerEnter:function(b){if(a.wasEventAlreadyHandled(b)||a.getInstanceState().isPenMode&&"pen"!==b.pointerType)return;let c="mouse"===b.pointerType||"pen"===b.pointerType;a.updateInstanceState({isHoveringCanvas:!!c||null})},onPointerLeave:function(b){if(a.wasEventAlreadyHandled(b)||a.getInstanceState().isPenMode&&"pen"!==b.pointerType)return;let c="mouse"===b.pointerType||"pen"===b.pointerType;a.updateInstanceState({isHoveringCanvas:!c&&null})},onDragOver:function(b){a.wasEventAlreadyHandled(b)||jm(b)},onDrop:async function b(b){if(a.wasEventAlreadyHandled(b))return;if(jm(b),b.stopPropagation(),b.dataTransfer?.files?.length){let c=Array.from(b.dataTransfer.files);await a.putExternalContent({type:"files",files:c,point:a.screenToPage({x:b.clientX,y:b.clientY})});return}let c=b.dataTransfer.getData("url");if(c)return void await a.putExternalContent({type:"url",url:c,point:a.screenToPage({x:b.clientX,y:b.clientY})})},onTouchStart:function(b){a.wasEventAlreadyHandled(b)||(a.markEventAsHandled(b),jm(b))},onTouchEnd:function(b){if(a.wasEventAlreadyHandled(b)||(a.markEventAsHandled(b),!(b.target instanceof HTMLElement)))return;let c=a.getEditingShape()?.id;c&&b.target.closest(`[data-shape-id="${c}"]`)||"A"===b.target.tagName||"TEXTAREA"===b.target.tagName||b.target.isContentEditable||jm(b)},onClick:function(b){a.wasEventAlreadyHandled(b)||b.stopPropagation()}}},[a]);return(0,bT.useEffect)(()=>{let d,e;function f(b){if(!a.wasEventAlreadyHandled(b)){if(a.markEventAsHandled(b),b.clientX!==d||b.clientY!==e)for(let f of(d=b.clientX,e=b.clientY,(0,c.useCoalescedEvents&&b.getCoalescedEvents)?b.getCoalescedEvents():[b]))a.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...js(a,f)})}}return b.body.addEventListener("pointermove",f),()=>{b.body.removeEventListener("pointermove",f)}},[a,c,b]),d}let jE=(0,bT.createContext)(null);function jF({container:a,children:b}){return(0,bS.jsx)(jE.Provider,{value:a,children:b})}function jG(){return ce((0,bT.useContext)(jE),"useContainer used outside of <Tldraw />")}function jH(a){return a.menus.hasOpenMenus()||jq()}function jI({className:a,zoom:b,point:c,color:d,viewport:e,opacity:f=1}){let g=(0,bT.useRef)(null);iC(g,iS(c.x,e.minX+5/b,e.maxX-5/b),iS(c.y,e.minY+5/b,e.maxY-5/b),1/b,iK.Angle(e.center,c));let h=jv("cursor_hint");return(0,bS.jsxs)("svg",{ref:g,className:(0,jb.default)("tl-overlays__item",a),"aria-hidden":"true",children:[(0,bS.jsx)("use",{href:`#${h}`,color:d,strokeWidth:3,stroke:"var(--tl-color-background)"}),(0,bS.jsx)("use",{href:`#${h}`,color:d,opacity:f})]})}let jJ=(0,bT.memo)(function({className:a,zoom:b,point:c,color:d,name:e,chatMessage:f}){let g=(0,bT.useRef)(null);iC(g,c?.x,c?.y,1/b);let h=jv("cursor");return c?(0,bS.jsxs)("div",{ref:g,className:(0,jb.default)("tl-overlays__item",a),children:[(0,bS.jsx)("svg",{className:"tl-cursor","aria-hidden":"true",children:(0,bS.jsx)("use",{href:`#${h}`,color:d})}),f?(0,bS.jsxs)(bS.Fragment,{children:[e&&(0,bS.jsx)("div",{className:"tl-nametag-title",style:{color:d},children:e}),(0,bS.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:d},children:f})]}):e&&(0,bS.jsx)("div",{className:"tl-nametag",style:{backgroundColor:d},children:e})]}):null}),jK={openWindow:(a,b,c=!1)=>window.open(a,b,c?"noopener":"noopener noreferrer"),refreshPage(){window.location.reload()},hardReset:async()=>await window.__tldraw__hardReset?.()};function jL(){jK.hardReset()}var jM=bT;let jN={error:null};class jO extends jM.Component{static getDerivedStateFromError(a){return{error:a}}state=jN;componentDidCatch(a){this.props.onError?.(a)}render(){let{error:a}=this.state;if(null!==a){let{fallback:b}=this.props;return(0,bS.jsx)(b,{error:a})}return this.props.children}}function jP({children:a,fallback:b,...c}){return null===b?a:(0,bS.jsx)(jO,{fallback:b,...c,children:a})}let jQ=({error:a,editor:b})=>{let c=(0,bT.useRef)(null),[d,e]=(0,bT.useState)(!1),[f,g]=(0,bT.useState)(!1),[h,i]=(0,bT.useState)(!1),j=null;try{j=q_().Canvas??null}catch{}let k=a instanceof Error?a.message:String(a),l=a instanceof Error?a.stack:null,m=d8("isDarkMode",()=>{try{if(b)return b.user.getIsDarkMode()}catch{}return null},[b]),[n,o]=(0,bT.useState)(null);(0,bT.useLayoutEffect)(()=>{null!==m&&o(m);let a=c.current?.parentElement,b=!1;for(;a;){if(a.classList.contains("tl-theme__dark")||a.classList.contains("tl-theme__light")){b=!0;break}a=a.parentElement}if(b)return void o(null)},[m]),(0,bT.useEffect)(()=>{if(f){let a=b?.timers.setTimeout(()=>{g(!1)},2e3);return()=>clearTimeout(a)}},[f,b]);let p=async()=>{jL()},q=new URL("https://github.com/tldraw/tldraw/issues/new");return q.searchParams.set("title",k),q.searchParams.set("labels","bug"),q.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${l??k}
\`\`\`

My browser: ${navigator.userAgent}`),(0,bS.jsxs)("div",{ref:c,className:(0,jb.default)("tl-container tl-error-boundary",null===n?"":n?"tl-theme__dark":"tl-theme__light"),children:[(0,bS.jsx)("div",{className:"tl-error-boundary__overlay"}),b&&(0,bS.jsx)(jO,{onError:ca,fallback:()=>null,children:(0,bS.jsx)(jC,{editor:b,children:(0,bS.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:j?(0,bS.jsx)(j,{}):null})})}),(0,bS.jsx)("div",{className:(0,jb.default)("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":d&&!h}),children:h?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("h2",{children:"Are you sure?"}),(0,bS.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,bS.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,bS.jsx)("button",{className:"tlui-button",onClick:()=>i(!1),children:"Cancel"}),(0,bS.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:p,children:"Reset data"})]})]}):(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("h2",{children:"Something went wrong"}),(0,bS.jsx)("p",{children:"Please refresh your browser."}),(0,bS.jsx)("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),(0,bS.jsxs)("p",{children:[(0,bS.jsx)("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,d&&(0,bS.jsxs)(bS.Fragment,{children:["Message:",(0,bS.jsx)("h4",{children:(0,bS.jsx)("code",{children:k})}),"Stack trace:",(0,bS.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,bS.jsx)("pre",{children:(0,bS.jsx)("code",{children:l??k})}),(0,bS.jsx)("button",{className:"tlui-button",onClick:()=>{let a=document.createElement("textarea");a.value=l??k,document.body.appendChild(a),a.select(),document.execCommand("copy"),a.remove(),g(!0)},children:f?"Copied!":"Copy"})]})]}),(0,bS.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,bS.jsx)("button",{className:"tlui-button",onClick:()=>e(!d),children:d?"Hide details":"Show details"}),(0,bS.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,bS.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>i(!0),children:"Reset data"}),(0,bS.jsx)("button",{className:"tlui-button tl-error-boundary__refresh",onClick:()=>{jK.refreshPage()},children:"Refresh Page"})]})]})]})})]})};function jR({x:a,y:b,z:c,size:d}){let e=ju("grid"),{gridSteps:f}=jA().options;return(0,bS.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,bS.jsx)("defs",{children:f.map(({min:f,mid:g,step:h},i)=>{let j=h*d*c,k=.5+a*c,l=.5+b*c,m=k>0?k%j:j+k%j,n=l>0?l%j:j+l%j,o=c<g?cD(c,[f,g],[0,1]):1;return(0,bS.jsx)("pattern",{id:jt(e,`${h}`),width:j,height:j,patternUnits:"userSpaceOnUse",children:(0,bS.jsx)("circle",{className:"tl-grid-dot",cx:m,cy:n,r:1,opacity:o})},i)})}),f.map(({step:a},b)=>(0,bS.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${e}_${a})`},b))]})}function jS({handle:a,isCoarse:b,className:c,zoom:d}){let e=jA(),f=(b?e.options.coarseHandleRadius:e.options.handleRadius)/d;if("clone"===a.type){let b=3/d,e=`M0,${-b} A${b},${b} 0 0,1 0,${b}`,g=jf.indexOf(a.id);return(0,bS.jsxs)("g",{className:(0,jb.default)(`tl-handle tl-handle__${a.type}`,c),children:[(0,bS.jsx)("circle",{className:"tl-handle__bg",r:f}),(0,bS.jsx)("path",{className:"tl-handle__fg",d:e,transform:`rotate(${-90+90*g})`})]})}let g=("create"===a.type&&b?3:4)/Math.max(d,.25);return(0,bS.jsxs)("g",{className:(0,jb.default)(`tl-handle tl-handle__${a.type}`,c),children:[(0,bS.jsx)("circle",{className:"tl-handle__bg",r:f}),(0,bS.jsx)("circle",{className:"tl-handle__fg",r:g})]})}let jT=({children:a})=>(0,bS.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:a}),jU="4.4.0";function jV(a,b){let c=(0,bT.useRef)(a);return b(a,c.current)?c.current:(c.current=a,a)}let jW=(a,b)=>(a??=null)===(b??=null)||!!a&&!!b&&b7(a,b);function jX(a){return jV(a,jW)}let jY=(a,b)=>(a??=null)===(b??=null)||!!a&&!!b&&cM(a,b);var f_=f$;let jZ="TLDRAW_USER_DATA_v3",j$=f_.object({id:f_.string,name:f_.string.nullable().optional(),color:f_.string.nullable().optional(),locale:f_.string.nullable().optional(),animationSpeed:f_.number.nullable().optional(),areKeyboardShortcutsEnabled:f_.boolean.nullable().optional(),edgeScrollSpeed:f_.number.nullable().optional(),colorScheme:f_.literalEnum("light","dark","system").optional(),isSnapMode:f_.boolean.nullable().optional(),isWrapMode:f_.boolean.nullable().optional(),isDynamicSizeMode:f_.boolean.nullable().optional(),isPasteAtCursorMode:f_.boolean.nullable().optional(),enhancedA11yMode:f_.boolean.nullable().optional(),inputMode:f_.literalEnum("trackpad","mouse").nullable().optional(),isZoomDirectionInverted:f_.boolean.nullable().optional()}),j_={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9,AddShowUiLabels:10,AddPointerPeripheral:11,RenameShowUiLabelsToEnhancedA11yMode:12,AddZoomDirectionInverted:13},j0=Math.max(...Object.values(j_)),j1=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function j2(){return j1[Math.floor(Math.random()*j1.length)]}let j3=Object.freeze({name:"",locale:function(a){for(let b of a){let a=function(a){let b=iz.find(b=>b.locale===a.toLowerCase());if(b)return b.locale;let[c,d]=a.split(/[-_]/).map(a=>a.toLowerCase());if(d){let a=iz.find(a=>a.locale===c);if(a)return a.locale}return c in iA?iA[c]:null}(b);if(a)return a}return"en"}(["en"]),color:j2(),edgeScrollSpeed:1,animationSpeed:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,enhancedA11yMode:!1,colorScheme:"light",inputMode:null,isZoomDirectionInverted:!1});function j4(){return{id:cs(void 0),color:j2()}}function j5(a){if(null===a||"object"!=typeof a||!("version"in a)||!("user"in a)||"number"!=typeof a.version)return j4();let b=dk(a);b.version<j_.AddAnimationSpeed&&(b.user.animationSpeed=1),b.version<j_.AddIsSnapMode&&(b.user.isSnapMode=!1),b.version,j_.MakeFieldsNullable,b.version<j_.AddEdgeScrollSpeed&&(b.user.edgeScrollSpeed=1),b.version<j_.AddExcalidrawSelectMode&&(b.user.isWrapMode=!1),b.version<j_.AllowSystemColorScheme&&(!0===b.user.isDarkMode?b.user.colorScheme="dark":!1===b.user.isDarkMode&&(b.user.colorScheme="light"),delete b.user.isDarkMode),b.version<j_.AddDynamicSizeMode&&(b.user.isDynamicSizeMode=!1),b.version<j_.AddPasteAtCursor&&(b.user.isPasteAtCursorMode=!1),b.version<j_.AddKeyboardShortcuts&&(b.user.areKeyboardShortcutsEnabled=!0),b.version<j_.AddShowUiLabels&&(b.user.showUiLabels=!1),b.version<j_.RenameShowUiLabelsToEnhancedA11yMode&&(b.user.enhancedA11yMode=b.user.showUiLabels,delete b.user.showUiLabels),b.version<j_.AddPointerPeripheral&&(b.user.inputMode=null),b.version<j_.AddZoomDirectionInverted&&(b.user.isZoomDirectionInverted=!1),b.version=j0;try{return j$.validate(b.user)}catch{return j4()}}let j6=d$("globalUserData",null);function j7(a){j$.validate(a),j6.set(a),c9(jZ,JSON.stringify({version:j0,user:j6.get()})),j9?.postMessage({type:kc,origin:kb(),data:{user:kd(),version:j0}})}let j8="u">typeof process&&!1,j9="u"<typeof BroadcastChannel||j8?null:new BroadcastChannel("tldraw-user-sync");j9?.addEventListener("message",a=>{let b=a.data;b?.type===kc&&b?.origin!==kb()&&j6.set(j5(b.data))});let ka=null;function kb(){return null===ka&&(ka=cs(void 0)),ka}let kc="tldraw-user-preferences-change";function kd(){let a=j6.get();return a||j7(a=j5(JSON.parse(c8(jZ)||"null")??null)),a}let ke=dQ("defaultLocalStorageUserPrefs",()=>kd());function kf(a={}){return{userPreferences:a.userPreferences??ke,setUserPreferences:a.setUserPreferences??j7}}var kg=a.i(875096),e5=b_,f_=f$;let kh="TLDRAW_TAB_ID_v2",ki=globalThis.window,kj=ki?ki[kh]??da(kh)??"TLDRAW_INSTANCE_STATE_V1_"+cs(void 0):"<error>";if(ki)if(ki[kh]=kj,ki&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(ki.navigator.platform)||0))db(kh,kj);else try{sessionStorage.removeItem(kh)}catch{}ki?.addEventListener("beforeunload",()=>{db(kh,kj)});let kk={Initial:0},kl=Math.max(...Object.values(kk)),km=f_.object({version:f_.number,currentPageId:gW.optional(),isFocusMode:f_.boolean.optional(),exportBackground:f_.boolean.optional(),isDebugMode:f_.boolean.optional(),isToolLocked:f_.boolean.optional(),isGridMode:f_.boolean.optional(),pageStates:f_.arrayOf(f_.object({pageId:gW,camera:f_.object({x:f_.number,y:f_.number,z:f_.number}).optional(),selectedShapeIds:f_.arrayOf(f7).optional(),focusedGroupId:f7.nullable().optional()})).optional()});function kn(a){let b=a.query.ids("page");return dQ("sessionStateSnapshot",()=>{let c=a.get(g3);if(!c)return null;let d=[...b.get()];return{version:kl,currentPageId:c.currentPageId,exportBackground:c.exportBackground,isFocusMode:c.isFocusMode,isDebugMode:c.isDebugMode,isToolLocked:c.isToolLocked,isGridMode:c.isGridMode,pageStates:d.map(b=>{let c=a.get(g7.createId(b)),d=a.get(gO.createId(b));return{pageId:b,camera:{x:d?.x??0,y:d?.y??0,z:d?.z??1},selectedShapeIds:c?.selectedShapeIds??[],focusedGroupId:c?.focusedGroupId??null}})}},{isEqual:e5.default})}function ko(a,b,c){let d=function(a){if(!a||"object"!=typeof a)return console.warn("Invalid instance state"),null;if(!("version"in a)||"number"!=typeof a.version)return console.warn("No version in instance state"),null;if(a.version!==kl){var b;(b=a=dk(a)).version,kk.Initial,b.version=kl}try{return km.validate(a)}catch(a){return console.warn(a),null}}(b);if(!d)return;let e=g0(a.get(g3)),f=c?.forceOverwrite?d:e,g=c?.forceOverwrite?e:d,h=a.schema.types.instance.create({id:g3,...e,currentPageId:d.currentPageId,isDebugMode:f?.isDebugMode??g?.isDebugMode,isFocusMode:f?.isFocusMode??g?.isFocusMode,isToolLocked:f?.isToolLocked??g?.isToolLocked,isGridMode:f?.isGridMode??g?.isGridMode,exportBackground:f?.exportBackground??g?.exportBackground});a.atomic(()=>{for(let b of d.pageStates??[]){if(!a.has(b.pageId))continue;let c=gO.createId(b.pageId),d=g7.createId(b.pageId),e=a.get(c),f=a.get(d);a.put([gO.create({id:c,x:b.camera?.x??e?.x,y:b.camera?.y??e?.y,z:b.camera?.z??e?.z}),g7.create({id:d,pageId:b.pageId,selectedShapeIds:b.selectedShapeIds??f?.selectedShapeIds,focusedGroupId:b.focusedGroupId??f?.focusedGroupId})])}a.put([h]),a.ensureStoreIsUsable()})}function kp(a,b,c){let d={};if("store"in b){let c=a.schema.migrateStoreSnapshot(b);if("success"!==c.type)throw Error("Failed to migrate store snapshot: "+c.reason);d.document={schema:a.schema.serialize(),store:cK(c.value,(b,{typeName:c})=>a.scopedTypes.document.has(c))}}else d=b;let e=g0(a.get(g3)),f=kq.get(a,kn).get();a.atomic(()=>{d.document&&a.loadStoreSnapshot(d.document),e&&a.update(g3,a=>({...a,...e})),f&&ko(a,f),d.session&&ko(a,d.session,{forceOverwrite:c?.forceOverwriteSessionState})})}let kq=new ci;function kr(a){let b=[],c=new Set;for(let d of a){if(c.has(d.type))throw Error(`Binding type "${d.type}" is defined more than once`);b.push(d),c.add(d.type)}return b}function ks({children:a,className:b="",...c}){return(0,bS.jsx)("svg",{...c,className:(0,jb.default)("tl-svg-container",b),"aria-hidden":"true",children:a})}class kt{constructor(a=0,b=0,c=0,d=0){this.x=a,this.y=b,this.w=c,this.h=d}x=0;y=0;w=0;h=0;get point(){return new iK(this.x,this.y)}set point(a){this.x=a.x,this.y=a.y}get minX(){return this.x}set minX(a){this.x=a}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(a){this.y=a}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(a){this.w=a}get height(){return this.h}set height(a){this.h=a}get aspectRatio(){return this.width/this.height}get center(){return new iK(this.x+this.w/2,this.y+this.h/2)}set center(a){this.x=a.x-this.w/2,this.y=a.y-this.h/2}get corners(){return[new iK(this.x,this.y),new iK(this.x+this.w,this.y),new iK(this.x+this.w,this.y+this.h),new iK(this.x,this.y+this.h)]}get cornersAndCenter(){return[new iK(this.x,this.y),new iK(this.x+this.w,this.y),new iK(this.x+this.w,this.y+this.h),new iK(this.x,this.y+this.h),new iK(this.x+this.w/2,this.y+this.h/2)]}get sides(){let{corners:a}=this;return[[a[0],a[1]],[a[1],a[2]],[a[2],a[3]],[a[3],a[0]]]}get size(){return new iK(this.w,this.h)}isValid(){return Number.isFinite(this.x)&&Number.isFinite(this.y)&&Number.isFinite(this.w)&&Number.isFinite(this.h)}toFixed(){return this.x=iT(this.x),this.y=iT(this.y),this.w=iT(this.w),this.h=iT(this.h),this}setTo(a){return this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h,this}set(a=0,b=0,c=0,d=0){return this.x=a,this.y=b,this.w=c,this.h=d,this}expand(a){let b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.w,a.x+a.w),e=Math.max(this.y+this.h,a.y+a.h);return this.x=b,this.y=c,this.w=d-b,this.h=e-c,this}expandBy(a){return this.x-=a,this.y-=a,this.w+=2*a,this.h+=2*a,this}scale(a){return this.x/=a,this.y/=a,this.w/=a,this.h/=a,this}clone(){let{x:a,y:b,w:c,h:d}=this;return new kt(a,b,c,d)}translate(a){return this.x+=a.x,this.y+=a.y,this}snapToGrid(a){let b=Math.round(this.x/a)*a,c=Math.round(this.y/a)*a,d=Math.round((this.x+this.w)/a)*a,e=Math.round((this.y+this.h)/a)*a;this.minX=b,this.minY=c,this.width=Math.max(1,d-b),this.height=Math.max(1,e-c)}collides(a){return kt.Collides(this,a)}contains(a){return kt.Contains(this,a)}includes(a){return kt.Includes(this,a)}containsPoint(a,b=0){return kt.ContainsPoint(this,a,b)}getHandlePoint(a){switch(a){case"top_left":return new iK(this.x,this.y);case"top_right":return new iK(this.x+this.w,this.y);case"bottom_left":return new iK(this.x,this.y+this.h);case"bottom_right":return new iK(this.x+this.w,this.y+this.h);case"top":return new iK(this.x+this.w/2,this.y);case"right":return new iK(this.x+this.w,this.y+this.h/2);case"bottom":return new iK(this.x+this.w/2,this.y+this.h);case"left":return new iK(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(a,b,c){let{minX:d,minY:e,maxX:f,maxY:g}=this,{minX:h,minY:i,maxX:j,maxY:k}=this;switch(a){case"left":case"top_left":case"bottom_left":h+=b;break;case"right":case"top_right":case"bottom_right":j+=b}switch(a){case"top":case"top_left":case"top_right":i+=c;break;case"bottom":case"bottom_left":case"bottom_right":k+=c}let l=(k-i)/(g-e);if((j-h)/(f-d)<0){let a=j;j=h,h=a}if(l<0){let a=k;k=i,i=a}this.minX=h,this.minY=i,this.width=Math.abs(j-h),this.height=Math.abs(k-i)}union(a){let b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.w,a.x+a.w),e=Math.max(this.y+this.h,a.y+a.h);return this.x=b,this.y=c,this.width=d-b,this.height=e-c,this}static From(a){return new kt(a.x,a.y,a.w,a.h)}static FromCenter(a,b){return new kt(a.x-b.x/2,a.y-b.y/2,b.x,b.y)}static FromPoints(a){let b;if(0===a.length)return new kt;let c=1/0,d=1/0,e=-1/0,f=-1/0;for(let g=0,h=a.length;g<h;g++)c=Math.min((b=a[g]).x,c),d=Math.min(b.y,d),e=Math.max(b.x,e),f=Math.max(b.y,f);return new kt(c,d,e-c,f-d)}static Expand(a,b){let c=Math.min(b.minX,a.minX),d=Math.min(b.minY,a.minY);return new kt(c,d,Math.max(b.maxX,a.maxX)-c,Math.max(b.maxY,a.maxY)-d)}static ExpandBy(a,b){return new kt(a.minX-b,a.minY-b,a.width+2*b,a.height+2*b)}static Collides(a,b){return!(a.maxX<b.minX||a.minX>b.maxX||a.maxY<b.minY||a.minY>b.maxY)}static Contains(a,b){return a.minX<b.minX&&a.minY<b.minY&&a.maxY>b.maxY&&a.maxX>b.maxX}static ContainsApproximately(a,b,c){return iV(a.minX,b.minX,c)&&iV(a.minY,b.minY,c)&&iV(b.maxX,a.maxX,c)&&iV(b.maxY,a.maxY,c)}static Includes(a,b){return kt.Collides(a,b)||kt.Contains(a,b)}static ContainsPoint(a,b,c=0){return!(b.x<a.minX-c||b.y<a.minY-c||b.x>a.maxX+c||b.y>a.maxY+c)}static Common(a){let b=1/0,c=1/0,d=-1/0,e=-1/0;for(let f=0;f<a.length;f++){let g=a[f];b=Math.min(b,g.minX),c=Math.min(c,g.minY),d=Math.max(d,g.maxX),e=Math.max(e,g.maxY)}return new kt(b,c,d-b,e-c)}static Sides(a,b=0){let{corners:c}=a;return[[c[0],c[1]],[c[1],c[2]],[c[2],c[3]],[c[3],c[0]]]}static Resize(a,b,c,d,e=!1){let{minX:f,minY:g,maxX:h,maxY:i}=a,{minX:j,minY:k,maxX:l,maxY:m}=a;switch(b){case"left":case"top_left":case"bottom_left":j+=c;break;case"right":case"top_right":case"bottom_right":l+=c}switch(b){case"top":case"top_left":case"top_right":k+=d;break;case"bottom":case"bottom_left":case"bottom_right":m+=d}let n=(l-j)/(h-f),o=(m-k)/(i-g);if(e){let a=(h-f)/(i-g),c=Math.abs(l-j),d=Math.abs(m-k),e=c*(o<0?1:-1)*(1/a),p=d*(n<0?1:-1)*a,q=a<c/d;switch(b){case"top_left":q?k=m+e:j=l+p;break;case"top_right":q?k=m+e:l=j-p;break;case"bottom_right":q?m=k-e:l=j-p;break;case"bottom_left":q?m=k-e:j=l+p;break;case"bottom":case"top":{let b=(j+l)/2,c=d*a;j=b-c/2,l=b+c/2;break}case"left":case"right":{let b=(k+m)/2,d=c/a;k=b-d/2,m=b+d/2}}}if(n<0){let a=l;l=j,j=a}if(o<0){let a=m;m=k,k=a}let p=new kt(j,k,Math.abs(l-j),Math.abs(m-k));return{box:p,scaleX:+(p.width/a.width*(n>0?1:-1)).toFixed(5),scaleY:+(p.height/a.height*(o>0?1:-1)).toFixed(5)}}equals(a){return kt.Equals(this,a)}static Equals(a,b){return b.x===a.x&&b.y===a.y&&b.w===a.w&&b.h===a.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(a){return new kt(a.x,a.y,Math.max(1,a.w),Math.max(1,a.h))}}class ku{constructor(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f}a=1;b=0;c=0;d=1;e=0;f=0;equals(a){return this===a||this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.e===a.e&&this.f===a.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=this;return this.a=b*a.a+d*a.b,this.c=b*a.c+d*a.d,this.e=b*a.e+d*a.f+f,this.b=c*a.a+e*a.b,this.d=c*a.c+e*a.d,this.f=c*a.e+e*a.f+g,this}rotate(a,b,c){return 0===a?this:void 0===b?this.multiply(ku.Rotate(a)):this.translate(b,c).multiply(ku.Rotate(a)).translate(-b,-c)}translate(a,b){return this.multiply(ku.Translate(a,b))}scale(a,b){return this.multiply(ku.Scale(a,b))}invert(){let{a,b,c,d,e,f}=this,g=a*d-b*c;return this.a=d/g,this.b=-(b/g),this.c=-(c/g),this.d=a/g,this.e=-((d*e-c*f)/g),this.f=(b*e-a*f)/g,this}applyToPoint(a){return ku.applyToPoint(this,a)}applyToPoints(a){return ku.applyToPoints(this,a)}rotation(){return ku.Rotation(this)}point(){return ku.Point(this)}decomposed(){return ku.Decompose(this)}toCssString(){return ku.toCssString(this)}setTo(a){return Object.assign(this,a),this}decompose(){return ku.Decompose(this)}clone(){return new ku(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ku(1,0,0,1,0,0)}static Translate(a,b){return new ku(1,0,0,1,a,b)}static Rotate(a,b,c){if(0===a)return ku.Identity();let d=Math.cos(a),e=Math.sin(a),f=new ku(d,e,-e,d,0,0);return void 0===b?f:ku.Compose(ku.Translate(b,c),f,ku.Translate(-b,-c))}static Scale(a,b,c,d){let e=new ku(a,0,0,b,0,0);return void 0===c?e:ku.Translate(c,d).multiply(e).translate(-c,-d)}static Multiply(a,b){return{a:a.a*b.a+a.c*b.b,c:a.a*b.c+a.c*b.d,e:a.a*b.e+a.c*b.f+a.e,b:a.b*b.a+a.d*b.b,d:a.b*b.c+a.d*b.d,f:a.b*b.e+a.d*b.f+a.f}}static Inverse(a){let b=a.a*a.d-a.b*a.c;return{a:a.d/b,b:-(a.b/b),c:-(a.c/b),d:a.a/b,e:-((a.d*a.e-a.c*a.f)/b),f:(a.b*a.e-a.a*a.f)/b}}static Absolute(a){let b=a.a*a.d-a.b*a.c;return{a:a.d/b,b:-(a.b/b),c:-(a.c/b),d:a.a/b,e:(a.d*a.e-a.c*a.f)/b,f:-((a.b*a.e-a.a*a.f)/b)}}static Compose(...a){let b=ku.Identity();for(let c=0,d=a.length;c<d;c++)b.multiply(a[c]);return b}static Point(a){return new iK(a.e,a.f)}static Rotation(a){let b;if(0!==a.a||0!==a.c){let c=(a.a*a.a+a.c*a.c)**.5;b=Math.acos(a.a/c)*(a.c>0?-1:1)}else if(0!==a.b||0!==a.d){let c=(a.b*a.b+a.d*a.d)**.5;b=iP+Math.acos(a.b/c)*(a.d>0?-1:1)}else b=0;return(iQ+b)%iQ}static Decompose(a){let b,c,d;if(0!==a.a||0!==a.c){let e=(a.a*a.a+a.c*a.c)**.5;b=e,c=(a.a*a.d-a.b*a.c)/e,d=Math.acos(a.a/e)*(a.c>0?-1:1)}else if(0!==a.b||0!==a.d){let e=(a.b*a.b+a.d*a.d)**.5;b=(a.a*a.d-a.b*a.c)/e,c=e,d=iP+Math.acos(a.b/e)*(a.d>0?-1:1)}else b=0,c=0,d=0;return{x:a.e,y:a.f,scaleX:b,scaleY:c,rotation:(iQ+d)%iQ}}static Smooth(a,b=1e10){return a.a=Math.round(a.a*b)/b,a.b=Math.round(a.b*b)/b,a.c=Math.round(a.c*b)/b,a.d=Math.round(a.d*b)/b,a.e=Math.round(a.e*b)/b,a.f=Math.round(a.f*b)/b,a}static toCssString(a){return`matrix(${i5(a.a)}, ${i5(a.b)}, ${i5(a.c)}, ${i5(a.d)}, ${i5(a.e)}, ${i5(a.f)})`}static applyToPoint(a,b){return new iK(a.a*b.x+a.c*b.y+a.e,a.b*b.x+a.d*b.y+a.f,b.z)}static applyToXY(a,b,c){return[a.a*b+a.c*c+a.e,a.b*b+a.d*c+a.f]}static applyToPoints(a,b){return b.map(b=>new iK(a.a*b.x+a.c*b.y+a.e,a.b*b.x+a.d*b.y+a.f,b.z))}static applyToBounds(a,b){return new kt(a.e+b.minX,a.f+b.minY,b.width,b.height)}static From(a){return new ku(a.a,a.b,a.c,a.d,a.e,a.f)}static Cast(a){return a instanceof ku?a:ku.From(a)}}function kv(a,b,c,d,e=1e-10){let f=a.x-c.x,g=a.y-c.y,h=d.x-c.x,i=d.y-c.y,j=b.x-a.x,k=b.y-a.y,l=h*g-i*f,m=j*g-k*f,n=i*j-h*k;if(iU(l,0,e)||iU(m,0,e)||iU(n,0,e))return null;if(0!==n){let b=l/n,c=m/n;if(iV(0,b,e)&&iV(b,1,e)&&iV(0,c,e)&&iV(c,1,e))return iK.AddXY(a,b*j,b*k)}return null}function kw(a,b,c,d){let e=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y),f=2*((b.x-a.x)*(a.x-c.x)+(b.y-a.y)*(a.y-c.y)),g=f*f-4*e*(c.x*c.x+c.y*c.y+a.x*a.x+a.y*a.y-2*(c.x*a.x+c.y*a.y)-d*d);if(g<0||0===g)return null;let h=Math.sqrt(g),i=(-f+h)/(2*e),j=(-f-h)/(2*e);if((i<0||i>1)&&(j<0||j>1))return null;let k=[];return(0<=i&&i<=1&&k.push(iK.Lrp(a,b,i)),0<=j&&j<=1&&k.push(iK.Lrp(a,b,j)),0===k.length)?null:k}function kx(a,b,c){let d,e=[];for(let f=1,g=c.length;f<g+1;f++)(d=kv(a,b,c[f-1],c[f%c.length]))&&e.push(d);return 0===e.length?null:e}function ky(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}function kz(a,b,c,d){return ky(a,c,d)!==ky(b,c,d)&&ky(a,b,c)!==ky(a,b,d)}function kA(a,b){var c;let d,e,f,g=new Map;for(let c=0,d=a.length;c<d;c++)if(i4(e=a[c],b)){let a=kC(e);g.has(a)||g.set(a,e)}for(let c=0,d=b.length;c<d;c++)if(i4(e=b[c],a)){let a=kC(e);g.has(a)||g.set(a,e)}for(let c=0,d=a.length;c<d;c++){e=a[c],f=a[(c+1)%a.length];for(let a=0,c=b.length;a<c;a++){let c=kv(e,f,b[a],b[(a+1)%b.length]);if(null!==c){let a=kC(c);g.has(a)||g.set(a,c)}}}return 0===g.size?null:(c=[...g.values()],d=iK.Average(c),c.sort((a,b)=>iK.Angle(d,a)-iK.Angle(d,b)))}function kB(a,b,c,d){let e=new Map;for(let f=0,g=c?a.length:a.length-1;f<g;f++){let c=a[f],g=a[(f+1)%a.length];for(let a=0,f=d?b.length:b.length-1;a<f;a++){let d=kv(c,g,b[a],b[(a+1)%b.length]);if(null!==d){let a=kC(d);e.has(a)||e.set(a,d)}}}return[...e.values()]}function kC(a){return`${a.x},${a.y}`}function kD(a,b){let c,d;for(let e=0,f=a.length;e<f;e++){c=a[e],d=a[(e+1)%f];for(let a=0,e=b.length;a<e;a++)if(kz(c,d,b[a],b[(a+1)%e]))return!0}return!1}let kE={includeLabels:!1,includeInternal:!1},kF={includeLabels:!1,includeInternal:!0};class kG{isFilled=!1;isClosed=!0;isLabel=!1;isEmptyLabel=!1;isInternal=!1;excludeFromShapeBounds=!1;debugColor;ignore;constructor(a){const{isLabel:b=!1,isEmptyLabel:c=!1,isInternal:d=!1,excludeFromShapeBounds:e=!1}=a;this.isFilled=a.isFilled,this.isClosed=a.isClosed,this.debugColor=a.debugColor,this.ignore=a.ignore,this.isLabel=b,this.isEmptyLabel=c,this.isInternal=d,this.excludeFromShapeBounds=e}isExcludedByFilter(a){return!!a&&(!!this.isLabel&&!a.includeLabels||!!this.isInternal&&!a.includeInternal)}hitTestPoint(a,b=0,c=!1,d){return!!(this.isClosed&&(this.isFilled||c)&&i4(a,this.vertices))||iK.Dist2(a,this.nearestPoint(a))<=b*b}distanceToPoint(a,b=!1,c){return iK.Dist(a,this.nearestPoint(a,c))*(this.isClosed&&(this.isFilled||b)&&i4(a,this.vertices)?-1:1)}distanceToLineSegment(a,b,c){let d,e,f,g;if(iK.Equals(a,b))return this.distanceToPoint(a,!1,c);let{vertices:h}=this;if(0===h.length)throw Error("nearest point not found");if(1===h.length)return iK.Dist(a,h[0]);let i=1/0,j=this.isClosed?h.length:h.length-1;for(let c=0;c<h.length;c++){if(f=h[c],c<j&&kz(a,b,f,h[(c+1)%h.length]))return 0;g=iK.NearestPointOnLineSegment(a,b,f,!0),(e=iK.Dist2(f,g))<i&&(i=e,d=g)}if(!d)throw Error("nearest point not found");return i=Math.sqrt(i),this.isClosed&&this.isFilled&&i4(d,this.vertices)?-i:i}hitTestLineSegment(a,b,c=0,d){return this.distanceToLineSegment(a,b,d)<=c}intersectLineSegment(a,b,c){return(this.isClosed?kx(a,b,this.vertices):function(a,b,c){let d,e=[];for(let f=0,g=c.length-1;f<g;f++)(d=kv(a,b,c[f],c[f+1]))&&e.push(d);return 0===e.length?null:e}(a,b,this.vertices))??[]}intersectCircle(a,b,c){return(this.isClosed?function(a,b,c){let d,e=[];for(let f=0,g=c.length;f<g;f++)(d=kw(c[f],c[(f+1)%c.length],a,b))&&e.push(...d);return 0===e.length?null:e}(a,b,this.vertices):function(a,b,c){let d,e=[];for(let f=1,g=c.length;f<g;f++)(d=kw(c[f-1],c[f],a,b))&&e.push(...d);return 0===e.length?null:e}(a,b,this.vertices))??[]}intersectPolygon(a,b){return kB(a,this.vertices,!0,this.isClosed)}intersectPolyline(a,b){return kB(a,this.vertices,!1,this.isClosed)}interpolateAlongEdge(a,b){let{vertices:c}=this;if(0===c.length)return new iK(0,0);if(1===c.length||a<=0)return c[0];let d=a*this.length,e=0;for(let a=0;a<(this.isClosed?c.length:c.length-1);a++){let b=c[a],g=c[(a+1)%c.length],h=e+iK.Dist(b,g);if(h>=d){var f;return iK.Lrp(b,g,(d-(f=e))/(h-f))}e=h}return this.isClosed?c[0]:c[c.length-1]}uninterpolateAlongEdge(a,b){let{vertices:c,length:d}=this,e=null,f=1/0,g=0;if(0===c.length||1===c.length)return 0;for(let b=0;b<(this.isClosed?c.length:c.length-1);b++){let d=c[b],h=c[(b+1)%c.length],i=iK.NearestPointOnLineSegment(d,h,a,!0),j=iK.Dist(i,a);j<f&&(f=j,e={start:d,end:h,nearestPoint:i,distanceToStart:g}),g+=iK.Dist(d,h)}return cd(e),(e.distanceToStart+iK.Dist(e.start,e.nearestPoint))/d}isPointInBounds(a,b=0){let{bounds:c}=this;return!(a.x<c.minX-b||a.y<c.minY-b||a.x>c.maxX+b||a.y>c.maxY+b)}overlapsPolygon(a){let b=a.map(a=>iK.From(a)),{vertices:c,center:d,isFilled:e,isEmptyLabel:f,isClosed:g}=this;if(f)return!1;if(c.some(a=>i4(a,b)))return!0;if(g){if(e&&(i4(d,b)||b.every(a=>i4(a,c)))||kD(b,c))return!0}else if(function(a,b){let c,d;for(let e=0,f=a.length;e<f;e++){c=a[e],d=a[(e+1)%f];for(let a=1,e=b.length;a<e;a++)if(kz(c,d,b[a-1],b[a]))return!0}return!1}(b,c))return!0;return!1}transform(a,b){return new kH(this,a,b)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(kF)),this._vertices}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.vertices}_boundsVertices;get boundsVertices(){return this._boundsVertices||(this._boundsVertices=this.getBoundsVertices()),this._boundsVertices}getBounds(){return kt.FromPoints(this.boundsVertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:a}=this,b=0;for(let c=0,d=a.length;c<d;c++){let e=a[c],f=a[(c+1)%d];b+=e.x*f.y-f.x*e.y}return b/2}toSimpleSvgPath(){let a="",{vertices:b}=this,c=b.length;if(0===c)return a;a+=`M${b[0].x},${b[0].y}`;for(let d=1;d<c;d++)a+=`L${b[d].x},${b[d].y}`;return this.isClosed&&(a+="Z"),a}_length;get length(){return this._length||(this._length=this.getLength(kF)),this._length}getLength(a){let b=this.getVertices(a??kF);if(0===b.length)return 0;let c=b[0],d=0;for(let a=1;a<b.length;a++){let e=b[a];d+=iK.Dist(c,e),c=e}return this.isClosed&&(d+=iK.Dist(b[b.length-1],b[0])),d}}class kH extends kG{constructor(a,b,c){super(a),this.geometry=a,this.matrix=b,this.inverse=ku.Inverse(b),this.decomposed=ku.Decompose(b),c&&(null!=c.isLabel&&(this.isLabel=c.isLabel),null!=c.isInternal&&(this.isInternal=c.isInternal),null!=c.debugColor&&(this.debugColor=c.debugColor),null!=c.ignore&&(this.ignore=c.ignore)),cd(iU(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(a){return this.geometry.getVertices(a).map(a=>ku.applyToPoint(this.matrix,a))}getBoundsVertices(){return this.geometry.getBoundsVertices().map(a=>ku.applyToPoint(this.matrix,a))}nearestPoint(a,b){return ku.applyToPoint(this.matrix,this.geometry.nearestPoint(ku.applyToPoint(this.inverse,a),b))}hitTestPoint(a,b=0,c,d){return this.geometry.hitTestPoint(ku.applyToPoint(this.inverse,a),b/this.decomposed.scaleX,c,d)}distanceToPoint(a,b=!1,c){return this.geometry.distanceToPoint(ku.applyToPoint(this.inverse,a),b,c)*this.decomposed.scaleX}distanceToLineSegment(a,b,c){return this.geometry.distanceToLineSegment(ku.applyToPoint(this.inverse,a),ku.applyToPoint(this.inverse,b),c)*this.decomposed.scaleX}hitTestLineSegment(a,b,c=0,d){return this.geometry.hitTestLineSegment(ku.applyToPoint(this.inverse,a),ku.applyToPoint(this.inverse,b),c/this.decomposed.scaleX,d)}intersectLineSegment(a,b,c){return ku.applyToPoints(this.matrix,this.geometry.intersectLineSegment(ku.applyToPoint(this.inverse,a),ku.applyToPoint(this.inverse,b),c))}intersectCircle(a,b,c){return ku.applyToPoints(this.matrix,this.geometry.intersectCircle(ku.applyToPoint(this.inverse,a),b/this.decomposed.scaleX,c))}intersectPolygon(a,b){return ku.applyToPoints(this.matrix,this.geometry.intersectPolygon(ku.applyToPoints(this.inverse,a),b))}intersectPolyline(a,b){return ku.applyToPoints(this.matrix,this.geometry.intersectPolyline(ku.applyToPoints(this.inverse,a),b))}transform(a,b){return new kH(this.geometry,ku.Multiply(a,this.matrix),{isLabel:b?.isLabel??this.isLabel,isInternal:b?.isInternal??this.isInternal,debugColor:b?.debugColor??this.debugColor,ignore:b?.ignore??this.ignore})}getSvgPathData(){throw Error("Cannot get SVG path data for transformed geometry.")}}class kI extends kG{children=[];ignoredChildren=[];constructor(a){super({...a,isClosed:!0,isFilled:!1});const b=a=>{for(let c of a)c instanceof kI?b(c.children):c.ignore?this.ignoredChildren.push(c):this.children.push(c)};if(b(a.children),0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(a){return this.isExcludedByFilter(a)?[]:this.children.filter(b=>!b.isExcludedByFilter(a)).flatMap(b=>b.getVertices(a))}nearestPoint(a,b){let c,d,e,f=1/0,{children:g}=this;if(0===g.length)throw Error("no children");for(let h of g)!h.isExcludedByFilter(b)&&(d=h.nearestPoint(a,b),(e=iK.Dist2(d,a))<f&&(f=e,c=d));if(!c)throw Error("nearest point not found");return c}distanceToPoint(a,b=!1,c){let d=1/0;for(let e of this.children){if(e.isExcludedByFilter(c))continue;let f=e.distanceToPoint(a,b,c);f<d&&(d=f)}return d}hitTestPoint(a,b,c,d=kF){return!!this.children.filter(a=>!a.isExcludedByFilter(d)).find(d=>d.hitTestPoint(a,b,c))}hitTestLineSegment(a,b,c,d=kF){return!!this.children.filter(a=>!a.isExcludedByFilter(d)).find(d=>d.hitTestLineSegment(a,b,c))}intersectLineSegment(a,b,c){return this.children.flatMap(d=>d.isExcludedByFilter(c)?du:d.intersectLineSegment(a,b,c))}intersectCircle(a,b,c){return this.children.flatMap(d=>d.isExcludedByFilter(c)?du:d.intersectCircle(a,b,c))}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.children.flatMap(a=>a.getBoundsVertices())}intersectPolygon(a,b){return this.children.flatMap(c=>c.isExcludedByFilter(b)?du:c.intersectPolygon(a,b))}intersectPolyline(a,b){return this.children.flatMap(c=>c.isExcludedByFilter(b)?du:c.intersectPolyline(a,b))}interpolateAlongEdge(a,b){let c=a*this.getLength(b),d=0;for(let a of this.children){if(a.isExcludedByFilter(b))continue;let f=d+a.length;if(f>=c){var e;return a.interpolateAlongEdge((c-(e=d))/(f-e),b)}d=f}return this.children[this.children.length-1].interpolateAlongEdge(1,b)}uninterpolateAlongEdge(a,b){var c;let d=this.getLength(b),e=null,f=1/0,g=0;for(let c of this.children){if(c.isExcludedByFilter(b))continue;let d=g+c.getLength(b),h=c.distanceToPoint(a,!1,b);h<f&&(f=h,e={startLength:g,endLength:d,child:c}),g=d}cd(e);let h=e.child.uninterpolateAlongEdge(a,b);return c=e.startLength,(c+(e.endLength-c)*h)/d}transform(a){return new kI({children:this.children.map(b=>b.transform(a)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let a="";for(let b of this.children)a+=b.toSimpleSvgPath();let b=kt.FromPoints(this.boundsVertices).corners;for(let c=0,d=b.length;c<d;c++){let e=b[c],f=b[(c-1+d)%d],g=e.dist(f),h=b[(c+1)%d],i=e.dist(h),j=e.clone().lrp(f,4/g),k=e.clone().lrp(h,4/i);a+=`M${j.x},${j.y} L${e.x},${e.y} L${k.x},${k.y} `}return a}getLength(a){let b=0;for(let c of this.children)c.isExcludedByFilter(a)||(b+=c.length);return b}getSvgPathData(){return this.children.map((a,b)=>a.isLabel?"":a.getSvgPathData(0===b)).join(" ")}overlapsPolygon(a){return this.children.some(b=>b.overlapsPolygon(a))}}class kJ extends kG{_start;_end;_d;_u;_ul;constructor(a){super({...a,isClosed:!1,isFilled:!1});const{start:b,end:c}=a;this._start=b,this._end=c,this._d=b.clone().sub(c),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(a){let{_start:b,_end:c,_d:d,_u:e,_ul:f}=this;if(0===d.len()||0===f)return b;let g=iK.Sub(a,b).dpr(e)/f,h=b.x+e.x*g;if(h<Math.min(b.x,c.x))return b.x<c.x?b:c;if(h>Math.max(b.x,c.x))return b.x>c.x?b:c;let i=b.y+e.y*g;return i<Math.min(b.y,c.y)?b.y<c.y?b:c:i>Math.max(b.y,c.y)?b.y>c.y?b:c:new iK(h,i)}getSvgPathData(a=!0){let{_start:b,_end:c}=this;return`${a?`M${b.toFixed()}`:""} L${c.toFixed()}`}}class kK extends kG{_points;_segments;constructor(a){super({isClosed:!1,isFilled:!1,...a});const{points:b}=a;if(this._points=b,b.length<2)throw Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];let{vertices:a}=this;for(let b=0,c=a.length-1;b<c;b++){let c=a[b],d=a[b+1];this._segments.push(new kJ({start:c,end:d}))}this.isClosed&&this._segments.push(new kJ({start:a[a.length-1],end:a[0]}))}return this._segments}getLength(){return this.segments.reduce((a,b)=>a+b.length,0)}getVertices(){return this._points}nearestPoint(a){let b,c,{segments:d}=this,e=this._points[0],f=1/0;for(let g=0;g<d.length;g++)b=d[g].nearestPoint(a),(c=iK.Dist2(b,a))<f&&(e=b,f=c);if(!e)throw Error("nearest point not found");return e}hitTestLineSegment(a,b,c=0){let{segments:d}=this;for(let e=0,f=d.length;e<f;e++)if(d[e].hitTestLineSegment(a,b,c))return!0;return!1}getSvgPathData(){let{vertices:a}=this;return a.length<2?"":a.reduce((a,b,c)=>0===c?`M ${b.x} ${b.y}`:`${a} L ${b.x} ${b.y}`,"")}}class kL extends kK{constructor(a){if(super({...a}),this.isClosed=!0,a.points.length<3)throw Error("Polygon2d: points must be an array of at least 3 points")}}class kM extends kL{_x;_y;_w;_h;constructor(a){const{x:b=0,y:c=0,width:d,height:e}=a;super({...a,points:[new iK(b,c),new iK(b+d,c),new iK(b+d,c+e),new iK(b,c+e)]}),this._x=b,this._y=c,this._w=d,this._h=e}getBounds(){return new kt(this._x,this._y,this._w,this._h)}getSvgPathData(){let{_x:a,_y:b,_w:c,_h:d}=this;return this.negativeZeroFix(),`M${a},${b} h${c} v${d} h${-c}z`}negativeZeroFix(){this._x=kN(this._x),this._y=kN(this._y),this._w=kN(this._w),this._h=kN(this._h)}}function kN(a){return Object.is(a,-0)?0:a}class kO{constructor(a){this.editor=a}static configure(a){return class extends this{options={...this.options,...a}}}options={};static props;static migrations;static type;useLegacyIndicator(){return!0}getIndicatorPath(a){}getFontFaces(a){return du}canSnap(a){return!0}canTabTo(a){return!0}canScroll(a){return!1}canBind(a){return!0}canEdit(a,b){return!1}canResize(a){return!0}canResizeChildren(a){return!0}canEditInReadonly(a){return!1}canEditWhileLocked(a){return!1}canCrop(a){return!1}canBeLaidOut(a,b){return!0}canCull(a){return!0}providesBackgroundForChildren(a){return!1}hideResizeHandles(a){return!1}hideRotateHandle(a){return!1}hideSelectionBoundsBg(a){return!1}hideSelectionBoundsFg(a){return!1}isAspectRatioLocked(a){return!1}isExportBoundsContainer(a){return!1}canReceiveNewChildrenOfType(a,b){return!1}expandSelectionOutlinePx(a){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(a){return{}}getHandleSnapGeometry(a){return{}}getText(a){}getAriaDescriptor(a){}}function kP(a,b,c={}){let{closed:d=!1,snap:e=1,start:f="outset",end:g="outset",lengthRatio:h=2,style:i="dashed",forceSolid:j=!1}=c,k=0,l=0,m=1,n=0,o=0;if(j)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(i){case"dashed":m=1,k=Math.min(b*h,a/4);break;case"dotted":k=b/(m=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return d||("outset"===f?(a+=k/2,o+=k/2):"skip"===f&&(a-=k,o-=k),"outset"===g?a+=k/2:"skip"===g&&(a-=k)),l=Math.floor(a/k/(2*m)),(l-=l%e)<3&&"dashed"===i?a/b<4?(k=a,l=1,n=0):(k=1/3*a,n=1/3*a):(k=a/l/(2*m),d?(o=k/2,n=(a-l*k)/l):n=(a-l*k)/Math.max(1,l-1)),{strokeDasharray:[k,n].join(" "),strokeDashoffset:o.toString()}}function kQ({bounds:a,className:b}){let c=jA(),d=d8("zoom level",()=>c.getEfficientZoomLevel(),[c]);return(0,bS.jsx)("g",{className:b,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:a.sides.map((a,b)=>{let{strokeDasharray:c,strokeDashoffset:e}=kP(a[0].dist(a[1]),1/d,{style:"dashed",lengthRatio:4});return(0,bS.jsx)("line",{x1:a[0].x,y1:a[0].y,x2:a[1].x,y2:a[1].y,strokeDasharray:c,strokeDashoffset:e},b)})})}let kR=[class extends kO{static type="group";static props=h2;static migrations=h3;hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(a){let b=this.editor.getSortedChildIdsForParent(a.id);return 0===b.length?new kM({width:1,height:1,isFilled:!1}):new kI({children:b.map(a=>{let b=this.editor.getShape(a);return this.editor.getShapeGeometry(a).transform(this.editor.getShapeLocalTransform(b),{isLabel:!1})})})}component(a){let b=this.editor.getErasingShapeIds().includes(a.id),{hintingShapeIds:c}=this.editor.getCurrentPageState(),d=c.length>0&&c.some(b=>b!==a.id&&this.editor.isShapeOfType(this.editor.getShape(b),"group")),e=this.editor.getCurrentPageState().focusedGroupId!==a.id;if(!b&&(e||d))return null;let f=this.editor.getShapeGeometry(a).bounds;return(0,bS.jsx)(ks,{children:(0,bS.jsx)(kQ,{className:"tl-group",bounds:f})})}indicator(a){let b=this.editor.getShapeGeometry(a).bounds;return(0,bS.jsx)(kQ,{className:"",bounds:b})}onChildrenChange(a){let b=this.editor.getSortedChildIdsForParent(a.id);if(0===b.length){this.editor.getCurrentPageState().focusedGroupId===a.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([a.id]);return}if(1===b.length){this.editor.getCurrentPageState().focusedGroupId===a.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(b,a.parentId),this.editor.deleteShapes([a.id]);return}}}],kS=new Set(kR.map(a=>a.type));function kT(a){let b=[...kR],c=new Set;for(let d of a){if(kS.has(d.type))throw Error(`Shape type "${d.type}" is a core shapes type and cannot be overridden`);if(c.has(d.type))throw Error(`Shape type "${d.type}" is defined more than once`);b.push(d),c.add(d.type)}return b}var kU=a.i(715631),kV=a.i(454947);function kW(a,b){let c=new Map;return async function(d){let e=c.get(d);if(e)return e;let f=(async()=>{try{let c=await cm(d,b);return cd(c.ok),await a(c)}catch(a){return console.error(a),null}})();return c.set(d,f),f}}let kX=kW(async a=>await co.blobToDataUrl(await a.blob())),kY=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,kZ=/@font-face\s*{([^}]+)}/gi,k$=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,k_=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function k0(a,b){return Array.from(a.matchAll(kZ),a=>{let c=a[1],d=Array.from(c.matchAll(k$),a=>{let c=a[1]||a[2]||a[3];return{original:c,resolved:dh(c,b)?.href??null}}),e=new Set(Array.from(c.matchAll(k_),a=>(a[1]||a[2]||a[3]).toLowerCase()));return{fontFace:c,urls:d,fontFamilies:e}})}function k1(a){return!(a.startsWith("-")||a.startsWith("animation")||a.startsWith("transition"))&&"cursor"!==a&&"pointer-events"!==a&&"user-select"!==a&&"touch-action"!==a}var k2=Object.create,k3=Object.defineProperty,k4=Object.getOwnPropertyDescriptor,k5=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),k6=a=>{throw TypeError(a)},k7=(a,b,c)=>b in a?k3(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,k8=(a,b)=>k3(a,"name",{value:b,configurable:!0}),k9=["class","method","getter","setter","accessor","field","value","get","set"],la=a=>void 0!==a&&"function"!=typeof a?k6("Function expected"):a,lb=(a,b,c,d,e)=>({kind:k9[a],name:b,metadata:d,addInitializer:a=>c._?k6("Already initialized"):e.push(la(a||null))}),lc=(a,b)=>k7(b,k5("metadata"),a[3]),ld=(a,b,c)=>k7(a,"symbol"!=typeof b?b+"":b,c),le=(a,b,c)=>b.has(a)||k6("Cannot "+c),lf=(a,b)=>Object(b)!==b?k6('Cannot use the "in" operator on this value'):a.has(b),lg=(a,b,c)=>(le(a,b,"read from private field"),c?c.call(a):b.get(a)),lh=(a,b,c,d)=>(le(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),li=(a,b,c)=>(le(a,b,"access private method"),c);let lj="tldraw-svg-export";E=[ch];class lk{constructor(){((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(F,5,this),ld(this,"fontFacesPromise",null),ld(this,"foundFontNames",new Set),ld(this,"fontFacesToEmbed",new Set),ld(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){cd(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=ll()}onFontFamilyValue(a){for(let b of(cd(this.fontFacesPromise,"FontEmbedder not started"),function(a){let b=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,c=/\s*,\s*/gi,d=new Set;for(;;){let e=b.exec(a);if(!e)break;let f=e[1]||e[2]||e[3];if(d.add(f.toLowerCase()),c.lastIndex=b.lastIndex,!c.exec(a))break;b.lastIndex=c.lastIndex}return d}(a))){if(this.foundFontNames.has(b))return;this.foundFontNames.add(b),this.pendingPromises.push(this.fontFacesPromise.then(a=>{for(let c of a.filter(a=>a.fontFamilies.has(b)))if(!this.fontFacesToEmbed.has(c))for(let a of(this.fontFacesToEmbed.add(c),c.urls))a.resolved&&!a.embedded&&(a.embedded=kX(a.resolved))}))}}async createCss(){await Promise.all(this.pendingPromises);let a="";for(let b of this.fontFacesToEmbed){let c=`@font-face {${b.fontFace}}`;for(let a of b.urls){if(!a.embedded)continue;let b=await a.embedded;b&&(c=c.replace(a.original,b))}a+=c}return a}}async function ll(){let a=[];for(let b of Array.from(document.styleSheets).filter(a=>!a.ownerNode?.closest(`.${lj}`))){let c;try{c=b.cssRules}catch{}if(c){for(let c of b.cssRules)if(c instanceof CSSFontFaceRule)a.push(k0(c.cssText,b.href??document.baseURI));else if(c instanceof CSSImportRule){let b=new URL(c.href,c.parentStyleSheet?.href??document.baseURI);a.push(lm(b.href))}}else b.href&&a.push(lm(b.href))}return b4(await Promise.all(a)).flat()}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=k9[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&k4(l<4?e:{get[c](){return lg(this,f)},set[c](x){return lh(this,f,x)}},c));l?n&&l<4&&k8(f,(l>2?"set ":l>1?"get ":"")+c):k8(e,c);for(var t=d.length-1;t>=0;t--)j=lb(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>lf(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?lg:li)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>lh(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?la(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?k6("Object expected"):(la(g=h.get)&&(s.get=g),la(g=h.set)&&(s.set=g),la(g=h.init)&&q.unshift(g));return l||lc(a,e),s&&k3(e,c,s),n})(F=[,,,k2((void 0)??null)],1,"onFontFamilyValue",E,lk),lc(F,lk);let lm=kW(async a=>{var b,c;let d=(b=await a.text(),c=a.url,{imports:Array.from(b.matchAll(kY),a=>({url:a[1]||a[2]||a[3]||a[4]||a[5],extras:a[6]})),fontFaces:k0(b,c)}),e=await Promise.all(d.imports.map(({url:b})=>lm(new URL(b,a.url).href)));return[...d.fontFaces,...b4(e).flat()]}),ln=(a,b,{currentColor:c})=>"currentColor"===a||a===c,lo=(a,b,{parentStyles:c})=>c[b]===a,lp=a=>(b,c,{getStyle:d})=>{let e=d(`border-${a}-width`),f=d(`border-${a}-style`);return"0px"===e||"none"===f},lq={"border-block-end-color":ln,"border-block-start-color":ln,"border-bottom-color":ln,"border-inline-end-color":ln,"border-inline-start-color":ln,"border-left-color":ln,"border-right-color":ln,"border-top-color":ln,"caret-color":ln,"column-rule-color":ln,"outline-color":ln,"text-decoration":(a,b,{currentColor:c})=>"none solid currentColor"===a||a==="none solid "+c,"text-decoration-color":ln,"text-emphasis-color":ln,"border-collapse":lo,"border-spacing":lo,"caption-side":lo,cursor:lo,direction:lo,"empty-cells":lo,"font-family":lo,"font-size":lo,"font-style":lo,"font-variant":lo,"font-weight":lo,"font-size-adjust":lo,"font-stretch":lo,font:lo,"letter-spacing":lo,"line-height":lo,"list-style-image":lo,"list-style-position":lo,"list-style-type":lo,"list-style":lo,orphans:lo,"overflow-wrap":lo,quotes:lo,"stroke-linecap":lo,"stroke-linejoin":lo,"tab-size":lo,"text-align":lo,"text-align-last":lo,"text-indent":lo,"text-justify":lo,"text-shadow":lo,"text-transform":lo,visibility:lo,"white-space":lo,"white-space-collapse":lo,widows:lo,"word-break":lo,"word-spacing":lo,"word-wrap":lo,"border-top":lp("top"),"border-right":lp("right"),"border-bottom":lp("bottom"),"border-left":lp("left"),"border-block-end":lp("block-end"),"border-block-start":lp("block-start"),"border-inline-end":lp("inline-end"),"border-inline-start":lp("inline-start"),"border-top-style":lp("top"),"border-right-style":lp("right"),"border-bottom-style":lp("bottom"),"border-left-style":lp("left"),"border-block-end-style":lp("block-end"),"border-block-start-style":lp("block-start"),"border-inline-end-style":lp("inline-end"),"border-inline-start-style":lp("inline-start"),"border-top-width":lp("top"),"border-right-width":lp("right"),"border-bottom-width":lp("bottom"),"border-left-width":lp("left"),"border-block-end-width":lp("block-end"),"border-block-start-width":lp("block-start"),"border-inline-end-width":lp("inline-end")};function lr(a){if(a.shadowRoot)return a.shadowRoot.childNodes;if(function(a){var b;return"getRootNode"in a&&(b=a.getRootNode())instanceof lt(b).ShadowRoot&&a instanceof lt(a).HTMLSlotElement}(a)){let b=a.assignedNodes();if(b?.length)return b}return a.childNodes}function*ls(a){for(let c of lr(a)){var b;(b=c)instanceof lt(b).Element&&(yield c)}}function lt(a){return a.ownerDocument?.defaultView??globalThis}function lu(a,b){return lt(a).getComputedStyle(a,b)}let lv={};class lw{constructor(a){this.root=a}styles=new Map;fonts=new lk;readRootElementStyles(a){this.readElementStyles(a,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});let b=Array.from(ls(a));for(;b.length;){let a=b.pop();b.push(...ls(a)),this.readElementStyles(a,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(a,{shouldRespectDefaults:b=!0,shouldSkipInheritedParentStyles:c=!0}){let d=b?function(a){let b=lB[a];if(!b){let{foreignObject:c,document:d}=function(){if(!f){let a=document.createElement("iframe");a.style.display="none",document.body.appendChild(a);let b=ce(a.contentDocument,"frame must have a document"),c=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.appendChild(d),b.body.appendChild(c),f={iframe:a,foreignObject:d,document:b}}return f}(),e=d.createElement(a);c.appendChild(e),b=e.computedStyleMap?ly(e.computedStyleMap(),lC):lz(lu(e),lC),c.removeChild(e),lB[a]=b}return b}(a.tagName.toLowerCase()):lv,e=Object.assign({},lv);if(c){let b=a.parentElement;for(;b;){let a=this.styles.get(b)?.self;for(let b in a)e[b]||(e[b]=a[b]);b=b.parentElement}}let g={self:function(a,{defaultStyles:b,parentStyles:c}){return a.computedStyleMap?ly(a.computedStyleMap(),{defaultStyles:b,parentStyles:c}):lz(lu(a),{defaultStyles:b,parentStyles:c})}(a,{defaultStyles:d,parentStyles:e}),before:lx(a,"::before"),after:lx(a,"::after")};this.styles.set(a,g)}fetchResources(){let a=[];for(let b of this.styles.values())for(let c of cH(b))if(c)for(let[b,d]of Object.entries(c)){if(!d)continue;"font-family"===b&&this.fonts.onFontFamilyValue(d);let e=Array.from(d.matchAll(k$),a=>({original:a[0],url:a[1]||a[2]||a[3]})).filter(a=>!a.url.startsWith("#"));0!==e.length&&a.push(...e.map(async({url:a,original:e})=>{let f=await kX(a)??"data:";c[b]=d.replace(e,`url("${f}")`)}))}return Promise.all(a)}unwrapCustomElements(){let a=new Set,b=(c,d)=>{if(a.has(c))return;a.add(c);let e=c.shadowRoot;if(e){let a=document.createElement("div");for(let f of(this.styles.set(a,this.styles.get(c)),a.setAttribute("data-tl-custom-element",c.tagName),(d??c.parentElement).appendChild(a),e.childNodes))f instanceof Element?b(f,a):a.appendChild(f.cloneNode(!0));c.remove()}else if(d){if("style"===c.tagName.toLowerCase())return;let a=c.cloneNode(!1);for(let e of(this.styles.set(a,this.styles.get(c)),d.appendChild(a),lr(c)))e instanceof Element?b(e,a):a.appendChild(e.cloneNode(!0))}};for(let a of this.styles.keys())b(a,null)}embedStyles(){let a="";for(let[b,c]of this.styles){if(c.after||c.before){let d=`pseudo-${cs(void 0)}`;b.classList.add(d),c.before&&(a+=`.${d}::before {${lA(c.before)}}
`),c.after&&(a+=`.${d}::after {${lA(c.after)}}
`)}let d=b.style;for(let[a,b]of Object.entries(c.self))b&&d.setProperty(a,b);"auto"===d.fontKerning&&(d.fontKerning="normal")}return a}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){f&&(document.body.removeChild(f.iframe),f=void 0)}}function lx(a,b){let c=lu(a,b),d=c.getPropertyValue("content");if(""!==d&&"none"!==d)return lz(c,{defaultStyles:lv,parentStyles:lv})}function ly(a,{defaultStyles:b,parentStyles:c}){let d={},e={currentColor:a.get("color")?.toString()||"",parentStyles:c,defaultStyles:b,getStyle:b=>a.get(b)?.toString()??""};for(let c of a.keys()){if(!k1(c))continue;let f=a.get(c).toString();if(b[c]===f)continue;let g=cF(lq,c);g&&g(f,c,e)||(d[c]=f)}return d}function lz(a,{defaultStyles:b,parentStyles:c}){let d={},e={currentColor:a.color,parentStyles:c,defaultStyles:b,getStyle:b=>a.getPropertyValue(b)};for(let c in a){if(!k1(c))continue;let f=a.getPropertyValue(c);if(b[c]===f)continue;let g=cF(lq,c);g&&g(f,c,e)||(d[c]=f)}return d}function lA(a){let b="";for(let[c,d]of Object.entries(a))b+=`${c}: ${d};`;return b}let lB={},lC={defaultStyles:lv,parentStyles:lv};function lD(a,b){return a.replaceWith(b),b}async function lE(a,b){let c=document.createElement("img");b&&Array.from(b.attributes).forEach(a=>{c.setAttribute(a.name,a.value)}),c.setAttribute("src",a??"data:"),c.setAttribute("decoding","sync"),c.setAttribute("loading","eager");try{await c.decode()}catch{}return c}async function lF(a){try{let b=a.toDataURL();return await lE(b,a)}catch{return await lE(null,a)}}async function lG(a){try{let b=await cB.getVideoFrameAsDataUrl(a);return lE(b,a)}catch(a){console.error("Could not get video frame",a)}return a.poster?lE(await kX(a.poster),a):lE(null,a)}async function lH(a){if(a instanceof HTMLCanvasElement)return lD(a,await lF(a));if(a instanceof HTMLVideoElement)return lD(a,await lG(a));if(a instanceof HTMLImageElement){let b=a.currentSrc||a.src,c=await kX(b);a.setAttribute("src",c??"data:"),a.setAttribute("decoding","sync"),a.setAttribute("loading","eager");try{await a.decode()}catch{}return a}a instanceof HTMLInputElement?a.setAttribute("value",a.value):a instanceof HTMLTextAreaElement&&(a.textContent=a.value);await Promise.all(Array.from(ls(a),a=>lH(a)))}let lI=(0,bT.createContext)(null);function lJ({children:a}){let b=(0,bT.useRef)(new Map),c=(0,bT.useCallback)((a,c,d,e)=>{let f=e?"none":"block";jp(c,"display",f),jp(d,"display",f),b.current.set(a,{container:c,bgContainer:d,isCulled:e})},[]),d=(0,bT.useCallback)(a=>{b.current.delete(a)},[]),e=(0,bT.useCallback)(a=>{for(let[c,d]of b.current){let b=a.has(c);if(b!==d.isCulled){let a=b?"none":"block";jp(d.container,"display",a),jp(d.bgContainer,"display",a),d.isCulled=b}}},[]),f=(0,bT.useMemo)(()=>({register:c,unregister:d,updateCulling:e}),[c,d,e]);return(0,bS.jsx)(lI.Provider,{value:f,children:a})}function lK(){let a=(0,bT.useContext)(lI);if(!a)throw Error("useShapeCulling must be used within ShapeCullingProvider");return a}let lL=(a,b)=>a.props===b.props&&a.meta===b.meta,lM=(0,bT.memo)(function({id:a,shape:b,util:c,index:d,backgroundIndex:e,opacity:f}){let g=jA(),{ShapeErrorFallback:h,ShapeWrapper:i}=q_(),j=(0,bT.useRef)(null),k=(0,bT.useRef)(null);(0,bT.useEffect)(()=>dA("load fonts",()=>{let b=g.fonts.getShapeFontFaces(a);g.fonts.requestFonts(b)}),[g,a]);let l=(0,bT.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0});d6("set shape stuff",()=>{let b=g.getShape(a);if(!b)return;let c=l.current,d=g.getShapeClipPath(a)??"none";d!==c.clipPath&&(jp(j.current,"clip-path",d),jp(k.current,"clip-path",d),c.clipPath=d);let e=g.getShapePageTransform(a),f=ku.toCssString(e),h=g.getShapeGeometry(b).bounds;f!==c.transform&&(jp(j.current,"transform",f),jp(k.current,"transform",f),c.transform=f);let i=Math.max(h.width,1),m=Math.max(h.height,1);(i!==c.width||m!==c.height)&&(jp(j.current,"width",i+"px"),jp(j.current,"height",m+"px"),jp(k.current,"width",i+"px"),jp(k.current,"height",m+"px"),c.width=i,c.height=m)},[g]),(0,bT.useLayoutEffect)(()=>{let a=j.current,b=k.current;jp(a,"opacity",f),jp(b,"opacity",f),jp(a,"z-index",d),jp(b,"z-index",e)},[f,d,e]);let{register:m,unregister:n}=lK();(0,bT.useLayoutEffect)(()=>{let b=j.current;if(!b)return;let c=g.getCulledShapes().has(a);return m(a,b,k.current,c),()=>{n(a)}},[g,a,m,n]);let o=(0,bT.useCallback)(a=>g.annotateError(a,{origin:"shape",willCrashApp:!1}),[g]);return b&&i?(0,bS.jsxs)(bS.Fragment,{children:[c.backgroundComponent&&(0,bS.jsx)(i,{ref:k,shape:b,isBackground:!0,children:(0,bS.jsx)(jP,{fallback:h,onError:o,children:(0,bS.jsx)(lO,{shape:b,util:c})})}),(0,bS.jsx)(i,{ref:j,shape:b,isBackground:!1,children:(0,bS.jsx)(jP,{fallback:h,onError:o,children:(0,bS.jsx)(lN,{shape:b,util:c})})})]}):null}),lN=(0,bT.memo)(function({shape:a,util:b}){return d_("InnerShape:"+a.type,()=>b.component(b.editor.store.unsafeGetWithoutCapture(a.id)),[b,a.id])},(a,b)=>lL(a.shape,b.shape)&&a.util===b.util),lO=(0,bT.memo)(function({shape:a,util:b}){return d_("InnerShape:"+a.type,()=>b.backgroundComponent?.(b.editor.store.unsafeGetWithoutCapture(a.id)),[b,a.id])},(a,b)=>a.shape.props===b.shape.props&&a.shape.meta===b.shape.meta&&a.util===b.util);function lP(a){let b=(0,bT.useRef)(void 0);return(0,bT.useLayoutEffect)(()=>{b.current=a}),(0,bT.useDebugValue)(a),(0,bT.useCallback)((...a)=>{let c=b.current;return cd(c,"fn does not exist"),c(...a)},[])}let lQ=(0,bT.createContext)(null);function lR({context:a,editor:b,children:c}){let d=b.options.exportProvider;return(0,bS.jsx)(jC,{editor:b,children:(0,bS.jsx)(jF,{container:b.getContainer(),children:(0,bS.jsx)(lQ.Provider,{value:a,children:(0,bS.jsx)(d,{children:c})})})})}function lS(){return(0,bT.useContext)(lQ)}var lT=Object.create,lU=Object.defineProperty,lV=Object.getOwnPropertyDescriptor,lW=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),lX=a=>{throw TypeError(a)},lY=(a,b,c)=>b in a?lU(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lZ=(a,b)=>lU(a,"name",{value:b,configurable:!0}),l$=["class","method","getter","setter","accessor","field","value","get","set"],l_=a=>void 0!==a&&"function"!=typeof a?lX("Function expected"):a,l0=(a,b,c,d,e)=>({kind:l$[a],name:b,metadata:d,addInitializer:a=>c._?lX("Already initialized"):e.push(l_(a||null))}),l1=(a,b)=>lY(b,lW("metadata"),a[3]),l2=(a,b,c)=>lY(a,"symbol"!=typeof b?b+"":b,c),l3=(a,b,c)=>b.has(a)||lX("Cannot "+c),l4=(a,b)=>Object(b)!==b?lX('Cannot use the "in" operator on this value'):a.has(b),l5=(a,b,c)=>(l3(a,b,"read from private field"),c?c.call(a):b.get(a)),l6=(a,b,c,d)=>(l3(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),l7=(a,b,c)=>(l3(a,b,"access private method"),c);G=[ch];class l8{constructor(a){this.maxDelayTimeMs=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(H,5,this),l2(this,"isResolved",!1),l2(this,"promisesToWaitFor",[])}waitUntil(a){if(this.isResolved)throw Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(a.catch(a=>console.error("Error while waiting for export:",a)))}async resolvePromises(){let a=null;for(;this.promisesToWaitFor.length!==a;)a=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await cg(0)}async resolve(){let a=cg(this.maxDelayTimeMs).then(()=>"timeout"),b=this.resolvePromises().then(()=>"resolved");"timeout"===await Promise.race([a,b])&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}function l9({editor:a,preserveAspectRatio:b,scale:c,pixelRatio:d,bbox:e,background:f,singleFrameShapeId:g,isDarkMode:h,renderingShapes:i,onMount:j,waitUntil:k}){let l=ju(),m=gq({isDarkMode:h}),n=d4("export state",{defsById:{},shapeElements:null}),{defsById:o,shapeElements:p}=d8(n),q=lP(a=>{n.update(b=>{if(cE(b.defsById,a.key))return b;let c=Promise.resolve(a.getElement());return k(c.then(b=>{n.update(c=>({...c,defsById:{...c.defsById,[a.key]:{pending:!1,element:b}}}))})),{...b,defsById:{...b.defsById,[a.key]:{pending:!0,element:c}}}})}),r=(0,bT.useMemo)(()=>({isDarkMode:h,waitUntil:k,addExportDef:q,scale:c,pixelRatio:d,async resolveAssetUrl(b,e){let f=a.getAsset(b);return f&&("image"===f.type||"video"===f.type)?await a.resolveAssetUrl(b,{screenScale:c*(e/f.props.w),shouldResolveToOriginal:null===d,dpr:d??void 0}):null}}),[h,k,q,c,d,a]),s=(0,bT.useRef)(!1);(0,bT.useLayoutEffect)(()=>{if(s.current)throw Error("SvgExport should only render once - do not use with react strict mode");s.current=!0,(async()=>{let b={},c=i.map(async({id:c,opacity:d,index:f,backgroundIndex:h})=>{if(c===g)return[];let i=a.getShape(c);if(a.isShapeOfType(i,"group"))return[];let j=[],k=a.getShapeUtil(i);if(k.toSvg||k.toBackgroundSvg){let[c,e]=await Promise.all([k.toSvg?.(i,r),k.toBackgroundSvg?.(i,r)]),g=a.getShapePageTransform(i),m=g.toCssString(),n=1;"scale"in i.props&&1!==i.props.scale&&(n=i.props.scale,m=`${m} scale(${i.props.scale}, ${i.props.scale})`);let o=a.getShapeMask(i.id),p=o?ku.From(ku.Inverse(g)).applyToPoints(o):null,q=jt(l,i.id);p&&(b[q]={pending:!1,element:(0,bS.jsx)("clipPath",{id:q,children:(0,bS.jsx)("path",{d:`M${p.map(({x:a,y:b})=>`${a/n},${b/n}`).join("L")}Z`})})}),c&&j.push({zIndex:f,element:(0,bS.jsx)("g",{transform:m,opacity:d,clipPath:o?`url(#${q})`:void 0,children:c},`fg_${i.id}`)}),e&&j.push({zIndex:h,element:(0,bS.jsx)("g",{transform:m,opacity:d,clipPath:o?`url(#${q})`:void 0,children:e},`bg_${i.id}`)})}else j.push({zIndex:f,element:(0,bS.jsx)(ma,{shape:i,util:k,component:lN,className:"tl-shape",bbox:e,opacity:d},`fg_${i.id}`)}),k.backgroundComponent&&j.push({zIndex:h,element:(0,bS.jsx)(ma,{shape:i,util:k,component:lO,className:"tl-shape tl-shape-background",bbox:e,opacity:d},`bg_${i.id}`)});return j}),d=(await Promise.all(c)).flat();(0,kU.flushSync)(()=>{n.update(a=>({...a,shapeElements:d.sort((a,b)=>a.zIndex-b.zIndex).map(({element:a})=>a),defsById:{...a.defsById,...b}}))})})()},[e,a,r,l,i,g,n]),(0,bT.useEffect)(()=>{let b=new Set;for(let{id:c}of i)for(let d of a.fonts.getShapeFontFaces(c))b.add(d);for(let c of b)q({key:cs(void 0),getElement:async()=>{let b=await a.fonts.toEmbeddedCssDeclaration(c);return(0,bS.jsx)("style",{nonce:a.options.nonce,children:b})}})},[a,i,q]),(0,bT.useEffect)(()=>{null!==p&&j()},[j,p]);let t=f?m.background:"transparent";if(g&&f){let b=a.getShapeUtil("frame");t=b?.options.showColors?gu(m,a.getShape(g).props.color,"frameFill"):m.solid}return(0,bS.jsx)(lR,{editor:a,context:r,children:(0,bS.jsxs)("svg",{preserveAspectRatio:b,direction:"ltr",width:e.width*c,height:e.height*c,viewBox:`${e.minX} ${e.minY} ${e.width} ${e.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:t},"data-color-mode":h?"dark":"light",className:`tl-container tl-theme__force-sRGB ${h?"tl-theme__dark":"tl-theme__light"}`,children:[(0,bS.jsx)("defs",{children:Object.entries(o).map(([a,b])=>b.pending?null:(0,bS.jsx)(bT.Fragment,{children:b.element},a))}),p]})})}function ma({shape:a,util:b,className:c,component:d,bbox:e,opacity:f}){let g=jA(),h=ku.Translate(-e.minX,-e.minY).multiply(g.getShapePageTransform(a.id)),i=g.getShapeGeometry(a.id).bounds,j=Math.max(i.width,1),k=Math.max(i.height,1);return(0,bS.jsx)(jO,{fallback:()=>null,children:(0,bS.jsx)("foreignObject",{x:e.minX,y:e.minY,width:e.w,height:e.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:(0,bS.jsx)("div",{className:c,"data-shape-type":a.type,style:{clipPath:g.getShapeClipPath(a.id),transform:h.toCssString(),width:j,height:k,opacity:f},children:(0,bS.jsx)(d,{shape:a,util:b})})})})}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=l$[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&lV(l<4?e:{get[c](){return l5(this,f)},set[c](x){return l6(this,f,x)}},c));l?n&&l<4&&lZ(f,(l>2?"set ":l>1?"get ":"")+c):lZ(e,c);for(var t=d.length-1;t>=0;t--)j=l0(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>l4(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?l5:l7)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>l6(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?l_(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?lX("Object expected"):(l_(g=h.get)&&(s.get=g),l_(g=h.set)&&(s.set=g),l_(g=h.init)&&q.unshift(g));return l||l1(a,e),s&&lU(e,c,s),n})(H=[,,,lT((void 0)??null)],1,"waitUntil",G,l8),l1(H,l8);let mb=1;async function mc(a,b,c={}){let d=function(a,b,c={}){if(!window.document)throw Error("No document");let{scale:d=1,background:e=a.getInstanceState().exportBackground,padding:f=a.options.defaultSvgPadding,preserveAspectRatio:g}=c,h=c.darkMode??a.user.getIsDarkMode(),i=a.getShapeAndDescendantIds(b),j=a.getUnorderedRenderingShapes(!1).filter(({id:a})=>i.has(a)),k=1===b.length&&a.isShapeOfType(a.getShape(b[0]),"frame")?b[0]:null,l=null;if(!(l=c.bounds?c.bounds.clone().expandBy(f):function(a,b,c,d){let e=!1,f=null;for(let{id:c}of b){let b=a.getShapeMaskedPageBounds(c);if(!b)continue;let d=a.getShape(c),g=a.getShapeUtil(d).isExportBoundsContainer(d);f?g&&kt.ContainsApproximately(b,f)?(e=!0,f=b.clone()):(e&&!kt.ContainsApproximately(f,b)&&(e=!1),f.union(b)):(e=g,f=b.clone())}return f?(d||e||f.expandBy(c),f):null}(a,j,f,k)))return;let m=l.width*d,n=l.height*d;try{document.body.focus?.()}catch{}let o=new l8(a.options.maxExportDelayMs),p=cf();return o.waitUntil(p),{jsx:(0,bS.jsx)(l9,{editor:a,preserveAspectRatio:g,scale:d,pixelRatio:c.pixelRatio??null,bbox:l,background:e,singleFrameShapeId:k,isDarkMode:h,renderingShapes:j,onMount:p.resolve,waitUntil:o.waitUntil}),width:m,height:n,exportDelay:o}}(a,b,c);if(!d)return;let e=a.getContainer(),f=document.createElement("div");f.className=lj,f.inert=!0,f.tabIndex=-1,Object.assign(f.style,{position:"absolute",top:"0px",left:"0px",width:d.width+"px",height:d.height+"px",pointerEvents:"none",opacity:0}),e.appendChild(f);let g=(0,kV.createRoot)(f,{identifierPrefix:`export_${mb++}_`});try{await Promise.resolve(),(0,kU.flushSync)(()=>{g.render(d.jsx)}),await d.exportDelay.resolve();let a=f.firstElementChild;return cd(a instanceof SVGSVGElement,"Expected an SVG element"),await md(a),{svg:a,width:d.width,height:d.height}}finally{setTimeout(()=>{g.unmount(),e.removeChild(f)},0)}}async function md(a){let b=[...a.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!b.length)return;let c=new lw(a);try{for(let a of(c.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(b.map(a=>lH(a))),b))c.readRootElementStyles(a);await c.fetchResources();let d=await c.getFontFaceCss();c.unwrapCustomElements();let e=c.embedStyles();if(d||e){let b=document.createElementNS("http://www.w3.org/2000/svg","style");b.textContent=`${d}
${e}`,a.prepend(b)}}finally{c.dispose()}}let me=null,mf={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function mg(a){let b=document.createElement("canvas");b.width=1,b.height=1;let c=b.getContext("2d");for(let d of mf[a]){let e="height"===a?1:d,f="width"===a?1:d,g=document.createElement("canvas");g.width=e,g.height=f,g.getContext("2d").fillRect(e-1,f-1,1,1),c.drawImage(g,e-1,f-1,1,1,0,0,1,1);let h=0!==c.getImageData(0,0,1,1).data[3];if(g.width=0,g.height=0,h){if(b.width=0,b.height=0,"area"===a)return d*d;return d}}throw b.width=0,b.height=0,Error("Failed to determine maximum canvas dimension")}async function mh(a,b){let{type:c,width:d,height:e,quality:f=1,pixelRatio:g=2}=b,[h,i]=function(a,b){if(a<=8192&&b<=8192&&a*b<=0x1000000)return[a,b];let{maxWidth:c,maxHeight:d,maxArea:e}=(me||(me={maxWidth:mg("width"),maxHeight:mg("height"),maxArea:mg("area")}),me),f=a/b;if(a>c&&(b=(a=c)/f),b>d&&(a=(b=d)*f),a*b>e){let c=Math.sqrt(e/(a*b));a*=c,b*=c}return[a,b]}(d*g,e*g);h=Math.floor(h),i=Math.floor(i);let j=h/d,k=await co.blobToDataUrl(new Blob([a],{type:"image/svg+xml"})),l=await new Promise(a=>{let b=cn();b.crossOrigin="anonymous",b.onload=async()=>{let c=document.createElement("canvas"),d=c.getContext("2d");c.width=h,c.height=i,d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(b,0,0,h,i),URL.revokeObjectURL(k),a(c)},b.onerror=()=>{a(null)},b.src=k});if(!l)return null;let m=await new Promise(a=>l.toBlob(b=>{(!b||ji.throwToBlob.get())&&a(null),a(b)},"image/"+c,f));if(!m)return null;if("png"!==c)return m;{let a=new DataView(await m.arrayBuffer());return cv.setPhysChunk(a,j,{type:"image/"+c})}}let mi={menus:d$("open menus",[]),getOpenMenus(a){return a?this.menus.get().filter(b=>b.endsWith("-"+a)):this.menus.get()},addOpenMenu(a,b=""){let c=b?`${a}-${b}`:a,d=new Set(this.menus.get());d.has(c)||(d.add(c),this.menus.set([...d]))},deleteOpenMenu(a,b=""){let c=b?`${a}-${b}`:a,d=new Set(this.menus.get());d.has(c)&&(d.delete(c),this.menus.set([...d]))},clearOpenMenus(a){this.menus.set(a?this.menus.get().filter(b=>!b.endsWith("-"+a)):[])},_hiddenMenus:[],hideOpenMenus(a){if(this._hiddenMenus=[...this.getOpenMenus(a)],0!==this._hiddenMenus.length)for(let b of this._hiddenMenus)this.deleteOpenMenu(b,a)},showOpenMenus(a){if(0!==this._hiddenMenus.length){for(let b of this._hiddenMenus)this.addOpenMenu(b,a);this._hiddenMenus=[]}},isMenuOpen(a,b){return this.getOpenMenus(b).includes(`${a}-${b}`)},hasOpenMenus(a){return this.getOpenMenus(a).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(a){return{getOpenMenus:()=>this.getOpenMenus(a),addOpenMenu:b=>this.addOpenMenu(b,a),deleteOpenMenu:b=>this.deleteOpenMenu(b,a),clearOpenMenus:()=>this.clearOpenMenus(a),isMenuOpen:b=>this.isMenuOpen(b,a),hasOpenMenus:()=>this.hasOpenMenus(a),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},mj=new dg,mk={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,uiDragDistanceSquared:16,uiCoarseDragDistanceSquared:625,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,laserFadeoutMs:500,maxExportDelayMs:5e3,tooltipDelayMs:700,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:bT.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0,debouncedZoom:!0,debouncedZoomThreshold:500,spacebarPanning:!0,zoomToFitPadding:128,snapThreshold:8,camera:jd,text:{},deepLinks:void 0,quickZoomPreservesScreenBounds:!0};function ml(a,b){if(!b)return!1;switch(a.type){case"mixed":return"mixed"===b.type;case"shared":return"shared"===b.type&&a.value===b.value;default:throw cc(a)}}class mm{map;constructor(a){this.map=new Map(a)}get(a){return this.map.get(a)}getAsKnownValue(a){let b=this.get(a);if(b&&"mixed"!==b.type)return b.value}get size(){return this.map.size}equals(a){if(this.size!==a.size)return!1;let b=new Set;for(let[c,d]of this){if(!ml(d,a.get(c)))return!1;b.add(c)}for(let[c,d]of a)if(!b.has(c)&&!ml(d,this.get(c)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class mn extends mm{set(a,b){this.map.set(a,b)}applyValue(a,b){let c=this.get(a);if(!c)return void this.set(a,{type:"shared",value:b});switch(c.type){case"mixed":return;case"shared":c.value!==b&&this.set(a,{type:"mixed"});return;default:cc(c,"type")}}}function mo(){return`https://cdn.tldraw.com/${jU}`}function mp(a){return encodeURIComponent(a).replace(/\./g,"%2E")}function mq(a,b,c,d){if(0===c.length)return[];let e=new Map;for(let b of b4(c.map(b=>a.getShape(b)))){let{parentId:c}=b;e.has(c)||e.set(c,{children:b4(a.getSortedChildIdsForParent(c).map(b=>a.getShape(b))),moving:new Set}),e.get(c).moving.add(b)}let f=[];switch(b){case"toBack":e.forEach(({moving:a,children:b})=>(function(a,b,c){let d,e,f=b.length;if(a.size!==f){for(let c=0;c<f;c++){let f=b[c];if(a.has(f))d=f.index,a.delete(f);else{e=f.index;break}}if(0===a.size)return;{let b=c1(d,e,a.size);c.push(...Array.from(a.values()).sort(c6).map((a,c)=>({...a,index:b[c]})))}}})(a,b,f));break;case"toFront":e.forEach(({moving:a,children:b})=>(function(a,b,c){let d,e,f=b.length;if(a.size!==f){for(let c=f-1;c>-1;c--){let f=b[c];if(a.has(f))e=f.index,a.delete(f);else{d=f.index;break}}if(0===a.size)return;{let b=c1(d,e,a.size);c.push(...Array.from(a.values()).sort(c6).map((a,c)=>({...a,index:b[c]})))}}})(a,b,f));break;case"forward":e.forEach(({moving:b,children:c})=>(function(a,b,c,d,e){let f=mr(a,b),g=c.length;if(b.size===g)return;let h={name:"skipping"};for(let a=0;a<g;a++){let g=b.has(c[a]);switch(h.name){case"skipping":if(!g)continue;h={name:"selecting",selectIndex:a};break;case"selecting":{if(g||!e?.considerAllShapes&&!f(c[a]))continue;let{selectIndex:i}=h;c1(c[a].index,c[a+1]?.index,a-i).forEach((a,e)=>{let f=c[i+e];b.has(f)&&d.push({...f,index:a})}),h={name:"skipping"}}}}})(a,b,c,f,d));break;case"backward":e.forEach(({moving:b,children:c})=>(function(a,b,c,d,e){let f=mr(a,b),g=c.length;if(b.size===g)return;let h={name:"skipping"};for(let a=g-1;a>-1;a--){let g=b.has(c[a]);switch(h.name){case"skipping":if(!g)continue;h={name:"selecting",selectIndex:a};break;case"selecting":if(g||!e?.considerAllShapes&&!f(c[a]))continue;c1(c[a-1]?.index,c[a].index,h.selectIndex-a).forEach((e,f)=>{let g=c[a+f+1];b.has(g)&&d.push({...g,index:e})}),h={name:"skipping"}}}})(a,b,c,f,d))}return f}function mr(a,b){let c=b4(Array.from(b).map(b=>{let c=a.getShapePageBounds(b);return c?{shape:b,bounds:c}:null}));return b=>{let d=a.getShapePageBounds(b);return!!d&&c.some(a=>a.bounds.includes(d))}}function ms({editor:a,ids:b}){let c=b4(b.map(b=>a.getShape(b))),d=a.getShapesSharedRotation(b),e=a.getShapesRotatedPageBounds(b);if(!e)return null;let f=e.center.clone().rotWith(e.point,d);return{initialPageCenter:f,initialCursorAngle:f.angle(a.inputs.getOriginPagePoint()),initialShapesRotation:d,shapeSnapshots:c.map(b=>({shape:b,initialPagePoint:a.getShapePageTransform(b.id).point()}))}}function mt({delta:a,editor:b,snapshot:c,stage:d,centerOverride:e}){let{initialPageCenter:f,shapeSnapshots:g}=c;b.updateShapes(g.map(({shape:c,initialPagePoint:d})=>{let g=gh(c.parentId)?b.getShapePageTransform(c.parentId):ku.Identity(),h=iK.RotWith(d,e??f,a),i=ku.applyToPoint(ku.Inverse(g),h),j=iW(c.rotation+a);return{id:c.id,type:c.type,x:i.x,y:i.y,rotation:j}}));let h=[];g.forEach(({shape:a})=>{let c=b.getShape(a.id);if(!c)return;let e=b.getShapeUtil(a);if("start"===d||"one-off"===d){let b=e.onRotateStart?.(a);b&&h.push(b)}let f=e.onRotate?.(a,c);if(f&&h.push(f),"end"===d||"one-off"===d){let b=e.onRotateEnd?.(a,c);b&&h.push(b)}}),h.length>0&&b.updateShapes(h)}function mu(a){let b=a.get(),c=new Map;for(let a of b){let{fromId:b,toId:d}=a,e=c.get(b);e?e.push(a):c.set(b,[a]);let f=c.get(d);f?f.push(a):c.set(d,[a])}return c}function mv(a,b){let c={};return Array.from(a.get(),a=>b.get(a)).sort(c6).forEach(a=>{c[a.parentId]??=[],c[a.parentId].push(a.id)}),c}let mw=(a,b,c)=>{for(;!g$(c.parentId);){let b=a.get(c.parentId);if(!b)return!1;c=b}return c.parentId===b};var mx=Object.create,my=Object.defineProperty,mz=Object.getOwnPropertyDescriptor,mA=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),mB=a=>{throw TypeError(a)},mC=(a,b,c)=>b in a?my(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mD=(a,b)=>my(a,"name",{value:b,configurable:!0}),mE=["class","method","getter","setter","accessor","field","value","get","set"],mF=a=>void 0!==a&&"function"!=typeof a?mB("Function expected"):a,mG=(a,b,c,d,e)=>({kind:mE[a],name:b,metadata:d,addInitializer:a=>c._?mB("Already initialized"):e.push(mF(a||null))}),mH=(a,b)=>mC(b,mA("metadata"),a[3]),mI=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=mE[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&mz(l<4?e:{get[c](){return mM(this,f)},set[c](x){return mN(this,f,x)}},c));l?n&&l<4&&mD(f,(l>2?"set ":l>1?"get ":"")+c):mD(e,c);for(var t=d.length-1;t>=0;t--)j=mG(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>mL(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?mM:mO)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>mN(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?mF(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?mB("Object expected"):(mF(g=h.get)&&(s.get=g),mF(g=h.set)&&(s.set=g),mF(g=h.init)&&q.unshift(g));return l||mH(a,e),s&&my(e,c,s),n?4^l?f:s:e},mJ=(a,b,c)=>mC(a,"symbol"!=typeof b?b+"":b,c),mK=(a,b,c)=>b.has(a)||mB("Cannot "+c),mL=(a,b)=>Object(b)!==b?mB('Cannot use the "in" operator on this value'):a.has(b),mM=(a,b,c)=>(mK(a,b,"read from private field"),c?c.call(a):b.get(a)),mN=(a,b,c,d)=>(mK(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),mO=(a,b,c)=>(mK(a,b,"access private method"),c);J=[ch],I=[ch];class mP{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(K,5,this),mJ(this,"_clickId",""),mJ(this,"_clickTimeout"),mJ(this,"_clickScreenPoint"),mJ(this,"_previousScreenPoint"),mJ(this,"_clickState","idle"),mJ(this,"lastPointerInfo",{})}_getClickTimeout(a,b=function(a){return cs(void 0)}()){this._clickId=b,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===a&&this._clickId===b){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===a||"pendingDouble"===a?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(a){switch(a.name){case"pointer_down":if(!this._clickState)break;switch(this._clickScreenPoint=iK.From(a.point),this._previousScreenPoint&&iK.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=a,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...a,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}this._clickTimeout=this._getClickTimeout(this._clickState);break;case"pointer_up":if(!this._clickState)break;switch(this._clickScreenPoint=iK.From(a.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}break;case"pointer_move":"idle"!==this._clickState&&this._clickScreenPoint&&iK.Dist2(this._clickScreenPoint,this.editor.inputs.getCurrentScreenPoint())>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout()}return a}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}mI(K=[,,,mx((void 0)??null)],1,"_getClickTimeout",J,mP),mI(K,1,"cancelDoubleClickTimeout",I,mP),mH(K,mP);class mQ{constructor(a){this.editor=a}_isEdgeScrolling=!1;_edgeScrollDuration=-1;getIsEdgeScrolling(){return this._isEdgeScrolling}updateEdgeScrolling(a){let{editor:b}=this;if(b.getCameraOptions().isLocked)return;let c=this.getEdgeScroll();if(0===c.x&&0===c.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=a,this._edgeScrollDuration>b.options.edgeScrollDelay){let a,d=b.options.edgeScrollEaseDuration>0?(a=Math.min(1,this._edgeScrollDuration/(b.options.edgeScrollDelay+b.options.edgeScrollEaseDuration)))*a*a:1;this.moveCameraWhenCloseToEdge({x:c.x*d,y:c.y*d})}}getEdgeProximityFactors(a,b,c,d,e){let{editor:f}=this,g=f.options.edgeScrollDistance,h=c?f.options.coarsePointerWidth:0,i=a-h,j=a+h,k=d?0:g,l=e?b:b-g;return i<k?Math.min(1,(k-i)/g):j>l?-Math.min(1,(j-l)/g):0}getEdgeScroll(){let{editor:a}=this,{x:b,y:c}=a.inputs.getCurrentScreenPoint(),d=a.getViewportScreenBounds(),{isCoarsePointer:e,insets:[f,g,h,i]}=a.getInstanceState();return{x:this.getEdgeProximityFactors(b,d.w,e,i,g),y:this.getEdgeProximityFactors(c,d.h,e,f,h)}}moveCameraWhenCloseToEdge(a){if(0===a.x&&0===a.y)return;let{editor:b}=this,c=b.getViewportScreenBounds(),d=c.w<1e3?.612:1,e=c.h<1e3?.612:1,f=b.getZoomLevel(),g=b.user.getEdgeScrollSpeed()*b.options.edgeScrollSpeed,h=g*a.x*d/f,i=g*a.y*e/f,{x:j,y:k,z:l}=b.getCamera();b.setCamera(new iK(j+h,k+i,l))}}class mR{constructor(a,b){this.editor=a,this.disposeSideEffectListener=a.sideEffects.registerAfterChangeHandler("instance",(a,b)=>{a.isFocused!==b.isFocused&&this.updateContainerClass()}),b!==a.getInstanceState().isFocused&&a.updateInstanceState({isFocused:!!b}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){let a=this.editor.getContainer();this.editor.getInstanceState().isFocused?a.classList.add("tl-container__focused"):a.classList.remove("tl-container__focused"),a.classList.add("tl-container__no-focus-ring")}handleKeyDown(a){let b=this.editor.getContainer(),c=document.activeElement;this.editor.isIn("select.editing_shape")&&!c?.closest(".tlui-contextual-toolbar")||(c!==b||!(this.editor.getSelectedShapeIds().length>0))&&["Tab","ArrowUp","ArrowDown"].includes(a.key)&&b.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}class mS{constructor(a,b){this.editor=a,this.assetUrls=b,this.shapeFontFacesCache=a.store.createComputedCache("shape font faces",a=>this.editor.getShapeUtil(a).getFontFaces(a),{areResultsEqual:b7,areRecordsEqual:(a,b)=>a.props===b.props&&a.meta===b.meta}),this.shapeFontLoadStateCache=a.store.createCache(a=>{let b=dQ("font faces",()=>this.getShapeFontFaces(a));return dQ("font load state",()=>b.get().map(a=>this.getFontState(a)),{isEqual:b7})})}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(a){let b="string"==typeof a?a:a.id;return this.shapeFontFacesCache.get(b)??du}trackFontsForShape(a){let b="string"==typeof a?a:a.id;this.shapeFontLoadStateCache.get(b)}async loadRequiredFontsForCurrentPage(a=1/0){let b=new Set;for(let a of this.editor.getCurrentPageShapeIds())for(let c of this.getShapeFontFaces(this.editor.getShape(a)))b.add(c);if(b.size>a)return;let c=Array.from(b,a=>this.ensureFontIsLoaded(a));await Promise.all(c)}fontStates=new eN("font states");getFontState(a){return this.fontStates.get(a)??null}ensureFontIsLoaded(a){let b=this.getFontState(a);if(b)return b.loadingPromise;let c=this.findOrCreateFontFace(a),d={state:"loading",instance:c,loadingPromise:c.load().then(()=>{document.fonts.add(c),this.fontStates.update(a,a=>({...a,state:"ready"}))}).catch(b=>{console.error(b),this.fontStates.update(a,a=>({...a,state:"error"}))})};return this.fontStates.set(a,d),d.loadingPromise}fontsToLoad=new Set;requestFonts(a){for(let b of(this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;let a=this.fontsToLoad;this.fontsToLoad=new Set,dH(()=>{for(let b of a)this.ensureFontIsLoaded(b)})}),a))this.fontsToLoad.add(b)}findOrCreateFontFace(a){for(let b of document.fonts)if(b.family===a.family&&cI(mT).every(([c,d])=>b[c]===(a[c]??d)))return b;let b=this.assetUrls?.[a.src.url]??a.src.url,c=new FontFace(a.family,`url(${JSON.stringify(b)})`,{...cL(mT,b=>a[b]),display:"swap"});return document.fonts.add(c),c}async toEmbeddedCssDeclaration(a){let b=this.assetUrls?.[a.src.url]??a.src.url,c=await co.urlToDataUrl(b),d=b4([`url("${c}")`,a.src.format?`format(${a.src.format})`:null,a.src.tech?`tech(${a.src.tech})`:null]).join(" ");return b4(["@font-face {",`  font-family: "${a.family}";`,a.ascentOverride?`  ascent-override: ${a.ascentOverride};`:null,a.descentOverride?`  descent-override: ${a.descentOverride};`:null,a.stretch?`  font-stretch: ${a.stretch};`:null,a.style?`  font-style: ${a.style};`:null,a.weight?`  font-weight: ${a.weight};`:null,a.featureSettings?`  font-feature-settings: ${a.featureSettings};`:null,a.lineGapOverride?`  line-gap-override: ${a.lineGapOverride};`:null,a.unicodeRange?`  unicode-range: ${a.unicodeRange};`:null,`  src: ${d};`,"}"]).join("\n")}}let mT={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};var mU=((s=mU||{}).Recording="recording",s.RecordingPreserveRedoStack="recordingPreserveRedoStack",s.Paused="paused",s);class mV{store;dispose;state="recording";pendingDiff=new mX;stacks=d$("HistoryManager.stacks",{undos:mY,redos:mY},{isEqual:(a,b)=>a.undos===b.undos&&a.redos===b.redos});annotateError;constructor(a){this.store=a.store,this.annotateError=a.annotateError??ca,this.dispose=this.store.addHistoryInterceptor((a,b)=>{if("user"===b)switch(this.state){case"recording":this.pendingDiff.apply(a.changes),this.stacks.update(({undos:a})=>({undos:a,redos:mY}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(a.changes);break;case"paused":break;default:cc(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;let a=this.pendingDiff.clear();this.stacks.update(({undos:b,redos:c})=>({undos:b.push({type:"diff",diff:a}),redos:c}))}getNumUndos(){return this.stacks.get().undos.length+ +!this.pendingDiff.isEmpty()}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(a,b){let c=this.state;"paused"!==c&&b?.history&&(this.state=mW[b.history]);try{if(this._isInBatch)return dH(a),this;this._isInBatch=!0;try{dH(a)}catch(a){throw this.annotateError(a),a}finally{this._isInBatch=!1}return this}finally{this.state=c}}_undo({pushToRedoStack:a,toMark:b}){let c=this.state;this.state="paused";try{let{undos:c,redos:d}=this.stacks.get(),e=this.pendingDiff.clear(),f=e0(e),g=e_(e);a&&!f&&(d=d.push({type:"diff",diff:e}));let h=!1;if(f)for(;c.head?.type==="stop";){let e=c.head;if(c=c.tail,a&&(d=d.push(e)),e.id===b){h=!0;break}}if(!h)e:for(;c.head;){let e=c.head;switch(c=c.tail,a&&(d=d.push(e)),e.type){case"diff":e2(g,[e_(e.diff)]);break;case"stop":if(!b)break e;if(e.id===b){h=!0;break e}break;default:cc(e)}}if(!h&&b)return this;this.store.applyDiff(g,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:c,redos:d})}finally{this.state=c}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){let a=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:a,redos:b}=this.stacks.get();if(0===b.length)return this;for(;b.head?.type==="stop";)a=a.push(b.head),b=b.tail;let c=e$();for(;b.head;){let d=b.head;if(a=a.push(d),b=b.tail,"diff"===d.type)e2(c,[d.diff]);else break}this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:a,redos:b})}finally{this.state=a}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(a){return a&&this._undo({pushToRedoStack:!1,toMark:a}),this}squashToMark(a){let b=this.stacks.get().undos,c=[];for(;b.head&&("stop"!==b.head.type||b.head.id!==a);)"diff"===b.head.type&&c.push(b.head.diff),b=b.tail;if(!b.head||b.head?.id!==a)return console.error("Could not find mark to squash to: ",a),this;if(0===c.length)return this;let d=e$();return e2(d,c.reverse()),this.stacks.update(({redos:a})=>({undos:b.push({type:"diff",diff:d}),redos:a})),this}_mark(a){dH(()=>{this.flushPendingDiff(),this.stacks.update(({undos:b,redos:c})=>({undos:b.push({type:"stop",id:a}),redos:c}))})}clear(){this.stacks.set({undos:mY,redos:mY}),this.pendingDiff.clear()}getMarkIdMatching(a){let b=this.stacks.get().undos;for(;b.head;){if("stop"===b.head.type&&b.head.id.includes(a))return b.head.id;b=b.tail}return null}debug(){let{undos:a,redos:b}=this.stacks.get();return{undos:m$(a),redos:m$(b),pendingDiff:this.pendingDiff.debug(),state:this.state}}}let mW={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class mX{diff=e$();isEmptyAtom=d$("PendingDiff.isEmpty",!0);clear(){let a=this.diff;return this.diff=e$(),this.isEmptyAtom.set(!0),a}isEmpty(){return this.isEmptyAtom.get()}apply(a){e2(this.diff,[a]),this.isEmptyAtom.set(e0(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}let mY=new class{length=0;head=null;tail=this;push(a){return new mZ(a,this)}};class mZ{constructor(a,b){this.head=a,this.tail=b,this.length=b.length+1}length;push(a){return new mZ(a,this)}}function m$(a){if(!a.length)return du;let b=[];for(;a.length;)b.push(a.head),a=a.tail;return b}var m_=Object.create,m0=Object.defineProperty,m1=Object.getOwnPropertyDescriptor,m2=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),m3=a=>{throw TypeError(a)},m4=(a,b,c)=>b in a?m0(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,m5=(a,b)=>m0(a,"name",{value:b,configurable:!0}),m6=["class","method","getter","setter","accessor","field","value","get","set"],m7=a=>void 0!==a&&"function"!=typeof a?m3("Function expected"):a,m8=(a,b,c,d,e)=>({kind:m6[a],name:b,metadata:d,addInitializer:a=>c._?m3("Already initialized"):e.push(m7(a||null))}),m9=(a,b)=>m4(b,m2("metadata"),a[3]),na=(a,b,c)=>m4(a,"symbol"!=typeof b?b+"":b,c),nb=(a,b,c)=>b.has(a)||m3("Cannot "+c),nc=(a,b)=>Object(b)!==b?m3('Cannot use the "in" operator on this value'):a.has(b),nd=(a,b,c)=>(nb(a,b,"read from private field"),c?c.call(a):b.get(a)),ne=(a,b,c,d)=>(nb(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),nf=(a,b,c)=>(nb(a,b,"access private method"),c);L=[dQ];class ng{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(M,5,this),na(this,"_originPagePoint",d$("originPagePoint",new iK)),na(this,"_originScreenPoint",d$("originScreenPoint",new iK)),na(this,"_previousPagePoint",d$("previousPagePoint",new iK)),na(this,"_previousScreenPoint",d$("previousScreenPoint",new iK)),na(this,"_currentPagePoint",d$("currentPagePoint",new iK)),na(this,"_currentScreenPoint",d$("currentScreenPoint",new iK)),na(this,"_pointerVelocity",d$("pointerVelocity",new iK)),na(this,"keys",new eO("keys")),na(this,"buttons",new eO("buttons")),na(this,"_isPen",d$("isPen",!1)),na(this,"_shiftKey",d$("shiftKey",!1)),na(this,"_metaKey",d$("metaKey",!1)),na(this,"_ctrlKey",d$("ctrlKey",!1)),na(this,"_altKey",d$("altKey",!1)),na(this,"_isDragging",d$("isDragging",!1)),na(this,"_isPointing",d$("isPointing",!1)),na(this,"_isPinching",d$("isPinching",!1)),na(this,"_isEditing",d$("isEditing",!1)),na(this,"_isPanning",d$("isPanning",!1)),na(this,"_isSpacebarPanning",d$("isSpacebarPanning",!1)),na(this,"_velocityPrevPoint",new iK)}getOriginPagePoint(){return this._originPagePoint.get()}get originPagePoint(){return this.getOriginPagePoint()}getOriginScreenPoint(){return this._originScreenPoint.get()}get originScreenPoint(){return this.getOriginScreenPoint()}getPreviousPagePoint(){return this._previousPagePoint.get()}get previousPagePoint(){return this.getPreviousPagePoint()}getPreviousScreenPoint(){return this._previousScreenPoint.get()}get previousScreenPoint(){return this.getPreviousScreenPoint()}getCurrentPagePoint(){return this._currentPagePoint.get()}get currentPagePoint(){return this.getCurrentPagePoint()}getCurrentScreenPoint(){return this._currentScreenPoint.get()}get currentScreenPoint(){return this.getCurrentScreenPoint()}getPointerVelocity(){return this._pointerVelocity.get()}get pointerVelocity(){return this.getPointerVelocity()}setPointerVelocity(a){this._pointerVelocity.set(a)}getIsPen(){return this._isPen.get()}get isPen(){return this.getIsPen()}set isPen(a){this.setIsPen(a)}setIsPen(a){this._isPen.set(a)}getShiftKey(){return this._shiftKey.get()}get shiftKey(){return this.getShiftKey()}set shiftKey(a){this.setShiftKey(a)}setShiftKey(a){this._shiftKey.set(a)}getMetaKey(){return this._metaKey.get()}get metaKey(){return this.getMetaKey()}set metaKey(a){this.setMetaKey(a)}setMetaKey(a){this._metaKey.set(a)}getCtrlKey(){return this._ctrlKey.get()}get ctrlKey(){return this.getCtrlKey()}set ctrlKey(a){this.setCtrlKey(a)}setCtrlKey(a){this._ctrlKey.set(a)}getAltKey(){return this._altKey.get()}get altKey(){return this.getAltKey()}set altKey(a){this.setAltKey(a)}setAltKey(a){this._altKey.set(a)}getAccelKey(){return jr({metaKey:this.getMetaKey(),ctrlKey:this.getCtrlKey()})}get accelKey(){return this.getAccelKey()}getIsDragging(){return this._isDragging.get()}get isDragging(){return this.getIsDragging()}set isDragging(a){this.setIsDragging(a)}setIsDragging(a){this._isDragging.set(a)}getIsPointing(){return this._isPointing.get()}get isPointing(){return this.getIsPointing()}set isPointing(a){this.setIsPointing(a)}setIsPointing(a){this._isPointing.set(a)}getIsPinching(){return this._isPinching.get()}get isPinching(){return this.getIsPinching()}set isPinching(a){this.setIsPinching(a)}setIsPinching(a){this._isPinching.set(a)}getIsEditing(){return this._isEditing.get()}get isEditing(){return this.getIsEditing()}set isEditing(a){this.setIsEditing(a)}setIsEditing(a){this._isEditing.set(a)}getIsPanning(){return this._isPanning.get()}get isPanning(){return this.getIsPanning()}set isPanning(a){this.setIsPanning(a)}setIsPanning(a){this._isPanning.set(a)}getIsSpacebarPanning(){return this._isSpacebarPanning.get()}get isSpacebarPanning(){return this.getIsSpacebarPanning()}set isSpacebarPanning(a){this.setIsSpacebarPanning(a)}setIsSpacebarPanning(a){this._isSpacebarPanning.set(a)}_getHasCollaborators(){return this.editor.getCollaborators().length>0}updatePointerVelocity(a){let b=this.getCurrentScreenPoint(),c=this.getPointerVelocity();if(0===a)return;let d=iK.Sub(b,this._velocityPrevPoint);this._velocityPrevPoint=b.clone();let e=d.len(),f=e?d.div(e):new iK(0,0),g=c.clone().lrp(f.mul(e/a),.5);.01>Math.abs(g.x)&&(g.x=0),.01>Math.abs(g.y)&&(g.y=0),c.equals(g)||this._pointerVelocity.set(g)}updateFromEvent(a){let b=this._currentScreenPoint.__unsafe__getWithoutCapture(),c=this._currentPagePoint.__unsafe__getWithoutCapture(),d=this._isPinching.__unsafe__getWithoutCapture(),{screenBounds:e}=this.editor.store.unsafeGetWithoutCapture(g3),{x:f,y:g,z:h}=dU(()=>this.editor.getCamera()),i=a.point.x-e.x,j=a.point.y-e.y,k=a.point.z??.5;this._previousScreenPoint.set(b),this._previousPagePoint.set(c),this._currentScreenPoint.set(new iK(i,j));let l=i/h-f,m=j/h-g;isFinite(l)&&isFinite(m)&&this._currentPagePoint.set(new iK(l,m,k)),this._isPen.set("pointer"===a.type&&a.isPen),("pointer_down"===a.name||d)&&(this._pointerVelocity.set(new iK),this._originScreenPoint.set(this._currentScreenPoint.__unsafe__getWithoutCapture()),this._originPagePoint.set(this._currentPagePoint.__unsafe__getWithoutCapture())),this._getHasCollaborators()&&this.editor.run(()=>{let b=this._currentPagePoint.__unsafe__getWithoutCapture();this.editor.store.put([{id:hb,typeName:"pointer",x:b.x,y:b.y,lastActivityTimestamp:"pointer"===a.type&&-10===a.pointerId?this.editor.store.unsafeGetWithoutCapture(hb)?.lastActivityTimestamp??Date.now():Date.now(),meta:{}}])},{history:"ignore"})}toJson(){return{originPagePoint:this._originPagePoint.get().toJson(),originScreenPoint:this._originScreenPoint.get().toJson(),previousPagePoint:this._previousPagePoint.get().toJson(),previousScreenPoint:this._previousScreenPoint.get().toJson(),currentPagePoint:this._currentPagePoint.get().toJson(),currentScreenPoint:this._currentScreenPoint.get().toJson(),pointerVelocity:this._pointerVelocity.get().toJson(),shiftKey:this._shiftKey.get(),metaKey:this._metaKey.get(),ctrlKey:this._ctrlKey.get(),altKey:this._altKey.get(),isPen:this._isPen.get(),isDragging:this._isDragging.get(),isPointing:this._isPointing.get(),isPinching:this._isPinching.get(),isEditing:this._isEditing.get(),isPanning:this._isPanning.get(),isSpacebarPanning:this._isSpacebarPanning.get(),keys:Array.from(this.keys.keys()),buttons:Array.from(this.buttons.keys())}}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=m6[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&m1(l<4?e:{get[c](){return nd(this,f)},set[c](x){return ne(this,f,x)}},c));l?n&&l<4&&m5(f,(l>2?"set ":l>1?"get ":"")+c):m5(e,c);for(var t=d.length-1;t>=0;t--)j=m8(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>nc(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?nd:nf)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>ne(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?m7(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?m3("Object expected"):(m7(g=h.get)&&(s.get=g),m7(g=h.set)&&(s.set=g),m7(g=h.init)&&q.unshift(g));return l||m9(a,e),s&&m0(e,c,s),n})(M=[,,,m_((void 0)??null)],1,"_getHasCollaborators",L,ng),m9(M,ng);class nh{constructor(a){this.editor=a}sessions=new Map;startSession(a={}){let b=a.id??cs(void 0),c={id:b,items:[],state:"active",options:{selfConsume:a.selfConsume??!0,idleTimeoutMs:a.idleTimeoutMs??0,fadeMode:a.fadeMode??"individual",fadeEasing:a.fadeEasing??("grouped"===a.fadeMode?"ease-in":"linear"),fadeDurationMs:a.fadeDurationMs??this.editor.options.laserFadeoutMs},fadeElapsed:0,totalPointsAtFadeStart:0};return this.sessions.set(b,c),c.options.idleTimeoutMs>0&&this.resetIdleTimeout(c),b}addScribbleToSession(a,b,c=function(a){return cs(void 0)}()){let d=this.sessions.get(a);if(!d)throw Error(`Session ${a} not found`);let e={id:c,scribble:{id:c,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...b,state:"starting"},timeoutMs:0,delayRemaining:b.delay??0,prev:null,next:null};return d.items.push(e),d.options.idleTimeoutMs>0&&this.resetIdleTimeout(d),e}addPointToSession(a,b,c,d,e=.5){let f=this.sessions.get(a);if(!f)throw Error(`Session ${a} not found`);let g=f.items.find(a=>a.id===b);if(!g)throw Error(`Scribble ${b} not found in session ${a}`);let h={x:c,y:d,z:e};return(!g.prev||iK.Dist(g.prev,h)>=1)&&(g.next=h),f.options.idleTimeoutMs>0&&this.resetIdleTimeout(f),g}extendSession(a){let b=this.sessions.get(a);b&&b.options.idleTimeoutMs>0&&this.resetIdleTimeout(b)}stopSession(a){let b=this.sessions.get(a);if(b&&"active"===b.state)if(this.clearIdleTimeout(b),b.state="stopping","grouped"===b.options.fadeMode)for(let a of(b.totalPointsAtFadeStart=b.items.reduce((a,b)=>a+b.scribble.points.length,0),b.fadeElapsed=0,b.items))a.scribble.state="stopping";else for(let a of b.items)a.delayRemaining=Math.min(a.delayRemaining,200),a.scribble.state="stopping"}clearSession(a){let b=this.sessions.get(a);if(b){for(let a of(this.clearIdleTimeout(b),b.items))a.scribble.points.length=0;b.state="complete"}}isSessionActive(a){let b=this.sessions.get(a);return b?.state==="active"}addScribble(a,b=function(a){return cs(void 0)}()){let c=this.startSession();return this.addScribbleToSession(c,a,b)}addPoint(a,b,c,d=.5){for(let e of this.sessions.values()){let f=e.items.find(b=>b.id===a);if(f){let a={x:b,y:c,z:d};return(!f.prev||iK.Dist(f.prev,a)>=1)&&(f.next=a),e.options.idleTimeoutMs>0&&this.resetIdleTimeout(e),f}}throw Error(`Scribble with id ${a} not found`)}complete(a){for(let b of this.sessions.values()){let c=b.items.find(b=>b.id===a);if(c)return("starting"===c.scribble.state||"active"===c.scribble.state)&&(c.scribble.state="complete"),c}throw Error(`Scribble with id ${a} not found`)}stop(a){for(let b of this.sessions.values()){let c=b.items.find(b=>b.id===a);if(c)return c.delayRemaining=Math.min(c.delayRemaining,200),c.scribble.state="stopping",c}throw Error(`Scribble with id ${a} not found`)}reset(){for(let a of this.sessions.values())this.clearIdleTimeout(a);this.sessions.clear(),this.editor.updateInstanceState({scribbles:[]})}tick(a){let b=this.editor.getInstanceState().scribbles;(0!==this.sessions.size||0!==b.length)&&this.editor.run(()=>{for(let b of this.sessions.values())this.tickSession(b,a);for(let[a,b]of this.sessions)"complete"===b.state&&(this.clearIdleTimeout(b),this.sessions.delete(a));let b=[];for(let a of this.sessions.values())for(let c of a.items)c.scribble.points.length>0&&b.push({...c.scribble,points:[...c.scribble.points]});this.editor.updateInstanceState({scribbles:b})})}resetIdleTimeout(a){this.clearIdleTimeout(a),a.idleTimeoutHandle=this.editor.timers.setTimeout(()=>{this.stopSession(a.id)},a.options.idleTimeoutMs)}clearIdleTimeout(a){void 0!==a.idleTimeoutHandle&&(clearTimeout(a.idleTimeoutHandle),a.idleTimeoutHandle=void 0)}tickSession(a,b){"complete"===a.state||("stopping"===a.state&&"grouped"===a.options.fadeMode?this.tickGroupedFade(a,b):this.tickSessionItems(a,b),a.items.some(a=>a.scribble.points.length>0)||"stopping"!==a.state&&0!==a.items.length||(a.state="complete"))}tickSessionItems(a,b){for(let c of a.items)a.options.selfConsume||"stopping"===a.state||"stopping"===c.scribble.state?this.tickSelfConsumingItem(c,b):this.tickPersistentItem(c);if("individual"===a.options.fadeMode)for(let b=a.items.length-1;b>=0;b--)0===a.items[b].scribble.points.length&&a.items.splice(b,1)}tickPersistentItem(a){let{scribble:b}=a;if("starting"===b.state){let{next:c,prev:d}=a;c&&c!==d&&(a.prev=c,b.points.push(c)),b.points.length>8&&(b.state="active");return}if("active"===b.state){let{next:c,prev:d}=a;c&&c!==d&&(a.prev=c,b.points.push(c))}}tickSelfConsumingItem(a,b){let{scribble:c}=a;if("starting"===c.state){let{next:b,prev:d}=a;b&&b!==d&&(a.prev=b,c.points.push(b)),c.points.length>8&&(c.state="active");return}a.delayRemaining>0&&(a.delayRemaining=Math.max(0,a.delayRemaining-b)),a.timeoutMs+=b,a.timeoutMs>=16&&(a.timeoutMs=0);let{delayRemaining:d,timeoutMs:e,prev:f,next:g}=a;switch(c.state){case"active":g&&g!==f?(a.prev=g,c.points.push(g),0===d&&c.points.length>8&&c.points.shift()):0===e&&(c.points.length>1?c.points.shift():a.delayRemaining=c.delay);break;case"stopping":if(0===d&&0===e){if(c.points.length<=1){c.points.length=0;return}c.shrink&&(c.size=Math.max(1,c.size*(1-c.shrink))),c.points.shift()}}}tickGroupedFade(a,b){a.fadeElapsed+=b;let c=0;for(let b of a.items)c+=b.scribble.points.length;if(0===c)return;if(a.fadeElapsed>=a.options.fadeDurationMs){for(let b of a.items)b.scribble.points.length=0;return}let d=a.fadeElapsed/a.options.fadeDurationMs,e=Math.max(1,Math.floor(("ease-in"===a.options.fadeEasing?d*d:d)*a.totalPointsAtFadeStart)-(a.totalPointsAtFadeStart-c)),f=0,g=0;for(;f<e&&g<a.items.length;){let b=a.items[g];b.scribble.points.length>0?(b.scribble.points.shift(),f++):g++}}}var ni=Object.create,nj=Object.defineProperty,nk=Object.getOwnPropertyDescriptor,nl=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),nm=a=>{throw TypeError(a)},nn=(a,b,c)=>b in a?nj(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,no=(a,b)=>nj(a,"name",{value:b,configurable:!0}),np=["class","method","getter","setter","accessor","field","value","get","set"],nq=a=>void 0!==a&&"function"!=typeof a?nm("Function expected"):a,nr=(a,b,c,d,e)=>({kind:np[a],name:b,metadata:d,addInitializer:a=>c._?nm("Already initialized"):e.push(nq(a||null))}),ns=(a,b)=>nn(b,nl("metadata"),a[3]),nt=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=np[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&nk(l<4?e:{get[c](){return nw(this,f)},set[c](x){return nx(this,f,x)}},c));l?n&&l<4&&no(f,(l>2?"set ":l>1?"get ":"")+c):no(e,c);for(var t=d.length-1;t>=0;t--)j=nr(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>nv(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?nw:ny)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>nx(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?nq(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?nm("Object expected"):(nq(g=h.get)&&(s.get=g),nq(g=h.set)&&(s.set=g),nq(g=h.init)&&q.unshift(g));return l||ns(a,e),s&&nj(e,c,s),n?4^l?f:s:e},nu=(a,b,c)=>b.has(a)||nm("Cannot "+c),nv=(a,b)=>Object(b)!==b?nm('Cannot use the "in" operator on this value'):a.has(b),nw=(a,b,c)=>(nu(a,b,"read from private field"),c?c.call(a):b.get(a)),nx=(a,b,c,d)=>(nu(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),ny=(a,b,c)=>(nu(a,b,"access private method"),c);let nz=a=>Math.round(1e8*a)/1e8;function nA(a,b,c,d,e){let f=a.filter(a=>("forward"===d?a.startNode.id===b:a.endNode.id===b)&&nz(a.length)===nz(c)&&i2(a.breadthIntersection[0],a.breadthIntersection[1],e[0],e[1]));if(0===f.length)return[];let g=new Set;return f.forEach(b=>{let h="forward"===d?b.endNode.id:b.startNode.id;if(!g.has(h)){g.add(h);let i=nA(a,h,c,d,i2(b.breadthIntersection[0],b.breadthIntersection[1],e[0],e[1]));f.push(...i)}}),f}Q=[dQ],P=[dQ],O=[dQ],N=[dQ];class nB{constructor(a){this.manager=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(R,5,this),((a,b,c)=>nn(a,"symbol"!=typeof b?b+"":b,c))(this,"editor"),this.editor=a.editor}getSnapPointsCache(){let{editor:a}=this;return a.store.createComputedCache("snapPoints",b=>{let c=a.getShapePageTransform(b.id);if(!c)return;let d=a.getShapeUtil(b).getBoundsSnapGeometry(b).points??a.getShapeGeometry(b).bounds.cornersAndCenter;if(c&&d)return d.map((a,d)=>{let{x:e,y:f}=ku.applyToPoint(c,a);return{x:e,y:f,id:`${b.id}:${d}`}})})}getSnapPoints(a){return this.getSnapPointsCache().get(a)??[]}getSnappablePoints(){let a=this.getSnapPointsCache(),b=this.manager.getSnappableShapes(),c=[];for(let d of b){let b=a.get(d);b&&c.push(...b)}return c}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),a=>({id:a,pageBounds:ce(this.editor.getShapePageBounds(a))}))}getVisibleGaps(){var a,b,c,d,e,f;let g,h,i=[],j=[],k=this.getSnappableGapNodes().sort((a,b)=>a.pageBounds.minX-b.pageBounds.minX);for(let d=0;d<k.length;d++){g=k[d];for(let e=d+1;e<k.length;e++)h=k[e],g.pageBounds.maxX<h.pageBounds.minX&&(a=g.pageBounds.minY,b=g.pageBounds.maxY,c=h.pageBounds.minY,a<h.pageBounds.maxY&&c<b)&&i.push({startNode:g,endNode:h,startEdge:[new iK(g.pageBounds.maxX,g.pageBounds.minY),new iK(g.pageBounds.maxX,g.pageBounds.maxY)],endEdge:[new iK(h.pageBounds.minX,h.pageBounds.minY),new iK(h.pageBounds.minX,h.pageBounds.maxY)],length:h.pageBounds.minX-g.pageBounds.maxX,breadthIntersection:i2(g.pageBounds.minY,g.pageBounds.maxY,h.pageBounds.minY,h.pageBounds.maxY)})}let l=k.sort((a,b)=>a.pageBounds.minY-b.pageBounds.minY);for(let a=0;a<l.length;a++){g=l[a];for(let b=a+1;b<l.length;b++)h=l[b],g.pageBounds.maxY<h.pageBounds.minY&&(d=g.pageBounds.minX,e=g.pageBounds.maxX,f=h.pageBounds.minX,d<h.pageBounds.maxX&&f<e)&&j.push({startNode:g,endNode:h,startEdge:[new iK(g.pageBounds.minX,g.pageBounds.maxY),new iK(g.pageBounds.maxX,g.pageBounds.maxY)],endEdge:[new iK(h.pageBounds.minX,h.pageBounds.minY),new iK(h.pageBounds.maxX,h.pageBounds.minY)],length:h.pageBounds.minY-g.pageBounds.maxY,breadthIntersection:i2(g.pageBounds.minX,g.pageBounds.maxX,h.pageBounds.minX,h.pageBounds.maxX)})}return{horizontal:i,vertical:j}}snapTranslateShapes({lockedAxis:a,initialSelectionPageBounds:b,initialSelectionSnapPoints:c,dragDelta:d}){let e=this.manager.getSnapThreshold(),f=this.getSnappablePoints(),g=b.clone().translate(d),h=c.map(({x:a,y:b},c)=>({id:"selection:"+c,x:a+d.x,y:b+d.y})),i=[],j=[],k=new iK(e,e);this.collectPointSnaps({minOffset:k,nearestSnapsX:i,nearestSnapsY:j,otherNodeSnapPoints:f,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j,minOffset:k});let l=new iK("x"===a?0:i[0]?.nudge??0,"y"===a?0:j[0]?.nudge??0);k.x=0,k.y=0,i.length=0,j.length=0,h.forEach(a=>{a.x+=l.x,a.y+=l.y}),g.translate(l),this.collectPointSnaps({minOffset:k,nearestSnapsX:i,nearestSnapsY:j,otherNodeSnapPoints:f,selectionSnapPoints:h}),this.collectGapSnaps({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j,minOffset:k});let m=this.getPointSnapLines({nearestSnapsX:i,nearestSnapsY:j}),n=this.getGapSnapLines({selectionPageBounds:g,nearestSnapsX:i,nearestSnapsY:j});return this.manager.setIndicators([...n,...m]),{nudge:l}}snapResizeShapes({initialSelectionPageBounds:a,dragDelta:b,handle:c,isAspectRatioLocked:d,isResizingFromCenter:e}){var f;let g=this.manager.getSnapThreshold(),{box:h,scaleX:i,scaleY:j}=kt.Resize(a,c,e?2*b.x:b.x,e?2*b.y:b.y,d),k=c;i<0&&(k=function(a){switch(a){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return a}}(k)),j<0&&(k=function(a){switch(a){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return a}}(k)),e&&(h.center=a.center);let l="top"===k||"bottom"===k,m="left"===k||"right"===k,n=nC(k,h),o=this.getSnappablePoints(),p=[],q=[],r=new iK(g,g);this.collectPointSnaps({minOffset:r,nearestSnapsX:p,nearestSnapsY:q,otherNodeSnapPoints:o,selectionSnapPoints:n});let s=new iK(l?0:p[0]?.nudge??0,m?0:q[0]?.nudge??0);if(d&&("top_left"===(f=k)||"top_right"===f||"bottom_right"===f||"bottom_left"===f)&&0!==s.len()){let b=p.length&&q.length?Math.abs(s.x)<Math.abs(s.y)?"x":"y":p.length?"x":"y",c=a.aspectRatio;"x"===b?(q.length=0,s.y=s.x/c,("bottom_left"===k||"top_right"===k)&&(s.y=-s.y)):(p.length=0,s.x=s.y*c,("bottom_left"===k||"top_right"===k)&&(s.x=-s.x))}let t=iK.Add(b,s),{box:u}=kt.Resize(a,c,e?2*t.x:t.x,e?2*t.y:t.y,d);e&&(u.center=a.center);let v=nC("any",u);p.length=0,q.length=0,r.x=0,r.y=0,this.collectPointSnaps({minOffset:r,nearestSnapsX:p,nearestSnapsY:q,otherNodeSnapPoints:o,selectionSnapPoints:v});let w=this.getPointSnapLines({nearestSnapsX:p,nearestSnapsY:q});return this.manager.setIndicators([...w]),{nudge:s}}collectPointSnaps({selectionSnapPoints:a,otherNodeSnapPoints:b,minOffset:c,nearestSnapsX:d,nearestSnapsY:e}){for(let f of a)for(let a of b){let b=iK.Sub(f,a),g=Math.abs(b.x),h=Math.abs(b.y);nz(g)<=nz(c.x)&&(nz(g)<nz(c.x)&&(d.length=0),d.push({type:"points",points:{thisPoint:f,otherPoint:a},nudge:a.x-f.x}),c.x=g),nz(h)<=nz(c.y)&&(nz(h)<nz(c.y)&&(e.length=0),e.push({type:"points",points:{thisPoint:f,otherPoint:a},nudge:a.y-f.y}),c.y=h)}}collectGapSnaps({selectionPageBounds:a,minOffset:b,nearestSnapsX:c,nearestSnapsY:d}){var e,f,g,h,i,j,k,l,m;let{horizontal:n,vertical:o}=this.getVisibleGaps();for(let d of n){if(e=d.breadthIntersection[0],f=d.breadthIntersection[1],g=a.minY,!(e<a.maxY)||!(g<f))continue;let h=d.startEdge[0].x+d.length/2-a.center.x;if(d.length>a.width&&nz(Math.abs(h))<=nz(b.x)){nz(Math.abs(h))<nz(b.x)&&(c.length=0),b.x=Math.abs(h);let a={type:"gap_center",gap:d,nudge:h},e=c.find(({type:a})=>"gap_center"===a),f=e&&i2(d.breadthIntersection[0],d.breadthIntersection[1],e.gap.breadthIntersection[0],e.gap.breadthIntersection[1]);e&&e.gap.length>d.length&&f?c[c.indexOf(e)]=a:e&&f||c.push(a)}let i=d.startNode.pageBounds.minX-d.length-a.maxX;nz(Math.abs(i))<=nz(b.x)&&(nz(Math.abs(i))<nz(b.x)&&(c.length=0),b.x=Math.abs(i),c.push({type:"gap_duplicate",gap:d,protrusionDirection:"left",nudge:i}));let j=d.endNode.pageBounds.maxX+d.length-a.minX;nz(Math.abs(j))<=nz(b.x)&&(nz(Math.abs(j))<nz(b.x)&&(c.length=0),b.x=Math.abs(j),c.push({type:"gap_duplicate",gap:d,protrusionDirection:"right",nudge:j}))}for(let c of o){if(h=c.breadthIntersection[0],i=c.breadthIntersection[1],j=a.minX,!(h<a.maxX)||!(j<i))continue;let e=c.startEdge[0].y+c.length/2-a.center.y;if(c.length>a.height&&nz(Math.abs(e))<=nz(b.y)){nz(Math.abs(e))<nz(b.y)&&(d.length=0),b.y=Math.abs(e);let a={type:"gap_center",gap:c,nudge:e},f=d.find(({type:a})=>"gap_center"===a),g=f&&(k=f.gap.breadthIntersection[0],l=f.gap.breadthIntersection[1],m=c.breadthIntersection[0],k<c.breadthIntersection[1]&&m<l);f&&f.gap.length>c.length&&g?d[d.indexOf(f)]=a:f&&g||d.push(a);continue}let f=c.startNode.pageBounds.minY-c.length-a.maxY;nz(Math.abs(f))<=nz(b.y)&&(nz(Math.abs(f))<nz(b.y)&&(d.length=0),b.y=Math.abs(f),d.push({type:"gap_duplicate",gap:c,protrusionDirection:"top",nudge:f}));let g=c.endNode.pageBounds.maxY+c.length-a.minY;nz(Math.abs(g))<=nz(b.y)&&(nz(Math.abs(g))<nz(b.y)&&(d.length=0),b.y=Math.abs(g),d.push({type:"gap_duplicate",gap:c,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:a,nearestSnapsY:b}){let c={},d={};if(a.length>0){for(let b of a)if("points"===b.type){let a=nz(b.points.otherPoint.x);c[a]||(c[a]=[]),c[a].push(b.points)}}if(b.length>0){for(let a of b)if("points"===a.type){let b=nz(a.points.otherPoint.y);d[b]||(d[b]=[]),d[b].push(a.points)}}return Object.values(c).concat(Object.values(d)).map(a=>({id:cs(void 0),type:"points",points:b3(a.map(a=>iK.From(a.otherPoint)).concat(a.map(a=>iK.From(a.thisPoint))),(a,b)=>a.equals(b))}))}getGapSnapLines({selectionPageBounds:a,nearestSnapsX:b,nearestSnapsY:c}){let{vertical:d,horizontal:e}=this.getVisibleGaps(),f={top:a.sides[0],right:a.sides[1],bottom:[a.corners[3],a.corners[2]],left:[a.corners[0],a.corners[3]]},g=[];if(b.length>0)for(let c of b){if("points"===c.type)continue;let{gap:{breadthIntersection:b,startEdge:d,startNode:h,endNode:i,length:j,endEdge:k}}=c;switch(c.type){case"gap_center":{let c=(j-a.width)/2,l=i2(b[0],b[1],a.minY,a.maxY);g.push({type:"gaps",direction:"horizontal",id:cs(void 0),gaps:[...nA(e,h.id,c,"backward",l),{startEdge:d,endEdge:f.left},{startEdge:f.right,endEdge:k},...nA(e,i.id,c,"forward",l)]});break}case"gap_duplicate":{let l=i2(b[0],b[1],a.minY,a.maxY);g.push({type:"gaps",direction:"horizontal",id:cs(void 0),gaps:"left"===c.protrusionDirection?[{startEdge:f.right,endEdge:d.map(a=>a.clone().addXY(-h.pageBounds.width,0))},{startEdge:d,endEdge:k},...nA(e,i.id,j,"forward",l)]:[...nA(e,h.id,j,"backward",l),{startEdge:d,endEdge:k},{startEdge:k.map(a=>a.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:f.left}]})}}}if(c.length>0)for(let b of c){if("points"===b.type)continue;let{gap:{breadthIntersection:c,startEdge:e,startNode:h,endNode:i,length:j,endEdge:k}}=b;switch(b.type){case"gap_center":{let i=(j-a.height)/2,l=i2(c[0],c[1],a.minX,a.maxX);g.push({type:"gaps",direction:"vertical",id:cs(void 0),gaps:[...nA(d,h.id,i,"backward",l),{startEdge:e,endEdge:f.top},{startEdge:f.bottom,endEdge:k},...nA(d,b.gap.endNode.id,i,"forward",l)]});break}case"gap_duplicate":{let l=i2(c[0],c[1],a.minX,a.maxX);g.push({type:"gaps",direction:"vertical",id:cs(void 0),gaps:"top"===b.protrusionDirection?[{startEdge:f.bottom,endEdge:e.map(a=>a.clone().addXY(0,-h.pageBounds.height))},{startEdge:e,endEdge:k},...nA(d,i.id,j,"forward",l)]:[...nA(d,h.id,j,"backward",l),{startEdge:e,endEdge:k},{startEdge:k.map(a=>a.clone().addXY(0,i.pageBounds.height)),endEdge:f.top}]})}}}g.sort((a,b)=>b.gaps.length-a.gaps.length);for(let a=g.length-1;a>0;a--){let b=g[a];for(let c=a-1;c>=0;c--){let d=g[c];if(d.direction===b.direction&&b.gaps.every(a=>d.gaps.some(b=>nz(a.startEdge[0].x)===nz(b.startEdge[0].x)&&nz(a.startEdge[0].y)===nz(b.startEdge[0].y)&&nz(a.startEdge[1].x)===nz(b.startEdge[1].x)&&nz(a.startEdge[1].y)===nz(b.startEdge[1].y))&&d.gaps.some(b=>nz(a.endEdge[0].x)===nz(b.endEdge[0].x)&&nz(a.endEdge[0].y)===nz(b.endEdge[0].y)&&nz(a.endEdge[1].x)===nz(b.endEdge[1].x)&&nz(a.endEdge[1].y)===nz(b.endEdge[1].y)))){g.splice(a,1);break}}}return g}}function nC(a,b){let{minX:c,maxX:d,minY:e,maxY:f}=b,g=[];switch(a){case"top":case"left":case"top_left":case"any":g.push({id:"top_left",handle:"top_left",x:c,y:e})}switch(a){case"top":case"right":case"top_right":case"any":g.push({id:"top_right",handle:"top_right",x:d,y:e})}switch(a){case"bottom":case"right":case"bottom_right":case"any":g.push({id:"bottom_right",handle:"bottom_right",x:d,y:f})}switch(a){case"bottom":case"left":case"bottom_left":case"any":g.push({id:"bottom_left",handle:"bottom_left",x:c,y:f})}return g}nt(R=[,,,ni((void 0)??null)],1,"getSnapPointsCache",Q,nB),nt(R,1,"getSnappablePoints",P,nB),nt(R,1,"getSnappableGapNodes",O,nB),nt(R,1,"getVisibleGaps",N,nB),ns(R,nB);var nD=Object.create,nE=Object.defineProperty,nF=Object.getOwnPropertyDescriptor,nG=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),nH=a=>{throw TypeError(a)},nI=(a,b,c)=>b in a?nE(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nJ=(a,b)=>nE(a,"name",{value:b,configurable:!0}),nK=["class","method","getter","setter","accessor","field","value","get","set"],nL=a=>void 0!==a&&"function"!=typeof a?nH("Function expected"):a,nM=(a,b,c,d,e)=>({kind:nK[a],name:b,metadata:d,addInitializer:a=>c._?nH("Already initialized"):e.push(nL(a||null))}),nN=(a,b)=>nI(b,nG("metadata"),a[3]),nO=(a,b,c)=>b.has(a)||nH("Cannot "+c),nP=(a,b)=>Object(b)!==b?nH('Cannot use the "in" operator on this value'):a.has(b),nQ=(a,b,c)=>(nO(a,b,"read from private field"),c?c.call(a):b.get(a)),nR=(a,b,c,d)=>(nO(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),nS=(a,b,c)=>(nO(a,b,"access private method"),c);let nT=()=>null,nU=()=>[];S=[dQ];class nV{constructor(a){this.manager=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(T,5,this),((a,b,c)=>nI(a,"symbol"!=typeof b?b+"":b,c))(this,"editor"),this.editor=a.editor}getSnapGeometryCache(){let{editor:a}=this;return a.store.createComputedCache("handle snap geometry",b=>{let c=a.getShapeUtil(b).getHandleSnapGeometry(b),d=c.getSelfSnapOutline?c.getSelfSnapOutline.bind(c):nT,e=c.getSelfSnapPoints?c.getSelfSnapPoints.bind(c):nU;return{outline:void 0===c.outline?a.getShapeGeometry(b):c.outline,points:c.points??[],getSelfSnapOutline:d,getSelfSnapPoints:e}})}*iterateSnapPointsInPageSpace(a,b){let c=this.getSnapGeometryCache().get(a)?.getSelfSnapPoints(b);if(c&&c.length){let b=ce(this.editor.getShapePageTransform(a));for(let a of c)yield b.applyToPoint(a)}for(let b of this.manager.getSnappableShapes()){if(b===a)continue;let c=this.getSnapGeometryCache().get(b)?.points;if(!c||!c.length)continue;let d=ce(this.editor.getShapePageTransform(b));for(let a of c)yield d.applyToPoint(a)}}*iterateSnapOutlines(a,b){let c=this.getSnapGeometryCache().get(a)?.getSelfSnapOutline(b);for(let b of(c&&(yield{shapeId:a,outline:c}),this.manager.getSnappableShapes())){if(b===a)continue;let c=this.getSnapGeometryCache().get(b)?.outline;c&&(yield{shapeId:b,outline:c})}}getHandleSnapPosition({currentShapeId:a,handle:b,handleInPageSpace:c}){let d=this.manager.getSnapThreshold(),e=d,f=null;for(let d of this.iterateSnapPointsInPageSpace(a,b))iK.DistMin(c,d,e)&&(e=iK.Dist(c,d),f=d);if(f)return f;let g=d,h=null;for(let{shapeId:d,outline:e}of this.iterateSnapOutlines(a,b)){let a=ce(this.editor.getShapePageTransform(d)),b=this.editor.getPointInShapeSpace(d,c),f=e.nearestPoint(b),i=a.applyToPoint(f);iK.DistMin(c,i,g)&&(g=iK.Dist(c,i),h=i)}return h||null}getHandleSnapData({handle:a,currentShapeId:b}){let c=this.manager.getSnapThreshold(),d=ce(this.editor.getShapePageTransform(b)).applyToPoint(a),e=null,f=null,g=c,h=c;for(let c of this.iterateSnapPointsInPageSpace(b,a)){let a=Math.abs(d.x-c.x),b=Math.abs(d.y-c.y);a<g&&(g=a,e=c),b<h&&(h=b,f=c)}if(!e&&!f)return null;let i=new iK(e?e.x-d.x:0,f?f.y-d.y:0),j=iK.Add(d,i),k=[];if(e){let a=new iK(e.x,j.y);k.push({id:cs(void 0),type:"points",points:[e,a]})}if(f){let a=new iK(j.x,f.y);k.push({id:cs(void 0),type:"points",points:[f,a]})}return{snaps:k,nudge:i}}snapHandle({currentShapeId:a,handle:b}){let c=ce(this.editor.getShapePageTransform(a)).applyToPoint(b),d=b.canSnap?"point":b.snapType;if("point"===d){let d=this.getHandleSnapPosition({currentShapeId:a,handle:b,handleInPageSpace:c});return d?(this.manager.setIndicators([{id:cs(void 0),type:"points",points:[d]}]),{nudge:iK.Sub(d,c)}):null}if("align"===d){let c=this.getHandleSnapData({handle:b,currentShapeId:a});return c?(this.manager.setIndicators(c.snaps),{nudge:c.nudge}):null}return null}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=nK[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&nF(l<4?e:{get[c](){return nQ(this,f)},set[c](x){return nR(this,f,x)}},c));l?n&&l<4&&nJ(f,(l>2?"set ":l>1?"get ":"")+c):nJ(e,c);for(var t=d.length-1;t>=0;t--)j=nM(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>nP(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?nQ:nS)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>nR(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?nL(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?nH("Object expected"):(nL(g=h.get)&&(s.get=g),nL(g=h.set)&&(s.set=g),nL(g=h.init)&&q.unshift(g));return l||nN(a,e),s&&nE(e,c,s),n})(T=[,,,nD((void 0)??null)],1,"getSnapGeometryCache",S,nV),nN(T,nV);var nW=Object.create,nX=Object.defineProperty,nY=Object.getOwnPropertyDescriptor,nZ=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),n$=a=>{throw TypeError(a)},n_=(a,b,c)=>b in a?nX(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,n0=(a,b)=>nX(a,"name",{value:b,configurable:!0}),n1=["class","method","getter","setter","accessor","field","value","get","set"],n2=a=>void 0!==a&&"function"!=typeof a?n$("Function expected"):a,n3=(a,b,c,d,e)=>({kind:n1[a],name:b,metadata:d,addInitializer:a=>c._?n$("Already initialized"):e.push(n2(a||null))}),n4=(a,b)=>n_(b,nZ("metadata"),a[3]),n5=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=n1[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&nY(l<4?e:{get[c](){return n9(this,f)},set[c](x){return oa(this,f,x)}},c));l?n&&l<4&&n0(f,(l>2?"set ":l>1?"get ":"")+c):n0(e,c);for(var t=d.length-1;t>=0;t--)j=n3(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>n8(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?n9:ob)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>oa(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?n2(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?n$("Object expected"):(n2(g=h.get)&&(s.get=g),n2(g=h.set)&&(s.set=g),n2(g=h.init)&&q.unshift(g));return l||n4(a,e),s&&nX(e,c,s),n?4^l?f:s:e},n6=(a,b,c)=>n_(a,"symbol"!=typeof b?b+"":b,c),n7=(a,b,c)=>b.has(a)||n$("Cannot "+c),n8=(a,b)=>Object(b)!==b?n$('Cannot use the "in" operator on this value'):a.has(b),n9=(a,b,c)=>(n7(a,b,"read from private field"),c?c.call(a):b.get(a)),oa=(a,b,c,d)=>(n7(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),ob=(a,b,c)=>(n7(a,b,"access private method"),c);W=[dQ],V=[dQ],U=[dQ];class oc{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(X,5,this),n6(this,"shapeBounds"),n6(this,"handles"),n6(this,"_snapIndicators",d$("snapLines",void 0)),this.shapeBounds=new nB(this),this.handles=new nV(this)}getIndicators(){return this._snapIndicators.get()??du}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(a){this._snapIndicators.set(a)}getSnapThreshold(){return this.editor.options.snapThreshold/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:a}=this,b=a.getViewportPageBounds(),c=a.getSelectedShapeIds(),d=new Set,e=f=>{if(gh(f)){let b=a.getShape(f);b&&a.isShapeOfType(b,"frame")&&d.add(f)}for(let g of a.getSortedChildIdsForParent(f)){if(c.includes(g))continue;let f=a.getShape(g);if(!f||!a.getShapeUtil(f).canSnap(f))continue;let h=a.getShapePageBounds(g);if(h&&b.includes(h)){if(a.isShapeOfType(f,"group")){e(g);continue}d.add(g)}}};return e(this.getCurrentCommonAncestor()??a.getCurrentPageId()),d}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}function od(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function oe(a,b){return a<b?-1:+(a>b)}n5(X=[,,,nW((void 0)??null)],1,"getSnapThreshold",W,oc),n5(X,1,"getSnappableShapes",V,oc),n5(X,1,"getCurrentCommonAncestor",U,oc),n4(X,oc);class of{constructor(a=9){this._maxEntries=Math.max(4,a),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(a){let b=this.data,c=[];if(!oo(a,b))return c;let d=this.toBBox,e=[];for(;b;){for(let f=0;f<b.children.length;f++){let g=b.children[f],h=b.leaf?d(g):g;oo(a,h)&&(b.leaf?c.push(g):on(a,h)?this._all(g,c):e.push(g))}b=e.pop()}return c}collides(a){let b=this.data;if(!oo(a,b))return!1;let c=[];for(;b;){for(let d=0;d<b.children.length;d++){let e=b.children[d],f=b.leaf?this.toBBox(e):e;if(oo(a,f)){if(b.leaf||on(a,f))return!0;c.push(e)}}b=c.pop()}return!1}load(a){if(!(a&&a.length))return this;if(a.length<this._minEntries){for(let b=0;b<a.length;b++)this.insert(a[b]);return this}let b=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){let a=this.data;this.data=b,b=a}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this}insert(a){return a&&this._insert(a,this.data.height-1),this}clear(){return this.data=op([]),this}remove(a,b){let c,d,e;if(!a)return this;let f=this.data,g=this.toBBox(a),h=[],i=[];for(;f||h.length;){if(f||(f=h.pop(),d=h[h.length-1],c=i.pop(),e=!0),f.leaf){let c=function(a,b,c){if(!c)return b.indexOf(a);for(let d=0;d<b.length;d++)if(c(a,b[d]))return d;return -1}(a,f.children,b);if(-1!==c){f.children.splice(c,1),h.push(f),this._condense(h);break}}!e&&!f.leaf&&on(f,g)?(h.push(f),i.push(c),c=0,d=f,f=f.children[0]):d?(c++,f=d.children[c],e=!1):f=null}return this}toBBox(a){return a}compareMinX(a,b){return a.minX-b.minX}compareMinY(a,b){return a.minY-b.minY}toJSON(){return this.data}fromJSON(a){return this.data=a,this}_all(a,b){let c=[];for(;a;)a.leaf?b.push(...a.children):c.push(...a.children),a=c.pop();return b}_build(a,b,c,d){let e,f=c-b+1,g=this._maxEntries;if(f<=g)return og(e=op(a.slice(b,c+1)),this.toBBox),e;d||(d=Math.ceil(Math.log(f)/Math.log(g)),g=Math.ceil(f/Math.pow(g,d-1))),(e=op([])).leaf=!1,e.height=d;let h=Math.ceil(f/g),i=h*Math.ceil(Math.sqrt(g));oq(a,b,c,i,this.compareMinX);for(let f=b;f<=c;f+=i){let b=Math.min(f+i-1,c);oq(a,f,b,h,this.compareMinY);for(let c=f;c<=b;c+=h){let f=Math.min(c+h-1,b);e.children.push(this._build(a,c,f,d-1))}}return og(e,this.toBBox),e}_chooseSubtree(a,b,c,d){for(;;){let g;if(d.push(b),b.leaf||d.length-1===c)break;let h=1/0,i=1/0;for(let c=0;c<b.children.length;c++){var e,f;let d=b.children[c],j=ol(d),k=(e=a,(Math.max((f=d).maxX,e.maxX)-Math.min(f.minX,e.minX))*(Math.max(f.maxY,e.maxY)-Math.min(f.minY,e.minY))-j);k<i?(i=k,h=j<h?j:h,g=d):k===i&&j<h&&(h=j,g=d)}b=g||b.children[0]}return b}_insert(a,b,c){let d=c?a:this.toBBox(a),e=[],f=this._chooseSubtree(d,this.data,b,e);for(f.children.push(a),oi(f,d);b>=0;)if(e[b].children.length>this._maxEntries)this._split(e,b),b--;else break;this._adjustParentBBoxes(d,e,b)}_split(a,b){let c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);let f=this._chooseSplitIndex(c,e,d),g=op(c.children.splice(f,c.children.length-f));g.height=c.height,g.leaf=c.leaf,og(c,this.toBBox),og(g,this.toBBox),b?a[b-1].children.push(g):this._splitRoot(c,g)}_splitRoot(a,b){this.data=op([a,b]),this.data.height=a.height+1,this.data.leaf=!1,og(this.data,this.toBBox)}_chooseSplitIndex(a,b,c){let d,e=1/0,f=1/0;for(let g=b;g<=c-b;g++){let b=oh(a,0,g,this.toBBox),h=oh(a,g,c,this.toBBox),i=function(a,b){let c=Math.max(a.minX,b.minX),d=Math.max(a.minY,b.minY);return Math.max(0,Math.min(a.maxX,b.maxX)-c)*Math.max(0,Math.min(a.maxY,b.maxY)-d)}(b,h),j=ol(b)+ol(h);i<e?(e=i,d=g,f=j<f?j:f):i===e&&j<f&&(f=j,d=g)}return d||c-b}_chooseSplitAxis(a,b,c){let d=a.leaf?this.compareMinX:oj,e=a.leaf?this.compareMinY:ok;this._allDistMargin(a,b,c,d)<this._allDistMargin(a,b,c,e)&&a.children.sort(d)}_allDistMargin(a,b,c,d){a.children.sort(d);let e=this.toBBox,f=oh(a,0,b,e),g=oh(a,c-b,c,e),h=om(f)+om(g);for(let d=b;d<c-b;d++){let b=a.children[d];oi(f,a.leaf?e(b):b),h+=om(f)}for(let d=c-b-1;d>=b;d--){let b=a.children[d];oi(g,a.leaf?e(b):b),h+=om(g)}return h}_adjustParentBBoxes(a,b,c){for(let d=c;d>=0;d--)oi(b[d],a)}_condense(a){for(let b=a.length-1,c;b>=0;b--)0===a[b].children.length?b>0?(c=a[b-1].children).splice(c.indexOf(a[b]),1):this.clear():og(a[b],this.toBBox)}}function og(a,b){oh(a,0,a.children.length,b,a)}function oh(a,b,c,d,e){e||(e=op(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(let f=b;f<c;f++){let b=a.children[f];oi(e,a.leaf?d(b):b)}return e}function oi(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function oj(a,b){return a.minX-b.minX}function ok(a,b){return a.minY-b.minY}function ol(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function om(a){return a.maxX-a.minX+(a.maxY-a.minY)}function on(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function oo(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function op(a){return{children:a,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function oq(a,b,c,d,e){let f=[b,c];for(;f.length;){if((c=f.pop())-(b=f.pop())<=d)continue;let g=b+Math.ceil((c-b)/d/2)*d;(function a(b,c,d,e,f){for(;e>d;){if(e-d>600){var g=e-d+1,h=c-d+1,i=Math.log(g),j=.5*Math.exp(2*i/3),k=.5*Math.sqrt(i*j*(g-j)/g)*(h-g/2<0?-1:1),l=Math.max(d,Math.floor(c-h*j/g+k)),m=Math.min(e,Math.floor(c+(g-h)*j/g+k));a(b,c,l,m,f)}var n=b[c],o=d,p=e;for(od(b,d,c),f(b[e],n)>0&&od(b,d,e);o<p;){for(od(b,o,p),o++,p--;0>f(b[o],n);)o++;for(;f(b[p],n)>0;)p--}0===f(b[d],n)?od(b,d,p):od(b,++p,e),p<=c&&(d=p+1),c<=p&&(e=p-1)}})(a,g,b||0,c||a.length-1,e||oe),f.push(b,g,g,c)}}class or extends of{}class ot{rBush;elementsInTree;constructor(){this.rBush=new or,this.elementsInTree=new Map}search(a){return new Set(this.rBush.search({minX:a.minX,minY:a.minY,maxX:a.maxX,maxY:a.maxY}).map(a=>a.id))}upsert(a,b){let c=this.elementsInTree.get(a);c&&this.rBush.remove(c);let d={minX:b.minX,minY:b.minY,maxX:b.maxX,maxY:b.maxY,id:a};this.rBush.insert(d),this.elementsInTree.set(a,d)}remove(a){let b=this.elementsInTree.get(a);b&&(this.rBush.remove(b),this.elementsInTree.delete(a))}bulkLoad(a){for(let b of(this.rBush.load(a),a))this.elementsInTree.set(b.id,b)}clear(){this.rBush.clear(),this.elementsInTree.clear()}has(a){return this.elementsInTree.has(a)}getSize(){return this.elementsInTree.size}getAllShapeIds(){return Array.from(this.elementsInTree.keys())}getBounds(a){let b=this.elementsInTree.get(a);if(b)return new kt(b.minX,b.minY,b.maxX-b.minX,b.maxY-b.minY)}dispose(){this.clear()}}class ou{constructor(a){this.editor=a,this.rbush=new ot,this.spatialIndexComputed=this.createSpatialIndexComputed()}rbush;spatialIndexComputed;lastPageId=null;createSpatialIndexComputed(){let a=this.editor.store.query.filterHistory("shape");return dQ("spatialIndex",(b,c)=>{if(b===dJ)return this.buildFromScratch(c);let d=a.getDiffSince(c);if(d===dw)return this.buildFromScratch(c);let e=this.editor.getCurrentPageId();return this.lastPageId!==e?this.buildFromScratch(c):(0===d.length||this.processIncrementalUpdate(d),c)})}buildFromScratch(a){this.rbush.clear(),this.lastPageId=this.editor.getCurrentPageId();let b=this.editor.getCurrentPageShapes(),c=[];for(let a of b){let b=this.editor.getShapePageBounds(a.id);b&&c.push({minX:b.minX,minY:b.minY,maxX:b.maxX,maxY:b.maxY,id:a.id})}return this.rbush.bulkLoad(c),a}processIncrementalUpdate(a){let b=new Set;for(let c of a){for(let a of cH(c.added))if(gg(a)&&this.editor.getAncestorPageId(a)===this.lastPageId){let c=this.editor.getShapePageBounds(a.id);c&&this.rbush.upsert(a.id,c),b.add(a.id)}for(let a of cH(c.removed))gg(a)&&(this.rbush.remove(a.id),b.add(a.id));for(let[,a]of cH(c.updated))if(gg(a))if(b.add(a.id),this.editor.getAncestorPageId(a)===this.lastPageId){let b=this.editor.getShapePageBounds(a.id);b&&this.rbush.upsert(a.id,b)}else this.rbush.remove(a.id)}for(let a of this.rbush.getAllShapeIds()){if(b.has(a))continue;let c=this.editor.getShapePageBounds(a),d=this.rbush.getBounds(a);this.areBoundsEqual(c,d)||(c?this.rbush.upsert(a,c):this.rbush.remove(a))}}areBoundsEqual(a,b){return!a&&!b||!!a&&!!b&&a.minX===b.minX&&a.minY===b.minY&&a.maxX===b.maxX&&a.maxY===b.maxY}getShapeIdsInsideBounds(a){return this.spatialIndexComputed.get(),this.rbush.search(a)}getShapeIdsAtPoint(a,b=0){return this.spatialIndexComputed.get(),this.rbush.search(new kt(a.x-b,a.y-b,2*b,2*b))}dispose(){this.rbush.dispose(),this.lastPageId=null}}let ov=/\r?\n|\r/g;function ow(a){return a.replace(ov,"\n").split("\n").map(a=>a||" ").join("\n")}let ox={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},oy=/\s/,oz=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});class oA{constructor(a){this.editor=a;const b=document.createElement("div");for(const a of(b.classList.add("tl-text"),b.classList.add("tl-text-measure"),b.setAttribute("dir","auto"),b.tabIndex=-1,this.editor.getContainer().appendChild(b),this.elm=b,cG(oz)))b.style.setProperty(a,oz[a])}elm;setElementStyles(a){let b={};for(let c of cG(a))if("string"==typeof a[c]){let d=this.elm.style.getPropertyValue(c);if(d===a[c])continue;b[c]=d,this.elm.style.setProperty(c,a[c])}return()=>{for(let a of cG(b))this.elm.style.setProperty(a,b[a])}}dispose(){return this.elm.remove()}measureText(a,b){let c=document.createElement("div");return c.textContent=ow(a),this.measureHtml(c.innerHTML,b)}measureHtml(a,b){let{elm:c}=this,d={"font-family":b.fontFamily,"font-style":b.fontStyle,"font-weight":b.fontWeight,"font-size":b.fontSize+"px","line-height":b.lineHeight.toString(),padding:b.padding,"max-width":b.maxWidth?b.maxWidth+"px":void 0,"min-width":b.minWidth?b.minWidth+"px":void 0,"overflow-wrap":b.disableOverflowWrapBreaking?"normal":void 0,...b.otherStyles},e=this.setElementStyles(d);try{c.innerHTML=a;let d=b.measureScrollWidth?c.scrollWidth:0,e=c.getBoundingClientRect();return{x:0,y:0,w:e.width,h:e.height,scrollWidth:d}}finally{e()}}measureElementTextNodeSpans(a,{shouldTruncateToFirstLine:b=!1}={}){let c=[],d=a.getBoundingClientRect(),e=-d.left,f=-d.top,g=new Range,h=a.childNodes[0],i=0,j=null,k=null,l=0,m=0,n=!1;for(let d of a.childNodes)if(d.nodeType===Node.TEXT_NODE)for(let a of d.textContent??""){g.setStart(h,i),g.setEnd(h,i+a.length);let d=g.getClientRects(),o=d[d.length-1],p=o.top+f,q=o.left+e,r=o.right+e,s=q<m,t=oy.test(a);if(t===k&&p===l&&j)s&&(j.box.x=q),j.box.w=s?j.box.w+o.width:r-j.box.x,j.text+=a;else{if(j){if(b&&p!==l){n=!0;break}c.push(j)}j={box:{x:q,y:p,w:o.width,h:o.height},text:a},m=q}"\n"===a&&(m=0),k=t,l=p,i+=a.length}return j&&c.push(j),{spans:c,didTruncate:n}}measureTextSpans(a,b){if(""===a)return[];let{elm:c}=this,d="truncate-ellipsis"===b.overflow||"truncate-clip"===b.overflow,e=Math.ceil(b.width-2*b.padding),f={"font-family":b.fontFamily,"font-style":b.fontStyle,"font-weight":b.fontWeight,"font-size":b.fontSize+"px","line-height":b.lineHeight.toString(),width:`${e}px`,height:"min-content","text-align":ox[b.textAlign],"overflow-wrap":d?"anywhere":void 0,"word-break":d?"break-all":void 0,...b.otherStyles},g=this.setElementStyles(f);try{let f=ow(a);c.textContent=f;let{spans:g,didTruncate:h}=this.measureElementTextNodeSpans(c,{shouldTruncateToFirstLine:d});if("truncate-ellipsis"===b.overflow&&h){c.textContent="…";let a=Math.ceil(this.measureElementTextNodeSpans(c).spans[0].box.w);c.style.setProperty("width",`${e-a}px`),c.textContent=f;let d=this.measureElementTextNodeSpans(c,{shouldTruncateToFirstLine:!0}).spans,g=d[d.length-1];return d.push({text:"…",box:{x:Math.min(g.box.x+g.box.w,b.width-b.padding-a),y:g.box.y,w:a,h:g.box.h}}),d}return g}finally{g()}}}var oB=Object.create,oC=Object.defineProperty,oD=Object.getOwnPropertyDescriptor,oE=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),oF=a=>{throw TypeError(a)},oG=(a,b,c)=>b in a?oC(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,oH=(a,b)=>oC(a,"name",{value:b,configurable:!0}),oI=["class","method","getter","setter","accessor","field","value","get","set"],oJ=a=>void 0!==a&&"function"!=typeof a?oF("Function expected"):a,oK=(a,b,c,d,e)=>({kind:oI[a],name:b,metadata:d,addInitializer:a=>c._?oF("Already initialized"):e.push(oJ(a||null))}),oL=(a,b)=>oG(b,oE("metadata"),a[3]),oM=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=oI[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&oD(l<4?e:{get[c](){return oQ(this,f)},set[c](x){return oR(this,f,x)}},c));l?n&&l<4&&oH(f,(l>2?"set ":l>1?"get ":"")+c):oH(e,c);for(var t=d.length-1;t>=0;t--)j=oK(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>oP(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?oQ:oS)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>oR(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?oJ(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?oF("Object expected"):(oJ(g=h.get)&&(s.get=g),oJ(g=h.set)&&(s.set=g),oJ(g=h.init)&&q.unshift(g));return l||oL(a,e),s&&oC(e,c,s),n?4^l?f:s:e},oN=(a,b,c)=>oG(a,"symbol"!=typeof b?b+"":b,c),oO=(a,b,c)=>b.has(a)||oF("Cannot "+c),oP=(a,b)=>Object(b)!==b?oF('Cannot use the "in" operator on this value'):a.has(b),oQ=(a,b,c)=>(oO(a,b,"read from private field"),c?c.call(a):b.get(a)),oR=(a,b,c,d)=>(oO(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),oS=(a,b,c)=>(oO(a,b,"access private method"),c);Z=[ch],Y=[ch];class oT{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})($,5,this),oN(this,"cancelRaf"),oN(this,"isPaused",!0),oN(this,"now",0),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=df(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;let a=Date.now(),b=a-this.now;this.now=a,this.editor.inputs.updatePointerVelocity(b),this.editor.emit("frame",b),this.editor.emit("tick",b),this.cancelRaf=df(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}}oM($=[,,,oB((void 0)??null)],1,"tick",Z,oT),oM($,1,"dispose",Y,oT),oL($,oT);var oU=Object.create,oV=Object.defineProperty,oW=Object.getOwnPropertyDescriptor,oX=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),oY=a=>{throw TypeError(a)},oZ=(a,b,c)=>b in a?oV(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,o$=(a,b)=>oV(a,"name",{value:b,configurable:!0}),o_=["class","method","getter","setter","accessor","field","value","get","set"],o0=a=>void 0!==a&&"function"!=typeof a?oY("Function expected"):a,o1=(a,b,c,d,e)=>({kind:o_[a],name:b,metadata:d,addInitializer:a=>c._?oY("Already initialized"):e.push(o0(a||null))}),o2=(a,b)=>oZ(b,oX("metadata"),a[3]),o3=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=o_[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&oW(l<4?e:{get[c](){return o7(this,f)},set[c](x){return o8(this,f,x)}},c));l?n&&l<4&&o$(f,(l>2?"set ":l>1?"get ":"")+c):o$(e,c);for(var t=d.length-1;t>=0;t--)j=o1(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>o6(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?o7:o9)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>o8(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?o0(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?oY("Object expected"):(o0(g=h.get)&&(s.get=g),o0(g=h.set)&&(s.set=g),o0(g=h.init)&&q.unshift(g));return l||o2(a,e),s&&oV(e,c,s),n?4^l?f:s:e},o4=(a,b,c)=>oZ(a,"symbol"!=typeof b?b+"":b,c),o5=(a,b,c)=>b.has(a)||oY("Cannot "+c),o6=(a,b)=>Object(b)!==b?oY('Cannot use the "in" operator on this value'):a.has(b),o7=(a,b,c)=>(o5(a,b,"read from private field"),c?c.call(a):b.get(a)),o8=(a,b,c,d)=>(o5(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),o9=(a,b,c)=>(o5(a,b,"access private method"),c);ao=[dQ],an=[dQ],am=[dQ],al=[dQ],ak=[dQ],aj=[dQ],ai=[dQ],ah=[dQ],ag=[dQ],af=[dQ],ae=[dQ],ad=[dQ],ac=[dQ],ab=[dQ],aa=[dQ],_=[dQ];class pa{constructor(a,b){this.user=a,this.inferDarkMode=b,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(ap,5,this),o4(this,"systemColorScheme",d$("systemColorScheme","light")),o4(this,"disposables",new Set);return}dispose(){this.disposables.forEach(a=>a())}updateUserPreferences(a){this.user.setUserPreferences({...this.user.userPreferences.get(),...a})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode(),enhancedA11yMode:this.getEnhancedA11yMode(),inputMode:this.getInputMode(),isZoomDirectionInverted:this.getIsZoomDirectionInverted()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??j3.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??j3.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??j3.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??j3.name}getLocale(){return this.user.userPreferences.get().locale??j3.locale}getColor(){return this.user.userPreferences.get().color??j3.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??j3.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??j3.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??j3.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??j3.isPasteAtCursorMode}getEnhancedA11yMode(){return this.user.userPreferences.get().enhancedA11yMode??j3.enhancedA11yMode}getInputMode(){return this.user.userPreferences.get().inputMode??j3.inputMode}getIsZoomDirectionInverted(){return this.user.userPreferences.get().isZoomDirectionInverted??j3.isZoomDirectionInverted}}o3(ap=[,,,oU((void 0)??null)],1,"getUserPreferences",ao,pa),o3(ap,1,"getIsDarkMode",an,pa),o3(ap,1,"getEdgeScrollSpeed",am,pa),o3(ap,1,"getAnimationSpeed",al,pa),o3(ap,1,"getAreKeyboardShortcutsEnabled",ak,pa),o3(ap,1,"getId",aj,pa),o3(ap,1,"getName",ai,pa),o3(ap,1,"getLocale",ah,pa),o3(ap,1,"getColor",ag,pa),o3(ap,1,"getIsSnapMode",af,pa),o3(ap,1,"getIsWrapMode",ae,pa),o3(ap,1,"getIsDynamicResizeMode",ad,pa),o3(ap,1,"getIsPasteAtCursorMode",ac,pa),o3(ap,1,"getEnhancedA11yMode",ab,pa),o3(ap,1,"getInputMode",aa,pa),o3(ap,1,"getIsZoomDirectionInverted",_,pa),o2(ap,pa);let pb={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},pc=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class pd{constructor(a,b){this.editor=a;const{id:c,children:d,initial:e,isLockable:f,useCoalescedEvents:g}=this.constructor;this.id=c,this._isActive=d$("toolIsActive"+this.id,!1),this._current=d$("toolState"+this.id,void 0),this._path=dQ("toolPath"+this.id,()=>{let a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=b??{},b?d&&e?(this.type="branch",this.initial=e,this.children=Object.fromEntries(d().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",d&&e&&(this.initial=e,this.children=Object.fromEntries(d().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=f,this.useCoalescedEvents=g,this.performanceTracker=new cP}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(a,b={}){let c=a.split("."),d=this;for(let a=0;a<c.length;a++){let e=c[a],f=d.getCurrent(),g=d.children?.[e];if(!g)throw Error(`${d.id} - no child state exists with the id ${e}.`);if(f?.id!==g.id&&(f?.exit(b,e),d._current.set(g),g.enter(b,f?.id||"initial"),!g.getIsActive()))break;d=g}return this}handleEvent(a){let b=pb[a.name],c=this._current.__unsafe__getWithoutCapture();this[b]?.(a),this._isActive.__unsafe__getWithoutCapture()&&c&&c===this._current.__unsafe__getWithoutCapture()&&c.handleEvent(a)}enter(a,b){if(ji.measurePerformance.get()&&pc.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(a,b),this.children&&this.initial&&this.getIsActive()){let c=this.children[this.initial];this._current.set(c),c.enter(a,b)}}exit(a,b){ji.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(a,b),this.getIsActive()||this.getCurrent()?.exit(a,b)}_currentToolIdMask=d$("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(a){this._currentToolIdMask.set(a)}addChild(a){if("leaf"===this.type)throw Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});let b=new a(this.editor,this);if(this.children[b.id])throw Error(`StateNode.addChild: a child with id '${b.id}' already exists`);return this.children[b.id]=b,this}}class pe extends pd{static id="root";static initial="";static children(){return[]}}var pf=Object.create,pg=Object.defineProperty,ph=Object.getOwnPropertyDescriptor,pi=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),pj=a=>{throw TypeError(a)},pk=(a,b,c)=>b in a?pg(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pl=(a,b)=>pg(a,"name",{value:b,configurable:!0}),pm=["class","method","getter","setter","accessor","field","value","get","set"],pn=a=>void 0!==a&&"function"!=typeof a?pj("Function expected"):a,po=(a,b,c,d,e)=>({kind:pm[a],name:b,metadata:d,addInitializer:a=>c._?pj("Already initialized"):e.push(pn(a||null))}),pp=(a,b)=>pk(b,pi("metadata"),a[3]),pq=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=pm[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&ph(l<4?e:{get[c](){return pu(this,f)},set[c](x){return pv(this,f,x)}},c));l?n&&l<4&&pl(f,(l>2?"set ":l>1?"get ":"")+c):pl(e,c);for(var t=d.length-1;t>=0;t--)j=po(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>pt(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?pu:pw)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>pv(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?pn(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?pj("Object expected"):(pn(g=h.get)&&(s.get=g),pn(g=h.set)&&(s.set=g),pn(g=h.init)&&q.unshift(g));return l||pp(a,e),s&&pg(e,c,s),n?4^l?f:s:e},pr=(a,b,c)=>pk(a,"symbol"!=typeof b?b+"":b,c),ps=(a,b,c)=>b.has(a)||pj("Cannot "+c),pt=(a,b)=>Object(b)!==b?pj('Cannot use the "in" operator on this value'):a.has(b),pu=(a,b,c)=>(ps(a,b,"read from private field"),c?c.call(a):b.get(a)),pv=(a,b,c,d)=>(ps(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),pw=(a,b,c)=>(ps(a,b,"access private method"),c);class px extends(bA=kg.default,bz=[dQ],by=[dQ],bx=[dQ],bw=[dQ],bv=[dQ],bu=[dQ],bt=[dQ],bs=[dQ],br=[dQ],bq=[dQ],bp=[dQ],bo=[dQ],bn=[dQ],bm=[dQ],bl=[dQ],bk=[dQ],bj=[dQ],bi=[dQ],bh=[dQ],bg=[dQ],bf=[dQ],be=[dQ],bd=[dQ],bc=[dQ],bb=[dQ],ba=[dQ],a9=[dQ],a8=[dQ],a7=[dQ],a6=[dQ],a5=[dQ],a4=[dQ],a3=[dQ],a2=[dQ],a1=[dQ],a0=[dQ],a_=[dQ],a$=[dQ],aZ=[dQ],aY=[dQ],aX=[dQ],aW=[dQ],aV=[dQ],aU=[dQ],aT=[dQ],aS=[dQ],aR=[dQ],aQ=[dQ],aP=[dQ],aO=[dQ],aN=[dQ],aM=[dQ],aL=[dQ],aK=[dQ],aJ=[dQ],aI=[dQ],aH=[dQ],aG=[dQ],aF=[dQ],aE=[dQ],aD=[dQ],aC=[dQ],aB=[dQ],aA=[dQ],az=[dQ],ay=[dQ],ax=[dQ({isEqual:(a,b)=>a.equals(b)})],aw=[dQ],av=[dQ],au=[dQ],at=[ch],as=[ch],ar=[ch],aq=[ch],bA){constructor({store:a,user:b,shapeUtils:c,bindingUtils:d,tools:e,getContainer:f,cameraOptions:g,initialState:h,autoFocus:i,inferDarkMode:j,options:k,textOptions:l,getShapeVisibility:m,fontAssetUrls:n}){super(),((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bB,5,this),pr(this,"id",function(a){return cs(void 0)}()),pr(this,"_getShapeVisibility"),pr(this,"options"),pr(this,"contextId",function(a){return cs(void 0)}()),pr(this,"store"),pr(this,"root"),pr(this,"disposables",new Set),pr(this,"isDisposed",!1),pr(this,"_tickManager"),pr(this,"inputs"),pr(this,"snaps"),pr(this,"_spatialIndex"),pr(this,"timers",mj.forContext(this.contextId)),pr(this,"user"),pr(this,"textMeasure"),pr(this,"fonts"),pr(this,"scribbles"),pr(this,"sideEffects"),pr(this,"edgeScrollManager"),pr(this,"focusManager"),pr(this,"getContainer"),pr(this,"shapeUtils"),pr(this,"styleProps"),pr(this,"bindingUtils"),pr(this,"history"),pr(this,"_shouldIgnoreShapeLock",!1),pr(this,"_crashingError",null),pr(this,"_isChangingStyleTimeout",-1),pr(this,"menus",mi.forContext(this.contextId)),pr(this,"_currentRichTextEditor",d$("rich text editor",null)),pr(this,"_textOptions"),pr(this,"_debouncedZoomLevel",d$("debounced zoom level",1)),pr(this,"_cameraOptions",d$("camera options",jd)),pr(this,"_viewportAnimation",null),pr(this,"_willSetInitialBounds",!0),pr(this,"_isLockedOnFollowingUser",d$("isLockedOnFollowingUser",!1)),pr(this,"_cameraStateTimeoutRemaining",0),pr(this,"_currentPageShapeIds"),pr(this,"_shapeGeometryCaches",{}),pr(this,"_notVisibleShapes",function(a){let b=new Set;return dQ("notVisibleShapes",function(c){let d,e=a.getCurrentPageShapes(),f=a.getViewportPageBounds(),g=a.getShapeIdsInsideBounds(f);if(g.size===e.length)return c===dJ||c.size>0?b:c;if(c===dJ){let b=new Set;for(let c=0;c<e.length;c++)d=e[c],!g.has(d.id)&&a.getShapeUtil(d.type).canCull(d)&&b.add(d.id);return b}let h=[];for(let b=0;b<e.length;b++)d=e[b],!g.has(d.id)&&a.getShapeUtil(d.type).canCull(d)&&h.push(d.id);if(h.length===c.size){let a=!0;for(let b=0;b<h.length;b++)if(!c.has(h[b])){a=!1;break}if(a)return c}return new Set(h)})}(this)),pr(this,"_culledShapesCache",null),pr(this,"_parentIdsToChildIds"),pr(this,"animatingShapes",new Map),pr(this,"externalAssetContentHandlers",{file:null,url:null}),pr(this,"temporaryAssetPreview",new Map),pr(this,"externalContentHandlers",{text:null,files:null,"file-replace":null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),pr(this,"_clickManager",new mP(this)),pr(this,"_prevCursor","default"),pr(this,"_shiftKeyTimeout",-1),pr(this,"_altKeyTimeout",-1),pr(this,"_ctrlKeyTimeout",-1),pr(this,"_metaKeyTimeout",-1),pr(this,"_restoreToolId","select"),pr(this,"_didPinch",!1),pr(this,"_selectedShapeIdsAtPointerDown",[]),pr(this,"_longPressTimeout",-1),pr(this,"capturedPointerId",null),pr(this,"performanceTracker"),pr(this,"performanceTrackerTimeout",-1),pr(this,"handledEvents",new WeakSet),pr(this,"_pendingEventsForNextTick",[]),this._getShapeVisibility=m;const o=l?{...k,text:k?.text??l}:k;this.options={...mk,...o},this.store=a,this.history=new mV({store:a,annotateError:a=>{this.annotateError(a,{origin:"history.batch",willCrashApp:!0}),this.crash(a)}}),this.snaps=new oc(this),this._spatialIndex=new ou(this),this.disposables.add(()=>this._spatialIndex.dispose()),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...jd,...g,...o?.camera}),this._textOptions=d$("text options",o?.text??null),this.user=new pa(b??kf(),j??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=f,this.textMeasure=new oA(this),this.disposables.add(()=>this.textMeasure.dispose()),this.fonts=new mS(this,n),this._tickManager=new oT(this),this.inputs=new ng(this),this.root=new class extends pe{static initial=h??""}(this),this.root.children={},this.markEventAsHandled=this.markEventAsHandled.bind(this);const p=kT(c),q={},r={},s=new Map;for(const a of p){const b=new a(this);q[a.type]=b;const c=gj(a.props??{});for(const b of(r[a.type]=c,c.keys()))if(s.has(b.id)){if(s.get(b.id)!==b)throw Error(`Multiple style props with id "${b.id}" in use. Style prop IDs must be unique.`)}else s.set(b.id,b)}this.shapeUtils=q,this.styleProps=r;const t=kr(d),u={};for(const a of t){const b=new a(this);u[a.type]=b}for(const a of(this.bindingUtils=u,[...e])){if(cE(this.root.children,a.id))throw Error(`Can't override tool with id "${a.id}"`);this.root.children[a.id]=new a(this,this.root)}this.scribbles=new nh(this);const v=(a,b)=>{let c=null,d=a.selectedShapeIds.filter(a=>!b.has(a));d.length!==a.selectedShapeIds.length&&(c||(c={...a}),c.selectedShapeIds=d);let e=a.erasingShapeIds.filter(a=>!b.has(a));e.length!==a.erasingShapeIds.length&&(c||(c={...a}),c.erasingShapeIds=e),a.hoveredShapeId&&b.has(a.hoveredShapeId)&&(c||(c={...a}),c.hoveredShapeId=null),a.editingShapeId&&b.has(a.editingShapeId)&&(c||(c={...a}),c.editingShapeId=null);let f=a.hintingShapeIds.filter(a=>!b.has(a));return f.length!==a.hintingShapeIds.length&&(c||(c={...a}),c.hintingShapeIds=f),a.focusedGroupId&&b.has(a.focusedGroupId)&&(c||(c={...a}),c.focusedGroupId=null),c};this.sideEffects=this.store.sideEffects;let w=new Map;const y=new Set,z=new Set;let A=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{for(let a of(y.clear(),z)){z.delete(a);let b=this.getShape(a);if(!b)continue;let c=this.getShapeUtil(b),d=c.onChildrenChange?.(b);d?.length&&this.updateShapes(d)}if(A.size){let a=A;for(let b of(A=new Set,a)){let a=this.getBindingUtil(b);a.onOperationComplete?.()}}if(w.size){let a=w;for(let b of(w=new Map,a.values()))this.getBindingUtil(b.binding).onAfterDelete?.(b)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(a,b)=>{for(let c of this.getBindingsInvolvingShape(b))A.add(c.type),c.fromId===b.id&&this.getBindingUtil(c).onAfterChangeFromShape?.({binding:c,shapeBefore:a,shapeAfter:b,reason:"self"}),c.toId===b.id&&this.getBindingUtil(c).onAfterChangeToShape?.({binding:c,shapeBefore:a,shapeAfter:b,reason:"self"});if(a.parentId!==b.parentId){let a=a=>{let b=this.getShape(a);if(b)for(let a of this.getBindingsInvolvingShape(b))A.add(a.type),a.fromId===b.id&&this.getBindingUtil(a).onAfterChangeFromShape?.({binding:a,shapeBefore:b,shapeAfter:b,reason:"ancestry"}),a.toId===b.id&&this.getBindingUtil(a).onAfterChangeToShape?.({binding:a,shapeBefore:b,shapeAfter:b,reason:"ancestry"})};a(b.id),this.visitDescendants(b.id,a)}if(a.parentId!==b.parentId&&g$(b.parentId)){let c=new Set([a.id]);for(let d of(this.visitDescendants(a.id,a=>{c.add(a)}),this.getPageStates())){if(d.pageId===b.parentId)continue;let a=v(d,c);a&&this.store.put([a])}}a.parentId&&gh(a.parentId)&&z.add(a.parentId),b.parentId!==a.parentId&&gh(b.parentId)&&z.add(b.parentId)},beforeDelete:a=>{if(y.has(a.id))return;a.parentId&&gh(a.parentId)&&z.add(a.parentId),y.add(a.id);let b=[];for(let c of this.getBindingsInvolvingShape(a)){A.add(c.type),b.push(c.id);let d=this.getBindingUtil(c);c.fromId===a.id?(d.onBeforeIsolateToShape?.({binding:c,removedShape:a}),d.onBeforeDeleteFromShape?.({binding:c,shape:a})):(d.onBeforeIsolateFromShape?.({binding:c,removedShape:a}),d.onBeforeDeleteToShape?.({binding:c,shape:a}))}b.length&&this.deleteBindings(b);let c=new Set([a.id]),d=b4(this.getPageStates().map(a=>v(a,c)));d.length&&this.store.put(d)}},binding:{beforeCreate:a=>{let b=this.getBindingUtil(a).onBeforeCreate?.({binding:a});return b||a},afterCreate:a=>{A.add(a.type),this.getBindingUtil(a).onAfterCreate?.({binding:a})},beforeChange:(a,b)=>{let c=this.getBindingUtil(b).onBeforeChange?.({bindingBefore:a,bindingAfter:b});return c||b},afterChange:(a,b)=>{A.add(b.type),this.getBindingUtil(b).onAfterChange?.({bindingBefore:a,bindingAfter:b})},beforeDelete:a=>{this.getBindingUtil(a).onBeforeDelete?.({binding:a})},afterDelete:a=>{this.getBindingUtil(a).onAfterDelete?.({binding:a}),A.add(a.type)}},page:{afterCreate:a=>{let b=gO.createId(a.id),c=g7.createId(a.id);this.store.has(b)||this.store.put([gO.create({id:b})]),this.store.has(c)||this.store.put([g7.create({id:c,pageId:a.id})])},afterDelete:(a,b)=>{if(this.getInstanceState()?.currentPageId===a.id){let c=this.getPages().find(b=>b.id!==a.id)?.id;c?this.store.put([{...this.getInstanceState(),currentPageId:c}]):"user"===b&&this.store.ensureStoreIsUsable()}let c=gO.createId(a.id),d=g7.createId(a.id);this.store.remove([c,d])}},instance:{afterChange:(a,b,c)=>{if(!this.store.has(b.currentPageId)){let d=this.store.has(a.currentPageId)?a.currentPageId:this.getPages()[0]?.id;d?this.store.update(b.id,a=>({...a,currentPageId:d})):"user"===c&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(a,b)=>{if(a?.selectedShapeIds!==b?.selectedShapeIds){let a=b.selectedShapeIds.filter(a=>{let c=this.getShape(a)?.parentId;for(;gh(c);){if(b.selectedShapeIds.includes(c))return!1;c=this.getShape(c)?.parentId}return!0}),c=null;if(a.length>0){let b=this.findCommonAncestor(b4(a.map(a=>this.getShape(a))),a=>this.isShapeOfType(a,"group"));b&&(c=b)}else b?.focusedGroupId&&(c=b.focusedGroupId);(a.length!==b.selectedShapeIds.length||c!==b.focusedGroupId)&&this.store.put([{...b,selectedShapeIds:a,focusedGroupId:c??null}])}}}})),this._currentPageShapeIds=((a,b)=>{let c=a.query.ids("shape"),d=null;function e(){let e=b();return d=e,new Set([...c.get()].filter(b=>mw(a,e,a.get(b))))}return dQ("_shapeIdsInCurrentPage",(c,f)=>{if(c===dJ)return e();let g=b();if(g!==d)return e();let h=a.history.getDiffSince(f);if(h===dw)return e();let i=new eS(c);for(let b of h){for(let c of Object.values(b.added))gg(c)&&mw(a,g,c)&&i.add(c.id);for(let[c,d]of Object.values(b.updated))gg(d)&&(mw(a,g,d)?i.add(d.id):i.remove(d.id));for(let a of Object.keys(b.removed))gh(a)&&i.remove(a)}let j=i.get();return j?dL(j.value,j.diff):c})})(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=(a=>{let b=a.query.ids("shape"),c=a.query.filterHistory("shape");return dQ("parentsToChildrenWithIndexes",(d,e)=>{let f;if(d===dJ)return mv(b,a);let g=c.getDiffSince(e);if(g===dw)return mv(b,a);if(0===g.length)return d;let h=null,i=a=>{h||(h={...d}),h[a]?h[a]===d[a]&&(h[a]=[...h[a]]):h[a]=[]},j=new Set;for(let a=0,b=g.length;a<b;a++){for(let b of Object.values((f=g[a]).added))gg(b)&&(i(b.parentId),h[b.parentId].push(b.id),j.add(h[b.parentId]));for(let[a,b]of Object.values(f.updated))if(gg(b)&&gg(a)){if(a.parentId!==b.parentId)i(a.parentId),i(b.parentId),h[a.parentId].splice(h[a.parentId].indexOf(b.id),1),h[b.parentId].push(b.id),j.add(h[b.parentId]);else if(a.index!==b.index){i(b.parentId);let a=h[b.parentId].indexOf(b.id);h[b.parentId][a]=b.id,j.add(h[b.parentId])}}for(let a of Object.values(f.removed))gg(a)&&(i(a.parentId),h[a.parentId].splice(h[a.parentId].indexOf(a.id),1))}for(let b of j){let c=0;for(let d=0;d<b.length;d++)a.get(b[d])&&(b[c++]=b[d]);b.length=c,b.sort((b,c)=>c6(a.get(b),a.get(c)))}return h??d})})(this.store),this.disposables.add(this.store.listen(a=>{this.emit("change",a)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),h&&void 0===this.root.children[h])throw Error(`No state found for initialState "${h}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new mQ(this),this.focusManager=new mR(this,i),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new cP,this.store.props.collaboration?.mode){const a=this.store.props.collaboration.mode;this.disposables.add(dA("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:"readonly"===a.get()}])}))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",a=>{let b=this._getShapeVisibility(a,this);return!gZ.isId(a.parentId)&&this.isShapeHidden(a.parentId)?"visible"!==b:"hidden"===b}):null}isShapeHidden(a){return!!this._getShapeVisibility&&!!this.getIsShapeHiddenCache().get("string"==typeof a?a:a.id)}setTool(a,b){if(cE((b??=this.root).children,a.id))throw Error(`Can't override tool with id "${a.id}"`);b.children[a.id]=new a(this,b)}removeTool(a,b){cE((b??=this.root).children,a.id)&&delete b.children[a.id]}dispose(){this.disposables.forEach(a=>a()),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0,this.emit("dispose")}getShapeUtil(a){let b="string"==typeof a?a:a.type,c=cF(this.shapeUtils,b);return cd(c,`No shape util found for type "${b}"`),c}hasShapeUtil(a){let b="string"==typeof a?a:a.type;return cE(this.shapeUtils,b)}getBindingUtil(a){let b="string"==typeof a?a:a.type,c=cF(this.bindingUtils,b);return cd(c,`No binding util found for type "${b}"`),c}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}canUndo(){return this.history.getNumUndos()>0}getCanUndo(){return this.canUndo()}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}canRedo(){return this.history.getNumRedos()>0}getCanRedo(){return this.canRedo()}clearHistory(){return this.history.clear(),this}markHistoryStoppingPoint(a){let b=`[${a??"stop"}]_${cs(void 0)}`;return this.history._mark(b),b}getMarkIdMatching(a){return this.history.getMarkIdMatching(a)}squashToMark(a){return this.history.squashToMark(a),this}bail(){return this.history.bail(),this}bailToMark(a){return this.history.bailToMark(a),this}run(a,b){let c=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=b?.ignoreShapeLock??c;try{this.history.batch(a,b)}finally{this._shouldIgnoreShapeLock=c}return this}annotateError(a,{origin:b,willCrashApp:c,tags:d,extras:e}){let f=this.createErrorAnnotations(b,c);return cl(a,{tags:{...f.tags,...d},extras:{...f.extras,...e}}),c&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(a,b){try{let c=this.getEditingShapeId();return{tags:{origin:a,willCrashApp:b},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(a=>{let{props:b,...c}=a,{text:d,richText:e,...f}=b;return{...c,props:f}}),selectionCount:this.getSelectedShapes().length,editingShape:c?this.getShape(c):void 0,inputs:this.inputs.toJson(),pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:a,willCrashApp:b},extras:{}}}}getCrashingError(){return this._crashingError}crash(a){return this._crashingError=a,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:a}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(a){let b=a.split(".").reverse(),c=this.root;for(;b.length>0;){let a=b.pop();if(!a)return!0;let d=c.getCurrent();if(d?.id===a){if(0===b.length)return!0;c=d;continue}break}return!1}isInAny(...a){return a.some(a=>this.isIn(a))}setCurrentTool(a,b={}){return this.root.transition(a,b),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){let a=this.getCurrentTool();return a?a.getCurrentToolIdMask()??a.id:""}getStateDescendant(a){let b=a.split(".").reverse(),c=this.root;for(;b.length>0;){let a=b.pop();if(!a)break;let d=c.children?.[a];if(!d)return;c=d}return c}getDocumentSettings(){return this.store.get(hk)}updateDocumentSettings(a){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...a}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(g3)}updateInstanceState(a,b){return this._updateInstanceState(a,{history:"ignore",...b}),void 0!==a.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===a.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(a,b){this.run(()=>{this.store.put([{...this.getInstanceState(),...a}])},b)}setCursor(a){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...a}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return g7.createId(this.getCurrentPageId())}updateCurrentPageState(a){return this._updateCurrentPageState(a),this}_updateCurrentPageState(a){this.store.update(a.id??this.getCurrentPageState().id,b=>({...b,...a}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return b4(this.getSelectedShapeIds().map(a=>this.store.get(a)))}setSelectedShapes(a){return this.run(()=>{let b=a.map(a=>"string"==typeof a?a:a.id),{selectedShapeIds:c}=this.getCurrentPageState(),d=new Set(c);if(b.length===d.size&&b.every(a=>d.has(a)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:b}])},{history:"record-preserveRedoStack"})}isAncestorSelected(a){let b="string"==typeof a?a:a?.id??null,c=this.getShape(b);if(!c)return!1;let d=this.getSelectedShapeIds();return!!this.findShapeAncestor(c,a=>d.includes(a.id))}select(...a){let b="string"==typeof a[0]?a:a.map(a=>a.id);return this.setSelectedShapes(b),this}deselect(...a){let b="string"==typeof a[0]?a:a.map(a=>a.id),c=this.getSelectedShapeIds();return c.length>0&&b.length>0&&this.setSelectedShapes(c.filter(a=>!b.includes(a))),this}selectAll(){let a=null,b=this.getSelectedShapeIds();if(b.length>0)for(let c of b){let b=this.getShape(c);if(b){if(null===a)a=b.parentId;else if(a!==b.parentId)return this}}a||(a=this.getCurrentPageId());let c=this.getSortedChildIdsForParent(a);return c.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(c)),this}selectAdjacentShape(a){let b,c=this.getSelectedShapeIds(),d=c[0]?this.getShape(c[0])?.parentId:null,e=d&&c.every(a=>this.getShape(a)?.parentId===d)&&!g$(d),f=e?this.getCurrentPageShapes().filter(a=>a.parentId===d):this.getCurrentPageShapes().filter(a=>g$(a.parentId)),g=e?this._getShapesInReadingOrder(f):this.getCurrentPageShapesInReadingOrder(),h=1===c.length?c[0]:g.find(a=>c.includes(a.id))?.id;if("next"===a||"prev"===a){let c=g.map(a=>a.id),d=((h?c.indexOf(h):-1)+("next"===a?1:-1)+c.length)%c.length;b=c[d]}else{if(!h)return;b=this.getNearestAdjacentShape(f,h,a)}let i=this.getShape(b);i&&this._selectShapesAndZoom([i.id])}getCurrentPageShapesInReadingOrder(){let a=this.getCurrentPageShapes().filter(a=>g$(a.parentId));return this._getShapesInReadingOrder(a)}_getShapesInReadingOrder(a){let b=a.filter(a=>this.getShapeUtil(a).canTabTo(a));if(b.length<=1)return b;let c=b.map(a=>({shape:a,center:this.getShapePageBounds(a).center}));c.sort((a,b)=>a.center.y-b.center.y);let d=[];for(let a of c){let b=-1;for(let c=d.length-1;c>=0;c--){let e=d[c],f=e[e.length-1];if(100>Math.abs(a.center.y-f.center.y)){b=c;break}}-1===b?d.push([a]):d[b].push(a)}for(let a of d)a.sort((a,b)=>a.center.x-b.center.x);for(let a of d)if(!(a.length<=2))for(let b=0;b<a.length-2;b++){let c=a[b],d=a[b+1],e=a[b+2],f=iK.Dist2(c.center,d.center);iK.Dist2(c.center,e.center)<.9*f&&20>=Math.abs(iK.Angle(c.center,e.center)*(180/Math.PI))&&([a[b+1],a[b+2]]=[a[b+2],a[b+1]])}return d.flat().map(a=>a.shape)}getNearestAdjacentShape(a,b,c){let d={right:0,left:180,down:90,up:270},e=this.getShape(b);if(!e)return b;let f=a.filter(a=>this.getShapeUtil(a).canTabTo(a)&&a.id!==b);if(!f.length)return b;let g=this.getShapePageBounds(e).center,h=f.map(a=>({shape:a,center:this.getShapePageBounds(a).center})).filter(({center:a})=>{let b=a.x>g.x,d=a.y>g.y,e=a.x-g.x,f=a.y-g.y,h=Math.abs(f)<2*Math.abs(e),i=Math.abs(e)<2*Math.abs(f);return"left"===c||"right"===c?h&&("right"===c?b:!b):"up"===c||"down"===c?i&&("down"===c?d:!d):void 0});return 0===h.length?b:b6(h,({center:a})=>{let b=iK.Dist2(g,a),e=["left","right"].includes(c)?"x":"y",f=Math.abs(a[e]-g[e]),h=["left","right"].includes(c)?"y":"x";return+b+2*Math.abs(a[h]-g[h])+(b-f)*1.5+.5*Math.abs(Math.abs(iK.Angle(g,a)*(180/Math.PI))-d[c])}).shape.id}selectParentShape(){let a=this.getOnlySelectedShape();if(!a)return;let b=this.getShape(a.parentId);b&&this._selectShapesAndZoom([b.id])}selectFirstChildShape(){let a=this.getSelectedShapes();if(!a.length)return;let b=a[0],c=this.getSortedChildIdsForParent(b.id).map(a=>this.getShape(a)).filter(a=>a),d=this._getShapesInReadingOrder(c);0!==d.length&&this._selectShapesAndZoom([d[0].id])}_selectShapesAndZoom(a){this.setSelectedShapes(a),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){let a=this.getSelectedShapes();return 1===a.length?a[0]:null}getShapesPageBounds(a){let b=b4(a.map(a=>this.getShapePageBounds(a)));return 0===b.length?null:kt.Common(b)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getSelectionScreenBounds(){let a=this.getSelectionPageBounds();if(!a)return;let{x:b,y:c}=this.pageToScreen(a.point),d=this.getZoomLevel();return new kt(b,c,a.width*d,a.height*d)}getShapesSharedRotation(a){let b=!1,c=0;for(let d=0,e=a.length;d<e;d++){let e=this.getShapePageTransform(a[d]);if(e)if(b){if(e.rotation()!==c)return 0}else b=!0,c=e.rotation()}return c}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(a){if(0===a.length)return;let b=this.getShapesSharedRotation(a);if(0===b)return this.getShapesPageBounds(a)??void 0;if(1===a.length){let b=this.getShapeGeometry(a[0]).bounds.clone();return b.point=this.getShapePageTransform(a[0]).applyToPoint(b.point),b}let c=kt.FromPoints(a.flatMap(a=>{let b=this.getShapePageTransform(a);return b?b.applyToPoints(this.getShapeGeometry(a).bounds.corners):[]}).map(a=>a.rot(-b)));return c.point=c.point.rot(b),c}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){let a=this.getSelectionRotatedPageBounds();if(!a)return;let{x:b,y:c}=this.pageToScreen(a.point),d=this.getZoomLevel();return new kt(b,c,a.width*d,a.height*d)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){let a=this.getFocusedGroupId();return a?this.getShape(a):void 0}setFocusedGroup(a){let b="string"==typeof a?a:a?.id??null;if(null!==b){let a=this.getShape(b);if(!a)throw Error(`Editor.setFocusedGroup: Shape with id ${b} does not exist`);if(!this.isShapeOfType(a,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${a.type}`)}return b===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,a=>({...a,focusedGroupId:b}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){let a=this.getFocusedGroup();if(a){let b=this.findShapeAncestor(a,a=>this.isShapeOfType(a,"group"));this.setFocusedGroup(b?.id??null),this.select(a.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){let a=this.getEditingShapeId();return a?this.getShape(a):void 0}canEditShape(a,b){let c="string"==typeof a?a:a?.id??null;if(!c||c===this.getEditingShapeId())return!1;let d=this.getShape(c);if(!d)return!1;let e=this.getShapeUtil(d);return!(!e.canEdit(d,b??{type:"unknown"})||this.getIsReadonly()&&!e.canEditInReadonly(d)||this.isShapeOrAncestorLocked(d)&&!e.canEditWhileLocked(d))}setEditingShape(a){let b="string"==typeof a?a:a?.id??null;return b?this.canEditShape(b)&&this.run(()=>{let a=this.getEditingShapeId();if(a){let b=this.getShape(a);b&&this.getShapeUtil(b).onEditEnd?.(b)}this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),this.select(b),this._updateCurrentPageState({editingShapeId:b});let c=this.getShape(b);this.getShapeUtil(c).onEditStart?.(c)},{history:"ignore"}):this.run(()=>{let a=this.getEditingShapeId();if(a){let b=this.getShape(a);b&&this.getShapeUtil(b).onEditEnd?.(b)}this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null)},{history:"ignore"}),this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(a){return this._currentRichTextEditor.set(a),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){let a=this.getHoveredShapeId();return a?this.getShape(a):void 0}setHoveredShape(a){let b="string"==typeof a?a:a?.id??null;return b===this.getHoveredShapeId()||this.run(()=>{this.updateCurrentPageState({hoveredShapeId:b})},{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return b4(this.getHintingShapeIds().map(a=>this.getShape(a)))}setHintingShapes(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:b3(b)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return b4(this.getErasingShapeIds().map(a=>this.getShape(a)))}setErasingShapes(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);b.sort();let c=this.getErasingShapeIds();return this.run(()=>{if(b.length===c.length){for(let a=0;a<b.length;a++)if(b[a]!==c[a]){this._updateCurrentPageState({erasingShapeIds:b});break}}else this._updateCurrentPageState({erasingShapeIds:b})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}canCropShape(a){if(!a)return!1;let b="string"==typeof a?a:a?.id??null;if(!b)return!1;let c=this.getShape(b);return!(!c||!this.getShapeUtil(c).canCrop(c)||this.isShapeOrAncestorLocked(c))}setCroppingShape(a){let b="string"==typeof a?a:a?.id??null;return b!==this.getCroppingShapeId()&&this.run(()=>{b?this.canCropShape(b)&&this.updateCurrentPageState({croppingShapeId:b}):this.updateCurrentPageState({croppingShapeId:null})},{history:"ignore"}),this}getTextOptions(){return ce(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return gO.createId(this.getCurrentPageId())}getCamera(){let a=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){let b=this.getCameraForFollowing();if(b)return{...a,...b}}return a}_getFollowingPresence(a){let b=[this.user.getId()],c=this.getCollaborators(),d=null;for(;a&&!b.includes(a);)d=c.find(b=>b.userId===a)??null,a=d?.followingUserId??null,d&&b.push(d.userId);return d}getViewportPageBoundsForFollowing(){let a=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!a?.camera||!a?.screenBounds)return null;let{w:b,h:c}=a.screenBounds,{x:d,y:e,z:f}=a.camera,g=new kt(-d,-e,b/f,c/f),h=this.getViewportScreenBounds().clone(),i=h.width/h.height;return h.width=g.width,h.height=h.width/i,h.height<g.height&&(h.height=g.height,h.width=h.height*i),h.center=g.center,h}getCameraForFollowing(){let a=this.getViewportPageBoundsForFollowing();return a?{x:-a.x,y:-a.y,z:this.getViewportScreenBounds().w/a.width}:null}getZoomLevel(){return this.getCamera().z}getDebouncedZoomLevel(){if(this.options.debouncedZoom&&"idle"!==this.getCameraState())return this._debouncedZoomLevel.get();return this.getZoomLevel()}_getAboveDebouncedZoomThreshold(){return this.getCurrentPageShapeIds().size>this.options.debouncedZoomThreshold}getEfficientZoomLevel(){return this._getAboveDebouncedZoomThreshold()?this.getDebouncedZoomLevel():this.getZoomLevel()}getInitialZoom(){let a=this.getCameraOptions();if(!a.constraints||"default"===a.constraints.initialZoom)return 1;let{zx:b,zy:c}=pB(this,a);switch(a.constraints.initialZoom){case"fit-min":return Math.max(b,c);case"fit-max":return Math.min(b,c);case"fit-x":return b;case"fit-y":return c;case"fit-min-100":return Math.min(1,Math.max(b,c));case"fit-max-100":return Math.min(1,Math.min(b,c));case"fit-x-100":return Math.min(1,b);case"fit-y-100":return Math.min(1,c);default:throw cc(a.constraints.initialZoom)}}getBaseZoom(){let a=this.getCameraOptions();if(!a.constraints||"default"===a.constraints.baseZoom)return 1;let{zx:b,zy:c}=pB(this,a);switch(a.constraints.baseZoom){case"fit-min":return Math.max(b,c);case"fit-max":return Math.min(b,c);case"fit-x":return b;case"fit-y":return c;case"fit-min-100":return Math.min(1,Math.max(b,c));case"fit-max-100":return Math.min(1,Math.min(b,c));case"fit-x-100":return Math.min(1,b);case"fit-y-100":return Math.min(1,c);default:throw cc(a.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(a){let b=dk({...this._cameraOptions.__unsafe__getWithoutCapture(),...a});return b.zoomSteps?.length<1&&(b.zoomSteps=[1]),this._cameraOptions.set(b),this.setCamera(this.getCamera()),this}getConstrainedCamera(a,b){let c=this.getCamera(),{x:d,y:e,z:f=c.z}=a;if(!b?.force){let a=this.getCameraOptions(),g=a.zoomSteps[0],h=b5(a.zoomSteps),i=this.getViewportScreenBounds();if(a.constraints){let{constraints:j}=a,k=Math.min(j.padding.y,i.w/2),l=Math.min(j.padding.x,i.h/2),m=kt.From(a.constraints.bounds),n=(i.w-2*l)/m.w,o=(i.h-2*k)/m.h,p=this.getBaseZoom(),q=h*p,r=g*p;if(b?.reset&&(f=this.getInitialZoom()),f<r||f>q){let{x:a,y:b,z:g}=c,h=-a+i.w/g/2,j=-b+i.h/g/2;f=iS(f,r,q);let k=-a+i.w/f/2,l=-b+i.h/f/2;d=a+k-h,e=b+l-j}let s=l/f-m.x,t=k/f-m.y,u=(i.w-2*l)/f-m.w,v=(i.h-2*k)/f-m.h,w=s+u*j.origin.x,y=t+v*j.origin.y,z="string"==typeof j.behavior?j.behavior:j.behavior.x,A="string"==typeof j.behavior?j.behavior:j.behavior.y;if(b?.reset)d=w,e=y;else{switch(z){case"fixed":d=w;break;case"contain":d=f<n?w:iS(d,s+u,s);break;case"inside":d=f<n?iS(d,s,(i.w-l)/f-m.w):iS(d,s+u,s);break;case"outside":d=iS(d,l/f-m.w,(i.w-l)/f);break;case"free":break;default:throw cc(z)}switch(A){case"fixed":e=y;break;case"contain":e=f<o?y:iS(e,t+v,t);break;case"inside":e=f<o?iS(e,t,(i.h-k)/f-m.h):iS(e,t+v,t);break;case"outside":e=iS(e,k/f-m.h,(i.h-k)/f);break;case"free":break;default:throw cc(A)}}}else if(f>h||f<g){let{x:a,y:b,z:j}=c;f=iS(f,g,h),d=a+(-a+i.w/f/2)-(-a+i.w/j/2),e=b+(-b+i.h/f/2)-(-b+i.h/j/2)}}return{x:d,y:e,z:f}}_setCamera(a,b){let c=this.getCamera(),{x:d,y:e,z:f}=this.getConstrainedCamera(a,b);return c.x===d&&c.y===e&&c.z===f||dH(()=>{let a={...c,x:d,y:e,z:f};this.run(()=>{this.store.put([a])},{history:"ignore"});let g=this.inputs.getCurrentScreenPoint(),h=this.inputs.getCurrentPagePoint();(g.x/f-d!==h.x||g.y/f-e!==h.y)&&this.updatePointer({immediate:b?.immediate,pointerId:-10}),this._tickCameraState()}),this}setCamera(a,b){let{isLocked:c}=this._cameraOptions.__unsafe__getWithoutCapture();if(c&&!b?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();let d=iK.Cast(a);Number.isFinite(d.x)||(d.x=0),Number.isFinite(d.y)||(d.y=0),void 0!==d.z&&Number.isFinite(d.z)||(a.z=this.getZoomLevel());let e=this.getConstrainedCamera(d,b);if(b?.animation){let{width:a,height:c}=this.getViewportScreenBounds();this._animateToViewport(new kt(-e.x,-e.y,a/e.z,c/e.z),b)}else this._setCamera(e,{...b,force:!0});return this}centerOnPoint(a,b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{width:d,height:e}=this.getViewportPageBounds();return this.setCamera(new iK(-(a.x-d/2),-(a.y-e/2),this.getCamera().z),b),this}zoomToFit(a){let b=[...this.getCurrentPageShapeIds()].filter(a=>!this.isShapeHidden(a));if(b.length<=0)return this;let c=kt.Common(b4(b.map(a=>this.getShapePageBounds(a))));return this.zoomToBounds(c,a),this}resetZoom(a=this.getViewportScreenCenter(),b){let{isLocked:c,constraints:d}=this.getCameraOptions();if(c&&!b?.force)return this;let{x:e,y:f,z:g}=this.getCamera(),{x:h,y:i}=a,j=1;if(d){let a=this.getInitialZoom();g!==a&&(j=a)}return this.setCamera(new iK(e+(h/j-h)-(h/g-h),f+(i/j-i)-(i/g-i),j),b),this}zoomIn(a=this.getViewportScreenCenter(),b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{x:d,y:e,z:f}=this.getCamera(),{zoomSteps:g}=this.getCameraOptions();if(null!==g&&g.length>1){let c=this.getBaseZoom(),h=b5(g)*c;for(let a=1;a<g.length;a++){let b=g[a-1]*c,d=g[a]*c;if(!(d-f<=(d-b)/2)){h=d;break}}this.setCamera(new iK(d+(a.x/h-a.x)-(a.x/f-a.x),e+(a.y/h-a.y)-(a.y/f-a.y),h),b)}return this}zoomOut(a=this.getViewportScreenCenter(),b){let{isLocked:c}=this.getCameraOptions();if(c&&!b?.force)return this;let{zoomSteps:d}=this.getCameraOptions();if(null!==d&&d.length>1){let c=this.getBaseZoom(),{x:e,y:f,z:g}=this.getCamera(),h=d[0]*c;for(let a=d.length-1;a>0;a--){let b=d[a-1]*c,e=d[a]*c;if(!(e-g>=(e-b)/2)){h=b;break}}this.setCamera(new iK(e+(a.x/h-a.x)-(a.x/g-a.x),f+(a.y/h-a.y)-(a.y/g-a.y),h),b)}return this}zoomToSelection(a){let{isLocked:b}=this.getCameraOptions();if(b&&!a?.force)return this;let c=this.getSelectionPageBounds();return c&&(.01>Math.abs(this.getZoomLevel()-1)?this.zoomToBounds(c,a):this.zoomToBounds(c,{targetZoom:1,...a})),this}zoomToSelectionIfOffscreen(a=16,b){let c=this.getSelectionPageBounds(),d=this.getViewportPageBounds();if(c&&!d.contains(c)){let e=c.clone().expandBy(a/this.getZoomLevel()).expand(d),f=d.clone().translate({x:(e.center.x-d.center.x)*2,y:(e.center.y-d.center.y)*2});this.zoomToBounds(f,b)}}zoomToBounds(a,b){let c=this._cameraOptions.__unsafe__getWithoutCapture();if(c.isLocked&&!b?.force)return this;let d=this.getViewportScreenBounds(),e=b?.inset??Math.min(this.options.zoomToFitPadding,.28*d.width),f=this.getBaseZoom(),g=c.zoomSteps[0],h=b5(c.zoomSteps),i=iS(Math.min((d.width-e)/a.w,(d.height-e)/a.h),g*f,h*f);return b?.targetZoom!==void 0&&(i=Math.min(b.targetZoom,i)),this.setCamera(new iK(-a.x+(d.width-a.w*i)/2/i,-a.y+(d.height-a.h*i)/2/i,i),b),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(a){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=a;let{elapsed:b,easing:c,duration:d,start:e,end:f}=this._viewportAnimation;if(b>d){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new iK(-f.x,-f.y,this.getViewportScreenBounds().width/f.width));return}let g=c(1-(d-b)/d),h=e.minX+(f.minX-e.minX)*g,i=e.minY+(f.minY-e.minY)*g,j=e.maxX+(f.maxX-e.maxX)*g;this._setCamera(new iK(-h,-i,this.getViewportScreenBounds().width/(j-h)),{force:!0})}_animateToViewport(a,b={animation:je}){let{animation:c,...d}=b;if(!c)return;let{duration:e=0,easing:f=iH}=c,g=this.user.getAnimationSpeed(),h=this.getViewportPageBounds();return(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===e||0===g)?this._setCamera(new iK(-a.x,-a.y,this.getViewportScreenBounds().width/a.width),{...d}):(this._viewportAnimation={elapsed:0,duration:e/g,easing:f,start:h.clone(),end:a.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(a={}){let{isLocked:b}=this.getCameraOptions();if(b&&!a?.force||0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();let{speed:c,friction:d=this.options.cameraSlideFriction,direction:e,speedThreshold:f=.01}=a,g=Math.min(c,1),h=()=>{this.off("tick",i),this.off("stop-camera-animation",h)};this.once("stop-camera-animation",h);let i=a=>{let{x:b,y:c,z:i}=this.getCamera(),j=iK.Mul(e,g*a/i);(g*=1-d)<f?h():this._setCamera(new iK(b+j.x,c+j.y,i))};return this.on("tick",i),this}zoomToUser(a,b={animation:{duration:500}}){let c=this.getCollaborators().find(b=>b.userId===a);if(!c)return this;let d=c.cursor;return d&&this.run(()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();let e=c.currentPageId===this.getCurrentPageId();e||this.setCurrentPage(c.currentPageId),b&&b.animation&&!e&&(b.animation=void 0),this.centerOnPoint(d,b);let{highlightedUserIds:f}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...f,a]}),this.timers.setTimeout(()=>{let b=[...this.getInstanceState().highlightedUserIds],c=b.indexOf(a);c<0||(b.splice(c,1),this.updateInstanceState({highlightedUserIds:b}))},this.options.collaboratorIdleTimeoutMs)}),this}updateViewportScreenBounds(a,b=!1){if(a instanceof kt)a.width=Math.max(a.width,1),a.height=Math.max(a.height,1);else{let b=a.getBoundingClientRect();a=new kt(b.left||b.x,b.top||b.y,Math.max(b.width,1),Math.max(b.height,1))}let c=[0!==a.minY,!iU(document.body.scrollWidth,a.maxX,1),!iU(document.body.scrollHeight,a.maxY,1),0!==a.minX],{_willSetInitialBounds:d}=this;this._willSetInitialBounds=!1;let{screenBounds:e,insets:f}=this.getInstanceState();if(a.equals(e)&&c.every((a,b)=>a===f[b]))return this;if(d)this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this.emit("resize",a.toJson()),this.setCamera(this.getCamera());else if(b&&!this.getInstanceState().followingUserId){let b=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this.emit("resize",a.toJson()),this.centerOnPoint(b)}else this.updateInstanceState({screenBounds:a.toJson(),insets:c}),this.emit("resize",a.toJson()),this._setCamera(iK.From({...this.getCamera()}));return this}getViewportScreenBounds(){let{x:a,y:b,w:c,h:d}=this.getInstanceState().screenBounds;return new kt(a,b,c,d)}getViewportScreenCenter(){let a=this.getViewportScreenBounds();return new iK(a.w/2,a.h/2)}getViewportPageBounds(){let{w:a,h:b}=this.getViewportScreenBounds(),{x:c,y:d,z:e}=this.getCamera();return new kt(-c,-d,a/e,b/e)}screenToPage(a){let{screenBounds:b}=this.store.unsafeGetWithoutCapture(g3),{x:c,y:d,z:e=1}=this.getCamera();return new iK((a.x-b.x)/e-c,(a.y-b.y)/e-d,a.z??.5)}pageToScreen(a){let{screenBounds:b}=this.store.unsafeGetWithoutCapture(g3),{x:c,y:d,z:e=1}=this.getCamera();return new iK((a.x+c)*e+b.x,(a.y+d)*e+b.y,a.z??.5)}pageToViewport(a){let{x:b,y:c,z:d=1}=this.getCamera();return new iK((a.x+b)*d,(a.y+c)*d,a.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){let a=this._getCollaboratorsQuery().get();return a.length?[...new Set(a.map(a=>a.userId))].sort().map(b=>(function(a,b){let c,d=-1/0;for(let e of a){let a=b(e);a>d&&(c=e,d=a)}return c})(a.filter(a=>a.userId===b),a=>a.lastActivityTimestamp??0)):du}getCollaboratorsOnCurrentPage(){let a=this.getCurrentPageId();return this.getCollaborators().filter(b=>b.currentPageId===a)}startFollowingUser(a){if(this.stopFollowingUser(),this.user.getId()||console.warn("You should set the userId for the current instance before following a user"),!this._getFollowingPresence(a))return this;let b=dQ("latestLeaderPresence",()=>this._getFollowingPresence(a));return dH(()=>{this.updateInstanceState({followingUserId:a},{history:"ignore"});let c=dA("update current page",()=>{let a=b.get();a?a.currentPageId!==this.getCurrentPageId()&&this.getPage(a.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:a.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"}):this.stopFollowingUser()}),d=()=>{c(),this._isLockedOnFollowingUser.set(!1),this.off("frame",e),this.off("stop-following",d)},e=()=>{var a,c,d,e;if(!b.get())return void this.stopFollowingUser();if(this._isLockedOnFollowingUser.get())return;let f=this.user.getAnimationSpeed();if(0===f)return void this._isLockedOnFollowingUser.set(!0);let g=this.getViewportPageBoundsForFollowing();if(!g)return void this.stopFollowingUser();let h=this.getViewportPageBounds(),i=Math.abs(g.minX-h.minX)+Math.abs(g.maxX-h.maxX),j=Math.abs(g.minY-h.minY)+Math.abs(g.maxY-h.maxY);if(i<this.options.followChaseViewportSnap&&j<this.options.followChaseViewportSnap)return void this._isLockedOnFollowingUser.set(!0);let k=iS(.5*f,.1,.8),l=new kt((a=h.minX,a+(g.minX-a)*k),(c=h.minY,c+(g.minY-c)*k),(d=h.width,d+(g.width-d)*k),(e=h.height,e+(g.height-e)*k)),m=new iK(-l.x,-l.y,this.getViewportScreenBounds().width/l.width);this.stopCameraAnimation(),this._setCamera(m)};this.once("stop-following",d),this.addListener("frame",e),e()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(a){let b=[],c=2*this.options.maxShapesPerPage,d=this.options.maxShapesPerPage,e=this.getErasingShapeIds(),f=(g,h,i)=>{let j=this.getShape(g);if(!j)return;if(this.isShapeHidden(j)){let a=i||e.includes(g);for(let b of this.getSortedChildIdsForParent(g))f(b,h,a);return}h*=j.opacity;let k=!1,l=this.getShapeUtil(j);a&&(k=!i&&e.includes(g))&&(h*=.32),b.push({id:g,shape:j,util:l,index:c,backgroundIndex:d,opacity:h}),c+=1,d+=1;let m=this.getSortedChildIdsForParent(g);if(!m.length)return;let n=null;for(let a of(l.providesBackgroundForChildren(j)&&(n=d,d=c,c+=this.options.maxShapesPerPage),m))f(a,h,i||k);null!==n&&(d=n)};for(let b of a?[this.getCurrentPage()]:this.getPages())for(let a of this.getSortedChildIdsForParent(b.id))f(a,1,!1);return b}_decayCameraStateTimeout(a){this._cameraStateTimeoutRemaining-=a,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._setCameraState("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this.getInstanceState().cameraState&&(this._setCameraState("moving"),this._debouncedZoomLevel.set(dU(()=>this.getCamera().z)),this.on("tick",this._decayCameraStateTimeout))}_setCameraState(a){this.updateInstanceState({cameraState:a},{history:"ignore"})}getCameraState(){return this.getInstanceState().cameraState}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(c7)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(c6)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(a){return this.store.get("string"==typeof a?a:a.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(a){let b="string"==typeof a?a:a.id,c=this.store.query.exec("shape",{parentId:{eq:b}});return this.getShapeAndDescendantIds(c.map(a=>a.id))}setCurrentPage(a){let b="string"==typeof a?a:a.id;return this.store.has(b)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:b}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(a){return this.getIsReadonly()||!this.getPage(a.id)?this:this.run(()=>this.store.update(a.id,b=>({...b,...a})))}createPage(a){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;let b=this.getPages(),c=function(a,b){let c=a,d=new Set(b);for(;d.has(c);)c=/^.*(\d+)$/.exec(c)?.[1]?c.replace(/(\d+)(?=\D?)$/,a=>(+a+1).toString()):`${c} 1`;return c}(a.name??"Page 1",b.map(a=>a.name)),d=a.index;(!d||b.some(a=>a.index===d))&&(d=c4(b[b.length-1].index));let e=gZ.create({meta:{},...a,name:c,index:d});this.store.put([e])}),this}deletePage(a){let b="string"==typeof a?a:a.id;return this.run(()=>{if(this.getIsReadonly())return;let a=this.getPages();if(1===a.length)return;let c=this.getPage(b);if(!c)return;if(b===this.getCurrentPageId()){let c=a.findIndex(a=>a.id===b),d=a[c-1]??a[c+1];this.setCurrentPage(d.id)}let d=this.getSortedChildIdsForParent(c.id);this.deleteShapes(d),this.store.remove([c.id])},{ignoreShapeLock:!0}),this}duplicatePage(a,b=gZ.createId()){if(this.getPages().length>=this.options.maxPages)return this;let c="string"==typeof a?a:a.id,d=this.getPage(c);if(!d)return this;let e={...this.getCamera()},f=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(d.id));return this.run(()=>{let a=this.getPages(),c=c3(d.index,a[a.indexOf(d)+1]?.index);if(this.createPage({name:d.name+" Copy",id:b,index:c}),this.setCurrentPage(b),this.setCamera(e),f)return this.putContentOntoCurrentPage(f)}),this}renamePage(a,b){let c="string"==typeof a?a:a.id;return this.getIsReadonly()||this.updatePage({id:c,name:b}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(a){return this.getIsReadonly()||a.length<=0||this.run(()=>this.store.put(a),{history:"ignore"}),this}updateAssets(a){return this.getIsReadonly()||a.length<=0||this.run(()=>{this.store.put(a.map(a=>({...this.store.get(a.id),...a})))},{history:"ignore"}),this}deleteAssets(a){if(this.getIsReadonly())return this;let b="string"==typeof a[0]?a:a.map(a=>a.id);return b.length<=0||this.run(()=>{this.store.props.assets.remove?.(b),this.store.remove(b)},{history:"ignore"}),this}getAsset(a){return this.store.get("string"==typeof a?a:a.id)}async resolveAssetUrl(a,b){if(!a)return null;let c=this.getAsset(a);if(!c)return null;let{screenScale:d=1,shouldResolveToOriginal:e=!1,dpr:f=this.getInstanceState().devicePixelRatio}=b,g=Math.pow(2,Math.ceil(Math.log2(d))),h="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(c,{screenScale:d||1,steppedScreenScale:g,dpr:f,networkEffectiveType:h,shouldResolveToOriginal:e})}async uploadAsset(a,b,c){return await this.store.props.assets.upload(a,b,c)}getShapeGeometry(a,b){let c=b?.context??"none";return this._shapeGeometryCaches[c]||(this._shapeGeometryCaches[c]=this.store.createComputedCache("bounds",a=>(this.fonts.trackFontsForShape(a),this.getShapeUtil(a).getGeometry(a,b)),{areRecordsEqual:lL})),this._shapeGeometryCaches[c].get("string"==typeof a?a:a.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",a=>this.getShapeUtil(a).getHandles?.(a),{areRecordsEqual:lL})}getShapeHandles(a){return this._getShapeHandlesCache().get("string"==typeof a?a:a.id)}getShapeLocalTransform(a){let b="string"==typeof a?a:a.id,c=this.getShape(b);if(!c)throw Error("Editor.getTransform: shape not found");return ku.Identity().translate(c.x,c.y).rotate(c.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",a=>{if(g$(a.parentId))return this.getShapeLocalTransform(a);let b=this._getShapePageTransformCache().get(a.parentId)??ku.Identity();return ku.Compose(b,this.getShapeLocalTransform(a))})}getShapeParentTransform(a){let b="string"==typeof a?a:a.id,c=this.getShape(b);return!c||g$(c.parentId)?ku.Identity():this._getShapePageTransformCache().get(c.parentId)??ku.Identity()}getShapePageTransform(a){let b="string"==typeof a?a:a.id;return this._getShapePageTransformCache().get(b)??ku.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",a=>{let b=this.getShapePageTransform(a);if(b)return kt.FromPoints(b.applyToPoints(this.getShapeGeometry(a).boundsVertices))})}getShapePageBounds(a){return this._getShapePageBoundsCache().get("string"==typeof a?a:a.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",a=>{let b=this._getShapeMaskCache().get(a.id);if(!b)return;if(0===b.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";let c=this._getShapePageTransformCache().get(a.id);if(!c)return;let d=ku.applyToPoints(ku.Inverse(c),b);return`polygon(${d.map(a=>`${a.x}px ${a.y}px`).join(",")})`})}getShapeClipPath(a){return this._getShapeClipPathCache().get("string"==typeof a?a:a.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",a=>{if(g$(a.parentId))return;let b=[];for(let c of this.getShapeAncestors(a.id)){let d=this.getShapeUtil(c),e=d.getClipPath?.(c);if(!e||d.shouldClipChild?.(a)===!1)continue;let f=this.getShapePageTransform(c.id);b.push(f.applyToPoints(e))}if(0!==b.length)return b.reduce((a,b)=>{let c=kA(a,b);return c?c.map(iK.Cast):[]})})}getShapeMask(a){return this._getShapeMaskCache().get("string"==typeof a?a:a.id)}getShapeMaskedPageBounds(a){return"string"!=typeof a&&(a=a.id),this._getShapeMaskedPageBoundsCache().get(a)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",a=>{let b=this._getShapePageBoundsCache().get(a.id);if(!b)return;let c=this._getShapeMaskCache().get(a.id);if(c){if(0===c.length)return;let{corners:a}=b;if(a.every((a,b)=>a&&iK.Equals(a,c[b])))return b.clone();let d=kA(c,a);if(!d)return;return kt.FromPoints(d)}return b})}getShapeAncestors(a,b=[]){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return b;let e=d.parentId;if(g$(e))return b.reverse(),b;let f=this.store.get(e);return f?(b.push(f),this.getShapeAncestors(f,b)):b}findShapeAncestor(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return;let e=d.parentId;if(g$(e))return;let f=this.getShape(e);if(f)return b(f)?f:this.findShapeAncestor(f,b)}hasAncestor(a,b){let c="string"==typeof a?a:a?.id,d=c&&this.getShape(c);return!!d&&(d.parentId===b||this.hasAncestor(this.getShapeParent(d),b))}findCommonAncestor(a,b){if(0===a.length)return;let c=b4(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a)));if(1===c.length){let a=c[0].parentId;if(g$(a))return;return b?this.findShapeAncestor(c[0],b)?.id:a}let[d,...e]=c,f=this.getShapeParent(d);for(;f;){if(b&&!b(f)){f=this.getShapeParent(f);continue}if(e.every(a=>this.hasAncestor(a,f.id)))return f.id;f=this.getShapeParent(f)}}isShapeOrAncestorLocked(a){let b=a&&this.getShape(a);return void 0!==b&&(!!b.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(b)))}getNotVisibleShapes(){return this._notVisibleShapes.get()}getCulledShapes(){let a=this.getNotVisibleShapes(),b=this.getSelectedShapeIds(),c=this.getEditingShapeId(),d=new Set(a);c&&d.delete(c),b.forEach(a=>{d.delete(a)});let e=this._culledShapesCache;if(e){if(e.size!==d.size)return this._culledShapesCache=d,d;for(let a of e)if(!d.has(a))return this._culledShapesCache=d,d;return e}return this._culledShapesCache=d,d}getCurrentPageBounds(){let a;return this.getCurrentPageShapeIdsSorted().forEach(b=>{if(this.isShapeHidden(b))return;let c=this.getShapeMaskedPageBounds(b);c&&(a=a?a.expand(c):c.clone())}),a}getSelectedShapeAtPoint(a){let b=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(a=>"group"!==a.type&&b.includes(a.id)).reverse().find(b=>this.isPointInShape(b,a,{hitInside:!0,margin:0}))}getShapeAtPoint(a,b={}){let c=this.getZoomLevel(),d=this.getViewportPageBounds(),{filter:e,margin:f=0,hitLocked:g=!1,hitLabels:h=!1,hitInside:i=!1,hitFrameInside:j=!1}=b,[k,l]=Array.isArray(f)?f:[f,f],m=1/0,n=null,o=1/0,p=null,q=Math.max(k,l,this.options.hitTestMargin/c),r=this._spatialIndex.getShapeIdsAtPoint(a,q),s=(b.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(b=>{if(!r.has(b.id)&&!this.isShapeOfType(b,"frame")||b.isLocked&&!g||this.isShapeHidden(b)||this.isShapeOfType(b,"group"))return!1;let c=this.getShapeMask(b);return(!c||!!i4(a,c))&&(!e||!!e(b))});for(let b=s.length-1;b>=0;b--){let e,f=s[b],g=this.getShapeGeometry(f),q=g instanceof kI,r=this.getPointInShapeSpace(f,a);if(this.isShapeOfType(f,"frame")||(this.isShapeOfType(f,"note")||this.isShapeOfType(f,"arrow")||this.isShapeOfType(f,"geo")&&"none"===f.props.fill)&&this.getShapeUtil(f).getText(f)?.trim()){for(let a of g.children)if(a.isLabel&&a.isPointInBounds(r))return f}if(this.isShapeOfType(f,"frame")){let a=g.distanceToPoint(r,j);if(j?a>0&&a<=l||a<=0&&a>-k:a>0&&a<=l)return p||f;if(g.hitTestPoint(r,0,!0))return p||n||(j?f:void 0);continue}if(q){let a=1/0;for(let b of g.children){if(b.isLabel&&!h)continue;let c=b.distanceToPoint(r,i);c<a&&(a=c)}e=a}else e=0===l&&(g.bounds.w<1||g.bounds.h<1)||g.bounds.containsPoint(r,l)?g.distanceToPoint(r,i):1/0;if(g.isClosed){if(e<=l||i&&e<=0&&e>-k)if(g.isFilled||q&&g.children[0].isFilled)return p||f;else{if(this.getShapePageBounds(f).contains(d))continue;if(i?e>0&&e<=l||e<=0&&e>-k:Math.abs(e)<=Math.max(k,l))Math.abs(e)<o&&(o=Math.abs(e),p=f);else if(!p){let{area:a}=g;a<m&&(m=a,n=f)}}}else if(e<this.options.hitTestMargin/c)return f}return p||n||void 0}getShapesAtPoint(a,b={}){let c=b.margin??0,d=this._spatialIndex.getShapeIdsAtPoint(a,c);return this.getCurrentPageShapesSorted().filter(c=>!this.isShapeHidden(c)&&(!!d.has(c.id)||!!this.isShapeOfType(c,"frame"))&&this.isPointInShape(c,a,b)).reverse()}getShapeIdsInsideBounds(a){return this._spatialIndex.getShapeIdsInsideBounds(a)}isPointInShape(a,b,c={}){let{hitInside:d=!1,margin:e=0}=c,f="string"==typeof a?a:a.id,g=this.getShapeMask(f);return(!g||!!i4(b,g))&&this.getShapeGeometry(f).hitTestPoint(this.getPointInShapeSpace(a,b),e,d)}getPointInShapeSpace(a,b){let c="string"==typeof a?a:a.id;return this._getShapePageTransformCache().get(c).clone().invert().applyToPoint(b)}getPointInParentSpace(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return new iK(0,0);if(g$(d.parentId))return iK.From(b);let e=this.getShapePageTransform(d.parentId);return e?e.clone().invert().applyToPoint(b):iK.From(b)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),a=>this.store.get(a))}getCurrentPageShapesSorted(){let a=[],b=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let c=0,d=b.length;c<d;c++)!function a(b,c,d){let e=b.getShape(c);if(!e)return;d.push(e);let f=b.getSortedChildIdsForParent(c);for(let c=0,e=f.length;c<e;c++)a(b,f[c],d)}(this,b[c],a);return a}getCurrentPageRenderingShapesSorted(){let a=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:b})=>!a.has(b)&&!this.isShapeHidden(b))}isShapeOfType(a,b){let c="string"==typeof a?this.getShape(a):a;return!!c&&c.type===b}getShape(a){let b="string"==typeof a?a:a.id;if(gh(b))return this.store.get(b)}getShapeParent(a){let b="string"==typeof a?a:a?.id;if(!b)return;let c=this.getShape(b);if(void 0!==c&&gh(c.parentId))return this.getShape(c.parentId)}getShapeNearestSibling(a,b){return b?b.parentId===a.parentId?b:this.findShapeAncestor(b,b=>b.parentId===a.parentId):void 0}isShapeInPage(a,b=this.getCurrentPageId()){let c="string"==typeof a?a:a.id,d=this.getShape(c);if(!d)return!1;let e=!1;if(d.parentId===b)e=!0;else{let a=this.getShape(d.parentId);for(;a;){if(a.parentId===b){e=!0;break}a=this.getShape(a.parentId)}}return e}getAncestorPageId(a){let b="string"==typeof a?a:a?.id,c=b&&this.getShape(b);if(c)if(g$(c.parentId))return c.parentId;else return this.getAncestorPageId(this.getShape(c.parentId))}reparentShapes(a,b,c){let d="string"==typeof a[0]?a:a.map(a=>a.id);if(0===d.length)return this;let e=[],f=g$(b)?ku.Identity():this.getShapePageTransform(b),g=f.rotation(),h=[],i=b4(this.getSortedChildIdsForParent(b).map(a=>this.getShape(a)));if(c){let a=i.find(a=>a.index===c);if(a){let b=i[i.indexOf(a)+1];h=b?c1(c,b.index,d.length):c2(c,d.length)}else{let a=i.sort(c6).find(a=>a.index>c);h=a?c1(c,a.index,d.length):c2(c,d.length)}}else{let a=i.length&&i[i.length-1];h=a?c2(a.index,d.length):c5(d.length)}let j=f.clone().invert(),k=b4(d.map(a=>this.getShape(a))).sort(c6);return this.run(()=>{for(let a=0;a<k.length;a++){let c=k[a],d=this.getShapePageTransform(c);if(!d)continue;let f=d.point();if(!f)continue;let i=j.applyToPoint(f),l=d.rotation()-g;if(c.id===b)throw Error("Attempted to reparent a shape to itself!");e.push({id:c.id,type:c.type,parentId:b,x:i.x,y:i.y,rotation:l,index:h[a]})}this.updateShapes(e)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(a){let b="string"==typeof a?a:a.id,c=this._parentIdsToChildIds.get()[b];return c&&0!==c.length?c4(this.getShape(c[c.length-1]).index):c4("a0")}getSortedChildIdsForParent(a){let b="string"==typeof a?a:a.id,c=this._parentIdsToChildIds.get()[b];return c||du}visitDescendants(a,b){for(let c of this.getSortedChildIdsForParent(a))!1!==b(c)&&this.visitDescendants(c,b);return this}getShapeAndDescendantIds(a){let b=new Set;for(let c of a.map(a=>this.getShape(a)).sort(c6))b.add(c.id),this.visitDescendants(c,a=>{b.add(a)});return b}getDraggingOverShape(a,b){let c=b4(b.map(a=>this.getShape(a))).filter(a=>!a.isLocked&&!this.isShapeHidden(a));for(let d of this.getShapesAtPoint(a,{hitInside:!0,margin:0}).filter(a=>!b.includes(a)&&!a.isLocked&&!this.isShapeHidden(a)&&!c.includes(a))){let a=this.getShapeUtil(d);if(a.onDragShapesOver||a.onDragShapesIn||a.onDragShapesOut||a.onDropShapesOver)return d}}getOutermostSelectableShape(a,b){let c="string"==typeof a?a:a.id,d=this.getShape(c),e=d,f=d,g=this.getFocusedGroup();for(;f;){if(this.isShapeOfType(f,"group")&&g?.id!==f.id&&!this.hasAncestor(g,f.id)&&(b?.(f)??!0))e=f;else if(g?.id===f.id)break;f=this.getShapeParent(f)}return e}_getBindingsIndexCache(){let a=(a=>{let{store:b}=a,c=b.query.filterHistory("binding"),d=b.query.records("binding");return dQ("arrowBindingsIndex",(a,b)=>{let e;if(a===dJ)return mu(d);let f=c.getDiffSince(b);if(f===dw)return mu(d);function g(b){let c=(e??=new Map(a)).get(b.fromId),d=c?.filter(a=>a.id!==b.id);d?.length?e.set(b.fromId,d):e.delete(b.fromId);let f=e.get(b.toId),g=f?.filter(a=>a.id!==b.id);g?.length?e.set(b.toId,g):e.delete(b.toId)}function h(b){let c=(e??=new Map(a)).get(b);return c?c===a.get(b)&&(c=c.slice(0),e.set(b,c)):(c=[],e.set(b,c)),c}function i(a){h(a.fromId).push(a),h(a.toId).push(a)}for(let a of f){for(let b of cH(a.added))i(b);for(let[b,c]of cH(a.updated))g(b),i(c);for(let b of cH(a.removed))g(b)}return e??a})})(this);return this.store.createComputedCache("bindingsIndex",b=>a.get().get(b.id),{areRecordsEqual:()=>!0})}getBinding(a){return this.store.get(a)}getBindingsFromShape(a,b){let c="string"==typeof a?a:a.id;return this.getBindingsInvolvingShape(c).filter(a=>a.fromId===c&&a.type===b)}getBindingsToShape(a,b){let c="string"==typeof a?a:a.id;return this.getBindingsInvolvingShape(c).filter(a=>a.toId===c&&a.type===b)}getBindingsInvolvingShape(a,b){let c="string"==typeof a?a:a.id,d=this._getBindingsIndexCache().get(c)??du;return b?d.filter(a=>a.type===b):d}createBindings(a){let b=[];for(let c of a){let a=this.getShape(c.fromId),d=this.getShape(c.toId);if(!a||!d||!this.canBindShapes({fromShape:a,toShape:d,binding:c}))continue;let e=this.getBindingUtil(c.type).getDefaultProps(),f=this.store.schema.types.binding.create({...c,id:c.id??f9(),props:{...e,...c.props}});b.push(f)}return this.store.put(b),this}createBinding(a){return this.createBindings([a])}updateBindings(a){let b=[];for(let c of a){if(!c)continue;let a=this.getBinding(c.id);if(!a)continue;let d=pz(a,c);if(d===a)continue;let e=this.getShape(d.fromId),f=this.getShape(d.toId);e&&f&&this.canBindShapes({fromShape:e,toShape:f,binding:d})&&b.push(d)}return this.store.put(b),this}updateBinding(a){return this.updateBindings([a])}deleteBindings(a,{isolateShapes:b=!1}={}){let c=a.map(a=>"string"==typeof a?a:a.id);return b?this.store.atomic(()=>{for(let a of c){let b=this.getBinding(a);if(!b)continue;let c=this.getBindingUtil(b);c.onBeforeIsolateFromShape?.({binding:b,removedShape:this.getShape(b.toId)}),c.onBeforeIsolateToShape?.({binding:b,removedShape:this.getShape(b.fromId)}),this.store.remove([a])}}):this.store.remove(c),this}deleteBinding(a,b){return this.deleteBindings([a],b)}canBindShapes({fromShape:a,toShape:b,binding:c}){let d="string"==typeof a?a:a.type,e="string"==typeof b?b:b.type,f={fromShape:"string"==typeof a?{type:a}:a,toShape:"string"==typeof b?{type:b}:b,bindingType:"string"==typeof c?c:c.type,fromShapeType:d,toShapeType:e};return d===e?this.getShapeUtil(d).canBind(f):this.getShapeUtil(d).canBind(f)&&this.getShapeUtil(e).canBind(f)}rotateShapesBy(a,b,c){let d="string"==typeof a[0]?a:a.map(a=>a.id);if(d.length<=0)return this;let e=ms({editor:this,ids:d});return e&&mt({delta:b,snapshot:e,editor:this,stage:"one-off",centerOverride:c?.center}),this}getChangesToTranslateShape(a,b){let c=a,d=this.getShapeUtil(a),e=d.onTranslateStart?.(c);e&&(c=pz(c,e)),c=pz(c,{id:a.id,type:a.type,x:b.x,y:b.y});let f=d.onTranslate?.(a,c);f&&(c=pz(c,f));let g=d.onTranslateEnd?.(a,c);return g&&(c=pz(c,g)),c}nudgeShapes(a,b){let c="string"==typeof a[0]?a:a.map(a=>a.id);if(c.length<=0)return this;let d=[];for(let a of c){let c=this.getShape(a),e=iK.From(b),f=this.getShapeParentTransform(c);f&&e.rot(-f.rotation()),d.push(this.getChangesToTranslateShape(c,e.add(c)))}return this.updateShapes(d),this}duplicateShapes(a,b){return this.run(()=>{let c="string"==typeof a[0]?a:a.map(a=>a.id),d=this._shouldIgnoreShapeLock?c:this._getUnlockedShapeIds(c);if(d.length<=0)return this;let e=new Set(d),f=this.getShapeAndDescendantIds(d),g=[...f].reverse(),h=new Map;for(let a of f)h.set(a,gi());let{shapesToCreateWithOriginals:i,bindingsToCreate:j}=pA(this,f,a=>{let c=[];for(let b of a){let a=this.getBinding(b);if(!a)continue;let d=f9();c.push({...a,id:d,fromId:ce(h.get(a.fromId)),toId:ce(h.get(a.toId))})}let d=[];for(let a of g){let c=ce(h.get(a)),f=this.getShape(a);if(!f)continue;let g=0,i=0;if(b&&e.has(a)){let a=this.getShapeParentTransform(f),c=new iK(b.x,b.y).rot(-a.rotation());g=c.x,i=c.y}d.push({shape:{...f,id:c,x:f.x+g,y:f.y+i,index:"a1",parentId:h.get(f.parentId)??f.parentId},originalShape:f})}return{shapesToCreateWithOriginals:d,bindingsToCreate:c}});i.forEach(({shape:a,originalShape:b})=>{let c=b.parentId,d=this.getSortedChildIdsForParent(c),e=d.indexOf(b.id),f=d[e+1],g=f?this.getShape(f):void 0;a.index=c3(b.index,g?.index)});let k=i.map(({shape:a})=>a);if(!this.canCreateShapes(k))return void py(this);if(this.createShapes(k),this.createBindings(j),this.setSelectedShapes(b4(d.map(a=>{let b=h.get(a);return b&&this.getShape(b)?b:null}))),void 0!==b){let a=this.getSelectionPageBounds(),b=this.getViewportPageBounds();a&&!b.contains(a)&&this.centerOnPoint(a.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(a,b){let c="string"==typeof a[0]?a:a.map(a=>a.id);if(0===c.length||this.getIsReadonly()||b===this.getCurrentPageId()||!this.store.has(b))return this;let d=this.getContentFromCurrentPage(c);if(!d)return this;if(this.getPageShapeIds(b).size+d.shapes.length>this.options.maxShapesPerPage)return py(this,b),this;let e=this.getCamera().z;return this.run(()=>{this.deleteShapes(c),this.setCurrentPage(b),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(d,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:e}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly()||0===b.length)return this;let c=!0,d=!0,e=[];for(let a of b){let b=this.getShape(a);b&&(e.push(b),b.isLocked?d=!1:c=!1)}return this.run(()=>{d?(this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):c?this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(e.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(a){let b=mq(this,"toBack","string"==typeof a[0]?a:a.map(a=>a.id),{considerAllShapes:!0});return b&&this.updateShapes(b),this}sendBackward(a,b={}){let c=mq(this,"backward","string"==typeof a[0]?a:a.map(a=>a.id),b);return c&&this.updateShapes(c),this}bringForward(a,b={}){let c=mq(this,"forward","string"==typeof a[0]?a:a.map(a=>a.id),b);return c&&this.updateShapes(c),this}bringToFront(a){let b=mq(this,"toFront","string"==typeof a[0]?a:a.map(a=>a.id));return b&&this.updateShapes(b),this}collectShapesViaArrowBindings(a){let{initialShapes:b,resultShapes:c,resultBounds:d,bindings:e,visited:f}=a;for(let g of e)for(let e of[g.fromId,g.toId])if(!f.has(e)){let g=b.find(a=>a.id===e);if(g&&!f.has(g.id)){f.add(g.id);let b=this.getShapePageBounds(g);if(!b)continue;c.push(g),d.push(b),this.collectShapesViaArrowBindings({...a,bindings:this.getBindingsInvolvingShape(g,"arrow")})}}}flipShapes(a,b){if(this.getIsReadonly())return this;let c=b4(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a)));for(let a of c)if(this.isShapeOfType(a,"group")){let b=b4(this.getSortedChildIdsForParent(a.id).map(a=>this.getShape(a)));c.push(...b)}let d=[],e=[];for(let a of c){let b=this.getShapeUtil(a);if(!b.canBeLaidOut(a,{type:"flip",shapes:c}))continue;let f=this.getShapePageBounds(a),g=this.getShapeGeometry(a).bounds,h=this.getShapePageTransform(a.id);f&&g&&h&&(d.push({shape:a,localBounds:g,pageTransform:h,isAspectRatioLocked:b.isAspectRatioLocked(a)}),e.push(f))}if(!d.length)return this;let f=kt.Common(e).center;return this.run(()=>{for(let{shape:a,localBounds:c,pageTransform:e,isAspectRatioLocked:g}of d)this.resizeShape(a.id,{x:"horizontal"===b?-1:1,y:"vertical"===b?-1:1},{initialBounds:c,initialPageTransform:e,initialShape:a,isAspectRatioLocked:g,mode:"scale_shape",scaleOrigin:f,scaleAxisRotation:0})}),this}stackShapes(a,b,c){let d,e,f,g,h=c??this.options.adjacentShapeMargin,i="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly())return this;let j=b4(i.map(a=>this.getShape(a))),k=[],l=[],m=new Set;for(let a of j){if(m.has(a.id))continue;m.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"stack",shapes:j}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:j,resultShapes:c,resultBounds:d,visited:m});let e=kt.Common(d);e&&(k.push({shapes:c,pageBounds:e}),l.push(e))}let n=k.length;if(0===h&&n<3||n<2)return this;"horizontal"===b?(d="x",e="minX",f="maxX",g="width"):(d="y",e="minY",f="maxY",g="height");let o=0;if(0===h){let a={};k.sort((a,b)=>a.pageBounds[e]-b.pageBounds[e]);for(let b=0;b<n-1;b++){let c=k[b],d=k[b+1].pageBounds[e]-c.pageBounds[f];a[d]||(a[d]=0),a[d]++}let b=1;for(let[c,d]of Object.entries(a))d>b&&(b=d,o=parseFloat(c));if(1===b){let b=0;for(let[c,d]of Object.entries(a))o+=parseFloat(c)*d,b+=d;o/=b}}else o=h;let p=[],q=k[0].pageBounds[f];for(let a=1;a<k.length;a++){let{shapes:b,pageBounds:c}=k[a],e=new iK;for(let a of(e[d]=q+o-c[d],b)){let b=e.clone(),c=this.getShapeParent(a);if(c){let a=this.getShapePageTransform(c);a&&b.rot(-a.rotation())}b.add(a),p.push(this.getChangesToTranslateShape(a,b))}q+=c[g]+o}return this.updateShapes(p),this}packShapes(a,b){let c,d;if(this.getIsReadonly())return this;let e=b??this.options.adjacentShapeMargin,f=b4(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a))),g=[],h=[],i=new Set;for(let a of f){if(i.has(a.id))continue;i.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"pack",shapes:f}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:f,resultShapes:c,resultBounds:d,visited:i});let e=kt.Common(d);e&&(g.push({shapes:c,pageBounds:e,nextPageBounds:e.clone()}),h.push(e))}if(g.length<2)return this;let j=0;for(let{pageBounds:a}of g)j+=a.width*a.height;let k=kt.Common(h),l=k.width;g.sort((a,b)=>a.pageBounds.width-b.pageBounds.width).sort((a,b)=>a.pageBounds.height-b.pageBounds.height);let m=Math.max(Math.ceil(Math.sqrt(j/.95)),l),n=[new kt(k.x,k.y,m,1/0)],o=0,p=0;for(let{nextPageBounds:a}of g)for(let b=n.length-1;b>=0;b--)if(c=n[b],!(a.width>c.width)&&!(a.height>c.height)){a.x=c.x,a.y=c.y,p=Math.max(p,a.maxY),o=Math.max(o,a.maxX),a.width===c.width&&a.height===c.height?(d=n.pop(),b<n.length&&(n[b]=d)):a.height===c.height?(c.x+=a.width+e,c.width-=a.width+e):(a.width===c.width||n.push(new kt(c.x+(a.width+e),c.y,c.width-(a.width+e),a.height)),c.y+=a.height+e,c.height-=a.height+e);break}let q=kt.Common(g.map(a=>a.nextPageBounds)),r=iK.Sub(k.center,q.center),s=[];for(let{shapes:a,pageBounds:b,nextPageBounds:c}of g){let d=iK.Sub(c.point,b.point).add(r);for(let b of a){let a=d.clone();if(this.getShapeParent(b)){let c=this.getShapeParentTransform(b);c&&a.rot(-c.rotation())}a.add(b),s.push(this.getChangesToTranslateShape(b,a))}}return s.length&&this.updateShapes(s),this}alignShapes(a,b){if(this.getIsReadonly())return this;let c=b4(("string"==typeof a[0]?a:a.map(a=>a.id)).map(a=>this.getShape(a))),d=[],e=[],f=new Set;for(let a of c){if(f.has(a.id))continue;f.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"align",shapes:c}))continue;let g=[a],h=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:c,resultShapes:g,resultBounds:h,visited:f});let i=kt.Common(h);i&&(d.push({shapes:g,pageBounds:i}),e.push(i))}if(d.length<2)return this;let g=kt.Common(e),h=[];return d.forEach(({shapes:a,pageBounds:c})=>{let d=new iK;switch(b){case"top":d.y=g.minY-c.minY;break;case"center-vertical":d.y=g.midY-c.minY-c.height/2;break;case"bottom":d.y=g.maxY-c.minY-c.height;break;case"left":d.x=g.minX-c.minX;break;case"center-horizontal":d.x=g.midX-c.minX-c.width/2;break;case"right":d.x=g.maxX-c.minX-c.width}for(let b of a){let a=d.clone(),c=this.getShapeParent(b);if(c){let b=this.getShapePageTransform(c);b&&a.rot(-b.rotation())}a.add(b),h.push(this.getChangesToTranslateShape(b,a))}}),this.updateShapes(h),this}distributeShapes(a,b){let c,d,e,f;if(this.getIsReadonly())return this;let g="string"==typeof a[0]?a:a.map(a=>a.id),h=b4(g.map(a=>this.getShape(a))),i=[],j=[],k=new Set;for(let a of h){if(k.has(a.id))continue;k.add(a.id);let b=this.getShapePageBounds(a);if(!b||!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"distribute",shapes:h}))continue;let c=[a],d=[b];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:h,resultShapes:c,resultBounds:d,visited:k});let e=kt.Common(d);e&&(i.push({shapes:c,pageBounds:e}),j.push(e))}if(i.length<3)return this;"horizontal"===b?(c="x",d="minX",e="maxX",f="width"):(c="y",d="minY",e="maxY",f="height");let l=[],m=i.sort((a,b)=>a.pageBounds[d]-b.pageBounds[d])[0],n=i.sort((a,b)=>b.pageBounds[e]-a.pageBounds[e])[0];if(m===n){let a=new Set(m.shapes.map(a=>a.id));return this.distributeShapes(g.filter(b=>!a.has(b)),b)}let o=i.filter(a=>a!==m&&a!==n).sort((a,b)=>a.pageBounds[d]===b.pageBounds[d]?a.shapes[0].id<b.shapes[0].id?-1:1:a.pageBounds[d]-b.pageBounds[d]),p=m.pageBounds[e],q=(n.pageBounds[d]-p-o.reduce((a,b)=>a+b.pageBounds[f],0))/(o.length+1);for(let a=p+q,b=0;b<o.length;b++){let{shapes:d,pageBounds:g}=o[b],h=new iK;for(let b of(h[c]=a-g[c],a+g[f]>n.pageBounds[e]-1&&(h[c]=n.pageBounds[e]-g[e]-1),d)){let a=h.clone(),c=this.getShapeParent(b);if(c){let b=this.getShapePageTransform(c);b&&a.rot(-b.rotation())}a.add(b),l.push(this.getChangesToTranslateShape(b,a))}a+=g[f]+q}return this.updateShapes(l),this}stretchShapes(a,b){let c,d,e,f="string"==typeof a[0]?a:a.map(a=>a.id);if(this.getIsReadonly())return this;let g=b4(f.map(a=>this.getShape(a))).filter(a=>this.getShapePageTransform(a)?.rotation()%(iO/2)==0),h=[],i=[],j=new Set;for(let a of g){if(j.has(a.id))continue;j.add(a.id);let b=this.getShapePageBounds(a);if(!b)continue;let c=[a],d=[b];if(!this.getShapeUtil(a).canBeLaidOut?.(a,{type:"stretch"}))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(a.id,"arrow"),initialShapes:g,resultShapes:c,resultBounds:d,visited:j});let e=kt.Common(d);e&&(h.push({shapes:c,pageBounds:e}),i.push(e))}if(h.length<2)return this;let k=kt.Common(i);return"horizontal"===b?(c="x",d="minX",e="width"):(c="y",d="minY",e="height"),this.run(()=>{h.forEach(({shapes:a,pageBounds:b})=>{let f=new iK;f[c]=k[d]-b[d];let g=b.center.clone();g[c]=k[d];let h=new iK(1,1);for(let d of(h[c]=k[e]/b[e],a)){let a=f.clone(),b=this.getShapeParentTransform(d);b&&f.rot(-b.rotation()),a.add(d);let c=this.getChangesToTranslateShape(d,a);this.updateShape(c),this.resizeShape(d.id,h,{initialBounds:this.getShapeGeometry(d).bounds,scaleOrigin:g,isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}})}),this}resizeShape(a,b,c={}){let d="string"==typeof a?a:a.id;if(this.getIsReadonly())return this;Number.isFinite(b.x)||(b=new iK(1,b.y)),Number.isFinite(b.y)||(b=new iK(b.x,1));let e=c.initialShape??this.getShape(d);if(!e)return this;let f=c.scaleOrigin??this.getShapePageBounds(d)?.center;if(!f)return this;let g=c.initialPageTransform?ku.Cast(c.initialPageTransform):this.getShapePageTransform(d);if(!g)return this;let h=g.rotation();if(null==h)return this;let i=c.scaleAxisRotation??h,j=c.initialBounds??this.getShapeGeometry(d).bounds;if(!j)return this;let k=c.isAspectRatioLocked??this.getShapeUtil(e).isAspectRatioLocked(e);if(!i_(h,i))return this._resizeUnalignedShape(d,b,{...c,initialBounds:j,scaleOrigin:f,scaleAxisRotation:i,initialPageTransform:g,isAspectRatioLocked:k,initialShape:e});let l=this.getShapeUtil(e);k&&(b=Math.abs(b.x)>Math.abs(b.y)?new iK(b.x,Math.sign(b.y)*Math.abs(b.x)):new iK(Math.sign(b.x)*Math.abs(b.y),b.y));let m=!1;if(l.onResize&&l.canResize(e)){let a=this._scalePagePoint(ku.applyToPoint(g,new iK(0,0)),f,b,i),k=this.getPointInParentSpace(e.id,a),n=new iK(b.x,b.y),o=iU((h-i)%Math.PI,0);n.x=o?b.x:b.y,n.y=o?b.y:b.x;let p=ku.applyToPoint(g,new iK),{x:q,y:r}=this.getPointInParentSpace(e.id,p),s=e;c.skipStartAndEndCallbacks||(s=pz(e,l.onResizeStart?.(e)??void 0));let t=l.onResize({...e,x:q,y:r},{newPoint:k,handle:c.dragHandle??"bottom_right",mode:c.mode??"scale_shape",scaleX:n.x,scaleY:n.y,initialBounds:j,initialShape:e});t&&(m=!0),s=pz(s,{id:d,type:e.type,x:k.x,y:k.y,...t}),c.skipStartAndEndCallbacks||(s=pz(s,l.onResizeEnd?.(e,s)??void 0)),this.updateShapes([s])}if(!m){let a=ku.applyToPoint(g,j.center),c=this._scalePagePoint(a,f,b,i),h=this.getPointInParentSpace(e.id,a),k=this.getPointInParentSpace(e.id,c),l=iK.Sub(k,h);this.updateShapes([{id:d,type:e.type,x:e.x+l.x,y:e.y+l.y}])}return this}_scalePagePoint(a,b,c,d){let e=iK.RotWith(a,b,-d).sub(b),f=iK.MulV(e,c);return iK.Add(f,b).rotWith(b,d)}_resizeUnalignedShape(a,b,c){let{type:d}=c.initialShape,e=new iK(b.x,b.y);if(Math.abs(b.x)>Math.abs(b.y)?e.x=Math.sign(b.x)*Math.abs(b.y):e.y=Math.sign(b.y)*Math.abs(b.x),this.resizeShape(a,e,{initialShape:c.initialShape,initialBounds:c.initialBounds,isAspectRatioLocked:c.isAspectRatioLocked,initialPageTransform:c.initialPageTransform}),Math.sign(b.x)*Math.sign(b.y)<0){let b=this.getShapeParentTransform(a).rotation(),e=-c.initialShape.rotation-2*b;this.updateShapes([{id:a,type:d,rotation:e}])}let f=ku.applyToPoint(c.initialPageTransform,c.initialBounds.center),g=this._scalePagePoint(f,c.scaleOrigin,b,c.scaleAxisRotation),h=this.getShapePageTransform(a),i=this.getShapeGeometry(a).bounds,j=ku.applyToPoint(h,i.center),k=h.point();if(!j||!k)return this;let l=iK.Sub(g,j),m=iK.Add(k,l),{x:n,y:o}=this.getPointInParentSpace(a,m);return this.updateShapes([{id:a,type:d,x:n,y:o}]),this}getInitialMetaForShape(a){return{}}canCreateShape(a){return this.canCreateShapes([a])}canCreateShapes(a){return a.length+this.getCurrentPageShapeIds().size<=this.options.maxShapesPerPage}createShape(a){return this.createShapes([a]),this}createShapes(a){if(!Array.isArray(a))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly()||a.length<=0)return this;let b=this.getCurrentPageShapeIds();if(a.length+b.size>this.options.maxShapesPerPage)return py(this),this;let c=this.getFocusedGroupId();return this.run(()=>{let b=this.getCurrentPageShapesSorted(),d=a.map(d=>{if(d.id||(d={id:gi(),...d}),!d.parentId||!(this.store.has(d.parentId)||a.some(a=>a.id===d.parentId))){let a=this.getFocusedGroupId();if(void 0!==d.x&&void 0!==d.y)for(let c=b.length-1;c>=0;c--){let e=b[c];if(this.getShapeUtil(e).canReceiveNewChildrenOfType(e,d.type)&&!this.isShapeHidden(e)&&this.isPointInShape(e,{x:d.x??0,y:d.y??0},{margin:0,hitInside:!0})){a=e.id;break}}let e=d.parentId;if(a===d.id&&(a=c),a!==e&&((d={...d}).parentId=a,gh(a))){let b=this.getPointInShapeSpace(this.getShape(a),{x:d.x??0,y:d.y??0});d.x=b.x,d.y=b.y,d.rotation=-this.getShapePageTransform(a).rotation()+(d.rotation??0)}}return d}),e=new Map,f=[],{opacityForNextShape:g}=this.getInstanceState();for(let a of d){let b=this.getShapeUtil(a),d=a.index;if(!d){let b=a.parentId??c;e.has(b)||e.set(b,this.getHighestIndexForParent(b)),d=e.get(b),e.set(b,c4(d))}let h=b.getDefaultProps();for(let[b,c]of this.styleProps[a.type])h[c]=this.getStyleForNextShape(b);let i=this.store.schema.types.shape.create({...a,index:d,opacity:a.opacity??g,parentId:a.parentId??c,props:"props"in a?{...h,...a.props}:h});if(void 0===i.index)throw Error("no index!");let j=this.getShapeUtil(i).onBeforeCreate?.(i);j&&(i=j),f.push(i)}f.forEach(a=>{a.meta={...this.getInitialMetaForShape(a),...a.meta}}),this.emit("created-shapes",f),this.emit("edit"),this.store.put(f)}),this}animateShape(a,b={animation:je}){return this.animateShapes([a],b)}animateShapes(a,b={animation:je}){let c,d,e;if(!b.animation)return this;let{duration:f=500,easing:g=iD}=b.animation,h=cs(void 0),i=f,j=[];for(let b=0,c=a.length;b<c;b++){if(!(d=a[b]))continue;let c=this.getShape(d.id);c&&(e={start:dk(c),end:pz(dk(c),d)},j.push(e),this.animatingShapes.set(c.id,h))}let k=b=>{if((i-=b)<0){let{animatingShapes:b}=this,c=a.filter(a=>a&&b.get(a.id)===h);c.length&&this.updateShapes(c),this.off("tick",k);return}c=g(1-i/f);let{animatingShapes:d}=this,e=[];for(let a=0,b=j.length;a<b;a++){let{start:b,end:f}=j[a];d.get(b.id)===h&&e.push({...f,x:b.x+(f.x-b.x)*c,y:b.y+(f.y-b.y)*c,opacity:b.opacity+(f.opacity-b.opacity)*c,rotation:b.rotation+(f.rotation-b.rotation)*c,props:this.getShapeUtil(f).getInterpolatedProps?.(b,f,c)??f.props})}this._updateShapes(e)};return this.on("tick",k),this}groupShapes(a,b={}){let{groupId:c=gi(),select:d=!0}=b;if(!Array.isArray(a))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;let e="string"==typeof a[0]?a:a.map(a=>a.id);if(e.length<=1)return this;let f=b4((this._shouldIgnoreShapeLock?e:this._getUnlockedShapeIds(e)).map(a=>this.getShape(a))),g=f.sort(c6).map(a=>a.id),h=b4(f.map(a=>this.getShapePageBounds(a))),i=kt.Common(h);if(!i.isValid())throw Error("Editor.groupShapes: group bounds are invalid (NaN).");let{x:j,y:k}=i.point,l=this.findCommonAncestor(f)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let m=f.filter(a=>a.parentId===l).sort(c6),n=m[m.length-1]?.index;return this.run(()=>{this.createShapes([{id:c,type:"group",parentId:l,index:n,x:j,y:k,opacity:1,props:{}}]),this.reparentShapes(g,c),d&&this.select(c)}),this}ungroupShapes(a,b={}){if(this.getIsReadonly())return this;let{select:c=!0}=b,d="string"==typeof a[0]?a:a.map(a=>a.id),e=b4((this._shouldIgnoreShapeLock?d:this._getUnlockedShapeIds(d)).map(a=>this.getShape(a)));if(0===e.length||"select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let f=new Set,g=[];return e.forEach(a=>{this.isShapeOfType(a,"group")?g.push(a):f.add(a.id)}),0===g.length||this.run(()=>{let a;for(let b=0,c=g.length;b<c;b++){a=g[b];let c=this.getSortedChildIdsForParent(a.id);for(let a=0,b=c.length;a<b;a++)f.add(c[a]);this.reparentShapes(c,a.parentId,a.index)}this.deleteShapes(g.map(a=>a.id)),c&&this.select(...f)}),this}updateShape(a){return this.updateShapes([a]),this}updateShapes(a){let b=Array(a.length);for(let c=0,d=a.length;c<d;c++){let d=a[c];if(!d)continue;let e=this.getShape(d.id);if(e){if(!this._shouldIgnoreShapeLock){if(e.isLocked){if(!(Object.hasOwn(d,"isLocked")&&!d.isLocked))continue}else if(this.isShapeOrAncestorLocked(e))continue}this.animatingShapes.delete(d.id),b.push(d)}}return this._updateShapes(b),this}_updateShapes(a){this.getIsReadonly()||this.run(()=>{let b,c,d=[];for(let e=0,f=a.length;e<f;e++){let f=a[e];f&&(b=this.getShape(f.id))&&(c=pz(b,f))!==b&&(c=this.getShapeUtil(b).onBeforeUpdate?.(b,c)??c,d.push(c))}this.emit("edited-shapes",d),this.emit("edit"),this.store.put(d)})}_getUnlockedShapeIds(a){return a.filter(a=>!this.getShape(a)?.isLocked)}deleteShapes(a){if(this.getIsReadonly())return this;if(!Array.isArray(a))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");let b="string"==typeof a[0]?a:a.map(a=>a.id),c=this._shouldIgnoreShapeLock?b:this._getUnlockedShapeIds(b);if(0===c.length)return this;let d=new Set(c);for(let a of c)this.visitDescendants(a,a=>{d.add(a)});return this.emit("deleted-shapes",[...d]),this.emit("edit"),this.run(()=>this.store.remove([...d]))}deleteShape(a){return this.deleteShapes(["string"==typeof a?a:a.id]),this}_extractSharedStyles(a,b){if(this.isShapeOfType(a,"group")){let c=this._parentIdsToChildIds.get()[a.id];if(c)for(let a=0,d=c.length;a<d;a++)this._extractSharedStyles(this.getShape(c[a]),b)}else for(let[c,d]of this.styleProps[a.type])b.applyValue(c,cF(a.props,d))}_getSelectionSharedStyles(){let a=this.getSelectedShapes(),b=new mn;for(let c of a)this._extractSharedStyles(c,b);return b}getStyleForNextShape(a){let b=this.getInstanceState().stylesForNextShape[a.id];return void 0===b?a.defaultValue:b}getShapeStyleIfExists(a,b){let c=this.styleProps[a.type].get(b);if(void 0!==c)return cF(a.props,c)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();let a=this.root.getCurrent(),b=new mn;if(!a)return b;if(a.shapeType)if("frame"!==a.shapeType||this.getShapeUtil("frame").options.showColors)for(let c of this.styleProps[a.shapeType].keys())b.applyValue(c,this.getStyleForNextShape(c));else for(let c of this.styleProps[a.shapeType].keys())"tldraw:color"!==c.id&&b.applyValue(c,this.getStyleForNextShape(c));return b}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){let a=[],b=c=>{let d=this.getShape(c);if(d)if(this.isShapeOfType(d,"group"))for(let a of this.getSortedChildIdsForParent(d.id))b(a);else a.push(d)};for(let a of this.getSelectedShapeIds())b(a);let c=null;for(let b of a)if(null===c)c=b.opacity;else if(c!==b.opacity)return{type:"mixed"};if(null!==c)return{type:"shared",value:c}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(a,b){return this.updateInstanceState({opacityForNextShape:a},b),this}setOpacityForSelectedShapes(a){let b=this.getSelectedShapes();if(b.length>0){let c=[],d=a=>{if(this.isShapeOfType(a,"group"))for(let b of this.getSortedChildIdsForParent(a))d(this.getShape(b));else c.push(a)};for(let a of b)d(a);this.updateShapes(c.map(b=>({id:b.id,type:b.type,opacity:a})))}return this}setStyleForNextShapes(a,b,c){let d=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...d,[a.id]:b}},c),this}setStyleForSelectedShapes(a,b){let c=this.getSelectedShapes();if(c.length>0){let d=[],e=c=>{if(this.isShapeOfType(c,"group"))for(let a of this.getSortedChildIdsForParent(c.id))e(this.getShape(a));else{let e=this.getShapeUtil(c),f=this.styleProps[c.type].get(a);if(f){let a={id:c.id,type:c.type,props:{[f]:b}};d.push({util:e,originalShape:c,updatePartial:a})}}};for(let a of c)e(a);this.updateShapes(d.map(({updatePartial:a})=>a))}return this}registerExternalAssetHandler(a,b){return this.externalAssetContentHandlers[a]=b,this}createTemporaryAssetPreview(a,b){if(this.temporaryAssetPreview.has(a))return this.temporaryAssetPreview.get(a);let c=URL.createObjectURL(b);return this.temporaryAssetPreview.set(a,c),setTimeout(()=>{this.temporaryAssetPreview.delete(a),URL.revokeObjectURL(c)},this.options.temporaryAssetPreviewLifetimeMs),c}getTemporaryAssetPreview(a){return this.temporaryAssetPreview.get(a)}async getAssetForExternalContent(a){return await this.externalAssetContentHandlers[a.type]?.(a)}hasExternalAssetHandler(a){return!!this.externalAssetContentHandlers[a]}registerExternalContentHandler(a,b){return this.externalContentHandlers[a]=b,this}async putExternalContent(a,b={}){if(!(!b.force&&this.getIsReadonly()))return this.externalContentHandlers[a.type]?.(a)}async replaceExternalContent(a,b={}){if(!(!b.force&&this.getIsReadonly()))return this.externalContentHandlers[a.type]?.(a)}getContentFromCurrentPage(a){let b="string"==typeof a[0]?a:a.map(a=>a.id);if(!b||0===b.length)return;let c=this.getShapeAndDescendantIds(b);return pA(this,c,a=>{let b=[];for(let c of a){let a=this.getBinding(c);a&&b.push(a)}let d=[],e=[];for(let a of c){let b=this.getShape(a);if(b)if(c.has(b.parentId))e.push(b);else{let a=this.getShapePageTransform(b.id),c=a.point();e.push({...b,x:c.x,y:c.y,rotation:a.rotation(),parentId:this.getCurrentPageId()}),d.push(b.id)}}let f=[],g=new Set;for(let a of e){if(!("assetId"in a.props))continue;let b=a.props.assetId;if(!b||g.has(b))continue;g.add(b);let c=this.getAsset(b);c&&f.push(c)}return{schema:this.store.schema.serialize(),shapes:e,rootShapeIds:d,bindings:b,assets:f}})}async resolveAssetsInContent(a){if(!a)return;let b=[];return await Promise.allSettled(a.assets.map(async a=>{if("image"!==a.type&&"video"!==a.type||a.props.src?.startsWith("data:image")||a.props.src?.startsWith("data:video")||a.props.src?.startsWith("http"))b.push(a);else{let c=dk(a),d=await this.store.props.assets.resolve(a,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});c.props.src=await co.blobToDataUrl(await cm(d).then(a=>a.blob())),b.push(c)}})),a.assets=b,a}putContentOntoCurrentPage(a,b={}){if(this.getIsReadonly())return this;if(!a.schema)throw Error("Could not put content:\ncontent is missing a schema.");let{select:c=!1,preserveIds:d=!1,preservePosition:e=!1}=b,{point:f}=b,g=this.getCurrentPageId(),{rootShapeIds:h}=a,i=[],j=[],k=[],l={store:{...Object.fromEntries(a.assets.map(a=>[a.id,a])),...Object.fromEntries(a.shapes.map(a=>[a.id,a])),...Object.fromEntries(a.bindings?.map(a=>[a.id,a])??[])},schema:a.schema},m=this.store.schema.migrateStoreSnapshot(l);if("error"===m.type)throw Error("Could not put content: could not migrate content");for(let a of Object.values(m.value))switch(a.typeName){case"asset":i.push(a);break;case"shape":j.push(a);break;case"binding":k.push(a)}let n=new Map(d?j.map(a=>[a.id,a.id]):j.map(a=>[a.id,gi()])),o=new Map(d?k.map(a=>[a.id,a.id]):k.map(a=>[a.id,f9()])),p=this.getCurrentPageId(),q=1/0,r=[];for(let a of this.getSelectedShapes()){if(0===q)break;let b=this.isShapeOfType(a,"frame"),c=this.getShapeAncestors(a);b&&c.push(a);let d=b?c.length+1:c.length;if(d<q)q=d,r=c,p=b?a.id:a.parentId;else if(d===q){if(r.length!==c.length)throw Error(`Ancestors: ${r.length} !== ${c.length}`);if(0===r.length){p=g;break}p=g;for(let a=0;a<r.length&&c[a]===r[a];a++)p=c[a].id}}if(f){let a=new Map(j.map(a=>[a.id,a])),b=b4(h.map(b=>a.get(b)));if(b.length>0){let a=this.getShapeAtPoint(f,{hitInside:!0,hitFrameInside:!0,hitLocked:!0,filter:a=>{let c=this.getShapeUtil(a);return!!c.canReceiveNewChildrenOfType&&b.every(b=>c.canReceiveNewChildrenOfType(a,b.type))}});p=a?a.id:g}}let s=!1;if(!g$(p)){let a=this.getShape(p);if(a)if(this.getViewportPageBounds().includes(this.getShapePageBounds(a))){if(1===h.length){let b=j.find(a=>a.id===h[0]);this.isShapeOfType(a,"frame")&&this.isShapeOfType(b,"frame")&&b.props.w===a?.props.w&&b.props.h===a?.props.h&&(s=!0)}}else p=g;else p=g}s||(s=n.has(p)),s&&(p=this.getShape(p).parentId);let t=this.getHighestIndexForParent(p),u=[],v=j.map(a=>{let b=n.get(a.id),c={...a,id:b};return h.includes(a.id)&&(c.parentId=g,u.push(c)),n.has(c.parentId)?c.parentId=n.get(a.parentId):(h.push(c.id),c.index=t,t=c4(t)),c});if(v.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return py(this),this;let w=k.map(a=>({...a,id:ce(o.get(a.id)),fromId:ce(n.get(a.fromId)),toId:ce(n.get(a.toId))})),y=[],z=[];for(let a of i)this.store.has(a.id)||(("image"===a.type&&a.props.src?.startsWith("data:image")||"video"===a.type&&a.props.src?.startsWith("data:video"))&&(z.push(dk(a)),a.props.src=null),y.push(a));return Promise.allSettled(z.map(async a=>{var b,c,d;let e=await (b=a.props.src,c=a.props.name,d=a.props.mimeType??"image/png",cm(b).then(function(a){return a.arrayBuffer()}).then(function(a){return new File([a],c,{type:d})})),f=await this.getAssetForExternalContent({type:"file",file:e,assetId:a.id});f?this.updateAssets([{...f,id:a.id}]):this.deleteAssets([a.id])})),this.run(()=>{y.length>0&&this.createAssets(y),this.createShapes(v),this.createBindings(w),c&&this.select(...u.map(a=>a.id)),p!==g&&this.reparentShapes(u.map(a=>a.id),p);let a=v.map(a=>this.getShape(a.id)),b=kt.Common(a.map(a=>this.getShapePageBounds(a)));if(void 0===f)if(g$(p)){let a=this.getViewportPageBounds();f=e||a.includes(kt.From(b))?b.center:a.center}else{let a=this.getShape(p);f=ku.applyToPoint(this.getShapePageTransform(a),this.getShapeGeometry(a).bounds.center)}if(1===u.length){let a=u[0];if(this.isShapeOfType(a,"frame"))for(;this.getShapesAtPoint(f).some(b=>this.isShapeOfType(b,"frame")&&b.props.w===a.props.w&&b.props.h===a.props.h);)f.x+=b.w+16}let d=kt.Common(b4(u.map(({id:a})=>this.getShapePageBounds(a)))).center,h=iK.Sub(f,d);this.updateShapes(u.map(({id:a})=>{let b=this.getShape(a),c=this.getShapeParentTransform(a).decompose().rotation,d=iK.Rot(h,-c);return{id:b.id,type:b.type,x:b.x+d.x,y:b.y+d.y}}))}),this}async getSvgElement(a,b={}){let c=0===a.length?this.getCurrentPageShapeIdsSorted():"string"==typeof a[0]?a:a.map(a=>a.id);if(0!==c.length)return mc(this,c,b)}async getSvgString(a,b={}){let c=await this.getSvgElement(a,b);if(c)return{svg:new XMLSerializer().serializeToString(c.svg),width:c.width,height:c.height}}async toImage(a,b={}){let c={format:"png",scale:1,pixelRatio:"svg"===b.format?void 0:2,...b},d=await this.getSvgString(a,c);if(!d)throw Error("Could not create SVG");switch(c.format){case"svg":return{blob:new Blob([d.svg],{type:"image/svg+xml"}),width:d.width,height:d.height};case"jpeg":case"png":case"webp":{let a=await mh(d.svg,{type:c.format,quality:c.quality,pixelRatio:c.pixelRatio,width:d.width,height:d.height});if(!a)throw Error("Could not construct image.");return{blob:a,width:d.width,height:d.height}}default:cc(c.format)}}async toImageDataUrl(a,b={}){let{blob:c,width:d,height:e}=await this.toImage(a,b);return{url:await co.blobToDataUrl(c),width:d,height:e}}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}updatePointer(a){let b={type:"pointer",target:"canvas",name:"pointer_move",point:a?.point??iK.Add(this.inputs.getCurrentScreenPoint(),this.store.unsafeGetWithoutCapture(g3).screenBounds),pointerId:a?.pointerId??0,button:a?.button??0,isPen:a?.isPen??this.inputs.getIsPen(),shiftKey:a?.shiftKey??this.inputs.getShiftKey(),altKey:a?.altKey??this.inputs.getAltKey(),ctrlKey:a?.ctrlKey??this.inputs.getCtrlKey(),metaKey:a?.metaKey??this.inputs.getMetaKey(),accelKey:!1};return b.accelKey=a?.accelKey??this.inputs.getAccelKey(),a?.immediate?this._flushEventForTick(b):this.dispatch(b),this}focus({focusContainer:a=!0}={}){return this.getIsFocused()||(a&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0})),this}blur({blurContainer:a=!0}={}){return this.getIsFocused()&&(a?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1})),this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){var a=this.store;let b=kq.get(a,kn).get();if(!b)throw Error("Session state is not ready yet");return{document:a.getStoreSnapshot(),session:b}}loadSnapshot(a,b){return kp(this.store,a,b),this}_zoomToFitPageContentAt100Percent(){let a=this.getCurrentPageBounds();a&&this.zoomToBounds(a,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(a){this.run(()=>{switch(a.type){case"page":{let b=this.getPage(a.pageId);b&&this.setCurrentPage(b),this._zoomToFitPageContentAt100Percent();return}case"shapes":{let b=b4(a.shapeIds.map(a=>this.getShape(a))),c={};for(let a of b){let b=this.getAncestorPageId(a);b&&(c[b]??=[],c[b].push(a))}let[d,e]=Object.entries(c).sort(([a,b],[c,d])=>d.length-b.length)[0]??["",[]];if(d&&e.length){this.setCurrentPage(d);let a=kt.Common(e.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(a,{immediate:!0,targetZoom:this.getBaseZoom()})}else this._zoomToFitPageContentAt100Percent();return}case"viewport":if(a.pageId){if(!this.getPage(a.pageId))return void this._zoomToFitPageContentAt100Percent();this.setCurrentPage(a.pageId)}this.zoomToBounds(a.bounds,{immediate:!0,inset:0});return;default:cc(a)}})}navigateToDeepLink(a){if(a&&"type"in a)return this._navigateToDeepLink(a),this;let b=new URL(a?.url??window.location.href).searchParams.get(a?.param??"d");if(!b)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(function(a){switch(a[0]){case"s":return{type:"shapes",shapeIds:a.slice(1).split(".").filter(Boolean).map(a=>gi(decodeURIComponent(a)))};case"p":return{type:"page",pageId:gZ.createId(decodeURIComponent(a.slice(1)))};case"v":{let[b,c,d,e,f]=a.slice(1).split(".");return{type:"viewport",bounds:new kt(Number(b),Number(c),Number(d),Number(e)),pageId:f?gZ.createId(decodeURIComponent(f)):void 0}}default:throw Error("Invalid deep link string")}}(b))}catch(a){console.warn(a),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(a){let b=new URL(a?.url??window.location.href);return b.searchParams.set(a?.param??"d",function(a){switch(a.type){case"shapes":{let b=a.shapeIds.map(a=>mp(a.slice(6)));return`s${b.join(".")}`}case"page":return"p"+mp(gZ.parseId(a.pageId));case"viewport":{let{bounds:b,pageId:c}=a,d=`v${Math.round(b.x)}.${Math.round(b.y)}.${Math.round(b.w)}.${Math.round(b.h)}`;return c&&(d+="."+mp(gZ.parseId(c))),d}default:cc(a)}}(a?.to??{type:"viewport",pageId:1===this.options.maxPages?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),b}registerDeepLinkListener(a){if(a?.getUrl&&!a?.onChange)throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");let b=dQ("url with state",()=>{let b=a?.getUrl?.(this)??window.location.href;return this.createDeepLink({param:a?.param,url:b,to:a?.getTarget?.(this)}).toString()}),c=a?.onChange??(()=>{let b=this.createDeepLink({param:a?.param,to:a?.getTarget?.(this)});window.history.replaceState({},document.title,b.toString())}),d=cj(a=>a(),a?.debounceMs??500),e=dA("update url on state change",()=>c(new URL(b.get()),this),{scheduleEffect:d});return()=>{e(),d.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.setShiftKey(!1),this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.getShiftKey(),ctrlKey:this.inputs.getCtrlKey(),altKey:this.inputs.getAltKey(),metaKey:this.inputs.getMetaKey(),accelKey:this.inputs.getAccelKey(),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.setAltKey(!1),this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.getShiftKey(),ctrlKey:this.inputs.getCtrlKey(),altKey:this.inputs.getAltKey(),metaKey:this.inputs.getMetaKey(),accelKey:this.inputs.getAccelKey(),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.setCtrlKey(!1),this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.getShiftKey(),ctrlKey:this.inputs.getCtrlKey(),altKey:this.inputs.getAltKey(),metaKey:this.inputs.getMetaKey(),accelKey:this.inputs.getAccelKey(),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.setMetaKey(!1),this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.getShiftKey(),ctrlKey:this.inputs.getCtrlKey(),altKey:this.inputs.getAltKey(),metaKey:this.inputs.getMetaKey(),accelKey:this.inputs.getAccelKey(),code:"MetaLeft"})}markEventAsHandled(a){let b="nativeEvent"in a?a.nativeEvent:a;this.handledEvents.add(b)}wasEventAlreadyHandled(a){let b="nativeEvent"in a?a.nativeEvent:a;return this.handledEvents.has(b)}dispatch(a){return this._pendingEventsForNextTick.push(a),("pointer"!==a.type||"pointer_move"!==a.name)&&"wheel"!==a.type&&"pinch"!==a.type&&this._flushEventsForTick(0),this}_flushEventsForTick(a){this.run(()=>{if(this._pendingEventsForNextTick.length>0){let a=[...this._pendingEventsForNextTick];for(let b of(this._pendingEventsForNextTick.length=0,a))this._flushEventForTick(b)}a>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:a}),this.scribbles.tick(a)})}_flushEventForTick(a){if(this.getCrashingError())return this;this.emit("before-event",a);let{inputs:b}=this,{type:c}=a;if("misc"===a.type){("cancel"===a.name||"complete"===a.name)&&(this.inputs.setIsDragging(!1),this.inputs.getIsPanning()&&(this.inputs.setIsPanning(!1),this.inputs.setIsSpacebarPanning(!1),this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(a),this.emit("event",a);return}a.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,b.setShiftKey(!0)):!a.shiftKey&&b.getShiftKey()&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),a.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,b.setAltKey(!0)):!a.altKey&&b.getAltKey()&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),a.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,b.setCtrlKey(!0)):!a.ctrlKey&&b.getCtrlKey()&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),a.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,b.setMetaKey(!0)):!a.metaKey&&b.getMetaKey()&&-1===this._metaKeyTimeout&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150)),b.getIsPointing()||b.setIsDragging(!1);let d=this.store.unsafeGetWithoutCapture(g3),e=this.store.get(this._getCurrentPageStateId()),f=this._cameraOptions.__unsafe__getWithoutCapture();switch(c){case"pinch":if(f.isLocked)return;switch(clearTimeout(this._longPressTimeout),this.inputs.updateFromEvent(a),a.name){case"pinch_start":if(b.getIsPinching())return;b.getIsEditing()||(this._selectedShapeIdsAtPointerDown=[...e.selectedShapeIds],this._didPinch=!0,b.setIsPinching(!0),this.interrupt()),this.emit("event",a);return;case"pinch":{if(!b.getIsPinching())return;let{point:{z:c=1},delta:{x:e,y:g}}=a,{x:h,y:i}=iK.SubXY(a.point,d.screenBounds.x,d.screenBounds.y);this.stopCameraAnimation(),d.followingUserId&&this.stopFollowingUser();let{x:j,y:k,z:l}=dU(()=>this.getCamera()),{panSpeed:m}=f;this._setCamera(new iK(j+e*m/l-h/l+h/c,k+g*m/l-i/l+i/c,c),{immediate:!0}),this.emit("event",a);return}case"pinch_end":{if(!b.getIsPinching())return this;b.setIsPinching(!1);let{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,c.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(c)})),this.emit("event",a);return}}case"wheel":{if(f.isLocked)return;this.inputs.updateFromEvent(a);let{panSpeed:b,zoomSpeed:c}=f,e=f.wheelBehavior,g=this.user.getUserPreferences().inputMode;if(null!==g&&(e="trackpad"===g?"pan":"zoom"),"none"!==e){this.stopCameraAnimation(),d.followingUserId&&this.stopFollowingUser();let{x:f,y:h,z:i}=dU(()=>this.getCamera()),{x:j,y:k,z:l=0}=a.delta,m=e;switch(a.ctrlKey&&(m="pan"===e?"zoom":"pan"),m){case"zoom":{let{x:b,y:d}=this.inputs.getCurrentScreenPoint(),j=l;"zoom"===e&&(j=Math.abs(k)>10?10*Math.sign(k)/100:k/100);let m=(this.user.getUserPreferences().isZoomDirectionInverted&&"mouse"===g)??!1,n=j??0,o=i+(m?-n:n)*c*i;this._setCamera(new iK(f+b/o-b/i,h+d/o-d/i,o),{immediate:!0}),this.maybeTrackPerformance("Zooming"),this.root.handleEvent(a),this.emit("event",a);return}case"pan":this._setCamera(new iK(f+j*b/i,h+k*b/i,i),{immediate:!0}),this.maybeTrackPerformance("Panning"),this.root.handleEvent(a),this.emit("event",a);return}}break}case"pointer":{if(b.getIsPinching())return;this.inputs.updateFromEvent(a);let{isPen:c}=a,{isPenMode:e}=d;switch(a.name){case"pointer_down":if(e&&!c)return;if(this.inputs.getIsPanning()||(this._longPressTimeout=this.timers.setTimeout(()=>{let b=this.getViewportScreenBounds();this.dispatch({...a,point:this.inputs.getOriginScreenPoint().clone().addXY(b.x,b.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===a.button&&(this.capturedPointerId=a.pointerId),b.buttons.add(a.button),b.setIsPointing(!0),b.setIsDragging(!1),!e&&c&&this.updateInstanceState({isPenMode:!0}),5===a.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===a.button&&(this.inputs.getIsPanning()||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.setIsPanning(!0),clearTimeout(this._longPressTimeout)),this.inputs.getIsPanning())return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!c&&e)return;let{x:a,y:f,z:g}=dU(()=>this.getCamera());if(this.inputs.getIsPanning()&&this.inputs.getIsPointing()){let b=this.inputs.getCurrentScreenPoint(),c=this.inputs.getPreviousScreenPoint(),d=iK.Sub(b,c);this.setCamera(new iK(a+d.x/g,f+d.y/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}b.getIsPointing()&&!b.getIsDragging()&&iK.Dist2(b.getOriginPagePoint(),b.getCurrentPagePoint())*this.getZoomLevel()>(d.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/g&&(b.setIsDragging(!0),clearTimeout(this._longPressTimeout));break}case"pointer_up":if(b.setIsDragging(!1),b.setIsPointing(!1),clearTimeout(this._longPressTimeout),b.buttons.delete(a.button),d.isPenMode&&!c)return;if(this.capturedPointerId===a.pointerId&&(this.capturedPointerId=null,a.button=0),b.getIsPanning()){b.keys.has("Space")||(b.setIsPanning(!1),b.setIsSpacebarPanning(!1));let c=this.inputs.getPointerVelocity(),d=Math.min(2,c.len());switch(a.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}d>0&&this.slideCamera({speed:d,direction:c})}else 5===a.button&&(this.complete(),this.setCurrentTool(this._restoreToolId));this._selectedShapeIdsAtPointerDown=[]}break}case"keyboard":switch("ShiftRight"===a.key&&(a.key="ShiftLeft"),"AltRight"===a.key&&(a.key="AltLeft"),"ControlRight"===a.code&&(a.code="ControlLeft"),"MetaRight"===a.code&&(a.code="MetaLeft"),a.name){case"key_down":if(b.keys.add(a.code),this.options.spacebarPanning&&("Space"!==a.code||a.ctrlKey||(this.inputs.getIsPanning()||(this._prevCursor=d.cursor.type),this.inputs.setIsPanning(!0),this.inputs.setIsSpacebarPanning(!0),clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.getIsPointing()?"grabbing":"grab",rotation:0})),this.inputs.getIsSpacebarPanning())){let b;switch(a.code){case"ArrowUp":b=new iK(0,-1);break;case"ArrowRight":b=new iK(1,0);break;case"ArrowDown":b=new iK(0,1);break;case"ArrowLeft":b=new iK(-1,0)}if(b){let a=this.getViewportPageBounds(),c=a.clone().translate(b.mulV({x:a.w,y:a.h}));this._animateToViewport(c,{animation:{duration:320}})}}break;case"key_up":b.keys.delete(a.code),this.options.spacebarPanning&&"Space"===a.code&&(this.inputs.buttons.has(1)||(this.inputs.setIsPanning(!1),this.inputs.setIsSpacebarPanning(!1),this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===a.type){1===a.button?a.name="middle_click":2===a.button&&(a.name="right_click");let{isPenMode:b}=this.store.unsafeGetWithoutCapture(g3);if(a.isPen===b){let b=this._clickManager.handlePointerEvent(a);if(a.name!==b.name){this.root.handleEvent(a),this.emit("event",a),this.root.handleEvent(b),this.emit("event",b);return}}}return this.root.handleEvent(a),this.emit("event",a),"pointer"===a.type&&"pointer_down"===a.name&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(a){ji.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(a),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}function py(a,b=a.getCurrentPageId()){let c=a.getPage(b).name;a.emit("max-shapes",{name:c,pageId:b,count:a.options.maxShapesPerPage})}function pz(a,b){if(!b)return a;let c=null,d=Object.entries(b);for(let b=0,e=d.length;b<e;b++){let[e,f]=d[b];if(void 0!==f&&"id"!==e&&"type"!==e&&"typeName"!==e&&f!==a[e]){if(c||(c={...a}),"props"===e||"meta"===e){for(let[b,d]of(c[e]={...a[e]},Object.entries(f)))c[e][b]=d;continue}c[e]=f}}return c||a}function pA(a,b,c){let d;if(a.run(()=>{let e=a.store.extractingChanges(()=>{let e=new Set,f=new Set;for(let c of b)if(a.getShape(c))for(let d of a.getBindingsInvolvingShape(c)){let a=b.has(d.fromId),c=b.has(d.toId);if(a&&c){e.add(d.id);continue}a&&c||f.add(d.id)}a.deleteBindings([...f],{isolateShapes:!0});try{d=cb.ok(c(e))}catch(a){d=cb.err(a)}});a.store.applyDiff(e_(e),{runCallbacks:!1})},{history:"ignore"}),d.ok)return d.value;throw d.error}function pB(a,b){if(!b.constraints)throw Error("Should have constraints here");let{padding:{x:c,y:d}}=b.constraints,e=a.getViewportScreenBounds(),f=kt.From(b.constraints.bounds);return{zx:(e.w-2*c)/f.w,zy:(e.h-2*d)/f.h}}function pC(){let a=jA(),b=lS();return d8("isDarkMode",()=>b?.isDarkMode??a.user.getIsDarkMode(),[b,a])}pq(bB=[,,,pf(bA?.[pi("metadata")]??null)],1,"getIsShapeHiddenCache",bz,px),pq(bB,1,"canUndo",by,px),pq(bB,1,"canRedo",bx,px),pq(bB,1,"getPath",bw,px),pq(bB,1,"getCurrentTool",bv,px),pq(bB,1,"getCurrentToolId",bu,px),pq(bB,1,"getDocumentSettings",bt,px),pq(bB,1,"getInstanceState",bs,px),pq(bB,1,"getPageStates",br,px),pq(bB,1,"_getPageStatesQuery",bq,px),pq(bB,1,"getCurrentPageState",bp,px),pq(bB,1,"_getCurrentPageStateId",bo,px),pq(bB,1,"getSelectedShapeIds",bn,px),pq(bB,1,"getSelectedShapes",bm,px),pq(bB,1,"getCurrentPageShapesInReadingOrder",bl,px),pq(bB,1,"getOnlySelectedShapeId",bk,px),pq(bB,1,"getOnlySelectedShape",bj,px),pq(bB,1,"getSelectionPageBounds",bi,px),pq(bB,1,"getSelectionRotation",bh,px),pq(bB,1,"getSelectionRotatedPageBounds",bg,px),pq(bB,1,"getSelectionRotatedScreenBounds",bf,px),pq(bB,1,"getFocusedGroupId",be,px),pq(bB,1,"getFocusedGroup",bd,px),pq(bB,1,"getEditingShapeId",bc,px),pq(bB,1,"getEditingShape",bb,px),pq(bB,1,"getRichTextEditor",ba,px),pq(bB,1,"getHoveredShapeId",a9,px),pq(bB,1,"getHoveredShape",a8,px),pq(bB,1,"getHintingShapeIds",a7,px),pq(bB,1,"getHintingShape",a6,px),pq(bB,1,"getErasingShapeIds",a5,px),pq(bB,1,"getErasingShapes",a4,px),pq(bB,1,"_unsafe_getCameraId",a3,px),pq(bB,1,"getCamera",a2,px),pq(bB,1,"getViewportPageBoundsForFollowing",a1,px),pq(bB,1,"getCameraForFollowing",a0,px),pq(bB,1,"getZoomLevel",a_,px),pq(bB,1,"getDebouncedZoomLevel",a$,px),pq(bB,1,"_getAboveDebouncedZoomThreshold",aZ,px),pq(bB,1,"getEfficientZoomLevel",aY,px),pq(bB,1,"getViewportScreenBounds",aX,px),pq(bB,1,"getViewportScreenCenter",aW,px),pq(bB,1,"getViewportPageBounds",aV,px),pq(bB,1,"_getCollaboratorsQuery",aU,px),pq(bB,1,"getCollaborators",aT,px),pq(bB,1,"getCollaboratorsOnCurrentPage",aS,px),pq(bB,1,"getRenderingShapes",aR,px),pq(bB,1,"_getAllPagesQuery",aQ,px),pq(bB,1,"getPages",aP,px),pq(bB,1,"getCurrentPageId",aO,px),pq(bB,1,"getCurrentPageShapeIdsSorted",aN,px),pq(bB,1,"_getAllAssetsQuery",aM,px),pq(bB,1,"_getShapeHandlesCache",aL,px),pq(bB,1,"_getShapePageTransformCache",aK,px),pq(bB,1,"_getShapePageBoundsCache",aJ,px),pq(bB,1,"_getShapeClipPathCache",aI,px),pq(bB,1,"_getShapeMaskCache",aH,px),pq(bB,1,"_getShapeMaskedPageBoundsCache",aG,px),pq(bB,1,"getNotVisibleShapes",aF,px),pq(bB,1,"getCulledShapes",aE,px),pq(bB,1,"getCurrentPageBounds",aD,px),pq(bB,1,"getCurrentPageShapes",aC,px),pq(bB,1,"getCurrentPageShapesSorted",aB,px),pq(bB,1,"getCurrentPageRenderingShapesSorted",aA,px),pq(bB,1,"_getBindingsIndexCache",az,px),pq(bB,1,"_getSelectionSharedStyles",ay,px),pq(bB,1,"getSharedStyles",ax,px),pq(bB,1,"getSharedOpacity",aw,px),pq(bB,1,"getIsFocused",av,px),pq(bB,1,"getIsReadonly",au,px),pq(bB,1,"_setShiftKeyTimeout",at,px),pq(bB,1,"_setAltKeyTimeout",as,px),pq(bB,1,"_setCtrlKeyTimeout",ar,px),pq(bB,1,"_setMetaKeyTimeout",aq,px),pp(bB,px);let pD="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",pE="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",pF='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function pG(a,b,c,d,e,f=16,g=16){let h=iO/180*(-c-b),i=Math.sin(h),j=Math.cos(h);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${e};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${j-i}' dy='${+i+ +j}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${b+c} 16 16)${d?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+a.replaceAll('"',"'")+`</g></svg>") ${f} ${g}, pointer`}let pH=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],pI={none:()=>"none","ew-resize":(a,b,c)=>pG(pE,a,0,b,c),"ns-resize":(a,b,c)=>pG(pE,a,90,b,c),"nesw-resize":(a,b,c)=>pG(pD,a,0,b,c),"nwse-resize":(a,b,c)=>pG(pD,a,90,b,c),"nwse-rotate":(a,b,c)=>pG(pF,a,0,b,c),"nesw-rotate":(a,b,c)=>pG(pF,a,90,b,c),"senw-rotate":(a,b,c)=>pG(pF,a,180,b,c),"swne-rotate":(a,b,c)=>pG(pF,a,270,b,c)};function pJ(a,b=0,c="black"){return pI[a](180*b/iO,!1,c)}let pK=a=>a.props.src,pL={upload:async(a,b)=>({src:await co.blobToDataUrl(b)})};function pM({initialData:a,defaultName:b="",id:c,assets:d=pL,onMount:e,collaboration:f,...g}={}){let h=new fc({id:c,schema:"schema"in g&&g.schema?g.schema:function({shapes:a=ix,bindings:b=iy,migrations:c}={}){let d=new Map;for(let b of cH(a))for(let a of gj(b.props??{}).keys()){if(d.has(a.id)&&d.get(a.id)!==a)throw Error(`Multiple StyleProp instances with the same id: ${a.id}`);d.set(a.id,a)}let e=e4("shape",{scope:"document",validator:f_.model("shape",f_.union("type",cL(a,(a,{props:b,meta:c})=>f_.object({id:f7,typeName:f_.literal("shape"),x:f_.number,y:f_.number,rotation:f_.number,index:f_.indexKey,parentId:f6,type:f_.literal(a),isLocked:f_.boolean,opacity:f5,props:b?f_.object(b):f_.jsonValue,meta:c?f_.object(c):f_.jsonValue}))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),f=e4("binding",{scope:"document",validator:f_.model("binding",f_.union("type",cL(b,(a,{props:b,meta:c})=>f_.object({id:f8,typeName:f_.literal("binding"),type:f_.literal(a),fromId:f7,toId:f7,props:b?f_.object(b):f_.jsonValue,meta:c?f_.object(c):f_.jsonValue}))))}).withDefaultProperties(()=>({meta:{}})),g=function(a){let b={};for(let[c,d]of a)b[c]=f_.optional(d);return e4("instance",{validator:f_.model("instance",f_.object({typeName:f_.literal("instance"),id:f0("instance"),currentPageId:gW,followingUserId:f_.string.nullable(),brush:f4.nullable(),opacityForNextShape:f5,stylesForNextShape:f_.object(b),cursor:gR,scribbles:f_.arrayOf(gV),isFocusMode:f_.boolean,isDebugMode:f_.boolean,isToolLocked:f_.boolean,exportBackground:f_.boolean,screenBounds:f4,insets:f_.arrayOf(f_.boolean),zoomBrush:f4.nullable(),isPenMode:f_.boolean,isGridMode:f_.boolean,chatMessage:f_.string,isChatting:f_.boolean,highlightedUserIds:f_.arrayOf(f_.string),isFocused:f_.boolean,devicePixelRatio:f_.number,isCoarsePointer:f_.boolean,isHoveringCanvas:f_.boolean.nullable(),openMenus:f_.arrayOf(f_.string),isChangingStyle:f_.boolean,isReadonly:f_.boolean,meta:f_.jsonValue,duplicateProps:f_.object({shapeIds:f_.arrayOf(f0("shape")),offset:f_.object({x:f_.number,y:f_.number})}).nullable(),cameraState:f_.literalEnum("idle","moving")})),scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0,cameraState:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null,cameraState:"idle"}))}(d);return ff.create({asset:hz,binding:f,camera:gO,document:hj,instance:g,instance_page_state:g7,page:gZ,instance_presence:hf,pointer:ha,shape:e},{migrations:[it,hy,gN,hi,g2,g6,gY,he,g9,gf,hq,ht,hw,...gl("shape",a),...gl("binding",b),...c??[]],onValidationFailure:hm,createIntegrityChecker:hn})}({shapes:"shapeUtils"in g&&g.shapeUtils?pN(kT(g.shapeUtils)):void 0,bindings:"bindingUtils"in g&&g.bindingUtils?pN(kr(g.bindingUtils)):void 0,migrations:"migrations"in g?g.migrations:void 0}),initialData:a,props:{defaultName:b,assets:{upload:d.upload,resolve:d.resolve??pK,remove:d.remove??(()=>Promise.resolve())},onMount:a=>{cd(a instanceof px),e?.(a)},collaboration:f}});if(g.snapshot){if(a)throw Error("Cannot provide both initialData and snapshot");kp(h,g.snapshot,{forceOverwriteSessionState:!0})}return h}function pN(a){return Object.fromEntries(a.map(a=>[a.type,{props:a.props,migrations:a.migrations}]))}let pO=new WeakMap,pP=new WeakMap,pQ=new WeakMap,pR=new WeakMap,pS=new WeakMap,pT={get(a,b,c){if(a instanceof IDBTransaction){if("done"===b)return pP.get(a);if("objectStoreNames"===b)return a.objectStoreNames||pQ.get(a);if("store"===b)return c.objectStoreNames[1]?void 0:c.objectStore(c.objectStoreNames[0])}return pU(a[b])},set:(a,b,c)=>(a[b]=c,!0),has:(a,b)=>a instanceof IDBTransaction&&("done"===b||"store"===b)||b in a};function pU(a){if(a instanceof IDBRequest){let b;return(b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("success",e),a.removeEventListener("error",f)},e=()=>{b(pU(a.result)),d()},f=()=>{c(a.error),d()};a.addEventListener("success",e),a.addEventListener("error",f)})).then(b=>{b instanceof IDBCursor&&pO.set(b,a)}).catch(()=>{}),pS.set(b,a),b}if(pR.has(a))return pR.get(a);let b=function(a){if("function"==typeof a)return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(h||(h=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...b){return a.apply(pV(this),b),pU(pO.get(this))}:function(...b){return pU(a.apply(pV(this),b))}:function(b,...c){let d=a.call(pV(this),b,...c);return pQ.set(d,b.sort?b.sort():[b]),pU(d)};return a instanceof IDBTransaction&&function(a){if(pP.has(a))return;let b=new Promise((b,c)=>{let d=()=>{a.removeEventListener("complete",e),a.removeEventListener("error",f),a.removeEventListener("abort",f)},e=()=>{b(),d()},f=()=>{c(a.error||new DOMException("AbortError","AbortError")),d()};a.addEventListener("complete",e),a.addEventListener("error",f),a.addEventListener("abort",f)});pP.set(a,b)}(a),(g||(g=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(b=>a instanceof b)?new Proxy(a,pT):a}(a);return b!==a&&(pR.set(a,b),pS.set(b,a)),b}let pV=a=>pS.get(a);function pW(a,b,{blocked:c,upgrade:d,blocking:e,terminated:f}={}){let g=indexedDB.open(a,b),h=pU(g);return d&&g.addEventListener("upgradeneeded",a=>{d(pU(g.result),a.oldVersion,a.newVersion,pU(g.transaction),a)}),c&&g.addEventListener("blocked",a=>c(a.oldVersion,a.newVersion,a)),h.then(a=>{f&&a.addEventListener("close",()=>f()),e&&a.addEventListener("versionchange",a=>e(a.oldVersion,a.newVersion,a))}).catch(()=>{}),h}let pX=["get","getKey","getAll","getAllKeys","count"],pY=["put","add","delete","clear"],pZ=new Map;function p$(a,b){if(!(a instanceof IDBDatabase&&!(b in a)&&"string"==typeof b))return;if(pZ.get(b))return pZ.get(b);let c=b.replace(/FromIndex$/,""),d=b!==c,e=pY.includes(c);if(!(c in(d?IDBIndex:IDBObjectStore).prototype)||!(e||pX.includes(c)))return;let f=async function(a,...b){let f=this.transaction(a,e?"readwrite":"readonly"),g=f.store;return d&&(g=g.index(b.shift())),(await Promise.all([g[c](...b),e&&f.done]))[0]};return pZ.set(b,f),f}pT={...q=pT,get:(a,b,c)=>p$(a,b)||q.get(a,b,c),has:(a,b)=>!!p$(a,b)||q.has(a,b)};let p_="TLDRAW_DB_NAME_INDEX_v2",p0="records",p1="schema",p2="session_state",p3="assets";async function p4(a){var b;let c,d="TLDRAW_DOCUMENT_v2"+a;return b=d,(c=new Set(p7())).add(b),c9(p_,JSON.stringify([...c])),await pW(d,4,{upgrade(a){a.objectStoreNames.contains(p0)||a.createObjectStore(p0),a.objectStoreNames.contains(p1)||a.createObjectStore(p1),a.objectStoreNames.contains(p2)||a.createObjectStore(p2),a.objectStoreNames.contains(p3)||a.createObjectStore(p3)}})}async function p5(a){let b=window.indexedDB.databases?(await window.indexedDB.databases()).map(a=>a.name):p7(),c="TLDRAW_ASSET_STORE_v1"+a;if(!b.find(a=>a===c))return;let d=await pW(c,1,{upgrade(a){a.objectStoreNames.contains("assets")||a.createObjectStore("assets")}});if(!d.objectStoreNames.contains("assets"))return;let e=d.transaction(["assets"],"readonly"),f=e.objectStore("assets"),g=await f.getAllKeys(),h=await Promise.all(g.map(async a=>[a,await f.get(a)]));await e.done;let i=await p4(a),j=i.transaction([p3],"readwrite"),k=j.objectStore(p3);for(let[a,b]of h)k.put(b,a);await j.done,d.close(),i.close(),await function(a,{blocked:b}={}){let c=indexedDB.deleteDatabase(a);return b&&c.addEventListener("blocked",a=>b(a.oldVersion,a)),pU(c).then(()=>void 0)}(c)}class p6{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(a){p6.connectedInstances.add(this),this.getDbPromise=(async()=>(await p5(a),await p4(a)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(ca)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),p6.connectedInstances.delete(this))}tx(a,b,c){let d=(async()=>{cd(!this.isClosed,"db is closed");let d=(await this.getDb()).transaction(b,a),e=d.done.catch(a=>{if(!this.isClosed)throw a});try{return await c(d)}finally{this.isClosed?d.abort():await e}})();return this.pendingTransactionSet.add(d),d.finally(()=>this.pendingTransactionSet.delete(d)),d}async load({sessionId:a}={}){return await this.tx("readonly",[p0,p1,p2],async b=>{let c=b.objectStore(p0),d=b.objectStore(p1),e=b.objectStore(p2),f=a?(await e.get(a))?.snapshot:null;if(!f){let a=await e.getAll();f=a.sort((a,b)=>a.updatedAt-b.updatedAt).pop()?.snapshot}return{records:await c.getAll(),schema:await d.get(p1),sessionStateSnapshot:f}})}async storeChanges({schema:a,changes:b,sessionId:c,sessionStateSnapshot:d}){await this.tx("readwrite",[p0,p1,p2],async e=>{let f=e.objectStore(p0),g=e.objectStore(p1),h=e.objectStore(p2);for(let[a,c]of Object.entries(b.added))await f.put(c,a);for(let[a,c]of Object.values(b.updated))await f.put(c,c.id);for(let a of Object.keys(b.removed))await f.delete(a);g.put(a.serialize(),p1),d&&c?h.put({snapshot:d,updatedAt:Date.now(),id:c},c):(d||c)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:a,snapshot:b,sessionId:c,sessionStateSnapshot:d}){await this.tx("readwrite",[p0,p1,p2],async e=>{let f=e.objectStore(p0),g=e.objectStore(p1),h=e.objectStore(p2);for(let[a,c]of(await f.clear(),Object.entries(b)))await f.put(c,a);g.put(a.serialize(),p1),d&&c?h.put({snapshot:d,updatedAt:Date.now(),id:c},c):(d||c)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[p2],async a=>{let b=a.objectStore(p2),c=(await b.getAll()).sort((a,b)=>a.updatedAt-b.updatedAt);if(c.length<10)return void await a.done;for(let{id:a}of c.slice(0,c.length-10))await b.delete(a)})}async getAsset(a){return await this.tx("readonly",[p3],async b=>{let c=b.objectStore(p3);return await c.get(a)})}async storeAsset(a,b){await this.tx("readwrite",[p3],async c=>{let d=c.objectStore(p3);await d.put(b,a)})}async removeAssets(a){await this.tx("readwrite",[p3],async b=>{let c=b.objectStore(p3);for(let b of a)await c.delete(b)})}}function p7(){let a=JSON.parse(c8(p_)||"[]")??[];return Array.isArray(a)?a:[]}let p8=Symbol("UPDATE_INSTANCE_STATE"),p9="u"<typeof BroadcastChannel?class{onmessage;constructor(a){}postMessage(a){}close(){}}:BroadcastChannel;class qa{constructor(a,{persistenceKey:b,sessionId:c=kj,onLoad:d,onLoadError:e},f=new p9(`tldraw-tab-sync-${b}`)){this.store=a,this.channel=f,this.persistenceKey=b,this.sessionId=c,this.db=new p6(b),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=kn(this.store),this.disposables.add(a.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema}),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(a.listen(()=>{this.diffQueue.push(p8),this.schedulePersist()},{scope:"session"})),this.connect(d,e),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>"document"===a.scope).map(a=>a.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...a){this.isDebugging&&console.debug(...a)}async connect(a,b){let c;this.debug("connecting");try{c=await this.db.load({sessionId:this.sessionId})}catch(a){b(a),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`);return}if(this.debug("loaded data from store",c,"didDispose",this.didDispose),!this.didDispose)try{if(c){let a=Object.fromEntries(c.records.map(a=>[a.id,a])),d=c.sessionStateSnapshot??function(a){let b=[];for(let c of Object.values(a))c.typeName?.match(/^(instance.*|pointer|camera)$/)&&b.push(c);let c=b.filter(a=>"instance"===a.typeName&&a.id!==g3)[0];if(!c)return null;let d={version:kl,currentPageId:c.currentPageId,exportBackground:!!c.exportBackground,isFocusMode:!!c.isFocusMode,isDebugMode:!!c.isDebugMode,isToolLocked:!!c.isToolLocked,isGridMode:!1,pageStates:b.filter(a=>"instance_page_state"===a.typeName&&a.instanceId===c.id).map(b=>{let c=a[b.cameraId]??{x:0,y:0,z:1};return{pageId:b.pageId,camera:{x:c.x,y:c.y,z:c.z},selectedShapeIds:b.selectedShapeIds,focusedGroupId:b.focusedGroupId}})};try{return km.validate(d),d}catch{return null}}(a),e=this.store.schema.migrateStoreSnapshot({store:a,schema:c.schema??this.store.schema.serializeEarliestVersion()});if("error"===e.type){console.error("failed to migrate store",e),b(Error(`Failed to migrate store: ${e.reason}`));return}let f=Object.values(e.value).filter(a=>this.documentTypes.has(a.typeName));f.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(f,"initialize")}),d&&ko(this.store,d,{forceOverwrite:!0})}this.channel.onmessage=({data:a})=>{this.debug("got message",a);let c=this.store.schema.getMigrationsSince(a.schema);if(!c.ok)return Date.now()-this.initTime<5e3?void b(Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void window?.location?.reload?.());if(c.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===a.type&&(this.debug("applying diff"),dH(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(a.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),a(this)}catch(a){if(this.debug("error loading data from store",a),this.didDispose)return;b(a);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(a=>a())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||!this.store.isPossiblyCorrupted()&&(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){if(cd(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");let a=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let b=e1(a.filter(a=>a!==p8));await this.db.storeChanges({changes:b,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(a){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",a),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function qb(a){let b=(0,bT.useRef)(a),[c,d]=(0,bT.useState)(a);return c!==b.current&&d(b.current),[c,(0,bT.useCallback)(a=>{"function"==typeof a?b.current=a(b.current):b.current=a,d(b.current)},[])]}function qc(a){let b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(let b=0,d=a.length;b<d;b++)c[b]=a.charCodeAt(b);return b}let qd={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8,EVALUATION_LICENSE:16,NATIVE_LICENSE:32},qe=Math.max(...Object.values(qd)),qf={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},qg=Object.keys(qf).length,qh="sales@tldraw.com",qi=`${mo()}/watermarks/watermark-track.svg`;class qj{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=d$("license state","pending");verbose=!0;constructor(a,b){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(),this.publicKey=b||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(a).then(a=>{let b=function(a,b,c){if(!a.isLicenseParseable)return c?"unlicensed":(b("no-key-provided"===a.reason?["No tldraw license key provided!","A license is required for production deployments.",`Please reach out to ${qh} to purchase a license.`]:["Invalid license key. tldraw requires a valid license for production use.",`Please reach out to ${qh} to purchase a license.`]),"unlicensed-production");if(!a.isDomainValid&&!a.isDevelopment)return b(["License key is not valid for this domain.","A license is required for production deployments.",`Please reach out to ${qh} to purchase a license.`]),"unlicensed-production";if(a.isEvaluationLicense)if(a.isEvaluationLicenseExpired)return b(["Your tldraw evaluation license has expired!",`Please reach out to ${qh} to purchase a full license.`]),"expired";else return"licensed";if(a.isPerpetualLicenseExpired||a.isAnnualLicenseExpired)return b(["Your tldraw license has been expired for more than 30 days!",`Please reach out to ${qh} to renew your license.`]),"expired";let d=a.daysSinceExpiry;return d>0&&!a.isEvaluationLicense?(b(["Your tldraw license has expired.",`License expired ${d} days ago.`,`Please reach out to ${qh} to renew your license.`]),"licensed"):a.isLicensedWithWatermark?"licensed-with-watermark":"licensed"}(a,a=>this.outputMessages(a),this.isDevelopment);this.maybeTrack(a,b),this.state.set(b)}).catch(a=>{console.error("License validation failed:",a),this.state.set("unlicensed")})}getIsDevelopment(){return!["https:","vscode-webview:"].includes(window.location.protocol)||"localhost"===window.location.hostname}getTrackType(a,b){return"unlicensed-production"===b?"unlicensed":this.isDevelopment||!a.isLicenseParseable?null:a.isEvaluationLicense?"evaluation":"licensed-with-watermark"===b?"with_watermark":null}maybeTrack(a,b){let c=this.getTrackType(a,b);if(!c)return;let d=new URL(qi);if(d.searchParams.set("version",jU),d.searchParams.set("license_type",c),"license"in a){d.searchParams.set("license_id",a.license.id);let b=this.isFlagEnabled(a.license.flags,qd.EVALUATION_LICENSE)?"evaluation":this.isFlagEnabled(a.license.flags,qd.ANNUAL_LICENSE)?"annual":this.isFlagEnabled(a.license.flags,qd.PERPETUAL_LICENSE)?"perpetual":"unknown";d.searchParams.set("sku",b)}d.searchParams.set("url",window.location.href),d.searchParams.set("environment","production"),fetch(d.toString())}async extractLicenseKey(a){let b,c,d,[e,f]=a.split("."),[g,h]=e.split("/");if(!g.startsWith("tldraw-"))throw Error(`Unsupported prefix '${g}'`);let i=await (d=qc(atob(this.publicKey)),crypto.subtle.importKey("spki",new Uint8Array(d),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"]));try{b=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,new Uint8Array(qc(atob(f))),new Uint8Array(qc(atob(h))))}catch(a){throw console.error(a),Error("Could not perform signature validation")}if(!b)throw Error("Invalid signature");try{c=JSON.parse(atob(h))}catch{throw Error("Could not parse object")}return c.length>qg&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[qf.ID],hosts:c[qf.HOSTS],flags:c[qf.FLAGS],expiryDate:c[qf.EXPIRY_DATE]}}async getLicenseFromKey(a){if(!a)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let b=a.replace(/[\u200B-\u200D\uFEFF]/g,"");b=b.replace(/\r?\n|\r/g,"");try{let a=await this.extractLicenseKey(b),c=new Date(a.expiryDate),d=this.isFlagEnabled(a.flags,qd.ANNUAL_LICENSE),e=this.isFlagEnabled(a.flags,qd.PERPETUAL_LICENSE),f=this.isFlagEnabled(a.flags,qd.EVALUATION_LICENSE),g=this.getDaysSinceExpiry(c),h={license:a,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(a),expiryDate:c,isAnnualLicense:d,isAnnualLicenseExpired:d&&this.isAnnualLicenseExpired(c),isPerpetualLicense:e,isPerpetualLicenseExpired:e&&this.isPerpetualLicenseExpired(c),isInternalLicense:this.isFlagEnabled(a.flags,qd.INTERNAL_LICENSE),isNativeLicense:this.isNativeLicense(a),isLicensedWithWatermark:this.isFlagEnabled(a.flags,qd.WITH_WATERMARK),isEvaluationLicense:f,isEvaluationLicenseExpired:f&&this.isEvaluationLicenseExpired(c),daysSinceExpiry:g};return this.outputLicenseInfoIfNeeded(h),h}catch(a){return this.outputInvalidLicenseKey(a.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(a){let b=window.location.hostname.toLowerCase();return a.hosts.some(c=>{let d=c.toLowerCase().trim();if(d===b||`www.${d}`===b||d===`www.${b}`||"*"===c)return!0;if(this.isNativeLicense(a))return new RegExp(d).test(window.location.href);if(c.includes("*")){let a=new RegExp(c.replace(/\*/g,".*?"));return a.test(b)||a.test(`www.${b}`)}return"vscode-webview:"===window.location.protocol&&d===new URL(window.location.href).searchParams.get("extensionId")||!1})}isNativeLicense(a){return this.isFlagEnabled(a.flags,qd.NATIVE_LICENSE)}getExpirationDateWithoutGracePeriod(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())}getExpirationDateWithGracePeriod(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+30+1)}isAnnualLicenseExpired(a){let b=this.getExpirationDateWithGracePeriod(a);return new Date>=b}isPerpetualLicenseExpired(a){let b=this.getExpirationDateWithGracePeriod(a),c={major:new Date("2025-09-18T14:39:22.803Z"),minor:new Date("2026-02-18T12:03:50.380Z")};return c.major>=b||c.minor>=b}getDaysSinceExpiry(a){let b=new Date,c=this.getExpirationDateWithoutGracePeriod(a);return Math.max(0,Math.floor((b.getTime()-c.getTime())/864e5))}isEvaluationLicenseExpired(a){return new Date>=this.getExpirationDateWithoutGracePeriod(a)}isFlagEnabled(a,b){return(a&b)===b}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(a){this.outputMessages(["Invalid tldraw license key",`Reason: ${a}`])}outputLicenseInfoIfNeeded(a){a.license.flags>=2*qe&&this.outputMessages(["Warning: This tldraw license contains some unknown flags.","This will still work, however, you may want to update tldraw packages to a newer version to get access to new functionality."],"warning")}outputMessages(a,b="error"){if(!this.isTest&&this.verbose){for(let c of(this.outputDelimiter(b),a)){let a="warning"===b?"orange":"crimson";console.log(`%c${c}`,`color: white; background: ${a}; padding: 2px; border-radius: 3px;`)}this.outputDelimiter(b)}}outputDelimiter(a="error"){console.log("%c-------------------------------------------------------------------",`color: white; background: ${"warning"===a?"orange":"crimson"}; padding: 2px; border-radius: 3px;`)}static className="tl-watermark_SEE-LICENSE"}let qk={get url(){return`file://${a.P("ADK_WORKSPACE/TutorMekimi/tutorme-app/node_modules/@tldraw/editor/dist-esm/lib/license/LicenseProvider.mjs")}`}},ql=(0,bT.createContext)({});function qm(a){return"expired"===a||"unlicensed-production"===a}function qn({licenseKey:a=(void 0!==n?n:n=qp(()=>process.env.TLDRAW_LICENSE_KEY)||qp(()=>process.env.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||qp(()=>process.env.REACT_APP_TLDRAW_LICENSE_KEY)||qp(()=>process.env.GATSBY_TLDRAW_LICENSE_KEY)||qp(()=>process.env.VITE_TLDRAW_LICENSE_KEY)||qp(()=>process.env.PUBLIC_TLDRAW_LICENSE_KEY)||qp(()=>qk.env.TLDRAW_LICENSE_KEY)||qp(()=>qk.env.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||qp(()=>qk.env.REACT_APP_TLDRAW_LICENSE_KEY)||qp(()=>qk.env.GATSBY_TLDRAW_LICENSE_KEY)||qp(()=>qk.env.VITE_TLDRAW_LICENSE_KEY)||qp(()=>qk.env.PUBLIC_TLDRAW_LICENSE_KEY)||null)??void 0,children:b}){let[c]=(0,bT.useState)(()=>new qj(a)),d=d8(c.state),[e,f]=(0,bT.useState)(!0);return((0,bT.useEffect)(()=>{if(qm(d)&&e){let a=setTimeout(()=>{f(!1)},5e3);return()=>clearTimeout(a)}},[d,e]),qm(d)&&!e)?(0,bS.jsx)(qo,{}):(0,bS.jsx)(ql.Provider,{value:c,children:b})}function qo(){return(0,bS.jsx)("div",{"data-testid":"tl-license-expired",style:{display:"none"}})}function qp(a){try{return a()}catch{return}}function qq(a){if(!a)throw Error("usePassThroughWheelEvents must be passed a ref");let b=jG(),c=jB();(0,bT.useEffect)(()=>{function d(d){if(!c?.getInstanceState().isFocused||d.isSpecialRedispatchedEvent)return;let e=a.current;if(e&&e.scrollHeight>e.clientHeight)return;jm(d);let f=b.querySelector(".tl-canvas");if(!f)return;let g=new WheelEvent("wheel",d);g.isSpecialRedispatchedEvent=!0,f.dispatchEvent(g)}let e=a.current;if(e)return e.addEventListener("wheel",d,{passive:!1}),()=>{e.removeEventListener("wheel",d)}},[b,c,a])}let qr=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')}`,qs=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>')}`,qt=(0,bT.memo)(function(){var a;let b=(0,bT.useContext)(ql),c=jA(),d=d8("is mobile",()=>c.getViewportScreenBounds().width<700,[c]),e=d8("watermarkState",()=>a.state.get(),[a=b]);return["licensed-with-watermark","unlicensed"].includes(e)?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(qw,{}),(0,bS.jsx)(qv,{src:d?qs:qr,isUnlicensed:"unlicensed"===e})]}):null}),qu=(0,bT.memo)(function({isDebugMode:a,isMobile:b}){let c=jA(),d=jD(),e=(0,bT.useRef)(null);return qq(e),(0,bS.jsx)("div",{ref:e,className:qj.className,"data-debug":a,"data-mobile":b,"data-unlicensed":!0,"data-testid":"tl-watermark-unlicensed",draggable:!1,...d,children:(0,bS.jsx)("button",{draggable:!1,role:"button",onPointerDown:a=>{c.markEventAsHandled(a),jm(a)},title:"The tldraw SDK requires a license key to work in production. You can get a free 100-day trial license at tldraw.dev/pricing.",onClick:()=>{jK.openWindow("https://tldraw.dev/pricing?utm_source=sdk&utm_medium=organic&utm_campaign=watermark","_blank",!0)},children:"Get a license for production"})})}),qv=(0,bT.memo)(function({src:a,isUnlicensed:b}){let c=jA(),d=d8("debug mode",()=>c.getInstanceState().isDebugMode,[c]),e=d8("is mobile",()=>c.getViewportScreenBounds().width<700,[c]),f=jD(),g=(0,bT.useRef)(null);qq(g);let h=`url('${a}') center 100% / 100% no-repeat`;return b?(0,bS.jsx)(qu,{isDebugMode:d,isMobile:e}):(0,bS.jsx)("div",{ref:g,className:qj.className,"data-debug":d,"data-mobile":e,"data-testid":"tl-watermark-licensed",draggable:!1,...f,children:(0,bS.jsx)("button",{draggable:!1,role:"button",onPointerDown:a=>{c.markEventAsHandled(a),jm(a)},title:"Build infinite canvas applications with the tldraw SDK. Learn more at https://tldraw.dev.",onClick:()=>{jK.openWindow("https://tldraw.dev/?utm_source=sdk&utm_medium=organic&utm_campaign=watermark","_blank")},style:{mask:h,WebkitMask:h}})})}),qw=(0,bT.memo)(function(){let a=jA(),b=qj.className,c=`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${b} {
	position: absolute;
	bottom: max(var(--tl-space-2), env(safe-area-inset-bottom));
	right: max(var(--tl-space-2), env(safe-area-inset-right));
	width: 96px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: var(--tl-layer-watermark) !important;
	background-color: color-mix(in srgb, var(--tl-color-background) 62%, transparent);
	opacity: 1;
	border-radius: 5px;
	pointer-events: all;
	padding: 2px;
	box-sizing: content-box;
}

.${b} > button {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: all;
	cursor: inherit;
	color: var(--tl-color-text);
	opacity: .38;
	border: 0;
	padding: 0;
	background-color: currentColor;
}

.${b}[data-debug='true'] {
	bottom: max(46px, env(safe-area-inset-bottom));
}

.${b}[data-mobile='true'] {
	border-radius: 4px 0px 0px 4px;
	right: max(-2px, calc(env(safe-area-inset-right) - 2px));
	width: 8px;
	height: 48px;
}

.${b}[data-mobile='true'] > button {
	width: 8px;
	height: 32px;
}

.${b}[data-unlicensed='true'] > button {
	font-size: 100px;
	position: absolute;
	pointer-events: all;
	cursor: pointer;
	color: var(--tl-color-text);
	opacity: 0.8;
	border: 0;
	padding: 0;
	background-color: transparent;
	font-size: 11px;
	font-weight: 600;
	text-align: center;
}

.${b}[data-mobile='true'][data-unlicensed='true'] > button {
	display: none;
}

@media (hover: hover) {
	.${b} > button {
		pointer-events: none;
	}

	.${b}:hover {
		background-color: var(--tl-color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}

	.${b}:hover > button {
		animation: ${b}_delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}

	.${b} > button:focus-visible {
		opacity: 1;
	}
}

@keyframes ${b}_delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}`;return(0,bS.jsx)("style",{nonce:a.options.nonce,children:c})}),qx=[],qy=[],qz=[],qA=(0,bT.memo)(function({store:a,components:b,className:c,user:d,options:e,textOptions:f,deepLinks:g,...h}){let[i,j]=(0,bT.useState)(null),k=(0,bT.useMemo)(()=>d??kf(),[d]),l=b?.ErrorFallback===void 0?jQ:b?.ErrorFallback,m=(0,bT.useMemo)(()=>{let a=e;return f&&(a={...a,text:a?.text??f}),void 0!==g&&(a={...a,deepLinks:a?.deepLinks??g}),a},[e,f,g]),n={...h,shapeUtils:h.shapeUtils??qx,bindingUtils:h.bindingUtils??qy,tools:h.tools??qz,components:b,options:jV(m,jY)};return(0,bS.jsx)("div",{ref:j,"data-tldraw":jU,draggable:!1,className:(0,jb.default)("tl-container tl-theme__light",c),tabIndex:-1,role:"application","aria-label":e?.branding??"tldraw",children:(0,bS.jsx)(jP,{fallback:l,onError:a=>cl(a,{tags:{origin:"react.tldraw-before-app"}}),children:i&&(0,bS.jsx)(qn,{licenseKey:h.licenseKey,children:(0,bS.jsx)(jF,{container:i,children:(0,bS.jsx)(q$,{overrides:b,children:a?a instanceof fc?(0,bS.jsx)(qE,{...n,store:a,user:k}):(0,bS.jsx)(qC,{...n,store:a,user:k}):(0,bS.jsx)(qB,{...n,store:a,user:k})})})})})})});function qB(a){let{defaultName:b,snapshot:c,initialData:d,shapeUtils:e,bindingUtils:f,persistenceKey:g,sessionId:h,user:i,assets:j,migrations:k}=a,l=function(a){let[b,c]=qb({status:"loading"});return a=jV(a,jY),(0,bT.useEffect)(()=>{let{persistenceKey:b,sessionId:d,...e}=a;if(!b)return void c({status:"not-synced",store:pM(e)});c({status:"loading"});let f=new ci,g={upload:async(a,b)=>(await j.db.storeAsset(a.id,b),{src:a.id}),resolve:async a=>a.props.src?a.props.src.startsWith("asset:")?await f.get(a,async()=>{let b=await j.db.getAsset(a.id);return b?URL.createObjectURL(b):null}):a.props.src:null,remove:async a=>{await j.db.removeAssets(a)},...e.assets},h=pM({...e,assets:g}),i=!1,j=new qa(h,{sessionId:d,persistenceKey:b,onLoad(){i||c({store:h,status:"synced-local"})},onLoadError(a){i||c({status:"error",error:a})}});return()=>{i=!0,j.close()}},[a,c]),b}({shapeUtils:e,bindingUtils:f,initialData:d,persistenceKey:g,sessionId:h,defaultName:b,snapshot:c,assets:j,migrations:k});return(0,bS.jsx)(qC,{...a,store:l,user:i})}let qC=(0,bT.memo)(function({store:a,user:b,...c}){let d=jG();(0,bT.useLayoutEffect)(()=>{"dark"===b.userPreferences.get().colorScheme&&(d.classList.remove("tl-theme__light"),d.classList.add("tl-theme__dark"))},[d,b]);let{LoadingScreen:e}=q_();switch(a.status){case"error":throw a.error;case"loading":return e?(0,bS.jsx)(e,{}):null}return(0,bS.jsx)(qE,{...c,store:a.store,user:b})}),qD=()=>document.location.search.includes("tldraw_preserve_focus");function qE({onMount:a,children:b,store:c,tools:d,shapeUtils:e,bindingUtils:f,user:g,initialState:h,autoFocus:i=!0,inferDarkMode:j,cameraOptions:k,options:l,licenseKey:m,getShapeVisibility:n,assetUrls:o}){let{ErrorFallback:p}=q_(),q=jG(),[r,s]=qb(null),t=(0,bT.useRef)(null),u=l?.deepLinks,v=jV(!0===u?{}:u,jY),w=(0,bT.useRef)({autoFocus:i&&!qD(),inferDarkMode:j,initialState:h,cameraOptions:k,deepLinks:v});(0,bT.useLayoutEffect)(()=>{w.current={autoFocus:i&&!qD(),inferDarkMode:j,initialState:h,cameraOptions:k,deepLinks:v}},[i,j,h,k,v]),(0,bT.useLayoutEffect)(()=>{let{autoFocus:a,inferDarkMode:b,initialState:h,cameraOptions:i,deepLinks:j}=w.current,k=new px({store:c,shapeUtils:e,bindingUtils:f,tools:d,getContainer:()=>q,user:g,initialState:h,autoFocus:a,inferDarkMode:b,cameraOptions:i,options:l,licenseKey:m,getShapeVisibility:n,fontAssetUrls:o?.fonts});return k.updateViewportScreenBounds(t.current??q),j&&(j?.getUrl?k.navigateToDeepLink({...j,url:j.getUrl(k)}):k.navigateToDeepLink(j)),s(k),()=>{k.dispose()}},[f,q,l,e,c,d,g,s,m,n,o]),(0,bT.useLayoutEffect)(()=>{if(r&&v)return r.registerDeepLinkListener(v)},[r,v]),(0,bT.useLayoutEffect)(()=>{r&&(k||l?.camera)&&r.setCameraOptions({...k,...l?.camera})},[r,k,l?.camera]);let y=(0,bT.useSyncExternalStore)((0,bT.useCallback)(a=>r?(r.on("crash",a),()=>r.off("crash",a)):()=>{},[r]),()=>r?.getCrashingError()??null);(0,bT.useEffect)(function(){if(r&&i&&qD())return r.getContainer().addEventListener("pointerdown",a),document.body.addEventListener("pointerdown",b),()=>{r.getContainer()?.removeEventListener("pointerdown",a),document.body.removeEventListener("pointerdown",b)};function a(){r&&r.focus()}function b(){r&&r.blur()}},[r,i]);let[z,A]=(0,bT.useState)(null),B=z;r!==B?.editor&&(B=null),(0,bT.useLayoutEffect)(()=>{if(!r)return;if(0===r.options.maxFontsToLoadBeforeRender)return void A({editor:r,isLoaded:!0});let a=!1;return A({editor:r,isLoaded:!1}),r.fonts.loadRequiredFontsForCurrentPage(r.options.maxFontsToLoadBeforeRender).finally(()=>{a||A({editor:r,isLoaded:!0})}),()=>{a=!0}},[r]);let{Canvas:C,LoadingScreen:D}=q_();return r&&B?.isLoaded?(0,bS.jsx)(jP,{fallback:p,onError:a=>r.annotateError(a,{origin:"react.tldraw",willCrashApp:!0}),children:y?(0,bS.jsx)(qG,{crashingError:y}):(0,bS.jsx)(jC,{editor:r,children:(0,bS.jsxs)(qF,{onMount:a,children:[b??(C?(0,bS.jsx)(C,{},r.contextId):null),(0,bS.jsx)(qt,{})]})})}):(0,bS.jsxs)(bS.Fragment,{children:[D&&(0,bS.jsx)(D,{}),(0,bS.jsx)("div",{className:"tl-canvas",ref:t})]})}function qF({children:a,onMount:b}){let c,d,e,f,g,h,i,j,k,l;return c=jA(),d=jG(),bT.useEffect(()=>{let a=a=>d.style.setProperty("--tl-zoom",a.toString()),b=cj(a,100),e=new dz("useZoomCss",()=>a(c.getEfficientZoomLevel()));return e.attach(),e.execute(),()=>{e.detach(),b.cancel()}},[c,d]),e=jA(),f=jG(),d6("useCursor",()=>{let{type:a,rotation:b}=e.getInstanceState().cursor;pH.includes(a)?f.style.setProperty("--tl-cursor",`var(--tl-cursor-${a})`):f.style.setProperty("--tl-cursor",pJ(a,b,g?"white":"black"))},[e,f,g=pC()]),h=jA(),i=jG(),j=pC(),k=d8(ji.forceSrgb),bT.default.useEffect(()=>{j?(i.setAttribute("data-color-mode","dark"),i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark")):(i.setAttribute("data-color-mode","light"),i.classList.remove("tl-theme__dark"),i.classList.add("tl-theme__light")),k?i.classList.add("tl-theme__force-sRGB"):i.classList.remove("tl-theme__force-sRGB")},[h,i,k,j]),function(){let[a,b]=(0,bT.useState)(0);(0,bT.useEffect)(()=>b(a=>a+1),[])}(),l=jA(),(0,bT.useLayoutEffect)(()=>dA("stateAttribute",()=>{let a=l.getContainer(),b=l.getInstanceState();a.setAttribute("data-state",l.getPath()),a.setAttribute("data-coarse",String(b.isCoarsePointer))}),[l]),qI(a=>{let c=a.store.props.onMount(a),d=b?.(a);return()=>{c?.(),d?.()}}),a}function qG({crashingError:a}){throw a}function qH({children:a}){return(0,bS.jsx)("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:a})}function qI(a){let b=jA(),c=lP(b=>{let c;return b.run(()=>{c=a?.(b),b.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,c});bT.default.useLayoutEffect(()=>{if(b)return c?.(b)},[b,c])}let qJ=()=>{let{Spinner:a}=q_();return(0,bS.jsx)(qH,{children:a?(0,bS.jsx)(a,{}):null})};function qK(a,b=!0){let c=a.length;if(c<2)return"";let d=a[0],e=a[1];if(2===c)return`M${iM(d)}L${iM(e)}`;let f="";for(let b=2,g=c-1;b<g;b++)f+=iN(d=a[b],e=a[b+1]);return b?`M${iN(a[0],a[1])}Q${iM(a[1])}${iN(a[1],a[2])}T${f}${iN(a[c-1],a[0])}${iN(a[0],a[1])}Z`:`M${iM(a[0])}Q${iM(a[1])}${iN(a[1],a[2])}${a.length>3?"T":""}${f}L${iM(a[c-1])}`}function qL({scribble:a,zoom:b,color:c,opacity:d,className:e}){return a.points.length?(0,bS.jsx)("svg",{className:e?(0,jb.default)("tl-overlays__item",e):e,children:(0,bS.jsx)("path",{className:"tl-scribble",d:qK(a.points,!1),stroke:c??`var(--tl-color-${a.color})`,fill:"none",strokeWidth:8/b,opacity:d??a.opacity})}):null}function qM({bounds:a,rotation:b}){let c=jA(),d=(0,bT.useRef)(null),e=d8("only selected shape",()=>c.getOnlySelectedShape(),[c]),f=e?c.getShapeUtil(e).expandSelectionOutlinePx(e):0;return iC(d,a?.x,a?.y,1,b,{x:-f,y:-f}),a=f instanceof kt?a.clone().expand(f).zeroFix():a.clone().expandBy(f).zeroFix(),(0,bS.jsx)("svg",{ref:d,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,bS.jsx)("rect",{className:(0,jb.default)("tl-selection__fg__outline"),width:i5(a.width),height:i5(a.height)})})}let qN=()=>(0,bS.jsx)("div",{className:"tl-shape-error-boundary"}),qO=(0,bT.memo)(({shape:a,util:b})=>d_("Indicator: "+a.type,()=>b.indicator(b.editor.store.unsafeGetWithoutCapture(a.id))),(a,b)=>a.shape.props===b.shape.props&&a.shape.meta===b.shape.meta),qP=(0,bT.memo)(({editor:a,id:b})=>{let c=d8("shape for indicator",()=>a.store.get(b),[a,b]),{ShapeIndicatorErrorFallback:d}=q_();if(!c||c.isLocked)return null;let e=a.getShapeUtil(c);return e.useLegacyIndicator()?(0,bS.jsx)(jP,{fallback:d,onError:b=>a.annotateError(b,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,bS.jsx)(qO,{shape:c,util:e},c.id)}):null}),qQ=(0,bT.memo)(function({shapeId:a,className:b,color:c,hidden:d,opacity:e}){let f=jA(),g=(0,bT.useRef)(null);return d6("indicator transform",()=>{if(d)return;let b=g.current;if(!b)return;let c=f.getShapePageTransform(a);c&&b.style.setProperty("transform",c.toCssString())},[f,a,d]),(0,bT.useLayoutEffect)(()=>{let a=g.current;a&&a.style.setProperty("display",d?"none":"block")},[d]),(0,bS.jsx)("svg",{ref:g,className:(0,jb.default)("tl-overlays__item",b),"aria-hidden":"true",children:(0,bS.jsx)("g",{className:"tl-shape-indicator",stroke:c??"var(--tl-color-selected)",opacity:e,children:(0,bS.jsx)(qP,{editor:f,id:a})})})}),qR=()=>(0,bS.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),qS=(0,bT.memo)(function({hideAll:a,showAll:b}){let c=jA();if(a&&b)throw Error("You cannot set both hideAll and showAll props to true, cmon now");let d=(0,bT.useRef)(new Set),e=d8("should display selected ids",()=>{let a=d.current,b=new Set,e=c.getInstanceState(),f=e.isChangingStyle,g=c.isInAny("select.idle","select.editing_shape"),h=c.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(f||!(g||h))return d.current=b,b;for(let a of c.getSelectedShapeIds())b.add(a);if(g&&e.isHoveringCanvas&&!e.isCoarsePointer){let a=c.getHoveredShapeId();a&&b.add(a)}if(a.size!==b.size)return d.current=b,b;for(let c of b)if(!a.has(c))return d.current=b,b;return a},[c]),f=d8("rendering shapes",()=>c.getRenderingShapes(),[c]),{ShapeIndicator:g}=q_(),h=d8("shapes to render for svg indicators",()=>f.filter(({id:a})=>{let b=c.getShape(a);return!!b&&c.getShapeUtil(b).useLegacyIndicator()}),[c,f]);return g?h.map(({id:c})=>(0,bS.jsx)(g,{shapeId:c,hidden:!b&&(a||!e.has(c))},c+"_indicator")):null}),qT=(0,bT.forwardRef)(function({children:a,shape:b,isBackground:c,...d},e){let f="fill"in b.props&&"none"!==b.props.fill;return(0,bS.jsx)("div",{ref:e,"data-shape-type":b.type,"data-shape-is-filled":c?void 0:f,"data-shape-id":b.id,draggable:!1,...d,className:(0,jb.default)("tl-shape",c&&"tl-shape-background",d.className),children:a})});function qU({points:a,zoom:b}){let c,d,e,f,g=2.5/b,h=a.reduce((a,b)=>Math.min(a,b.x),1/0),i=a.reduce((a,b)=>Math.max(a,b.x),-1/0),j=a.reduce((a,b)=>Math.min(a,b.y),1/0),k=a.reduce((a,b)=>Math.max(a,b.y),-1/0);return a.some(a=>a.x===h&&a.y===j)?(c=h,d=j,e=i,f=k):(c=h,d=k,e=i,f=j),(0,bS.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,bS.jsx)("line",{x1:c,y1:d,x2:e,y2:f}),a.map((a,b)=>(0,bS.jsx)("g",{transform:`translate(${a.x},${a.y})`,children:(0,bS.jsx)("path",{className:"tl-snap-point",d:`M ${-g},${-g} L ${g},${g} M ${-g},${g} L ${g},${-g}`})},b))]})}function qV({gaps:a,direction:b,zoom:c}){let d=3.5/c,e=[-1/0,1/0],f=null,g="horizontal"===b;for(let b of a){if(f=i2(e[0],e[1],g?b.startEdge[0].y:b.startEdge[0].x,g?b.startEdge[1].y:b.startEdge[1].x))(f=i2((e=f)[0],e[1],g?b.endEdge[0].y:b.endEdge[0].x,g?b.endEdge[1].y:b.endEdge[1].x))&&(e=f)}if(null===e)return null;let h=(e[0]+e[1])/2;return(0,bS.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:a.map(({startEdge:a,endEdge:b},c)=>(0,bS.jsx)(bT.Fragment,{children:g?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("line",{x1:a[0].x,y1:h-2*d,x2:a[1].x,y2:h+2*d}),(0,bS.jsx)("line",{x1:b[0].x,y1:h-2*d,x2:b[1].x,y2:h+2*d}),(0,bS.jsx)("line",{x1:a[0].x,y1:h,x2:b[0].x,y2:h}),(0,bS.jsx)("line",{x1:(a[0].x+b[0].x)/2,y1:h-d,x2:(a[0].x+b[0].x)/2,y2:h+d})]}):(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("line",{x1:h-2*d,y1:a[0].y,x2:h+2*d,y2:a[1].y}),(0,bS.jsx)("line",{x1:h-2*d,y1:b[0].y,x2:h+2*d,y2:b[1].y}),(0,bS.jsx)("line",{x1:h,y1:a[0].y,x2:h,y2:b[0].y}),(0,bS.jsx)("line",{x1:h-d,y1:(a[0].y+b[0].y)/2,x2:h+d,y2:(a[0].y+b[0].y)/2})]})},c))})}function qW({className:a,line:b,zoom:c}){return(0,bS.jsx)("svg",{className:(0,jb.default)("tl-overlays__item",a),"aria-hidden":"true",children:"points"===b.type?(0,bS.jsx)(qU,{...b,zoom:c}):"gaps"===b.type?(0,bS.jsx)(qV,{...b,zoom:c}):null})}function qX(a){return(0,bS.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...a,className:(0,jb.default)("tl-spinner",a.className),children:(0,bS.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,bS.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,bS.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}let qY=()=>null,qZ=(0,bT.createContext)(null);function q$({overrides:a={},children:b}){let c=jV(a,jY),d=(0,bT.useMemo)(()=>({Background:iB,Brush:ja,Canvas:r_,CollaboratorBrush:ja,CollaboratorCursor:jJ,CollaboratorHint:jI,CollaboratorScribble:qL,CollaboratorShapeIndicator:qQ,Cursor:jJ,Grid:jR,Handle:jS,Handles:jT,InFrontOfTheCanvas:null,LoadingScreen:qJ,OnTheCanvas:null,Overlays:null,Scribble:qL,SelectionBackground:null,SelectionForeground:qM,ShapeIndicator:qQ,ShapeIndicators:qS,ShapeWrapper:qT,SnapIndicator:qW,Spinner:qX,SvgDefs:qY,ZoomBrush:ja,ErrorFallback:jQ,ShapeErrorFallback:qN,ShapeIndicatorErrorFallback:qR,...c}),[c]);return(0,bS.jsx)(qZ.Provider,{value:d,children:b})}function q_(){let a=(0,bT.useContext)(qZ);if(!a)throw Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return a}let q0=["textarea","input"];a.s([],730972);let q1={toVector:(a,b)=>(void 0===a&&(a=b),Array.isArray(a)?a:[a,a]),add:(a,b)=>[a[0]+b[0],a[1]+b[1]],sub:(a,b)=>[a[0]-b[0],a[1]-b[1]],addTo(a,b){a[0]+=b[0],a[1]+=b[1]},subTo(a,b){a[0]-=b[0],a[1]-=b[1]}};function q2(a,b,c){return 0===b||Math.abs(b)===1/0?Math.pow(a,5*c):a*b*c/(b+c*a)}function q3(a,b,c,d=.15){return 0===d?Math.max(b,Math.min(a,c)):a<b?-q2(b-a,c-b,d)+b:a>c?+q2(a-c,c-b,d)+c:a}function q4(a,b,c){var d;return(b="symbol"==typeof(d=function(a,b){if("object"!=typeof a||null===a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(b,"string"))?d:String(d))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function q5(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function q6(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?q5(Object(c),!0).forEach(function(b){q4(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):q5(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}let q7={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function q8(a){return a?a[0].toUpperCase()+a.slice(1):""}let q9=["enter","leave"],ra=["gotpointercapture","lostpointercapture"];function rb(a){return"touches"in a}function rc(a,b){try{let c=b.clientX-a.clientX,d=b.clientY-a.clientY,e=(b.clientX+a.clientX)/2,f=(b.clientY+a.clientY)/2,g=Math.hypot(c,d);return{angle:-(180*Math.atan2(c,d))/Math.PI,distance:g,origin:[e,f]}}catch(a){}return null}function rd(a,b){let[c,d]=Array.from(a.touches).filter(a=>b.includes(a.identifier));return rc(c,d)}function re(a){let{deltaX:b,deltaY:c,deltaMode:d}=a;return 1===d?(b*=40,c*=40):2===d&&(b*=800,c*=800),[b,c]}function rf(a,...b){return"function"==typeof a?a(...b):a}function rg(){}function rh(a,b){return Object.assign({},b,a||{})}class ri{constructor(a,b,c){this.ctrl=a,this.args=b,this.key=c,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(a){this.ctrl.state[this.key]=a}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:a,shared:b,ingKey:c,args:d}=this;b[c]=a._active=a.active=a._blocked=a._force=!1,a._step=[!1,!1],a.intentional=!1,a._movement=[0,0],a._distance=[0,0],a._direction=[0,0],a._delta=[0,0],a._bounds=[[-1/0,1/0],[-1/0,1/0]],a.args=d,a.axis=void 0,a.memo=void 0,a.elapsedTime=a.timeDelta=0,a.direction=[0,0],a.distance=[0,0],a.overflow=[0,0],a._movementBound=[!1,!1],a.velocity=[0,0],a.movement=[0,0],a.delta=[0,0],a.timeStamp=0}start(a){let b=this.state,c=this.config;b._active||(this.reset(),this.computeInitial(),b._active=!0,b.target=a.target,b.currentTarget=a.currentTarget,b.lastOffset=c.from?rf(c.from,b):b.offset,b.offset=b.lastOffset,b.startTime=b.timeStamp=a.timeStamp)}computeValues(a){let b=this.state;b._values=a,b.values=this.config.transform(a)}computeInitial(){let a=this.state;a._initial=a._values,a.initial=a.values}compute(a){let{state:b,config:c,shared:d}=this;b.args=this.args;let e=0;if(a&&(b.event=a,c.preventDefault&&a.cancelable&&b.event.preventDefault(),b.type=a.type,d.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,d.locked=!!document.pointerLockElement,Object.assign(d,function(a){let b={};if("buttons"in a&&(b.buttons=a.buttons),"shiftKey"in a){let{shiftKey:c,altKey:d,metaKey:e,ctrlKey:f}=a;Object.assign(b,{shiftKey:c,altKey:d,metaKey:e,ctrlKey:f})}return b}(a)),d.down=d.pressed=d.buttons%2==1||d.touches>0,e=a.timeStamp-b.timeStamp,b.timeStamp=a.timeStamp,b.elapsedTime=b.timeStamp-b.startTime),b._active){let a=b._delta.map(Math.abs);q1.addTo(b._distance,a)}this.axisIntent&&this.axisIntent(a);let[f,g]=b._movement,[h,i]=c.threshold,{_step:j,values:k}=b;if(c.hasCustomTransform?(!1===j[0]&&(j[0]=Math.abs(f)>=h&&k[0]),!1===j[1]&&(j[1]=Math.abs(g)>=i&&k[1])):(!1===j[0]&&(j[0]=Math.abs(f)>=h&&Math.sign(f)*h),!1===j[1]&&(j[1]=Math.abs(g)>=i&&Math.sign(g)*i)),b.intentional=!1!==j[0]||!1!==j[1],!b.intentional)return;let l=[0,0];if(c.hasCustomTransform){let[a,b]=k;l[0]=!1!==j[0]?a-j[0]:0,l[1]=!1!==j[1]?b-j[1]:0}else l[0]=!1!==j[0]?f-j[0]:0,l[1]=!1!==j[1]?g-j[1]:0;this.restrictToAxis&&!b._blocked&&this.restrictToAxis(l);let m=b.offset,n=b._active&&!b._blocked||b.active;n&&(b.first=b._active&&!b.active,b.last=!b._active&&b.active,b.active=d[this.ingKey]=b._active,a&&(b.first&&("bounds"in c&&(b._bounds=rf(c.bounds,b)),this.setup&&this.setup()),b.movement=l,this.computeOffset()));let[o,p]=b.offset,[[q,r],[s,t]]=b._bounds;b.overflow=[o<q?-1:+(o>r),p<s?-1:+(p>t)],b._movementBound[0]=!!b.overflow[0]&&(!1===b._movementBound[0]?b._movement[0]:b._movementBound[0]),b._movementBound[1]=!!b.overflow[1]&&(!1===b._movementBound[1]?b._movement[1]:b._movementBound[1]);let u=b._active&&c.rubberband||[0,0];if(b.offset=function(a,[b,c],[d,e]){let[[f,g],[h,i]]=a;return[q3(b,f,g,d),q3(c,h,i,e)]}(b._bounds,b.offset,u),b.delta=q1.sub(b.offset,m),this.computeMovement(),n&&(!b.last||e>32)){b.delta=q1.sub(b.offset,m);let a=b.delta.map(Math.abs);q1.addTo(b.distance,a),b.direction=b.delta.map(Math.sign),b._direction=b._delta.map(Math.sign),!b.first&&e>0&&(b.velocity=[a[0]/e,a[1]/e],b.timeDelta=e)}}emit(){let a=this.state,b=this.shared,c=this.config;if(a._active||this.clean(),(a._blocked||!a.intentional)&&!a._force&&!c.triggerAllEvents)return;let d=this.handler(q6(q6(q6({},b),a),{},{[this.aliasKey]:a.values}));void 0!==d&&(a.memo=d)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class rj extends ri{constructor(...a){super(...a),q4(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=q1.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=q1.sub(this.state.offset,this.state.lastOffset)}axisIntent(a){let b=this.state,c=this.config;if(!b.axis&&a){let d="object"==typeof c.axisThreshold?c.axisThreshold[rb(a)?"touch":"pointerType"in a?a.pointerType:"mouse"]:c.axisThreshold;b.axis=function([a,b],c){let d=Math.abs(a),e=Math.abs(b);return d>e&&d>c?"x":e>d&&e>c?"y":void 0}(b._movement,d)}b._blocked=(c.lockDirection||!!c.axis)&&!b.axis||!!c.axis&&c.axis!==b.axis}restrictToAxis(a){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":a[1]=0;break;case"y":a[0]=0}}}let rk=a=>a,rl={enabled:(a=!0)=>a,eventOptions:(a,b,c)=>q6(q6({},c.shared.eventOptions),a),preventDefault:(a=!1)=>a,triggerAllEvents:(a=!1)=>a,rubberband(a=0){switch(a){case!0:return[.15,.15];case!1:return[0,0];default:return q1.toVector(a)}},from:a=>"function"==typeof a?a:null!=a?q1.toVector(a):void 0,transform(a,b,c){let d=a||c.shared.transform;return this.hasCustomTransform=!!d,d||rk},threshold:a=>q1.toVector(a,0)},rm=0,rn=q6(q6({},rl),{},{axis(a,b,{axis:c}){if(this.lockDirection="lock"===c,!this.lockDirection)return c},axisThreshold:(a=rm)=>a,bounds(a={}){if("function"==typeof a)return b=>rn.bounds(a(b));if("current"in a)return()=>a.current;if("function"==typeof HTMLElement&&a instanceof HTMLElement)return a;let{left:b=-1/0,right:c=1/0,top:d=-1/0,bottom:e=1/0}=a;return[[b,c],[d,e]]}}),ro={isBrowser:!1,gesture:function(){try{return"constructor"in GestureEvent}catch(a){return!1}}(),touch:!1,touchscreen:!1,pointer:!1,pointerLock:!1},rp=10,rq={mouse:0,touch:0,pen:8};function rr(a){let[b,c]=a.overflow,[d,e]=a._delta,[f,g]=a._direction;(b<0&&d>0&&f<0||b>0&&d<0&&f>0)&&(a._movement[0]=a._movementBound[0]),(c<0&&e>0&&g<0||c>0&&e<0&&g>0)&&(a._movement[1]=a._movementBound[1])}q6(q6({},rn),{},{device(a,b,{pointer:{touch:c=!1,lock:d=!1,mouse:e=!1}={}}){return(this.pointerLock=d&&ro.pointerLock,ro.touch&&c)?"touch":this.pointerLock?"mouse":ro.pointer&&!e?"pointer":ro.touch?"touch":"mouse"},preventScrollAxis(a,b,{preventScroll:c}){if(this.preventScrollDelay="number"==typeof c?c:c||void 0===c&&a?250:void 0,ro.touchscreen&&!1!==c)return a||(void 0!==c?"y":void 0)},pointerCapture(a,b,{pointer:{capture:c=!0,buttons:d=1,keys:e=!0}={}}){return this.pointerButtons=d,this.keys=e,!this.pointerLock&&"pointer"===this.device&&c},threshold(a,b,{filterTaps:c=!1,tapsThreshold:d=3,axis:e}){let f=q1.toVector(a,c?d:+!!e);return this.filterTaps=c,this.tapsThreshold=d,f},swipe({velocity:a=.5,distance:b=50,duration:c=250}={}){return{velocity:this.transform(q1.toVector(a)),distance:this.transform(q1.toVector(b)),duration:c}},delay(a=0){switch(a){case!0:return 180;case!1:return 0;default:return a}},axisThreshold:a=>a?q6(q6({},rq),a):rq,keyboardDisplacement:(a=rp)=>a});let rs=q6(q6({},rl),{},{device(a,b,{shared:c,pointer:{touch:d=!1}={}}){if(c.target&&!ro.touch&&ro.gesture)return"gesture";if(ro.touch&&d)return"touch";if(ro.touchscreen){if(ro.pointer)return"pointer";if(ro.touch)return"touch"}},bounds(a,b,{scaleBounds:c={},angleBounds:d={}}){let e=a=>{let b=rh(rf(c,a),{min:-1/0,max:1/0});return[b.min,b.max]},f=a=>{let b=rh(rf(d,a),{min:-1/0,max:1/0});return[b.min,b.max]};return"function"!=typeof c&&"function"!=typeof d?[e(),f()]:a=>[e(a),f(a)]},threshold(a,b,c){return this.lockDirection="lock"===c.axis,q1.toVector(a,this.lockDirection?[.1,3]:0)},modifierKey:a=>void 0===a?"ctrlKey":a,pinchOnWheel:(a=!0)=>a});q6(q6({},rn),{},{mouseOnly:(a=!0)=>a}),q6(q6({},rn),{},{mouseOnly:(a=!0)=>a});let rt=new Map,ru=new Map,rv={target(a){if(a)return()=>"current"in a?a.current:a},enabled:(a=!0)=>a,window:(a=ro.isBrowser?window:void 0)=>a,eventOptions:({passive:a=!0,capture:b=!1}={})=>({passive:a,capture:b}),transform:a=>a},rw=["target","eventOptions","window","enabled","transform"];function rx(a={},b){let c={};for(let[d,e]of Object.entries(b))switch(typeof e){case"function":c[d]=e.call(c,a[d],d,a);break;case"object":c[d]=rx(a[d],e);break;case"boolean":e&&(c[d]=a[d])}return c}class ry{constructor(a,b){q4(this,"_listeners",new Set),this._ctrl=a,this._gestureKey=b}add(a,b,c,d,e){let f=this._listeners,g=function(a,b=""){let c=q7[a];return a+(c&&c[b]||b)}(b,c),h=q6(q6({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),e);a.addEventListener(g,d,h);let i=()=>{a.removeEventListener(g,d,h),f.delete(i)};return f.add(i),i}clean(){this._listeners.forEach(a=>a()),this._listeners.clear()}}class rz{constructor(){q4(this,"_timeouts",new Map)}add(a,b,c=140,...d){this.remove(a),this._timeouts.set(a,window.setTimeout(b,c,...d))}remove(a){let b=this._timeouts.get(a);b&&window.clearTimeout(b)}clean(){this._timeouts.forEach(a=>void window.clearTimeout(a)),this._timeouts.clear()}}class rA{constructor(a){q4(this,"gestures",new Set),q4(this,"_targetEventStore",new ry(this)),q4(this,"gestureEventStores",{}),q4(this,"gestureTimeoutStores",{}),q4(this,"handlers",{}),q4(this,"config",{}),q4(this,"pointerIds",new Set),q4(this,"touchIds",new Set),q4(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(a,b){b.drag&&rB(a,"drag"),b.wheel&&rB(a,"wheel"),b.scroll&&rB(a,"scroll"),b.move&&rB(a,"move"),b.pinch&&rB(a,"pinch"),b.hover&&rB(a,"hover")}(this,a)}setEventIds(a){if(rb(a))return this.touchIds=new Set(Array.from(a.touches).filter(b=>{var c,d;return b.target===a.currentTarget||(null==(c=a.currentTarget)||null==(d=c.contains)?void 0:d.call(c,b.target))}).map(a=>a.identifier)),this.touchIds;if("pointerId"in a)return"pointerup"===a.type||"pointercancel"===a.type?this.pointerIds.delete(a.pointerId):"pointerdown"===a.type&&this.pointerIds.add(a.pointerId),this.pointerIds}applyHandlers(a,b){this.handlers=a,this.nativeHandlers=b}applyConfig(a,b){this.config=function(a,b,c={}){let{target:d,eventOptions:e,window:f,enabled:g,transform:h}=a,i=function(a,b){if(null==a)return{};var c,d,e=function(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],b.indexOf(c)>=0||(e[c]=a[c]);return e}(a,b);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(a);for(d=0;d<f.length;d++)c=f[d],!(b.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(a,c)&&(e[c]=a[c])}return e}(a,rw);if(c.shared=rx({target:d,eventOptions:e,window:f,enabled:g,transform:h},rv),b){let a=ru.get(b);c[b]=rx(q6({shared:c.shared},i),a)}else for(let a in i){let b=ru.get(a);b&&(c[a]=rx(q6({shared:c.shared},i[a]),b))}return c}(a,b,this.config)}clean(){for(let a of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[a].clean(),this.gestureTimeoutStores[a].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...a){let b,c=this.config.shared,d={};if(!c.target||(b=c.target())){if(c.enabled){for(let c of this.gestures){let e=this.config[c],f=rC(d,e.eventOptions,!!b);e.enabled&&new(rt.get(c))(this,a,c).bind(f)}let e=rC(d,c.eventOptions,!!b);for(let b in this.nativeHandlers)e(b,"",c=>this.nativeHandlers[b](q6(q6({},this.state.shared),{},{event:c,args:a})),void 0,!0)}for(let a in d)d[a]=function(...a){return 0===a.length?rg:1===a.length?a[0]:function(){let b;for(let c of a)b=c.apply(this,arguments)||b;return b}}(...d[a]);if(!b)return d;for(let a in d){let{device:c,capture:e,passive:f}=function(a){let b=a.substring(2).toLowerCase(),c=!!~b.indexOf("passive");c&&(b=b.replace("passive",""));let d=ra.includes(b)?"capturecapture":"capture",e=!!~b.indexOf(d);return e&&(b=b.replace("capture","")),{device:b,capture:e,passive:c}}(a);this._targetEventStore.add(b,c,"",d[a],{capture:e,passive:f})}}}}function rB(a,b){a.gestures.add(b),a.gestureEventStores[b]=new ry(a,b),a.gestureTimeoutStores[b]=new rz}let rC=(a,b,c)=>(d,e,f,g={},h=!1)=>{var i,j;let k=null!=(i=g.capture)?i:b.capture,l=null!=(j=g.passive)?j:b.passive,m=h?d:function(a,b="",c=!1){let d=q7[a],e=d&&d[b]||b;return"on"+q8(a)+q8(e)+(!function(a=!1,b){return a&&!q9.includes(b)}(c,e)?"":"Capture")}(d,e,k);c&&l&&(m+="Passive"),a[m]=a[m]||[],a[m].push(f)},rD=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function rE(a,b,c,d,e,f){if(!a.has(c)||!rt.has(d))return;let g=c+"Start",h=c+"End";e[d]=a=>{let d;return a.first&&g in b&&b[g](a),c in b&&(d=b[c](a)),a.last&&h in b&&b[h](a),d},f[d]=f[d]||{}}a.i(645125),a.i(730972);let rF=/Mac|iPod|iPhone|iPad/.test("node");function rG(a){let{deltaY:b,deltaX:c}=a,d=0;return a.ctrlKey||a.altKey||a.metaKey?d=(Math.abs(b)>10?10*Math.sign(b):b)/100:a.shiftKey&&!rF&&(c=b,b=0),{x:-c,y:-b,z:-d}}let rH=([{key:"wheel",engine:class extends rj{constructor(...a){super(...a),q4(this,"ingKey","wheeling")}wheel(a){this.state._active||this.start(a),this.wheelChange(a),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(a){let b=this.state;b._delta=re(a),q1.addTo(b._movement,b._delta),rr(b),this.compute(a),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(a){a("wheel","",this.wheel.bind(this))}},resolver:rn},{key:"pinch",engine:class extends ri{constructor(...a){super(...a),q4(this,"ingKey","pinching"),q4(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let a=this.state;a._touchIds=[],a.canceled=!1,a.cancel=this.cancel.bind(this),a.turns=0}computeOffset(){let{type:a,movement:b,lastOffset:c}=this.state;"wheel"===a?this.state.offset=q1.add(b,c):this.state.offset=[(1+b[0])*c[0],b[1]+c[1]]}computeMovement(){let{offset:a,lastOffset:b}=this.state;this.state.movement=[a[0]/b[0],a[1]-b[1]]}axisIntent(){let a=this.state,[b,c]=a._movement;if(!a.axis){let d=30*Math.abs(b)-Math.abs(c);d<0?a.axis="angle":d>0&&(a.axis="scale")}}restrictToAxis(a){this.config.lockDirection&&("scale"===this.state.axis?a[1]=0:"angle"===this.state.axis&&(a[0]=0))}cancel(){let a=this.state;a.canceled||setTimeout(()=>{a.canceled=!0,a._active=!1,this.compute(),this.emit()},0)}touchStart(a){this.ctrl.setEventIds(a);let b=this.state,c=this.ctrl.touchIds;if(b._active&&b._touchIds.every(a=>c.has(a))||c.size<2)return;this.start(a),b._touchIds=Array.from(c).slice(0,2);let d=rd(a,b._touchIds);d&&this.pinchStart(a,d)}pointerStart(a){if(null!=a.buttons&&a.buttons%2!=1)return;this.ctrl.setEventIds(a),a.target.setPointerCapture(a.pointerId);let b=this.state,c=b._pointerEvents,d=this.ctrl.pointerIds;if(b._active&&Array.from(c.keys()).every(a=>d.has(a))||(c.size<2&&c.set(a.pointerId,a),b._pointerEvents.size<2))return;this.start(a);let e=rc(...Array.from(c.values()));e&&this.pinchStart(a,e)}pinchStart(a,b){this.state.origin=b.origin,this.computeValues([b.distance,b.angle]),this.computeInitial(),this.compute(a),this.emit()}touchMove(a){if(!this.state._active)return;let b=rd(a,this.state._touchIds);b&&this.pinchMove(a,b)}pointerMove(a){let b=this.state._pointerEvents;if(b.has(a.pointerId)&&b.set(a.pointerId,a),!this.state._active)return;let c=rc(...Array.from(b.values()));c&&this.pinchMove(a,c)}pinchMove(a,b){let c=this.state,d=c._values[1],e=b.angle-d,f=0;Math.abs(e)>270&&(f+=Math.sign(e)),this.computeValues([b.distance,b.angle-360*f]),c.origin=b.origin,c.turns=f,c._movement=[c._values[0]/c._initial[0]-1,c._values[1]-c._initial[1]],this.compute(a),this.emit()}touchEnd(a){this.ctrl.setEventIds(a),this.state._active&&this.state._touchIds.some(a=>!this.ctrl.touchIds.has(a))&&(this.state._active=!1,this.compute(a),this.emit())}pointerEnd(a){let b=this.state;this.ctrl.setEventIds(a);try{a.target.releasePointerCapture(a.pointerId)}catch(a){}b._pointerEvents.has(a.pointerId)&&b._pointerEvents.delete(a.pointerId),b._active&&b._pointerEvents.size<2&&(b._active=!1,this.compute(a),this.emit())}gestureStart(a){a.cancelable&&a.preventDefault();let b=this.state;b._active||(this.start(a),this.computeValues([a.scale,a.rotation]),b.origin=[a.clientX,a.clientY],this.compute(a),this.emit())}gestureMove(a){if(a.cancelable&&a.preventDefault(),!this.state._active)return;let b=this.state;this.computeValues([a.scale,a.rotation]),b.origin=[a.clientX,a.clientY];let c=b._movement;b._movement=[a.scale-1,a.rotation],b._delta=q1.sub(b._movement,c),this.compute(a),this.emit()}gestureEnd(a){this.state._active&&(this.state._active=!1,this.compute(a),this.emit())}wheel(a){let b=this.config.modifierKey;(!b||(Array.isArray(b)?b.find(b=>a[b]):a[b]))&&(this.state._active?this.wheelChange(a):this.wheelStart(a),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(a){this.start(a),this.wheelChange(a)}wheelChange(a){"uv"in a||a.cancelable&&a.preventDefault();let b=this.state;b._delta=[-re(a)[1]/100*b.offset[0],0],q1.addTo(b._movement,b._delta),rr(b),this.state.origin=[a.clientX,a.clientY],this.compute(a),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(a){let b=this.config.device;b&&(a(b,"start",this[b+"Start"].bind(this)),a(b,"change",this[b+"Move"].bind(this)),a(b,"end",this[b+"End"].bind(this)),a(b,"cancel",this[b+"End"].bind(this)),a("lostPointerCapture","",this[b+"End"].bind(this))),this.config.pinchOnWheel&&a("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:rs}].forEach(function(a){rt.set(a.key,a.engine),ru.set(a.key,a.resolver)}),function(a,b){let{handlers:c,nativeHandlers:d,config:e}=function(a,b){let[c,d,e]=function(a){let b={},c={},d=new Set;for(let e in a)rD.test(e)?(d.add(RegExp.lastMatch),c[e]=a[e]):b[e]=a[e];return[c,b,d]}(a),f={};return rE(e,c,"onDrag","drag",f,b),rE(e,c,"onWheel","wheel",f,b),rE(e,c,"onScroll","scroll",f,b),rE(e,c,"onPinch","pinch",f,b),rE(e,c,"onMove","move",f,b),rE(e,c,"onHover","hover",f,b),{handlers:f,config:b,nativeHandlers:d}}(a,b||{});return function(a,b={},c,d){let e=bT.default.useMemo(()=>new rA(a),[]);if(e.applyHandlers(a,d),e.applyConfig(b,c),bT.default.useEffect(e.effect.bind(e)),bT.default.useEffect(()=>e.clean.bind(e),[]),void 0===b.target)return e.bind.bind(e)}(c,e,void 0,d)});function rI(a,b,c){let d=a.getShape(b),e=a.getShapeHandles(d);return{shape:d,handle:e.find(a=>a.id===c)}}let rJ=d3(function({showStroke:a=!0,showVertices:b=!0,showClosestPointOnOutline:c=!0}){let d=jA(),e=d.getZoomLevel(),f=d.getRenderingShapes(),g=d.inputs.getCurrentPagePoint();return(0,bS.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:0x3b9ac9ff,top:0,left:0,overflow:"visible"},children:f.map(f=>{let h=d.getShape(f.id);if("group"===h.type)return null;let i=d.getShapeGeometry(h),j=d.getShapePageTransform(h),k=d.getPointInShapeSpace(h,g),l=i.nearestPoint(k),m=i.distanceToPoint(k,!0),n=Math.abs(m)*e,{vertices:o}=i;return(0,bS.jsxs)("g",{transform:j.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[a&&(0,bS.jsx)("g",{stroke:i.debugColor??"red",opacity:"1",strokeWidth:2/e,fill:"none",children:(0,bS.jsx)(rK,{geometry:i})}),b&&o.map((a,b)=>(0,bS.jsx)("circle",{cx:a.x,cy:a.y,r:2/e,fill:`hsl(${cD(b,[0,o.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/e},`v${b}`)),c&&n<150&&(0,bS.jsx)("line",{x1:l.x,y1:l.y,x2:k.x,y2:k.y,opacity:1-n/150,stroke:m<0?"goldenrod":"dodgerblue",strokeWidth:2/e})]},f.id+"_outline")})})});function rK({geometry:a}){return a instanceof kI?(0,bS.jsx)("g",{stroke:a.debugColor,children:[...a.children,...a.ignoredChildren].map((a,b)=>(0,bS.jsx)(rK,{geometry:a},b))}):(0,bS.jsx)("path",{d:a.toSimpleSvgPath(),stroke:a.debugColor})}function rL(a,b){return b>a.options.collaboratorInactiveTimeoutMs?"inactive":b>a.options.collaboratorIdleTimeoutMs?"idle":"active"}function rM(a,b,c){let{followingUserId:d,highlightedUserIds:e}=a.getInstanceState();switch(c){case"inactive":return d===b.userId||e.includes(b.userId);case"idle":if(b.followingUserId===a.user.getId())return!!(b.chatMessage||e.includes(b.userId));return!0;case"active":return!0}}function rN(a){return(0,b2.default)(a)}function rO(a,b){if(a.size!==b.size)return!1;for(let c of a)if(!b.has(c))return!1;return!0}function rP(){let a=jA();return d8(d5("userIds",()=>rN(a.getCollaborators().map(a=>a.userId)).sort(),{isEqual:(a,b)=>a.join(",")===b.join?.(",")},[a]))}function rQ(a){let b=jA();return d8(`latestPresence:${a}`,()=>b.getCollaborators().find(b=>b.userId===a),[b,a])??null}let rR=d3(function(){return rP().map(a=>(0,bS.jsx)(rS,{collaboratorId:a},a))}),rS=d3(function({collaboratorId:a}){let b=jA(),c=rQ(a),d=function(a,b){let c=(0,bT.useRef)(b?.lastActivityTimestamp??-1),[d,e]=(0,bT.useState)(()=>rL(a,Date.now()-c.current));return(0,bT.useEffect)(()=>{let b=a.timers.setInterval(()=>{e(rL(a,Date.now()-c.current))},a.options.collaboratorCheckIntervalMs);return()=>clearInterval(b)},[a]),b&&(c.current=b.lastActivityTimestamp??1/0),d}(b,c);return c&&c.currentPageId===b.getCurrentPageId()&&rM(b,c,d)?(0,bS.jsx)(rT,{latestPresence:c}):null}),rT=d3(function({latestPresence:a}){let b=jA(),{CollaboratorBrush:c,CollaboratorScribble:d,CollaboratorCursor:e,CollaboratorHint:f,CollaboratorShapeIndicator:g}=q_(),h=b.getZoomLevel(),i=b.getViewportPageBounds(),{userId:j,chatMessage:k,brush:l,scribbles:m,selectedShapeIds:n,userName:o,cursor:p,color:q}=a;if(!p)return null;let r=!(p.x<i.minX-12/h||p.y<i.minY-16/h||p.x>i.maxX-12/h||p.y>i.maxY-16/h);return(0,bS.jsxs)(bS.Fragment,{children:[l&&c?(0,bS.jsx)(c,{className:"tl-collaborator__brush",userId:j,brush:l,color:q,opacity:.1},j+"_brush"):null,r&&e?(0,bS.jsx)(e,{className:"tl-collaborator__cursor",userId:j,point:p,color:q,zoom:h,name:"New User"!==o?o:null,chatMessage:k??""},j+"_cursor"):f?(0,bS.jsx)(f,{className:"tl-collaborator__cursor-hint",userId:j,point:p,color:q,zoom:h,viewport:i},j+"_cursor_hint"):null,d&&m.length?(0,bS.jsx)(bS.Fragment,{children:m.map(a=>(0,bS.jsx)(d,{className:"tl-collaborator__scribble",userId:j,scribble:a,color:q,zoom:h,opacity:"laser"===a.color?.5:.1},j+"_scribble_"+a.id))}):null,g&&n.filter(a=>{if(b.isShapeHidden(a))return!1;let c=b.getShape(a);return!!c&&b.getShapeUtil(c).useLegacyIndicator()}).map(a=>(0,bS.jsx)(g,{className:"tl-collaborator__shape-indicator",userId:j,shapeId:a,color:q,opacity:.5},j+"_"+a))]})});function rU(){let a=jA(),b=d8("is menu open",()=>a.menus.hasAnyOpenMenus(),[a]),[c,d]=(0,bT.useState)(!1),e=jD(),f=(0,bT.useRef)({isDown:!1,isDragging:!1,start:new iK}),g=(0,bT.useCallback)(b=>{0===b.button&&(d(!0),f.current={isDown:!0,isDragging:!1,start:new iK(b.clientX,b.clientY)},h.current=!1),a.menus.clearOpenMenus()},[a]),h=(0,bT.useRef)(!1),i=(0,bT.useCallback)(b=>{if(!f.current.isDown)return;let{x:c,y:d}=f.current.start;!h.current&&iK.Dist2(f.current.start,new iK(b.clientX,b.clientY))>a.options.dragDistanceSquared&&(h.current=!0,f.current={...f.current,isDown:!0,isDragging:!0},e.onPointerDown?.({...b,clientX:c,clientY:d,button:0})),h.current&&a.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...js(a,b)})},[e,a]),j=(0,bT.useCallback)(a=>{e.onPointerUp?.(a),d(!1),f.current={isDown:!1,isDragging:!1,start:new iK(a.clientX,a.clientY)},h.current=!1},[e]);return(b||c)&&(0,bS.jsx)("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...e,onPointerDown:g,onPointerMove:i,onPointerUp:j})}function rV(a,b){if(a.size!==b.size)return!1;for(let c of a)if(!b.has(c))return!1;return!0}function rW(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function rX(a,b){return rV(a.idsToDisplay,b.idsToDisplay)&&rV(a.renderingShapeIds,b.renderingShapeIds)&&rW(a.hintingShapeIds,b.hintingShapeIds)&&function(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c].color!==b[c].color||!rW(a[c].shapeIds,b[c].shapeIds))return!1;return!0}(a.collaboratorIndicators,b.collaboratorIndicators)}let rY=fe("indicatorPath",(a,b)=>a.getShapeUtil(b).getIndicatorPath(b));function rZ(a,b,c,d){if(!d.has(c))return!1;let e=b.getShape(c);if(!e||e.isLocked)return!1;let f=b.getShapePageTransform(e);if(!f)return!1;let g=rY.get(b,e.id);return!!g&&(a.save(),a.transform(f.a,f.b,f.c,f.d,f.e,f.f),function(a,b){if(b instanceof Path2D)a.stroke(b);else{let{path:c,clipPath:d,additionalPaths:e}=b;if(d?(a.save(),a.clip(d,"evenodd"),a.stroke(c),a.restore()):a.stroke(c),e)for(let b of e)a.stroke(b)}}(a,g),a.restore(),!0)}let r$=(0,bT.memo)(function(){let a,b,c=jA(),d=(0,bT.useRef)(null),e=(0,bT.useRef)(null),f=pC();(0,bT.useEffect)(()=>{let a=c.timers.setTimeout(()=>{e.current=null},0);return()=>clearTimeout(a)},[f,c]);let g=(a=d4("peerIdsTime",Date.now()),b=jA(),(0,bT.useEffect)(()=>{let c=b.timers.setInterval(()=>{a.set(Date.now())},b.options.collaboratorCheckIntervalMs);return()=>clearInterval(c)},[b,a]),d5("activePeerIds",()=>{let c=a.get();return new Set(b.getCollaborators().filter(a=>{let d=rL(b,Math.max(0,c-(a.lastActivityTimestamp??1/0)));return rM(b,a,d)}).map(a=>a.userId))},{isEqual:rO},[b])),h=d5("indicator render data",()=>{let a=new Set(c.getRenderingShapes().map(a=>a.id)),b=new Set,d=c.getInstanceState(),e=d.isChangingStyle,f=c.isInAny("select.idle","select.editing_shape"),h=c.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(!e&&(f||h)){for(let a of c.getSelectedShapeIds())b.add(a);if(f&&d.isHoveringCanvas&&!d.isCoarsePointer){let a=c.getHoveredShapeId();a&&b.add(a)}}let i=b3(c.getHintingShapeIds()),j=[],k=c.getCurrentPageId(),l=g.get(),m=c.getCollaborators();for(let b of l.values()){let d=m.find(a=>a.userId===b);if(!d||d.currentPageId!==k)continue;let e=d.selectedShapeIds.filter(b=>a.has(b)&&!c.isShapeHidden(b));e.length>0&&j.push({color:d.color,shapeIds:e})}return{idsToDisplay:b,renderingShapeIds:a,hintingShapeIds:i,collaboratorIndicators:j}},{isEqual:rX},[c,g]);return d6("canvas indicators render",()=>{let a=d.current;if(!a)return;let b=a.getContext("2d");if(!b)return;let{idsToDisplay:f,renderingShapeIds:g,hintingShapeIds:i,collaboratorIndicators:j}=h.get(),{w:k,h:l}=c.getViewportScreenBounds(),m=window.devicePixelRatio||1,{x:n,y:o,z:p}=c.getCamera(),q=Math.ceil(k*m),r=Math.ceil(l*m);for(let d of((a.width!==q||a.height!==r)&&(a.width=q,a.height=r,a.style.width=`${k}px`,a.style.height=`${l}px`),b.resetTransform(),b.clearRect(0,0,a.width,a.height),b.scale(m,m),b.scale(p,p),b.translate(n,o),b.lineCap="round",b.lineJoin="round",b.lineWidth=1.5/p,j))for(let a of(b.strokeStyle=d.color,b.globalAlpha=.7,d.shapeIds))rZ(b,c,a,g);for(let d of(b.globalAlpha=1,e.current||(e.current=getComputedStyle(a).getPropertyValue("--tl-color-selected")),b.strokeStyle=e.current,b.lineWidth=1.5/p,f))rZ(b,c,d,g);if(i.length>0)for(let a of(b.lineWidth=2.5/p,i))rZ(b,c,a,g)},[c,h]),(0,bS.jsx)("canvas",{ref:d,className:"tl-canvas-indicators"})});function r_({className:a}){let b,c,d,e,f,g,h,i,j=jA(),{SelectionBackground:k,Background:l,SvgDefs:m,ShapeIndicators:n}=q_(),p=(0,bT.useRef)(null),q=(0,bT.useRef)(null),r=(0,bT.useRef)(null),s=jG();b=jA(),(0,bT.useLayoutEffect)(()=>{let a=(0,b1.default)(()=>{p.current&&b.updateViewportScreenBounds(p.current)},200,{trailing:!0}),c=b.timers.setInterval(a,1e3);window.addEventListener("resize",a);let d=new ResizeObserver(b=>{b[0].contentRect&&a()}),e=p.current,f=null;return e&&(d.observe(e),(f=(a=>{let b=a.parentElement;for(;b&&b!==document.body;){let{overflowY:a}=window.getComputedStyle(b);if(b.scrollHeight>b.clientHeight&&("auto"===a||"scroll"===a||"overlay"===a))return b;b=b.parentElement}return document})(e)).addEventListener("scroll",a)),()=>{clearInterval(c),window.removeEventListener("resize",a),d.disconnect(),f?.removeEventListener("scroll",a),a.cancel()}},[b,p]),c=jA(),d=jG(),e=d8("isEditing",()=>c.getEditingShapeId(),[c]),f=d8("isFocused",()=>c.getIsFocused(),[c]),(0,bT.useEffect)(()=>{if(d)return d.addEventListener("dragover",a),d.addEventListener("drop",a),()=>{d.removeEventListener("dragover",a),d.removeEventListener("drop",a)};function a(a){if(a.isSpecialRedispatchedEvent)return;jm(a),a.stopPropagation();let b=d.querySelector(".tl-canvas");if(!b)return;let c=new DragEvent(a.type,a);c.isSpecialRedispatchedEvent=!0,b.dispatchEvent(c)}},[d]),(0,bT.useEffect)(()=>{},[c]),(0,bT.useEffect)(()=>{if(!f)return;let a=a=>{if(a.altKey&&(c.isIn("zoom")||!c.getPath().endsWith(".idle"))&&!jH(c)&&jm(a),c.wasEventAlreadyHandled(a))return;c.markEventAsHandled(a);let b=!!c.getSelectedShapeIds().length;switch(a.key){case"=":case"-":case"0":if(a.metaKey||a.ctrlKey)return void jm(a);break;case"Tab":if(jH(c))return;b&&!e&&jm(a);break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(jH(c))return;b&&(a.metaKey||a.ctrlKey)&&jm(a);break;case",":return;case"Escape":if((c.getEditingShape()||c.getSelectedShapeIds().length>0)&&jm(a),c.menus.getOpenMenus().length>0)return;c.inputs.keys.has("Escape")||(c.inputs.keys.add("Escape"),c.cancel(),d.focus());return;default:if(jH(c))return}let f={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:jr(a)};c.dispatch(f)},b=a=>{if(c.wasEventAlreadyHandled(a)||(c.markEventAsHandled(a),jH(c)||","===a.key))return;let b={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:jr(a)};c.dispatch(b)};function g(a){if(d.contains(a.target)){let b=a.touches[0].pageX,d=a.touches[0].radiusX||0;(b-d<10||b+d>c.getViewportScreenBounds().width-10)&&(a.target?.tagName==="BUTTON"&&a.target?.click(),jm(a))}}let h=a=>{d.contains(a.target)&&(a.ctrlKey||a.metaKey)&&jm(a)};return d.addEventListener("touchstart",g,{passive:!1}),d.addEventListener("wheel",h,{passive:!1}),document.addEventListener("gesturestart",jm),document.addEventListener("gesturechange",jm),document.addEventListener("gestureend",jm),d.addEventListener("keydown",a),d.addEventListener("keyup",b),()=>{d.removeEventListener("touchstart",g),d.removeEventListener("wheel",h),document.removeEventListener("gesturestart",jm),document.removeEventListener("gesturechange",jm),document.removeEventListener("gestureend",jm),d.removeEventListener("keydown",a),d.removeEventListener("keyup",b)}},[c,d,f,e]),d7("coarse pointer change",()=>{let a=jc.get().isCoarsePointer;a!==dU(()=>g.getInstanceState().isCoarsePointer)&&g.updateInstanceState({isCoarsePointer:a})},[g=jA()]),h=jA(),rH(bT.useMemo(()=>{let a="not sure",b=1,c=1,d=0,e=new iK,f=new iK;return{onWheel:({event:b})=>{var c;if(!h.getInstanceState().isFocused||(a="not sure",c=Date.now(),void 0===o?(o=c,!1):c-o>120&&c-o<160?(o=c,!0):(o=c,!1)))return;let d=h.getEditingShapeId();if(d){let a=h.getShape(d);if(a&&h.getShapeUtil(a).canScroll(a)){let a=h.getShapePageBounds(d);if(a?.containsPoint(h.inputs.getCurrentPagePoint()))return}}jm(b),b.stopPropagation();let e=rG(b);if(0===e.x&&0===e.y)return;let f={type:"wheel",name:"wheel",delta:e,point:new iK(b.clientX,b.clientY),shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:jr(b)};h.dispatch(f)},onPinchStart:d=>{let g=p.current;a="not sure";let{event:i,origin:j,da:k}=d;i instanceof WheelEvent||(i.target===g||g?.contains(i.target))&&(f.x=j[0],f.y=j[1],e.x=j[0],e.y=j[1],b=k[0],c=h.getZoomLevel(),h.dispatch({type:"pinch",name:"pinch_start",point:{x:j[0],y:j[1],z:h.getZoomLevel()},delta:{x:0,y:0},shiftKey:i.shiftKey,altKey:i.altKey,ctrlKey:i.metaKey||i.ctrlKey,metaKey:i.metaKey,accelKey:jr(i)}))},onPinchEnd:b=>{let c=p.current,{event:d,origin:e,offset:f}=b;if(d instanceof WheelEvent||!(d.target===c||c?.contains(d.target)))return;let g=f[0]**h.getCameraOptions().zoomSpeed;a="not sure",h.timers.requestAnimationFrame(()=>{h.dispatch({type:"pinch",name:"pinch_end",point:{x:e[0],y:e[1],z:g},delta:{x:e[0],y:e[1]},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:jr(d)})})},onPinch:g=>{let i=p.current,{event:j,origin:k,offset:l,da:m}=g;if(j instanceof WheelEvent||!(j.target===i||i?.contains(j.target)))return;let n="gesturechange"===g.type||"gestureend"===g.type;d=m[0];let o=k[0]-f.x,q=k[1]-f.y;switch(f.x=k[0],f.y=k[1],(c=>{if(c&&(a="zooming"),"zooming"===a)return;let g=Math.abs(d-b),h=iK.Dist(e,f);switch(a){case"not sure":g>24?a="zooming":h>16&&(a="panning");break;case"panning":g>64&&(a="zooming")}})(n),a){case"zooming":{let a=l[0]**h.getCameraOptions().zoomSpeed;h.dispatch({type:"pinch",name:"pinch",point:{x:k[0],y:k[1],z:a},delta:{x:o,y:q},shiftKey:j.shiftKey,altKey:j.altKey,ctrlKey:j.metaKey||j.ctrlKey,metaKey:j.metaKey,accelKey:jr(j)});break}case"panning":h.dispatch({type:"pinch",name:"pinch",point:{x:k[0],y:k[1],z:c},delta:{x:o,y:q},shiftKey:j.shiftKey,altKey:j.altKey,ctrlKey:j.metaKey||j.ctrlKey,metaKey:j.metaKey,accelKey:jr(j)})}}}},[h,p]),{target:p,eventOptions:{passive:!1},pinch:{from:()=>{let{zoomSpeed:a}=h.getCameraOptions();return[h.getZoomLevel()**(1/a),0]},scaleBounds:()=>{let a=h.getBaseZoom(),{zoomSteps:b,zoomSpeed:c}=h.getCameraOptions(),d=b[0]*a,e=b[b.length-1]*a;return{max:e**(1/c),min:d**(1/c)}}}}),i=jA(),(0,bT.useEffect)(()=>{let a=p.current;if(!a)return;let b=a=>{if(a instanceof PointerEvent&&"pen"===a.pointerType){i.markEventAsHandled(a);let{target:b}=a;q0.includes(b.tagName?.toLocaleLowerCase())||b.isContentEditable||i.isIn("select.editing_shape")||jm(a)}};return a.addEventListener("touchstart",b),a.addEventListener("touchend",b),()=>{a.removeEventListener("touchstart",b),a.removeEventListener("touchend",b)}},[i,p]);let t=(0,bT.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});d6("position layers",function(){let{x:a,y:b,z:c}=j.getCamera();if(t.current.allowTextOutline,t.current.allowTextOutline&&c<j.options.textShadowLod!==t.current.lodDisableTextOutline){let a=c<j.options.textShadowLod;s.style.setProperty("--tl-text-outline",a?"none":"var(--tl-text-outline-reference)"),t.current.lodDisableTextOutline=a}let d=c>=1?cD(c,[1,8],[.125,.5],!0):cD(c,[.1,1],[-2,.125],!0),e=`scale(${i5(c)}) translate(${i5(a+d)}px,${i5(b+d)}px)`;jp(q.current,"transform",e),jp(r.current,"transform",e)},[j,s]);let u=jD(),v=d8("shapeSvgDefs",()=>{let a=new Map;for(let b of cH(j.shapeUtils)){if(!b)return;for(let{key:c,component:d}of b.getCanvasSvgDefs())a.has(c)||a.set(c,(0,bS.jsx)(d,{},c))}return[...a.values()]},[j]),w=d8("debug_shapes",()=>ji.hideShapes.get(),[ji]),y=d8("debug_svg",()=>ji.debugSvg.get(),[ji]),z=d8("debug_geometry",()=>ji.debugGeometry.get(),[ji]),A=d8("isEditingAnything",()=>null!==j.getEditingShapeId(),[j]),B=d8("isSelectingAnything",()=>!!j.getSelectedShapeIds().length,[j]);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)("div",{ref:p,draggable:!1,"data-iseditinganything":A,"data-isselectinganything":B,className:(0,jb.default)("tl-canvas",a),"data-testid":"canvas",...u,children:[(0,bS.jsx)("svg",{className:"tl-svg-context","aria-hidden":"true",children:(0,bS.jsxs)("defs",{children:[v,(0,bS.jsx)(se,{}),(0,bS.jsx)(sf,{}),m&&(0,bS.jsx)(m,{})]})}),l&&(0,bS.jsx)("div",{className:"tl-background__wrapper",children:(0,bS.jsx)(l,{})}),(0,bS.jsx)(r1,{}),(0,bS.jsxs)("div",{ref:q,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,bS.jsx)(sj,{}),k&&(0,bS.jsx)(si,{}),w?null:y?(0,bS.jsx)(sa,{}):(0,bS.jsx)(sc,{})]}),(0,bS.jsxs)("div",{className:"tl-overlays",children:[(0,bS.jsx)(r$,{}),(0,bS.jsxs)("div",{ref:r,className:"tl-html-layer",children:[z?(0,bS.jsx)(rJ,{}):null,(0,bS.jsx)(r3,{}),(0,bS.jsx)(r2,{}),(0,bS.jsx)(r4,{}),n&&(0,bS.jsx)(n,{}),(0,bS.jsx)(sd,{}),(0,bS.jsx)(r5,{}),(0,bS.jsx)(sh,{}),(0,bS.jsx)(r6,{}),(0,bS.jsx)(r9,{}),(0,bS.jsx)(rR,{})]})]}),(0,bS.jsx)(sk,{})]}),(0,bS.jsx)("div",{className:"tl-canvas__in-front",onPointerDown:j.markEventAsHandled,onPointerUp:j.markEventAsHandled,onTouchStart:j.markEventAsHandled,onTouchEnd:j.markEventAsHandled,children:(0,bS.jsx)(r0,{})}),(0,bS.jsx)(rU,{})]})}function r0(){let{InFrontOfTheCanvas:a}=q_();return a?(0,bS.jsx)(a,{}):null}function r1(){let a=jA(),b=d8("gridSize",()=>a.getDocumentSettings().gridSize,[a]),{x:c,y:d,z:e}=d8("camera",()=>a.getCamera(),[a]),f=d8("isGridMode",()=>a.getInstanceState().isGridMode,[a]),{Grid:g}=q_();return g&&f?(0,bS.jsx)(g,{x:c,y:d,z:e,size:b}):null}function r2(){let a=jA(),b=d8("scribbles",()=>a.getInstanceState().scribbles,[a]),c=d8("zoomLevel",()=>a.getEfficientZoomLevel(),[a]),{Scribble:d}=q_();return d&&b.length?b.map(a=>(0,bS.jsx)(d,{className:"tl-user-scribble",scribble:a,zoom:c},a.id)):null}function r3(){let a=jA(),b=d8("brush",()=>a.getInstanceState().brush,[a]),{Brush:c}=q_();return c&&b?(0,bS.jsx)(c,{className:"tl-user-brush",brush:b}):null}function r4(){let a=jA(),b=d8("zoomBrush",()=>a.getInstanceState().zoomBrush,[a]),{ZoomBrush:c}=q_();return c&&b?(0,bS.jsx)(c,{className:"tl-user-brush tl-zoom-brush",brush:b}):null}function r5(){let a=jA(),b=d8("snapLines",()=>a.snaps.getIndicators(),[a]),c=d8("zoomLevel",()=>a.getEfficientZoomLevel(),[a]),{SnapIndicator:d}=q_();return d&&b.length>0?b.map(a=>(0,bS.jsx)(d,{className:"tl-user-snapline",line:a,zoom:c},a.id)):null}function r6(){let a=jA(),b=d8("handles shapeIdWithHandles",()=>{let{isReadonly:b,isChangingStyle:c}=a.getInstanceState();if(b||c)return!1;let d=a.getOnlySelectedShape();return!!d&&!!a.getShapeHandles(d)&&d.id},[a]);return b?(0,bS.jsx)(r7,{shapeId:b}):null}function r7({shapeId:a}){let b=jA(),{Handles:c}=q_(),d=d8("zoomLevel",()=>b.getEfficientZoomLevel(),[b]),e=d8("coarse pointer",()=>b.getInstanceState().isCoarsePointer,[b]),f=d8("handles transform",()=>b.getShapePageTransform(a),[b,a]),g=d8("handles",()=>{let c=b.getShapeHandles(a);if(!c)return null;let f=(e?b.options.coarseHandleRadius:b.options.handleRadius)/d*2;return c.filter(a=>"virtual"!==a.type||!c.some(b=>b!==a&&"vertex"===b.type&&iK.Dist(a,b)<f)).sort(a=>"vertex"===a.type?1:-1)},[b,d,e,a]),h=d8("isHidden",()=>b.isShapeHidden(a),[b,a]);return c&&g&&f&&!h?(0,bS.jsx)(c,{children:(0,bS.jsx)("g",{transform:ku.toCssString(f),children:g.map(b=>(0,bS.jsx)(r8,{shapeId:a,handle:b,zoom:d,isCoarse:e},b.id))})}):null}function r8({shapeId:a,handle:b,zoom:c,isCoarse:d}){var e;let f,g=(e=b.id,f=jA(),bT.useMemo(()=>{let b,c;return{onPointerDown:b=>{if(f.wasEventAlreadyHandled(b))return;jn(jl(b.currentTarget),b);let{shape:c,handle:d}=rI(f,a,e);d&&f.dispatch({type:"pointer",target:"handle",handle:d,shape:c,name:"pointer_down",...js(f,b)})},onPointerMove:d=>{if(f.wasEventAlreadyHandled(d)||d.clientX===b&&d.clientY===c)return;b=d.clientX,c=d.clientY;let{shape:g,handle:h}=rI(f,a,e);h&&f.dispatch({type:"pointer",target:"handle",handle:h,shape:g,name:"pointer_move",...js(f,d)})},onPointerUp:b=>{if(f.wasEventAlreadyHandled(b))return;jo(jl(b.currentTarget),b);let{shape:c,handle:d}=rI(f,a,e);d&&f.dispatch({type:"pointer",target:"handle",handle:d,shape:c,name:"pointer_up",...js(f,b)})}}},[f,a,e])),{Handle:h}=q_();return h?(0,bS.jsx)("g",{role:"button","aria-label":b.label||"handle",transform:`translate(${b.x}, ${b.y})`,...g,children:(0,bS.jsx)(h,{shapeId:a,handle:b,zoom:c,isCoarse:d})}):null}function r9(){let{Overlays:a}=q_();return a?(0,bS.jsx)("div",{className:"tl-custom-overlays tl-overlays__item",children:(0,bS.jsx)(a,{})}):null}function sa(){let a=jA();return d8("rendering shapes",()=>a.getRenderingShapes(),[a]).map(a=>(0,bS.jsxs)(bT.Fragment,{children:[(0,bS.jsx)(lM,{...a}),(0,bS.jsx)(sg,{id:a.id,mode:"iframe"})]},a.id+"_fragment"))}function sb(){let a=jA(),{updateCulling:b}=lK();return d6("update shape culling",()=>{b(a.getCulledShapes())},[a,b]),null}function sc(){let a=jA(),b=d8("rendering shapes",()=>a.getRenderingShapes(),[a]);return(0,bS.jsxs)(lJ,{children:[b.map(a=>(0,bS.jsx)(lM,{...a},a.id+"_shape")),(0,bS.jsx)(sb,{}),!1]})}function sd(){let a=jA(),{ShapeIndicator:b}=q_(),c=d8("hinting shape ids without canvas indicator",()=>b3(a.getHintingShapeIds()).filter(b=>{let c=a.getShape(b);return!!c&&a.getShapeUtil(c).useLegacyIndicator()}),[a]);return c.length&&b?c.map(a=>(0,bS.jsx)(b,{className:"tl-user-indicator__hint",shapeId:a},a+"_hinting")):null}function se(){return(0,bS.jsxs)("g",{id:jv("cursor"),children:[(0,bS.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,bS.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,bS.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,bS.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,bS.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,bS.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,bS.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,bS.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,bS.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function sf(){let a=jv("cursor_hint");return(0,bS.jsx)("path",{id:a,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function sg({id:a,mode:b}){let c=jA(),[d,e]=(0,bT.useState)(null),f=d8("is in root",()=>{let b=c.getShape(a);return b?.parentId===c.getCurrentPageId()},[c,a]);return((0,bT.useEffect)(()=>{if(!f)return;let b=null,d=dA("shape to svg",async()=>{let d=Math.random();b=d;let f=10*!c.isShapeOfType(a,"frame"),g=c.getShapePageBounds(a);if(!g)return;g=g.clone().expandBy(f);let h=await c.getSvgString([a],{padding:f});b===d&&h&&e({src:`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`,bounds:g})});return()=>{b=null,d()}},[c,a,f]),f&&d)?"iframe"===b?(0,bS.jsx)("iframe",{src:d.src,width:d.bounds.width,height:d.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${d.bounds.x}px, ${d.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):(0,bS.jsx)("img",{src:d.src,width:d.bounds.width,height:d.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${d.bounds.x}px, ${d.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function sh(){let a=jA(),b=d8("selection rotation",function(){return a.getSelectionRotation()},[a]),c=d8("selection bounds",()=>a.getSelectionRotatedPageBounds(),[a]),{SelectionForeground:d}=q_();return c&&d?(0,bS.jsx)(d,{bounds:c,rotation:b}):null}function si(){let a=jA(),b=d8("selection rotation",()=>a.getSelectionRotation(),[a]),c=d8("selection bounds",()=>a.getSelectionRotatedPageBounds(),[a]),{SelectionBackground:d}=q_();return c&&d?(0,bS.jsx)(d,{bounds:c,rotation:b}):null}function sj(){let{OnTheCanvas:a}=q_();return a?(0,bS.jsx)(a,{}):null}function sk(){let a=jA(),b=d8("camera state",()=>a.getCameraState(),[a]);return(0,bS.jsx)("div",{className:(0,jb.default)("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===b})})}function sl({children:a,className:b="",...c}){return(0,bS.jsx)("div",{...c,className:(0,jb.default)("tl-html-container",b),children:a})}class sm{constructor(a){this.editor=a}static props;static migrations;static type}function sn(a,b,c={}){let{newPoint:d,handle:e,scaleX:f,scaleY:g}=b,{minWidth:h=1,maxWidth:i=1/0,minHeight:j=1,maxHeight:k=1/0}=c,l=a.props.w*f,m=a.props.h*g,n=new iK(0,0);if(l>0){if(l<h){switch(e){case"top_left":case"left":case"bottom_left":n.x=l-h;break;case"top":case"bottom":n.x=(l-h)/2;break;default:n.x=0}l=h}}else if(n.x=l,(l=-l)<h){switch(e){case"top_left":case"left":case"bottom_left":n.x=-l;break;default:n.x=-h}l=h}if(m>0){if(m<j){switch(e){case"top_left":case"top":case"top_right":n.y=m-j;break;case"right":case"left":n.y=(m-j)/2;break;default:n.y=0}m=j}}else if(n.y=m,(m=-m)<j){switch(e){case"top_left":case"top":case"top_right":n.y=-m;break;default:n.y=-j}m=j}let{x:o,y:p}=n.rot(a.rotation).add(d);return{...a,x:o,y:p,props:{w:Math.min(i,l),h:Math.min(k,m)}}}class so extends kO{getGeometry(a){return new kM({width:a.props.w,height:a.props.h,isFilled:!0})}onResize(a,b){return sn(a,b)}getHandleSnapGeometry(a){return{points:this.getGeometry(a).bounds.cornersAndCenter}}getInterpolatedProps(a,b,c){var d,e;return{...b.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}}function sp(a,{initialBounds:b,scaleX:c,scaleY:d,newPoint:e,handle:f}){let g;switch(f){case"bottom_left":case"bottom_right":case"top_left":case"top_right":g=Math.max(.01,Math.max(Math.abs(c),Math.abs(d)));break;case"left":case"right":g=Math.max(.01,Math.abs(c));break;case"bottom":case"top":g=Math.max(.01,Math.abs(d));break;default:throw cc(f)}let h=new iK(0,0);c<0&&(h.x=-(b.width*g)),d<0&&(h.y=-(b.height*g));let{x:i,y:j}=iK.Add(e,h.rot(a.rotation));return{x:i,y:j,props:{scale:g*a.props.scale}}}class sq extends pd{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class sr extends pd{static id="pointing";onPointerMove(a){let{editor:b}=this;if(b.inputs.getIsDragging()){let c=b.inputs.getOriginPagePoint(),d=this.parent.shapeType,e=gi(),f=b.markHistoryStoppingPoint(`creating_box:${e}`),g=ss(c,b);if(this.editor.createShapes([{id:e,type:d,x:g.x,y:g.y,props:{w:1,h:1}}]),!b.getShape(e))return void this.cancel();b.select(e);let h=this.parent;this.editor.setCurrentTool("select.resizing",{...a,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:f,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:h.onCreate?a=>h.onCreate?.(a):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let a=this.editor.inputs.getOriginPagePoint(),b=this.parent.shapeType,c=gi();this.editor.markHistoryStoppingPoint(`creating_box:${c}`),this.editor.createShapes([{id:c,type:b,x:a.x,y:a.y}]);let d=this.editor.getShape(c);if(!d)return void this.cancel();let{w:e,h:f}=d.props,g=new iK(e/2,f/2),h=this.editor.getShapeParentTransform(d);h&&g.rot(-h.rotation());let i=1;this.editor.user.getIsDynamicResizeMode()&&(e*=i=1/this.editor.getZoomLevel(),f*=i,g.mul(i));let j=dk(d),k=ss(new iK(d.x-g.x,d.y-g.y),this.editor);j.x=k.x,j.y=k.y,j.props.w=e,j.props.h=f,"scale"in d.props&&(j.props.scale=i),this.editor.updateShape(j),this.editor.setSelectedShapes([c]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}function ss(a,b){let c=b.getInstanceState().isGridMode,d=b.getDocumentSettings().gridSize;return c?a.clone().snapToGrid(d):a.clone()}class st extends pd{static id="box";static initial="idle";static children(){return[sq,sr]}}function su(a){let b=jA();return d8("isEditing",()=>b.getEditingShapeId()===a,[b,a])}function sv(a){let b=jA();return(0,bT.useMemo)(function(){let c,d;return{onPointerDown:c=>{if(b.wasEventAlreadyHandled(c))return;if(2===c.button)return void b.dispatch({type:"pointer",target:"selection",handle:a,name:"right_click",...js(b,c)});if(0!==c.button)return;let d=jl(c.currentTarget);jn(d,c),d.addEventListener("pointerup",function a(){d.removeEventListener("pointerup",a),jo(d,c)}),b.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:a,...js(b,c)}),b.markEventAsHandled(c)},onPointerMove:function(e){b.wasEventAlreadyHandled(e)||0!==e.button||(e.clientX!==c||e.clientY!==d)&&(c=e.clientX,d=e.clientY,b.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:a,...js(b,e)}))},onPointerUp:c=>{b.wasEventAlreadyHandled(c)||0===c.button&&b.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:a,...js(b,c)})}}},[b,a])}function sw(a,b=20){return Math.max(8,Math.ceil(a/b))}class sx extends kG{_center;_radius;_start;_end;_largeArcFlag;_sweepFlag;_measure;_angleStart;_angleEnd;constructor(a){super({...a,isFilled:!1,isClosed:!1});const{center:b,sweepFlag:c,largeArcFlag:d,start:e,end:f}=a;if(e.equals(f))throw Error("Arc must have different start and end points.");this._angleStart=iK.Angle(b,e),this._angleEnd=iK.Angle(b,f),this._radius=iK.Dist(b,e),this._measure=function(a,b,c,d){let e=(b-a)%iQ*2%iQ-(b-a)%iQ;return d?(iQ-Math.abs(e))*(c?1:-1):e}(this._angleStart,this._angleEnd,c,d),this._start=e,this._end=f,this._sweepFlag=c,this._largeArcFlag=d,this._center=b}nearestPoint(a){let b,c,{_center:d,_measure:e,_radius:f,_angleEnd:g,_angleStart:h,_start:i,_end:j}=this,k=i8(e,h,g,d.angle(a));if(k<=0)return i;if(k>=1)return j;let l=iK.Sub(a,d).uni().mul(f).add(d),m=1/0;for(let d of[i,j,l])(c=iK.Dist2(a,d))<m&&(b=d,m=c);if(!b)throw Error("nearest point not found");return b}hitTestLineSegment(a,b){let{_center:c,_radius:d,_measure:e,_angleStart:f,_angleEnd:g}=this,h=kw(a,b,c,d);return null!==h&&h.some(a=>{let b=i8(e,f,g,c.angle(a));return b>=0&&b<=1})}getVertices(){let{_center:a,_measure:b,length:c,_radius:d,_angleStart:e}=this,f=[];for(let g=0,h=sw(Math.abs(c));g<h+1;g++){let c=e+g/h*b;f.push(i0(a,d,c))}return f}getSvgPathData(a=!0){let{_start:b,_end:c,_radius:d,_largeArcFlag:e,_sweepFlag:f}=this;return`${a?`M${b.toFixed()}`:""} A${d} ${d} 0 ${e} ${f} ${c.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}}class sy extends kG{constructor(a){super({isClosed:!0,...a}),this.config=a;const{x:b=0,y:c=0,radius:d}=a;this._x=b,this._y=c,this._center=new iK(d+b,d+c),this._radius=d}_center;_radius;_x;_y;getBounds(){return new kt(this._x,this._y,2*this._radius,2*this._radius)}getVertices(){let{_center:a,_radius:b}=this,c=[];for(let d=0,e=sw(iQ*b);d<e;d++){let f=d/e*iQ;c.push(i0(a,b,f))}return c}nearestPoint(a){let{_center:b,_radius:c}=this;return b.equals(a)?iK.AddXY(b,c,0):iK.Sub(a,b).uni().mul(c).add(b)}hitTestLineSegment(a,b,c=0){let{_center:d,_radius:e}=this;return null!==kw(a,b,d,e+c)}getSvgPathData(){let{_center:a,_radius:b}=this;return`M${a.x+b},${a.y} a${b},${b} 0 1,0 ${2*b},0a${b},${b} 0 1,0 -${2*b},0`}}class sz extends kK{_a;_b;_c;_d;_resolution;constructor(a){const{start:b,cp1:c,cp2:d,end:e}=a;super({...a,points:[b,e]}),this._a=b,this._b=c,this._c=d,this._d=e,this._resolution=a.resolution??10}getVertices(){let a=[],{_a:b,_b:c,_c:d,_d:e}=this;for(let f=0,g=this._resolution;f<=g;f++){let h=f/g;a.push(new iK((1-h)*(1-h)*(1-h)*b.x+(1-h)*(1-h)*3*h*c.x+3*(1-h)*(h*h)*d.x+h*h*h*e.x,(1-h)*(1-h)*(1-h)*b.y+(1-h)*(1-h)*3*h*c.y+3*(1-h)*(h*h)*d.y+h*h*h*e.y))}return a}nearestPoint(a){let b,c,d,e=1/0;for(let f of this.segments)d=f.nearestPoint(a),(c=iK.Dist2(d,a))<e&&(b=d,e=c);if(!b)throw Error("nearest point not found");return b}getSvgPathData(a=!0){let{_a:b,_b:c,_c:d,_d:e}=this;return`${a?`M ${b.toFixed()} `:""} C${c.toFixed()} ${d.toFixed()} ${e.toFixed()}`}static GetAtT(a,b){let{_a:c,_b:d,_c:e,_d:f}=a;return new iK((1-b)*(1-b)*(1-b)*c.x+(1-b)*(1-b)*3*b*d.x+3*(1-b)*(b*b)*e.x+b*b*b*f.x,(1-b)*(1-b)*(1-b)*c.y+(1-b)*(1-b)*3*b*d.y+3*(1-b)*(b*b)*e.y+b*b*b*f.y)}getLength(a,b=32){let c,d=this._a,e=0;for(let a=1;a<=b;a++)c=sz.GetAtT(this,a/b),e+=iK.Dist(d,c),d=c;return e}}class sA extends kG{constructor(a){super({...a,isClosed:!0}),this.config=a;const{width:b,height:c}=a;this._w=b,this._h=c}_w;_h;_edges;get edges(){if(!this._edges){let{vertices:a}=this;this._edges=[];for(let b=0,c=a.length;b<c;b++){let d=a[b],e=a[(b+1)%c];this._edges.push(new kJ({start:d,end:e}))}}return this._edges}getVertices(){let a=Math.max(1,this._w),b=Math.max(1,this._h),c=a/2,d=b/2,e=Math.pow(c-d,2)/Math.pow(c+d,2),f=sw(iO*(c+d)*(1+3*e/(10+Math.sqrt(4-3*e)))),g=iQ/f,h=Math.cos(g),i=Math.sin(g),j=0,k=1,l=0,m=1,n=Array(f);for(let e=0;e<f;e++)n[e]=new iK(iS(c+c*k,0,a),iS(d+d*j,0,b)),l=i*k+h*j,m=h*k-i*j,j=l,k=m;return n}nearestPoint(a){let b,c,d,e=1/0;for(let f of this.edges)d=f.nearestPoint(a),(c=iK.Dist2(d,a))<e&&(b=d,e=c);if(!b)throw Error("nearest point not found");return b}hitTestLineSegment(a,b){return this.edges.some(c=>c.hitTestLineSegment(a,b))}getBounds(){return new kt(0,0,this._w,this._h)}getLength(){var a;let b,{_w:c,_h:d}=this,e=Math.max(0,d/2);return b=Math.pow((a=Math.max(0,c/2))-e,2)/Math.pow(a+e,2),iO*(a+e)*(1+3*b/(10+Math.sqrt(4-3*b)))}getSvgPathData(a=!1){let{_w:b,_h:c}=this,d=b/2,e=c/2,f=Math.max(0,d),g=Math.max(0,e);return`${a?`M${d-f},${e}`:""} a${f},${g},0,1,1,${2*f},0a${f},${g},0,1,1,-${2*f},0`}}function sB(a,b,c){let d=new Set;for(let c of b){let b=a.getShape(c);if(!b)continue;d.add(b);let e=a.getShape(b.parentId);e&&d.add(e)}let e=new Map;for(let b of d){let d=a.getSortedChildIdsForParent(b);if(c?.filter&&!c.filter(b))e.set(b,d);else{let c=function(a,b,c){if(0===c.length)return du;let d=a.getShapePageBounds(b);if(!d)return du;let e=a.getShapeGeometry(b),f=a.getShapePageTransform(b).applyToPoints(e.vertices),g=a.getShape(b);if(!g)return du;let h=a.getShapePageTransform(b),i=a.getShapeUtil(g.type).getClipPath?.(g),j=i?h.applyToPoints(i):void 0,k=j?kA(j,f):f;return k?c.filter(b=>{let c=a.getShapePageBounds(b);if(!c||!d.includes(c))return!1;let e=a.getShapePageTransform(b).clone().invert().applyToPoints(k);return a.getShapeGeometry(b).overlapsPolygon(e)}):du}(a,b.id,d);c.length<d.length&&e.set(b,d.filter(a=>!c.includes(a)))}}let f=a.getCurrentPageShapesSorted().map(a=>a.id),g={};for(let[b,d]of e){let e=b4(d.map(b=>a.getShape(b))),{reparenting:h,remainingShapesToReparent:i}=function(a,b,c){let d=new Set(b),e=new Set;for(let c of b){let b=a.getShapeParent(c);b&&a.isShapeOfType(b,"group")&&!e.has(b)&&e.add(b)}for(let b of e){for(let c of b4(a.getSortedChildIdsForParent(b).map(b=>a.getShape(b))))d.delete(c);d.add(b)}let f=new Map,g=new Map,h=new Set(d),i=a.getCurrentPageShapesSorted().filter(b=>a.getShapeUtil(b).canReceiveNewChildrenOfType?.(b,b.type)&&!h.has(b));for(let b=i.length-1;b>=0;b--){let d=i[b],e=a.findShapeAncestor(d,b=>a.isShapeOfType(b,"group"))?.id,j=a.getShapeGeometry(d),k=a.getShapePageTransform(d),l=a.getShapeMask(d),m=k.applyToPoints(j.vertices),n=l?kA(l,m):m;if(!n)continue;let o=[];for(let b of h){if(d.id===b.id||c&&!c(b,d)||(f.has(b.id)||f.set(b.id,a.findShapeAncestor(b,b=>a.isShapeOfType(b,"group"))?.id),f.get(b.id)!==e||a.findShapeAncestor(d,a=>b.id===a.id)))continue;let g=a.getShapePageTransform(b).clone().invert().applyToPoints(n);if(a.getShapeGeometry(b).overlapsPolygon(g)){if(!a.getShapeUtil(d).canReceiveNewChildrenOfType?.(d,b.type))continue;b.parentId!==d.id&&o.push(b),h.delete(b);continue}}o.length&&g.set(d.id,o)}return{reparenting:g,remainingShapesToReparent:h}}(a,e,(a,d)=>(!c?.filter||!!c.filter(d))&&d.id!==b.id&&f.indexOf(d.id)<f.indexOf(a.id));if(h.forEach((a,b)=>{0!==a.length&&(g[b]||(g[b]={parentId:b,shapeIds:[]}),g[b].shapeIds.push(...a.map(a=>a.id)))}),i.size>0){let c=a.findShapeAncestor(b,b=>a.isShapeOfType(b,"group"))?.id??a.getCurrentPageId();i.forEach(d=>{if(!g[c]){let d,e=a.getSortedChildIdsForParent(c),f=e.indexOf(b.id);if(f>-1){let c=e[f+1],g=c?a.getShape(c).index:c4(b.index);d=c3(b.index,g)}g[c]={parentId:c,shapeIds:[],index:d}}g[c].shapeIds.push(d.id)})}}a.run(()=>{Object.values(g).forEach(({parentId:b,shapeIds:c,index:d})=>{0!==c.length&&(c.sort((a,b)=>f.indexOf(a)<f.indexOf(b)?-1:1),a.reparentShapes(c,b,d))})})}function sC(a){this.content=a}sC.prototype={constructor:sC,find:function(a){for(var b=0;b<this.content.length;b+=2)if(this.content[b]===a)return b;return -1},get:function(a){var b=this.find(a);return -1==b?void 0:this.content[b+1]},update:function(a,b,c){var d=c&&c!=a?this.remove(c):this,e=d.find(a),f=d.content.slice();return -1==e?f.push(c||a,b):(f[e+1]=b,c&&(f[e]=c)),new sC(f)},remove:function(a){var b=this.find(a);if(-1==b)return this;var c=this.content.slice();return c.splice(b,2),new sC(c)},addToStart:function(a,b){return new sC([a,b].concat(this.remove(a).content))},addToEnd:function(a,b){var c=this.remove(a).content.slice();return c.push(a,b),new sC(c)},addBefore:function(a,b,c){var d=this.remove(b),e=d.content.slice(),f=d.find(a);return e.splice(-1==f?e.length:f,0,b,c),new sC(e)},forEach:function(a){for(var b=0;b<this.content.length;b+=2)a(this.content[b],this.content[b+1])},prepend:function(a){return(a=sC.from(a)).size?new sC(a.content.concat(this.subtract(a).content)):this},append:function(a){return(a=sC.from(a)).size?new sC(this.subtract(a).content.concat(a.content)):this},subtract:function(a){var b=this;a=sC.from(a);for(var c=0;c<a.content.length;c+=2)b=b.remove(a.content[c]);return b},toObject:function(){var a={};return this.forEach(function(b,c){a[b]=c}),a},get size(){return this.content.length>>1}},sC.from=function(a){if(a instanceof sC)return a;var b=[];if(a)for(var c in a)b.push(c,a[c]);return new sC(b)};class sD{constructor(a,b){if(this.content=a,this.size=b||0,null==b)for(let b=0;b<a.length;b++)this.size+=a[b].nodeSize}nodesBetween(a,b,c,d=0,e){for(let f=0,g=0;g<b;f++){let h=this.content[f],i=g+h.nodeSize;if(i>a&&!1!==c(h,d+g,e||null,f)&&h.content.size){let e=g+1;h.nodesBetween(Math.max(0,a-e),Math.min(h.content.size,b-e),c,d+e)}g=i}}descendants(a){this.nodesBetween(0,this.size,a)}textBetween(a,b,c,d){let e="",f=!0;return this.nodesBetween(a,b,(g,h)=>{let i=g.isText?g.text.slice(Math.max(a,h)-h,b-h):g.isLeaf?d?"function"==typeof d?d(g):d:g.type.spec.leafText?g.type.spec.leafText(g):"":"";g.isBlock&&(g.isLeaf&&i||g.isTextblock)&&c&&(f?f=!1:e+=c),e+=i},0),e}append(a){if(!a.size)return this;if(!this.size)return a;let b=this.lastChild,c=a.firstChild,d=this.content.slice(),e=0;for(b.isText&&b.sameMarkup(c)&&(d[d.length-1]=b.withText(b.text+c.text),e=1);e<a.content.length;e++)d.push(a.content[e]);return new sD(d,this.size+a.size)}cut(a,b=this.size){if(0==a&&b==this.size)return this;let c=[],d=0;if(b>a)for(let e=0,f=0;f<b;e++){let g=this.content[e],h=f+g.nodeSize;h>a&&((f<a||h>b)&&(g=g.isText?g.cut(Math.max(0,a-f),Math.min(g.text.length,b-f)):g.cut(Math.max(0,a-f-1),Math.min(g.content.size,b-f-1))),c.push(g),d+=g.nodeSize),f=h}return new sD(c,d)}cutByIndex(a,b){return a==b?sD.empty:0==a&&b==this.content.length?this:new sD(this.content.slice(a,b))}replaceChild(a,b){let c=this.content[a];if(c==b)return this;let d=this.content.slice(),e=this.size+b.nodeSize-c.nodeSize;return d[a]=b,new sD(d,e)}addToStart(a){return new sD([a].concat(this.content),this.size+a.nodeSize)}addToEnd(a){return new sD(this.content.concat(a),this.size+a.nodeSize)}eq(a){if(this.content.length!=a.content.length)return!1;for(let b=0;b<this.content.length;b++)if(!this.content[b].eq(a.content[b]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(a){let b=this.content[a];if(!b)throw RangeError("Index "+a+" out of range for "+this);return b}maybeChild(a){return this.content[a]||null}forEach(a){for(let b=0,c=0;b<this.content.length;b++){let d=this.content[b];a(d,c,b),c+=d.nodeSize}}findDiffStart(a,b=0){return function a(b,c,d){for(let e=0;;e++){if(e==b.childCount||e==c.childCount)return b.childCount==c.childCount?null:d;let f=b.child(e),g=c.child(e);if(f==g){d+=f.nodeSize;continue}if(!f.sameMarkup(g))return d;if(f.isText&&f.text!=g.text){for(let a=0;f.text[a]==g.text[a];a++)d++;return d}if(f.content.size||g.content.size){let b=a(f.content,g.content,d+1);if(null!=b)return b}d+=f.nodeSize}}(this,a,b)}findDiffEnd(a,b=this.size,c=a.size){return function a(b,c,d,e){for(let f=b.childCount,g=c.childCount;;){if(0==f||0==g)return f==g?null:{a:d,b:e};let h=b.child(--f),i=c.child(--g),j=h.nodeSize;if(h==i){d-=j,e-=j;continue}if(!h.sameMarkup(i))return{a:d,b:e};if(h.isText&&h.text!=i.text){let a=0,b=Math.min(h.text.length,i.text.length);for(;a<b&&h.text[h.text.length-a-1]==i.text[i.text.length-a-1];)a++,d--,e--;return{a:d,b:e}}if(h.content.size||i.content.size){let b=a(h.content,i.content,d-1,e-1);if(b)return b}d-=j,e-=j}}(this,a,b,c)}findIndex(a){if(0==a)return sF(0,a);if(a==this.size)return sF(this.content.length,a);if(a>this.size||a<0)throw RangeError(`Position ${a} outside of fragment (${this})`);for(let b=0,c=0;;b++){let d=c+this.child(b).nodeSize;if(d>=a){if(d==a)return sF(b+1,d);return sF(b,c)}c=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(a=>a.toJSON()):null}static fromJSON(a,b){if(!b)return sD.empty;if(!Array.isArray(b))throw RangeError("Invalid input for Fragment.fromJSON");return new sD(b.map(a.nodeFromJSON))}static fromArray(a){if(!a.length)return sD.empty;let b,c=0;for(let d=0;d<a.length;d++){let e=a[d];c+=e.nodeSize,d&&e.isText&&a[d-1].sameMarkup(e)?(b||(b=a.slice(0,d)),b[b.length-1]=e.withText(b[b.length-1].text+e.text)):b&&b.push(e)}return new sD(b||a,c)}static from(a){if(!a)return sD.empty;if(a instanceof sD)return a;if(Array.isArray(a))return this.fromArray(a);if(a.attrs)return new sD([a],a.nodeSize);throw RangeError("Can not convert "+a+" to a Fragment"+(a.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}sD.empty=new sD([],0);let sE={index:0,offset:0};function sF(a,b){return sE.index=a,sE.offset=b,sE}function sG(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let c=Array.isArray(a);if(Array.isArray(b)!=c)return!1;if(c){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!sG(a[c],b[c]))return!1}else{for(let c in a)if(!(c in b)||!sG(a[c],b[c]))return!1;for(let c in b)if(!(c in a))return!1}return!0}class sH{constructor(a,b){this.type=a,this.attrs=b}addToSet(a){let b,c=!1;for(let d=0;d<a.length;d++){let e=a[d];if(this.eq(e))return a;if(this.type.excludes(e.type))b||(b=a.slice(0,d));else{if(e.type.excludes(this.type))return a;!c&&e.type.rank>this.type.rank&&(b||(b=a.slice(0,d)),b.push(this),c=!0),b&&b.push(e)}}return b||(b=a.slice()),c||b.push(this),b}removeFromSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return a.slice(0,b).concat(a.slice(b+1));return a}isInSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return!0;return!1}eq(a){return this==a||this.type==a.type&&sG(this.attrs,a.attrs)}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return a}static fromJSON(a,b){if(!b)throw RangeError("Invalid input for Mark.fromJSON");let c=a.marks[b.type];if(!c)throw RangeError(`There is no mark type ${b.type} in this schema`);let d=c.create(b.attrs);return c.checkAttrs(d.attrs),d}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].eq(b[c]))return!1;return!0}static setFrom(a){if(!a||Array.isArray(a)&&0==a.length)return sH.none;if(a instanceof sH)return[a];let b=a.slice();return b.sort((a,b)=>a.type.rank-b.type.rank),b}}sH.none=[];class sI extends Error{}class sJ{constructor(a,b,c){this.content=a,this.openStart=b,this.openEnd=c}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(a,b){let c=function a(b,c,d,e){let{index:f,offset:g}=b.findIndex(c),h=b.maybeChild(f);if(g==c||h.isText)return e&&!e.canReplace(f,f,d)?null:b.cut(0,c).append(d).append(b.cut(c));let i=a(h.content,c-g-1,d,h);return i&&b.replaceChild(f,h.copy(i))}(this.content,a+this.openStart,b);return c&&new sJ(c,this.openStart,this.openEnd)}removeBetween(a,b){return new sJ(function a(b,c,d){let{index:e,offset:f}=b.findIndex(c),g=b.maybeChild(e),{index:h,offset:i}=b.findIndex(d);if(f==c||g.isText){if(i!=d&&!b.child(h).isText)throw RangeError("Removing non-flat range");return b.cut(0,c).append(b.cut(d))}if(e!=h)throw RangeError("Removing non-flat range");return b.replaceChild(e,g.copy(a(g.content,c-f-1,d-f-1)))}(this.content,a+this.openStart,b+this.openStart),this.openStart,this.openEnd)}eq(a){return this.content.eq(a.content)&&this.openStart==a.openStart&&this.openEnd==a.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let a={content:this.content.toJSON()};return this.openStart>0&&(a.openStart=this.openStart),this.openEnd>0&&(a.openEnd=this.openEnd),a}static fromJSON(a,b){if(!b)return sJ.empty;let c=b.openStart||0,d=b.openEnd||0;if("number"!=typeof c||"number"!=typeof d)throw RangeError("Invalid input for Slice.fromJSON");return new sJ(sD.fromJSON(a,b.content),c,d)}static maxOpen(a,b=!0){let c=0,d=0;for(let d=a.firstChild;d&&!d.isLeaf&&(b||!d.type.spec.isolating);d=d.firstChild)c++;for(let c=a.lastChild;c&&!c.isLeaf&&(b||!c.type.spec.isolating);c=c.lastChild)d++;return new sJ(a,c,d)}}function sK(a,b){if(!b.type.compatibleContent(a.type))throw new sI("Cannot join "+b.type.name+" onto "+a.type.name)}function sL(a,b,c){let d=a.node(c);return sK(d,b.node(c)),d}function sM(a,b){let c=b.length-1;c>=0&&a.isText&&a.sameMarkup(b[c])?b[c]=a.withText(b[c].text+a.text):b.push(a)}function sN(a,b,c,d){let e=(b||a).node(c),f=0,g=b?b.index(c):e.childCount;a&&(f=a.index(c),a.depth>c?f++:a.textOffset&&(sM(a.nodeAfter,d),f++));for(let a=f;a<g;a++)sM(e.child(a),d);b&&b.depth==c&&b.textOffset&&sM(b.nodeBefore,d)}function sO(a,b){return a.type.checkContent(b),a.copy(b)}function sP(a,b,c){let d=[];return sN(null,a,c,d),a.depth>c&&sM(sO(sL(a,b,c+1),sP(a,b,c+1)),d),sN(b,null,c,d),new sD(d)}sJ.empty=new sJ(sD.empty,0,0);class sQ{constructor(a,b,c){this.pos=a,this.path=b,this.parentOffset=c,this.depth=b.length/3-1}resolveDepth(a){return null==a?this.depth:a<0?this.depth+a:a}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(a){return this.path[3*this.resolveDepth(a)]}index(a){return this.path[3*this.resolveDepth(a)+1]}indexAfter(a){return a=this.resolveDepth(a),this.index(a)+(a!=this.depth||this.textOffset?1:0)}start(a){return 0==(a=this.resolveDepth(a))?0:this.path[3*a-1]+1}end(a){return a=this.resolveDepth(a),this.start(a)+this.node(a).content.size}before(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position before the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]}after(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position after the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]+this.path[3*a].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let a=this.parent,b=this.index(this.depth);if(b==a.childCount)return null;let c=this.pos-this.path[this.path.length-1],d=a.child(b);return c?a.child(b).cut(c):d}get nodeBefore(){let a=this.index(this.depth),b=this.pos-this.path[this.path.length-1];return b?this.parent.child(a).cut(0,b):0==a?null:this.parent.child(a-1)}posAtIndex(a,b){b=this.resolveDepth(b);let c=this.path[3*b],d=0==b?0:this.path[3*b-1]+1;for(let b=0;b<a;b++)d+=c.child(b).nodeSize;return d}marks(){let a=this.parent,b=this.index();if(0==a.content.size)return sH.none;if(this.textOffset)return a.child(b).marks;let c=a.maybeChild(b-1),d=a.maybeChild(b);if(!c){let a=c;c=d,d=a}let e=c.marks;for(var f=0;f<e.length;f++)!1!==e[f].type.spec.inclusive||d&&e[f].isInSet(d.marks)||(e=e[f--].removeFromSet(e));return e}marksAcross(a){let b=this.parent.maybeChild(this.index());if(!b||!b.isInline)return null;let c=b.marks,d=a.parent.maybeChild(a.index());for(var e=0;e<c.length;e++)!1!==c[e].type.spec.inclusive||d&&c[e].isInSet(d.marks)||(c=c[e--].removeFromSet(c));return c}sharedDepth(a){for(let b=this.depth;b>0;b--)if(this.start(b)<=a&&this.end(b)>=a)return b;return 0}blockRange(a=this,b){if(a.pos<this.pos)return a.blockRange(this);for(let c=this.depth-(this.parent.inlineContent||this.pos==a.pos?1:0);c>=0;c--)if(a.pos<=this.end(c)&&(!b||b(this.node(c))))return new sU(this,a,c);return null}sameParent(a){return this.pos-this.parentOffset==a.pos-a.parentOffset}max(a){return a.pos>this.pos?a:this}min(a){return a.pos<this.pos?a:this}toString(){let a="";for(let b=1;b<=this.depth;b++)a+=(a?"/":"")+this.node(b).type.name+"_"+this.index(b-1);return a+":"+this.parentOffset}static resolve(a,b){if(!(b>=0&&b<=a.content.size))throw RangeError("Position "+b+" out of range");let c=[],d=0,e=b;for(let b=a;;){let{index:a,offset:f}=b.content.findIndex(e),g=e-f;if(c.push(b,a,d+f),!g||(b=b.child(a)).isText)break;e=g-1,d+=f+1}return new sQ(b,c,e)}static resolveCached(a,b){let c=sT.get(a);if(c)for(let a=0;a<c.elts.length;a++){let d=c.elts[a];if(d.pos==b)return d}else sT.set(a,c=new sR);let d=c.elts[c.i]=sQ.resolve(a,b);return c.i=(c.i+1)%sS,d}}class sR{constructor(){this.elts=[],this.i=0}}let sS=12,sT=new WeakMap;class sU{constructor(a,b,c){this.$from=a,this.$to=b,this.depth=c}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}let sV=Object.create(null);class sW{constructor(a,b,c,d=sH.none){this.type=a,this.attrs=b,this.marks=d,this.content=c||sD.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(a){return this.content.child(a)}maybeChild(a){return this.content.maybeChild(a)}forEach(a){this.content.forEach(a)}nodesBetween(a,b,c,d=0){this.content.nodesBetween(a,b,c,d,this)}descendants(a){this.nodesBetween(0,this.content.size,a)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(a,b,c,d){return this.content.textBetween(a,b,c,d)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(a){return this==a||this.sameMarkup(a)&&this.content.eq(a.content)}sameMarkup(a){return this.hasMarkup(a.type,a.attrs,a.marks)}hasMarkup(a,b,c){return this.type==a&&sG(this.attrs,b||a.defaultAttrs||sV)&&sH.sameSet(this.marks,c||sH.none)}copy(a=null){return a==this.content?this:new sW(this.type,this.attrs,a,this.marks)}mark(a){return a==this.marks?this:new sW(this.type,this.attrs,this.content,a)}cut(a,b=this.content.size){return 0==a&&b==this.content.size?this:this.copy(this.content.cut(a,b))}slice(a,b=this.content.size,c=!1){if(a==b)return sJ.empty;let d=this.resolve(a),e=this.resolve(b),f=c?0:d.sharedDepth(b),g=d.start(f);return new sJ(d.node(f).content.cut(d.pos-g,e.pos-g),d.depth-f,e.depth-f)}replace(a,b,c){var d=this.resolve(a),e=this.resolve(b);if(c.openStart>d.depth)throw new sI("Inserted content deeper than insertion position");if(d.depth-c.openStart!=e.depth-c.openEnd)throw new sI("Inconsistent open depths");return function a(b,c,d,e){let f=b.index(e),g=b.node(e);if(f==c.index(e)&&e<b.depth-d.openStart){let h=a(b,c,d,e+1);return g.copy(g.content.replaceChild(f,h))}if(!d.content.size)return sO(g,sP(b,c,e));if(d.openStart||d.openEnd||b.depth!=e||c.depth!=e){let{start:a,end:f}=function(a,b){let c=b.depth-a.openStart,d=b.node(c).copy(a.content);for(let a=c-1;a>=0;a--)d=b.node(a).copy(sD.from(d));return{start:d.resolveNoCache(a.openStart+c),end:d.resolveNoCache(d.content.size-a.openEnd-c)}}(d,b);return sO(g,function a(b,c,d,e,f){let g=b.depth>f&&sL(b,c,f+1),h=e.depth>f&&sL(d,e,f+1),i=[];return sN(null,b,f,i),g&&h&&c.index(f)==d.index(f)?(sK(g,h),sM(sO(g,a(b,c,d,e,f+1)),i)):(g&&sM(sO(g,sP(b,c,f+1)),i),sN(c,d,f,i),h&&sM(sO(h,sP(d,e,f+1)),i)),sN(e,null,f,i),new sD(i)}(b,a,f,c,e))}{let a=b.parent,e=a.content;return sO(a,e.cut(0,b.parentOffset).append(d.content).append(e.cut(c.parentOffset)))}}(d,e,c,0)}nodeAt(a){for(let b=this;;){let{index:c,offset:d}=b.content.findIndex(a);if(!(b=b.maybeChild(c)))return null;if(d==a||b.isText)return b;a-=d+1}}childAfter(a){let{index:b,offset:c}=this.content.findIndex(a);return{node:this.content.maybeChild(b),index:b,offset:c}}childBefore(a){if(0==a)return{node:null,index:0,offset:0};let{index:b,offset:c}=this.content.findIndex(a);if(c<a)return{node:this.content.child(b),index:b,offset:c};let d=this.content.child(b-1);return{node:d,index:b-1,offset:c-d.nodeSize}}resolve(a){return sQ.resolveCached(this,a)}resolveNoCache(a){return sQ.resolve(this,a)}rangeHasMark(a,b,c){let d=!1;return b>a&&this.nodesBetween(a,b,a=>(c.isInSet(a.marks)&&(d=!0),!d)),d}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let a=this.type.name;return this.content.size&&(a+="("+this.content.toStringInner()+")"),sY(this.marks,a)}contentMatchAt(a){let b=this.type.contentMatch.matchFragment(this.content,0,a);if(!b)throw Error("Called contentMatchAt on a node with invalid content");return b}canReplace(a,b,c=sD.empty,d=0,e=c.childCount){let f=this.contentMatchAt(a).matchFragment(c,d,e),g=f&&f.matchFragment(this.content,b);if(!g||!g.validEnd)return!1;for(let a=d;a<e;a++)if(!this.type.allowsMarks(c.child(a).marks))return!1;return!0}canReplaceWith(a,b,c,d){if(d&&!this.type.allowsMarks(d))return!1;let e=this.contentMatchAt(a).matchType(c),f=e&&e.matchFragment(this.content,b);return!!f&&f.validEnd}canAppend(a){return a.content.size?this.canReplace(this.childCount,this.childCount,a.content):this.type.compatibleContent(a.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let a=sH.none;for(let b=0;b<this.marks.length;b++){let c=this.marks[b];c.type.checkAttrs(c.attrs),a=c.addToSet(a)}if(!sH.sameSet(a,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(a=>a.type.name)}`);this.content.forEach(a=>a.check())}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return this.content.size&&(a.content=this.content.toJSON()),this.marks.length&&(a.marks=this.marks.map(a=>a.toJSON())),a}static fromJSON(a,b){let c;if(!b)throw RangeError("Invalid input for Node.fromJSON");if(b.marks){if(!Array.isArray(b.marks))throw RangeError("Invalid mark data for Node.fromJSON");c=b.marks.map(a.markFromJSON)}if("text"==b.type){if("string"!=typeof b.text)throw RangeError("Invalid text node in JSON");return a.text(b.text,c)}let d=sD.fromJSON(a,b.content),e=a.nodeType(b.type).create(b.attrs,d,c);return e.type.checkAttrs(e.attrs),e}}sW.prototype.text=void 0;class sX extends sW{constructor(a,b,c,d){if(super(a,b,null,d),!c)throw RangeError("Empty text nodes are not allowed");this.text=c}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):sY(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(a,b){return this.text.slice(a,b)}get nodeSize(){return this.text.length}mark(a){return a==this.marks?this:new sX(this.type,this.attrs,this.text,a)}withText(a){return a==this.text?this:new sX(this.type,this.attrs,a,this.marks)}cut(a=0,b=this.text.length){return 0==a&&b==this.text.length?this:this.withText(this.text.slice(a,b))}eq(a){return this.sameMarkup(a)&&this.text==a.text}toJSON(){let a=super.toJSON();return a.text=this.text,a}}function sY(a,b){for(let c=a.length-1;c>=0;c--)b=a[c].type.name+"("+b+")";return b}class sZ{constructor(a){this.validEnd=a,this.next=[],this.wrapCache=[]}static parse(a,b){var c;let d,e=new s$(a,b);if(null==e.next)return sZ.empty;let f=function a(b){let c=[];do c.push(function(b){let c=[];do c.push(function(b){let c=function(b){if(b.eat("(")){let c=a(b);return b.eat(")")||b.err("Missing closing paren"),c}if(/\W/.test(b.next))b.err("Unexpected token '"+b.next+"'");else{let a=(function(a,b){let c=a.nodeTypes,d=c[b];if(d)return[d];let e=[];for(let a in c){let d=c[a];d.isInGroup(b)&&e.push(d)}return 0==e.length&&a.err("No node type or group '"+b+"' found"),e})(b,b.next).map(a=>(null==b.inline?b.inline=a.isInline:b.inline!=a.isInline&&b.err("Mixing inline and block content"),{type:"name",value:a}));return b.pos++,1==a.length?a[0]:{type:"choice",exprs:a}}}(b);for(;;)if(b.eat("+"))c={type:"plus",expr:c};else if(b.eat("*"))c={type:"star",expr:c};else if(b.eat("?"))c={type:"opt",expr:c};else if(b.eat("{"))c=function(a,b){let c=s_(a),d=c;return a.eat(",")&&(d="}"!=a.next?s_(a):-1),a.eat("}")||a.err("Unclosed braced range"),{type:"range",min:c,max:d,expr:b}}(b,c);else break;return c}(b));while(b.next&&")"!=b.next&&"|"!=b.next)return 1==c.length?c[0]:{type:"seq",exprs:c}}(b));while(b.eat("|"))return 1==c.length?c[0]:{type:"choice",exprs:c}}(e);e.next&&e.err("Unexpected trailing text");let g=(c=function(a){let b=[[]];return e(function a(b,f){if("choice"==b.type)return b.exprs.reduce((b,c)=>b.concat(a(c,f)),[]);if("seq"==b.type)for(let d=0;;d++){let g=a(b.exprs[d],f);if(d==b.exprs.length-1)return g;e(g,f=c())}else if("star"==b.type){let g=c();return d(f,g),e(a(b.expr,g),g),[d(g)]}else if("plus"==b.type){let g=c();return e(a(b.expr,f),g),e(a(b.expr,g),g),[d(g)]}else if("opt"==b.type)return[d(f)].concat(a(b.expr,f));else if("range"==b.type){let g=f;for(let d=0;d<b.min;d++){let d=c();e(a(b.expr,g),d),g=d}if(-1==b.max)e(a(b.expr,g),g);else for(let f=b.min;f<b.max;f++){let f=c();d(g,f),e(a(b.expr,g),f),g=f}return[d(g)]}else if("name"==b.type)return[d(f,void 0,b.value)];else throw Error("Unknown expr type")}(a,0),c()),b;function c(){return b.push([])-1}function d(a,c,d){let e={term:d,to:c};return b[a].push(e),e}function e(a,b){a.forEach(a=>a.to=b)}}(f),d=Object.create(null),function a(b){let e=[];b.forEach(a=>{c[a].forEach(({term:a,to:b})=>{let d;if(a){for(let b=0;b<e.length;b++)e[b][0]==a&&(d=e[b][1]);s1(c,b).forEach(b=>{d||e.push([a,d=[]]),-1==d.indexOf(b)&&d.push(b)})}})});let f=d[b.join(",")]=new sZ(b.indexOf(c.length-1)>-1);for(let b=0;b<e.length;b++){let c=e[b][1].sort(s0);f.next.push({type:e[b][0],next:d[c.join(",")]||a(c)})}return f}(s1(c,0)));return function(a,b){for(let c=0,d=[a];c<d.length;c++){let a=d[c],e=!a.validEnd,f=[];for(let b=0;b<a.next.length;b++){let{type:c,next:g}=a.next[b];f.push(c.name),e&&!(c.isText||c.hasRequiredAttrs())&&(e=!1),-1==d.indexOf(g)&&d.push(g)}e&&b.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(g,e),g}matchType(a){for(let b=0;b<this.next.length;b++)if(this.next[b].type==a)return this.next[b].next;return null}matchFragment(a,b=0,c=a.childCount){let d=this;for(let e=b;d&&e<c;e++)d=d.matchType(a.child(e).type);return d}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let a=0;a<this.next.length;a++){let{type:b}=this.next[a];if(!(b.isText||b.hasRequiredAttrs()))return b}return null}compatible(a){for(let b=0;b<this.next.length;b++)for(let c=0;c<a.next.length;c++)if(this.next[b].type==a.next[c].type)return!0;return!1}fillBefore(a,b=!1,c=0){let d=[this];return function e(f,g){let h=f.matchFragment(a,c);if(h&&(!b||h.validEnd))return sD.from(g.map(a=>a.createAndFill()));for(let a=0;a<f.next.length;a++){let{type:b,next:c}=f.next[a];if(!(b.isText||b.hasRequiredAttrs())&&-1==d.indexOf(c)){d.push(c);let a=e(c,g.concat(b));if(a)return a}}return null}(this,[])}findWrapping(a){for(let b=0;b<this.wrapCache.length;b+=2)if(this.wrapCache[b]==a)return this.wrapCache[b+1];let b=this.computeWrapping(a);return this.wrapCache.push(a,b),b}computeWrapping(a){let b=Object.create(null),c=[{match:this,type:null,via:null}];for(;c.length;){let d=c.shift(),e=d.match;if(e.matchType(a)){let a=[];for(let b=d;b.type;b=b.via)a.push(b.type);return a.reverse()}for(let a=0;a<e.next.length;a++){let{type:f,next:g}=e.next[a];f.isLeaf||f.hasRequiredAttrs()||f.name in b||d.type&&!g.validEnd||(c.push({match:f.contentMatch,type:f,via:d}),b[f.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(a){if(a>=this.next.length)throw RangeError(`There's no ${a}th edge in this content match`);return this.next[a]}toString(){let a=[];return!function b(c){a.push(c);for(let d=0;d<c.next.length;d++)-1==a.indexOf(c.next[d].next)&&b(c.next[d].next)}(this),a.map((b,c)=>{let d=c+(b.validEnd?"*":" ")+" ";for(let c=0;c<b.next.length;c++)d+=(c?", ":"")+b.next[c].type.name+"->"+a.indexOf(b.next[c].next);return d}).join("\n")}}sZ.empty=new sZ(!0);class s${constructor(a,b){this.string=a,this.nodeTypes=b,this.inline=null,this.pos=0,this.tokens=a.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(a){return this.next==a&&(this.pos++||!0)}err(a){throw SyntaxError(a+" (in content expression '"+this.string+"')")}}function s_(a){/\D/.test(a.next)&&a.err("Expected number, got '"+a.next+"'");let b=Number(a.next);return a.pos++,b}function s0(a,b){return b-a}function s1(a,b){let c=[];return function b(d){let e=a[d];if(1==e.length&&!e[0].term)return b(e[0].to);c.push(d);for(let a=0;a<e.length;a++){let{term:d,to:f}=e[a];d||-1!=c.indexOf(f)||b(f)}}(b),c.sort(s0)}function s2(a){let b=Object.create(null);for(let c in a){let d=a[c];if(!d.hasDefault)return null;b[c]=d.default}return b}function s3(a,b){let c=Object.create(null);for(let d in a){let e=b&&b[d];if(void 0===e){let b=a[d];if(b.hasDefault)e=b.default;else throw RangeError("No value supplied for attribute "+d)}c[d]=e}return c}function s4(a,b,c,d){for(let d in b)if(!(d in a))throw RangeError(`Unsupported attribute ${d} for ${c} of type ${d}`);for(let c in a){let d=a[c];d.validate&&d.validate(b[c])}}function s5(a,b){let c=Object.create(null);if(b)for(let d in b)c[d]=new s7(a,d,b[d]);return c}class s6{constructor(a,b,c){this.name=a,this.schema=b,this.spec=c,this.markSet=null,this.groups=c.group?c.group.split(" "):[],this.attrs=s5(a,c.attrs),this.defaultAttrs=s2(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(c.inline||"text"==a),this.isText="text"==a}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==sZ.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(a){return this.groups.indexOf(a)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let a in this.attrs)if(this.attrs[a].isRequired)return!0;return!1}compatibleContent(a){return this==a||this.contentMatch.compatible(a.contentMatch)}computeAttrs(a){return!a&&this.defaultAttrs?this.defaultAttrs:s3(this.attrs,a)}create(a=null,b,c){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new sW(this,this.computeAttrs(a),sD.from(b),sH.setFrom(c))}createChecked(a=null,b,c){return b=sD.from(b),this.checkContent(b),new sW(this,this.computeAttrs(a),b,sH.setFrom(c))}createAndFill(a=null,b,c){if(a=this.computeAttrs(a),(b=sD.from(b)).size){let a=this.contentMatch.fillBefore(b);if(!a)return null;b=a.append(b)}let d=this.contentMatch.matchFragment(b),e=d&&d.fillBefore(sD.empty,!0);return e?new sW(this,a,b.append(e),sH.setFrom(c)):null}validContent(a){let b=this.contentMatch.matchFragment(a);if(!b||!b.validEnd)return!1;for(let b=0;b<a.childCount;b++)if(!this.allowsMarks(a.child(b).marks))return!1;return!0}checkContent(a){if(!this.validContent(a))throw RangeError(`Invalid content for node ${this.name}: ${a.toString().slice(0,50)}`)}checkAttrs(a){s4(this.attrs,a,"node",this.name)}allowsMarkType(a){return null==this.markSet||this.markSet.indexOf(a)>-1}allowsMarks(a){if(null==this.markSet)return!0;for(let b=0;b<a.length;b++)if(!this.allowsMarkType(a[b].type))return!1;return!0}allowedMarks(a){let b;if(null==this.markSet)return a;for(let c=0;c<a.length;c++)this.allowsMarkType(a[c].type)?b&&b.push(a[c]):b||(b=a.slice(0,c));return b?b.length?b:sH.none:a}static compile(a,b){let c=Object.create(null);a.forEach((a,d)=>c[a]=new s6(a,b,d));let d=b.spec.topNode||"doc";if(!c[d])throw RangeError("Schema is missing its top node type ('"+d+"')");if(!c.text)throw RangeError("Every schema needs a 'text' type");for(let a in c.text.attrs)throw RangeError("The text node type should not have attributes");return c}}class s7{constructor(a,b,c){this.hasDefault=Object.prototype.hasOwnProperty.call(c,"default"),this.default=c.default,this.validate="string"==typeof c.validate?function(a,b,c){let d=c.split("|");return c=>{let e=null===c?"null":typeof c;if(0>d.indexOf(e))throw RangeError(`Expected value of type ${d} for attribute ${b} on type ${a}, got ${e}`)}}(a,b,c.validate):c.validate}get isRequired(){return!this.hasDefault}}class s8{constructor(a,b,c,d){this.name=a,this.rank=b,this.schema=c,this.spec=d,this.attrs=s5(a,d.attrs),this.excluded=null;let e=s2(this.attrs);this.instance=e?new sH(this,e):null}create(a=null){return!a&&this.instance?this.instance:new sH(this,s3(this.attrs,a))}static compile(a,b){let c=Object.create(null),d=0;return a.forEach((a,e)=>c[a]=new s8(a,d++,b,e)),c}removeFromSet(a){for(var b=0;b<a.length;b++)a[b].type==this&&(a=a.slice(0,b).concat(a.slice(b+1)),b--);return a}isInSet(a){for(let b=0;b<a.length;b++)if(a[b].type==this)return a[b]}checkAttrs(a){s4(this.attrs,a,"mark",this.name)}excludes(a){return this.excluded.indexOf(a)>-1}}class s9{constructor(a){this.linebreakReplacement=null,this.cached=Object.create(null);let b=this.spec={};for(let c in a)b[c]=a[c];b.nodes=sC.from(a.nodes),b.marks=sC.from(a.marks||{}),this.nodes=s6.compile(this.spec.nodes,this),this.marks=s8.compile(this.spec.marks,this);let c=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw RangeError(a+" can not be both a node and a mark");let b=this.nodes[a],d=b.spec.content||"",e=b.spec.marks;if(b.contentMatch=c[d]||(c[d]=sZ.parse(d,this.nodes)),b.inlineContent=b.contentMatch.inlineContent,b.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError("Multiple linebreak nodes defined");if(!b.isInline||!b.isLeaf)throw RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=b}b.markSet="_"==e?null:e?ta(this,e.split(" ")):""!=e&&b.inlineContent?null:[]}for(let a in this.marks){let b=this.marks[a],c=b.spec.excludes;b.excluded=null==c?[b]:""==c?[]:ta(this,c.split(" "))}this.nodeFromJSON=a=>sW.fromJSON(this,a),this.markFromJSON=a=>sH.fromJSON(this,a),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(a,b=null,c,d){if("string"==typeof a)a=this.nodeType(a);else if(a instanceof s6){if(a.schema!=this)throw RangeError("Node type from different schema used ("+a.name+")")}else throw RangeError("Invalid node type: "+a);return a.createChecked(b,c,d)}text(a,b){let c=this.nodes.text;return new sX(c,c.defaultAttrs,a,sH.setFrom(b))}mark(a,b){return"string"==typeof a&&(a=this.marks[a]),a.create(b)}nodeType(a){let b=this.nodes[a];if(!b)throw RangeError("Unknown node type: "+a);return b}}function ta(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b[d],f=a.marks[e],g=f;if(f)c.push(f);else for(let b in a.marks){let d=a.marks[b];("_"==e||d.spec.group&&d.spec.group.split(" ").indexOf(e)>-1)&&c.push(g=d)}if(!g)throw SyntaxError("Unknown mark type: '"+b[d]+"'")}return c}class tb{constructor(a,b){this.schema=a,this.rules=b,this.tags=[],this.styles=[];let c=this.matchedStyles=[];b.forEach(a=>{if(null!=a.tag)this.tags.push(a);else if(null!=a.style){let b=/[^=]*/.exec(a.style)[0];0>c.indexOf(b)&&c.push(b),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(b=>{if(!/^(ul|ol)\b/.test(b.tag)||!b.node)return!1;let c=a.nodes[b.node];return c.contentMatch.matchType(c)})}parse(a,b={}){let c=new th(this,b,!1);return c.addAll(a,sH.none,b.from,b.to),c.finish()}parseSlice(a,b={}){let c=new th(this,b,!0);return c.addAll(a,sH.none,b.from,b.to),sJ.maxOpen(c.finish())}matchTag(a,b,c){for(let f=c?this.tags.indexOf(c)+1:0;f<this.tags.length;f++){var d,e;let c=this.tags[f];if(d=a,e=c.tag,(d.matches||d.msMatchesSelector||d.webkitMatchesSelector||d.mozMatchesSelector).call(d,e)&&(void 0===c.namespace||a.namespaceURI==c.namespace)&&(!c.context||b.matchesContext(c.context))){if(c.getAttrs){let b=c.getAttrs(a);if(!1===b)continue;c.attrs=b||void 0}return c}}}matchStyle(a,b,c,d){for(let e=d?this.styles.indexOf(d)+1:0;e<this.styles.length;e++){let d=this.styles[e],f=d.style;if(0==f.indexOf(a)&&(!d.context||c.matchesContext(d.context))&&(!(f.length>a.length)||61==f.charCodeAt(a.length)&&f.slice(a.length+1)==b)){if(d.getAttrs){let a=d.getAttrs(b);if(!1===a)continue;d.attrs=a||void 0}return d}}}static schemaRules(a){let b=[];function c(a){let c=null==a.priority?50:a.priority,d=0;for(;d<b.length;d++){let a=b[d];if((null==a.priority?50:a.priority)<c)break}b.splice(d,0,a)}for(let b in a.marks){let d=a.marks[b].spec.parseDOM;d&&d.forEach(a=>{c(a=ti(a)),a.mark||a.ignore||a.clearMark||(a.mark=b)})}for(let b in a.nodes){let d=a.nodes[b].spec.parseDOM;d&&d.forEach(a=>{c(a=ti(a)),a.node||a.ignore||a.mark||(a.node=b)})}return b}static fromSchema(a){return a.cached.domParser||(a.cached.domParser=new tb(a,tb.schemaRules(a)))}}let tc={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},td={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},te={ol:!0,ul:!0};function tf(a,b,c){return null!=b?!!b|2*("full"===b):a&&"pre"==a.whitespace?3:-5&c}class tg{constructor(a,b,c,d,e,f){this.type=a,this.attrs=b,this.marks=c,this.solid=d,this.options=f,this.content=[],this.activeMarks=sH.none,this.match=e||(4&f?null:a.contentMatch)}findWrapping(a){if(!this.match){if(!this.type)return[];let b=this.type.contentMatch.fillBefore(sD.from(a));if(b)this.match=this.type.contentMatch.matchFragment(b);else{let b=this.type.contentMatch,c;return(c=b.findWrapping(a.type))?(this.match=b,c):null}}return this.match.findWrapping(a.type)}finish(a){if(!(1&this.options)){let a=this.content[this.content.length-1],b;a&&a.isText&&(b=/[ \t\r\n\u000c]+$/.exec(a.text))&&(a.text.length==b[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-b[0].length)))}let b=sD.from(this.content);return!a&&this.match&&(b=b.append(this.match.fillBefore(sD.empty,!0))),this.type?this.type.create(this.attrs,b,this.marks):b}inlineContext(a){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:a.parentNode&&!tc.hasOwnProperty(a.parentNode.nodeName.toLowerCase())}}class th{constructor(a,b,c){this.parser=a,this.options=b,this.isOpen=c,this.open=0,this.localPreserveWS=!1;let d=b.topNode,e,f=tf(null,b.preserveWhitespace,0)|4*!!c;e=d?new tg(d.type,d.attrs,sH.none,!0,b.topMatch||d.type.contentMatch,f):c?new tg(null,null,sH.none,!0,null,f):new tg(a.schema.topNodeType,null,sH.none,!0,null,f),this.nodes=[e],this.find=b.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(a,b){3==a.nodeType?this.addTextNode(a,b):1==a.nodeType&&this.addElement(a,b)}addTextNode(a,b){let c=a.nodeValue,d=this.top,e=2&d.options?"full":this.localPreserveWS||(1&d.options)>0,{schema:f}=this.parser;if("full"===e||d.inlineContext(a)||/[^ \t\r\n\u000c]/.test(c)){if(e)if("full"===e)c=c.replace(/\r\n?/g,"\n");else if(f.linebreakReplacement&&/[\r\n]/.test(c)&&this.top.findWrapping(f.linebreakReplacement.create())){let a=c.split(/\r?\n|\r/);for(let c=0;c<a.length;c++)c&&this.insertNode(f.linebreakReplacement.create(),b,!0),a[c]&&this.insertNode(f.text(a[c]),b,!/\S/.test(a[c]));c=""}else c=c.replace(/\r?\n|\r/g," ");else if(c=c.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(c)&&this.open==this.nodes.length-1){let b=d.content[d.content.length-1],e=a.previousSibling;(!b||e&&"BR"==e.nodeName||b.isText&&/[ \t\r\n\u000c]$/.test(b.text))&&(c=c.slice(1))}c&&this.insertNode(f.text(c),b,!/\S/.test(c)),this.findInText(a)}else this.findInside(a)}addElement(a,b,c){let d=this.localPreserveWS,e=this.top;("PRE"==a.tagName||/pre/.test(a.style&&a.style.whiteSpace))&&(this.localPreserveWS=!0);let f=a.nodeName.toLowerCase(),g;te.hasOwnProperty(f)&&this.parser.normalizeLists&&function(a){for(let b=a.firstChild,c=null;b;b=b.nextSibling){let a=1==b.nodeType?b.nodeName.toLowerCase():null;a&&te.hasOwnProperty(a)&&c?(c.appendChild(b),b=c):"li"==a?c=b:a&&(c=null)}}(a);let h=this.options.ruleFromNode&&this.options.ruleFromNode(a)||(g=this.parser.matchTag(a,this,c));f:if(h?h.ignore:td.hasOwnProperty(f))this.findInside(a),this.ignoreFallback(a,b);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(a=h.skip);let c,d=this.needsBlock;if(tc.hasOwnProperty(f))e.content.length&&e.content[0].isInline&&this.open&&(this.open--,e=this.top),c=!0,e.type||(this.needsBlock=!0);else if(!a.firstChild){this.leafFallback(a,b);break f}let g=h&&h.skip?b:this.readStyles(a,b);g&&this.addAll(a,g),c&&this.sync(e),this.needsBlock=d}else{let c=this.readStyles(a,b);c&&this.addElementByRule(a,h,c,!1===h.consuming?g:void 0)}this.localPreserveWS=d}leafFallback(a,b){"BR"==a.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(a.ownerDocument.createTextNode("\n"),b)}ignoreFallback(a,b){"BR"!=a.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),b,!0)}readStyles(a,b){let c=a.style;if(c&&c.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let d=this.parser.matchedStyles[a],e=c.getPropertyValue(d);if(e)for(let a;;){let c=this.parser.matchStyle(d,e,this,a);if(!c)break;if(c.ignore)return null;if(b=c.clearMark?b.filter(a=>!c.clearMark(a)):b.concat(this.parser.schema.marks[c.mark].create(c.attrs)),!1===c.consuming)a=c;else break}}return b}addElementByRule(a,b,c,d){let e,f;if(b.node)if((f=this.parser.schema.nodes[b.node]).isLeaf)this.insertNode(f.create(b.attrs),c,"BR"==a.nodeName)||this.leafFallback(a,c);else{let a=this.enter(f,b.attrs||null,c,b.preserveWhitespace);a&&(e=!0,c=a)}else{let a=this.parser.schema.marks[b.mark];c=c.concat(a.create(b.attrs))}let g=this.top;if(f&&f.isLeaf)this.findInside(a);else if(d)this.addElement(a,c,d);else if(b.getContent)this.findInside(a),b.getContent(a,this.parser.schema).forEach(a=>this.insertNode(a,c,!1));else{let d=a;"string"==typeof b.contentElement?d=a.querySelector(b.contentElement):"function"==typeof b.contentElement?d=b.contentElement(a):b.contentElement&&(d=b.contentElement),this.findAround(a,d,!0),this.addAll(d,c),this.findAround(a,d,!1)}e&&this.sync(g)&&this.open--}addAll(a,b,c,d){let e=c||0;for(let f=c?a.childNodes[c]:a.firstChild,g=null==d?null:a.childNodes[d];f!=g;f=f.nextSibling,++e)this.findAtPoint(a,e),this.addDOM(f,b);this.findAtPoint(a,e)}findPlace(a,b,c){let d,e;for(let b=this.open,f=0;b>=0;b--){let g=this.nodes[b],h=g.findWrapping(a);if(h&&(!d||d.length>h.length+f)&&(d=h,e=g,!h.length))break;if(g.solid){if(c)break;f+=2}}if(!d)return null;this.sync(e);for(let a=0;a<d.length;a++)b=this.enterInner(d[a],null,b,!1);return b}insertNode(a,b,c){if(a.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(b=this.enterInner(a,null,b))}let d=this.findPlace(a,b,c);if(d){this.closeExtra();let b=this.top;b.match&&(b.match=b.match.matchType(a.type));let c=sH.none;for(let e of d.concat(a.marks))(b.type?b.type.allowsMarkType(e.type):tj(e.type,a.type))&&(c=e.addToSet(c));return b.content.push(a.mark(c)),!0}return!1}enter(a,b,c,d){let e=this.findPlace(a.create(b),c,!1);return e&&(e=this.enterInner(a,b,c,!0,d)),e}enterInner(a,b,c,d=!1,e){this.closeExtra();let f=this.top;f.match=f.match&&f.match.matchType(a);let g=tf(a,e,f.options);4&f.options&&0==f.content.length&&(g|=4);let h=sH.none;return c=c.filter(b=>(f.type?!f.type.allowsMarkType(b.type):!tj(b.type,a))||(h=b.addToSet(h),!1)),this.nodes.push(new tg(a,b,h,d,null,g)),this.open++,c}closeExtra(a=!1){let b=this.nodes.length-1;if(b>this.open){for(;b>this.open;b--)this.nodes[b-1].content.push(this.nodes[b].finish(a));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(a){for(let b=this.open;b>=0;b--)if(this.nodes[b]==a)return this.open=b,!0;else this.localPreserveWS&&(this.nodes[b].options|=1);return!1}get currentPos(){this.closeExtra();let a=0;for(let b=this.open;b>=0;b--){let c=this.nodes[b].content;for(let b=c.length-1;b>=0;b--)a+=c[b].nodeSize;b&&a++}return a}findAtPoint(a,b){if(this.find)for(let c=0;c<this.find.length;c++)this.find[c].node==a&&this.find[c].offset==b&&(this.find[c].pos=this.currentPos)}findInside(a){if(this.find)for(let b=0;b<this.find.length;b++)null==this.find[b].pos&&1==a.nodeType&&a.contains(this.find[b].node)&&(this.find[b].pos=this.currentPos)}findAround(a,b,c){if(a!=b&&this.find)for(let d=0;d<this.find.length;d++)null==this.find[d].pos&&1==a.nodeType&&a.contains(this.find[d].node)&&b.compareDocumentPosition(this.find[d].node)&(c?2:4)&&(this.find[d].pos=this.currentPos)}findInText(a){if(this.find)for(let b=0;b<this.find.length;b++)this.find[b].node==a&&(this.find[b].pos=this.currentPos-(a.nodeValue.length-this.find[b].offset))}matchesContext(a){if(a.indexOf("|")>-1)return a.split(/\s*\|\s*/).some(this.matchesContext,this);let b=a.split("/"),c=this.options.context,d=!this.isOpen&&(!c||c.parent.type==this.nodes[0].type),e=-(c?c.depth+1:0)+ +!d,f=(a,g)=>{for(;a>=0;a--){let h=b[a];if(""==h){if(a==b.length-1||0==a)continue;for(;g>=e;g--)if(f(a-1,g))return!0;return!1}{let a=g>0||0==g&&d?this.nodes[g].type:c&&g>=e?c.node(g-e).type:null;if(!a||a.name!=h&&!a.isInGroup(h))return!1;g--}}return!0};return f(b.length-1,this.open)}textblockFromContext(){let a=this.options.context;if(a)for(let b=a.depth;b>=0;b--){let c=a.node(b).contentMatchAt(a.indexAfter(b)).defaultType;if(c&&c.isTextblock&&c.defaultAttrs)return c}for(let a in this.parser.schema.nodes){let b=this.parser.schema.nodes[a];if(b.isTextblock&&b.defaultAttrs)return b}}}function ti(a){let b={};for(let c in a)b[c]=a[c];return b}function tj(a,b){let c=b.schema.nodes;for(let d in c){let e=c[d];if(!e.allowsMarkType(a))continue;let f=[],g=a=>{f.push(a);for(let c=0;c<a.edgeCount;c++){let{type:d,next:e}=a.edge(c);if(d==b||0>f.indexOf(e)&&g(e))return!0}};if(g(e.contentMatch))return!0}}class tk{constructor(a,b){this.nodes=a,this.marks=b}serializeFragment(a,b={},c){c||(c=tm(b).createDocumentFragment());let d=c,e=[];return a.forEach(a=>{if(e.length||a.marks.length){let c=0,f=0;for(;c<e.length&&f<a.marks.length;){let b=a.marks[f];if(!this.marks[b.type.name]){f++;continue}if(!b.eq(e[c][0])||!1===b.type.spec.spanning)break;c++,f++}for(;c<e.length;)d=e.pop()[1];for(;f<a.marks.length;){let c=a.marks[f++],g=this.serializeMark(c,a.isInline,b);g&&(e.push([c,d]),d.appendChild(g.dom),d=g.contentDOM||g.dom)}}d.appendChild(this.serializeNodeInner(a,b))}),c}serializeNodeInner(a,b){let{dom:c,contentDOM:d}=to(tm(b),this.nodes[a.type.name](a),null,a.attrs);if(d){if(a.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(a.content,b,d)}return c}serializeNode(a,b={}){let c=this.serializeNodeInner(a,b);for(let d=a.marks.length-1;d>=0;d--){let e=this.serializeMark(a.marks[d],a.isInline,b);e&&((e.contentDOM||e.dom).appendChild(c),c=e.dom)}return c}serializeMark(a,b,c={}){let d=this.marks[a.type.name];return d&&to(tm(c),d(a,b),null,a.attrs)}static renderSpec(a,b,c=null,d){return to(a,b,c,d)}static fromSchema(a){return a.cached.domSerializer||(a.cached.domSerializer=new tk(this.nodesFromSchema(a),this.marksFromSchema(a)))}static nodesFromSchema(a){let b=tl(a.nodes);return b.text||(b.text=a=>a.text),b}static marksFromSchema(a){return tl(a.marks)}}function tl(a){let b={};for(let c in a){let d=a[c].spec.toDOM;d&&(b[c]=d)}return b}function tm(a){return a.document||window.document}let tn=new WeakMap;function to(a,b,c,d){let e,f,g;if("string"==typeof b)return{dom:a.createTextNode(b)};if(null!=b.nodeType)return{dom:b};if(b.dom&&null!=b.dom.nodeType)return b;let h=b[0],i;if("string"!=typeof h)throw RangeError("Invalid array passed to renderSpec");if(d&&(void 0===(f=tn.get(d))&&tn.set(d,(g=null,!function a(b){if(b&&"object"==typeof b)if(Array.isArray(b))if("string"==typeof b[0])g||(g=[]),g.push(b);else for(let c=0;c<b.length;c++)a(b[c]);else for(let c in b)a(b[c])}(d),f=g)),i=f)&&i.indexOf(b)>-1)throw RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let j=h.indexOf(" ");j>0&&(c=h.slice(0,j),h=h.slice(j+1));let k=c?a.createElementNS(c,h):a.createElement(h),l=b[1],m=1;if(l&&"object"==typeof l&&null==l.nodeType&&!Array.isArray(l)){for(let a in m=2,l)if(null!=l[a]){let b=a.indexOf(" ");b>0?k.setAttributeNS(a.slice(0,b),a.slice(b+1),l[a]):"style"==a&&k.style?k.style.cssText=l[a]:k.setAttribute(a,l[a])}}for(let f=m;f<b.length;f++){let g=b[f];if(0===g){if(f<b.length-1||f>m)throw RangeError("Content hole must be the only child of its parent node");return{dom:k,contentDOM:k}}{let{dom:b,contentDOM:f}=to(a,g,c,d);if(k.appendChild(b),f){if(e)throw RangeError("Multiple content holes");e=f}}}return{dom:k,contentDOM:e}}class tp{constructor(a,b,c){this.pos=a,this.delInfo=b,this.recover=c}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class tq{constructor(a,b=!1){if(this.ranges=a,this.inverted=b,!a.length&&tq.empty)return tq.empty}recover(a){let b=0,c=65535&a;if(!this.inverted)for(let a=0;a<c;a++)b+=this.ranges[3*a+2]-this.ranges[3*a+1];return this.ranges[3*c]+b+(a-(65535&a))/65536}mapResult(a,b=1){return this._map(a,b,!1)}map(a,b=1){return this._map(a,b,!0)}_map(a,b,c){let d=0,e=this.inverted?2:1,f=this.inverted?1:2;for(let g=0;g<this.ranges.length;g+=3){let h=this.ranges[g]-(this.inverted?d:0);if(h>a)break;let i=this.ranges[g+e],j=this.ranges[g+f],k=h+i;if(a<=k){let e=i?a==h?-1:a==k?1:b:b,f=h+d+(e<0?0:j);if(c)return f;let l=a==(b<0?h:k)?null:g/3+(a-h)*65536,m=a==h?2:a==k?1:4;return(b<0?a!=h:a!=k)&&(m|=8),new tp(f,m,l)}d+=j-i}return c?a+d:new tp(a+d,0,null)}touches(a,b){let c=0,d=65535&b,e=this.inverted?2:1,f=this.inverted?1:2;for(let b=0;b<this.ranges.length;b+=3){let g=this.ranges[b]-(this.inverted?c:0);if(g>a)break;let h=this.ranges[b+e];if(a<=g+h&&b==3*d)return!0;c+=this.ranges[b+f]-h}return!1}forEach(a){let b=this.inverted?2:1,c=this.inverted?1:2;for(let d=0,e=0;d<this.ranges.length;d+=3){let f=this.ranges[d],g=f-(this.inverted?e:0),h=f+(this.inverted?0:e),i=this.ranges[d+b],j=this.ranges[d+c];a(g,g+i,h,h+j),e+=j-i}}invert(){return new tq(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(a){return 0==a?tq.empty:new tq(a<0?[0,-a,0]:[0,0,a])}}tq.empty=new tq([]);class tr{constructor(a,b,c=0,d=a?a.length:0){this.mirror=b,this.from=c,this.to=d,this._maps=a||[],this.ownData=!(a||b)}get maps(){return this._maps}slice(a=0,b=this.maps.length){return new tr(this._maps,this.mirror,a,b)}appendMap(a,b){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(a),null!=b&&this.setMirror(this._maps.length-1,b)}appendMapping(a){for(let b=0,c=this._maps.length;b<a._maps.length;b++){let d=a.getMirror(b);this.appendMap(a._maps[b],null!=d&&d<b?c+d:void 0)}}getMirror(a){if(this.mirror){for(let b=0;b<this.mirror.length;b++)if(this.mirror[b]==a)return this.mirror[b+(b%2?-1:1)]}}setMirror(a,b){this.mirror||(this.mirror=[]),this.mirror.push(a,b)}appendMappingInverted(a){for(let b=a.maps.length-1,c=this._maps.length+a._maps.length;b>=0;b--){let d=a.getMirror(b);this.appendMap(a._maps[b].invert(),null!=d&&d>b?c-d-1:void 0)}}invert(){let a=new tr;return a.appendMappingInverted(this),a}map(a,b=1){if(this.mirror)return this._map(a,b,!0);for(let c=this.from;c<this.to;c++)a=this._maps[c].map(a,b);return a}mapResult(a,b=1){return this._map(a,b,!1)}_map(a,b,c){let d=0;for(let c=this.from;c<this.to;c++){let e=this._maps[c].mapResult(a,b);if(null!=e.recover){let b=this.getMirror(c);if(null!=b&&b>c&&b<this.to){c=b,a=this._maps[b].recover(e.recover);continue}}d|=e.delInfo,a=e.pos}return c?a:new tp(a,d,null)}}let ts=Object.create(null);class tt{getMap(){return tq.empty}merge(a){return null}static fromJSON(a,b){if(!b||!b.stepType)throw RangeError("Invalid input for Step.fromJSON");let c=ts[b.stepType];if(!c)throw RangeError(`No step type ${b.stepType} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in ts)throw RangeError("Duplicate use of step JSON ID "+a);return ts[a]=b,b.prototype.jsonID=a,b}}class tu{constructor(a,b){this.doc=a,this.failed=b}static ok(a){return new tu(a,null)}static fail(a){return new tu(null,a)}static fromReplace(a,b,c,d){try{return tu.ok(a.replace(b,c,d))}catch(a){if(a instanceof sI)return tu.fail(a.message);throw a}}}function tv(a,b,c){let d=[];for(let e=0;e<a.childCount;e++){let f=a.child(e);f.content.size&&(f=f.copy(tv(f.content,b,f))),f.isInline&&(f=b(f,c,e)),d.push(f)}return sD.fromArray(d)}class tw extends tt{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=a.resolve(this.from),d=c.node(c.sharedDepth(this.to)),e=new sJ(tv(b.content,(a,b)=>a.isAtom&&b.type.allowsMarkType(this.mark.type)?a.mark(this.mark.addToSet(a.marks)):a,d),b.openStart,b.openEnd);return tu.fromReplace(a,this.from,this.to,e)}invert(){return new tx(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new tw(b.pos,c.pos,this.mark)}merge(a){return a instanceof tw&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new tw(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new tw(b.from,b.to,a.markFromJSON(b.mark))}}tt.jsonID("addMark",tw);class tx extends tt{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=new sJ(tv(b.content,a=>a.mark(this.mark.removeFromSet(a.marks)),a),b.openStart,b.openEnd);return tu.fromReplace(a,this.from,this.to,c)}invert(){return new tw(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new tx(b.pos,c.pos,this.mark)}merge(a){return a instanceof tx&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new tx(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new tx(b.from,b.to,a.markFromJSON(b.mark))}}tt.jsonID("removeMark",tx);class ty extends tt{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return tu.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.addToSet(b.marks));return tu.fromReplace(a,this.pos,this.pos+1,new sJ(sD.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);if(b){let a=this.mark.addToSet(b.marks);if(a.length==b.marks.length){for(let c=0;c<b.marks.length;c++)if(!b.marks[c].isInSet(a))return new ty(this.pos,b.marks[c]);return new ty(this.pos,this.mark)}}return new tz(this.pos,this.mark)}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new ty(b.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ty(b.pos,a.markFromJSON(b.mark))}}tt.jsonID("addNodeMark",ty);class tz extends tt{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return tu.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.removeFromSet(b.marks));return tu.fromReplace(a,this.pos,this.pos+1,new sJ(sD.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);return b&&this.mark.isInSet(b.marks)?new ty(this.pos,this.mark):this}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new tz(b.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tz(b.pos,a.markFromJSON(b.mark))}}tt.jsonID("removeNodeMark",tz);class tA extends tt{constructor(a,b,c,d=!1){super(),this.from=a,this.to=b,this.slice=c,this.structure=d}apply(a){return this.structure&&tC(a,this.from,this.to)?tu.fail("Structure replace would overwrite content"):tu.fromReplace(a,this.from,this.to,this.slice)}getMap(){return new tq([this.from,this.to-this.from,this.slice.size])}invert(a){return new tA(this.from,this.from+this.slice.size,a.slice(this.from,this.to))}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deletedAcross&&c.deletedAcross?null:new tA(b.pos,Math.max(b.pos,c.pos),this.slice,this.structure)}merge(a){if(!(a instanceof tA)||a.structure||this.structure)return null;if(this.from+this.slice.size!=a.from||this.slice.openEnd||a.slice.openStart)if(a.to!=this.from||this.slice.openStart||a.slice.openEnd)return null;else{let b=this.slice.size+a.slice.size==0?sJ.empty:new sJ(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new tA(a.from,this.to,b,this.structure)}{let b=this.slice.size+a.slice.size==0?sJ.empty:new sJ(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new tA(this.from,this.to+(a.to-a.from),b,this.structure)}}toJSON(){let a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new tA(b.from,b.to,sJ.fromJSON(a,b.slice),!!b.structure)}}tt.jsonID("replace",tA);class tB extends tt{constructor(a,b,c,d,e,f,g=!1){super(),this.from=a,this.to=b,this.gapFrom=c,this.gapTo=d,this.slice=e,this.insert=f,this.structure=g}apply(a){if(this.structure&&(tC(a,this.from,this.gapFrom)||tC(a,this.gapTo,this.to)))return tu.fail("Structure gap-replace would overwrite content");let b=a.slice(this.gapFrom,this.gapTo);if(b.openStart||b.openEnd)return tu.fail("Gap is not a flat range");let c=this.slice.insertAt(this.insert,b.content);return c?tu.fromReplace(a,this.from,this.to,c):tu.fail("Content does not fit in gap")}getMap(){return new tq([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(a){let b=this.gapTo-this.gapFrom;return new tB(this.from,this.from+this.slice.size+b,this.from+this.insert,this.from+this.insert+b,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1),d=this.from==this.gapFrom?b.pos:a.map(this.gapFrom,-1),e=this.to==this.gapTo?c.pos:a.map(this.gapTo,1);return b.deletedAcross&&c.deletedAcross||d<b.pos||e>c.pos?null:new tB(b.pos,c.pos,d,e,this.slice,this.insert,this.structure)}toJSON(){let a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to||"number"!=typeof b.gapFrom||"number"!=typeof b.gapTo||"number"!=typeof b.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new tB(b.from,b.to,b.gapFrom,b.gapTo,sJ.fromJSON(a,b.slice),b.insert,!!b.structure)}}function tC(a,b,c){let d=a.resolve(b),e=c-b,f=d.depth;for(;e>0&&f>0&&d.indexAfter(f)==d.node(f).childCount;)f--,e--;if(e>0){let a=d.node(f).maybeChild(d.indexAfter(f));for(;e>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,e--}}return!1}function tD(a,b,c,d=c.contentMatch,e=!0){let f=a.doc.nodeAt(b),g=[],h=b+1;for(let b=0;b<f.childCount;b++){let i=f.child(b),j=h+i.nodeSize,k=d.matchType(i.type);if(k){d=k;for(let b=0;b<i.marks.length;b++)c.allowsMarkType(i.marks[b].type)||a.step(new tx(h,j,i.marks[b]));if(e&&i.isText&&"pre"!=c.whitespace){let a,b=/\r?\n|\r/g,d;for(;a=b.exec(i.text);)d||(d=new sJ(sD.from(c.schema.text(" ",c.allowedMarks(i.marks))),0,0)),g.push(new tA(h+a.index,h+a.index+a[0].length,d))}}else g.push(new tA(h,j,sJ.empty));h=j}if(!d.validEnd){let b=d.fillBefore(sD.empty,!0);a.replace(h,h,new sJ(b,0,0))}for(let b=g.length-1;b>=0;b--)a.step(g[b])}function tE(a){let b=a.parent.content.cutByIndex(a.startIndex,a.endIndex);for(let c=a.depth,d=0,e=0;;--c){let f=a.$from.node(c),g=a.$from.index(c)+d,h=a.$to.indexAfter(c)-e;if(c<a.depth&&f.canReplace(g,h,b))return c;if(0==c||f.type.spec.isolating||!((0==g||f.canReplace(g,f.childCount))&&(h==f.childCount||f.canReplace(0,h))))break;g&&(d=1),h<f.childCount&&(e=1)}return null}function tF(a,b,c=null,d=a){let e=function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.contentMatchAt(d).findWrapping(b);if(!f)return null;let g=f.length?f[0]:b;return c.canReplaceWith(d,e,g)?f:null}(a,b),f=e&&function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.child(d),g=b.contentMatch.findWrapping(f.type);if(!g)return null;let h=(g.length?g[g.length-1]:b).contentMatch;for(let a=d;h&&a<e;a++)h=h.matchType(c.child(a).type);return h&&h.validEnd?g:null}(d,b);return f?e.map(tG).concat({type:b,attrs:c}).concat(f.map(tG)):null}function tG(a){return{type:a,attrs:null}}function tH(a,b,c,d){b.forEach((e,f)=>{if(e.isText){let g,h=/\r?\n|\r/g;for(;g=h.exec(e.text);){let e=a.mapping.slice(d).map(c+1+f+g.index);a.replaceWith(e,e+1,b.type.schema.linebreakReplacement.create())}}})}function tI(a,b,c,d){b.forEach((e,f)=>{if(e.type==e.type.schema.linebreakReplacement){let e=a.mapping.slice(d).map(c+1+f);a.replaceWith(e,e+1,b.type.schema.text("\n"))}})}function tJ(a,b,c=1,d){let e=a.resolve(b),f=e.depth-c,g=d&&d[d.length-1]||e.parent;if(f<0||e.parent.type.spec.isolating||!e.parent.canReplace(e.index(),e.parent.childCount)||!g.type.validContent(e.parent.content.cutByIndex(e.index(),e.parent.childCount)))return!1;for(let a=e.depth-1,b=c-2;a>f;a--,b--){let c=e.node(a),f=e.index(a);if(c.type.spec.isolating)return!1;let g=c.content.cutByIndex(f,c.childCount),h=d&&d[b+1];h&&(g=g.replaceChild(0,h.type.create(h.attrs)));let i=d&&d[b]||c;if(!c.canReplace(f+1,c.childCount)||!i.type.validContent(g))return!1}let h=e.indexAfter(f),i=d&&d[0];return e.node(f).canReplaceWith(h,h,i?i.type:e.node(f+1).type)}function tK(a,b){let c=a.resolve(b),d=c.index();return tL(c.nodeBefore,c.nodeAfter)&&c.parent.canReplace(d,d+1)}function tL(a,b){return!!(a&&b&&!a.isLeaf&&function(a,b){b.content.size||a.type.compatibleContent(b.type);let c=a.contentMatchAt(a.childCount),{linebreakReplacement:d}=a.type.schema;for(let e=0;e<b.childCount;e++){let f=b.child(e),g=f.type==d?a.type.schema.nodes.text:f.type;if(!(c=c.matchType(g))||!a.type.allowsMarks(f.marks))return!1}return c.validEnd}(a,b))}function tM(a,b,c=-1){let d=a.resolve(b);for(let a=d.depth;;a--){let e,f,g=d.index(a);if(a==d.depth?(e=d.nodeBefore,f=d.nodeAfter):c>0?(e=d.node(a+1),g++,f=d.node(a).maybeChild(g)):(e=d.node(a).maybeChild(g-1),f=d.node(a+1)),e&&!e.isTextblock&&tL(e,f)&&d.node(a).canReplace(g,g+1))return b;if(0==a)break;b=c<0?d.before(a):d.after(a)}}function tN(a,b,c){let d=a.resolve(b);if(!c.content.size)return b;let e=c.content;for(let a=0;a<c.openStart;a++)e=e.firstChild.content;for(let a=1;a<=(0==c.openStart&&c.size?2:1);a++)for(let b=d.depth;b>=0;b--){let c=b==d.depth?0:d.pos<=(d.start(b+1)+d.end(b+1))/2?-1:1,f=d.index(b)+ +(c>0),g=d.node(b),h=!1;if(1==a)h=g.canReplace(f,f,e);else{let a=g.contentMatchAt(f).findWrapping(e.firstChild.type);h=a&&g.canReplaceWith(f,f,a[0])}if(h)return 0==c?d.pos:c<0?d.before(b+1):d.after(b+1)}return null}function tO(a,b,c=b,d=sJ.empty){if(b==c&&!d.size)return null;let e=a.resolve(b),f=a.resolve(c);return tP(e,f,d)?new tA(b,c,d):new tQ(e,f,d).fit()}function tP(a,b,c){return!c.openStart&&!c.openEnd&&a.start()==b.start()&&a.parent.canReplace(a.index(),b.index(),c.content)}tt.jsonID("replaceAround",tB);class tQ{constructor(a,b,c){this.$from=a,this.$to=b,this.unplaced=c,this.frontier=[],this.placed=sD.empty;for(let b=0;b<=a.depth;b++){let c=a.node(b);this.frontier.push({type:c.type,match:c.contentMatchAt(a.indexAfter(b))})}for(let b=a.depth;b>0;b--)this.placed=sD.from(a.node(b).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let a=this.mustMoveInline(),b=this.placed.size-this.depth-this.$from.depth,c=this.$from,d=this.close(a<0?this.$to:c.doc.resolve(a));if(!d)return null;let e=this.placed,f=c.depth,g=d.depth;for(;f&&g&&1==e.childCount;)e=e.firstChild.content,f--,g--;let h=new sJ(e,f,g);return a>-1?new tB(c.pos,a,this.$to.pos,this.$to.end(),h,b):h.size||c.pos!=this.$to.pos?new tA(c.pos,d.pos,h):null}findFittable(){let a=this.unplaced.openStart;for(let b=this.unplaced.content,c=0,d=this.unplaced.openEnd;c<a;c++){let e=b.firstChild;if(b.childCount>1&&(d=0),e.type.spec.isolating&&d<=c){a=c;break}b=e.content}for(let b=1;b<=2;b++)for(let c=1==b?a:this.unplaced.openStart;c>=0;c--){let a=null,d=(c?(a=tT(this.unplaced.content,c-1).firstChild).content:this.unplaced.content).firstChild;for(let e=this.depth;e>=0;e--){let{type:f,match:g}=this.frontier[e],h,i=null;if(1==b&&(d?g.matchType(d.type)||(i=g.fillBefore(sD.from(d),!1)):a&&f.compatibleContent(a.type)))return{sliceDepth:c,frontierDepth:e,parent:a,inject:i};if(2==b&&d&&(h=g.findWrapping(d.type)))return{sliceDepth:c,frontierDepth:e,parent:a,wrap:h};if(a&&g.matchType(a.type))break}}}openMore(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=tT(a,b);return!!d.childCount&&!d.firstChild.isLeaf&&(this.unplaced=new sJ(a,b+1,Math.max(c,d.size+b>=a.size-c?b+1:0)),!0)}dropNode(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=tT(a,b);if(d.childCount<=1&&b>0){let e=a.size-b<=b+d.size;this.unplaced=new sJ(tR(a,b-1,1),b-1,e?b-1:c)}else this.unplaced=new sJ(tR(a,b,1),b,c)}placeNodes({sliceDepth:a,frontierDepth:b,parent:c,inject:d,wrap:e}){for(;this.depth>b;)this.closeFrontierNode();if(e)for(let a=0;a<e.length;a++)this.openFrontierNode(e[a]);let f=this.unplaced,g=c?c.content:f.content,h=f.openStart-a,i=0,j=[],{match:k,type:l}=this.frontier[b];if(d){for(let a=0;a<d.childCount;a++)j.push(d.child(a));k=k.matchFragment(d)}let m=g.size+a-(f.content.size-f.openEnd);for(;i<g.childCount;){let a=g.child(i),b=k.matchType(a.type);if(!b)break;(++i>1||0==h||a.content.size)&&(k=b,j.push(function a(b,c,d){if(c<=0)return b;let e=b.content;return c>1&&(e=e.replaceChild(0,a(e.firstChild,c-1,1==e.childCount?d-1:0))),c>0&&(e=b.type.contentMatch.fillBefore(e).append(e),d<=0&&(e=e.append(b.type.contentMatch.matchFragment(e).fillBefore(sD.empty,!0)))),b.copy(e)}(a.mark(l.allowedMarks(a.marks)),1==i?h:0,i==g.childCount?m:-1)))}let n=i==g.childCount;n||(m=-1),this.placed=tS(this.placed,b,sD.from(j)),this.frontier[b].match=k,n&&m<0&&c&&c.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let a=0,b=g;a<m;a++){let a=b.lastChild;this.frontier.push({type:a.type,match:a.contentMatchAt(a.childCount)}),b=a.content}this.unplaced=n?0==a?sJ.empty:new sJ(tR(f.content,a-1,1),a-1,m<0?f.openEnd:a-1):new sJ(tR(f.content,a,i),f.openStart,f.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let a=this.frontier[this.depth],b;if(!a.type.isTextblock||!tU(this.$to,this.$to.depth,a.type,a.match,!1)||this.$to.depth==this.depth&&(b=this.findCloseLevel(this.$to))&&b.depth==this.depth)return -1;let{depth:c}=this.$to,d=this.$to.after(c);for(;c>1&&d==this.$to.end(--c);)++d;return d}findCloseLevel(a){g:for(let b=Math.min(this.depth,a.depth);b>=0;b--){let{match:c,type:d}=this.frontier[b],e=b<a.depth&&a.end(b+1)==a.pos+(a.depth-(b+1)),f=tU(a,b,d,c,e);if(f){for(let c=b-1;c>=0;c--){let{match:b,type:d}=this.frontier[c],e=tU(a,c,d,b,!0);if(!e||e.childCount)continue g}return{depth:b,fit:f,move:e?a.doc.resolve(a.after(b+1)):a}}}}close(a){let b=this.findCloseLevel(a);if(!b)return null;for(;this.depth>b.depth;)this.closeFrontierNode();b.fit.childCount&&(this.placed=tS(this.placed,b.depth,b.fit)),a=b.move;for(let c=b.depth+1;c<=a.depth;c++){let b=a.node(c),d=b.type.contentMatch.fillBefore(b.content,!0,a.index(c));this.openFrontierNode(b.type,b.attrs,d)}return a}openFrontierNode(a,b=null,c){let d=this.frontier[this.depth];d.match=d.match.matchType(a),this.placed=tS(this.placed,this.depth,sD.from(a.create(b,c))),this.frontier.push({type:a,match:a.contentMatch})}closeFrontierNode(){let a=this.frontier.pop().match.fillBefore(sD.empty,!0);a.childCount&&(this.placed=tS(this.placed,this.frontier.length,a))}}function tR(a,b,c){return 0==b?a.cutByIndex(c,a.childCount):a.replaceChild(0,a.firstChild.copy(tR(a.firstChild.content,b-1,c)))}function tS(a,b,c){return 0==b?a.append(c):a.replaceChild(a.childCount-1,a.lastChild.copy(tS(a.lastChild.content,b-1,c)))}function tT(a,b){for(let c=0;c<b;c++)a=a.firstChild.content;return a}function tU(a,b,c,d,e){let f=a.node(b),g=e?a.indexAfter(b):a.index(b);if(g==f.childCount&&!c.compatibleContent(f.type))return null;let h=d.fillBefore(f.content,!0,g);return h&&!function(a,b,c){for(let d=c;d<b.childCount;d++)if(!a.allowsMarks(b.child(d).marks))return!0;return!1}(c,f.content,g)?h:null}function tV(a,b){let c=[],d=Math.min(a.depth,b.depth);for(let e=d;e>=0;e--){let d=a.start(e);if(d<a.pos-(a.depth-e)||b.end(e)>b.pos+(b.depth-e)||a.node(e).type.spec.isolating||b.node(e).type.spec.isolating)break;(d==b.start(e)||e==a.depth&&e==b.depth&&a.parent.inlineContent&&b.parent.inlineContent&&e&&b.start(e-1)==d-1)&&c.push(e)}return c}class tW extends tt{constructor(a,b,c){super(),this.pos=a,this.attr=b,this.value=c}apply(a){let b=a.nodeAt(this.pos);if(!b)return tu.fail("No node at attribute step's position");let c=Object.create(null);for(let a in b.attrs)c[a]=b.attrs[a];c[this.attr]=this.value;let d=b.type.create(c,null,b.marks);return tu.fromReplace(a,this.pos,this.pos+1,new sJ(sD.from(d),0,+!b.isLeaf))}getMap(){return tq.empty}invert(a){return new tW(this.pos,this.attr,a.nodeAt(this.pos).attrs[this.attr])}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new tW(b.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(a,b){if("number"!=typeof b.pos||"string"!=typeof b.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new tW(b.pos,b.attr,b.value)}}tt.jsonID("attr",tW);class tX extends tt{constructor(a,b){super(),this.attr=a,this.value=b}apply(a){let b=Object.create(null);for(let c in a.attrs)b[c]=a.attrs[c];b[this.attr]=this.value;let c=a.type.create(b,a.content,a.marks);return tu.ok(c)}getMap(){return tq.empty}invert(a){return new tX(this.attr,a.attrs[this.attr])}map(a){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(a,b){if("string"!=typeof b.attr)throw RangeError("Invalid input for DocAttrStep.fromJSON");return new tX(b.attr,b.value)}}tt.jsonID("docAttr",tX);let tY=class extends Error{};(tY=function a(b){let c=Error.call(this,b);return c.__proto__=a.prototype,c}).prototype=Object.create(Error.prototype),tY.prototype.constructor=tY,tY.prototype.name="TransformError";class tZ{constructor(a){this.doc=a,this.steps=[],this.docs=[],this.mapping=new tr}get before(){return this.docs.length?this.docs[0]:this.doc}step(a){let b=this.maybeStep(a);if(b.failed)throw new tY(b.failed);return this}maybeStep(a){let b=a.apply(this.doc);return b.failed||this.addStep(a,b.doc),b}get docChanged(){return this.steps.length>0}changedRange(){let a=1e9,b=-1e9;for(let c=0;c<this.mapping.maps.length;c++){let d=this.mapping.maps[c];c&&(a=d.map(a,1),b=d.map(b,-1)),d.forEach((c,d,e,f)=>{a=Math.min(a,e),b=Math.max(b,f)})}return 1e9==a?null:{from:a,to:b}}addStep(a,b){this.docs.push(this.doc),this.steps.push(a),this.mapping.appendMap(a.getMap()),this.doc=b}replace(a,b=a,c=sJ.empty){let d=tO(this.doc,a,b,c);return d&&this.step(d),this}replaceWith(a,b,c){return this.replace(a,b,new sJ(sD.from(c),0,0))}delete(a,b){return this.replace(a,b,sJ.empty)}insert(a,b){return this.replaceWith(a,a,b)}replaceRange(a,b,c){return!function(a,b,c,d){if(!d.size)return a.deleteRange(b,c);let e=a.doc.resolve(b),f=a.doc.resolve(c);if(tP(e,f,d))return a.step(new tA(b,c,d));let g=tV(e,f);0==g[g.length-1]&&g.pop();let h=-(e.depth+1);g.unshift(h);for(let a=e.depth,b=e.pos-1;a>0;a--,b--){let c=e.node(a).type.spec;if(c.defining||c.definingAsContext||c.isolating)break;g.indexOf(a)>-1?h=a:e.before(a)==b&&g.splice(1,0,-a)}let i=g.indexOf(h),j=[],k=d.openStart;for(let a=d.content,b=0;;b++){let c=a.firstChild;if(j.push(c),b==d.openStart)break;a=c.content}for(let a=k-1;a>=0;a--){var l;let b=j[a],c=(l=b.type).spec.defining||l.spec.definingForContent;if(c&&!b.sameMarkup(e.node(Math.abs(h)-1)))k=a;else if(c||!b.type.isTextblock)break}for(let b=d.openStart;b>=0;b--){let h=(b+k+1)%(d.openStart+1),l=j[h];if(l)for(let b=0;b<g.length;b++){let j=g[(b+i)%g.length],k=!0;j<0&&(k=!1,j=-j);let m=e.node(j-1),n=e.index(j-1);if(m.canReplaceWith(n,n,l.type,l.marks))return a.replace(e.before(j),k?f.after(j):c,new sJ(function a(b,c,d,e,f){if(c<d){let f=b.firstChild;b=b.replaceChild(0,f.copy(a(f.content,c+1,d,e,f)))}if(c>e){let a=f.contentMatchAt(0),c=a.fillBefore(b).append(b);b=c.append(a.matchFragment(c).fillBefore(sD.empty,!0))}return b}(d.content,0,d.openStart,h),h,d.openEnd))}}let m=a.steps.length;for(let h=g.length-1;h>=0&&(a.replace(b,c,d),!(a.steps.length>m));h--){let a=g[h];a<0||(b=e.before(a),c=f.after(a))}}(this,a,b,c),this}replaceRangeWith(a,b,c){var d=a,e=b;if(!c.isInline&&d==e&&this.doc.resolve(d).parent.content.size){let a=function(a,b,c){let d=a.resolve(b);if(d.parent.canReplaceWith(d.index(),d.index(),c))return b;if(0==d.parentOffset)for(let a=d.depth-1;a>=0;a--){let b=d.index(a);if(d.node(a).canReplaceWith(b,b,c))return d.before(a+1);if(b>0)return null}if(d.parentOffset==d.parent.content.size)for(let a=d.depth-1;a>=0;a--){let b=d.indexAfter(a);if(d.node(a).canReplaceWith(b,b,c))return d.after(a+1);if(b<d.node(a).childCount)break}return null}(this.doc,d,c.type);null!=a&&(d=e=a)}return this.replaceRange(d,e,new sJ(sD.from(c),0,0)),this}deleteRange(a,b){return!function(a,b,c){let d=a.doc.resolve(b),e=a.doc.resolve(c),f=tV(d,e);for(let b=0;b<f.length;b++){let c=f[b],g=b==f.length-1;if(g&&0==c||d.node(c).type.contentMatch.validEnd)return a.delete(d.start(c),e.end(c));if(c>0&&(g||d.node(c-1).canReplace(d.index(c-1),e.indexAfter(c-1))))return a.delete(d.before(c),e.after(c))}for(let f=1;f<=d.depth&&f<=e.depth;f++)if(b-d.start(f)==d.depth-f&&c>d.end(f)&&e.end(f)-c!=e.depth-f&&d.start(f-1)==e.start(f-1)&&d.node(f-1).canReplace(d.index(f-1),e.index(f-1)))return a.delete(d.before(f),c);a.delete(b,c)}(this,a,b),this}lift(a,b){return!function(a,b,c){let{$from:d,$to:e,depth:f}=b,g=d.before(f+1),h=e.after(f+1),i=g,j=h,k=sD.empty,l=0;for(let a=f,b=!1;a>c;a--)b||d.index(a)>0?(b=!0,k=sD.from(d.node(a).copy(k)),l++):i--;let m=sD.empty,n=0;for(let a=f,b=!1;a>c;a--)b||e.after(a+1)<e.end(a)?(b=!0,m=sD.from(e.node(a).copy(m)),n++):j++;a.step(new tB(i,j,g,h,new sJ(k.append(m),l,n),k.size-l,!0))}(this,a,b),this}join(a,b=1){return!function(a,b,c){let d=null,{linebreakReplacement:e}=a.doc.type.schema,f=a.doc.resolve(b-c),g=f.node().type;if(e&&g.inlineContent){let a="pre"==g.whitespace,b=!!g.contentMatch.matchType(e);a&&!b?d=!1:!a&&b&&(d=!0)}let h=a.steps.length;if(!1===d){let d=a.doc.resolve(b+c);tI(a,d.node(),d.before(),h)}g.inlineContent&&tD(a,b+c-1,g,f.node().contentMatchAt(f.index()),null==d);let i=a.mapping.slice(h),j=i.map(b-c);if(a.step(new tA(j,i.map(b+c,-1),sJ.empty,!0)),!0===d){let b=a.doc.resolve(j);tH(a,b.node(),b.before(),a.steps.length)}}(this,a,b),this}wrap(a,b){return!function(a,b,c){let d=sD.empty;for(let a=c.length-1;a>=0;a--){if(d.size){let b=c[a].type.contentMatch.matchFragment(d);if(!b||!b.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}d=sD.from(c[a].type.create(c[a].attrs,d))}let e=b.start,f=b.end;a.step(new tB(e,f,e,f,new sJ(d,0,0),c.length,!0))}(this,a,b),this}setBlockType(a,b=a,c,d=null){var e=this;if(!c.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let f=e.steps.length;return e.doc.nodesBetween(a,b,(a,b)=>{var g,h,i;let j,k,l="function"==typeof d?d(a):d;if(a.isTextblock&&!a.hasMarkup(c,l)&&(g=e.doc,h=e.mapping.slice(f).map(b),i=c,k=(j=g.resolve(h)).index(),j.parent.canReplaceWith(k,k+1,i))){let d=null;if(c.schema.linebreakReplacement){let a="pre"==c.whitespace,b=!!c.contentMatch.matchType(c.schema.linebreakReplacement);a&&!b?d=!1:!a&&b&&(d=!0)}!1===d&&tI(e,a,b,f),tD(e,e.mapping.slice(f).map(b,1),c,void 0,null===d);let g=e.mapping.slice(f),h=g.map(b,1),i=g.map(b+a.nodeSize,1);return e.step(new tB(h,i,h+1,i-1,new sJ(sD.from(c.create(l,null,a.marks)),0,0),1,!0)),!0===d&&tH(e,a,b,f),!1}}),this}setNodeMarkup(a,b,c=null,d){return!function(a,b,c,d,e){let f=a.doc.nodeAt(b);if(!f)throw RangeError("No node at given position");c||(c=f.type);let g=c.create(d,null,e||f.marks);if(f.isLeaf)return a.replaceWith(b,b+f.nodeSize,g);if(!c.validContent(f.content))throw RangeError("Invalid content for node type "+c.name);a.step(new tB(b,b+f.nodeSize,b+1,b+f.nodeSize-1,new sJ(sD.from(g),0,0),1,!0))}(this,a,b,c,d),this}setNodeAttribute(a,b,c){return this.step(new tW(a,b,c)),this}setDocAttribute(a,b){return this.step(new tX(a,b)),this}addNodeMark(a,b){return this.step(new ty(a,b)),this}removeNodeMark(a,b){let c=this.doc.nodeAt(a);if(!c)throw RangeError("No node at position "+a);if(b instanceof sH)b.isInSet(c.marks)&&this.step(new tz(a,b));else{let d=c.marks,e,f=[];for(;e=b.isInSet(d);)f.push(new tz(a,e)),d=e.removeFromSet(d);for(let a=f.length-1;a>=0;a--)this.step(f[a])}return this}split(a,b=1,c){return!function(a,b,c=1,d){let e=a.doc.resolve(b),f=sD.empty,g=sD.empty;for(let a=e.depth,b=e.depth-c,h=c-1;a>b;a--,h--){f=sD.from(e.node(a).copy(f));let b=d&&d[h];g=sD.from(b?b.type.create(b.attrs,g):e.node(a).copy(g))}a.step(new tA(b,b,new sJ(f.append(g),c,c),!0))}(this,a,b,c),this}addMark(a,b,c){var d;let e,f,g,h;return d=this,g=[],h=[],d.doc.nodesBetween(a,b,(d,i,j)=>{if(!d.isInline)return;let k=d.marks;if(!c.isInSet(k)&&j.type.allowsMarkType(c.type)){let j=Math.max(i,a),l=Math.min(i+d.nodeSize,b),m=c.addToSet(k);for(let a=0;a<k.length;a++)k[a].isInSet(m)||(e&&e.to==j&&e.mark.eq(k[a])?e.to=l:g.push(e=new tx(j,l,k[a])));f&&f.to==j?f.to=l:h.push(f=new tw(j,l,c))}}),g.forEach(a=>d.step(a)),h.forEach(a=>d.step(a)),this}removeMark(a,b,c){var d;let e,f;return d=this,e=[],f=0,d.doc.nodesBetween(a,b,(d,g)=>{if(!d.isInline)return;f++;let h=null;if(c instanceof s8){let a=d.marks,b;for(;b=c.isInSet(a);)(h||(h=[])).push(b),a=b.removeFromSet(a)}else c?c.isInSet(d.marks)&&(h=[c]):h=d.marks;if(h&&h.length){let c=Math.min(g+d.nodeSize,b);for(let b=0;b<h.length;b++){let d=h[b],i;for(let a=0;a<e.length;a++){let b=e[a];b.step==f-1&&d.eq(e[a].style)&&(i=b)}i?(i.to=c,i.step=f):e.push({style:d,from:Math.max(g,a),to:c,step:f})}}}),e.forEach(a=>d.step(new tx(a.from,a.to,a.style))),this}clearIncompatible(a,b,c){return tD(this,a,b,c),this}}let t$=Object.create(null);class t_{constructor(a,b,c){this.$anchor=a,this.$head=b,this.ranges=c||[new t0(a.min(b),a.max(b))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let a=this.ranges;for(let b=0;b<a.length;b++)if(a[b].$from.pos!=a[b].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(a,b=sJ.empty){let c=b.content.lastChild,d=null;for(let a=0;a<b.openEnd;a++)d=c,c=c.lastChild;let e=a.steps.length,f=this.ranges;for(let g=0;g<f.length;g++){let{$from:h,$to:i}=f[g],j=a.mapping.slice(e);a.replaceRange(j.map(h.pos),j.map(i.pos),g?sJ.empty:b),0==g&&ua(a,e,(c?c.isInline:d&&d.isTextblock)?-1:1)}}replaceWith(a,b){let c=a.steps.length,d=this.ranges;for(let e=0;e<d.length;e++){let{$from:f,$to:g}=d[e],h=a.mapping.slice(c),i=h.map(f.pos),j=h.map(g.pos);e?a.deleteRange(i,j):(a.replaceRangeWith(i,j,b),ua(a,c,b.isInline?-1:1))}}static findFrom(a,b,c=!1){let d=a.parent.inlineContent?new t3(a):t9(a.node(0),a.parent,a.pos,a.index(),b,c);if(d)return d;for(let d=a.depth-1;d>=0;d--){let e=b<0?t9(a.node(0),a.node(d),a.before(d+1),a.index(d),b,c):t9(a.node(0),a.node(d),a.after(d+1),a.index(d)+1,b,c);if(e)return e}return null}static near(a,b=1){return this.findFrom(a,b)||this.findFrom(a,-b)||new t7(a.node(0))}static atStart(a){return t9(a,a,0,0,1)||new t7(a)}static atEnd(a){return t9(a,a,a.content.size,a.childCount,-1)||new t7(a)}static fromJSON(a,b){if(!b||!b.type)throw RangeError("Invalid input for Selection.fromJSON");let c=t$[b.type];if(!c)throw RangeError(`No selection type ${b.type} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in t$)throw RangeError("Duplicate use of selection JSON ID "+a);return t$[a]=b,b.prototype.jsonID=a,b}getBookmark(){return t3.between(this.$anchor,this.$head).getBookmark()}}t_.prototype.visible=!0;class t0{constructor(a,b){this.$from=a,this.$to=b}}let t1=!1;function t2(a){t1||a.parent.inlineContent||(t1=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+a.parent.type.name+")"))}class t3 extends t_{constructor(a,b=a){t2(a),t2(b),super(a,b)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(a,b){let c=a.resolve(b.map(this.head));if(!c.parent.inlineContent)return t_.near(c);let d=a.resolve(b.map(this.anchor));return new t3(d.parent.inlineContent?d:c,c)}replace(a,b=sJ.empty){if(super.replace(a,b),b==sJ.empty){let b=this.$from.marksAcross(this.$to);b&&a.ensureMarks(b)}}eq(a){return a instanceof t3&&a.anchor==this.anchor&&a.head==this.head}getBookmark(){return new t4(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(a,b){if("number"!=typeof b.anchor||"number"!=typeof b.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new t3(a.resolve(b.anchor),a.resolve(b.head))}static create(a,b,c=b){let d=a.resolve(b);return new this(d,c==b?d:a.resolve(c))}static between(a,b,c){let d=a.pos-b.pos;if((!c||d)&&(c=d>=0?1:-1),!b.parent.inlineContent){let a=t_.findFrom(b,c,!0)||t_.findFrom(b,-c,!0);if(!a)return t_.near(b,c);b=a.$head}return a.parent.inlineContent||(0==d?a=b:(a=(t_.findFrom(a,-c,!0)||t_.findFrom(a,c,!0)).$anchor).pos<b.pos!=d<0&&(a=b)),new t3(a,b)}}t_.jsonID("text",t3);class t4{constructor(a,b){this.anchor=a,this.head=b}map(a){return new t4(a.map(this.anchor),a.map(this.head))}resolve(a){return t3.between(a.resolve(this.anchor),a.resolve(this.head))}}class t5 extends t_{constructor(a){let b=a.nodeAfter,c=a.node(0).resolve(a.pos+b.nodeSize);super(a,c),this.node=b}map(a,b){let{deleted:c,pos:d}=b.mapResult(this.anchor),e=a.resolve(d);return c?t_.near(e):new t5(e)}content(){return new sJ(sD.from(this.node),0,0)}eq(a){return a instanceof t5&&a.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new t6(this.anchor)}static fromJSON(a,b){if("number"!=typeof b.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new t5(a.resolve(b.anchor))}static create(a,b){return new t5(a.resolve(b))}static isSelectable(a){return!a.isText&&!1!==a.type.spec.selectable}}t5.prototype.visible=!1,t_.jsonID("node",t5);class t6{constructor(a){this.anchor=a}map(a){let{deleted:b,pos:c}=a.mapResult(this.anchor);return b?new t4(c,c):new t6(c)}resolve(a){let b=a.resolve(this.anchor),c=b.nodeAfter;return c&&t5.isSelectable(c)?new t5(b):t_.near(b)}}class t7 extends t_{constructor(a){super(a.resolve(0),a.resolve(a.content.size))}replace(a,b=sJ.empty){if(b==sJ.empty){a.delete(0,a.doc.content.size);let b=t_.atStart(a.doc);b.eq(a.selection)||a.setSelection(b)}else super.replace(a,b)}toJSON(){return{type:"all"}}static fromJSON(a){return new t7(a)}map(a){return new t7(a)}eq(a){return a instanceof t7}getBookmark(){return t8}}t_.jsonID("all",t7);let t8={map(){return this},resolve:a=>new t7(a)};function t9(a,b,c,d,e,f=!1){if(b.inlineContent)return t3.create(a,c);for(let g=d-(e>0?0:1);e>0?g<b.childCount:g>=0;g+=e){let d=b.child(g);if(d.isAtom){if(!f&&t5.isSelectable(d))return t5.create(a,c-(e<0?d.nodeSize:0))}else{let b=t9(a,d,c+e,e<0?d.childCount:0,e,f);if(b)return b}c+=d.nodeSize*e}return null}function ua(a,b,c){let d,e=a.steps.length-1;if(e<b)return;let f=a.steps[e];(f instanceof tA||f instanceof tB)&&(a.mapping.maps[e].forEach((a,b,c,e)=>{null==d&&(d=e)}),a.setSelection(t_.near(a.doc.resolve(d),c)))}class ub extends tZ{constructor(a){super(a.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=a.selection,this.storedMarks=a.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(a){if(a.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(a){return this.storedMarks=a,this.updated|=2,this}ensureMarks(a){return sH.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this}addStoredMark(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(a,b){super.addStep(a,b),this.updated=-3&this.updated,this.storedMarks=null}setTime(a){return this.time=a,this}replaceSelection(a){return this.selection.replace(this,a),this}replaceSelectionWith(a,b=!0){let c=this.selection;return b&&(a=a.mark(this.storedMarks||(c.empty?c.$from.marks():c.$from.marksAcross(c.$to)||sH.none))),c.replaceWith(this,a),this}deleteSelection(){return this.selection.replace(this),this}insertText(a,b,c){let d=this.doc.type.schema;if(null==b)return a?this.replaceSelectionWith(d.text(a),!0):this.deleteSelection();{if(null==c&&(c=b),!a)return this.deleteRange(b,c);let e=this.storedMarks;if(!e){let a=this.doc.resolve(b);e=c==b?a.marks():a.marksAcross(this.doc.resolve(c))}return this.replaceRangeWith(b,c,d.text(a,e)),this.selection.empty||this.selection.to!=b+a.length||this.setSelection(t_.near(this.selection.$to)),this}}setMeta(a,b){return this.meta["string"==typeof a?a:a.key]=b,this}getMeta(a){return this.meta["string"==typeof a?a:a.key]}get isGeneric(){for(let a in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function uc(a,b){return b&&a?a.bind(b):a}class ud{constructor(a,b,c){this.name=a,this.init=uc(b.init,c),this.apply=uc(b.apply,c)}}let ue=[new ud("doc",{init:a=>a.doc||a.schema.topNodeType.createAndFill(),apply:a=>a.doc}),new ud("selection",{init:(a,b)=>a.selection||t_.atStart(b.doc),apply:a=>a.selection}),new ud("storedMarks",{init:a=>a.storedMarks||null,apply:(a,b,c,d)=>d.selection.$cursor?a.storedMarks:null}),new ud("scrollToSelection",{init:()=>0,apply:(a,b)=>a.scrolledIntoView?b+1:b})];class uf{constructor(a,b){this.schema=a,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=ue.slice(),b&&b.forEach(a=>{if(this.pluginsByKey[a.key])throw RangeError("Adding different instances of a keyed plugin ("+a.key+")");this.plugins.push(a),this.pluginsByKey[a.key]=a,a.spec.state&&this.fields.push(new ud(a.key,a.spec.state,a))})}}class ug{constructor(a){this.config=a}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(a){return this.applyTransaction(a).state}filterTransaction(a,b=-1){for(let c=0;c<this.config.plugins.length;c++)if(c!=b){let b=this.config.plugins[c];if(b.spec.filterTransaction&&!b.spec.filterTransaction.call(b,a,this))return!1}return!0}applyTransaction(a){if(!this.filterTransaction(a))return{state:this,transactions:[]};let b=[a],c=this.applyInner(a),d=null;for(;;){let e=!1;for(let f=0;f<this.config.plugins.length;f++){let g=this.config.plugins[f];if(g.spec.appendTransaction){let h=d?d[f].n:0,i=d?d[f].state:this,j=h<b.length&&g.spec.appendTransaction.call(g,h?b.slice(h):b,i,c);if(j&&c.filterTransaction(j,f)){if(j.setMeta("appendedTransaction",a),!d){d=[];for(let a=0;a<this.config.plugins.length;a++)d.push(a<f?{state:c,n:b.length}:{state:this,n:0})}b.push(j),c=c.applyInner(j),e=!0}d&&(d[f]={state:c,n:b.length})}}if(!e)return{state:c,transactions:b}}}applyInner(a){if(!a.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let b=new ug(this.config),c=this.config.fields;for(let d=0;d<c.length;d++){let e=c[d];b[e.name]=e.apply(a,this[e.name],this,b)}return b}get tr(){return new ub(this)}static create(a){let b=new uf(a.doc?a.doc.type.schema:a.schema,a.plugins),c=new ug(b);for(let d=0;d<b.fields.length;d++)c[b.fields[d].name]=b.fields[d].init(a,c);return c}reconfigure(a){let b=new uf(this.schema,a.plugins),c=b.fields,d=new ug(b);for(let b=0;b<c.length;b++){let e=c[b].name;d[e]=this.hasOwnProperty(e)?this[e]:c[b].init(a,d)}return d}toJSON(a){let b={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(b.storedMarks=this.storedMarks.map(a=>a.toJSON())),a&&"object"==typeof a)for(let c in a){if("doc"==c||"selection"==c)throw RangeError("The JSON fields `doc` and `selection` are reserved");let d=a[c],e=d.spec.state;e&&e.toJSON&&(b[c]=e.toJSON.call(d,this[d.key]))}return b}static fromJSON(a,b,c){if(!b)throw RangeError("Invalid input for EditorState.fromJSON");if(!a.schema)throw RangeError("Required config field 'schema' missing");let d=new uf(a.schema,a.plugins),e=new ug(d);return d.fields.forEach(d=>{if("doc"==d.name)e.doc=sW.fromJSON(a.schema,b.doc);else if("selection"==d.name)e.selection=t_.fromJSON(e.doc,b.selection);else if("storedMarks"==d.name)b.storedMarks&&(e.storedMarks=b.storedMarks.map(a.schema.markFromJSON));else{if(c)for(let f in c){let g=c[f],h=g.spec.state;if(g.key==d.name&&h&&h.fromJSON&&Object.prototype.hasOwnProperty.call(b,f)){e[d.name]=h.fromJSON.call(g,a,b[f],e);return}}e[d.name]=d.init(a,e)}}),e}}class uh{constructor(a){this.spec=a,this.props={},a.props&&function a(b,c,d){for(let e in b){let f=b[e];f instanceof Function?f=f.bind(c):"handleDOMEvents"==e&&(f=a(f,c,{})),d[e]=f}return d}(a.props,this,this.props),this.key=a.key?a.key.key:uj("plugin")}getState(a){return a[this.key]}}let ui=Object.create(null);function uj(a){return a in ui?a+"$"+ ++ui[a]:(ui[a]=0,a+"$")}class uk{constructor(a="key"){this.key=uj(a)}get(a){return a.config.pluginsByKey[this.key]}getState(a){return a[this.key]}}let ul=(a,b)=>!a.selection.empty&&(b&&b(a.tr.deleteSelection().scrollIntoView()),!0);function um(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("backward",a):!(c.parentOffset>0))?c:null}let un=(a,b,c)=>{let d=um(a,c);if(!d)return!1;let e=ur(d);if(!e){let c=d.blockRange(),e=c&&tE(c);return null!=e&&(b&&b(a.tr.lift(c,e).scrollIntoView()),!0)}let f=e.nodeBefore;if(uB(a,e,b,-1))return!0;if(0==d.parent.content.size&&(up(f,"end")||t5.isSelectable(f)))for(let c=d.depth;;c--){let g=tO(a.doc,d.before(c),d.after(c),sJ.empty);if(g&&g.slice.size<g.to-g.from){if(b){let c=a.tr.step(g);c.setSelection(up(f,"end")?t_.findFrom(c.doc.resolve(c.mapping.map(e.pos,-1)),-1):t5.create(c.doc,e.pos-f.nodeSize)),b(c.scrollIntoView())}return!0}if(1==c||d.node(c-1).childCount>1)break}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos-f.nodeSize,e.pos).scrollIntoView()),!0)};function uo(a,b,c){let d=b.nodeBefore,e=b.pos-1;for(;!d.isTextblock;e--){if(d.type.spec.isolating)return!1;let a=d.lastChild;if(!a)return!1;d=a}let f=b.nodeAfter,g=b.pos+1;for(;!f.isTextblock;g++){if(f.type.spec.isolating)return!1;let a=f.firstChild;if(!a)return!1;f=a}let h=tO(a.doc,e,g,sJ.empty);if(!h||h.from!=e||h instanceof tA&&h.slice.size>=g-e)return!1;if(c){let b=a.tr.step(h);b.setSelection(t3.create(b.doc,e)),c(b.scrollIntoView())}return!0}function up(a,b,c=!1){for(let d=a;d;d="start"==b?d.firstChild:d.lastChild){if(d.isTextblock)return!0;if(c&&1!=d.childCount)break}return!1}let uq=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("backward",a):d.parentOffset>0)return!1;f=ur(d)}let g=f&&f.nodeBefore;return!!g&&!!t5.isSelectable(g)&&(b&&b(a.tr.setSelection(t5.create(a.doc,f.pos-g.nodeSize)).scrollIntoView()),!0)};function ur(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){if(a.index(b)>0)return a.doc.resolve(a.before(b+1));if(a.node(b).type.spec.isolating)break}return null}function us(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("forward",a):!(c.parentOffset<c.parent.content.size))?c:null}let ut=(a,b,c)=>{let d=us(a,c);if(!d)return!1;let e=uv(d);if(!e)return!1;let f=e.nodeAfter;if(uB(a,e,b,1))return!0;if(0==d.parent.content.size&&(up(f,"start")||t5.isSelectable(f))){let c=tO(a.doc,d.before(),d.after(),sJ.empty);if(c&&c.slice.size<c.to-c.from){if(b){let d=a.tr.step(c);d.setSelection(up(f,"start")?t_.findFrom(d.doc.resolve(d.mapping.map(e.pos)),1):t5.create(d.doc,d.mapping.map(e.pos))),b(d.scrollIntoView())}return!0}}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos,e.pos+f.nodeSize).scrollIntoView()),!0)},uu=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("forward",a):d.parentOffset<d.parent.content.size)return!1;f=uv(d)}let g=f&&f.nodeAfter;return!!g&&!!t5.isSelectable(g)&&(b&&b(a.tr.setSelection(t5.create(a.doc,f.pos)).scrollIntoView()),!0)};function uv(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){let c=a.node(b);if(a.index(b)+1<c.childCount)return a.doc.resolve(a.after(b+1));if(c.type.spec.isolating)break}return null}let uw=(a,b)=>{let{$head:c,$anchor:d}=a.selection;return!!c.parent.type.spec.code&&!!c.sameParent(d)&&(b&&b(a.tr.insertText("\n").scrollIntoView()),!0)};function ux(a){for(let b=0;b<a.edgeCount;b++){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}let uy=(a,b)=>{let{$head:c,$anchor:d}=a.selection;if(!c.parent.type.spec.code||!c.sameParent(d))return!1;let e=c.node(-1),f=c.indexAfter(-1),g=ux(e.contentMatchAt(f));if(!g||!e.canReplaceWith(f,f,g))return!1;if(b){let d=c.after(),e=a.tr.replaceWith(d,d,g.createAndFill());e.setSelection(t_.near(e.doc.resolve(d),1)),b(e.scrollIntoView())}return!0},uz=(a,b)=>{let c=a.selection,{$from:d,$to:e}=c;if(c instanceof t7||d.parent.inlineContent||e.parent.inlineContent)return!1;let f=ux(e.parent.contentMatchAt(e.indexAfter()));if(!f||!f.isTextblock)return!1;if(b){let c=(!d.parentOffset&&e.index()<e.parent.childCount?d:e).pos,g=a.tr.insert(c,f.createAndFill());g.setSelection(t3.create(g.doc,c+1)),b(g.scrollIntoView())}return!0},uA=(a,b)=>{let{$cursor:c}=a.selection;if(!c||c.parent.content.size)return!1;if(c.depth>1&&c.after()!=c.end(-1)){let d=c.before();if(tJ(a.doc,d))return b&&b(a.tr.split(d).scrollIntoView()),!0}let d=c.blockRange(),e=d&&tE(d);return null!=e&&(b&&b(a.tr.lift(d,e).scrollIntoView()),!0)};function uB(a,b,c,d){let e,f,g,h=b.nodeBefore,i=b.nodeAfter,j,k,l=h.type.spec.isolating||i.type.spec.isolating;if(!l&&(e=b.nodeBefore,f=b.nodeAfter,g=b.index(),e&&f&&e.type.compatibleContent(f.type)&&(!e.content.size&&b.parent.canReplace(g-1,g)?(c&&c(a.tr.delete(b.pos-e.nodeSize,b.pos).scrollIntoView()),!0):!!b.parent.canReplace(g,g+1)&&!!(f.isTextblock||tK(a.doc,b.pos))&&(c&&c(a.tr.join(b.pos).scrollIntoView()),!0))))return!0;let m=!l&&b.parent.canReplace(b.index(),b.index()+1);if(m&&(j=(k=h.contentMatchAt(h.childCount)).findWrapping(i.type))&&k.matchType(j[0]||i.type).validEnd){if(c){let d=b.pos+i.nodeSize,e=sD.empty;for(let a=j.length-1;a>=0;a--)e=sD.from(j[a].create(null,e));e=sD.from(h.copy(e));let f=a.tr.step(new tB(b.pos-1,d,b.pos,d,new sJ(e,1,0),j.length,!0)),g=f.doc.resolve(d+2*j.length);g.nodeAfter&&g.nodeAfter.type==h.type&&tK(f.doc,g.pos)&&f.join(g.pos),c(f.scrollIntoView())}return!0}let n=i.type.spec.isolating||d>0&&l?null:t_.findFrom(b,1),o=n&&n.$from.blockRange(n.$to),p=o&&tE(o);if(null!=p&&p>=b.depth)return c&&c(a.tr.lift(o,p).scrollIntoView()),!0;if(m&&up(i,"start",!0)&&up(h,"end")){let d=h,e=[];for(;e.push(d),!d.isTextblock;)d=d.lastChild;let f=i,g=1;for(;!f.isTextblock;f=f.firstChild)g++;if(d.canReplace(d.childCount,d.childCount,f.content)){if(c){let d=sD.empty;for(let a=e.length-1;a>=0;a--)d=sD.from(e[a].copy(d));c(a.tr.step(new tB(b.pos-e.length,b.pos+i.nodeSize,b.pos+g,b.pos+i.nodeSize-g,new sJ(d,e.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function uC(a){return function(b,c){let d=b.selection,e=a<0?d.$from:d.$to,f=e.depth;for(;e.node(f).isInline;){if(!f)return!1;f--}return!!e.node(f).isTextblock&&(c&&c(b.tr.setSelection(t3.create(b.doc,a<0?e.start(f):e.end(f)))),!0)}}let uD=uC(-1),uE=uC(1);function uF(a,b=null){return function(c,d){let e=!1;for(let d=0;d<c.selection.ranges.length&&!e;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];c.doc.nodesBetween(f,g,(d,f)=>{if(e)return!1;if(!(!d.isTextblock||d.hasMarkup(a,b)))if(d.type==a)e=!0;else{let b=c.doc.resolve(f),d=b.index();e=b.parent.canReplaceWith(d,d+1,a)}})}if(!e)return!1;if(d){let e=c.tr;for(let d=0;d<c.selection.ranges.length;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];e.setBlockType(f,g,a,b)}d(e.scrollIntoView())}return!0}}function uG(...a){return function(b,c,d){for(let e=0;e<a.length;e++)if(a[e](b,c,d))return!0;return!1}}let uH=uG(ul,un,uq),uI=uG(ul,ut,uu),uJ={Enter:uG(uw,uz,uA,(a,b)=>{let{$from:c,$to:d}=a.selection;if(a.selection instanceof t5&&a.selection.node.isBlock)return!!c.parentOffset&&!!tJ(a.doc,c.pos)&&(b&&b(a.tr.split(c.pos).scrollIntoView()),!0);if(!c.depth)return!1;let e=[],f,g,h=!1,i=!1;for(let a=c.depth;;a--){if(c.node(a).isBlock){let b;h=c.end(a)==c.pos+(c.depth-a),i=c.start(a)==c.pos-(c.depth-a),g=ux(c.node(a-1).contentMatchAt(c.indexAfter(a-1)));e.unshift(b||(h&&g?{type:g}:null)),f=a;break}if(1==a)return!1;e.unshift(null)}let j=a.tr;(a.selection instanceof t3||a.selection instanceof t7)&&j.deleteSelection();let k=j.mapping.map(c.pos),l=tJ(j.doc,k,e.length,e);if(l||(e[0]=g?{type:g}:null,l=tJ(j.doc,k,e.length,e)),!l)return!1;if(j.split(k,e.length,e),!h&&i&&c.node(f).type!=g){let a=j.mapping.map(c.before(f)),b=j.doc.resolve(a);g&&c.node(f-1).canReplaceWith(b.index(),b.index()+1,g)&&j.setNodeMarkup(j.mapping.map(c.before(f)),g)}return b&&b(j.scrollIntoView()),!0}),"Mod-Enter":uy,Backspace:uH,"Mod-Backspace":uH,"Shift-Backspace":uH,Delete:uI,"Mod-Delete":uI,"Mod-a":(a,b)=>(b&&b(a.tr.setSelection(new t7(a.doc))),!0)},uK={"Ctrl-h":uJ.Backspace,"Alt-Backspace":uJ["Mod-Backspace"],"Ctrl-d":uJ.Delete,"Ctrl-Alt-Backspace":uJ["Mod-Delete"],"Alt-Delete":uJ["Mod-Delete"],"Alt-d":uJ["Mod-Delete"],"Ctrl-a":uD,"Ctrl-e":uE};for(let a in uJ)uK[a]=uJ[a];"u">typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"u">typeof os&&os.platform&&os.platform();let uL=function(a){for(var b=0;;b++)if(!(a=a.previousSibling))return b},uM=function(a){let b=a.assignedSlot||a.parentNode;return b&&11==b.nodeType?b.host:b},uN=null,uO=function(a,b,c){let d=uN||(uN=document.createRange());return d.setEnd(a,null==c?a.nodeValue.length:c),d.setStart(a,b||0),d},uP=function(){uN=null},uQ=function(a,b,c,d){return c&&(uS(a,b,c,d,-1)||uS(a,b,c,d,1))},uR=/^(img|br|input|textarea|hr)$/i;function uS(a,b,c,d,e){for(var f;;){if(a==c&&b==d)return!0;if(b==(e<0?0:uT(a))){let c=a.parentNode;if(!c||1!=c.nodeType||uU(a)||uR.test(a.nodeName)||"false"==a.contentEditable)return!1;b=uL(a)+(e<0?0:1),a=c}else{if(1!=a.nodeType)return!1;let c=a.childNodes[b+(e<0?-1:0)];if(1==c.nodeType&&"false"==c.contentEditable)if(null==(f=c.pmViewDesc)||!f.ignoreForSelection)return!1;else b+=e;else a=c,b=e<0?uT(a):0}}}function uT(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function uU(a){let b;for(let c=a;c&&!(b=c.pmViewDesc);c=c.parentNode);return b&&b.node&&b.node.isBlock&&(b.dom==a||b.contentDOM==a)}let uV=function(a){return a.focusNode&&uQ(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset)};function uW(a,b){let c=document.createEvent("Event");return c.initEvent("keydown",!0,!0),c.keyCode=a,c.key=c.code=b,c}let uX="u">typeof navigator?navigator:null,uY="u">typeof document?document:null,uZ=uX&&uX.userAgent||"",u$=/Edge\/(\d+)/.exec(uZ),u_=/MSIE \d/.exec(uZ),u0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(uZ),u1=!!(u_||u0||u$),u2=u_?document.documentMode:u0?+u0[1]:u$?+u$[1]:0,u3=!u1&&/gecko\/(\d+)/i.test(uZ);u3&&(/Firefox\/(\d+)/.exec(uZ)||[0,0])[1];let u4=!u1&&/Chrome\/(\d+)/.exec(uZ),u5=!!u4,u6=u4?+u4[1]:0,u7=!u1&&!!uX&&/Apple Computer/.test(uX.vendor),u8=u7&&(/Mobile\/\w+/.test(uZ)||!!uX&&uX.maxTouchPoints>2),u9=u8||!!uX&&/Mac/.test(uX.platform),va=!!uX&&/Win/.test(uX.platform),vb=/Android \d/.test(uZ),vc=!!uY&&"webkitFontSmoothing"in uY.documentElement.style,vd=vc?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ve(a,b){return"number"==typeof a?a:a[b]}function vf(a,b,c){let d=a.someProp("scrollThreshold")||0,e=a.someProp("scrollMargin")||5,f=a.dom.ownerDocument;for(let g=c||a.dom;g;){if(1!=g.nodeType){g=uM(g);continue}let a=g,c=a==f.body,h=c?function(a){let b=a.defaultView&&a.defaultView.visualViewport;return b?{left:0,right:b.width,top:0,bottom:b.height}:{left:0,right:a.documentElement.clientWidth,top:0,bottom:a.documentElement.clientHeight}}(f):function(a){let b=a.getBoundingClientRect(),c=b.width/a.offsetWidth||1,d=b.height/a.offsetHeight||1;return{left:b.left,right:b.left+a.clientWidth*c,top:b.top,bottom:b.top+a.clientHeight*d}}(a),i=0,j=0;if(b.top<h.top+ve(d,"top")?j=-(h.top-b.top+ve(e,"top")):b.bottom>h.bottom-ve(d,"bottom")&&(j=b.bottom-b.top>h.bottom-h.top?b.top+ve(e,"top")-h.top:b.bottom-h.bottom+ve(e,"bottom")),b.left<h.left+ve(d,"left")?i=-(h.left-b.left+ve(e,"left")):b.right>h.right-ve(d,"right")&&(i=b.right-h.right+ve(e,"right")),i||j)if(c)f.defaultView.scrollBy(i,j);else{let c=a.scrollLeft,d=a.scrollTop;j&&(a.scrollTop+=j),i&&(a.scrollLeft+=i);let e=a.scrollLeft-c,f=a.scrollTop-d;b={left:b.left-e,top:b.top-f,right:b.right-e,bottom:b.bottom-f}}let k=c?"fixed":getComputedStyle(g).position;if(/^(fixed|sticky)$/.test(k))break;g="absolute"==k?g.offsetParent:uM(g)}}function vg(a){let b=[],c=a.ownerDocument;for(let d=a;d&&(b.push({dom:d,top:d.scrollTop,left:d.scrollLeft}),a!=c);d=uM(d));return b}function vh(a,b){for(let c=0;c<a.length;c++){let{dom:d,top:e,left:f}=a[c];d.scrollTop!=e+b&&(d.scrollTop=e+b),d.scrollLeft!=f&&(d.scrollLeft=f)}}let vi=null;function vj(a,b){return a.left>=b.left-1&&a.left<=b.right+1&&a.top>=b.top-1&&a.top<=b.bottom+1}function vk(a){return a.top<a.bottom||a.left<a.right}function vl(a,b){let c=a.getClientRects();if(c.length){let a=c[b<0?0:c.length-1];if(vk(a))return a}return Array.prototype.find.call(c,vk)||a.getBoundingClientRect()}let vm=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function vn(a,b,c){let{node:d,offset:e,atom:f}=a.docView.domFromPos(b,c<0?-1:1),g=vc||u3;if(3==d.nodeType)if(g&&(vm.test(d.nodeValue)||(c<0?!e:e==d.nodeValue.length))){let a=vl(uO(d,e,e),c);if(u3&&e&&/\s/.test(d.nodeValue[e-1])&&e<d.nodeValue.length){let b=vl(uO(d,e-1,e-1),-1);if(b.top==a.top){let c=vl(uO(d,e,e+1),-1);if(c.top!=a.top)return vo(c,c.left<b.left)}}return a}else{let a=e,b=e,f=c<0?1:-1;return c<0&&!e?(b++,f=-1):c>=0&&e==d.nodeValue.length?(a--,f=1):c<0?a--:b++,vo(vl(uO(d,a,b),f),f<0)}if(!a.state.doc.resolve(b-(f||0)).parent.inlineContent){if(null==f&&e&&(c<0||e==uT(d))){let a=d.childNodes[e-1];if(1==a.nodeType)return vp(a.getBoundingClientRect(),!1)}if(null==f&&e<uT(d)){let a=d.childNodes[e];if(1==a.nodeType)return vp(a.getBoundingClientRect(),!0)}return vp(d.getBoundingClientRect(),c>=0)}if(null==f&&e&&(c<0||e==uT(d))){let a=d.childNodes[e-1],b=3==a.nodeType?uO(a,uT(a)-!g):1!=a.nodeType||"BR"==a.nodeName&&a.nextSibling?null:a;if(b)return vo(vl(b,1),!1)}if(null==f&&e<uT(d)){let a=d.childNodes[e];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let b=a?3==a.nodeType?uO(a,0,+!g):1==a.nodeType?a:null:null;if(b)return vo(vl(b,-1),!0)}return vo(vl(3==d.nodeType?uO(d):d,-c),c>=0)}function vo(a,b){if(0==a.width)return a;let c=b?a.left:a.right;return{top:a.top,bottom:a.bottom,left:c,right:c}}function vp(a,b){if(0==a.height)return a;let c=b?a.top:a.bottom;return{top:c,bottom:c,left:a.left,right:a.right}}function vq(a,b,c){let d=a.state,e=a.root.activeElement;d!=b&&a.updateState(b),e!=a.dom&&a.focus();try{return c()}finally{d!=b&&a.updateState(d),e!=a.dom&&e&&e.focus()}}let vr=/[\u0590-\u08ac]/,vs=null,vt=null,vu=!1;class vv{constructor(a,b,c,d){this.parent=a,this.children=b,this.dom=c,this.contentDOM=d,this.dirty=0,c.pmViewDesc=this}matchesWidget(a){return!1}matchesMark(a){return!1}matchesNode(a,b,c){return!1}matchesHack(a){return!1}parseRule(){return null}stopEvent(a){return!1}get size(){let a=0;for(let b=0;b<this.children.length;b++)a+=this.children[b].size;return a}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let a=0;a<this.children.length;a++)this.children[a].destroy()}posBeforeChild(a){for(let b=0,c=this.posAtStart;;b++){let d=this.children[b];if(d==a)return c;c+=d.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(a,b,c){let d;if(this.contentDOM&&this.contentDOM.contains(1==a.nodeType?a:a.parentNode))if(c<0){let c,d;if(a==this.contentDOM)c=a.childNodes[b-1];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.previousSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.previousSibling;return c?this.posBeforeChild(d)+d.size:this.posAtStart}else{let c,d;if(a==this.contentDOM)c=a.childNodes[b];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.nextSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.nextSibling;return c?this.posBeforeChild(d):this.posAtEnd}if(a==this.dom&&this.contentDOM)d=b>uL(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))d=2&a.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==b)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!1;break}if(b.previousSibling)break}if(null==d&&b==a.childNodes.length)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!0;break}if(b.nextSibling)break}}return(null==d?c>0:d)?this.posAtEnd:this.posAtStart}nearestDesc(a,b=!1){for(let c=!0,d=a;d;d=d.parentNode){let e=this.getDesc(d),f;if(e&&(!b||e.node))if(!c||!(f=e.nodeDOM)||(1==f.nodeType?f.contains(1==a.nodeType?a:a.parentNode):f==a))return e;else c=!1}}getDesc(a){let b=a.pmViewDesc;for(let a=b;a;a=a.parent)if(a==this)return b}posFromDOM(a,b,c){for(let d=a;d;d=d.parentNode){let e=this.getDesc(d);if(e)return e.localPosFromDOM(a,b,c)}return -1}descAt(a){for(let b=0,c=0;b<this.children.length;b++){let d=this.children[b],e=c+d.size;if(c==a&&e!=c){for(;!d.border&&d.children.length;)for(let a=0;a<d.children.length;a++){let b=d.children[a];if(b.size){d=b;break}}return d}if(a<e)return d.descAt(a-c-d.border);c=e}}domFromPos(a,b){if(!this.contentDOM)return{node:this.dom,offset:0,atom:a+1};let c=0,d=0;for(let b=0;c<this.children.length;c++){let e=this.children[c],f=b+e.size;if(f>a||e instanceof vC){d=a-b;break}b=f}if(d)return this.children[c].domFromPos(d-this.children[c].border,b);for(let a;c&&!(a=this.children[c-1]).size&&a instanceof vw&&a.side>=0;c--);if(b<=0){let a,d=!0;for(;(a=c?this.children[c-1]:null)&&a.dom.parentNode!=this.contentDOM;c--,d=!1);return a&&b&&d&&!a.border&&!a.domAtom?a.domFromPos(a.size,b):{node:this.contentDOM,offset:a?uL(a.dom)+1:0}}{let a,d=!0;for(;(a=c<this.children.length?this.children[c]:null)&&a.dom.parentNode!=this.contentDOM;c++,d=!1);return a&&d&&!a.border&&!a.domAtom?a.domFromPos(0,b):{node:this.contentDOM,offset:a?uL(a.dom):this.contentDOM.childNodes.length}}}parseRange(a,b,c=0){if(0==this.children.length)return{node:this.contentDOM,from:a,to:b,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let d=-1,e=-1;for(let f=c,g=0;;g++){let c=this.children[g],h=f+c.size;if(-1==d&&a<=h){let e=f+c.border;if(a>=e&&b<=h-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(a,b,e);a=f;for(let b=g;b>0;b--){let c=this.children[b-1];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(1)){d=uL(c.dom)+1;break}a-=c.size}-1==d&&(d=0)}if(d>-1&&(h>b||g==this.children.length-1)){b=h;for(let a=g+1;a<this.children.length;a++){let c=this.children[a];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(-1)){e=uL(c.dom);break}b+=c.size}-1==e&&(e=this.contentDOM.childNodes.length);break}f=h}return{node:this.contentDOM,from:a,to:b,fromOffset:d,toOffset:e}}emptyChildAt(a){if(this.border||!this.contentDOM||!this.children.length)return!1;let b=this.children[a<0?0:this.children.length-1];return 0==b.size||b.emptyChildAt(a)}domAfterPos(a){let{node:b,offset:c}=this.domFromPos(a,0);if(1!=b.nodeType||c==b.childNodes.length)throw RangeError("No node after pos "+a);return b.childNodes[c]}setSelection(a,b,c,d=!1){let e=Math.min(a,b),f=Math.max(a,b);for(let g=0,h=0;g<this.children.length;g++){let i=this.children[g],j=h+i.size;if(e>h&&f<j)return i.setSelection(a-h-i.border,b-h-i.border,c,d);h=j}let g=this.domFromPos(a,a?-1:1),h=b==a?g:this.domFromPos(b,b?-1:1),i=c.root.getSelection(),j=c.domSelectionRange(),k=!1;if((u3||u7)&&a==b){let{node:a,offset:b}=g;if(3==a.nodeType){if((k=!!(b&&"\n"==a.nodeValue[b-1]))&&b==a.nodeValue.length)for(let b=a,c;b;b=b.parentNode){if(c=b.nextSibling){"BR"==c.nodeName&&(g=h={node:c.parentNode,offset:uL(c)+1});break}let a=b.pmViewDesc;if(a&&a.node&&a.node.isBlock)break}}else{let c=a.childNodes[b-1];k=c&&("BR"==c.nodeName||"false"==c.contentEditable)}}if(u3&&j.focusNode&&j.focusNode!=h.node&&1==j.focusNode.nodeType){let a=j.focusNode.childNodes[j.focusOffset];a&&"false"==a.contentEditable&&(d=!0)}if(!(d||k&&u7)&&uQ(g.node,g.offset,j.anchorNode,j.anchorOffset)&&uQ(h.node,h.offset,j.focusNode,j.focusOffset))return;let l=!1;if((i.extend||a==b)&&!(k&&u3)){i.collapse(g.node,g.offset);try{a!=b&&i.extend(h.node,h.offset),l=!0}catch(a){}}if(!l){if(a>b){let a=g;g=h,h=a}let c=document.createRange();c.setEnd(h.node,h.offset),c.setStart(g.node,g.offset),i.removeAllRanges(),i.addRange(c)}}ignoreMutation(a){return!this.contentDOM&&"selection"!=a.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(a,b){for(let c=0,d=0;d<this.children.length;d++){let e=this.children[d],f=c+e.size;if(c==f?a<=f&&b>=c:a<f&&b>c){let d=c+e.border,g=f-e.border;if(a>=d&&b<=g){this.dirty=a==c||b==f?2:1,a==d&&b==g&&(e.contentLost||e.dom.parentNode!=this.contentDOM)?e.dirty=3:e.markDirty(a-d,b-d);return}e.dirty=e.dom!=e.contentDOM||e.dom.parentNode!=this.contentDOM||e.children.length?3:2}c=f}this.dirty=2}markParentsDirty(){let a=1;for(let b=this.parent;b;b=b.parent,a++){let c=1==a?2:1;b.dirty<c&&(b.dirty=c)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(a){return!1}}class vw extends vv{constructor(a,b,c,d){let e,f=b.type.toDOM;if("function"==typeof f&&(f=f(c,()=>e?e.parent?e.parent.posBeforeChild(e):void 0:d)),!b.type.spec.raw){if(1!=f.nodeType){let a=document.createElement("span");a.appendChild(f),f=a}f.contentEditable="false",f.classList.add("ProseMirror-widget")}super(a,[],f,null),this.widget=b,this.widget=b,e=this}matchesWidget(a){return 0==this.dirty&&a.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(a){let b=this.widget.spec.stopEvent;return!!b&&b(a)}ignoreMutation(a){return"selection"!=a.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class vx extends vv{constructor(a,b,c,d){super(a,[],b,null),this.textDOM=c,this.text=d}get size(){return this.text.length}localPosFromDOM(a,b){return a!=this.textDOM?this.posAtStart+(b?this.size:0):this.posAtStart+b}domFromPos(a){return{node:this.textDOM,offset:a}}ignoreMutation(a){return"characterData"===a.type&&a.target.nodeValue==a.oldValue}}class vy extends vv{constructor(a,b,c,d,e){super(a,[],c,d),this.mark=b,this.spec=e}static create(a,b,c,d){let e=d.nodeViews[b.type.name],f=e&&e(b,d,c);return f&&f.dom||(f=tk.renderSpec(document,b.type.spec.toDOM(b,c),null,b.attrs)),new vy(a,b,f.dom,f.contentDOM||f.dom,f)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(a){return 3!=this.dirty&&this.mark.eq(a)}markDirty(a,b){if(super.markDirty(a,b),0!=this.dirty){let a=this.parent;for(;!a.node;)a=a.parent;a.dirty<this.dirty&&(a.dirty=this.dirty),this.dirty=0}}slice(a,b,c){let d=vy.create(this.parent,this.mark,!0,c),e=this.children,f=this.size;b<f&&(e=vN(e,b,f,c)),a>0&&(e=vN(e,0,a,c));for(let a=0;a<e.length;a++)e[a].parent=d;return d.children=e,d}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class vz extends vv{constructor(a,b,c,d,e,f,g,h,i){super(a,[],e,f),this.node=b,this.outerDeco=c,this.innerDeco=d,this.nodeDOM=g}static create(a,b,c,d,e,f){let g=e.nodeViews[b.type.name],h,i=g&&g(b,e,()=>h?h.parent?h.parent.posBeforeChild(h):void 0:f,c,d),j=i&&i.dom,k=i&&i.contentDOM;if(b.isText)if(j){if(3!=j.nodeType)throw RangeError("Text must be rendered as a DOM text node")}else j=document.createTextNode(b.text);else if(!j){let a=tk.renderSpec(document,b.type.spec.toDOM(b),null,b.attrs);({dom:j,contentDOM:k}=a)}k||b.isText||"BR"==j.nodeName||(j.hasAttribute("contenteditable")||(j.contentEditable="false"),b.type.spec.draggable&&(j.draggable=!0));let l=j;return(j=vI(j,c,b),i)?h=new vD(a,b,c,d,j,k||null,l,i,e,f+1):b.isText?new vB(a,b,c,d,j,l,e):new vz(a,b,c,d,j,k||null,l,e,f+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let a={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(a.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let b=this.children.length-1;b>=0;b--){let c=this.children[b];if(this.dom.contains(c.dom.parentNode)){a.contentElement=c.dom.parentNode;break}}a.contentElement||(a.getContent=()=>sD.empty)}else a.contentElement=this.contentDOM;else a.getContent=()=>this.node.content;return a}matchesNode(a,b,c){return 0==this.dirty&&a.eq(this.node)&&vJ(b,this.outerDeco)&&c.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return+!this.node.isLeaf}updateChildren(a,b){let c=this.node.inlineContent,d=b,e=a.composing?this.localCompositionInfo(a,b):null,f=e&&e.pos>-1?e:null,g=e&&e.pos<0,h=new vL(this,f&&f.node,a);(function(a,b,c,d){let e=b.locals(a),f=0;if(0==e.length){for(let c=0;c<a.childCount;c++){let g=a.child(c);d(g,e,b.forChild(f,g),c),f+=g.nodeSize}return}let g=0,h=[],i=null;for(let j=0;;){let k,l,m,n;for(;g<e.length&&e[g].to==f;){let a=e[g++];a.widget&&(k?(l||(l=[k])).push(a):k=a)}if(k)if(l){l.sort(vM);for(let a=0;a<l.length;a++)c(l[a],j,!!i)}else c(k,j,!!i);if(i)n=-1,m=i,i=null;else if(j<a.childCount)n=j,m=a.child(j++);else break;for(let a=0;a<h.length;a++)h[a].to<=f&&h.splice(a--,1);for(;g<e.length&&e[g].from<=f&&e[g].to>f;)h.push(e[g++]);let o=f+m.nodeSize;if(m.isText){let a=o;g<e.length&&e[g].from<a&&(a=e[g].from);for(let b=0;b<h.length;b++)h[b].to<a&&(a=h[b].to);a<o&&(i=m.cut(a-f),m=m.cut(0,a-f),o=a,n=-1)}else for(;g<e.length&&e[g].to<o;)g++;let p=m.isInline&&!m.isLeaf?h.filter(a=>!a.inline):h.slice();d(m,p,b.forChild(f,m),n),f=o}})(this.node,this.innerDeco,(b,e,f)=>{b.spec.marks?h.syncToMarks(b.spec.marks,c,a,e):b.type.side>=0&&!f&&h.syncToMarks(e==this.node.childCount?sH.none:this.node.child(e).marks,c,a,e),h.placeWidget(b,a,d)},(b,f,i,j)=>{let k;h.syncToMarks(b.marks,c,a,j),h.findNodeMatch(b,f,i,j)||g&&a.state.selection.from>d&&a.state.selection.to<d+b.nodeSize&&(k=h.findIndexWithChild(e.node))>-1&&h.updateNodeAt(b,f,i,k,a)||h.updateNextNode(b,f,i,a,j,d)||h.addNode(b,f,i,a,d),d+=b.nodeSize}),h.syncToMarks([],c,a,0),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||2==this.dirty)&&(f&&this.protectLocalComposition(a,f),function a(b,c,d){let e=b.firstChild,f=!1;for(let g=0;g<c.length;g++){let h=c[g],i=h.dom;if(i.parentNode==b){for(;i!=e;)e=vK(e),f=!0;e=e.nextSibling}else f=!0,b.insertBefore(i,e);if(h instanceof vy){let c=e?e.previousSibling:b.lastChild;a(h.contentDOM,h.children,d),e=c?c.nextSibling:b.firstChild}}for(;e;)e=vK(e),f=!0;f&&d.trackWrites==b&&(d.trackWrites=null)}(this.contentDOM,this.children,a),u8&&function(a){if("UL"==a.nodeName||"OL"==a.nodeName){let b=a.style.cssText;a.style.cssText=b+"; list-style: square !important",window.getComputedStyle(a).listStyle,a.style.cssText=b}}(this.dom))}localCompositionInfo(a,b){let{from:c,to:d}=a.state.selection;if(!(a.state.selection instanceof t3)||c<b||d>b+this.node.content.size)return null;let e=a.input.compositionNode;if(!e||!this.dom.contains(e.parentNode))return null;if(!this.node.inlineContent)return{node:e,pos:-1,text:""};{let a=e.nodeValue,f=function(a,b,c,d){for(let e=0,f=0;e<a.childCount&&f<=d;){let g=a.child(e++),h=f;if(f+=g.nodeSize,!g.isText)continue;let i=g.text;for(;e<a.childCount;){let b=a.child(e++);if(f+=b.nodeSize,!b.isText)break;i+=b.text}if(f>=c){if(f>=d&&i.slice(d-b.length-h,d-h)==b)return d-b.length;let a=h<d?i.lastIndexOf(b,d-h-1):-1;if(a>=0&&a+b.length+h>=c)return h+a;if(c==d&&i.length>=d+b.length-h&&i.slice(d-h,d-h+b.length)==b)return d}}return -1}(this.node.content,a,c-b,d-b);return f<0?null:{node:e,pos:f,text:a}}}protectLocalComposition(a,{node:b,pos:c,text:d}){if(this.getDesc(b))return;let e=b;for(;e.parentNode!=this.contentDOM;e=e.parentNode){for(;e.previousSibling;)e.parentNode.removeChild(e.previousSibling);for(;e.nextSibling;)e.parentNode.removeChild(e.nextSibling);e.pmViewDesc&&(e.pmViewDesc=void 0)}let f=new vx(this,e,b,d);a.input.compositionNodes.push(f),this.children=vN(this.children,c,c+d.length,a,f)}update(a,b,c,d){return 3!=this.dirty&&!!a.sameMarkup(this.node)&&(this.updateInner(a,b,c,d),!0)}updateInner(a,b,c,d){this.updateOuterDeco(b),this.node=a,this.innerDeco=c,this.contentDOM&&this.updateChildren(d,this.posAtStart),this.dirty=0}updateOuterDeco(a){if(vJ(a,this.outerDeco))return;let b=1!=this.nodeDOM.nodeType,c=this.dom;this.dom=vH(this.dom,this.nodeDOM,vG(this.outerDeco,this.node,b),vG(a,this.node,b)),this.dom!=c&&(c.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=a}selectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function vA(a,b,c,d,e){vI(d,b,a);let f=new vz(void 0,a,b,c,d,d,d,e,0);return f.contentDOM&&f.updateChildren(e,0),f}class vB extends vz{constructor(a,b,c,d,e,f,g){super(a,b,c,d,e,null,f,g,0)}parseRule(){let a=this.nodeDOM.parentNode;for(;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}}update(a,b,c,d){return 3!=this.dirty&&(0==this.dirty||!!this.inParent())&&!!a.sameMarkup(this.node)&&(this.updateOuterDeco(b),(0!=this.dirty||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,d.trackWrites==this.nodeDOM&&(d.trackWrites=null)),this.node=a,this.dirty=0,!0)}inParent(){let a=this.parent.contentDOM;for(let b=this.nodeDOM;b;b=b.parentNode)if(b==a)return!0;return!1}domFromPos(a){return{node:this.nodeDOM,offset:a}}localPosFromDOM(a,b,c){return a==this.nodeDOM?this.posAtStart+Math.min(b,this.node.text.length):super.localPosFromDOM(a,b,c)}ignoreMutation(a){return"characterData"!=a.type&&"selection"!=a.type}slice(a,b,c){let d=this.node.cut(a,b),e=document.createTextNode(d.text);return new vB(this.parent,d,this.outerDeco,this.innerDeco,e,e,c)}markDirty(a,b){super.markDirty(a,b),this.dom!=this.nodeDOM&&(0==a||b==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}isText(a){return this.node.text==a}}class vC extends vv{parseRule(){return{ignore:!0}}matchesHack(a){return 0==this.dirty&&this.dom.nodeName==a}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class vD extends vz{constructor(a,b,c,d,e,f,g,h,i,j){super(a,b,c,d,e,f,g,i,j),this.spec=h}update(a,b,c,d){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==a.type||this.spec.multiType)){let e=this.spec.update(a,b,c);return e&&this.updateInner(a,b,c,d),e}return(!!this.contentDOM||!!a.isLeaf)&&super.update(a,b,c,d)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(a,b,c,d){this.spec.setSelection?this.spec.setSelection(a,b,c.root):super.setSelection(a,b,c,d)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(a){return!!this.spec.stopEvent&&this.spec.stopEvent(a)}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}}let vE=function(a){a&&(this.nodeName=a)};vE.prototype=Object.create(null);let vF=[new vE];function vG(a,b,c){if(0==a.length)return vF;let d=c?vF[0]:new vE,e=[d];for(let f=0;f<a.length;f++){let g=a[f].type.attrs;if(g)for(let a in g.nodeName&&e.push(d=new vE(g.nodeName)),g){let f=g[a];null!=f&&(c&&1==e.length&&e.push(d=new vE(b.isInline?"span":"div")),"class"==a?d.class=(d.class?d.class+" ":"")+f:"style"==a?d.style=(d.style?d.style+";":"")+f:"nodeName"!=a&&(d[a]=f))}}return e}function vH(a,b,c,d){if(c==vF&&d==vF)return b;let e=b;for(let b=0;b<d.length;b++){let f=d[b],g=c[b];if(b){let b;g&&g.nodeName==f.nodeName&&e!=a&&(b=e.parentNode)&&b.nodeName.toLowerCase()==f.nodeName||((b=document.createElement(f.nodeName)).pmIsDeco=!0,b.appendChild(e),g=vF[0]),e=b}!function(a,b,c){for(let d in b)"class"==d||"style"==d||"nodeName"==d||d in c||a.removeAttribute(d);for(let d in c)"class"!=d&&"style"!=d&&"nodeName"!=d&&c[d]!=b[d]&&a.setAttribute(d,c[d]);if(b.class!=c.class){let d=b.class?b.class.split(" ").filter(Boolean):[],e=c.class?c.class.split(" ").filter(Boolean):[];for(let b=0;b<d.length;b++)-1==e.indexOf(d[b])&&a.classList.remove(d[b]);for(let b=0;b<e.length;b++)-1==d.indexOf(e[b])&&a.classList.add(e[b]);0==a.classList.length&&a.removeAttribute("class")}if(b.style!=c.style){if(b.style){let c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,d;for(;d=c.exec(b.style);)a.style.removeProperty(d[1])}c.style&&(a.style.cssText+=c.style)}}(e,g||vF[0],f)}return e}function vI(a,b,c){return vH(a,a,vF,vG(b,c,1!=a.nodeType))}function vJ(a,b){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].type.eq(b[c].type))return!1;return!0}function vK(a){let b=a.nextSibling;return a.parentNode.removeChild(a),b}class vL{constructor(a,b,c){this.lock=b,this.view=c,this.index=0,this.stack=[],this.changed=!1,this.top=a,this.preMatch=function(a,b){let c=b,d=c.children.length,e=a.childCount,f=new Map,g=[];a:for(;e>0;){let h;for(;;)if(d){let a=c.children[d-1];if(a instanceof vy)c=a,d=a.children.length;else{h=a,d--;break}}else if(c==b)break a;else d=c.parent.children.indexOf(c),c=c.parent;let i=h.node;if(i){if(i!=a.child(e-1))break;--e,f.set(h,e),g.push(h)}}return{index:e,matched:f,matches:g.reverse()}}(a.node.content,a)}destroyBetween(a,b){if(a!=b){for(let c=a;c<b;c++)this.top.children[c].destroy();this.top.children.splice(a,b-a),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(a,b,c,d){let e=0,f=this.stack.length>>1,g=Math.min(f,a.length);for(;e<g&&(e==f-1?this.top:this.stack[e+1<<1]).matchesMark(a[e])&&!1!==a[e].type.spec.spanning;)e++;for(;e<f;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),f--;for(;f<a.length;){this.stack.push(this.top,this.index+1);let e=-1,g=this.top.children.length;d<this.preMatch.index&&(g=Math.min(this.index+3,g));for(let b=this.index;b<g;b++){let c=this.top.children[b];if(c.matchesMark(a[f])&&!this.isLocked(c.dom)){e=b;break}}if(e>-1)e>this.index&&(this.changed=!0,this.destroyBetween(this.index,e)),this.top=this.top.children[this.index];else{let d=vy.create(this.top,a[f],b,c);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,f++}}findNodeMatch(a,b,c,d){let e=-1,f;if(d>=this.preMatch.index&&(f=this.preMatch.matches[d-this.preMatch.index]).parent==this.top&&f.matchesNode(a,b,c))e=this.top.children.indexOf(f,this.index);else for(let d=this.index,f=Math.min(this.top.children.length,d+5);d<f;d++){let f=this.top.children[d];if(f.matchesNode(a,b,c)&&!this.preMatch.matched.has(f)){e=d;break}}return!(e<0)&&(this.destroyBetween(this.index,e),this.index++,!0)}updateNodeAt(a,b,c,d,e){let f=this.top.children[d];return 3==f.dirty&&f.dom==f.contentDOM&&(f.dirty=2),!!f.update(a,b,c,e)&&(this.destroyBetween(this.index,d),this.index++,!0)}findIndexWithChild(a){for(;;){let b=a.parentNode;if(!b)return -1;if(b==this.top.contentDOM){let b=a.pmViewDesc;if(b){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==b)return a}return -1}a=b}}updateNextNode(a,b,c,d,e,f){for(let g=this.index;g<this.top.children.length;g++){let h=this.top.children[g];if(h instanceof vz){let i=this.preMatch.matched.get(h);if(null!=i&&i!=e)return!1;let j=h.dom,k,l=this.isLocked(j)&&!(a.isText&&h.node&&h.node.isText&&h.nodeDOM.nodeValue==a.text&&3!=h.dirty&&vJ(b,h.outerDeco));if(!l&&h.update(a,b,c,d))return this.destroyBetween(this.index,g),h.dom!=j&&(this.changed=!0),this.index++,!0;if(!l&&(k=this.recreateWrapper(h,a,b,c,d,f)))return this.destroyBetween(this.index,g),this.top.children[this.index]=k,k.contentDOM&&(k.dirty=2,k.updateChildren(d,f+1),k.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(a,b,c,d,e,f){if(a.dirty||b.isAtom||!a.children.length||!a.node.content.eq(b.content)||!vJ(c,a.outerDeco)||!d.eq(a.innerDeco))return null;let g=vz.create(this.top,b,c,d,e,f);if(g.contentDOM)for(let b of(g.children=a.children,a.children=[],g.children))b.parent=g;return a.destroy(),g}addNode(a,b,c,d,e){let f=vz.create(this.top,a,b,c,d,e);f.contentDOM&&f.updateChildren(d,e+1),this.top.children.splice(this.index++,0,f),this.changed=!0}placeWidget(a,b,c){let d=this.index<this.top.children.length?this.top.children[this.index]:null;if(d&&d.matchesWidget(a)&&(a==d.widget||!d.widget.type.toDOM.parentNode))this.index++;else{let d=new vw(this.top,a,b,c);this.top.children.splice(this.index++,0,d),this.changed=!0}}addTextblockHacks(){let a=this.top.children[this.index-1],b=this.top;for(;a instanceof vy;)a=(b=a).children[b.children.length-1];(!a||!(a instanceof vB)||/\n$/.test(a.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(a.node.text))&&((u7||u5)&&a&&"false"==a.dom.contentEditable&&this.addHackNode("IMG",b),this.addHackNode("BR",this.top))}addHackNode(a,b){if(b==this.top&&this.index<b.children.length&&b.children[this.index].matchesHack(a))this.index++;else{let c=document.createElement(a);"IMG"==a&&(c.className="ProseMirror-separator",c.alt=""),"BR"==a&&(c.className="ProseMirror-trailingBreak");let d=new vC(this.top,[],c,null);b!=this.top?b.children.push(d):b.children.splice(this.index++,0,d),this.changed=!0}}isLocked(a){return this.lock&&(a==this.lock||1==a.nodeType&&a.contains(this.lock.parentNode))}}function vM(a,b){return a.type.side-b.type.side}function vN(a,b,c,d,e){let f=[];for(let g=0,h=0;g<a.length;g++){let i=a[g],j=h,k=h+=i.size;j>=c||k<=b?f.push(i):(j<b&&f.push(i.slice(0,b-j,d)),e&&(f.push(e),e=void 0),k>c&&f.push(i.slice(c-j,i.size,d)))}return f}function vO(a,b=null){let c=a.domSelectionRange(),d=a.state.doc;if(!c.focusNode)return null;let e=a.docView.nearestDesc(c.focusNode),f=e&&0==e.size,g=a.docView.posFromDOM(c.focusNode,c.focusOffset,1);if(g<0)return null;let h=d.resolve(g),i,j;if(uV(c)){for(i=g;e&&!e.node;)e=e.parent;let a=e.node;if(e&&a.isAtom&&t5.isSelectable(a)&&e.parent&&!(a.isInline&&function(a,b,c){for(let d=0==b,e=b==uT(a);d||e;){if(a==c)return!0;let b=uL(a);if(!(a=a.parentNode))return!1;d=d&&0==b,e=e&&b==uT(a)}}(c.focusNode,c.focusOffset,e.dom))){let a=e.posBefore;j=new t5(g==a?h:d.resolve(a))}}else{if(c instanceof a.dom.ownerDocument.defaultView.Selection&&c.rangeCount>1){let b=g,e=g;for(let d=0;d<c.rangeCount;d++){let f=c.getRangeAt(d);b=Math.min(b,a.docView.posFromDOM(f.startContainer,f.startOffset,1)),e=Math.max(e,a.docView.posFromDOM(f.endContainer,f.endOffset,-1))}if(b<0)return null;[i,g]=e==a.state.selection.anchor?[e,b]:[b,e],h=d.resolve(g)}else i=a.docView.posFromDOM(c.anchorNode,c.anchorOffset,1);if(i<0)return null}let k=d.resolve(i);if(!j){let c="pointer"==b||a.state.selection.head<h.pos&&!f?1:-1;j=vX(a,k,h,c)}return j}function vP(a){return a.editable?a.hasFocus():vZ(a)&&document.activeElement&&document.activeElement.contains(a.dom)}function vQ(a,b=!1){let c=a.state.selection;if(vV(a,c),vP(a)){if(!b&&a.input.mouseDown&&a.input.mouseDown.allowDefault&&u5){let b=a.domSelectionRange(),c=a.domObserver.currentSelection;if(b.anchorNode&&c.anchorNode&&uQ(b.anchorNode,b.anchorOffset,c.anchorNode,c.anchorOffset)){a.input.mouseDown.delayedSelectionSync=!0,a.domObserver.setCurSelection();return}}if(a.domObserver.disconnectSelection(),a.cursorWrapper)!function(a){let b=a.domSelection();if(!b)return;let c=a.cursorWrapper.dom,d="IMG"==c.nodeName;d?b.collapse(c.parentNode,uL(c)+1):b.collapse(c,0),!d&&!a.state.selection.visible&&u1&&u2<=11&&(c.disabled=!0,c.disabled=!1)}(a);else{var d;let e,f,g,h,{anchor:i,head:j}=c,k,l;vR&&!(c instanceof t3)&&(c.$from.parent.inlineContent||(k=vS(a,c.from)),c.empty||c.$from.parent.inlineContent||(l=vS(a,c.to))),a.docView.setSelection(i,j,a,b),vR&&(k&&vU(k),l&&vU(l)),c.visible?a.dom.classList.remove("ProseMirror-hideselection"):(a.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&((e=(d=a).dom.ownerDocument).removeEventListener("selectionchange",d.input.hideSelectionGuard),g=(f=d.domSelectionRange()).anchorNode,h=f.anchorOffset,e.addEventListener("selectionchange",d.input.hideSelectionGuard=()=>{(f.anchorNode!=g||f.anchorOffset!=h)&&(e.removeEventListener("selectionchange",d.input.hideSelectionGuard),setTimeout(()=>{(!vP(d)||d.state.selection.visible)&&d.dom.classList.remove("ProseMirror-hideselection")},20))})))}a.domObserver.setCurSelection(),a.domObserver.connectSelection()}}let vR=u7||u5&&u6<63;function vS(a,b){let{node:c,offset:d}=a.docView.domFromPos(b,0),e=d<c.childNodes.length?c.childNodes[d]:null,f=d?c.childNodes[d-1]:null;if(u7&&e&&"false"==e.contentEditable)return vT(e);if((!e||"false"==e.contentEditable)&&(!f||"false"==f.contentEditable)){if(e)return vT(e);else if(f)return vT(f)}}function vT(a){return a.contentEditable="true",u7&&a.draggable&&(a.draggable=!1,a.wasDraggable=!0),a}function vU(a){a.contentEditable="false",a.wasDraggable&&(a.draggable=!0,a.wasDraggable=null)}function vV(a,b){if(b instanceof t5){let c=a.docView.descAt(b.from);c!=a.lastSelectedViewDesc&&(vW(a),c&&c.selectNode(),a.lastSelectedViewDesc=c)}else vW(a)}function vW(a){a.lastSelectedViewDesc&&(a.lastSelectedViewDesc.parent&&a.lastSelectedViewDesc.deselectNode(),a.lastSelectedViewDesc=void 0)}function vX(a,b,c,d){return a.someProp("createSelectionBetween",d=>d(a,b,c))||t3.between(b,c,d)}function vY(a){return(!a.editable||!!a.hasFocus())&&vZ(a)}function vZ(a){let b=a.domSelectionRange();if(!b.anchorNode)return!1;try{return a.dom.contains(3==b.anchorNode.nodeType?b.anchorNode.parentNode:b.anchorNode)&&(a.editable||a.dom.contains(3==b.focusNode.nodeType?b.focusNode.parentNode:b.focusNode))}catch(a){return!1}}function v$(a,b){let{$anchor:c,$head:d}=a.selection,e=b>0?c.max(d):c.min(d),f=e.parent.inlineContent?e.depth?a.doc.resolve(b>0?e.after():e.before()):null:e;return f&&t_.findFrom(f,b)}function v_(a,b){return a.dispatch(a.state.tr.setSelection(b).scrollIntoView()),!0}function v0(a,b,c){let d=a.state.selection;if(d instanceof t3){if(c.indexOf("s")>-1){let{$head:c}=d,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter;if(!e||e.isText||!e.isLeaf)return!1;let f=a.state.doc.resolve(c.pos+e.nodeSize*(b<0?-1:1));return v_(a,new t3(d.$anchor,f))}else if(!d.empty)return!1;else if(a.endOfTextblock(b>0?"forward":"backward")){let c=v$(a.state,b);return!!c&&c instanceof t5&&v_(a,c)}else if(!(u9&&c.indexOf("m")>-1)){let c=d.$head,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter,f;if(!e||e.isText)return!1;let g=b<0?c.pos-e.nodeSize:c.pos;return!!(e.isAtom||(f=a.docView.descAt(g))&&!f.contentDOM)&&(t5.isSelectable(e)?v_(a,new t5(b<0?a.state.doc.resolve(c.pos-e.nodeSize):c)):!!vc&&v_(a,new t3(a.state.doc.resolve(b<0?g:g+e.nodeSize))))}}else{if(d instanceof t5&&d.node.isInline)return v_(a,new t3(b>0?d.$to:d.$from));let c=v$(a.state,b);return!!c&&v_(a,c)}}function v1(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function v2(a,b){let c=a.pmViewDesc;return c&&0==c.size&&(b<0||a.nextSibling||"BR"!=a.nodeName)}function v3(a,b){return b<0?function(a){let b=a.domSelectionRange(),c=b.focusNode,d=b.focusOffset;if(!c)return;let e,f,g=!1;for(u3&&1==c.nodeType&&d<v1(c)&&v2(c.childNodes[d],-1)&&(g=!0);;)if(d>0)if(1!=c.nodeType)break;else{let a=c.childNodes[d-1];if(v2(a,-1))e=c,f=--d;else if(3==a.nodeType)d=(c=a).nodeValue.length;else break}else if(v4(c))break;else{let b=c.previousSibling;for(;b&&v2(b,-1);)e=c.parentNode,f=uL(b),b=b.previousSibling;if(b)d=v1(c=b);else{if((c=c.parentNode)==a.dom)break;d=0}}g?v5(a,c,d):e&&v5(a,e,f)}(a):function(a){let b,c,d=a.domSelectionRange(),e=d.focusNode,f=d.focusOffset;if(!e)return;let g=v1(e);for(;;)if(f<g){if(1!=e.nodeType)break;if(v2(e.childNodes[f],1))b=e,c=++f;else break}else if(v4(e))break;else{let d=e.nextSibling;for(;d&&v2(d,1);)b=d.parentNode,c=uL(d)+1,d=d.nextSibling;if(d)f=0,g=v1(e=d);else{if((e=e.parentNode)==a.dom)break;f=g=0}}b&&v5(a,b,c)}(a)}function v4(a){let b=a.pmViewDesc;return b&&b.node&&b.node.isBlock}function v5(a,b,c){if(3!=b.nodeType){let a,d;(d=function(a,b){for(;a&&b==a.childNodes.length&&!uU(a);)b=uL(a)+1,a=a.parentNode;for(;a&&b<a.childNodes.length;){let c=a.childNodes[b];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;a=c,b=0}}(b,c))?(b=d,c=0):(a=function(a,b){for(;a&&!b&&!uU(a);)b=uL(a),a=a.parentNode;for(;a&&b;){let c=a.childNodes[b-1];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;b=(a=c).childNodes.length}}(b,c))&&(b=a,c=a.nodeValue.length)}let d=a.domSelection();if(!d)return;if(uV(d)){let a=document.createRange();a.setEnd(b,c),a.setStart(b,c),d.removeAllRanges(),d.addRange(a)}else d.extend&&d.extend(b,c);a.domObserver.setCurSelection();let{state:e}=a;setTimeout(()=>{a.state==e&&vQ(a)},50)}function v6(a,b){let c=a.state.doc.resolve(b);if(!(u5||va)&&c.parent.inlineContent){let d=a.coordsAtPos(b);if(b>c.start()){let c=a.coordsAtPos(b-1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left<d.left?"ltr":"rtl"}if(b<c.end()){let c=a.coordsAtPos(b+1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left>d.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(a.dom).direction?"rtl":"ltr"}function v7(a,b,c){let d=a.state.selection;if(d instanceof t3&&!d.empty||c.indexOf("s")>-1||u9&&c.indexOf("m")>-1)return!1;let{$from:e,$to:f}=d;if(!e.parent.inlineContent||a.endOfTextblock(b<0?"up":"down")){let c=v$(a.state,b);if(c&&c instanceof t5)return v_(a,c)}if(!e.parent.inlineContent){let c=b<0?e:f,g=d instanceof t7?t_.near(c,b):t_.findFrom(c,b);return!!g&&v_(a,g)}return!1}function v8(a,b){if(!(a.state.selection instanceof t3))return!0;let{$head:c,$anchor:d,empty:e}=a.state.selection;if(!c.sameParent(d))return!0;if(!e)return!1;if(a.endOfTextblock(b>0?"forward":"backward"))return!0;let f=!c.textOffset&&(b<0?c.nodeBefore:c.nodeAfter);if(f&&!f.isText){let d=a.state.tr;return b<0?d.delete(c.pos-f.nodeSize,c.pos):d.delete(c.pos,c.pos+f.nodeSize),a.dispatch(d),!0}return!1}function v9(a,b,c){a.domObserver.stop(),b.contentEditable=c,a.domObserver.start()}function wa(a,b){a.someProp("transformCopied",c=>{b=c(b,a)});let c=[],{content:d,openStart:e,openEnd:f}=b;for(;e>1&&f>1&&1==d.childCount&&1==d.firstChild.childCount;){e--,f--;let a=d.firstChild;c.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),d=a.content}let g=a.someProp("clipboardSerializer")||tk.fromSchema(a.state.schema),h=wi(),i=h.createElement("div");i.appendChild(g.serializeFragment(d,{document:h}));let j=i.firstChild,k,l=0;for(;j&&1==j.nodeType&&(k=wg[j.nodeName.toLowerCase()]);){for(let a=k.length-1;a>=0;a--){let b=h.createElement(k[a]);for(;i.firstChild;)b.appendChild(i.firstChild);i.appendChild(b),l++}j=i.firstChild}return j&&1==j.nodeType&&j.setAttribute("data-pm-slice",`${e} ${f}${l?` -${l}`:""} ${JSON.stringify(c)}`),{dom:i,text:a.someProp("clipboardTextSerializer",c=>c(b,a))||b.content.textBetween(0,b.content.size,"\n\n"),slice:b}}function wb(a,b,c,d,e){let f,g,h=e.parent.type.spec.code;if(!c&&!b)return null;let i=!!b&&(d||h||!c);if(i){if(a.someProp("transformPastedText",c=>{b=c(b,h||d,a)}),h)return g=new sJ(sD.from(a.state.schema.text(b.replace(/\r\n?/g,"\n"))),0,0),a.someProp("transformPasted",b=>{g=b(g,a,!0)}),g;let c=a.someProp("clipboardTextParser",c=>c(b,e,d,a));if(c)g=c;else{let c=e.marks(),{schema:d}=a.state,g=tk.fromSchema(d);f=document.createElement("div"),b.split(/(?:\r\n?|\n)+/).forEach(a=>{let b=f.appendChild(document.createElement("p"));a&&b.appendChild(g.serializeNode(d.text(a,c)))})}}else a.someProp("transformPastedHTML",b=>{c=b(c,a)}),f=function(a){var b;let c,d=/^(\s*<meta [^>]*>)*/.exec(a);d&&(a=a.slice(d[0].length));let e=wi().createElement("div"),f=/<([a-z][^>\s]+)/i.exec(a),g;if((g=f&&wg[f[1].toLowerCase()])&&(a=g.map(a=>"<"+a+">").join("")+a+g.map(a=>"</"+a+">").reverse().join("")),e.innerHTML=(b=a,(c=window.trustedTypes)?(wj||(wj=c.defaultPolicy||c.createPolicy("ProseMirrorClipboard",{createHTML:a=>a})),wj.createHTML(b)):b),g)for(let a=0;a<g.length;a++)e=e.querySelector(g[a])||e;return e}(c),vc&&function(a){let b=a.querySelectorAll(u5?"span:not([class]):not([style])":"span.Apple-converted-space");for(let c=0;c<b.length;c++){let d=b[c];1==d.childNodes.length&&" "==d.textContent&&d.parentNode&&d.parentNode.replaceChild(a.ownerDocument.createTextNode(" "),d)}}(f);let j=f&&f.querySelector("[data-pm-slice]"),k=j&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(j.getAttribute("data-pm-slice")||"");if(k&&k[3])for(let a=+k[3];a>0;a--){let a=f.firstChild;for(;a&&1!=a.nodeType;)a=a.nextSibling;if(!a)break;f=a}if(g||(g=(a.someProp("clipboardParser")||a.someProp("domParser")||tb.fromSchema(a.state.schema)).parseSlice(f,{preserveWhitespace:!!(i||k),context:e,ruleFromNode:a=>"BR"!=a.nodeName||a.nextSibling||!a.parentNode||wc.test(a.parentNode.nodeName)?null:{ignore:!0}})),k)g=function(a,b){if(!a.size)return a;let c=a.content.firstChild.type.schema,d;try{d=JSON.parse(b)}catch(b){return a}let{content:e,openStart:f,openEnd:g}=a;for(let a=d.length-2;a>=0;a-=2){let b=c.nodes[d[a]];if(!b||b.hasRequiredAttrs())break;e=sD.from(b.create(d[a+1],e)),f++,g++}return new sJ(e,f,g)}(wf(g,+k[1],+k[2]),k[4]);else if((g=sJ.maxOpen(function(a,b){if(a.childCount<2)return a;for(let c=b.depth;c>=0;c--){let d=b.node(c).contentMatchAt(b.index(c)),e,f=[];if(a.forEach(a=>{if(!f)return;let b=d.findWrapping(a.type),c;if(!b)return f=null;if(c=f.length&&e.length&&function a(b,c,d,e,f){if(f<b.length&&f<c.length&&b[f]==c[f]){let g=a(b,c,d,e.lastChild,f+1);if(g)return e.copy(e.content.replaceChild(e.childCount-1,g));if(e.contentMatchAt(e.childCount).matchType(f==b.length-1?d.type:b[f+1]))return e.copy(e.content.append(sD.from(wd(d,b,f+1))))}}(b,e,a,f[f.length-1],0))f[f.length-1]=c;else{f.length&&(f[f.length-1]=function a(b,c){if(0==c)return b;let d=b.content.replaceChild(b.childCount-1,a(b.lastChild,c-1)),e=b.contentMatchAt(b.childCount).fillBefore(sD.empty,!0);return b.copy(d.append(e))}(f[f.length-1],e.length));let c=wd(a,b);f.push(c),d=d.matchType(c.type),e=b}}),f)return sD.from(f)}return a}(g.content,e),!0)).openStart||g.openEnd){let a=0,b=0;for(let b=g.content.firstChild;a<g.openStart&&!b.type.spec.isolating;a++,b=b.firstChild);for(let a=g.content.lastChild;b<g.openEnd&&!a.type.spec.isolating;b++,a=a.lastChild);g=wf(g,a,b)}return a.someProp("transformPasted",b=>{g=b(g,a,i)}),g}let wc=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function wd(a,b,c=0){for(let d=b.length-1;d>=c;d--)a=b[d].create(null,sD.from(a));return a}function we(a,b,c,d,e,f){let g=b<0?a.firstChild:a.lastChild,h=g.content;return a.childCount>1&&(f=0),e<d-1&&(h=we(h,b,c,d,e+1,f)),e>=c&&(h=b<0?g.contentMatchAt(0).fillBefore(h,f<=e).append(h):h.append(g.contentMatchAt(g.childCount).fillBefore(sD.empty,!0))),a.replaceChild(b<0?0:a.childCount-1,g.copy(h))}function wf(a,b,c){return b<a.openStart&&(a=new sJ(we(a.content,-1,b,a.openStart,0,a.openEnd),b,a.openEnd)),c<a.openEnd&&(a=new sJ(we(a.content,1,c,a.openEnd,0,0),a.openStart,c)),a}let wg={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},wh=null;function wi(){return wh||(wh=document.implementation.createHTMLDocument("title"))}let wj=null,wk={},wl={},wm={touchstart:!0,touchmove:!0};class wn{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function wo(a,b){a.input.lastSelectionOrigin=b,a.input.lastSelectionTime=Date.now()}function wp(a){a.someProp("handleDOMEvents",b=>{for(let c in b)a.input.eventHandlers[c]||a.dom.addEventListener(c,a.input.eventHandlers[c]=b=>wq(a,b))})}function wq(a,b){return a.someProp("handleDOMEvents",c=>{let d=c[b.type];return!!d&&(d(a,b)||b.defaultPrevented)})}function wr(a){return{left:a.clientX,top:a.clientY}}function ws(a,b,c,d,e){if(-1==d)return!1;let f=a.state.doc.resolve(d);for(let d=f.depth+1;d>0;d--)if(a.someProp(b,b=>d>f.depth?b(a,c,f.nodeAfter,f.before(d),e,!0):b(a,c,f.node(d),f.before(d),e,!1)))return!0;return!1}function wt(a,b,c){if(a.focused||a.focus(),a.state.selection.eq(b))return;let d=a.state.tr.setSelection(b);"pointer"==c&&d.setMeta("pointer",!0),a.dispatch(d)}wl.keydown=(a,b)=>{if((a.input.shiftKey=16==b.keyCode||b.shiftKey,!ww(a,b))&&(a.input.lastKeyCode=b.keyCode,a.input.lastKeyCodeTime=Date.now(),!vb||!u5||13!=b.keyCode))if(229!=b.keyCode&&a.domObserver.forceFlush(),!u8||13!=b.keyCode||b.ctrlKey||b.altKey||b.metaKey)a.someProp("handleKeyDown",c=>c(a,b))||function(a,b){let c,d=b.keyCode,e=(c="",b.ctrlKey&&(c+="c"),b.metaKey&&(c+="m"),b.altKey&&(c+="a"),b.shiftKey&&(c+="s"),c);if(8==d||u9&&72==d&&"c"==e)return v8(a,-1)||v3(a,-1);if(46==d&&!b.shiftKey||u9&&68==d&&"c"==e)return v8(a,1)||v3(a,1);if(13==d||27==d)return!0;if(37==d||u9&&66==d&&"c"==e){let b=37==d?"ltr"==v6(a,a.state.selection.from)?-1:1:-1;return v0(a,b,e)||v3(a,b)}if(39==d||u9&&70==d&&"c"==e){let b=39==d?"ltr"==v6(a,a.state.selection.from)?1:-1:1;return v0(a,b,e)||v3(a,b)}else if(38==d||u9&&80==d&&"c"==e)return v7(a,-1,e)||v3(a,-1);else if(40==d||u9&&78==d&&"c"==e)return function(a){if(!u7||a.state.selection.$head.parentOffset>0)return!1;let{focusNode:b,focusOffset:c}=a.domSelectionRange();if(b&&1==b.nodeType&&0==c&&b.firstChild&&"false"==b.firstChild.contentEditable){let c=b.firstChild;v9(a,c,"true"),setTimeout(()=>v9(a,c,"false"),20)}return!1}(a)||v7(a,1,e)||v3(a,1);else if(e==(u9?"m":"c")&&(66==d||73==d||89==d||90==d))return!0;return!1}(a,b)?b.preventDefault():wo(a,"key");else{let b=Date.now();a.input.lastIOSEnter=b,a.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{a.input.lastIOSEnter==b&&(a.someProp("handleKeyDown",b=>b(a,uW(13,"Enter"))),a.input.lastIOSEnter=0)},200)}},wl.keyup=(a,b)=>{16==b.keyCode&&(a.input.shiftKey=!1)},wl.keypress=(a,b)=>{if(ww(a,b)||!b.charCode||b.ctrlKey&&!b.altKey||u9&&b.metaKey)return;if(a.someProp("handleKeyPress",c=>c(a,b)))return void b.preventDefault();let c=a.state.selection;if(!(c instanceof t3)||!c.$from.sameParent(c.$to)){let d=String.fromCharCode(b.charCode),e=()=>a.state.tr.insertText(d).scrollIntoView();/[\r\n]/.test(d)||a.someProp("handleTextInput",b=>b(a,c.$from.pos,c.$to.pos,d,e))||a.dispatch(e()),b.preventDefault()}};let wu=u9?"metaKey":"ctrlKey";wk.mousedown=(a,b)=>{var c;let d,e;a.input.shiftKey=b.shiftKey;let f=wA(a),g=Date.now(),h="singleClick";g-a.input.lastClick.time<500&&(d=(c=a.input.lastClick).x-b.clientX)*d+(e=c.y-b.clientY)*e<100&&!b[wu]&&a.input.lastClick.button==b.button&&("singleClick"==a.input.lastClick.type?h="doubleClick":"doubleClick"==a.input.lastClick.type&&(h="tripleClick")),a.input.lastClick={time:g,x:b.clientX,y:b.clientY,type:h,button:b.button};let i=a.posAtCoords(wr(b));i&&("singleClick"==h?(a.input.mouseDown&&a.input.mouseDown.done(),a.input.mouseDown=new wv(a,i,b,!!f)):("doubleClick"==h?function(a,b,c,d){return ws(a,"handleDoubleClickOn",b,c,d)||a.someProp("handleDoubleClick",c=>c(a,b,d))}:function(a,b,c,d){return ws(a,"handleTripleClickOn",b,c,d)||a.someProp("handleTripleClick",c=>c(a,b,d))||function(a,b,c){if(0!=c.button)return!1;let d=a.state.doc;if(-1==b)return!!d.inlineContent&&(wt(a,t3.create(d,0,d.content.size),"pointer"),!0);let e=d.resolve(b);for(let b=e.depth+1;b>0;b--){let c=b>e.depth?e.nodeAfter:e.node(b),f=e.before(b);if(c.inlineContent)wt(a,t3.create(d,f+1,f+1+c.content.size),"pointer");else{if(!t5.isSelectable(c))continue;wt(a,t5.create(d,f),"pointer")}return!0}}(a,c,d)})(a,i.pos,i.inside,b)?b.preventDefault():wo(a,"pointer"))};class wv{constructor(a,b,c,d){let e,f;if(this.view=a,this.pos=b,this.event=c,this.flushed=d,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=a.state.doc,this.selectNode=!!c[wu],this.allowDefault=c.shiftKey,b.inside>-1)e=a.state.doc.nodeAt(b.inside),f=b.inside;else{let c=a.state.doc.resolve(b.pos);e=c.parent,f=c.depth?c.before():0}const g=d?null:c.target,h=g?a.docView.nearestDesc(g,!0):null;this.target=h&&1==h.nodeDOM.nodeType?h.nodeDOM:null;let{selection:i}=a.state;(0==c.button&&e.type.spec.draggable&&!1!==e.type.spec.selectable||i instanceof t5&&i.from<=f&&i.to>f)&&(this.mightDrag={node:e,pos:f,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&u3&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),a.root.addEventListener("mouseup",this.up=this.up.bind(this)),a.root.addEventListener("mousemove",this.move=this.move.bind(this)),wo(a,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>vQ(this.view)),this.view.input.mouseDown=null}up(a){if(this.done(),!this.view.dom.contains(a.target))return;let b=this.pos;if(this.view.state.doc!=this.startDoc&&(b=this.view.posAtCoords(wr(a))),this.updateAllowDefault(a),this.allowDefault||!b)wo(this.view,"pointer");else{var c,d,e,f;(c=this.view,d=b.pos,e=b.inside,f=this.selectNode,ws(c,"handleClickOn",d,e,a)||c.someProp("handleClick",b=>b(c,d,a))||(f?function(a,b){if(-1==b)return!1;let c=a.state.selection,d,e;c instanceof t5&&(d=c.node);let f=a.state.doc.resolve(b);for(let a=f.depth+1;a>0;a--){let b=a>f.depth?f.nodeAfter:f.node(a);if(t5.isSelectable(b)){e=d&&c.$from.depth>0&&a>=c.$from.depth&&f.before(c.$from.depth+1)==c.$from.pos?f.before(c.$from.depth):f.before(a);break}}return null!=e&&(wt(a,t5.create(a.state.doc,e),"pointer"),!0)}(c,e):function(a,b){if(-1==b)return!1;let c=a.state.doc.resolve(b),d=c.nodeAfter;return!!(d&&d.isAtom&&t5.isSelectable(d))&&(wt(a,new t5(c),"pointer"),!0)}(c,e)))?a.preventDefault():0==a.button&&(this.flushed||u7&&this.mightDrag&&!this.mightDrag.node.isAtom||u5&&!this.view.state.selection.visible&&2>=Math.min(Math.abs(b.pos-this.view.state.selection.from),Math.abs(b.pos-this.view.state.selection.to)))?(wt(this.view,t_.near(this.view.state.doc.resolve(b.pos)),"pointer"),a.preventDefault()):wo(this.view,"pointer")}}move(a){this.updateAllowDefault(a),wo(this.view,"pointer"),0==a.buttons&&this.done()}updateAllowDefault(a){!this.allowDefault&&(Math.abs(this.event.x-a.clientX)>4||Math.abs(this.event.y-a.clientY)>4)&&(this.allowDefault=!0)}}function ww(a,b){return!!a.composing||!!(u7&&500>Math.abs(b.timeStamp-a.input.compositionEndedAt))&&(a.input.compositionEndedAt=-2e8,!0)}wk.touchstart=a=>{a.input.lastTouch=Date.now(),wA(a),wo(a,"pointer")},wk.touchmove=a=>{a.input.lastTouch=Date.now(),wo(a,"pointer")},wk.contextmenu=a=>wA(a);let wx=vb?5e3:-1;function wy(a,b){clearTimeout(a.input.composingTimeout),b>-1&&(a.input.composingTimeout=setTimeout(()=>wA(a),b))}function wz(a){let b;for(a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=((b=document.createEvent("Event")).initEvent("event",!0,!0),b.timeStamp));a.input.compositionNodes.length>0;)a.input.compositionNodes.pop().markParentsDirty()}function wA(a,b=!1){if(!vb||!(a.domObserver.flushingSoon>=0)){if(a.domObserver.forceFlush(),wz(a),b||a.docView&&a.docView.dirty){let c=vO(a),d=a.state.selection;return c&&!c.eq(d)?a.dispatch(a.state.tr.setSelection(c)):(a.markCursor||b)&&!d.$from.node(d.$from.sharedDepth(d.to)).inlineContent?a.dispatch(a.state.tr.deleteSelection()):a.updateState(a.state),!0}return!1}}wl.compositionstart=wl.compositionupdate=a=>{if(!a.composing){a.domObserver.flush();let{state:b}=a,c=b.selection.$to;if(b.selection instanceof t3&&(b.storedMarks||!c.textOffset&&c.parentOffset&&c.nodeBefore.marks.some(a=>!1===a.type.spec.inclusive)||u5&&va&&function(a){let{focusNode:b,focusOffset:c}=a.domSelectionRange();if(!b||1!=b.nodeType||c>=b.childNodes.length)return!1;let d=b.childNodes[c];return 1==d.nodeType&&"false"==d.contentEditable}(a)))a.markCursor=a.state.storedMarks||c.marks(),wA(a,!0),a.markCursor=null;else if(wA(a,!b.selection.empty),u3&&b.selection.empty&&c.parentOffset&&!c.textOffset&&c.nodeBefore.marks.length){let b=a.domSelectionRange();for(let c=b.focusNode,d=b.focusOffset;c&&1==c.nodeType&&0!=d;){let b=d<0?c.lastChild:c.childNodes[d-1];if(!b)break;if(3==b.nodeType){let c=a.domSelection();c&&c.collapse(b,b.nodeValue.length);break}c=b,d=-1}}a.input.composing=!0}wy(a,wx)},wl.compositionend=(a,b)=>{a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=b.timeStamp,a.input.compositionPendingChanges=a.domObserver.pendingRecords().length?a.input.compositionID:0,a.input.compositionNode=null,a.input.badSafariComposition?a.domObserver.forceFlush():a.input.compositionPendingChanges&&Promise.resolve().then(()=>a.domObserver.flush()),a.input.compositionID++,wy(a,20))};let wB=u1&&u2<15||u8&&vd<604;function wC(a,b,c,d,e){let f=wb(a,b,c,d,a.state.selection.$from);if(a.someProp("handlePaste",b=>b(a,e,f||sJ.empty)))return!0;if(!f)return!1;let g=0==f.openStart&&0==f.openEnd&&1==f.content.childCount?f.content.firstChild:null,h=g?a.state.tr.replaceSelectionWith(g,d):a.state.tr.replaceSelection(f);return a.dispatch(h.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function wD(a){let b=a.getData("text/plain")||a.getData("Text");if(b)return b;let c=a.getData("text/uri-list");return c?c.replace(/\r?\n/g," "):""}wk.copy=wl.cut=(a,b)=>{let c=a.state.selection,d="cut"==b.type;if(c.empty)return;let e=wB?null:b.clipboardData,{dom:f,text:g}=wa(a,c.content());e?(b.preventDefault(),e.clearData(),e.setData("text/html",f.innerHTML),e.setData("text/plain",g)):function(a,b){if(!a.dom.parentNode)return;let c=a.dom.parentNode.appendChild(document.createElement("div"));c.appendChild(b),c.style.cssText="position: fixed; left: -10000px; top: 10px";let d=getSelection(),e=document.createRange();e.selectNodeContents(b),a.dom.blur(),d.removeAllRanges(),d.addRange(e),setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c),a.focus()},50)}(a,f),d&&a.dispatch(a.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},wl.paste=(a,b)=>{if(a.composing&&!vb)return;let c=wB?null:b.clipboardData,d=a.input.shiftKey&&45!=a.input.lastKeyCode;c&&wC(a,wD(c),c.getData("text/html"),d,b)?b.preventDefault():function(a,b){if(!a.dom.parentNode)return;let c=a.input.shiftKey||a.state.selection.$from.parent.type.spec.code,d=a.dom.parentNode.appendChild(document.createElement(c?"textarea":"div"));c||(d.contentEditable="true"),d.style.cssText="position: fixed; left: -10000px; top: 10px",d.focus();let e=a.input.shiftKey&&45!=a.input.lastKeyCode;setTimeout(()=>{a.focus(),d.parentNode&&d.parentNode.removeChild(d),c?wC(a,d.value,null,e,b):wC(a,d.textContent,d.innerHTML,e,b)},50)}(a,b)};class wE{constructor(a,b,c){this.slice=a,this.move=b,this.node=c}}let wF=u9?"altKey":"ctrlKey";function wG(a,b){let c=a.someProp("dragCopies",a=>!a(b));return null!=c?c:!b[wF]}for(let a in wk.dragstart=(a,b)=>{let c,d=a.input.mouseDown;if(d&&d.done(),!b.dataTransfer)return;let e=a.state.selection,f=e.empty?null:a.posAtCoords(wr(b));if(f&&f.pos>=e.from&&f.pos<=(e instanceof t5?e.to-1:e.to));else if(d&&d.mightDrag)c=t5.create(a.state.doc,d.mightDrag.pos);else if(b.target&&1==b.target.nodeType){let d=a.docView.nearestDesc(b.target,!0);d&&d.node.type.spec.draggable&&d!=a.docView&&(c=t5.create(a.state.doc,d.posBefore))}let g=(c||a.state.selection).content(),{dom:h,text:i,slice:j}=wa(a,g);b.dataTransfer.files.length&&u5&&!(u6>120)||b.dataTransfer.clearData(),b.dataTransfer.setData(wB?"Text":"text/html",h.innerHTML),b.dataTransfer.effectAllowed="copyMove",wB||b.dataTransfer.setData("text/plain",i),a.dragging=new wE(j,wG(a,b),c)},wk.dragend=a=>{let b=a.dragging;window.setTimeout(()=>{a.dragging==b&&(a.dragging=null)},50)},wl.dragover=wl.dragenter=(a,b)=>b.preventDefault(),wl.drop=(a,b)=>{try{!function(a,b,c){if(!b.dataTransfer)return;let d=a.posAtCoords(wr(b));if(!d)return;let e=a.state.doc.resolve(d.pos),f=c&&c.slice;f?a.someProp("transformPasted",b=>{f=b(f,a,!1)}):f=wb(a,wD(b.dataTransfer),wB?null:b.dataTransfer.getData("text/html"),!1,e);let g=!!(c&&wG(a,b));if(a.someProp("handleDrop",c=>c(a,b,f||sJ.empty,g)))return b.preventDefault();if(!f)return;b.preventDefault();let h=f?tN(a.state.doc,e.pos,f):e.pos;null==h&&(h=e.pos);let i=a.state.tr;if(g){let{node:a}=c;a?a.replace(i):i.deleteSelection()}let j=i.mapping.map(h),k=0==f.openStart&&0==f.openEnd&&1==f.content.childCount,l=i.doc;if(k?i.replaceRangeWith(j,j,f.content.firstChild):i.replaceRange(j,j,f),i.doc.eq(l))return;let m=i.doc.resolve(j);if(k&&t5.isSelectable(f.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(f.content.firstChild))i.setSelection(new t5(m));else{let b=i.mapping.map(h);i.mapping.maps[i.mapping.maps.length-1].forEach((a,c,d,e)=>b=e),i.setSelection(vX(a,m,i.doc.resolve(b)))}a.focus(),a.dispatch(i.setMeta("uiEvent","drop"))}(a,b,a.dragging)}finally{a.dragging=null}},wk.focus=a=>{a.input.lastFocus=Date.now(),a.focused||(a.domObserver.stop(),a.dom.classList.add("ProseMirror-focused"),a.domObserver.start(),a.focused=!0,setTimeout(()=>{a.docView&&a.hasFocus()&&!a.domObserver.currentSelection.eq(a.domSelectionRange())&&vQ(a)},20))},wk.blur=(a,b)=>{a.focused&&(a.domObserver.stop(),a.dom.classList.remove("ProseMirror-focused"),a.domObserver.start(),b.relatedTarget&&a.dom.contains(b.relatedTarget)&&a.domObserver.currentSelection.clear(),a.focused=!1)},wk.beforeinput=(a,b)=>{if(u5&&vb&&"deleteContentBackward"==b.inputType){a.domObserver.flushSoon();let{domChangeCount:b}=a.input;setTimeout(()=>{if(a.input.domChangeCount!=b||(a.dom.blur(),a.focus(),a.someProp("handleKeyDown",b=>b(a,uW(8,"Backspace")))))return;let{$cursor:c}=a.state.selection;c&&c.pos>0&&a.dispatch(a.state.tr.delete(c.pos-1,c.pos).scrollIntoView())},50)}},wl)wk[a]=wl[a];function wH(a,b){if(a==b)return!0;for(let c in a)if(a[c]!==b[c])return!1;for(let c in b)if(!(c in a))return!1;return!0}class wI{constructor(a,b){this.toDOM=a,this.spec=b||wN,this.side=this.spec.side||0}map(a,b,c,d){let{pos:e,deleted:f}=a.mapResult(b.from+d,this.side<0?-1:1);return f?null:new wL(e-c,e-c,this)}valid(){return!0}eq(a){return this==a||a instanceof wI&&(this.spec.key&&this.spec.key==a.spec.key||this.toDOM==a.toDOM&&wH(this.spec,a.spec))}destroy(a){this.spec.destroy&&this.spec.destroy(a)}}class wJ{constructor(a,b){this.attrs=a,this.spec=b||wN}map(a,b,c,d){let e=a.map(b.from+d,this.spec.inclusiveStart?-1:1)-c,f=a.map(b.to+d,this.spec.inclusiveEnd?1:-1)-c;return e>=f?null:new wL(e,f,this)}valid(a,b){return b.from<b.to}eq(a){return this==a||a instanceof wJ&&wH(this.attrs,a.attrs)&&wH(this.spec,a.spec)}static is(a){return a.type instanceof wJ}destroy(){}}class wK{constructor(a,b){this.attrs=a,this.spec=b||wN}map(a,b,c,d){let e=a.mapResult(b.from+d,1);if(e.deleted)return null;let f=a.mapResult(b.to+d,-1);return f.deleted||f.pos<=e.pos?null:new wL(e.pos-c,f.pos-c,this)}valid(a,b){let{index:c,offset:d}=a.content.findIndex(b.from),e;return d==b.from&&!(e=a.child(c)).isText&&d+e.nodeSize==b.to}eq(a){return this==a||a instanceof wK&&wH(this.attrs,a.attrs)&&wH(this.spec,a.spec)}destroy(){}}class wL{constructor(a,b,c){this.from=a,this.to=b,this.type=c}copy(a,b){return new wL(a,b,this.type)}eq(a,b=0){return this.type.eq(a.type)&&this.from+b==a.from&&this.to+b==a.to}map(a,b,c){return this.type.map(a,this,b,c)}static widget(a,b,c){return new wL(a,a,new wI(b,c))}static inline(a,b,c,d){return new wL(a,b,new wJ(c,d))}static node(a,b,c,d){return new wL(a,b,new wK(c,d))}get spec(){return this.type.spec}get inline(){return this.type instanceof wJ}get widget(){return this.type instanceof wI}}let wM=[],wN={};class wO{constructor(a,b){this.local=a.length?a:wM,this.children=b.length?b:wM}static create(a,b){return b.length?wU(b,a,0,wN):wP}find(a,b,c){let d=[];return this.findInner(null==a?0:a,null==b?1e9:b,d,0,c),d}findInner(a,b,c,d,e){for(let f=0;f<this.local.length;f++){let g=this.local[f];g.from<=b&&g.to>=a&&(!e||e(g.spec))&&c.push(g.copy(g.from+d,g.to+d))}for(let f=0;f<this.children.length;f+=3)if(this.children[f]<b&&this.children[f+1]>a){let g=this.children[f]+1;this.children[f+2].findInner(a-g,b-g,c,d+g,e)}}map(a,b,c){return this==wP||0==a.maps.length?this:this.mapInner(a,b,0,0,c||wN)}mapInner(a,b,c,d,e){let f;for(let g=0;g<this.local.length;g++){let h=this.local[g].map(a,c,d);h&&h.type.valid(b,h)?(f||(f=[])).push(h):e.onRemove&&e.onRemove(this.local[g].spec)}return this.children.length?function(a,b,c,d,e,f,g){let h=a.slice();for(let a=0,b=f;a<c.maps.length;a++){let d=0;c.maps[a].forEach((a,c,e,f)=>{let g=f-e-(c-a);for(let e=0;e<h.length;e+=3){let f=h[e+1];if(f<0||a>f+b-d)continue;let i=h[e]+b-d;c>=i?h[e+1]=a<=i?-2:-1:a>=b&&g&&(h[e]+=g,h[e+1]+=g)}d+=g}),b=c.maps[a].map(b,-1)}let i=!1;for(let b=0;b<h.length;b+=3)if(h[b+1]<0){if(-2==h[b+1]){i=!0,h[b+1]=-1;continue}let j=c.map(a[b]+f),k=j-e;if(k<0||k>=d.content.size){i=!0;continue}let l=c.map(a[b+1]+f,-1)-e,{index:m,offset:n}=d.content.findIndex(k),o=d.maybeChild(m);if(o&&n==k&&n+o.nodeSize==l){let d=h[b+2].mapInner(c,o,j+1,a[b]+f+1,g);d!=wP?(h[b]=k,h[b+1]=l,h[b+2]=d):(h[b+1]=-2,i=!0)}else i=!0}if(i){let i=wU(function(a,b,c,d,e,f,g){for(let h=0;h<a.length;h+=3)-1==a[h+1]&&function a(b,f){for(let a=0;a<b.local.length;a++){let h=b.local[a].map(d,e,f);h?c.push(h):g.onRemove&&g.onRemove(b.local[a].spec)}for(let c=0;c<b.children.length;c+=3)a(b.children[c+2],b.children[c]+f+1)}(a[h+2],b[h]+f+1);return c}(h,a,b,c,e,f,g),d,0,g);b=i.local;for(let a=0;a<h.length;a+=3)h[a+1]<0&&(h.splice(a,3),a-=3);for(let a=0,b=0;a<i.children.length;a+=3){let c=i.children[a];for(;b<h.length&&h[b]<c;)b+=3;h.splice(b,0,i.children[a],i.children[a+1],i.children[a+2])}}return new wO(b.sort(wV),h)}(this.children,f||[],a,b,c,d,e):f?new wO(f.sort(wV),wM):wP}add(a,b){return b.length?this==wP?wO.create(a,b):this.addInner(a,b,0):this}addInner(a,b,c){let d,e=0;a.forEach((a,f)=>{let g=f+c,h;if(h=wS(b,a,g)){for(d||(d=this.children.slice());e<d.length&&d[e]<f;)e+=3;d[e]==f?d[e+2]=d[e+2].addInner(a,h,g+1):d.splice(e,0,f,f+a.nodeSize,wU(h,a,g+1,wN)),e+=3}});let f=wR(e?wT(b):b,-c);for(let b=0;b<f.length;b++)f[b].type.valid(a,f[b])||f.splice(b--,1);return new wO(f.length?this.local.concat(f).sort(wV):this.local,d||this.children)}remove(a){return 0==a.length||this==wP?this:this.removeInner(a,0)}removeInner(a,b){let c=this.children,d=this.local;for(let d=0;d<c.length;d+=3){let e,f=c[d]+b,g=c[d+1]+b;for(let b=0,c;b<a.length;b++)(c=a[b])&&c.from>f&&c.to<g&&(a[b]=null,(e||(e=[])).push(c));if(!e)continue;c==this.children&&(c=this.children.slice());let h=c[d+2].removeInner(e,f+1);h!=wP?c[d+2]=h:(c.splice(d,3),d-=3)}if(d.length){for(let c=0,e;c<a.length;c++)if(e=a[c])for(let a=0;a<d.length;a++)d[a].eq(e,b)&&(d==this.local&&(d=this.local.slice()),d.splice(a--,1))}return c==this.children&&d==this.local?this:d.length||c.length?new wO(d,c):wP}forChild(a,b){let c,d;if(this==wP)return this;if(b.isLeaf)return wO.empty;for(let b=0;b<this.children.length;b+=3)if(this.children[b]>=a){this.children[b]==a&&(c=this.children[b+2]);break}let e=a+1,f=e+b.content.size;for(let a=0;a<this.local.length;a++){let b=this.local[a];if(b.from<f&&b.to>e&&b.type instanceof wJ){let a=Math.max(e,b.from)-e,c=Math.min(f,b.to)-e;a<c&&(d||(d=[])).push(b.copy(a,c))}}if(d){let a=new wO(d.sort(wV),wM);return c?new wQ([a,c]):a}return c||wP}eq(a){if(this==a)return!0;if(!(a instanceof wO)||this.local.length!=a.local.length||this.children.length!=a.children.length)return!1;for(let b=0;b<this.local.length;b++)if(!this.local[b].eq(a.local[b]))return!1;for(let b=0;b<this.children.length;b+=3)if(this.children[b]!=a.children[b]||this.children[b+1]!=a.children[b+1]||!this.children[b+2].eq(a.children[b+2]))return!1;return!0}locals(a){return wW(this.localsInner(a))}localsInner(a){if(this==wP)return wM;if(a.inlineContent||!this.local.some(wJ.is))return this.local;let b=[];for(let a=0;a<this.local.length;a++)this.local[a].type instanceof wJ||b.push(this.local[a]);return b}forEachSet(a){a(this)}}wO.empty=new wO([],[]),wO.removeOverlap=wW;let wP=wO.empty;class wQ{constructor(a){this.members=a}map(a,b){let c=this.members.map(c=>c.map(a,b,wN));return wQ.from(c)}forChild(a,b){if(b.isLeaf)return wO.empty;let c=[];for(let d=0;d<this.members.length;d++){let e=this.members[d].forChild(a,b);e!=wP&&(e instanceof wQ?c=c.concat(e.members):c.push(e))}return wQ.from(c)}eq(a){if(!(a instanceof wQ)||a.members.length!=this.members.length)return!1;for(let b=0;b<this.members.length;b++)if(!this.members[b].eq(a.members[b]))return!1;return!0}locals(a){let b,c=!0;for(let d=0;d<this.members.length;d++){let e=this.members[d].localsInner(a);if(e.length)if(b){c&&(b=b.slice(),c=!1);for(let a=0;a<e.length;a++)b.push(e[a])}else b=e}return b?wW(c?b:b.sort(wV)):wM}static from(a){switch(a.length){case 0:return wP;case 1:return a[0];default:return new wQ(a.every(a=>a instanceof wO)?a:a.reduce((a,b)=>a.concat(b instanceof wO?b:b.members),[]))}}forEachSet(a){for(let b=0;b<this.members.length;b++)this.members[b].forEachSet(a)}}function wR(a,b){if(!b||!a.length)return a;let c=[];for(let d=0;d<a.length;d++){let e=a[d];c.push(new wL(e.from+b,e.to+b,e.type))}return c}function wS(a,b,c){if(b.isLeaf)return null;let d=c+b.nodeSize,e=null;for(let b=0,f;b<a.length;b++)(f=a[b])&&f.from>c&&f.to<d&&((e||(e=[])).push(f),a[b]=null);return e}function wT(a){let b=[];for(let c=0;c<a.length;c++)null!=a[c]&&b.push(a[c]);return b}function wU(a,b,c,d){let e=[],f=!1;b.forEach((b,g)=>{let h=wS(a,b,g+c);if(h){f=!0;let a=wU(h,b,c+g+1,d);a!=wP&&e.push(g,g+b.nodeSize,a)}});let g=wR(f?wT(a):a,-c).sort(wV);for(let a=0;a<g.length;a++)g[a].type.valid(b,g[a])||(d.onRemove&&d.onRemove(g[a].spec),g.splice(a--,1));return g.length||e.length?new wO(g,e):wP}function wV(a,b){return a.from-b.from||a.to-b.to}function wW(a){let b=a;for(let c=0;c<b.length-1;c++){let d=b[c];if(d.from!=d.to)for(let e=c+1;e<b.length;e++){let f=b[e];if(f.from==d.from){f.to!=d.to&&(b==a&&(b=a.slice()),b[e]=f.copy(f.from,d.to),wX(b,e+1,f.copy(d.to,f.to)));continue}f.from<d.to&&(b==a&&(b=a.slice()),b[c]=d.copy(d.from,f.from),wX(b,e,d.copy(f.from,d.to)));break}}return b}function wX(a,b,c){for(;b<a.length&&wV(c,a[b])>0;)b++;a.splice(b,0,c)}function wY(a){let b=[];return a.someProp("decorations",c=>{let d=c(a.state);d&&d!=wP&&b.push(d)}),a.cursorWrapper&&b.push(wO.create(a.state.doc,[a.cursorWrapper.deco])),wQ.from(b)}let wZ={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},w$=u1&&u2<=11;class w_{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(a){this.anchorNode=a.anchorNode,this.anchorOffset=a.anchorOffset,this.focusNode=a.focusNode,this.focusOffset=a.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(a){return a.anchorNode==this.anchorNode&&a.anchorOffset==this.anchorOffset&&a.focusNode==this.focusNode&&a.focusOffset==this.focusOffset}}class w0{constructor(a,b){this.view=a,this.handleDOMChange=b,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new w_,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(b=>{for(let a=0;a<b.length;a++)this.queue.push(b[a]);u1&&u2<=11&&b.some(a=>"childList"==a.type&&a.removedNodes.length||"characterData"==a.type&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():u7&&a.composing&&b.some(a=>"childList"==a.type&&"TR"==a.target.nodeName)?(a.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),w$&&(this.onCharData=a=>{this.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,wZ)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let a=this.observer.takeRecords();if(a.length){for(let b=0;b<a.length;b++)this.queue.push(a[b]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(vY(this.view)){if(this.suppressingSelectionUpdates)return vQ(this.view);if(u1&&u2<=11&&!this.view.state.selection.empty){let a=this.view.domSelectionRange();if(a.focusNode&&uQ(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(a){if(!a.focusNode)return!0;let b=new Set,c;for(let c=a.focusNode;c;c=uM(c))b.add(c);for(let d=a.anchorNode;d;d=uM(d))if(b.has(d)){c=d;break}let d=c&&this.view.docView.nearestDesc(c);if(d&&d.ignoreMutation({type:"selection",target:3==c.nodeType?c.parentNode:c}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let a of this.observer.takeRecords())this.queue.push(a);return this.queue}flush(){var a;let{view:b}=this;if(!b.docView||this.flushingSoon>-1)return;let c=this.pendingRecords();c.length&&(this.queue=[]);let d=b.domSelectionRange(),e=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(d)&&vY(b)&&!this.ignoreSelectionChange(d),f=-1,g=-1,h=!1,i=[];if(b.editable)for(let a=0;a<c.length;a++){let b=this.registerMutation(c[a],i);b&&(f=f<0?b.from:Math.min(b.from,f),g=g<0?b.to:Math.max(b.to,g),b.typeOver&&(h=!0))}if(i.some(a=>"BR"==a.nodeName)&&(8==b.input.lastKeyCode||46==b.input.lastKeyCode)){for(let a of i)if("BR"==a.nodeName&&a.parentNode){let b=a.nextSibling;b&&1==b.nodeType&&"false"==b.contentEditable&&a.parentNode.removeChild(a)}}else if(u3&&i.length){let a=i.filter(a=>"BR"==a.nodeName);if(2==a.length){let[b,c]=a;b.parentNode&&b.parentNode.parentNode==c.parentNode?c.remove():b.remove()}else{let{focusNode:c}=this.currentSelection;for(let d of a){let a=d.parentNode;a&&"LI"==a.nodeName&&(!c||function(a,b){for(let c=b.parentNode;c&&c!=a.dom;c=c.parentNode){let b=a.docView.nearestDesc(c,!0);if(b&&b.node.isBlock)return c}return null}(b,c)!=a)&&d.remove()}}}let j=null;f<0&&e&&b.input.lastFocus>Date.now()-200&&Math.max(b.input.lastTouch,b.input.lastClick.time)<Date.now()-300&&uV(d)&&(j=vO(b))&&j.eq(t_.near(b.state.doc.resolve(0),1))?(b.input.lastFocus=0,vQ(b),this.currentSelection.set(d),b.scrollToSelection()):(f>-1||e)&&(f>-1&&(b.docView.markDirty(f,g),a=b,!w1.has(a)&&(w1.set(a,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(a.dom).whiteSpace))&&(a.requiresGeckoHackNode=u3,w2||(console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),w2=!0))),b.input.badSafariComposition&&(b.input.badSafariComposition=!1,function(a,b){var c;let{focusNode:d,focusOffset:e}=a.domSelectionRange();for(let f of b)if((null==(c=f.parentNode)?void 0:c.nodeName)=="TR"){let b=f.nextSibling;for(;b&&"TD"!=b.nodeName&&"TH"!=b.nodeName;)b=b.nextSibling;if(b){let c=b;for(;;){let a=c.firstChild;if(!a||1!=a.nodeType||"false"==a.contentEditable||/^(BR|IMG)$/.test(a.nodeName))break;c=a}c.insertBefore(f,c.firstChild),d==f&&a.domSelection().collapse(f,e)}else f.parentNode.removeChild(f)}}(b,i)),this.handleDOMChange(f,g,h,i),b.docView&&b.docView.dirty?b.updateState(b.state):this.currentSelection.eq(d)||vQ(b),this.currentSelection.set(d))}registerMutation(a,b){if(b.indexOf(a.target)>-1)return null;let c=this.view.docView.nearestDesc(a.target);if("attributes"==a.type&&(c==this.view.docView||"contenteditable"==a.attributeName||"style"==a.attributeName&&!a.oldValue&&!a.target.getAttribute("style"))||!c||c.ignoreMutation(a))return null;if("childList"==a.type){for(let c=0;c<a.addedNodes.length;c++){let d=a.addedNodes[c];b.push(d),3==d.nodeType&&(this.lastChangedTextNode=d)}if(c.contentDOM&&c.contentDOM!=c.dom&&!c.contentDOM.contains(a.target))return{from:c.posBefore,to:c.posAfter};let d=a.previousSibling,e=a.nextSibling;if(u1&&u2<=11&&a.addedNodes.length)for(let b=0;b<a.addedNodes.length;b++){let{previousSibling:c,nextSibling:f}=a.addedNodes[b];(!c||0>Array.prototype.indexOf.call(a.addedNodes,c))&&(d=c),(!f||0>Array.prototype.indexOf.call(a.addedNodes,f))&&(e=f)}let f=d&&d.parentNode==a.target?uL(d)+1:0,g=c.localPosFromDOM(a.target,f,-1),h=e&&e.parentNode==a.target?uL(e):a.target.childNodes.length;return{from:g,to:c.localPosFromDOM(a.target,h,1)}}return"attributes"==a.type?{from:c.posAtStart-c.border,to:c.posAtEnd+c.border}:(this.lastChangedTextNode=a.target,{from:c.posAtStart,to:c.posAtEnd,typeOver:a.target.nodeValue==a.oldValue})}}let w1=new WeakMap,w2=!1;function w3(a,b){let c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=a.domAtPos(a.state.selection.anchor);return uQ(g.node,g.offset,e,f)&&([c,d,e,f]=[e,f,c,d]),{anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f}}function w4(a){let b=a.pmViewDesc;if(b)return b.parseRule();if("BR"==a.nodeName&&a.parentNode){if(u7&&/^(ul|ol)$/i.test(a.parentNode.nodeName)){let a=document.createElement("div");return a.appendChild(document.createElement("li")),{skip:a}}else if(a.parentNode.lastChild==a||u7&&/^(tr|table)$/i.test(a.parentNode.nodeName))return{ignore:!0}}else if("IMG"==a.nodeName&&a.getAttribute("mark-placeholder"))return{ignore:!0};return null}let w5=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function w6(a,b,c){return Math.max(c.anchor,c.head)>b.content.size?null:vX(a,b.resolve(c.anchor),b.resolve(c.head))}function w7(a,b,c){let d=a.depth,e=b?a.end():a.pos;for(;d>0&&(b||a.indexAfter(d)==a.node(d).childCount);)d--,e++,b=!1;if(c){let b=a.node(d).maybeChild(a.indexAfter(d));for(;b&&!b.isLeaf;)b=b.firstChild,e++}return e}function w8(a){if(2!=a.length)return!1;let b=a.charCodeAt(0),c=a.charCodeAt(1);return b>=56320&&b<=57343&&c>=55296&&c<=56319}class w9{constructor(a,b){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new wn,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=b,this.state=b.state,this.directPlugins=b.plugins||[],this.directPlugins.forEach(xe),this.dispatch=this.dispatch.bind(this),this.dom=a&&a.mount||document.createElement("div"),a&&(a.appendChild?a.appendChild(this.dom):"function"==typeof a?a(this.dom):a.mount&&(this.mounted=!0)),this.editable=xc(this),xb(this),this.nodeViews=xd(this),this.docView=vA(this.state.doc,xa(this),wY(this),this.dom,this),this.domObserver=new w0(this,(a,b,c,d)=>(function(a,b,c,d,e){let f,g,h,i=a.input.compositionPendingChanges||(a.composing?a.input.compositionID:0);if(a.input.compositionPendingChanges=0,b<0){let b=a.input.lastSelectionTime>Date.now()-50?a.input.lastSelectionOrigin:null,c=vO(a,b);if(c&&!a.state.selection.eq(c)){if(u5&&vb&&13===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime&&a.someProp("handleKeyDown",b=>b(a,uW(13,"Enter"))))return;let d=a.state.tr.setSelection(c);"pointer"==b?d.setMeta("pointer",!0):"key"==b&&d.scrollIntoView(),i&&d.setMeta("composition",i),a.dispatch(d)}return}let j=a.state.doc.resolve(b),k=j.sharedDepth(c);b=j.before(k+1),c=a.state.doc.resolve(c).after(k+1);let l=a.state.selection,m=function(a,b,c){let d,{node:e,fromOffset:f,toOffset:g,from:h,to:i}=a.docView.parseRange(b,c),j=a.domSelectionRange(),k=j.anchorNode;if(k&&a.dom.contains(1==k.nodeType?k:k.parentNode)&&(d=[{node:k,offset:j.anchorOffset}],uV(j)||d.push({node:j.focusNode,offset:j.focusOffset})),u5&&8===a.input.lastKeyCode)for(let a=g;a>f;a--){let b=e.childNodes[a-1],c=b.pmViewDesc;if("BR"==b.nodeName&&!c){g=a;break}if(!c||c.size)break}let l=a.state.doc,m=a.someProp("domParser")||tb.fromSchema(a.state.schema),n=l.resolve(h),o=null,p=m.parse(e,{topNode:n.parent,topMatch:n.parent.contentMatchAt(n.index()),topOpen:!0,from:f,to:g,preserveWhitespace:"pre"!=n.parent.type.whitespace||"full",findPositions:d,ruleFromNode:w4,context:n});if(d&&null!=d[0].pos){let a=d[0].pos,b=d[1]&&d[1].pos;null==b&&(b=a),o={anchor:a+h,head:b+h}}return{doc:p,sel:o,from:h,to:i}}(a,b,c),n=a.state.doc,o=n.slice(m.from,m.to);8===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime?(f=a.state.selection.to,g="end"):(f=a.state.selection.from,g="start"),a.input.lastKeyCode=null;let p=function(a,b,c,d,e){let f=a.findDiffStart(b,c);if(null==f)return null;let{a:g,b:h}=a.findDiffEnd(b,c+a.size,c+b.size);if("end"==e){let a=Math.max(0,f-Math.min(g,h));d-=g+a-f}if(g<f&&a.size<b.size){let a=d<=f&&d>=g?f-d:0;(f-=a)&&f<b.size&&w8(b.textBetween(f-1,f+1))&&(f+=a?1:-1),h=f+(h-g),g=f}else if(h<f){let b=d<=f&&d>=h?f-d:0;(f-=b)&&f<a.size&&w8(a.textBetween(f-1,f+1))&&(f+=b?1:-1),g=f+(g-h),h=f}return{start:f,endA:g,endB:h}}(o.content,m.doc.content,m.from,f,g);if(p&&a.input.domChangeCount++,(u8&&a.input.lastIOSEnter>Date.now()-225||vb)&&e.some(a=>1==a.nodeType&&!w5.test(a.nodeName))&&(!p||p.endA>=p.endB)&&a.someProp("handleKeyDown",b=>b(a,uW(13,"Enter")))){a.input.lastIOSEnter=0;return}if(!p)if(d&&l instanceof t3&&!l.empty&&l.$head.sameParent(l.$anchor)&&!a.composing&&!(m.sel&&m.sel.anchor!=m.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(m.sel){let b=w6(a,a.state.doc,m.sel);if(b&&!b.eq(a.state.selection)){let c=a.state.tr.setSelection(b);i&&c.setMeta("composition",i),a.dispatch(c)}}return}a.state.selection.from<a.state.selection.to&&p.start==p.endB&&a.state.selection instanceof t3&&(p.start>a.state.selection.from&&p.start<=a.state.selection.from+2&&a.state.selection.from>=m.from?p.start=a.state.selection.from:p.endA<a.state.selection.to&&p.endA>=a.state.selection.to-2&&a.state.selection.to<=m.to&&(p.endB+=a.state.selection.to-p.endA,p.endA=a.state.selection.to)),u1&&u2<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>m.from&&"  "==m.doc.textBetween(p.start-m.from-1,p.start-m.from+1)&&(p.start--,p.endA--,p.endB--);let q=m.doc.resolveNoCache(p.start-m.from),r=m.doc.resolveNoCache(p.endB-m.from),s=n.resolve(p.start),t=q.sameParent(r)&&q.parent.inlineContent&&s.end()>=p.endA;if((u8&&a.input.lastIOSEnter>Date.now()-225&&(!t||e.some(a=>"DIV"==a.nodeName||"P"==a.nodeName))||!t&&q.pos<m.doc.content.size&&(!q.sameParent(r)||!q.parent.inlineContent)&&q.pos<r.pos&&!/\S/.test(m.doc.textBetween(q.pos,r.pos,"","")))&&a.someProp("handleKeyDown",b=>b(a,uW(13,"Enter")))){a.input.lastIOSEnter=0;return}if(a.state.selection.anchor>p.start&&function(a,b,c,d,e){if(c-b<=e.pos-d.pos||w7(d,!0,!1)<e.pos)return!1;let f=a.resolve(b);if(!d.parent.isTextblock){let a=f.nodeAfter;return null!=a&&c==b+a.nodeSize}if(f.parentOffset<f.parent.content.size||!f.parent.isTextblock)return!1;let g=a.resolve(w7(f,!0,!0));return!(!g.parent.isTextblock||g.pos>c||w7(g,!0,!1)<c)&&d.parent.content.cut(d.parentOffset).eq(g.parent.content)}(n,p.start,p.endA,q,r)&&a.someProp("handleKeyDown",b=>b(a,uW(8,"Backspace")))){vb&&u5&&a.domObserver.suppressSelectionUpdates();return}u5&&p.endB==p.start&&(a.input.lastChromeDelete=Date.now()),vb&&!t&&q.start()!=r.start()&&0==r.parentOffset&&q.depth==r.depth&&m.sel&&m.sel.anchor==m.sel.head&&m.sel.head==p.endA&&(p.endB-=2,r=m.doc.resolveNoCache(p.endB-m.from),setTimeout(()=>{a.someProp("handleKeyDown",function(b){return b(a,uW(13,"Enter"))})},20));let u=p.start,v=p.endA,w=b=>{let c=b||a.state.tr.replace(u,v,m.doc.slice(p.start-m.from,p.endB-m.from));if(m.sel){let b=w6(a,c.doc,m.sel);b&&!(u5&&a.composing&&b.empty&&(p.start!=p.endB||a.input.lastChromeDelete<Date.now()-100)&&(b.head==u||b.head==c.mapping.map(v)-1)||u1&&b.empty&&b.head==u)&&c.setSelection(b)}return i&&c.setMeta("composition",i),c.scrollIntoView()};if(t)if(q.pos==r.pos){u1&&u2<=11&&0==q.parentOffset&&(a.domObserver.suppressSelectionUpdates(),setTimeout(()=>vQ(a),20));let b=w(a.state.tr.delete(u,v)),c=n.resolve(p.start).marksAcross(n.resolve(p.endA));c&&b.ensureMarks(c),a.dispatch(b)}else if(p.endA==p.endB&&(h=function(a,b){let c=a.firstChild.marks,d=b.firstChild.marks,e=c,f=d,g,h,i;for(let a=0;a<d.length;a++)e=d[a].removeFromSet(e);for(let a=0;a<c.length;a++)f=c[a].removeFromSet(f);if(1==e.length&&0==f.length)h=e[0],g="add",i=a=>a.mark(h.addToSet(a.marks));else{if(0!=e.length||1!=f.length)return null;h=f[0],g="remove",i=a=>a.mark(h.removeFromSet(a.marks))}let j=[];for(let a=0;a<b.childCount;a++)j.push(i(b.child(a)));if(sD.from(j).eq(a))return{mark:h,type:g}}(q.parent.content.cut(q.parentOffset,r.parentOffset),s.parent.content.cut(s.parentOffset,p.endA-s.start())))){let b=w(a.state.tr);"add"==h.type?b.addMark(u,v,h.mark):b.removeMark(u,v,h.mark),a.dispatch(b)}else if(q.parent.child(q.index()).isText&&q.index()==r.index()-!r.textOffset){let b=q.parent.textBetween(q.parentOffset,r.parentOffset),c=()=>w(a.state.tr.insertText(b,u,v));a.someProp("handleTextInput",d=>d(a,u,v,b,c))||a.dispatch(c())}else a.dispatch(w());else a.dispatch(w())})(this,a,b,c,d)),this.domObserver.start(),function(a){for(let b in wk){let c=wk[b];a.dom.addEventListener(b,a.input.eventHandlers[b]=b=>{!function(a,b){if(!b.bubbles)return!0;if(b.defaultPrevented)return!1;for(let c=b.target;c!=a.dom;c=c.parentNode)if(!c||11==c.nodeType||c.pmViewDesc&&c.pmViewDesc.stopEvent(b))return!1;return!0}(a,b)||wq(a,b)||!a.editable&&b.type in wl||c(a,b)},wm[b]?{passive:!0}:void 0)}u7&&a.dom.addEventListener("input",()=>null),wp(a)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let a=this._props;for(let b in this._props={},a)this._props[b]=a[b];this._props.state=this.state}return this._props}update(a){a.handleDOMEvents!=this._props.handleDOMEvents&&wp(this);let b=this._props;this._props=a,a.plugins&&(a.plugins.forEach(xe),this.directPlugins=a.plugins),this.updateStateInner(a.state,b)}setProps(a){let b={};for(let a in this._props)b[a]=this._props[a];for(let c in b.state=this.state,a)b[c]=a[c];this.update(b)}updateState(a){this.updateStateInner(a,this._props)}updateStateInner(a,b){var c,d,e;let f=this.state,g=!1,h=!1;a.storedMarks&&this.composing&&(wz(this),h=!0),this.state=a;let i=f.plugins!=a.plugins||this._props.plugins!=b.plugins;if(i||this._props.plugins!=b.plugins||this._props.nodeViews!=b.nodeViews){let a=xd(this);(function(a,b){let c=0,d=0;for(let d in a){if(a[d]!=b[d])return!0;c++}for(let a in b)d++;return c!=d})(a,this.nodeViews)&&(this.nodeViews=a,g=!0)}(i||b.handleDOMEvents!=this._props.handleDOMEvents)&&wp(this),this.editable=xc(this),xb(this);let j=wY(this),k=xa(this),l=f.plugins==a.plugins||f.doc.eq(a.doc)?a.scrollToSelection>f.scrollToSelection?"to selection":"preserve":"reset",m=g||!this.docView.matchesNode(a.doc,k,j);(m||!a.selection.eq(f.selection))&&(h=!0);let n="preserve"==l&&h&&null==this.dom.style.overflowAnchor&&function(a){let b,c,d=a.dom.getBoundingClientRect(),e=Math.max(0,d.top);for(let f=(d.left+d.right)/2,g=e+1;g<Math.min(innerHeight,d.bottom);g+=5){let d=a.root.elementFromPoint(f,g);if(!d||d==a.dom||!a.dom.contains(d))continue;let h=d.getBoundingClientRect();if(h.top>=e-20){b=d,c=h.top;break}}return{refDOM:b,refTop:c,stack:vg(a.dom)}}(this);if(h){let b,c,h;this.domObserver.stop();let i=m&&(u1||u5)&&!this.composing&&!f.selection.empty&&!a.selection.empty&&(d=f.selection,e=a.selection,h=Math.min(d.$anchor.sharedDepth(d.head),e.$anchor.sharedDepth(e.head)),d.$anchor.start(h)!=e.$anchor.start(h));if(m){let b=u5?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=function(a){let b=a.domSelectionRange();if(!b.focusNode)return null;let c=function(a,b){for(;;){if(3==a.nodeType&&b)return a;if(1==a.nodeType&&b>0){if("false"==a.contentEditable)return null;b=uT(a=a.childNodes[b-1])}else{if(!a.parentNode||uU(a))return null;b=uL(a),a=a.parentNode}}}(b.focusNode,b.focusOffset),d=function(a,b){for(;;){if(3==a.nodeType&&b<a.nodeValue.length)return a;if(1==a.nodeType&&b<a.childNodes.length){if("false"==a.contentEditable)return null;a=a.childNodes[b],b=0}else{if(!a.parentNode||uU(a))return null;b=uL(a)+1,a=a.parentNode}}}(b.focusNode,b.focusOffset);if(c&&d&&c!=d){let b=d.pmViewDesc,e=a.domObserver.lastChangedTextNode;if(c==e||d==e)return e;if(!b||!b.isText(d.nodeValue))return d;if(a.input.compositionNode==d){let a=c.pmViewDesc;if(!(!a||!a.isText(c.nodeValue)))return d}}return c||d}(this)),(g||!this.docView.update(a.doc,k,j,this))&&(this.docView.updateOuterDeco(k),this.docView.destroy(),this.docView=vA(a.doc,k,j,this.dom,this)),!b||this.trackWrites&&this.dom.contains(this.trackWrites)||(i=!0)}i||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(b=this.docView.domFromPos(this.state.selection.anchor,0),c=this.domSelectionRange(),uQ(b.node,b.offset,c.anchorNode,c.anchorOffset)))?vQ(this,i):(vV(this,a.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(f),(null==(c=this.dragging)?void 0:c.node)&&!f.doc.eq(a.doc)&&this.updateDraggedNode(this.dragging,f),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():n&&function({refDOM:a,refTop:b,stack:c}){let d=a?a.getBoundingClientRect().top:0;vh(c,0==d?0:d-b)}(n)}scrollToSelection(){let a=this.domSelectionRange().focusNode;if(a&&this.dom.contains(1==a.nodeType?a:a.parentNode))if(this.someProp("handleScrollToSelection",a=>a(this)));else if(this.state.selection instanceof t5){let b=this.docView.domAfterPos(this.state.selection.from);1==b.nodeType&&vf(this,b.getBoundingClientRect(),a)}else vf(this,this.coordsAtPos(this.state.selection.head,1),a)}destroyPluginViews(){let a;for(;a=this.pluginViews.pop();)a.destroy&&a.destroy()}updatePluginViews(a){if(a&&a.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let b=0;b<this.pluginViews.length;b++){let c=this.pluginViews[b];c.update&&c.update(this,a)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let a=0;a<this.directPlugins.length;a++){let b=this.directPlugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}for(let a=0;a<this.state.plugins.length;a++){let b=this.state.plugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}}}updateDraggedNode(a,b){let c=a.node,d=-1;if(this.state.doc.nodeAt(c.from)==c.node)d=c.from;else{let a=c.from+(this.state.doc.content.size-b.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==c.node&&(d=a)}this.dragging=new wE(a.slice,a.move,d<0?void 0:t5.create(this.state.doc,d))}someProp(a,b){let c=this._props&&this._props[a],d;if(null!=c&&(d=b?b(c):c))return d;for(let c=0;c<this.directPlugins.length;c++){let e=this.directPlugins[c].props[a];if(null!=e&&(d=b?b(e):e))return d}let e=this.state.plugins;if(e)for(let c=0;c<e.length;c++){let f=e[c].props[a];if(null!=f&&(d=b?b(f):f))return d}}hasFocus(){if(u1){let a=this.root.activeElement;if(a==this.dom)return!0;if(!a||!this.dom.contains(a))return!1;for(;a&&this.dom!=a&&this.dom.contains(a);){if("false"==a.contentEditable)return!1;a=a.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(a){if(a.setActive)return a.setActive();if(vi)return a.focus(vi);let b=vg(a);a.focus(null==vi?{get preventScroll(){return vi={preventScroll:!0},!0}}:void 0),vi||(vi=!1,vh(b,0))}(this.dom),vQ(this),this.domObserver.start()}get root(){let a=this._root;if(null==a){for(let a=this.dom.parentNode;a;a=a.parentNode)if(9==a.nodeType||11==a.nodeType&&a.host)return a.getSelection||(Object.getPrototypeOf(a).getSelection=()=>a.ownerDocument.getSelection()),this._root=a}return a||document}updateRoot(){this._root=null}posAtCoords(a){return function(a,b){var c;let d,e,f=a.dom.ownerDocument,g,h=0,i=function(a,b,c){if(a.caretPositionFromPoint)try{let d=a.caretPositionFromPoint(b,c);if(d)return{node:d.offsetNode,offset:Math.min(uT(d.offsetNode),d.offset)}}catch(a){}if(a.caretRangeFromPoint){let d=a.caretRangeFromPoint(b,c);if(d)return{node:d.startContainer,offset:Math.min(uT(d.startContainer),d.startOffset)}}}(f,b.left,b.top);i&&({node:g,offset:h}=i);let j=(a.root.elementFromPoint?a.root:f).elementFromPoint(b.left,b.top);if(!j||!a.dom.contains(1!=j.nodeType?j.parentNode:j)){let c=a.dom.getBoundingClientRect();if(!vj(b,c)||!(j=function a(b,c,d){let e=b.childNodes.length;if(e&&d.top<d.bottom)for(let f=Math.max(0,Math.min(e-1,Math.floor(e*(c.top-d.top)/(d.bottom-d.top))-2)),g=f;;){let d=b.childNodes[g];if(1==d.nodeType){let b=d.getClientRects();for(let e=0;e<b.length;e++){let f=b[e];if(vj(c,f))return a(d,c,f)}}if((g=(g+1)%e)==f)break}return b}(a.dom,b,c)))return null}if(u7)for(let a=j;g&&a;a=uM(a))a.draggable&&(g=void 0);if(j=(d=(c=j).parentNode)&&/^li$/i.test(d.nodeName)&&b.left<c.getBoundingClientRect().left?d:c,g){let c;if(u3&&1==g.nodeType&&(h=Math.min(h,g.childNodes.length))<g.childNodes.length){let a=g.childNodes[h],c;"IMG"==a.nodeName&&(c=a.getBoundingClientRect()).right<=b.left&&c.bottom>b.top&&h++}vc&&h&&1==g.nodeType&&1==(c=g.childNodes[h-1]).nodeType&&"false"==c.contentEditable&&c.getBoundingClientRect().top>=b.top&&h--,g==a.dom&&h==g.childNodes.length-1&&1==g.lastChild.nodeType&&b.top>g.lastChild.getBoundingClientRect().bottom?e=a.state.doc.content.size:(0==h||1!=g.nodeType||"BR"!=g.childNodes[h-1].nodeName)&&(e=function(a,b,c,d){let e=-1;for(let c=b,f=!1;c!=a.dom;){let b=a.docView.nearestDesc(c,!0),g;if(!b)return null;if(1==b.dom.nodeType&&(b.node.isBlock&&b.parent||!b.contentDOM)&&((g=b.dom.getBoundingClientRect()).width||g.height)&&(b.node.isBlock&&b.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(b.dom.nodeName)&&(!f&&g.left>d.left||g.top>d.top?e=b.posBefore:(!f&&g.right<d.left||g.bottom<d.top)&&(e=b.posAfter),f=!0),!b.contentDOM&&e<0&&!b.node.isText))return(b.node.isBlock?d.top<(g.top+g.bottom)/2:d.left<(g.left+g.right)/2)?b.posBefore:b.posAfter;c=b.dom.parentNode}return e>-1?e:a.docView.posFromDOM(b,c,-1)}(a,g,h,b))}null==e&&(e=function(a,b,c){let{node:d,offset:e}=function a(b,c){let d,e,f,g=2e8,h,i=0,j=c.top,k=c.top;for(let a=b.firstChild,l=0;a;a=a.nextSibling,l++){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=uO(a).getClientRects()}for(let m=0;m<b.length;m++){let n=b[m];if(n.top<=j&&n.bottom>=k){j=Math.max(n.bottom,j),k=Math.min(n.top,k);let b=n.left>c.left?n.left-c.left:n.right<c.left?c.left-n.right:0;if(b<g){f=a,g=b,h=b&&3==f.nodeType?{left:n.right<c.left?n.right:n.left,top:c.top}:c,1==a.nodeType&&b&&(i=l+ +(c.left>=(n.left+n.right)/2));continue}}else n.top>c.top&&!d&&n.left<=c.left&&n.right>=c.left&&(d=a,e={left:Math.max(n.left,Math.min(n.right,c.left)),top:n.top});!f&&(c.left>=n.right&&c.top>=n.top||c.left>=n.left&&c.top>=n.bottom)&&(i=l+1)}}return(!f&&d&&(f=d,h=e,g=0),f&&3==f.nodeType)?function(a,b){let c=a.nodeValue.length,d=document.createRange(),e;for(let f=0;f<c;f++){d.setEnd(a,f+1),d.setStart(a,f);let c=vl(d,1);if(c.top!=c.bottom&&vj(b,c)){e={node:a,offset:f+ +(b.left>=(c.left+c.right)/2)};break}}return d.detach(),e||{node:a,offset:0}}(f,h):!f||g&&1==f.nodeType?{node:b,offset:i}:a(f,h)}(b,c),f=-1;if(1==d.nodeType&&!d.firstChild){let a=d.getBoundingClientRect();f=a.left!=a.right&&c.left>(a.left+a.right)/2?1:-1}return a.docView.posFromDOM(d,e,f)}(a,j,b));let k=a.docView.nearestDesc(j,!0);return{pos:e,inside:k?k.posAtStart-k.border:-1}}(this,a)}coordsAtPos(a,b=1){return vn(this,a,b)}domAtPos(a,b=0){return this.docView.domFromPos(a,b)}nodeDOM(a){let b=this.docView.descAt(a);return b?b.nodeDOM:null}posAtDOM(a,b,c=-1){let d=this.docView.posFromDOM(a,b,c);if(null==d)throw RangeError("DOM position not inside the editor");return d}endOfTextblock(a,b){return function(a,b,c){let d,e;return vs==b&&vt==c?vu:(vs=b,vt=c,vu="up"==c||"down"==c?(d=b.selection,e="up"==c?d.$from:d.$to,vq(a,b,()=>{let{node:b}=a.docView.domFromPos(e.pos,"up"==c?-1:1);for(;;){let c=a.docView.nearestDesc(b,!0);if(!c)break;if(c.node.isBlock){b=c.contentDOM||c.dom;break}b=c.dom.parentNode}let d=vn(a,e.pos,1);for(let a=b.firstChild;a;a=a.nextSibling){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=uO(a,0,a.nodeValue.length).getClientRects()}for(let a=0;a<b.length;a++){let e=b[a];if(e.bottom>e.top+1&&("up"==c?d.top-e.top>(e.bottom-d.top)*2:e.bottom-d.bottom>(d.bottom-e.top)*2))return!1}}return!0})):function(a,b,c){let{$head:d}=b.selection;if(!d.parent.isTextblock)return!1;let e=d.parentOffset,f=e==d.parent.content.size,g=a.domSelection();return g?vr.test(d.parent.textContent)&&g.modify?vq(a,b,()=>{let{focusNode:b,focusOffset:e,anchorNode:f,anchorOffset:h}=a.domSelectionRange(),i=g.caretBidiLevel;g.modify("move",c,"character");let j=d.depth?a.docView.domAfterPos(d.before()):a.dom,{focusNode:k,focusOffset:l}=a.domSelectionRange(),m=k&&!j.contains(1==k.nodeType?k:k.parentNode)||b==k&&e==l;try{g.collapse(f,h),b&&(b!=f||e!=h)&&g.extend&&g.extend(b,e)}catch(a){}return null!=i&&(g.caretBidiLevel=i),m}):"left"==c||"backward"==c?!e:f:d.pos==d.start()||d.pos==d.end()}(a,b,c))}(this,b||this.state,a)}pasteHTML(a,b){return wC(this,"",a,!1,b||new ClipboardEvent("paste"))}pasteText(a,b){return wC(this,a,null,!0,b||new ClipboardEvent("paste"))}serializeForClipboard(a){return wa(this,a)}destroy(){if(this.docView){for(let a in this.domObserver.stop(),this.input.eventHandlers)this.dom.removeEventListener(a,this.input.eventHandlers[a]);clearTimeout(this.input.composingTimeout),clearTimeout(this.input.lastIOSEnterFallbackTimeout),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],wY(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,uP()}}get isDestroyed(){return null==this.docView}dispatchEvent(a){!wq(this,a)&&wk[a.type]&&(this.editable||!(a.type in wl))&&wk[a.type](this,a)}domSelectionRange(){let a=this.domSelection();return a?u7&&11===this.root.nodeType&&function(a){let b=a.activeElement;for(;b&&b.shadowRoot;)b=b.shadowRoot.activeElement;return b}(this.dom.ownerDocument)==this.dom&&function(a,b){let c;if(b.getComposedRanges){let c=b.getComposedRanges(a.root)[0];if(c)return w3(a,c)}function d(a){a.preventDefault(),a.stopImmediatePropagation(),c=a.getTargetRanges()[0]}return a.dom.addEventListener("beforeinput",d,!0),document.execCommand("indent"),a.dom.removeEventListener("beforeinput",d,!0),c?w3(a,c):null}(this,a)||a:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function xa(a){let b=Object.create(null);return b.class="ProseMirror",b.contenteditable=String(a.editable),a.someProp("attributes",c=>{if("function"==typeof c&&(c=c(a.state)),c)for(let a in c)"class"==a?b.class+=" "+c[a]:"style"==a?b.style=(b.style?b.style+";":"")+c[a]:b[a]||"contenteditable"==a||"nodeName"==a||(b[a]=String(c[a]))}),b.translate||(b.translate="no"),[wL.node(0,a.state.doc.content.size,b)]}function xb(a){if(a.markCursor){let b=document.createElement("img");b.className="ProseMirror-separator",b.setAttribute("mark-placeholder","true"),b.setAttribute("alt",""),a.cursorWrapper={dom:b,deco:wL.widget(a.state.selection.from,b,{raw:!0,marks:a.markCursor})}}else a.cursorWrapper=null}function xc(a){return!a.someProp("editable",b=>!1===b(a.state))}function xd(a){let b=Object.create(null);function c(a){for(let c in a)Object.prototype.hasOwnProperty.call(b,c)||(b[c]=a[c])}return a.someProp("nodeViews",c),a.someProp("markViews",c),b}function xe(a){if(a.spec.state||a.spec.filterTransaction||a.spec.appendTransaction)throw RangeError("Plugins passed directly to the view must not have a state component")}w9.prototype.dispatch=function(a){let b=this._props.dispatchTransaction;b?b.call(this,a):this.updateState(this.state.apply(a))};for(var xf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},xg={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},xh="u">typeof navigator&&/Mac/.test(navigator.platform),xi="u">typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),xj=0;xj<10;xj++)xf[48+xj]=xf[96+xj]=String(xj);for(var xj=1;xj<=24;xj++)xf[xj+111]="F"+xj;for(var xj=65;xj<=90;xj++)xf[xj]=String.fromCharCode(xj+32),xg[xj]=String.fromCharCode(xj);for(var xk in xf)xg.hasOwnProperty(xk)||(xg[xk]=xf[xk]);let xl="u">typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),xm="u">typeof navigator&&/Win/.test(navigator.platform);function xn(a,b,c=!0){return b.altKey&&(a="Alt-"+a),b.ctrlKey&&(a="Ctrl-"+a),b.metaKey&&(a="Meta-"+a),c&&b.shiftKey&&(a="Shift-"+a),a}function xo(a){let b=function(a){let b=Object.create(null);for(let c in a)b[function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"==g&&(g=" ");for(let a=0;a<f.length-1;a++){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))xl?e=!0:c=!0;else throw Error("Unrecognized modifier name: "+g)}return b&&(g="Alt-"+g),c&&(g="Ctrl-"+g),e&&(g="Meta-"+g),d&&(g="Shift-"+g),g}(c)]=a[c];return b}(a);return function(a,c){var d;let e=("Esc"==(d=!(xh&&c.metaKey&&c.shiftKey&&!c.ctrlKey&&!c.altKey||xi&&c.shiftKey&&c.key&&1==c.key.length||"Unidentified"==c.key)&&c.key||(c.shiftKey?xg:xf)[c.keyCode]||c.key||"Unidentified")&&(d="Escape"),"Del"==d&&(d="Delete"),"Left"==d&&(d="ArrowLeft"),"Up"==d&&(d="ArrowUp"),"Right"==d&&(d="ArrowRight"),"Down"==d&&(d="ArrowDown"),d),f,g=b[xn(e,c)];if(g&&g(a.state,a.dispatch,a))return!0;if(1==e.length&&" "!=e){if(c.shiftKey){let d=b[xn(e,c,!1)];if(d&&d(a.state,a.dispatch,a))return!0}if((c.altKey||c.metaKey||c.ctrlKey)&&!(xm&&c.ctrlKey&&c.altKey)&&(f=xf[c.keyCode])&&f!=e){let d=b[xn(f,c)];if(d&&d(a.state,a.dispatch,a))return!0}}return!1}}var xp=Object.defineProperty,xq=(a,b)=>{for(var c in b)xp(a,c,{get:b[c],enumerable:!0})};function xr(a){let{state:b,transaction:c}=a,{selection:d}=c,{doc:e}=c,{storedMarks:f}=c;return{...b,apply:b.apply.bind(b),applyTransaction:b.applyTransaction.bind(b),plugins:b.plugins,schema:b.schema,reconfigure:b.reconfigure.bind(b),toJSON:b.toJSON.bind(b),get storedMarks(){return f},get selection(){return d},get doc(){return e},get tr(){return d=c.selection,e=c.doc,f=c.storedMarks,c}}}var xs=class{constructor(a){this.editor=a.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=a.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:a,editor:b,state:c}=this,{view:d}=b,{tr:e}=c,f=this.buildProps(e);return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,(...a)=>{let c=b(...a)(f);return e.getMeta("preventDispatch")||this.hasCustomState||d.dispatch(e),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g=[],h=!!a,i=a||e.tr,j=()=>(h||!b||i.getMeta("preventDispatch")||this.hasCustomState||f.dispatch(i),g.every(a=>!0===a)),k={...Object.fromEntries(Object.entries(c).map(([a,c])=>[a,(...a)=>{let d=this.buildProps(i,b),e=c(...a)(d);return g.push(e),k}])),run:j};return k}createCan(a){let{rawCommands:b,state:c}=this,d=a||c.tr,e=this.buildProps(d,!1);return{...Object.fromEntries(Object.entries(b).map(([a,b])=>[a,(...a)=>b(...a)({...e,dispatch:void 0})])),chain:()=>this.createChain(d,!1)}}buildProps(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g={tr:a,editor:d,view:f,state:xr({state:e,transaction:a}),dispatch:b?()=>void 0:void 0,chain:()=>this.createChain(a,b),can:()=>this.createCan(a),get commands(){return Object.fromEntries(Object.entries(c).map(([a,b])=>[a,(...a)=>b(...a)(g)]))}};return g}},xt={};xq(xt,{blur:()=>xu,clearContent:()=>xv,clearNodes:()=>xw,command:()=>xx,createParagraphNear:()=>xy,cut:()=>xz,deleteCurrentNode:()=>xA,deleteNode:()=>xC,deleteRange:()=>xD,deleteSelection:()=>xE,enter:()=>xF,exitCode:()=>xG,extendMarkRange:()=>xN,first:()=>xO,focus:()=>xU,forEach:()=>xV,insertContent:()=>xW,insertContentAt:()=>xZ,joinBackward:()=>x0,joinDown:()=>x_,joinForward:()=>x1,joinItemBackward:()=>x2,joinItemForward:()=>x3,joinTextblockBackward:()=>x4,joinTextblockForward:()=>x5,joinUp:()=>x$,keyboardShortcut:()=>x7,lift:()=>x9,liftEmptyBlock:()=>ya,liftListItem:()=>yb,newlineInCode:()=>yc,resetAttributes:()=>yf,scrollIntoView:()=>yg,selectAll:()=>yh,selectNodeBackward:()=>yi,selectNodeForward:()=>yj,selectParentNode:()=>yk,selectTextblockEnd:()=>yl,selectTextblockStart:()=>ym,setContent:()=>yo,setMark:()=>yX,setMeta:()=>yY,setNode:()=>yZ,setNodeSelection:()=>y$,setTextDirection:()=>y_,setTextSelection:()=>y0,sinkListItem:()=>y1,splitBlock:()=>y3,splitListItem:()=>y4,toggleList:()=>y7,toggleMark:()=>y8,toggleNode:()=>y9,toggleWrap:()=>za,undoInputRule:()=>zb,unsetAllMarks:()=>zc,unsetMark:()=>zd,unsetTextDirection:()=>ze,updateAttributes:()=>zf,wrapIn:()=>zg,wrapInList:()=>zh});var xu=()=>({editor:a,view:b})=>(requestAnimationFrame(()=>{var c;a.isDestroyed||(b.dom.blur(),null==(c=null==window?void 0:window.getSelection())||c.removeAllRanges())}),!0),xv=(a=!0)=>({commands:b})=>b.setContent("",{emitUpdate:a}),xw=()=>({state:a,tr:b,dispatch:c})=>{let{selection:d}=b,{ranges:e}=d;return!c||(e.forEach(({$from:c,$to:d})=>{a.doc.nodesBetween(c.pos,d.pos,(a,c)=>{if(a.type.isText)return;let{doc:d,mapping:e}=b,f=d.resolve(e.map(c)),g=d.resolve(e.map(c+a.nodeSize)),h=f.blockRange(g);if(!h)return;let i=tE(h);if(a.type.isTextblock){let{defaultType:a}=f.parent.contentMatchAt(f.index());b.setNodeMarkup(h.start,a)}(i||0===i)&&b.lift(h,i)})}),!0)},xx=a=>b=>a(b),xy=()=>({state:a,dispatch:b})=>uz(a,b),xz=(a,b)=>({editor:c,tr:d})=>{let{state:e}=c,f=e.doc.slice(a.from,a.to);d.deleteRange(a.from,a.to);let g=d.mapping.map(b);return d.insert(g,f.content),d.setSelection(new t3(d.doc.resolve(Math.max(g-1,0)))),!0},xA=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,d=c.$anchor.node();if(d.content.size>0)return!1;let e=a.selection.$anchor;for(let c=e.depth;c>0;c-=1)if(e.node(c).type===d.type){if(b){let b=e.before(c),d=e.after(c);a.delete(b,d).scrollIntoView()}return!0}return!1};function xB(a,b){if("string"==typeof a){if(!b.nodes[a])throw Error(`There is no node type named '${a}'. Maybe you forgot to add the extension?`);return b.nodes[a]}return a}var xC=a=>({tr:b,state:c,dispatch:d})=>{let e=xB(a,c.schema),f=b.selection.$anchor;for(let a=f.depth;a>0;a-=1)if(f.node(a).type===e){if(d){let c=f.before(a),d=f.after(a);b.delete(c,d).scrollIntoView()}return!0}return!1},xD=a=>({tr:b,dispatch:c})=>{let{from:d,to:e}=a;return c&&b.delete(d,e),!0},xE=()=>({state:a,dispatch:b})=>ul(a,b),xF=()=>({commands:a})=>a.keyboardShortcut("Enter"),xG=()=>({state:a,dispatch:b})=>uy(a,b);function xH(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function xI(a,b,c={strict:!0}){let d=Object.keys(b);return!d.length||d.every(d=>c.strict?b[d]===a[d]:xH(b[d])?b[d].test(a[d]):b[d]===a[d])}function xJ(a,b,c={}){return a.find(a=>a.type===b&&xI(Object.fromEntries(Object.keys(c).map(b=>[b,a.attrs[b]])),c))}function xK(a,b,c={}){return!!xJ(a,b,c)}function xL(a,b,c){var d;if(!a||!b)return;let e=a.parent.childAfter(a.parentOffset);if(e.node&&e.node.marks.some(a=>a.type===b)||(e=a.parent.childBefore(a.parentOffset)),!e.node||!e.node.marks.some(a=>a.type===b)||(c=c||(null==(d=e.node.marks[0])?void 0:d.attrs),!xJ([...e.node.marks],b,c)))return;let f=e.index,g=a.start()+e.offset,h=f+1,i=g+e.node.nodeSize;for(;f>0&&xK([...a.parent.child(f-1).marks],b,c);)f-=1,g-=a.parent.child(f).nodeSize;for(;h<a.parent.childCount&&xK([...a.parent.child(h).marks],b,c);)i+=a.parent.child(h).nodeSize,h+=1;return{from:g,to:i}}function xM(a,b){if("string"==typeof a){if(!b.marks[a])throw Error(`There is no mark type named '${a}'. Maybe you forgot to add the extension?`);return b.marks[a]}return a}var xN=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=xM(a,d.schema),{doc:g,selection:h}=c,{$from:i,from:j,to:k}=h;if(e){let a=xL(i,f,b);if(a&&a.from<=j&&a.to>=k){let b=t3.create(g,a.from,a.to);c.setSelection(b)}}return!0},xO=a=>b=>{let c="function"==typeof a?a(b):a;for(let a=0;a<c.length;a+=1)if(c[a](b))return!0;return!1};function xP(a){return a instanceof t3}function xQ(a=0,b=0,c=0){return Math.min(Math.max(a,b),c)}function xR(a,b=null){if(!b)return null;let c=t_.atStart(a),d=t_.atEnd(a);if("start"===b||!0===b)return c;if("end"===b)return d;let e=c.from,f=d.to;return"all"===b?t3.create(a,xQ(0,e,f),xQ(a.content.size,e,f)):t3.create(a,xQ(b,e,f),xQ(b,e,f))}function xS(){return"Android"===navigator.platform||/android/i.test(navigator.userAgent)}function xT(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var xU=(a=null,b={})=>({editor:c,view:d,tr:e,dispatch:f})=>{b={scrollIntoView:!0,...b};let g=()=>{(xT()||xS())&&d.dom.focus(),"u">typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&!xT()&&!xS()&&d.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{!c.isDestroyed&&(d.focus(),(null==b?void 0:b.scrollIntoView)&&c.commands.scrollIntoView())})};try{if(d.hasFocus()&&null===a||!1===a)return!0}catch{return!1}if(f&&null===a&&!xP(c.state.selection))return g(),!0;let h=xR(e.doc,a)||c.state.selection,i=c.state.selection.eq(h);return f&&(i||e.setSelection(h),i&&e.storedMarks&&e.setStoredMarks(e.storedMarks),g()),!0},xV=(a,b)=>c=>a.every((a,d)=>b(a,{...c,index:d})),xW=(a,b)=>({tr:c,commands:d})=>d.insertContentAt({from:c.selection.from,to:c.selection.to},a,b);function xX(a){throw Error("[tiptap error]: there is no window object available, so this function cannot be used")}function xY(a,b,c){if(a instanceof sW||a instanceof sD)return a;c={slice:!0,parseOptions:{},...c};let d="object"==typeof a&&null!==a,e="string"==typeof a;if(d)try{if(Array.isArray(a)&&a.length>0)return sD.fromArray(a.map(a=>b.nodeFromJSON(a)));let d=b.nodeFromJSON(a);return c.errorOnInvalidContent&&d.check(),d}catch(d){if(c.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",a,"Error:",d),xY("",b,c)}if(e){if(c.errorOnInvalidContent){let d=!1,e="",f=new s9({topNode:b.spec.topNode,marks:b.spec.marks,nodes:b.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:a=>(d=!0,e="string"==typeof a?a:a.outerHTML,null)}]}})});if(c.slice?tb.fromSchema(f).parseSlice(xX(a),c.parseOptions):tb.fromSchema(f).parse(xX(a),c.parseOptions),c.errorOnInvalidContent&&d)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${e}`)})}let d=tb.fromSchema(b);return c.slice?d.parseSlice(xX(a),c.parseOptions).content:d.parse(xX(a),c.parseOptions)}return xY("",b,c)}var xZ=(a,b,c)=>({tr:d,dispatch:e,editor:f})=>{var g;if(e){let e,h;c={parseOptions:f.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...c};let i=a=>{f.emit("contentError",{editor:f,error:a,disableCollaboration:()=>{"collaboration"in f.storage&&"object"==typeof f.storage.collaboration&&f.storage.collaboration&&(f.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...c.parseOptions};if(!c.errorOnInvalidContent&&!f.options.enableContentCheck&&f.options.emitContentError)try{xY(b,f.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(a){i(a)}try{e=xY(b,f.schema,{parseOptions:j,errorOnInvalidContent:null!=(g=c.errorOnInvalidContent)?g:f.options.enableContentCheck})}catch(a){return i(a),!1}let{from:k,to:l}="number"==typeof a?{from:a,to:a}:{from:a.from,to:a.to},m=!0,n=!0;if((!("type"in e)?e:[e]).forEach(a=>{a.check(),m=!!m&&a.isText&&0===a.marks.length,n=!!n&&a.isBlock}),k===l&&n){let{parent:a}=d.doc.resolve(k);!a.isTextblock||a.type.spec.code||a.childCount||(k-=1,l+=1)}if(m){if(Array.isArray(b))h=b.map(a=>a.text||"").join("");else if(b instanceof sD){let a="";b.forEach(b=>{b.text&&(a+=b.text)}),h=a}else h="object"==typeof b&&b&&b.text?b.text:b;d.insertText(h,k,l)}else{h=e;let a=d.doc.resolve(k),b=a.node(),c=0===a.parentOffset,f=b.isText||b.isTextblock,g=b.content.size>0;c&&f&&g&&(k=Math.max(0,k-1)),d.replaceWith(k,l,h)}c.updateSelection&&function(a,b,c){let d=a.steps.length-1;if(d<b)return;let e=a.steps[d];if(!(e instanceof tA||e instanceof tB))return;let f=a.mapping.maps[d],g=0;f.forEach((a,b,c,d)=>{0===g&&(g=d)}),a.setSelection(t_.near(a.doc.resolve(g),-1))}(d,d.steps.length-1,0),c.applyInputRules&&d.setMeta("applyInputRules",{from:k,text:h}),c.applyPasteRules&&d.setMeta("applyPasteRules",{from:k,text:h})}return!0},x$=()=>({state:a,dispatch:b})=>((a,b)=>{let c=a.selection,d=c instanceof t5,e;if(d){if(c.node.isTextblock||!tK(a.doc,c.from))return!1;e=c.from}else if(null==(e=tM(a.doc,c.from,-1)))return!1;if(b){let c=a.tr.join(e);d&&c.setSelection(t5.create(c.doc,e-a.doc.resolve(e).nodeBefore.nodeSize)),b(c.scrollIntoView())}return!0})(a,b),x_=()=>({state:a,dispatch:b})=>((a,b)=>{let c=a.selection,d;if(c instanceof t5){if(c.node.isTextblock||!tK(a.doc,c.to))return!1;d=c.to}else if(null==(d=tM(a.doc,c.to,1)))return!1;return b&&b(a.tr.join(d).scrollIntoView()),!0})(a,b),x0=()=>({state:a,dispatch:b})=>un(a,b),x1=()=>({state:a,dispatch:b})=>ut(a,b),x2=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tM(a.doc,a.selection.$from.pos,-1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},x3=()=>({state:a,dispatch:b,tr:c})=>{try{let d=tM(a.doc,a.selection.$from.pos,1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},x4=()=>({state:a,dispatch:b})=>((a,b,c)=>{let d=um(a,c);if(!d)return!1;let e=ur(d);return!!e&&uo(a,e,b)})(a,b),x5=()=>({state:a,dispatch:b})=>((a,b,c)=>{let d=us(a,c);if(!d)return!1;let e=uv(d);return!!e&&uo(a,e,b)})(a,b);function x6(){return"u">typeof navigator&&/Mac/.test(navigator.platform)}var x7=a=>({editor:b,view:c,tr:d,dispatch:e})=>{let f=(function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"===g&&(g=" ");for(let a=0;a<f.length-1;a+=1){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))xT()||x6()?e=!0:c=!0;else throw Error(`Unrecognized modifier name: ${g}`)}return b&&(g=`Alt-${g}`),c&&(g=`Ctrl-${g}`),e&&(g=`Meta-${g}`),d&&(g=`Shift-${g}`),g})(a).split(/-(?!$)/),g=f.find(a=>!["Alt","Ctrl","Meta","Shift"].includes(a)),h=new KeyboardEvent("keydown",{key:"Space"===g?" ":g,altKey:f.includes("Alt"),ctrlKey:f.includes("Ctrl"),metaKey:f.includes("Meta"),shiftKey:f.includes("Shift"),bubbles:!0,cancelable:!0}),i=b.captureTransaction(()=>{c.someProp("handleKeyDown",a=>a(c,h))});return null==i||i.steps.forEach(a=>{let b=a.map(d.mapping);b&&e&&d.maybeStep(b)}),!0};function x8(a,b,c={}){let{from:d,to:e,empty:f}=a.selection,g=b?xB(b,a.schema):null,h=[];a.doc.nodesBetween(d,e,(a,b)=>{if(a.isText)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);h.push({node:a,from:c,to:f})});let i=e-d,j=h.filter(a=>!g||g.name===a.node.type.name).filter(a=>xI(a.node.attrs,c,{strict:!1}));return f?!!j.length:j.reduce((a,b)=>a+b.to-b.from,0)>=i}var x9=(a,b={})=>({state:c,dispatch:d})=>{let e=xB(a,c.schema);return!!x8(c,e,b)&&((a,b)=>{let{$from:c,$to:d}=a.selection,e=c.blockRange(d),f=e&&tE(e);return null!=f&&(b&&b(a.tr.lift(e,f).scrollIntoView()),!0)})(c,d)},ya=()=>({state:a,dispatch:b})=>uA(a,b),yb=a=>({state:b,dispatch:c})=>{var d;return(d=xB(a,b.schema),function(a,b){let{$from:c,$to:e}=a.selection,f=c.blockRange(e,a=>a.childCount>0&&a.firstChild.type==d);return!!f&&(!b||(c.node(f.depth-1).type==d?function(a,b,c,d){let e=a.tr,f=d.end,g=d.$to.end(d.depth);f<g&&(e.step(new tB(f-1,g,f,g,new sJ(sD.from(c.create(null,d.parent.copy())),1,0),1,!0)),d=new sU(e.doc.resolve(d.$from.pos),e.doc.resolve(g),d.depth));let h=tE(d);if(null==h)return!1;e.lift(d,h);let i=e.doc.resolve(e.mapping.map(f,-1)-1);return tK(e.doc,i.pos)&&i.nodeBefore.type==i.nodeAfter.type&&e.join(i.pos),b(e.scrollIntoView()),!0}(a,b,d,f):function(a,b,c){let d=a.tr,e=c.parent;for(let a=c.end,b=c.endIndex-1,f=c.startIndex;b>f;b--)a-=e.child(b).nodeSize,d.delete(a-1,a+1);let f=d.doc.resolve(c.start),g=f.nodeAfter;if(d.mapping.map(c.end)!=c.start+f.nodeAfter.nodeSize)return!1;let h=0==c.startIndex,i=c.endIndex==e.childCount,j=f.node(-1),k=f.index(-1);if(!j.canReplace(k+ +!h,k+1,g.content.append(i?sD.empty:sD.from(e))))return!1;let l=f.pos,m=l+g.nodeSize;return d.step(new tB(l-!!h,m+ +!!i,l+1,m-1,new sJ((h?sD.empty:sD.from(e.copy(sD.empty))).append(i?sD.empty:sD.from(e.copy(sD.empty))),+!h,+!i),+!h)),b(d.scrollIntoView()),!0}(a,b,f)))})(b,c)},yc=()=>({state:a,dispatch:b})=>uw(a,b);function yd(a,b){return b.nodes[a]?"node":b.marks[a]?"mark":null}function ye(a,b){let c="string"==typeof b?[b]:b;return Object.keys(a).reduce((b,d)=>(c.includes(d)||(b[d]=a[d]),b),{})}var yf=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=yd("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=xB(a,d.schema)),"mark"===h&&(g=xM(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{d.doc.nodesBetween(a.$from.pos,a.$to.pos,(a,d)=>{f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,ye(a.attrs,b))),g&&a.marks.length&&a.marks.forEach(f=>{g===f.type&&(i=!0,e&&c.addMark(d,d+a.nodeSize,g.create(ye(f.attrs,b))))})})}),i},yg=()=>({tr:a,dispatch:b})=>(b&&a.scrollIntoView(),!0),yh=()=>({tr:a,dispatch:b})=>{if(b){let b=new t7(a.doc);a.setSelection(b)}return!0},yi=()=>({state:a,dispatch:b})=>uq(a,b),yj=()=>({state:a,dispatch:b})=>uu(a,b),yk=()=>({state:a,dispatch:b})=>((a,b)=>{let{$from:c,to:d}=a.selection,e,f=c.sharedDepth(d);return 0!=f&&(e=c.before(f),b&&b(a.tr.setSelection(t5.create(a.doc,e))),!0)})(a,b),yl=()=>({state:a,dispatch:b})=>uE(a,b),ym=()=>({state:a,dispatch:b})=>uD(a,b);function yn(a,b,c={},d={}){return xY(a,b,{slice:!1,parseOptions:c,errorOnInvalidContent:d.errorOnInvalidContent})}var yo=(a,{errorOnInvalidContent:b,emitUpdate:c=!0,parseOptions:d={}}={})=>({editor:e,tr:f,dispatch:g,commands:h})=>{let{doc:i}=f;if("full"!==d.preserveWhitespace){let h=yn(a,e.schema,d,{errorOnInvalidContent:null!=b?b:e.options.enableContentCheck});return g&&f.replaceWith(0,i.content.size,h).setMeta("preventUpdate",!c),!0}return g&&f.setMeta("preventUpdate",!c),h.insertContentAt({from:0,to:i.content.size},a,{parseOptions:d,errorOnInvalidContent:null!=b?b:e.options.enableContentCheck})};function yp(a,b){let c=xM(b,a.schema),{from:d,to:e,empty:f}=a.selection,g=[];f?(a.storedMarks&&g.push(...a.storedMarks),g.push(...a.selection.$head.marks())):a.doc.nodesBetween(d,e,a=>{g.push(...a.marks)});let h=g.find(a=>a.type.name===c.name);return h?{...h.attrs}:{}}function yq(a,b){let c=new tZ(a);return b.forEach(a=>{a.steps.forEach(a=>{c.step(a)})}),c}function yr(a){return b=>(function(a,b){for(let c=a.depth;c>0;c-=1){let d=a.node(c);if(b(d))return{pos:c>0?a.before(c):0,start:a.start(c),depth:c,node:d}}})(b.$from,a)}function ys(a,b,c){return void 0===a.config[b]&&a.parent?ys(a.parent,b,c):"function"==typeof a.config[b]?a.config[b].bind({...c,parent:a.parent?ys(a.parent,b,c):null}):a.config[b]}function yt(a){return a.map(a=>{let b={name:a.name,options:a.options,storage:a.storage},c=ys(a,"addExtensions",b);return c?[a,...yt(c())]:a}).flat(10)}function yu(a,b){let c=tk.fromSchema(b).serializeFragment(a),d=document.implementation.createHTMLDocument().createElement("div");return d.appendChild(c),d.innerHTML}function yv(a){return"function"==typeof a}function yw(a,b,...c){return yv(a)?b?a.bind(b)(...c):a(...c):a}function yx(a){let b=a.filter(a=>"extension"===a.type);return{baseExtensions:b,nodeExtensions:a.filter(a=>"node"===a.type),markExtensions:a.filter(a=>"mark"===a.type)}}function yy(a){let b=[],{nodeExtensions:c,markExtensions:d}=yx(a),e=[...c,...d],f={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1},g=c.filter(a=>"text"!==a.name).map(a=>a.name),h=d.map(a=>a.name),i=[...g,...h];return a.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage,extensions:e},d=ys(a,"addGlobalAttributes",c);d&&d().forEach(a=>{(Array.isArray(a.types)?a.types:"*"===a.types?i:"nodes"===a.types?g:"marks"===a.types?h:[]).forEach(c=>{Object.entries(a.attributes).forEach(([a,d])=>{b.push({type:c,name:a,attribute:{...f,...d}})})})})}),e.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage},d=ys(a,"addAttributes",c);d&&Object.entries(d()).forEach(([c,d])=>{let e={...f,...d};"function"==typeof(null==e?void 0:e.default)&&(e.default=e.default()),(null==e?void 0:e.isRequired)&&(null==e?void 0:e.default)===void 0&&delete e.default,b.push({type:a.name,name:c,attribute:e})})}),b}function yz(...a){return a.filter(a=>!!a).reduce((a,b)=>{let c={...a};return Object.entries(b).forEach(([a,b])=>{if(!c[a]){c[a]=b;return}if("class"===a){let d=b?String(b).split(" "):[],e=c[a]?c[a].split(" "):[],f=d.filter(a=>!e.includes(a));c[a]=[...e,...f].join(" ")}else if("style"===a){let d=b?b.split(";").map(a=>a.trim()).filter(Boolean):[],e=c[a]?c[a].split(";").map(a=>a.trim()).filter(Boolean):[],f=new Map;e.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),d.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),c[a]=Array.from(f.entries()).map(([a,b])=>`${a}: ${b}`).join("; ")}else c[a]=b}),c},{})}function yA(a,b){return b.filter(b=>b.type===a.type.name).filter(a=>a.attribute.rendered).map(b=>b.attribute.renderHTML?b.attribute.renderHTML(a.attrs)||{}:{[b.name]:a.attrs[b.name]}).reduce((a,b)=>yz(a,b),{})}function yB(a,b){return"style"in a?a:{...a,getAttrs:c=>{let d=a.getAttrs?a.getAttrs(c):a.attrs;if(!1===d)return!1;let e=b.reduce((a,b)=>{var d;let e=b.attribute.parseHTML?b.attribute.parseHTML(c):"string"!=typeof(d=c.getAttribute(b.name))?d:d.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(d):"true"===d||"false"!==d&&d;return null==e?a:{...a,[b.name]:e}},{});return{...d,...e}}}}function yC(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>!("attrs"===a&&function(a={}){return 0===Object.keys(a).length&&a.constructor===Object}(b))&&null!=b))}function yD(a){var b,c;let d={};return!(null==(b=null==a?void 0:a.attribute)?void 0:b.isRequired)&&"default"in((null==a?void 0:a.attribute)||{})&&(d.default=a.attribute.default),(null==(c=null==a?void 0:a.attribute)?void 0:c.validate)!==void 0&&(d.validate=a.attribute.validate),[a.name,d]}function yE(a,b){var c;let d=yy(a),{nodeExtensions:e,markExtensions:f}=yx(a),g=null==(c=e.find(a=>ys(a,"topNode")))?void 0:c.name;return new s9({topNode:g,nodes:Object.fromEntries(e.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=yC({...a.reduce((a,b)=>{let d=ys(b,"extendNodeSchema",f);return{...a,...d?d(c):{}}},{}),content:yw(ys(c,"content",f)),marks:yw(ys(c,"marks",f)),group:yw(ys(c,"group",f)),inline:yw(ys(c,"inline",f)),atom:yw(ys(c,"atom",f)),selectable:yw(ys(c,"selectable",f)),draggable:yw(ys(c,"draggable",f)),code:yw(ys(c,"code",f)),whitespace:yw(ys(c,"whitespace",f)),linebreakReplacement:yw(ys(c,"linebreakReplacement",f)),defining:yw(ys(c,"defining",f)),isolating:yw(ys(c,"isolating",f)),attrs:Object.fromEntries(e.map(yD))}),h=yw(ys(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>yB(a,e)));let i=ys(c,"renderHTML",f);i&&(g.toDOM=a=>i({node:a,HTMLAttributes:yA(a,e)}));let j=ys(c,"renderText",f);return j&&(g.toText=j),[c.name,g]})),marks:Object.fromEntries(f.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=yC({...a.reduce((a,b)=>{let d=ys(b,"extendMarkSchema",f);return{...a,...d?d(c):{}}},{}),inclusive:yw(ys(c,"inclusive",f)),excludes:yw(ys(c,"excludes",f)),group:yw(ys(c,"group",f)),spanning:yw(ys(c,"spanning",f)),code:yw(ys(c,"code",f)),attrs:Object.fromEntries(e.map(yD))}),h=yw(ys(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>yB(a,e)));let i=ys(c,"renderHTML",f);return i&&(g.toDOM=a=>i({mark:a,HTMLAttributes:yA(a,e)})),[c.name,g]}))})}function yF(a){return a.sort((a,b)=>{let c=ys(a,"priority")||100,d=ys(b,"priority")||100;return c>d?-1:+(c<d)})}function yG(a){var b;let c=yF(yt(a)),d=Array.from(new Set((b=c.map(a=>a.name)).filter((a,c)=>b.indexOf(a)!==c)));return d.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${d.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),c}function yH(a,b,c){let{from:d,to:e}=b,{blockSeparator:f="\n\n",textSerializers:g={}}=c||{},h="";return a.nodesBetween(d,e,(a,c,i,j)=>{var k;a.isBlock&&c>d&&(h+=f);let l=null==g?void 0:g[a.type.name];if(l)return i&&(h+=l({node:a,pos:c,parent:i,index:j,range:b})),!1;a.isText&&(h+=null==(k=null==a?void 0:a.text)?void 0:k.slice(Math.max(d,c)-c,e-c))}),h}function yI(a,b){let c={from:0,to:a.content.size};return yH(a,c,b)}function yJ(a){return Object.fromEntries(Object.entries(a.nodes).filter(([,a])=>a.spec.toText).map(([a,b])=>[a,b.spec.toText]))}function yK(a,b){let c=yd("string"==typeof b?b:b.name,a.schema);return"node"===c?function(a,b){let c=xB(b,a.schema),{from:d,to:e}=a.selection,f=[];a.doc.nodesBetween(d,e,a=>{f.push(a)});let g=f.reverse().find(a=>a.type.name===c.name);return g?{...g.attrs}:{}}(a,b):"mark"===c?yp(a,b):{}}function yL(a){let b,{mapping:c,steps:d}=a,e=[];return c.maps.forEach((a,b)=>{let f=[];if(a.ranges.length)a.forEach((a,b)=>{f.push({from:a,to:b})});else{let{from:a,to:c}=d[b];if(void 0===a||void 0===c)return;f.push({from:a,to:c})}f.forEach(({from:a,to:d})=>{let f=c.slice(b).map(a,-1),g=c.slice(b).map(d),h=c.invert().map(f,-1),i=c.invert().map(g);e.push({oldRange:{from:h,to:i},newRange:{from:f,to:g}})})}),1===(b=function(a,b=JSON.stringify){let c={};return a.filter(a=>{let d=b(a);return!Object.prototype.hasOwnProperty.call(c,d)&&(c[d]=!0)})}(e)).length?b:b.filter((a,c)=>!b.filter((a,b)=>b!==c).some(b=>a.oldRange.from>=b.oldRange.from&&a.oldRange.to<=b.oldRange.to&&a.newRange.from>=b.newRange.from&&a.newRange.to<=b.newRange.to))}function yM(a,b,c){let d=[];return a===b?c.resolve(a).marks().forEach(b=>{let e=xL(c.resolve(a),b.type);e&&d.push({mark:b,...e})}):c.nodesBetween(a,b,(a,b)=>{a&&(null==a?void 0:a.nodeSize)!==void 0&&d.push(...a.marks.map(c=>({from:b,to:b+a.nodeSize,mark:c})))}),d}function yN(a,b){return b.nodes[a]||b.marks[a]||null}function yO(a,b,c){return Object.fromEntries(Object.entries(c).filter(([c])=>{let d=a.find(a=>a.type===b&&a.name===c);return!!d&&d.attribute.keepOnSplit}))}function yP(a,b,c={}){let{empty:d,ranges:e}=a.selection,f=b?xM(b,a.schema):null;if(d)return!!(a.storedMarks||a.selection.$from.marks()).filter(a=>!f||f.name===a.type.name).find(a=>xI(a.attrs,c,{strict:!1}));let g=0,h=[];if(e.forEach(({$from:b,$to:c})=>{let d=b.pos,e=c.pos;a.doc.nodesBetween(d,e,(a,b)=>{if(f&&a.inlineContent&&!a.type.allowsMarkType(f))return!1;if(!a.isText&&!a.marks.length)return;let c=Math.max(d,b),i=Math.min(e,b+a.nodeSize);g+=i-c,h.push(...a.marks.map(a=>({mark:a,from:c,to:i})))})}),0===g)return!1;let i=h.filter(a=>!f||f.name===a.mark.type.name).filter(a=>xI(a.mark.attrs,c,{strict:!1})).reduce((a,b)=>a+b.to-b.from,0),j=h.filter(a=>!f||a.mark.type!==f&&a.mark.type.excludes(f)).reduce((a,b)=>a+b.to-b.from,0);return(i>0?i+j:i)>=g}function yQ(a,b){return Array.isArray(b)?b.some(b=>("string"==typeof b?b:b.name)===a.name):b}function yR(a,b){let{nodeExtensions:c}=yx(b),d=c.find(b=>b.name===a);if(!d)return!1;let e={name:d.name,options:d.options,storage:d.storage},f=yw(ys(d,"group",e));return"string"==typeof f&&f.split(" ").includes("list")}function yS(a,{checkChildren:b=!0,ignoreWhitespace:c=!1}={}){var d;if(c){if("hardBreak"===a.type.name)return!0;if(a.isText)return/^\s*$/m.test(null!=(d=a.text)?d:"")}if(a.isText)return!a.text;if(a.isAtom||a.isLeaf)return!1;if(0===a.content.childCount)return!0;if(b){let d=!0;return a.content.forEach(a=>{!1!==d&&(yS(a,{ignoreWhitespace:c,checkChildren:b})||(d=!1))}),d}return!1}function yT(a){return a instanceof t5}var yU=class a{constructor(a){this.position=a}static fromJSON(b){return new a(b.position)}toJSON(){return{position:this.position}}};function yV(a,b){let c=b.mapping.mapResult(a.position);return{position:new yU(c.pos),mapResult:c}}function yW(a){return new yU(a)}var yX=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let{selection:f}=c,{empty:g,ranges:h}=f,i=xM(a,d.schema);if(e)if(g){let a=yp(d,i);c.addStoredMark(i.create({...a,...b}))}else h.forEach(a=>{let e=a.$from.pos,f=a.$to.pos;d.doc.nodesBetween(e,f,(a,d)=>{let g=Math.max(d,e),h=Math.min(d+a.nodeSize,f);a.marks.find(a=>a.type===i)?a.marks.forEach(a=>{i===a.type&&c.addMark(g,h,i.create({...a.attrs,...b}))}):c.addMark(g,h,i.create(b))})});return function(a,b,c){var d;let{selection:e}=b,f=null;if(xP(e)&&(f=e.$cursor),f){let b=null!=(d=a.storedMarks)?d:f.marks();return f.parent.type.allowsMarkType(c)&&(!!c.isInSet(b)||!b.some(a=>a.type.excludes(c)))}let{ranges:g}=e;return g.some(({$from:b,$to:d})=>{let e=0===b.depth&&a.doc.inlineContent&&a.doc.type.allowsMarkType(c);return a.doc.nodesBetween(b.pos,d.pos,(a,b,d)=>{if(e)return!1;if(a.isInline){let b=!d||d.type.allowsMarkType(c),f=!!c.isInSet(a.marks)||!a.marks.some(a=>a.type.excludes(c));e=b&&f}return!e}),e})}(d,c,i)},yY=(a,b)=>({tr:c})=>(c.setMeta(a,b),!0),yZ=(a,b={})=>({state:c,dispatch:d,chain:e})=>{let f,g=xB(a,c.schema);return(c.selection.$anchor.sameParent(c.selection.$head)&&(f=c.selection.$anchor.parent.attrs),g.isTextblock)?e().command(({commands:a})=>!!uF(g,{...f,...b})(c)||a.clearNodes()).command(({state:a})=>uF(g,{...f,...b})(a,d)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},y$=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,d=xQ(a,0,c.content.size),e=t5.create(c,d);b.setSelection(e)}return!0},y_=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f,g,{selection:h}=d;return"number"==typeof b?(f=b,g=b):b&&"from"in b&&"to"in b?(f=b.from,g=b.to):(f=h.from,g=h.to),e&&c.doc.nodesBetween(f,g,(b,d)=>{b.isText||c.setNodeMarkup(d,void 0,{...b.attrs,dir:a})}),!0},y0=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,{from:d,to:e}="number"==typeof a?{from:a,to:a}:a,f=t3.atStart(c).from,g=t3.atEnd(c).to,h=xQ(d,f,g),i=xQ(e,f,g),j=t3.create(c,h,i);b.setSelection(j)}return!0},y1=a=>({state:b,dispatch:c})=>{var d;return(d=xB(a,b.schema),function(a,b){let{$from:c,$to:e}=a.selection,f=c.blockRange(e,a=>a.childCount>0&&a.firstChild.type==d);if(!f)return!1;let g=f.startIndex;if(0==g)return!1;let h=f.parent,i=h.child(g-1);if(i.type!=d)return!1;if(b){let c=i.lastChild&&i.lastChild.type==h.type,e=sD.from(c?d.create():null),g=new sJ(sD.from(d.create(null,sD.from(h.type.create(null,e)))),c?3:1,0),j=f.start,k=f.end;b(a.tr.step(new tB(j-(c?3:1),k,j,k,g,1,!0)).scrollIntoView())}return!0})(b,c)};function y2(a,b){let c=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();if(c){let d=c.filter(a=>null==b?void 0:b.includes(a.type.name));a.tr.ensureMarks(d)}}var y3=({keepMarks:a=!0}={})=>({tr:b,state:c,dispatch:d,editor:e})=>{let{selection:f,doc:g}=b,{$from:h,$to:i}=f,j=yO(e.extensionManager.attributes,h.node().type.name,h.node().attrs);if(f instanceof t5&&f.node.isBlock)return!!h.parentOffset&&!!tJ(g,h.pos)&&(d&&(a&&y2(c,e.extensionManager.splittableMarks),b.split(h.pos).scrollIntoView()),!0);if(!h.parent.isBlock)return!1;let k=i.parentOffset===i.parent.content.size,l=0===h.depth?void 0:function(a){for(let b=0;b<a.edgeCount;b+=1){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}(h.node(-1).contentMatchAt(h.indexAfter(-1))),m=k&&l?[{type:l,attrs:j}]:void 0,n=tJ(b.doc,b.mapping.map(h.pos),1,m);if(!m&&!n&&tJ(b.doc,b.mapping.map(h.pos),1,l?[{type:l}]:void 0)&&(n=!0,m=l?[{type:l,attrs:j}]:void 0),d){if(n&&(f instanceof t3&&b.deleteSelection(),b.split(b.mapping.map(h.pos),1,m),l&&!k&&!h.parentOffset&&h.parent.type!==l)){let a=b.mapping.map(h.before()),c=b.doc.resolve(a);h.node(-1).canReplaceWith(c.index(),c.index()+1,l)&&b.setNodeMarkup(b.mapping.map(h.before()),l)}a&&y2(c,e.extensionManager.splittableMarks),b.scrollIntoView()}return n},y4=(a,b={})=>({tr:c,state:d,dispatch:e,editor:f})=>{var g;let h=xB(a,d.schema),{$from:i,$to:j}=d.selection,k=d.selection.node;if(k&&k.isBlock||i.depth<2||!i.sameParent(j))return!1;let l=i.node(-1);if(l.type!==h)return!1;let m=f.extensionManager.attributes;if(0===i.parent.content.size&&i.node(-1).childCount===i.indexAfter(-1)){if(2===i.depth||i.node(-3).type!==h||i.index(-2)!==i.node(-2).childCount-1)return!1;if(e){let a=sD.empty,d=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-d;b>=i.depth-3;b-=1)a=sD.from(i.node(b).copy(a));let e=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3,f={...yO(m,i.node().type.name,i.node().attrs),...b},j=(null==(g=h.contentMatch.defaultType)?void 0:g.createAndFill(f))||void 0;a=a.append(sD.from(h.createAndFill(null,j)||void 0));let k=i.before(i.depth-(d-1));c.replace(k,i.after(-e),new sJ(a,4-d,0));let l=-1;c.doc.nodesBetween(k,c.doc.content.size,(a,b)=>{if(l>-1)return!1;a.isTextblock&&0===a.content.size&&(l=b+1)}),l>-1&&c.setSelection(t3.near(c.doc.resolve(l))),c.scrollIntoView()}return!0}let n=j.pos===i.end()?l.contentMatchAt(0).defaultType:null,o={...yO(m,l.type.name,l.attrs),...b},p={...yO(m,i.node().type.name,i.node().attrs),...b};c.delete(i.pos,j.pos);let q=n?[{type:h,attrs:o},{type:n,attrs:p}]:[{type:h,attrs:o}];if(!tJ(c.doc,i.pos,2))return!1;if(e){let{selection:a,storedMarks:b}=d,{splittableMarks:g}=f.extensionManager,h=b||a.$to.parentOffset&&a.$from.marks();if(c.split(i.pos,2,q).scrollIntoView(),!h||!e)return!0;let j=h.filter(a=>g.includes(a.type.name));c.ensureMarks(j)}return!0},y5=(a,b)=>{let c=yr(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(Math.max(0,c.pos-1)).before(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tK(a.doc,c.pos))||(a.join(c.pos),!0)},y6=(a,b)=>{let c=yr(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(c.start).after(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&tK(a.doc,d))||(a.join(d),!0)},y7=(a,b,c,d={})=>({editor:e,tr:f,state:g,dispatch:h,chain:i,commands:j,can:k})=>{let{extensions:l,splittableMarks:m}=e.extensionManager,n=xB(a,g.schema),o=xB(b,g.schema),{selection:p,storedMarks:q}=g,{$from:r,$to:s}=p,t=r.blockRange(s),u=q||p.$to.parentOffset&&p.$from.marks();if(!t)return!1;let v=yr(a=>yR(a.type.name,l))(p);if(t.depth>=1&&v&&t.depth-v.depth<=1){if(v.node.type===n)return j.liftListItem(o);if(yR(v.node.type.name,l)&&n.validContent(v.node.content)&&h)return i().command(()=>(f.setNodeMarkup(v.pos,n),!0)).command(()=>y5(f,n)).command(()=>y6(f,n)).run()}return c&&u&&h?i().command(()=>{let a=k().wrapInList(n,d),b=u.filter(a=>m.includes(a.type.name));return f.ensureMarks(b),!!a||j.clearNodes()}).wrapInList(n,d).command(()=>y5(f,n)).command(()=>y6(f,n)).run():i().command(()=>!!k().wrapInList(n,d)||j.clearNodes()).wrapInList(n,d).command(()=>y5(f,n)).command(()=>y6(f,n)).run()},y8=(a,b={},c={})=>({state:d,commands:e})=>{let{extendEmptyMarkRange:f=!1}=c,g=xM(a,d.schema);return yP(d,g,b)?e.unsetMark(g,{extendEmptyMarkRange:f}):e.setMark(g,b)},y9=(a,b,c={})=>({state:d,commands:e})=>{let f,g=xB(a,d.schema),h=xB(b,d.schema),i=x8(d,g,c);return(d.selection.$anchor.sameParent(d.selection.$head)&&(f=d.selection.$anchor.parent.attrs),i)?e.setNode(h,f):e.setNode(g,{...f,...c})},za=(a,b={})=>({state:c,commands:d})=>{let e=xB(a,c.schema);return x8(c,e,b)?d.lift(e):d.wrapIn(e,b)},zb=()=>({state:a,dispatch:b})=>{let c=a.plugins;for(let d=0;d<c.length;d+=1){let e,f=c[d];if(f.spec.isInputRules&&(e=f.getState(a))){if(b){let b=a.tr,c=e.transform;for(let a=c.steps.length-1;a>=0;a-=1)b.step(c.steps[a].invert(c.docs[a]));if(e.text){let c=b.doc.resolve(e.from).marks();b.replaceWith(e.from,e.to,a.schema.text(e.text,c))}else b.delete(e.from,e.to)}return!0}}return!1},zc=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,{empty:d,ranges:e}=c;return!!d||(b&&e.forEach(b=>{a.removeMark(b.$from.pos,b.$to.pos)}),!0)},zd=(a,b={})=>({tr:c,state:d,dispatch:e})=>{var f;let{extendEmptyMarkRange:g=!1}=b,{selection:h}=c,i=xM(a,d.schema),{$from:j,empty:k,ranges:l}=h;if(!e)return!0;if(k&&g){let{from:a,to:b}=h,d=null==(f=j.marks().find(a=>a.type===i))?void 0:f.attrs,e=xL(j,i,d);e&&(a=e.from,b=e.to),c.removeMark(a,b,i)}else l.forEach(a=>{c.removeMark(a.$from.pos,a.$to.pos,i)});return c.removeStoredMark(i),!0},ze=a=>({tr:b,state:c,dispatch:d})=>{let e,f,{selection:g}=c;return"number"==typeof a?(e=a,f=a):a&&"from"in a&&"to"in a?(e=a.from,f=a.to):(e=g.from,f=g.to),d&&b.doc.nodesBetween(e,f,(a,c)=>{if(a.isText)return;let d={...a.attrs};delete d.dir,b.setNodeMarkup(c,void 0,d)}),!0},zf=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=yd("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=xB(a,d.schema)),"mark"===h&&(g=xM(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{let h,j,k,l,m=a.$from.pos,n=a.$to.pos;c.selection.empty?d.doc.nodesBetween(m,n,(a,b)=>{f&&f===a.type&&(i=!0,k=Math.max(b,m),l=Math.min(b+a.nodeSize,n),h=b,j=a)}):d.doc.nodesBetween(m,n,(a,d)=>{d<m&&f&&f===a.type&&(i=!0,k=Math.max(d,m),l=Math.min(d+a.nodeSize,n),h=d,j=a),d>=m&&d<=n&&(f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,{...a.attrs,...b})),g&&a.marks.length&&a.marks.forEach(f=>{if(g===f.type&&(i=!0,e)){let e=Math.max(d,m),h=Math.min(d+a.nodeSize,n);c.addMark(e,h,g.create({...f.attrs,...b}))}}))}),j&&(void 0!==h&&e&&c.setNodeMarkup(h,void 0,{...j.attrs,...b}),g&&j.marks.length&&j.marks.forEach(a=>{g===a.type&&e&&c.addMark(k,l,g.create({...a.attrs,...b}))}))}),i},zg=(a,b={})=>({state:c,dispatch:d})=>(function(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f),h=g&&tF(g,a,b);return!!h&&(d&&d(c.tr.wrap(g,h).scrollIntoView()),!0)}})(xB(a,c.schema),b)(c,d),zh=(a,b={})=>({state:c,dispatch:d})=>(function(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f);if(!g)return!1;let h=d?c.tr:null;return!!function(a,b,c,d=null){let e=!1,f=b,g=b.$from.doc;if(b.depth>=2&&b.$from.node(b.depth-1).type.compatibleContent(c)&&0==b.startIndex){if(0==b.$from.index(b.depth-1))return!1;let a=g.resolve(b.start-2);f=new sU(a,a,b.depth),b.endIndex<b.parent.childCount&&(b=new sU(b.$from,g.resolve(b.$to.end(b.depth)),b.depth)),e=!0}let h=tF(f,c,d,b);return!!h&&(a&&function(a,b,c,d,e){let f=sD.empty;for(let a=c.length-1;a>=0;a--)f=sD.from(c[a].type.create(c[a].attrs,f));a.step(new tB(b.start-2*!!d,b.end,b.start,b.end,new sJ(f,0,0),c.length,!0));let g=0;for(let a=0;a<c.length;a++)c[a].type==e&&(g=a+1);let h=c.length-g,i=b.start+c.length-2*!!d,j=b.parent;for(let c=b.startIndex,d=b.endIndex,e=!0;c<d;c++,e=!1)!e&&tJ(a.doc,i,h)&&(a.split(i,h),i+=2*h),i+=j.child(c).nodeSize}(a,b,h,e,c),!0)}(h,g,a,b)&&(d&&d(h.scrollIntoView()),!0)}})(xB(a,c.schema),b)(c,d),zi=class{constructor(){this.callbacks={}}on(a,b){return this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}emit(a,...b){let c=this.callbacks[a];return c&&c.forEach(a=>a.apply(this,b)),this}off(a,b){let c=this.callbacks[a];return c&&(b?this.callbacks[a]=c.filter(a=>a!==b):delete this.callbacks[a]),this}once(a,b){let c=(...d)=>{this.off(a,c),b.apply(this,d)};return this.on(a,c)}removeAllListeners(){this.callbacks={}}},zj=class{constructor(a){var b;this.find=a.find,this.handler=a.handler,this.undoable=null==(b=a.undoable)||b}};function zk(a){var b;let{editor:c,from:d,to:e,text:f,rules:g,plugin:h}=a,{view:i}=c;if(i.composing)return!1;let j=i.state.doc.resolve(d);if(j.parent.type.spec.code||(null==(b=j.nodeBefore||j.nodeAfter)?void 0:b.marks.find(a=>a.type.spec.code)))return!1;let k=!1,l=((a,b=500)=>{let c="",d=a.parentOffset;return a.parent.nodesBetween(Math.max(0,d-b),d,(a,b,e,f)=>{var g,h;let i=(null==(h=(g=a.type.spec).toText)?void 0:h.call(g,{node:a,pos:b,parent:e,index:f}))||a.textContent||"%leaf%";c+=a.isAtom&&!a.isText?i:i.slice(0,Math.max(0,d-b))}),c})(j)+f;return g.forEach(a=>{if(k)return;let b=((a,b)=>{if(xH(b))return b.exec(a);let c=b(a);if(!c)return null;let d=[c.text];return d.index=c.index,d.input=a,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),d.push(c.replaceWith)),d})(l,a.find);if(!b)return;let g=i.state.tr,j=xr({state:i.state,transaction:g}),m={from:d-(b[0].length-f.length),to:e},{commands:n,chain:o,can:p}=new xs({editor:c,state:j});null!==a.handler({state:j,range:m,match:b,commands:n,chain:o,can:p})&&g.steps.length&&(a.undoable&&g.setMeta(h,{transform:g,from:d,to:e,text:f}),i.dispatch(g),k=!0)}),k}function zl(a){return"Object"===Object.prototype.toString.call(a).slice(8,-1)&&a.constructor===Object&&Object.getPrototypeOf(a)===Object.prototype}var zm=class{constructor(a={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...a},this.name=this.config.name}get options(){return{...yw(ys(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...yw(ys(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(a={}){let b=this.extend({...this.config,addOptions:()=>(function a(b,c){let d={...b};return zl(b)&&zl(c)&&Object.keys(c).forEach(e=>{zl(c[e])&&zl(b[e])?d[e]=a(b[e],c[e]):d[e]=c[e]}),d})(this.options,a)});return b.name=this.name,b.parent=this.parent,b}extend(a={}){let b=new this.constructor({...this.config,...a});return b.parent=this,this.child=b,b.name="name"in a?a.name:b.parent.name,b}},zn=class a extends zm{constructor(){super(...arguments),this.type="mark"}static create(b={}){return new a("function"==typeof b?b():b)}static handleExit({editor:a,mark:b}){let{tr:c}=a.state,d=a.state.selection.$from;if(d.pos===d.end()){let e=d.marks();if(!e.find(a=>(null==a?void 0:a.type.name)===b.name))return!1;let f=e.find(a=>(null==a?void 0:a.type.name)===b.name);return f&&c.removeStoredMark(f),c.insertText(" ",d.pos),a.view.dispatch(c),!0}return!1}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},zo=class{constructor(a){this.find=a.find,this.handler=a.handler}},zp=null,zq=class{constructor(a,b){this.splittableMarks=[],this.editor=b,this.baseExtensions=a,this.extensions=yG(a),this.schema=yE(this.extensions,b),this.setupExtensions()}get commands(){return this.extensions.reduce((a,b)=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:this.editor,type:yN(b.name,this.schema)},d=ys(b,"addCommands",c);return d?{...a,...d()}:a},{})}get plugins(){let{editor:a}=this;return yF([...this.extensions].reverse()).flatMap(b=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:yN(b.name,this.schema)},d=[],e=ys(b,"addKeyboardShortcuts",c),f={};if("mark"===b.type&&ys(b,"exitable",c)&&(f.ArrowRight=()=>zn.handleExit({editor:a,mark:b})),e){let b=Object.fromEntries(Object.entries(e()).map(([b,c])=>[b,()=>c({editor:a})]));f={...f,...b}}let g=new uh({props:{handleKeyDown:xo(f)}});d.push(g);let h=ys(b,"addInputRules",c);if(yQ(b,a.options.enableInputRules)&&h){let b=h();if(b&&b.length){let c=function(a){let{editor:b,rules:c}=a,d=new uh({state:{init:()=>null,apply(a,e,f){let g=a.getMeta(d);if(g)return g;let h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:a}=h;"string"==typeof a||(a=yu(sD.from(a),f.schema));let{from:e}=h,g=e+a.length;zk({editor:b,from:e,to:g,text:a,rules:c,plugin:d})}),a.selectionSet||a.docChanged?null:e}},props:{handleTextInput:(a,e,f,g)=>zk({editor:b,from:e,to:f,text:g,rules:c,plugin:d}),handleDOMEvents:{compositionend:a=>(setTimeout(()=>{let{$cursor:e}=a.state.selection;e&&zk({editor:b,from:e.pos,to:e.pos,text:"",rules:c,plugin:d})}),!1)},handleKeyDown(a,e){if("Enter"!==e.key)return!1;let{$cursor:f}=a.state.selection;return!!f&&zk({editor:b,from:f.pos,to:f.pos,text:"\n",rules:c,plugin:d})}},isInputRules:!0});return d}({editor:a,rules:b}),e=Array.isArray(c)?c:[c];d.push(...e)}}let i=ys(b,"addPasteRules",c);if(yQ(b,a.options.enablePasteRules)&&i){let b=i();if(b&&b.length){let c=function(a){let b,{editor:c,rules:d}=a,e=null,f=!1,g=!1,h="u">typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{b="u">typeof DragEvent?new DragEvent("drop"):null}catch{b=null}let i=({state:a,from:d,to:e,rule:f,pasteEvt:g})=>{let i=a.tr;if(function(a){let{editor:b,state:c,from:d,to:e,rule:f,pasteEvent:g,dropEvent:h}=a,{commands:i,chain:j,can:k}=new xs({editor:b,state:c}),l=[];return c.doc.nodesBetween(d,e,(a,b)=>{var m,n,o,p,q;if((null==(n=null==(m=a.type)?void 0:m.spec)?void 0:n.code)||!(a.isText||a.isTextblock||a.isInline))return;let r=null!=(q=null!=(p=null==(o=a.content)?void 0:o.size)?p:a.nodeSize)?q:0,s=Math.max(d,b),t=Math.min(e,b+r);s>=t||((a,b,c)=>{if(xH(b))return[...a.matchAll(b)];let d=b(a,c);return d?d.map(b=>{let c=[b.text];return c.index=b.index,c.input=a,c.data=b.data,b.replaceWith&&(b.text.includes(b.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),c.push(b.replaceWith)),c}):[]})(a.isText?a.text||"":a.textBetween(s-b,t-b,void 0,"￼"),f.find,g).forEach(a=>{if(void 0===a.index)return;let b=s+a.index+1,d=b+a[0].length,e={from:c.tr.mapping.map(b),to:c.tr.mapping.map(d)},m=f.handler({state:c,range:e,match:a,commands:i,chain:j,can:k,pasteEvent:g,dropEvent:h});l.push(m)})}),l.every(a=>null!==a)}({editor:c,state:xr({state:a,transaction:i}),from:Math.max(d-1,0),to:e.b-1,rule:f,pasteEvent:g,dropEvent:b})&&i.steps.length){try{b="u">typeof DragEvent?new DragEvent("drop"):null}catch{b=null}return h="u">typeof ClipboardEvent?new ClipboardEvent("paste"):null,i}};return d.map(a=>new uh({view(a){let b=b=>{var d;(e=(null==(d=a.dom.parentElement)?void 0:d.contains(b.target))?a.dom.parentElement:null)&&(zp=c)},d=()=>{zp&&(zp=null)};return window.addEventListener("dragstart",b),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",b),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(a,c)=>{if(g=e===a.dom.parentElement,b=c,!g){let a=zp;(null==a?void 0:a.isEditable)&&setTimeout(()=>{let b=a.state.selection;b&&a.commands.deleteRange({from:b.from,to:b.to})},10)}return!1},paste:(a,b)=>{var c;let d=null==(c=b.clipboardData)?void 0:c.getData("text/html");return h=b,f=!!(null==d?void 0:d.includes("data-pm-slice")),!1}}},appendTransaction:(b,c,d)=>{let e=b[0],j="paste"===e.getMeta("uiEvent")&&!f,k="drop"===e.getMeta("uiEvent")&&!g,l=e.getMeta("applyPasteRules"),m=!!l;if(!j&&!k&&!m)return;if(m){var n,o;let b,{text:c}=l;"string"==typeof c||(c=yu(sD.from(c),d.schema));let{from:e}=l,f=e+c.length;return i({rule:a,state:d,from:e,to:{b:f},pasteEvt:(n=c,null==(o=(b=new ClipboardEvent("paste",{clipboardData:new DataTransfer})).clipboardData)||o.setData("text/html",n),b)})}let p=c.doc.content.findDiffStart(d.doc.content),q=c.doc.content.findDiffEnd(d.doc.content);if("number"==typeof p&&q&&p!==q.b)return i({rule:a,state:d,from:p,to:q,pasteEvt:h})}}))}({editor:a,rules:b});d.push(...c)}}let j=ys(b,"addProseMirrorPlugins",c);if(j){let a=j();d.push(...a)}return d})}get attributes(){return yy(this.extensions)}get nodeViews(){let{editor:a}=this,{nodeExtensions:b}=yx(this.extensions);return Object.fromEntries(b.filter(a=>!!ys(a,"addNodeView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:xB(b.name,this.schema)},e=ys(b,"addNodeView",d);if(!e)return[];let f=e();return f?[b.name,(d,e,g,h,i)=>{let j=yA(d,c);return f({node:d,view:e,getPos:g,decorations:h,innerDecorations:i,editor:a,extension:b,HTMLAttributes:j})}]:[]}))}dispatchTransaction(a){let{editor:b}=this;return yF([...this.extensions].reverse()).reduceRight((a,c)=>{let d={name:c.name,options:c.options,storage:this.editor.extensionStorage[c.name],editor:b,type:yN(c.name,this.schema)},e=ys(c,"dispatchTransaction",d);return e?b=>{e.call(d,{transaction:b,next:a})}:a},a)}transformPastedHTML(a){let{editor:b}=this;return yF([...this.extensions]).reduce((a,c)=>{let d={name:c.name,options:c.options,storage:this.editor.extensionStorage[c.name],editor:b,type:yN(c.name,this.schema)},e=ys(c,"transformPastedHTML",d);return e?(b,c)=>{let f=a(b,c);return e.call(d,f)}:a},a||(a=>a))}get markViews(){let{editor:a}=this,{markExtensions:b}=yx(this.extensions);return Object.fromEntries(b.filter(a=>!!ys(a,"addMarkView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:xM(b.name,this.schema)},e=ys(b,"addMarkView",d);return e?[b.name,(d,f,g)=>{let h=yA(d,c);return e()({mark:d,view:f,inline:g,editor:a,extension:b,HTMLAttributes:h,updateAttributes:b=>{!function(a,b,c={}){let{state:d}=b,{doc:e,tr:f}=d;e.descendants((b,d)=>{let e=f.mapping.map(d),g=f.mapping.map(d)+b.nodeSize,h=null;if(b.marks.forEach(b=>{if(b!==a)return!1;h=b}),!h)return;let i=!1;if(Object.keys(c).forEach(a=>{c[a]!==h.attrs[a]&&(i=!0)}),i){let b=a.type.create({...a.attrs,...c});f.removeMark(e,g,a.type),f.addMark(e,g,b)}}),f.docChanged&&b.view.dispatch(f)}(d,a,b)}})}]:[]}))}setupExtensions(){let a=this.extensions;this.editor.extensionStorage=Object.fromEntries(a.map(a=>[a.name,a.storage])),a.forEach(a=>{var b;let c={name:a.name,options:a.options,storage:this.editor.extensionStorage[a.name],editor:this.editor,type:yN(a.name,this.schema)};"mark"===a.type&&(null==(b=yw(ys(a,"keepOnSplit",c)))||b)&&this.splittableMarks.push(a.name);let d=ys(a,"onBeforeCreate",c),e=ys(a,"onCreate",c),f=ys(a,"onUpdate",c),g=ys(a,"onSelectionUpdate",c),h=ys(a,"onTransaction",c),i=ys(a,"onFocus",c),j=ys(a,"onBlur",c),k=ys(a,"onDestroy",c);d&&this.editor.on("beforeCreate",d),e&&this.editor.on("create",e),f&&this.editor.on("update",f),g&&this.editor.on("selectionUpdate",g),h&&this.editor.on("transaction",h),i&&this.editor.on("focus",i),j&&this.editor.on("blur",j),k&&this.editor.on("destroy",k)})}};zq.resolve=yG,zq.sort=yF,zq.flatten=yt;var zr={};xq(zr,{ClipboardTextSerializer:()=>zt,Commands:()=>zu,Delete:()=>zv,Drop:()=>zw,Editable:()=>zx,FocusEvents:()=>zz,Keymap:()=>zA,Paste:()=>zB,Tabindex:()=>zC,TextDirection:()=>zD,focusEventsPluginKey:()=>zy});var zs=class a extends zm{constructor(){super(...arguments),this.type="extension"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},zt=zs.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new uh({key:new uk("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:a}=this,{state:b,schema:c}=a,{doc:d,selection:e}=b,{ranges:f}=e,g=Math.min(...f.map(a=>a.$from.pos)),h=Math.max(...f.map(a=>a.$to.pos)),i=yJ(c);return yH(d,{from:g,to:h},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:i})}}})]}}),zu=zs.create({name:"commands",addCommands:()=>({...xt})}),zv=zs.create({name:"delete",onUpdate({transaction:a,appendedTransactions:b}){var c,d,e;let f=()=>{var c,d,e,f;if(null!=(f=null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.filterTransaction)?void 0:e.call(d,a))?f:a.getMeta("y-sync$"))return;let g=yq(a.before,[a,...b]);yL(g).forEach(b=>{g.mapping.mapResult(b.oldRange.from).deletedAfter&&g.mapping.mapResult(b.oldRange.to).deletedBefore&&g.before.nodesBetween(b.oldRange.from,b.oldRange.to,(c,d)=>{let e=d+c.nodeSize-2,f=b.oldRange.from<=d&&e<=b.oldRange.to;this.editor.emit("delete",{type:"node",node:c,from:d,to:e,newFrom:g.mapping.map(d),newTo:g.mapping.map(e),deletedRange:b.oldRange,newRange:b.newRange,partial:!f,editor:this.editor,transaction:a,combinedTransform:g})})});let h=g.mapping;g.steps.forEach((b,c)=>{var d,e;if(b instanceof tx){let f=h.slice(c).map(b.from,-1),i=h.slice(c).map(b.to),j=h.invert().map(f,-1),k=h.invert().map(i),l=null==(d=g.doc.nodeAt(f-1))?void 0:d.marks.some(a=>a.eq(b.mark)),m=null==(e=g.doc.nodeAt(i))?void 0:e.marks.some(a=>a.eq(b.mark));this.editor.emit("delete",{type:"mark",mark:b.mark,from:b.from,to:b.to,deletedRange:{from:j,to:k},newRange:{from:f,to:i},partial:!!(m||l),editor:this.editor,transaction:a,combinedTransform:g})}})};null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.async)||e?setTimeout(f,0):f()}}),zw=zs.create({name:"drop",addProseMirrorPlugins(){return[new uh({key:new uk("tiptapDrop"),props:{handleDrop:(a,b,c,d)=>{this.editor.emit("drop",{editor:this.editor,event:b,slice:c,moved:d})}}})]}}),zx=zs.create({name:"editable",addProseMirrorPlugins(){return[new uh({key:new uk("editable"),props:{editable:()=>this.editor.options.editable}})]}}),zy=new uk("focusEvents"),zz=zs.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:a}=this;return[new uh({key:zy,props:{handleDOMEvents:{focus:(b,c)=>{a.isFocused=!0;let d=a.state.tr.setMeta("focus",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1},blur:(b,c)=>{a.isFocused=!1;let d=a.state.tr.setMeta("blur",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1}}}})]}}),zA=zs.create({name:"keymap",addKeyboardShortcuts(){let a=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:b})=>{let{selection:c,doc:d}=b,{empty:e,$anchor:f}=c,{pos:g,parent:h}=f,i=f.parent.isTextblock&&g>0?b.doc.resolve(g-1):f,j=i.parent.type.spec.isolating,k=f.pos-f.parentOffset,l=j&&1===i.parent.childCount?k===f.pos:t_.atStart(d).from===g;return!!e&&!!h.type.isTextblock&&!h.textContent.length&&!!l&&(!l||"paragraph"!==f.parent.type.name)&&a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),b=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:a,"Mod-Backspace":a,"Shift-Backspace":a,Delete:b,"Mod-Delete":b,"Mod-a":()=>this.editor.commands.selectAll()},d={...c},e={...c,"Ctrl-h":a,"Alt-Backspace":a,"Ctrl-d":b,"Ctrl-Alt-Backspace":b,"Alt-Delete":b,"Alt-d":b,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return xT()||x6()?e:d},addProseMirrorPlugins(){return[new uh({key:new uk("clearDocument"),appendTransaction:(a,b,c)=>{if(a.some(a=>a.getMeta("composition")))return;let d=a.some(a=>a.docChanged)&&!b.doc.eq(c.doc),e=a.some(a=>a.getMeta("preventClearDocument"));if(!d||e)return;let{empty:f,from:g,to:h}=b.selection,i=t_.atStart(b.doc).from,j=t_.atEnd(b.doc).to;if(f||g!==i||h!==j||!yS(c.doc))return;let k=c.tr,l=xr({state:c,transaction:k}),{commands:m}=new xs({editor:this.editor,state:l});if(m.clearNodes(),k.steps.length)return k}})]}}),zB=zs.create({name:"paste",addProseMirrorPlugins(){return[new uh({key:new uk("tiptapPaste"),props:{handlePaste:(a,b,c)=>{this.editor.emit("paste",{editor:this.editor,event:b,slice:c})}}})]}}),zC=zs.create({name:"tabindex",addProseMirrorPlugins(){return[new uh({key:new uk("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),zD=zs.create({name:"textDirection",addOptions:()=>({direction:void 0}),addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:a}=yx(this.extensions);return[{types:a.filter(a=>"text"!==a.name).map(a=>a.name),attributes:{dir:{default:this.options.direction,parseHTML:a=>{let b=a.getAttribute("dir");return b&&("ltr"===b||"rtl"===b||"auto"===b)?b:this.options.direction},renderHTML:a=>a.dir?{dir:a.dir}:{}}}}]},addProseMirrorPlugins(){return[new uh({key:new uk("textDirection"),props:{attributes:()=>{let a=this.options.direction;return a?{dir:a}:{}}}})]}}),zE=class a{constructor(a,b,c=!1,d=null){this.currentNode=null,this.actualDepth=null,this.isBlock=c,this.resolvedPos=a,this.editor=b,this.currentNode=d}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var a;return null!=(a=this.actualDepth)?a:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(a){let b=this.from,c=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);b=this.from+1,c=this.to-1}this.editor.commands.insertContentAt({from:b,to:c},a)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+ +!this.node.isText}get parent(){if(0===this.depth)return null;let b=this.resolvedPos.start(this.resolvedPos.depth-1);return new a(this.resolvedPos.doc.resolve(b),this.editor)}get before(){let b=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.from-3)),new a(b,this.editor)}get after(){let b=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.to+3)),new a(b,this.editor)}get children(){let b=[];return this.node.content.forEach((c,d)=>{let e=c.isBlock&&!c.isTextblock,f=c.isAtom&&!c.isText,g=c.isInline,h=this.pos+d+ +!f;if(h<0||h>this.resolvedPos.doc.nodeSize-2)return;let i=this.resolvedPos.doc.resolve(h);if(!e&&!g&&i.depth<=this.depth)return;let j=new a(i,this.editor,e,e||g?c:null);e&&(j.actualDepth=this.depth+1),b.push(j)}),b}get firstChild(){return this.children[0]||null}get lastChild(){let a=this.children;return a[a.length-1]||null}closest(a,b={}){let c=null,d=this.parent;for(;d&&!c;){if(d.node.type.name===a)if(Object.keys(b).length>0){let a=d.node.attrs,c=Object.keys(b);for(let d=0;d<c.length;d+=1){let e=c[d];if(a[e]!==b[e])break}}else c=d;d=d.parent}return c}querySelector(a,b={}){return this.querySelectorAll(a,b,!0)[0]||null}querySelectorAll(a,b={},c=!1){let d=[];if(!this.children||0===this.children.length)return d;let e=Object.keys(b);return this.children.forEach(f=>{c&&d.length>0||(f.node.type.name===a&&e.every(a=>b[a]===f.node.attrs[a])&&d.push(f),c&&d.length>0||(d=d.concat(f.querySelectorAll(a,b,c))))}),d}setAttribute(a){let{tr:b}=this.editor.state;b.setNodeMarkup(this.from,void 0,{...this.node.attrs,...a}),this.editor.view.dispatch(b)}},zF=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`,zG=class extends zi{constructor(a={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"u">typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:a})=>{throw a},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:yV,createMappablePosition:yW},this.setOptions(a),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:a,slice:b,moved:c})=>this.options.onDrop(a,b,c)),this.on("paste",({event:a,slice:b})=>this.options.onPaste(a,b)),this.on("delete",this.options.onDelete);const b=this.createDoc(),c=xR(b,this.options.autofocus);this.editorState=ug.create({doc:b,schema:this.schema,selection:c||void 0}),this.options.element&&this.mount(this.options.element)}mount(a){if("u"<typeof document)throw Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(a),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(!1!==this.options.autofocus&&null!==this.options.autofocus&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let a=this.editorView.dom;(null==a?void 0:a.editor)&&delete a.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(a){console.warn("Failed to remove CSS element:",a)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"u">typeof document&&(this.css=function(a,b,c){let d=document.querySelector("style[data-tiptap-style]");if(null!==d)return d;let e=document.createElement("style");return b&&e.setAttribute("nonce",b),e.setAttribute("data-tiptap-style",""),e.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(e),e}(zF,this.options.injectNonce))}setOptions(a={}){this.options={...this.options,...a},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(a,b=!0){this.setOptions({editable:a}),b&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:a=>{this.editorState=a},dispatch:a=>{this.dispatchTransaction(a)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(a,b)=>{if(this.editorView)return this.editorView[b];if("state"===b)return this.editorState;if(b in a)return Reflect.get(a,b);throw Error(`[tiptap error]: The editor view is not available. Cannot access view['${b}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(a,b){let c=yv(b)?b(a,[...this.state.plugins]):[...this.state.plugins,a],d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}unregisterPlugin(a){if(this.isDestroyed)return;let b=this.state.plugins,c=b;if([].concat(a).forEach(a=>{let b="string"==typeof a?`${a}$`:a.key;c=c.filter(a=>!a.key.startsWith(b))}),b.length===c.length)return;let d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}createExtensionManager(){var a,b;let c=[...this.options.enableCoreExtensions?[zx,zt.configure({blockSeparator:null==(b=null==(a=this.options.coreExtensionOptions)?void 0:a.clipboardTextSerializer)?void 0:b.blockSeparator}),zu,zz,zA,zC,zw,zB,zv,zD.configure({direction:this.options.textDirection})].filter(a=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[a.name]):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(null==a?void 0:a.type));this.extensionManager=new zq(c,this)}createCommandManager(){this.commandManager=new xs({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let a;try{a=yn(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(b){if(!(b instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(b.message))throw b;this.emit("contentError",{editor:this,error:b,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>"collaboration"!==a.name),this.createExtensionManager()}}),a=yn(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return a}createView(a){let{editorProps:b,enableExtensionDispatchTransaction:c}=this.options,d=b.dispatchTransaction||this.dispatchTransaction.bind(this),e=c?this.extensionManager.dispatchTransaction(d):d,f=b.transformPastedHTML,g=this.extensionManager.transformPastedHTML(f);this.editorView=new w9(a,{...b,attributes:{role:"textbox",...null==b?void 0:b.attributes},dispatchTransaction:e,transformPastedHTML:g,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let h=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(h),this.prependClass(),this.injectCSS(),this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(a){this.isCapturingTransaction=!0,a(),this.isCapturingTransaction=!1;let b=this.capturedTransaction;return this.capturedTransaction=null,b}dispatchTransaction(a){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=a;return}a.steps.forEach(a=>{var b;return null==(b=this.capturedTransaction)?void 0:b.step(a)});return}let{state:b,transactions:c}=this.state.applyTransaction(a),d=!this.state.selection.eq(b.selection),e=c.includes(a),f=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:a,nextState:b}),!e)return;this.view.updateState(b),this.emit("transaction",{editor:this,transaction:a,appendedTransactions:c.slice(1)}),d&&this.emit("selectionUpdate",{editor:this,transaction:a});let g=c.findLast(a=>a.getMeta("focus")||a.getMeta("blur")),h=null==g?void 0:g.getMeta("focus"),i=null==g?void 0:g.getMeta("blur");h&&this.emit("focus",{editor:this,event:h.event,transaction:g}),i&&this.emit("blur",{editor:this,event:i.event,transaction:g}),a.getMeta("preventUpdate")||!c.some(a=>a.docChanged)||f.doc.eq(b.doc)||this.emit("update",{editor:this,transaction:a,appendedTransactions:c.slice(1)})}getAttributes(a){return yK(this.state,a)}isActive(a,b){let c="string"==typeof a?a:null,d="string"==typeof a?b:a;return function(a,b,c={}){if(!b)return x8(a,null,c)||yP(a,null,c);let d=yd(b,a.schema);return"node"===d?x8(a,b,c):"mark"===d&&yP(a,b,c)}(this.state,c,d)}getJSON(){return this.state.doc.toJSON()}getHTML(){return yu(this.state.doc.content,this.schema)}getText(a){let{blockSeparator:b="\n\n",textSerializers:c={}}=a||{};return yI(this.state.doc,{blockSeparator:b,textSerializers:{...yJ(this.schema),...c}})}get isEmpty(){return yS(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var a,b;return null==(b=null==(a=this.editorView)?void 0:a.isDestroyed)||b}$node(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelector(a,b))||null}$nodes(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelectorAll(a,b))||null}$pos(a){return new zE(this.state.doc.resolve(a),this)}get $doc(){return this.$pos(0)}};function zH(a){return new zj({find:a.find,handler:({state:b,range:c,match:d})=>{let e=yw(a.getAttributes,void 0,d);if(!1===e||null===e)return null;let{tr:f}=b,g=d[d.length-1],h=d[0];if(g){let d=h.search(/\S/),i=c.from+h.indexOf(g),j=i+g.length;if(yM(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>i).length)return null;j<c.to&&f.delete(j,c.to),i>c.from&&f.delete(c.from+d,i);let k=c.from+d+g.length;f.addMark(c.from+d,k,a.type.create(e||{})),f.removeStoredMark(a.type)}},undoable:a.undoable})}function zI(a){return new zj({find:a.find,handler:({state:b,range:c,match:d})=>{let e=b.doc.resolve(c.from),f=yw(a.getAttributes,void 0,d)||{};if(!e.node(-1).canReplaceWith(e.index(-1),e.indexAfter(-1),a.type))return null;b.tr.delete(c.from,c.to).setBlockType(c.from,c.from,a.type,f)},undoable:a.undoable})}function zJ(a){return new zj({find:a.find,handler:({state:b,range:c,match:d,chain:e})=>{let f=yw(a.getAttributes,void 0,d)||{},g=b.tr.delete(c.from,c.to),h=g.doc.resolve(c.from).blockRange(),i=h&&tF(h,a.type,f);if(!i)return null;if(g.wrap(h,i),a.keepMarks&&a.editor){let{selection:c,storedMarks:d}=b,{splittableMarks:e}=a.editor.extensionManager,f=d||c.$to.parentOffset&&c.$from.marks();if(f){let a=f.filter(a=>e.includes(a.type.name));g.ensureMarks(a)}}if(a.keepAttributes){let b="bulletList"===a.type.name||"orderedList"===a.type.name?"listItem":"taskList";e().updateAttributes(b,f).run()}let j=g.doc.resolve(c.from-1).nodeBefore;j&&j.type===a.type&&tK(g.doc,c.from-1)&&(!a.joinPredicate||a.joinPredicate(d,j))&&g.join(c.from-1)},undoable:a.undoable})}function zK(a){if(!(null==a?void 0:a.trim()))return{};let b={},c=[],d=a.replace(/["']([^"']*)["']/g,a=>(c.push(a),`__QUOTED_${c.length-1}__`)),e=d.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);e&&(b.class=e.map(a=>a.trim().slice(1)).join(" "));let f=d.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);f&&(b.id=f[1]),Array.from(d.matchAll(/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g)).forEach(([,a,d])=>{var e;let f=c[parseInt((null==(e=d.match(/__QUOTED_(\d+)__/))?void 0:e[1])||"0",10)];f&&(b[a]=f.slice(1,-1))});let g=d.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return g&&g.split(/\s+/).filter(Boolean).forEach(a=>{a.match(/^[a-zA-Z][\w-]*$/)&&(b[a]=!0)}),b}function zL(a){if(!a||0===Object.keys(a).length)return"";let b=[];return a.class&&String(a.class).split(/\s+/).filter(Boolean).forEach(a=>b.push(`.${a}`)),a.id&&b.push(`#${a.id}`),Object.entries(a).forEach(([a,c])=>{"class"!==a&&"id"!==a&&(!0===c?b.push(a):!1!==c&&null!=c&&b.push(`${a}="${String(c)}"`))}),b.join(" ")}function zM(a){let{nodeName:b,name:c,parseAttributes:d=zK,serializeAttributes:e=zL,defaultAttributes:f={},requiredAttributes:g=[],allowedAttributes:h}=a,i=c||b;return{parseMarkdown:(a,c)=>{let d={...f,...a.attributes};return c.createNode(b,d,[])},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${i}(?:\\s|$)`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,e){let f=RegExp(`^:::${i}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),h=a.match(f);if(!h)return;let j=d(h[1]||"");if(!g.find(a=>!(a in j)))return{type:b,raw:h[0],attributes:j}}},renderMarkdown:a=>{let b=e((a=>{if(!h)return a;let b={};return h.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),c=b?` {${b}}`:"";return`:::${i}${c} :::`}}}function zN(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=zK,serializeAttributes:f=zL,defaultAttributes:g={},content:h="block",allowedAttributes:i}=a,j=c||b;return{parseMarkdown:(a,c)=>{let e;if(d){let b=d(a);e="string"==typeof b?[{type:"text",text:b}]:b}else e="block"===h?c.parseChildren(a.tokens||[]):c.parseInline(a.tokens||[]);let f={...g,...a.attributes};return c.createNode(b,f,e)},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${j}`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,d){var f;let g=RegExp(`^:::${j}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),i=a.match(g);if(!i)return;let[k,l=""]=i,m=e(l),n=1,o=k.length,p="",q=/^:::([\w-]*)(\s.*)?/gm,r=a.slice(o);for(q.lastIndex=0;;){let c=q.exec(r);if(null===c)break;let e=c.index,g=c[1];if(null==(f=c[2])||!f.endsWith(":::")){if(g)n+=1;else if(0==(n-=1)){let f=r.slice(0,e);p=f.trim();let g=a.slice(0,o+e+c[0].length),i=[];if(p)if("block"===h)for((i=d.blockTokens(f)).forEach(a=>{a.text&&(!a.tokens||0===a.tokens.length)&&(a.tokens=d.inlineTokens(a.text))});i.length>0;){let a=i[i.length-1];if("paragraph"!==a.type||a.text&&""!==a.text.trim())break;i.pop()}else i=d.inlineTokens(p);return{type:b,raw:g,attributes:m,content:p,tokens:i}}}}}},renderMarkdown:(a,b)=>{let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),d=c?` {${c}}`:"",e=b.renderChildren(a.content||[],"\n\n");return`:::${j}${d}

${e}

:::`}}}function zO(a){if(!a.trim())return{};let b={},c=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,d=c.exec(a);for(;null!==d;){let[,e,f,g]=d;b[e]=f||g,d=c.exec(a)}return b}function zP(a){return Object.entries(a).filter(([,a])=>null!=a).map(([a,b])=>`${a}="${b}"`).join(" ")}function zQ(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=zO,serializeAttributes:f=zP,defaultAttributes:g={},selfClosing:h=!1,allowedAttributes:i}=a,j=c||b,k=j.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(a,c)=>{let e={...g,...a.attributes};if(h)return c.createNode(b,e);let f=d?d(a):a.content||"";return f?c.createNode(b,e,[c.createTextNode(f)]):c.createNode(b,e,[])},markdownTokenizer:{name:b,level:"inline",start(a){let b=h?RegExp(`\\[${k}\\s*[^\\]]*\\]`):RegExp(`\\[${k}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${k}\\]`),c=a.match(b),d=null==c?void 0:c.index;return void 0!==d?d:-1},tokenize(a,c,d){let f=h?RegExp(`^\\[${k}\\s*([^\\]]*)\\]`):RegExp(`^\\[${k}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${k}\\]`),g=a.match(f);if(!g)return;let i="",j="";if(h){let[,a]=g;j=a}else{let[,a,b]=g;j=a,i=b||""}let l=e(j.trim());return{type:b,raw:g[0],content:i.trim(),attributes:l}}},renderMarkdown:a=>{let b="";d?b=d(a):a.content&&a.content.length>0&&(b=a.content.filter(a=>"text"===a.type).map(a=>a.text).join(""));let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{let d="string"==typeof c?c:c.name,e="string"==typeof c?void 0:c.skipIfDefault;if(d in a){let c=a[d];if(void 0!==e&&c===e)return;b[d]=c}}),b})(a.attrs||{})),e=c?` ${c}`:"";return h?`[${j}${e}]`:`[${j}${e}]${b}[/${j}]`}}}function zR(a,b,c){var d,e,f,g;let h=a.split("\n"),i=[],j="",k=0,l=b.baseIndentSize||2;for(;k<h.length;){let a,m=h[k],n=m.match(b.itemPattern);if(!n)if(i.length>0)break;else{if(""!==m.trim())return;k+=1,j=`${j}${m}
`;continue}let o=b.extractItemData(n),{indentLevel:p,mainContent:q}=o;j=`${j}${m}
`;let r=[q];for(k+=1;k<h.length;){let a=h[k];if(""===a.trim()){let b=h.slice(k+1).findIndex(a=>""!==a.trim());if(-1===b)break;if(((null==(e=null==(d=h[k+1+b].match(/^(\s*)/))?void 0:d[1])?void 0:e.length)||0)>p){r.push(a),j=`${j}${a}
`,k+=1;continue}break}if(((null==(g=null==(f=a.match(/^(\s*)/))?void 0:f[1])?void 0:g.length)||0)>p)r.push(a),j=`${j}${a}
`,k+=1;else break}let s=r.slice(1);if(s.length>0){let d=s.map(a=>a.slice(p+l)).join("\n");d.trim()&&(a=b.customNestedParser?b.customNestedParser(d):c.blockTokens(d))}let t=b.createToken(o,a);i.push(t)}if(0!==i.length)return{items:i,raw:j}}function zS(a,b,c,d){if(!a||!Array.isArray(a.content))return"";let e="function"==typeof c?c(d):c,[f,...g]=a.content,h=b.renderChildren([f]),i=[`${e}${h}`];return g&&g.length>0&&g.forEach(a=>{let c=b.renderChildren([a]);if(c){let a=c.split("\n").map(a=>a?b.indent(a):"").join("\n");i.push(a)}}),i.join("\n")}xq({},{createAtomBlockMarkdownSpec:()=>zM,createBlockMarkdownSpec:()=>zN,createInlineMarkdownSpec:()=>zQ,parseAttributes:()=>zK,parseIndentedBlocks:()=>zR,renderNestedMarkdownContent:()=>zS,serializeAttributes:()=>zL});var zT=class a extends zm{constructor(){super(...arguments),this.type="node"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}};function zU(a){return new zo({find:a.find,handler:({state:b,range:c,match:d,pasteEvent:e})=>{let f=yw(a.getAttributes,void 0,d,e);if(!1===f||null===f)return null;let{tr:g}=b,h=d[d.length-1],i=d[0],j=c.to;if(h){let d=i.search(/\S/),e=c.from+i.indexOf(h),k=e+h.length;if(yM(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>e).length)return null;k<c.to&&g.delete(k,c.to),e>c.from&&g.delete(c.from+d,e),j=c.from+d+h.length,g.addMark(c.from+d,j,a.type.create(f||{})),g.removeStoredMark(a.type)}}})}let zV=new ci;function zW(a,b,c){let{tipTapConfig:d,addFontsFromNode:e}=a.getTextOptions();cd(d,"textOptions.tipTapConfig must be set to use rich text"),cd(e,"textOptions.addFontsFromNode must be set to use rich text");let f=zV.get(d,()=>yE(yG(d.extensions??[]),void 0)),g=sW.fromJSON(f,b),h=new Set;function i(a){h.add(a)}return!function a(b,c){for(let d of(c=e(b,c,i),b.children))a(d,c)}(g,c),Array.from(h)}function zX(a,b="_blank",c){return jK.openWindow(a,b,c)}bV("@tldraw/editor","4.4.0","esm"),a.i(65820);var zY=b_,zZ=b1;a.i(809962);let z$=a=>.65*a+.35*iR(a*iO/2),z_=a=>({size:a,thinning:0,streamline:cD(a,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:iD});function z0({strokeWidth:a,showAsComplete:b}){return{size:1+a,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:iJ,last:b}}function z1(a,b,c,d){let e=a.isComplete||c;if(d)if(!a.isPen)return{...z_(b),last:e};else return{size:b,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:iD,last:e};if("draw"===a.dash)if(a.isPen)return{size:1+1.2*b,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:z$,last:e};else return{...{size:b,thinning:.5,streamline:cD(b,[9,16],[.64,.74],!0),smoothing:.62,easing:iJ,simulatePressure:!0},last:e};return{...z_(b),last:e}}function z2(a,b=1,c=1){let d=[];for(let e of a)!function(a,b,c,d=[]){let e=hM.decodePoints(a.path);if(1!==b||1!==c)for(let a of e)a.x*=b,a.y*=c;if("free"===a.type||e.length<2)d.push(...e.map(iK.From));else{let a=Math.max(4,Math.floor(iK.Dist(e[0],e[1])/16));d.push(...iK.PointsBetween(e[0],e[1],a))}}(e,b,c,d);return d}class z3{static lineThroughPoints(a,b){let c=new z3;c.moveTo(a[0].x,a[0].y,{...b,offset:b?.endOffsets??b?.offset});for(let d=1;d<a.length;d++){let e=d===a.length-1;c.lineTo(a[d].x,a[d].y,e?{offset:b?.endOffsets}:void 0)}return c}static cubicSplineThroughPoints(a,b){let c=new z3,d=a.length,e=d-2;c.moveTo(a[0].x,a[0].y,{...b,offset:b?.endOffsets??b?.offset});for(let f=0;f<d-1;f++){let d,g,h,i,j,k=0===f?a[0]:a[f-1],l=a[f],m=a[f+1],n=f===e?m:a[f+2];0===f?(d=k.x,g=k.y):(d=l.x+(m.x-k.x)/6*1.25,g=l.y+(m.y-k.y)/6*1.25),f===e?(h=m.x,i=m.y,j={offset:b?.endOffsets}):(h=m.x-(n.x-l.x)/6*1.25,i=m.y-(n.y-l.y)/6*1.25),c.cubicBezierTo(m.x,m.y,d,g,h,i,j)}return c}commands=[];lastMoveTo=null;assertHasMoveTo(){return cd(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(a,b,c){return this.lastMoveTo={type:"move",x:a,y:b,closeIdx:null,isClose:!1,opts:c},this.commands.push(this.lastMoveTo),this}lineTo(a,b,c){return this.assertHasMoveTo(),this.commands.push({type:"line",x:a,y:b,isClose:!1,opts:c}),this}circularArcTo(a,b,c,d,e,f){return this.arcTo(a,a,b,c,0,d,e,f)}arcTo(a,b,c,d,e,f,g,h){this.assertHasMoveTo();let i=this.commands[this.commands.length-1].x,j=this.commands[this.commands.length-1].y;if(i===f&&j===g)return this;if(0===a||0===b)return this.lineTo(f,g,h);let k=Math.sin(e),l=Math.cos(e),m=Math.abs(a),n=Math.abs(b),o=(i-f)/2,p=(j-g)/2,q=l*o+k*p,r=-k*o+l*p,s=q*q/(m*m)+r*r/(n*n);if(s>1){let a=Math.sqrt(s);m*=a,n*=a}let t=(m*m*n*n-m*m*r*r-n*n*q*q)/(m*m*r*r+n*n*q*q),u=(c!==d?1:-1)*Math.sqrt(t=t<0?0:t),v=m*r/n*u,w=-(n*q)/m*u,y=l*v-k*w+(i+f)/2,z=k*v+l*w+(j+g)/2,A=Math.atan2((r-w)/n,(q-v)/m),B=Math.atan2((-r-w)/n,(-q-v)/m);!d&&B>A?B-=2*Math.PI:d&&B<A&&(B+=2*Math.PI);let C=B-A,D=Math.max(m,n)*Math.abs(C),E=Math.min(4,Math.ceil(Math.abs(C)/(Math.PI/2))),F=Math.ceil(sw(D)/E),G=C/E,H=a=>({x:y+m*Math.cos(a)*l-n*Math.sin(a)*k,y:z+m*Math.cos(a)*k+n*Math.sin(a)*l}),I=a=>({x:-m*Math.sin(a)*l-n*Math.cos(a)*k,y:-m*Math.sin(a)*k+n*Math.cos(a)*l});for(let a=0;a<E;a++){let b=A+a*G,c=A+(a+1)*G,d=c-b,e=H(b),f=H(c),g=I(b),i=I(c),j=4/3*Math.tan(d/4),k=e.x+j*g.x,l=e.y+j*g.y,m=f.x-j*i.x,n=f.y-j*i.y,o=0===a?h:{...h,mergeWithPrevious:!0};this.cubicBezierToWithResolution(f.x,f.y,k,l,m,n,o,F)}return this}cubicBezierTo(a,b,c,d,e,f,g){return this.cubicBezierToWithResolution(a,b,c,d,e,f,g)}cubicBezierToWithResolution(a,b,c,d,e,f,g,h){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:a,y:b,cp1:{x:c,y:d},cp2:{x:e,y:f},isClose:!1,opts:g,resolution:h}),this}close(){let a=this.assertHasMoveTo(),b=this.commands[this.commands.length-1];return iU(a.x,b.x)&&iU(a.y,b.y)?b.isClose=!0:this.commands.push({type:"line",x:a.x,y:a.y,isClose:!0}),a.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(a={}){let{startIdx:b=0,endIdx:c=this.commands.length,onlyFilled:d=!1}=a,e=[],f=!1,g=!1,h=!1,i=a=>{if(g||0===a)return;g=!0;let b=this.commands[a-1];e.push("M",i5(b.x),i5(b.y))};for(let a=b;a<c;a++){let b=this.commands[a];switch(b.type){case"move":{let a=b.opts?.geometry!==!1&&(b.opts?.geometry?.isFilled??!1);d&&!a?f=!0:(f=!1,g=!0,h=!0,e.push("M",i5(b.x),i5(b.y)));break}case"line":if(f)break;i(a),b.isClose&&h?e.push("Z"):e.push("L",i5(b.x),i5(b.y));break;case"cubic":if(f)break;i(a),e.push("C",i5(b.cp1.x),i5(b.cp1.y),i5(b.cp2.x),i5(b.cp2.y),i5(b.x),i5(b.y));break;default:cc(b,"type")}}return e.join(" ")}toSvg(a){if(a.forceSolid)return this.toSolidSvg(a);switch(a.style){case"solid":return this.toSolidSvg(a);case"dashed":case"dotted":return this.toDashedSvg(a);case"draw":return this.toDrawSvg(a);default:cc(a,"style")}}toPath2D(a){return new Path2D(a.forceSolid||"solid"===a.style?this.toD({onlyFilled:a.onlyFilled}):"draw"===a.style?this.toDrawD(a):this.toD({onlyFilled:a.onlyFilled}))}toGeometry(){let a=[],b=null;for(let c=0;c<this.commands.length;c++){let d=this.commands[c];"move"===d.type&&(b&&b.opts?.geometry!==!1&&a.push(new z5(this,b.startIdx,c,{...b.opts?.geometry,isFilled:b.opts?.geometry?.isFilled??!1,isClosed:null!==b.moveCommand.closeIdx})),b={startIdx:c,moveCommand:d,opts:d.opts,isClosed:!1}),d.isClose&&(cd(b,"No current move command"),b.isClosed=!0)}return(b&&b.opts?.geometry!==!1&&a.push(new z5(this,b.startIdx,this.commands.length,{...b.opts?.geometry,isFilled:b.opts?.geometry?.isFilled??!1,isClosed:null!==b.moveCommand.closeIdx})),cd(a.length>0),1===a.length)?a[0]:new kI({children:a})}toSolidSvg(a){let{strokeWidth:b,props:c}=a;return(0,bS.jsx)("path",{strokeWidth:b,d:this.toD({onlyFilled:a.onlyFilled}),...c})}toDashedSvg(a){let b,{style:c,strokeWidth:d,snap:e,lengthRatio:f,props:{markerStart:g,markerEnd:h,...i}={}}=a,j=[],k=!1,l=!1,m=null,n=()=>{if(!m)return;let{startIdx:b,endIdx:i,isFirst:k,isLast:l,length:n,lineOpts:o,pathIsClosed:p}=m;if(m=null,b===i&&"move"===this.commands[b].type)return;let q=o?.dashStart??a.start,r=o?.dashEnd??a.end,{strokeDasharray:s,strokeDashoffset:t}=kP(n,d,{style:c,snap:e,lengthRatio:f,start:k?q??(p?"outset":"none"):"outset",end:l?r??(p?"outset":"none"):"outset"}),u=this.toD({startIdx:b,endIdx:i+1});j.push((0,bS.jsx)("path",{d:u,strokeDasharray:s,strokeDashoffset:t,markerStart:k?g:void 0,markerEnd:l?h:void 0},j.length))};for(let c=0;c<this.commands.length;c++){let d=this.commands[c],e=this.commands[c-1];if("move"===d.type){k=null!==d.closeIdx;let c=d.opts?.geometry!==!1&&(d.opts?.geometry?.isFilled??!1);a.onlyFilled&&!c?l=!0:(l=!1,b=d.opts);continue}if(l)continue;let f=this.calculateSegmentLength(e,d),g="move"===e.type,h=d.isClose||c===this.commands.length-1||this.commands[c+1]?.type==="move";m&&d.opts?.mergeWithPrevious?(m.length+=f,m.endIdx=c,m.isLast=h):(n(),m={startIdx:c,endIdx:c,isFirst:g,isLast:h,length:f,lineOpts:b,pathIsClosed:k})}return n(),(0,bS.jsx)("g",{strokeWidth:d,...i,children:j})}toDrawSvg(a){return(0,bS.jsx)("path",{strokeWidth:a.strokeWidth,d:this.toDrawD(a),...a.props})}toDrawD(a){let{strokeWidth:b,randomSeed:c,offset:d=b/3,roundness:e=2*b,passes:f=2,onlyFilled:g=!1}=a,h=[],i=this.getCommandInfo(),j=[],k=null;for(let a=0;a<this.commands.length;a++){let b=this.commands[a],c=b.opts?.offset??d,f=b.opts?.roundness??e;"move"===b.type&&(k=a);let g=b.isClose?ce(k)+1:this.commands[a+1]&&"move"!==this.commands[a+1].type?a+1:void 0,h=void 0!==g&&this.commands[g]&&this.commands[g]?.type!=="move"?i[g]:void 0,l=z4[b.type],m=void 0!==g&&z4[this.commands[g].type],n=i[a],o=n?.tangentEnd,p=h?.tangentStart,q=l&&m&&o&&p&&iK.Len2(o)>.01&&iK.Len2(p)>.01?cD(Math.abs(iK.AngleBetween(o,p)),[Math.PI/2,Math.PI],[f,0],!0):0,r=iS(c,0,(Math.min(n?.length??1/0,h?.length??1/0)-2*q)/4),s=Math.min(q,(n?.length??1/0)/4),t=Math.min(q,(h?.length??1/0)/4),u={command:b,offsetAmount:r,roundnessBefore:s,roundnessAfter:t,tangentToPrev:i[a]?.tangentEnd,tangentToNext:h?.tangentStart,moveDidClose:!1};if(j.push(u),b.isClose&&null!==k){let a=j[k];a.moveDidClose=!0,a.roundnessAfter=t}else"move"===b.type&&(k=a)}for(let a=0;a<f;a++){let b=cC(c+a),d={x:0,y:0},e=!1;for(let{command:a,offsetAmount:c,roundnessBefore:f,roundnessAfter:i,tangentToNext:k,tangentToPrev:l}of j){let j=a.isClose?d:{x:b()*c,y:b()*c};if("move"===a.type){d=j;let b=a.opts?.geometry!==!1&&(a.opts?.geometry?.isFilled??!1);e=!!g&&!b}if(e)continue;let m=iK.Add(a,j),n=k&&i>0?iK.Mul(k,-i).add(m):m,o=l&&f>0?iK.Mul(l,f).add(m):m;if(n===m||o===m)switch(a.type){case"move":h.push("M",i5(n.x),i5(n.y));break;case"line":h.push("L",i5(n.x),i5(n.y));break;case"cubic":{let b=iK.Add(a.cp1,j),c=iK.Add(a.cp2,j);h.push("C",i5(b.x),i5(b.y),i5(c.x),i5(c.y),i5(n.x),i5(n.y));break}default:cc(a,"type")}else switch(a.type){case"move":h.push("M",i5(n.x),i5(n.y));break;case"line":h.push("L",i5(o.x),i5(o.y),"Q",i5(m.x),i5(m.y),i5(n.x),i5(n.y));break;case"cubic":{let b=iK.Add(a.cp1,j),c=iK.Add(a.cp2,j);h.push("C",i5(b.x),i5(b.y),i5(c.x),i5(c.y),i5(m.x),i5(m.y));break}default:cc(a,"type")}}}return h.join(" ")}calculateSegmentLength(a,b){switch(b.type){case"move":return 0;case"line":return iK.Dist(a,b);case"cubic":return z6.length(a.x,a.y,b.cp1.x,b.cp1.y,b.cp2.x,b.cp2.y,b.x,b.y);default:cc(b,"type")}}getCommands(){return this.commands}getCommandInfo(){let a=[];for(let b=1;b<this.commands.length;b++){let c,d,e=this.commands[b-1],f=this.commands[b];if(f._info){a[b]=f._info;continue}if("move"!==f.type){switch(f.type){case"line":c=d=iK.Sub(e,f).uni();break;case"cubic":c=iK.Sub(f.cp1,e).uni(),d=iK.Sub(f.cp2,f).uni();break;default:cc(f,"type")}f._info={tangentStart:c,tangentEnd:d,length:this.calculateSegmentLength(e,f)},a[b]=f._info}}return a}}let z4={line:!0,move:!0,cubic:!1};class z5 extends kG{constructor(a,b,c,d){super(d),this.path=a,this.startIdx=b,this.endIdx=c}_segments=null;getSegments(){if(this._segments)return this._segments;this._segments=[];let a=this.path.commands[this.startIdx];cd("move"===a.type);for(let b=this.startIdx+1;b<this.endIdx;b++){let c=this.path.commands[b];switch(cd("move"!==c.type),c.type){case"line":this._segments.push(new kJ({start:iK.From(a),end:iK.From(c)}));break;case"cubic":this._segments.push(new sz({start:iK.From(a),cp1:iK.From(c.cp1),cp2:iK.From(c.cp2),end:iK.From(c),resolution:c.resolution}));break;default:cc(c,"type")}a=c}return this._segments}getVertices(a){let b=this.getSegments().flatMap(b=>b.getVertices(a)).filter((a,b,c)=>{let d=c[b-1];return!d||!iK.Equals(d,a)});if(this.isClosed){let a=b[b.length-1],c=b[0];iK.Equals(a,c)||b.push(c)}return b}nearestPoint(a,b){let c=null,d=1/0;for(let b of this.getSegments()){let e=b.nearestPoint(a),f=iK.Dist2(a,e);f<d&&(d=f,c=e)}return cd(c,"No nearest point found"),c}hitTestLineSegment(a,b,c=0,d){return super.hitTestLineSegment(a,b,c,d)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}}let z6={base3(a,b,c,d,e){let f=a*(-3*b+9*c-9*d+3*e)+6*b-12*c+6*d;return a*f-3*b+3*c},length(a,b,c,d,e,f,g,h,i=1){let j=(i=i>1?1:i<0?0:i)/2,k=0;k=0;for(let i=0;i<12;i++){let l=j*z6.Tvalues[i]+j,m=z6.base3(l,a,c,e,g),n=z6.base3(l,b,d,f,h),o=m*m+n*n;k+=z6.Cvalues[i]*Math.sqrt(o)}return j*k},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function z7(){let a=jB(),b=d8("animationSpeed",()=>a?.user.getAnimationSpeed(),[a]),[c,d]=(0,bT.useState)(!1);return(0,bT.useEffect)(()=>{if(void 0!==b)return void d(0===b)},[b]),c}function z8(a){return"richText"in a.props&&ga.isValid(a.props.richText)}function z9(a,b,c={}){let d="string"==typeof b?a.getShape(b):b;if(d&&a.canEditShape(d)){if(!z8(d))throw Error("Shape does not have rich text");a.setEditingShape(d),a.setCurrentTool("select.editing_shape",{...c.info,target:"shape",shape:d}),c.selectAll&&a.emit("select-all-text",{shapeId:d.id})}}a.i(227096),a.i(794534);let Aa=(0,bT.createContext)(null);function Ab({children:a}){let b=d4("a11y",{msg:"",priority:"assertive"}),c=(0,bT.useContext)(Aa),d=(0,bT.useMemo)(()=>({currentMsg:b,announce(a){a&&b.set(a)}}),[b]);return c?(0,bS.jsx)(bS.Fragment,{children:a}):(0,bS.jsx)(Aa.Provider,{value:d,children:a})}function Ac(){let a=(0,bT.useContext)(Aa);if(!a)throw Error("useA11y must be used within a A11yContext.Provider");return a}let Ad=(0,bT.createContext)(null);function Ae({assetUrls:a,children:b}){return(0,bT.useEffect)(()=>{for(let b of Object.values(a.icons)){if(!b)continue;let a=cn();a.crossOrigin="anonymous",a.src=b,a.decode()}for(let b of Object.values(a.embedIcons)){if(!b)continue;let a=cn();a.crossOrigin="anonymous",a.src=b,a.decode()}},[a]),(0,bS.jsx)(Ad.Provider,{value:a,children:b})}function Af(){let a=(0,bT.useContext)(Ad);if(!a)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return a}let Ag={"action.toggle-auto-pan":"Auto (trackpad)","action.toggle-auto-zoom":"Auto (mouse)","action.toggle-auto-none":"Auto","action.toggle-mouse":"Mouse","action.toggle-trackpad":"Trackpad","action.convert-to-bookmark":"Convert to bookmark","action.convert-to-embed":"Convert to embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link…","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed…","action.insert-media":"Upload media…","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Keyboard shortcuts…","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print…","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Enable keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.enhanced-a11y-mode.menu":"Enhanced accessibility mode","action.enhanced-a11y-mode":"Toggle enhanced accessibility mode","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-invert-zoom.menu":"Invert mouse zoom","action.toggle-invert-zoom":"Toggle invert mouse zoom","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","action.zoom-quick":"Quick zoom","action.select-zoom-tool":"Zoom","assets.files.size-too-big":"File size is too big","assets.files.maximum-size":"Maximum file size is {size}","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldn’t load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","fill-style.lined-fill":"Lined fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.rhombus-2":"Rhombus left","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media…","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.image-crop-confirm":"Confirm","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description…","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.rotate-shape-cw":"Rotate shape clockwise","a11y.rotate-shape-ccw":"Rotate shape counterclockwise","a11y.rotate-shape-cw-fine":"Rotate shape clockwise (fine)","a11y.rotate-shape-ccw-fine":"Rotate shape counterclockwise (fine)","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Context menu…","a11y.open-keyboard-shortcuts":"Keyboard shortcuts…","menu.title":"Menu","menu.theme":"Theme","menu.accessibility":"Accessibility","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","menu.input-device":"Input device","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can’t be shared because it’s too large. We’re working on it!","share-menu.upload-failed":"Sorry, we couldn’t upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following you","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file…","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts…","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site’s URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","style-panel.selected":"selected","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn’t look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don’t ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don’t ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don’t ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We’ve updated this document to work with the current version of tldraw. If you’d like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don’t ask again","cursor-chat.type-to-chat":"Type to chat…","app.loading":"Loading tldraw…","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},Ah=new Set(["ar","fa","he","ur","ku"]),Ai={locale:"en",label:"English",messages:Ag,dir:"ltr"};async function Aj(a,b){if(!(await cm(b.translations.en)).ok)return console.warn("No main translations found."),Ai;if("en"===a)return Ai;let c=iz.find(b=>b.locale===a);if(!c)return console.warn(`No translation found for locale ${a}`),Ai;let d=await cm(b.translations[c.locale]),e=await d.json();if(!e)return console.warn(`No messages found for locale ${a}`),Ai;let f=[];for(let a in Ai.messages)e[a]||f.push(a);return f.length,{locale:a,label:c.label,dir:Ah.has(c.locale)?"rtl":"ltr",messages:{...Ai.messages,...e}}}let Ak=bT.createContext(null);function Al({overrides:a,locale:b,children:c}){let d=Af(),[e,f]=bT.useState(()=>a&&a.en?{locale:"en",label:"English",dir:"ltr",messages:{...Ag,...a.en}}:{locale:"en",label:"English",dir:"ltr",messages:Ag});return bT.useEffect(()=>{let c=!1;return async function(){let e=await Aj(b,d);e&&!c&&(a&&a[b]?f({...e,messages:{...e.messages,...a[b]}}):f(e))}(),()=>{c=!0}},[d,b,a]),(0,bS.jsx)(Ak.Provider,{value:e,children:c})}function Am(){let a=function(){let a=bT.useContext(Ak);if(!a)throw Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return a}();return bT.useCallback(function(b){return a.messages[b]??b},[a])}let An={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},Ao=bT.forwardRef(function({children:a,type:b,htmlButtonType:c,isActive:d,...e},f){return(0,bS.jsx)("button",{ref:f,type:c||"button",draggable:!1,"data-isactive":d,...e,className:(0,jb.default)("tlui-button",An[b],e.className),children:a})});function Ap(){let a=jA(),b=Am(),c=(0,bT.useRef)(null),d=(0,bT.useCallback)(b=>{a.markEventAsHandled(b),c.current?.blur();let d=a.getCurrentPageShapesInReadingOrder();d.length&&(a.setSelectedShapes([d[0].id]),a.zoomToSelectionIfOffscreen(256,{animation:{duration:a.options.animationMediumMs},inset:0}),a.timers.setTimeout(()=>a.getContainer().focus(),100))},[a]);return(0,bS.jsx)(Ao,{ref:c,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:d,children:b("a11y.skip-to-main-content")})}let Aq=(0,bT.memo)(function(){let a=Ac(),b=Am(),c=d8("a11y-msg",()=>a.currentMsg.get(),[]);return At(c.msg),As(),c.msg&&(0,bS.jsx)("div",{"aria-label":b("a11y.status"),"aria-live":c.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:c.msg})});function Ar(a){let{editor:b,selectedShapeIds:c,msg:d}=a,e="",f=c.length;if(f>1)e=d("a11y.multiple-shapes").replace("{num}",f.toString());else if(1===f){let a=c[0],f=b.getShape(a);if(!f)return"";let g=b.getShapeUtil(f.type),h=["image","video"].includes(f.type),i="";i=d("geo"===f.type?`geo-style.${f.props.geo}`:h?`a11y.shape-${f.type}`:`tool.${f.type}`);let j=b.getCurrentPageShapesInReadingOrder(),k=(j.findIndex(b=>b.id===a)+1).toString(),l=j.length.toString(),m=d("a11y.shape-index").replace("{num}",k).replace("{total}",l),n=g.getAriaDescriptor(f)||g.getText(f)||"";e=(n?`${n}, `:"")+`${i}. ${m}`}return e}let As=()=>{let a=jB(),b=Ac(),c=Am(),d=(0,bT.useRef)([]);d7("announce selection",()=>{if(a&&a.isIn("select.idle")){let e=a.getSelectedShapeIds();e!==d.current&&(d.current=e,dU(()=>{let d=Ar({editor:a,selectedShapeIds:e,msg:c});d&&b.announce({msg:d})}))}},[a,b,c])},At=a=>{let b=jG();(0,bT.useEffect)(()=>{if(ji.a11y.get()){let b=a=>{console.debug(`%ca11y%c: ${a}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},c=a=>{let c=document.activeElement;if("Tab"===a.key&&c&&c!==document.body&&!c.classList.contains("tl-container")){let a=c.getAttribute("aria-label")||c.getAttribute("title")||c.textContent;a&&b(a)}};return a&&b(a),document.addEventListener("keyup",c),()=>document.removeEventListener("keyup",c)}},[b,a])};function Au(a,b){let c=b?a.getAsset(b):null;if(c&&!c.props.image)if(!c.props.title)return 46;else return 101;return 320}function Av(a,b){return{...b,props:{...b.props,h:Au(a,b.props.assetId)}}}let Aw=cj(async(a,b)=>{if(a.isDisposed)return;let{url:c}=b.props,d=await a.getAssetForExternalContent({type:"url",url:c});d&&a.run(()=>{a.createAssets([d]),a.updateShapes([{id:b.id,type:b.type,props:{assetId:d.id}}])})},500);async function Ax(a,{url:b,center:c=a.getViewportPageBounds().center}){try{let d=await a.getAssetForExternalContent({type:"url",url:b}),e=gi(),f={id:e,type:"bookmark",x:c.x-150,y:c.y-160,rotation:0,opacity:1,props:{url:b,assetId:d?.id||null,w:300,h:Au(a,d?.id)}};a.run(()=>{d&&a.createAssets([d]),a.createShapes([f])});let g=a.getShape(e);return cb.ok(g)}catch(a){return cb.err(a instanceof Error?a.message:"Failed to create bookmark")}}function Ay(a,b,c={padding:50}){let d=kt.FromPoints(a.flatMap(a=>{if(!a)return[];let c=b.getShapeGeometry(a.id),d=b.getShapeLocalTransform(a);return d?.applyToPoints(c.vertices)??[]})),e=c.padding??50,f=d.w+2*e,g=d.h+2*e;return{w:f,h:g,dx:e-d.minX,dy:e-d.minY}}function Az(a,b,c={}){let d=a.getShape(b);if(!d)return;let e=a.getSortedChildIdsForParent(d.id),f=b4(e.map(b=>a.getShape(b)));if(!f.length)return;let{w:g,h,dx:i,dy:j}=Ay(f,a,c);if(0===i&&0===j&&d.props.w===g&&d.props.h===h)return;let k=new iK(i,j).rot(d.rotation);a.run(()=>{let b=e.map(b=>{let c=a.getShape(b);return{id:c.id,type:c.type,x:c.x+i,y:c.y+j}});b.push({id:d.id,type:d.type,x:d.x-k.x,y:d.y-k.y,props:{w:g,h}}),a.updateShapes(b)})}a.i(255099);var AA=f$;function AB({children:a}){return(0,bS.jsx)("span",{className:"tlui-button__label",children:a})}var AC=a.i(729563),AC=AC;let AD=(0,bT.memo)(function({label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}){return"string"==typeof d?(0,bS.jsx)(AE,{label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}):(0,bT.cloneElement)(d,{...g,className:(0,jb.default)({"tlui-icon__small":b},f,d.props.className),"aria-label":a,style:{color:e,transform:c?"scale(-1, 1)":void 0,...d.props.style}})});function AE({label:a,small:b,invertIcon:c,icon:d,color:e,className:f,...g}){let h=Af(),i=h.icons[d]??h.icons["question-mark-circle"],j=(0,bT.useRef)(null);return((0,bT.useLayoutEffect)(()=>{i||console.error(`Icon not found: ${d}. Add it to the assetUrls.icons object.`),j?.current&&(j.current.style.webkitMask=`url(${i}) center 100% / 100% no-repeat`)},[j,i,d]),"none"===d)?(0,bS.jsx)("div",{className:(0,jb.default)("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":b},f),...g}):(0,bS.jsx)("div",{...g,ref:j,"aria-label":a,role:"img",className:(0,jb.default)("tlui-icon",{"tlui-icon__small":b},f),style:{color:e,mask:`url(${i}) center 100% / 100% no-repeat`,transform:c?"scale(-1, 1)":void 0}})}function AF({icon:a,small:b,invertIcon:c}){return(0,bS.jsx)(AD,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:a,small:b,invertIcon:c})}function AG({className:a,children:b}){return(0,bS.jsx)("div",{className:(0,jb.default)("tlui-dialog__header",a),children:b})}function AH({className:a,children:b,style:c}){return(0,bS.jsx)(AC.Title,{dir:"ltr",className:(0,jb.default)("tlui-dialog__header__title",a),style:c,children:b})}function AI(){let a=Am();return(0,bS.jsx)("div",{className:"tlui-dialog__header__close",children:(0,bS.jsx)(AC.DialogClose,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,bS.jsx)(Ao,{type:"icon","aria-label":a("ui.close"),onTouchEnd:a=>a.target.click(),children:(0,bS.jsx)(AF,{small:!0,icon:"cross-2"})})})})}function AJ({className:a,children:b,style:c}){return(0,bS.jsx)("div",{className:(0,jb.default)("tlui-dialog__body",a),style:c,tabIndex:0,children:b})}function AK({className:a,children:b}){return(0,bS.jsx)("div",{className:(0,jb.default)("tlui-dialog__footer",a),children:b})}let AL=bT.forwardRef(function({className:a,label:b,icon:c,iconLeft:d,iconLabel:e,autoSelect:f=!1,autoFocus:g=!1,defaultValue:h,placeholder:i,onComplete:j,onValueChange:k,onCancel:l,onFocus:m,onBlur:n,shouldManuallyMaintainScrollPositionWhenFocused:o=!1,children:p,value:q,"data-testid":r,disabled:s,"aria-label":t},u){let v=jB(),w=bT.useRef(null);bT.useImperativeHandle(u,()=>w.current);let y=Am(),z=bT.useRef(h??""),A=bT.useRef(h??""),B=bT.useRef(!1),[C,D]=bT.useState(!1),E=bT.useCallback(a=>{D(!0);let b=a.currentTarget;A.current=b.value,v?v.timers.requestAnimationFrame(()=>{f&&b.select()}):mj.requestAnimationFrame("anon",()=>{f&&b.select()}),m?.()},[f,v,m]),F=bT.useCallback(a=>{let b=a.currentTarget.value;A.current=b,k?.(b)},[k]),G=bT.useCallback(a=>{switch(a.key){case"Enter":if(B.current)return;a.currentTarget.blur(),a.stopPropagation(),j?.(a.currentTarget.value);break;case"Escape":a.currentTarget.value=z.current,l?.(a.currentTarget.value),a.currentTarget.blur(),a.stopPropagation()}},[j,l]),H=bT.useCallback(a=>{D(!1);let b=a.currentTarget.value;n?.(b)},[n]),I=bT.useCallback(()=>B.current=!0,[]),J=bT.useCallback(()=>B.current=!1,[]);return bT.useEffect(()=>{1},[C,v,o]),(0,bS.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,b&&(0,bS.jsx)("label",{children:y(b)}),d&&(0,bS.jsx)(AD,{label:e?y(e):"",icon:d,className:"tlui-icon-left",small:!0}),(0,bS.jsx)("input",{ref:w,className:(0,jb.default)("tlui-input",a),type:"text",defaultValue:h,onKeyDownCapture:G,onChange:F,onFocus:E,onBlur:H,onCompositionStart:I,onCompositionEnd:J,autoFocus:g,"aria-label":t,placeholder:i,value:q,"data-testid":r,disabled:s}),c&&(0,bS.jsx)(AD,{label:e?y(e):"",icon:c,small:!!b})]})});function AM(a){return AA.linkUrl.isValid(a)?{isValid:!0,hasProtocol:!0}:AA.linkUrl.isValid("https://"+a)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}function AN(a){return!!(a&&"url"in a.props&&"string"==typeof a.props.url)}function AO(a){if(!AN(a))throw Error("Shape is not a valid ShapeWithUrl")}let AP=d3(function({onClose:a}){let b=jA().getOnlySelectedShape();return AN(b)?(0,bS.jsx)(AQ,{onClose:a,selectedShape:b}):null}),AQ=d3(function({onClose:a,selectedShape:b}){let c=jA(),d=Am(),e=(0,bT.useRef)(null);(0,bT.useEffect)(()=>{c.timers.requestAnimationFrame(()=>e.current?.focus())},[c]);let f=(0,bT.useRef)(b.props.url),[g,h]=(0,bT.useState)(()=>{let a=AM(b.props.url),c=!0===a.isValid?a.hasProtocol?b.props.url:"https://"+b.props.url:"https://";return{actual:c,safe:c,valid:!0}}),i=(0,bT.useCallback)(a=>{let b=a.replace(/https?:\/\/(https?:\/\/)/,(a,b)=>b),c=AM(b),d=!0===c.isValid?c.hasProtocol?b:"https://"+b:"https://";h({actual:b,safe:d,valid:c.isValid})},[]),j=(0,bT.useCallback)(()=>{let b=c.getOnlySelectedShape();b&&(AO(b),c.updateShapes([{id:b.id,type:b.type,props:{url:""}}]),a())},[c,a]),k=(0,bT.useCallback)(()=>{let b=c.getOnlySelectedShape();b&&(AO(b),b&&"url"in b.props&&b.props.url!==g.safe&&c.updateShapes([{id:b.id,type:b.type,props:{url:g.safe}}]),a())},[c,a,g]),l=(0,bT.useCallback)(()=>{a()},[a]);if(!b)return a(),null;let m=f.current&&!g.valid;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(AG,{children:[(0,bS.jsx)(AH,{children:d("edit-link-dialog.title")}),(0,bS.jsx)(AI,{})]}),(0,bS.jsx)(AJ,{children:(0,bS.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,bS.jsx)(AL,{ref:e,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:g.actual,onValueChange:i,onComplete:k,onCancel:l}),(0,bS.jsx)("div",{children:d(g.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,bS.jsxs)(AK,{className:"tlui-dialog__footer__actions",children:[(0,bS.jsx)(Ao,{type:"normal",onClick:l,onTouchEnd:l,children:(0,bS.jsx)(AB,{children:d("edit-link-dialog.cancel")})}),m?(0,bS.jsx)(Ao,{type:"danger",onTouchEnd:j,onClick:j,children:(0,bS.jsx)(AB,{children:d("edit-link-dialog.clear")})}):(0,bS.jsx)(Ao,{type:"primary",disabled:!g.valid,onTouchEnd:k,onClick:k,children:(0,bS.jsx)(AB,{children:d("edit-link-dialog.save")})})]})]})}),AR=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,AS=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(AR))return b.searchParams.append("embed","true"),a},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(AR))return b.searchParams.delete("embed"),a},embedOnPaste:!1},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:a=>{if(a.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!a.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${a}`},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/?$/)){let a=b.searchParams.get("url");if(a)return a}},embedOnPaste:!0},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:a=>{if(a.includes("/maps/embed?"))return a;if(a.includes("/maps/")){let b,c=a.match(/@(.*?),(.*?),(.*?)(z|m)/);if(c){let[,d,e,f,g]=c,h="z"===g?"roadmap":"satellite",i="roadmap"===h?f:-Math.log2(parseInt(f)/0xe16861)/.8,j=new URL(a).host.replace("www.","");b=`https://${j}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${d},${e}&zoom=${i}&maptype=${h}`}else b="";return b}},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&b.searchParams.has("center")&&b.searchParams.get("zoom")){let a=b.searchParams.get("zoom")??"12",c=b.searchParams.get("maptype")??"roadmap",d="roadmap"===c?a:0xe16861*Math.pow(2,-.8*parseInt(a)),[e,f]=b.searchParams.get("center").split(",");return`https://www.google.com/maps/@${e},${f},${d}${"roadmap"===c?"z":"m"}`}},embedOnPaste:!0},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/v\/(.+)\/?/);if(c)return`https://www.val.town/embed/${c[1]}`},fromEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/embed\/(.+)\/?/);if(c)return`https://www.val.town/v/${c[1]}`},embedOnPaste:!0},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/s\/([^/]+)\/?/);if(c)return`https://codesandbox.io/embed/${c[1]}`},fromEmbedUrl:a=>{let b=dh(a),c=b&&b.pathname.match(/\/embed\/([^/]+)\/?/);if(c)return`https://codesandbox.io/s/${c[1]}`},embedOnPaste:!0},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/embed/${d}`}},fromEmbedUrl:a=>{let b=a.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(b){let[a,c,d]=b;return`https://codepen.io/${c}/pen/${d}`}},embedOnPaste:!0},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,embedOnPaste:!0,toEmbedUrl:a=>{let b=a.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/embed/${c}`}},fromEmbedUrl:a=>{let b=a.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(b){let[a,c]=b;return`https://scratch.mit.edu/projects/${c}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(!b)return;let c=b.hostname.replace(/^www./,"");if("youtu.be"===c){let a=b.pathname.split("/").filter(Boolean)[0],c=new URLSearchParams(b.search),d=c.get("t");d&&(c.set("start",d),c.delete("t"));let e=c.toString()?"?"+c.toString():"";return`https://www.youtube.com/embed/${a}${e}`}if(("youtube.com"===c||"m.youtube.com"===c)&&b.pathname.match(/^\/watch/)){let a=b.searchParams.get("v"),c=new URLSearchParams(b.search);c.delete("v");let d=c.get("t");d&&(c.set("start",d),c.delete("t"));let e=c.toString()?"?"+c.toString():"";return`https://www.youtube.com/embed/${a}${e}`}},fromEmbedUrl:a=>{let b=dh(a);if(b&&"youtube.com"===b.hostname.replace(/^www./,"")){let a=b.pathname.match(/^\/embed\/([^/]+)\/?/);if(a){let c=new URLSearchParams(b.search);c.set("v",a?.[1]??"");let d=c.get("start");return d&&(c.set("t",d),c.delete("start")),`https://www.youtube.com/watch?${c.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a),c=b?.searchParams.get("cid");if(b?.pathname.match(/\/calendar\/u\/0/)&&c){for(let a of(b.pathname="/calendar/embed",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("src",c),b.href}},fromEmbedUrl:a=>{let b=dh(a),c=b?.searchParams.get("src");if(b?.pathname.match(/\/calendar\/embed/)&&c){for(let a of(b.pathname="/calendar/u/0",Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.searchParams.set("cid",c),b.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/pub\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/pub$/,"/embed"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}},fromEmbedUrl:a=>{let b=dh(a);if(b?.pathname.match(/^\/presentation/)&&b?.pathname.match(/\/embed\/?$/)){for(let a of(b.pathname=b.pathname.replace(/\/embed$/,"/pub"),Array.from(b.searchParams.keys())))b.searchParams.delete(a);return b.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!a.split("/").pop())return;return a}},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!a.split("/").pop())return;return a}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/))return b.searchParams.append("embed","true"),b.href},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/\/@([^/]+)\/([^/]+)/)&&b.searchParams.has("embed"))return b.searchParams.delete("embed"),b.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/map\//))return b.origin+"/embed"+b.pathname},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/map\//))return b.pathname=b.pathname.replace(/^\/embed/,""),b.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/(artist|album)\//))return b.origin+"/embed"+b.pathname},fromEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/embed\/(artist|album)\//))return b.origin+b.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&"vimeo.com"===b.hostname&&b.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+b.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:a=>{let b=dh(a);if(b&&"player.vimeo.com"===b.hostname){let a=b.pathname.match(/^\/video\/([^/]+)\/?$/);if(a)return"https://vimeo.com/"+a[1]}}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&b.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${b.origin}/embed${b.pathname}?cell=*`;if(b&&b.pathname.match(/^\/d\/([^/]+)\/?$/)){let a=b.pathname.replace(/^\/d/,"");return`${b.origin}/embed${a}?cell=*`}},fromEmbedUrl:a=>{let b=dh(a);return b&&b.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","")}#cell-*`:b&&b.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${b.origin}${b.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,embedOnPaste:!0,toEmbedUrl:a=>{let b=dh(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===b.search&&""===b.hash)return`${a}?embed`},fromEmbedUrl:a=>{let b=dh(a);if(b&&"www.desmos.com"===b.hostname&&b.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===b.search&&""===b.hash)return a.replace("?embed","")}}],AT={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},AU=AS.map(a=>a.type);function AV(){let a=jB();if(a&&a.hasShapeUtil("embed"))return a.getShapeUtil("embed")}function AW(){let a=AV();return b=>a?a.getEmbedDefinition(b):void 0}let AX=d3(function({onClose:a}){let b,c=jA(),d=Am(),e=Af(),[f,g]=(0,bT.useState)(null),[h,i]=(0,bT.useState)(""),[j,k]=(0,bT.useState)(null),[l,m]=(0,bT.useState)(!1),n=(0,bT.useRef)(-1),o=(b=AV())?b.getEmbedDefinitions():[],p=AW();return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(AG,{children:[(0,bS.jsx)(AH,{children:f?`${d("embed-dialog.title")} \u2014 ${f.title}`:d("embed-dialog.title")}),(0,bS.jsx)(AI,{})]}),f?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(AJ,{className:"tlui-embed-dialog__enter",children:[(0,bS.jsx)(AL,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:a=>{i(a);let b=p(a);k(b&&b.definition.type===f.type?b:null),m(!1),clearTimeout(n.current),n.current=c.timers.setTimeout(()=>m(!b),320)}}),""===h?(0,bS.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,bS.jsx)("span",{children:d("embed-dialog.instruction")})," ",f.instructionLink&&(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:f.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):(0,bS.jsx)("div",{className:"tlui-embed-dialog__warning",children:l?d("embed-dialog.invalid-url"):" "})]}),(0,bS.jsxs)(AK,{className:"tlui-dialog__footer__actions",children:[(0,bS.jsx)(Ao,{type:"normal",onClick:()=>{g(null),k(null),i("")},children:(0,bS.jsx)(AB,{children:d("embed-dialog.back")})}),(0,bS.jsx)("div",{className:"tlui-embed__spacer"}),(0,bS.jsx)(Ao,{type:"normal",onClick:a,children:(0,bS.jsx)(AB,{children:d("embed-dialog.cancel")})}),(0,bS.jsx)(Ao,{type:"primary",disabled:!j,onClick:()=>{j&&(c.putExternalContent({type:"embed",url:h,point:c.getViewportPageBounds().center,embed:j.definition}),a())},children:(0,bS.jsx)(AB,{children:d("embed-dialog.create")})})]})]}):(0,bS.jsx)(bS.Fragment,{children:(0,bS.jsx)(AJ,{className:"tlui-embed-dialog__list",children:o.map(a=>{var b;let c=(b=a.type,AU.includes(b))?e.embedIcons[a.type]:"icon"in a?a.icon:void 0;return(0,bS.jsxs)(Ao,{type:"menu",onClick:()=>g(a),children:[(0,bS.jsx)(AB,{children:a.title}),c&&(0,bS.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${c})`}})]},a.type)})})})]})}),AY=[0,389,436,476,580,640,840,1023];var AZ=((t=AZ||{})[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t);let A$=bT.default.createContext(null);function A_({forceMobile:a=!1,children:b}){let c=jB(),d=d8("breakpoint",()=>{let{width:b}=c?.getViewportScreenBounds()??{width:window.innerWidth},d=a?AZ.MOBILE_SM:AY.length-1;for(let a=0;a<d;a++)if(b>AY[a]&&b<=AY[a+1])return a;return d},[c]);return(0,bS.jsx)(A$.Provider,{value:d,children:b})}function A0(){let a=(0,bT.useContext)(A$);if(null===a)throw Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return a}let A1=(0,bT.createContext)(null);function A2(){let a=(0,bT.useContext)(A1);if(!a)throw Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return a}function A3({type:a,sourceId:b,children:c}){return(0,bS.jsx)(A1.Provider,{value:{type:a,sourceId:b},children:c})}function A4(){let a=jB();return a?.store.props.collaboration!==void 0}var A5=a.i(452881),A6=a.i(87411),A7=Symbol("radix.slottable");function A8(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===A7}var A9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(A8);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),Ba=a.i(627810),Bb=a.i(690840),Bc=a.i(568268),Bd="ContextMenu",[Be,Bf]=function(a,b=[]){let c=[],d=()=>{let b=c.map(a=>bT.createContext(a));return function(c){let d=c?.[a]||b;return bT.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=bT.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=bT.useMemo(()=>g,Object.values(g));return(0,bS.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=bT.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return bT.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}(Bd,[Ba.createMenuScope]),Bg=(0,Ba.createMenuScope)(),[Bh,Bi]=Be(Bd),Bj=a=>{let{__scopeContextMenu:b,children:c,onOpenChange:d,dir:e,modal:f=!0}=a,[g,h]=bT.useState(!1),i=Bg(b),j=(0,Bb.useCallbackRef)(d),k=bT.useCallback(a=>{h(a),j(a)},[j]);return(0,bS.jsx)(Bh,{scope:b,open:g,onOpenChange:k,modal:f,children:(0,bS.jsx)(Ba.Root,{...i,dir:e,open:g,onOpenChange:k,modal:f,children:c})})};Bj.displayName=Bd;var Bk="ContextMenuTrigger",Bl=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,disabled:d=!1,...e}=a,f=Bi(Bk,c),g=Bg(c),h=bT.useRef({x:0,y:0}),i=bT.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...h.current})}),j=bT.useRef(0),k=bT.useCallback(()=>window.clearTimeout(j.current),[]),l=a=>{h.current={x:a.clientX,y:a.clientY},f.onOpenChange(!0)};return bT.useEffect(()=>k,[k]),bT.useEffect(()=>void(d&&k()),[d,k]),(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Ba.Anchor,{...g,virtualRef:i}),(0,bS.jsx)(A9.span,{"data-state":f.open?"open":"closed","data-disabled":d?"":void 0,...e,ref:b,style:{WebkitTouchCallout:"none",...a.style},onContextMenu:d?a.onContextMenu:(0,A5.composeEventHandlers)(a.onContextMenu,a=>{k(),l(a),a.preventDefault()}),onPointerDown:d?a.onPointerDown:(0,A5.composeEventHandlers)(a.onPointerDown,BC(a=>{k(),j.current=window.setTimeout(()=>l(a),700)})),onPointerMove:d?a.onPointerMove:(0,A5.composeEventHandlers)(a.onPointerMove,BC(k)),onPointerCancel:d?a.onPointerCancel:(0,A5.composeEventHandlers)(a.onPointerCancel,BC(k)),onPointerUp:d?a.onPointerUp:(0,A5.composeEventHandlers)(a.onPointerUp,BC(k))})]})});Bl.displayName=Bk;var Bm=a=>{let{__scopeContextMenu:b,...c}=a,d=Bg(b);return(0,bS.jsx)(Ba.Portal,{...d,...c})};Bm.displayName="ContextMenuPortal";var Bn="ContextMenuContent",Bo=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bi(Bn,c),f=Bg(c),g=bT.useRef(!1);return(0,bS.jsx)(Ba.Content,{...f,...d,ref:b,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),!b.defaultPrevented&&g.current&&b.preventDefault(),g.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||e.modal||(g.current=!0)},style:{...a.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bo.displayName=Bn;var Bp=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.Group,{...e,...d,ref:b})});Bp.displayName="ContextMenuGroup";var Bq=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.Label,{...e,...d,ref:b})});Bq.displayName="ContextMenuLabel";var Br=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.Item,{...e,...d,ref:b})});Br.displayName="ContextMenuItem";var Bs=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.CheckboxItem,{...e,...d,ref:b})});Bs.displayName="ContextMenuCheckboxItem";var Bt=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.RadioGroup,{...e,...d,ref:b})});Bt.displayName="ContextMenuRadioGroup";var Bu=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.RadioItem,{...e,...d,ref:b})});Bu.displayName="ContextMenuRadioItem";var Bv=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.ItemIndicator,{...e,...d,ref:b})});Bv.displayName="ContextMenuItemIndicator";var Bw=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.Separator,{...e,...d,ref:b})});Bw.displayName="ContextMenuSeparator";var Bx=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.Arrow,{...e,...d,ref:b})});Bx.displayName="ContextMenuArrow";var By="ContextMenuSub",Bz=a=>{let{__scopeContextMenu:b,children:c,onOpenChange:d,open:e,defaultOpen:f}=a,g=Bg(b),[h,i]=(0,Bc.useControllableState)({prop:e,defaultProp:f??!1,onChange:d,caller:By});return(0,bS.jsx)(Ba.Sub,{...g,open:h,onOpenChange:i,children:c})};Bz.displayName=By;var BA=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.SubTrigger,{...e,...d,ref:b})});BA.displayName="ContextMenuSubTrigger";var BB=bT.forwardRef((a,b)=>{let{__scopeContextMenu:c,...d}=a,e=Bg(c);return(0,bS.jsx)(Ba.SubContent,{...e,...d,ref:b,style:{...a.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});function BC(a){return b=>"mouse"!==b.pointerType?a(b):void 0}BB.displayName="ContextMenuSubContent",a.s(["Arrow",()=>Bx,"CheckboxItem",()=>Bs,"Content",()=>Bo,"ContextMenu",()=>Bj,"ContextMenuArrow",()=>Bx,"ContextMenuCheckboxItem",()=>Bs,"ContextMenuContent",()=>Bo,"ContextMenuGroup",()=>Bp,"ContextMenuItem",()=>Br,"ContextMenuItemIndicator",()=>Bv,"ContextMenuLabel",()=>Bq,"ContextMenuPortal",()=>Bm,"ContextMenuRadioGroup",()=>Bt,"ContextMenuRadioItem",()=>Bu,"ContextMenuSeparator",()=>Bw,"ContextMenuSub",()=>Bz,"ContextMenuSubContent",()=>BB,"ContextMenuSubTrigger",()=>BA,"ContextMenuTrigger",()=>Bl,"Group",()=>Bp,"Item",()=>Br,"ItemIndicator",()=>Bv,"Label",()=>Bq,"Portal",()=>Bm,"RadioGroup",()=>Bt,"RadioItem",()=>Bu,"Root",()=>Bj,"Separator",()=>Bw,"Sub",()=>Bz,"SubContent",()=>BB,"SubTrigger",()=>BA,"Trigger",()=>Bl,"createContextMenuScope",()=>Bf],560393);var BD=a.i(560393),BD=BD;function BE(){let a=jB();return d8("isReadonlyMode",()=>!!a?.getIsReadonly(),[a])}let BF="__CTRL__",BG="__CTRL__",BH="__ALT__";function BI(a){return","===a?[","]:a.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(a=>a.startsWith("[[")?a.replace(/[[\]]/g,""):a.replace(/cmd\+/g,BF).replace(/ctrl\+/g,BG).replace(/alt\+/g,BH).replace(/shift\+/g,"⇧").replace(/\$/g,BF).replace(/\?/g,BH).replace(/!/g,"⇧").match(/__CTRL__|__ALT__|./g)||[]).flat().map((a,b)=>{let c;return"+"===a[0]?[]:(c="__CTRL__"===a?"Ctrl":"__ALT__"===a?"Alt":a[0].toUpperCase()+a.slice(1),b?["+",c]:c)}).flat()}function BJ(a){return"— "+BI(a).join(" ")}function BK(a){let b=Am();return(0,bS.jsx)(qX,{"aria-label":b("app.loading"),...a})}var BL=a.i(334438),BL=BL;let BM=()=>void 0,BN=bT.createContext(null);function BO({onEvent:a,children:b}){return(0,bS.jsx)(BN.Provider,{value:a??BM,children:b})}function BP(){return bT.useContext(BN)??BM}function BQ(a,b){var c;let d,e,f,g=jB(),h=(0,bT.useCallback)(a=>{a&&g?.complete(),b?.(a)},[g,b]),i=BP(),j=(0,bT.useCallback)(b=>{i(b,{source:"unknown",id:a})},[a,i]);return c=g?`${a}-${g.contextId}`:a,d=(0,bT.useRef)(!1),e=(0,bT.useCallback)(a=>{d.current=a,a?mi.addOpenMenu(c):mi.deleteOpenMenu(c),h?.(a)},[c,h]),f=d8("is menu open",()=>mi.getOpenMenus().includes(c),[c]),(0,bT.useEffect)(()=>(d.current&&(j?.("open-menu"),mi.addOpenMenu(c)),()=>{d.current&&(mi.deleteOpenMenu(c),mi.getOpenMenus().forEach(a=>{a.startsWith(c)&&(j?.("close-menu"),mi.deleteOpenMenu(a))}),d.current=!1)}),[c,j]),[f,e]}function BR({id:a,children:b,modal:c=!1,debugOpen:d=!1}){let[e,f]=BQ(a);return(0,bS.jsx)(BL.Root,{open:d||e,dir:"ltr",modal:c,onOpenChange:f,children:b})}function BS({children:a,...b}){return(0,bS.jsx)(BL.Trigger,{dir:"ltr",asChild:!0,onTouchEnd:a=>jm(a),...b,children:a})}function BT({className:a,side:b="bottom",align:c="start",sideOffset:d=8,alignOffset:e=8,children:f}){let g=jG();return(0,bS.jsx)(BL.Portal,{container:g,children:(0,bS.jsx)(BL.Content,{className:(0,jb.default)("tlui-menu",a),side:b,sideOffset:d,align:c,alignOffset:e,collisionPadding:4,children:f})})}function BU({id:a,children:b}){let[c,d]=BQ(a);return(0,bS.jsx)(BL.Sub,{open:c,onOpenChange:d,children:b})}function BV({id:a,label:b,title:c,disabled:d}){return(0,bS.jsx)(BL.SubTrigger,{dir:"ltr",asChild:!0,disabled:d,children:(0,bS.jsxs)(Ao,{"data-testid":a,type:"menu",className:"tlui-menu__submenu__trigger",disabled:d,title:c,children:[(0,bS.jsx)(AB,{children:b}),(0,bS.jsx)(AF,{icon:"chevron-right",small:!0})]})})}function BW({id:a,alignOffset:b=-1,sideOffset:c=-6,size:d="small",children:e}){let f=jG();return(0,bS.jsx)(BL.Portal,{container:f,children:(0,bS.jsx)(BL.SubContent,{"data-testid":a,className:"tlui-menu tlui-menu__submenu__content",alignOffset:b,sideOffset:c,collisionPadding:4,"data-size":d,children:e})})}function BX({className:a,children:b}){return(0,bS.jsx)("div",{dir:"ltr",className:(0,jb.default)("tlui-menu__group",a),children:b})}function BY({noClose:a,children:b}){return(0,bS.jsx)(BL.Item,{dir:"ltr",asChild:!0,onClick:a?jm:void 0,children:b})}function BZ({children:a,onSelect:b,...c}){let d=Am();return(0,bS.jsxs)(BL.CheckboxItem,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:a=>{b?.(a),jm(a)},...c,children:[(0,bS.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,bS.jsx)(BL.ItemIndicator,{dir:"ltr",children:(0,bS.jsx)(AD,{label:d("ui.checked"),icon:"check",small:!0})})}),a]})}function B$({children:a,visibleOnMobileLayout:b=!1}){let c=A0();return!b&&c<AZ.MOBILE?null:(0,bS.jsx)("kbd",{className:"tlui-kbd",children:BI(a).map((a,b)=>(0,bS.jsx)("span",{children:a},b))})}var B_=a.i(742196),B0=Symbol("radix.slottable");function B1(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===B0}var B2=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(B1);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),B3=Symbol("radix.slottable");function B4(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===B3}var B5=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(B4);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),B6="horizontal",B7=["horizontal","vertical"],B8=bT.forwardRef((a,b)=>{var c;let{decorative:d,orientation:e=B6,...f}=a,g=(c=e,B7.includes(c))?e:B6;return(0,bS.jsx)(B5.div,{"data-orientation":g,...d?{role:"none"}:{"aria-orientation":"vertical"===g?g:void 0,role:"separator"},...f,ref:b})});B8.displayName="Separator";var B9=Symbol("radix.slottable");function Ca(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===B9}var Cb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(Ca);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),Cc=Symbol("radix.slottable");function Cd(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===Cc}var Ce=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(Cd);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),Cf="Toggle",Cg=bT.forwardRef((a,b)=>{let{pressed:c,defaultPressed:d,onPressedChange:e,...f}=a,[g,h]=(0,Bc.useControllableState)({prop:c,onChange:e,defaultProp:d??!1,caller:Cf});return(0,bS.jsx)(Ce.button,{type:"button","aria-pressed":g,"data-state":g?"on":"off","data-disabled":a.disabled?"":void 0,...f,ref:b,onClick:(0,A5.composeEventHandlers)(a.onClick,()=>{a.disabled||h(!g)})})});Cg.displayName=Cf;var Ch=a.i(169853),Ci="ToggleGroup",[Cj,Ck]=function(a,b=[]){let c=[],d=()=>{let b=c.map(a=>bT.createContext(a));return function(c){let d=c?.[a]||b;return bT.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=bT.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=bT.useMemo(()=>g,Object.values(g));return(0,bS.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=bT.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return bT.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}(Ci,[B_.createRovingFocusGroupScope]),Cl=(0,B_.createRovingFocusGroupScope)(),Cm=bT.default.forwardRef((a,b)=>{let{type:c,...d}=a;if("single"===c)return(0,bS.jsx)(Cp,{...d,ref:b});if("multiple"===c)return(0,bS.jsx)(Cq,{...d,ref:b});throw Error(`Missing prop \`type\` expected on \`${Ci}\``)});Cm.displayName=Ci;var[Cn,Co]=Cj(Ci),Cp=bT.default.forwardRef((a,b)=>{let{value:c,defaultValue:d,onValueChange:e=()=>{},...f}=a,[g,h]=(0,Bc.useControllableState)({prop:c,defaultProp:d??"",onChange:e,caller:Ci});return(0,bS.jsx)(Cn,{scope:a.__scopeToggleGroup,type:"single",value:bT.default.useMemo(()=>g?[g]:[],[g]),onItemActivate:h,onItemDeactivate:bT.default.useCallback(()=>h(""),[h]),children:(0,bS.jsx)(Ct,{...f,ref:b})})}),Cq=bT.default.forwardRef((a,b)=>{let{value:c,defaultValue:d,onValueChange:e=()=>{},...f}=a,[g,h]=(0,Bc.useControllableState)({prop:c,defaultProp:d??[],onChange:e,caller:Ci}),i=bT.default.useCallback(a=>h((b=[])=>[...b,a]),[h]),j=bT.default.useCallback(a=>h((b=[])=>b.filter(b=>b!==a)),[h]);return(0,bS.jsx)(Cn,{scope:a.__scopeToggleGroup,type:"multiple",value:g,onItemActivate:i,onItemDeactivate:j,children:(0,bS.jsx)(Ct,{...f,ref:b})})});Cm.displayName=Ci;var[Cr,Cs]=Cj(Ci),Ct=bT.default.forwardRef((a,b)=>{let{__scopeToggleGroup:c,disabled:d=!1,rovingFocus:e=!0,orientation:f,dir:g,loop:h=!0,...i}=a,j=Cl(c),k=(0,Ch.useDirection)(g),l={role:"group",dir:k,...i};return(0,bS.jsx)(Cr,{scope:c,rovingFocus:e,disabled:d,children:e?(0,bS.jsx)(B_.Root,{asChild:!0,...j,orientation:f,dir:k,loop:h,children:(0,bS.jsx)(Cb.div,{...l,ref:b})}):(0,bS.jsx)(Cb.div,{...l,ref:b})})}),Cu="ToggleGroupItem",Cv=bT.default.forwardRef((a,b)=>{let c=Co(Cu,a.__scopeToggleGroup),d=Cs(Cu,a.__scopeToggleGroup),e=Cl(a.__scopeToggleGroup),f=c.value.includes(a.value),g=d.disabled||a.disabled,h={...a,pressed:f,disabled:g},i=bT.default.useRef(null);return d.rovingFocus?(0,bS.jsx)(B_.Item,{asChild:!0,...e,focusable:!g,active:f,ref:i,children:(0,bS.jsx)(Cw,{...h,ref:b})}):(0,bS.jsx)(Cw,{...h,ref:b})});Cv.displayName=Cu;var Cw=bT.default.forwardRef((a,b)=>{let{__scopeToggleGroup:c,value:d,...e}=a,f=Co(Cu,c),g={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},h="single"===f.type?g:void 0;return(0,bS.jsx)(Cg,{...h,...e,ref:b,onPressedChange:a=>{a?f.onItemActivate(d):f.onItemDeactivate(d)}})}),Cx="Toolbar",[Cy,Cz]=function(a,b=[]){let c=[],d=()=>{let b=c.map(a=>bT.createContext(a));return function(c){let d=c?.[a]||b;return bT.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=bT.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=bT.useMemo(()=>g,Object.values(g));return(0,bS.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=bT.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return bT.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}(Cx,[B_.createRovingFocusGroupScope,Ck]),CA=(0,B_.createRovingFocusGroupScope)(),CB=Ck(),[CC,CD]=Cy(Cx),CE=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,orientation:d="horizontal",dir:e,loop:f=!0,...g}=a,h=CA(c),i=(0,Ch.useDirection)(e);return(0,bS.jsx)(CC,{scope:c,orientation:d,dir:i,children:(0,bS.jsx)(B_.Root,{asChild:!0,...h,orientation:d,dir:i,loop:f,children:(0,bS.jsx)(B2.div,{role:"toolbar","aria-orientation":d,dir:i,...g,ref:b})})})});CE.displayName=Cx;var CF="ToolbarSeparator",CG=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=CD(CF,c);return(0,bS.jsx)(B8,{orientation:"horizontal"===e.orientation?"vertical":"horizontal",...d,ref:b})});CG.displayName=CF;var CH=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=CA(c);return(0,bS.jsx)(B_.Item,{asChild:!0,...e,focusable:!a.disabled,children:(0,bS.jsx)(B2.button,{type:"button",...d,ref:b})})});CH.displayName="ToolbarButton";var CI=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=CA(c);return(0,bS.jsx)(B_.Item,{asChild:!0,...e,focusable:!0,children:(0,bS.jsx)(B2.a,{...d,ref:b,onKeyDown:(0,A5.composeEventHandlers)(a.onKeyDown,a=>{" "===a.key&&a.currentTarget.click()})})})});CI.displayName="ToolbarLink";var CJ="ToolbarToggleGroup",CK=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=CD(CJ,c),f=CB(c);return(0,bS.jsx)(Cm,{"data-orientation":e.orientation,dir:e.dir,...f,...d,ref:b,rovingFocus:!1})});CK.displayName=CJ;var CL=bT.forwardRef((a,b)=>{let{__scopeToolbar:c,...d}=a,e=CB(c),f={__scopeToolbar:a.__scopeToolbar};return(0,bS.jsx)(CH,{asChild:!0,...f,children:(0,bS.jsx)(Cv,{...e,...d,ref:b})})});CL.displayName="ToolbarToggleItem",a.s(["Button",()=>CH,"Link",()=>CI,"Root",()=>CE,"Separator",()=>CG,"ToggleGroup",()=>CK,"ToggleItem",()=>CL,"Toolbar",()=>CE,"ToolbarButton",()=>CH,"ToolbarLink",()=>CI,"ToolbarSeparator",()=>CG,"ToolbarToggleGroup",()=>CK,"ToolbarToggleItem",()=>CL,"createToolbarScope",()=>Cz],249114);var CM=a.i(249114),CM=CM;function CN(a){var b;let c,d=(b=a,(c=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${b}.SlotClone`,c),e=bT.forwardRef((a,b)=>{let{children:c,...e}=a,f=bT.Children.toArray(c),g=f.find(CS);if(g){let a=g.props.children,c=f.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(d,{...e,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(d,{...e,ref:b,children:c})});return e.displayName=`${a}.Slot`,e}var CO=CN("Slot"),CP=Symbol("radix.slottable");function CQ(a){let b=({children:a})=>(0,bS.jsx)(bS.Fragment,{children:a});return b.displayName=`${a}.Slottable`,b.__radixId=CP,b}var CR=CQ("Slottable");function CS(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===CP}a.s(["Root",()=>CO,"Slot",()=>CO,"Slottable",()=>CR,"createSlot",()=>CN,"createSlottable",()=>CQ],123652);var CT=a.i(123652),CT=CT;let CU=(0,bT.createContext)({orientation:"horizontal",tooltipSide:"bottom"});function CV({children:a,orientation:b,tooltipSide:c}){let d=CW(),e=c??(b===d.orientation?d.tooltipSide:"horizontal"===b?"bottom":"right");return(0,bS.jsx)(CU.Provider,{value:{orientation:b,tooltipSide:e},children:a})}function CW(){return(0,bT.useContext)(CU)}let CX=(0,bT.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?CT.Root:"div";return(0,bS.jsx)(CV,{orientation:"horizontal",tooltipSide:c,children:(0,bS.jsx)(f,{ref:e,className:(0,jb.default)("tlui-row",b),...d})})}),CY=(0,bT.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?CT.Root:"div";return(0,bS.jsx)(CV,{orientation:"vertical",tooltipSide:c,children:(0,bS.jsx)(f,{ref:e,className:(0,jb.default)("tlui-column",b),...d})})}),CZ=(0,bT.forwardRef)(({asChild:a,className:b,tooltipSide:c,...d},e)=>{let f=a?CT.Root:"div";return(0,bS.jsx)(CV,{orientation:"horizontal",tooltipSide:c,children:(0,bS.jsx)(f,{ref:e,className:(0,jb.default)("tlui-grid",b),...d})})});var C$=a.i(853859),C$=C$;class C_{static instance=null;state=d$("tooltip state",{name:"idle"});static getInstance(){return C_.instance||(C_.instance=new C_),C_.instance}hideAllTooltips(){this.handleEvent({type:"hide_all"})}handleEvent(a){let b=this.state.get();switch(a.type){case"pointer_down":"waiting_to_hide"===b.name&&clearTimeout(b.timeoutId),this.state.set({name:"pointer_down"});break;case"pointer_up":"pointer_down"===b.name&&this.state.set({name:"idle"});break;case"show":if("pointer_down"===b.name)return;"waiting_to_hide"===b.name&&clearTimeout(b.timeoutId),this.state.set({name:"showing",tooltip:a.tooltip});break;case"hide":{let{tooltipId:c,editor:d,instant:e}=a;if("showing"===b.name&&b.tooltip.id===c)if(d&&!e){let a=d.timers.setTimeout(()=>{let a=this.state.get();"waiting_to_hide"===a.name&&a.tooltip.id===c&&this.state.set({name:"idle"})},300);this.state.set({name:"waiting_to_hide",tooltip:b.tooltip,timeoutId:a})}else this.state.set({name:"idle"});else"waiting_to_hide"===b.name&&b.tooltip.id===c&&e&&(clearTimeout(b.timeoutId),this.state.set({name:"idle"}));break}case"hide_all":if("waiting_to_hide"===b.name&&clearTimeout(b.timeoutId),"pointer_down"===b.name)return;this.state.set({name:"idle"})}}getCurrentTooltipData(){let a=this.state.get(),b=null;return("showing"===a.name?b=a.tooltip:"waiting_to_hide"===a.name&&(b=a.tooltip),b&&(!jc.get().isCoarsePointer||b.showOnMobile))?b:null}}let C0=C_.getInstance();function C1(){C0.hideAllTooltips()}let C2=(0,bT.createContext)(!1);function C3({children:a}){return(0,bS.jsx)(C$.Provider,{skipDelayDuration:700,children:(0,bS.jsxs)(C2.Provider,{value:!0,children:[a,(0,bS.jsx)(C4,{})]})})}function C4(){let[a,b]=(0,bT.useState)(!1),c=(0,bT.useRef)(null),d=(0,bT.useRef)(!0),e=jB(),f=d8("current tooltip",()=>C0.getCurrentTooltipData(),[]),g=d8("camera state",()=>e?.getCameraState(),[e]);return((0,bT.useEffect)(()=>{"moving"===g&&a&&f&&C0.handleEvent({type:"hide",tooltipId:f.id,editor:e,instant:!0})},[g,a,f,e]),(0,bT.useEffect)(()=>{function b(b){"Escape"===b.key&&f&&a&&(C1(),b.stopPropagation())}return document.addEventListener("keydown",b,{capture:!0}),()=>{document.removeEventListener("keydown",b,{capture:!0})}},[f,a]),(0,bT.useEffect)(()=>{function a(){C0.handleEvent({type:"pointer_down"})}function b(){C0.handleEvent({type:"pointer_up"})}return document.addEventListener("pointerdown",a,{capture:!0}),document.addEventListener("pointerup",b,{capture:!0}),document.addEventListener("pointercancel",b,{capture:!0}),()=>{document.removeEventListener("pointerdown",a,{capture:!0}),document.removeEventListener("pointerup",b,{capture:!0}),document.removeEventListener("pointercancel",b,{capture:!0}),C0.handleEvent({type:"pointer_up"})}},[]),(0,bT.useEffect)(()=>{let a=null;if(f&&c.current){let e=f.targetElement.getBoundingClientRect(),g=c.current;g.style.position="fixed",g.style.left=`${e.left}px`,g.style.top=`${e.top}px`,g.style.width=`${e.width}px`,g.style.height=`${e.height}px`,g.style.pointerEvents="none",g.style.zIndex="9999",d.current?a=setTimeout(()=>{b(!0),d.current=!1},f.delayDuration):b(!0)}else b(!1),d.current=!0;return()=>{null!==a&&clearTimeout(a)}},[f]),f)?(0,bS.jsxs)(C$.Root,{open:a,delayDuration:0,children:[(0,bS.jsx)(C$.Trigger,{asChild:!0,children:(0,bS.jsx)("div",{ref:c})}),(0,bS.jsxs)(C$.Content,{className:"tlui-tooltip",side:f.side,sideOffset:f.sideOffset,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[f.content,(0,bS.jsx)(C$.Arrow,{className:"tlui-tooltip__arrow"})]})]}):null}let C5=(0,bT.forwardRef)(({children:a,content:b,side:c,sideOffset:d=5,disabled:e=!1,showOnMobile:f=!1,delayDuration:g},h)=>{let i,j=jB(),k=(0,bT.useRef)(cs(void 0)),l=(0,bT.useContext)(C2),m=d8("enhancedA11yMode",()=>j?.user.getEnhancedA11yMode(),[j]),n=CW(),o=c??n.tooltipSide;if((0,bT.useEffect)(()=>{let a=k.current;return()=>{l&&C0.handleEvent({type:"hide",tooltipId:a,editor:j,instant:!0})}},[j,l]),e||!b)return(0,bS.jsx)(bS.Fragment,{children:a});if(i=m?0:g??(j?.options.tooltipDelayMs||700),!l||m)return(0,bS.jsxs)(C$.Root,{delayDuration:i,disableHoverableContent:!m,children:[(0,bS.jsx)(C$.Trigger,{asChild:!0,ref:h,children:a}),(0,bS.jsxs)(C$.Content,{className:"tlui-tooltip",side:o,sideOffset:d,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[b,(0,bS.jsx)(C$.Arrow,{className:"tlui-tooltip__arrow"})]})]});let p=bT.default.Children.only(a);return cd(bT.default.isValidElement(p),"TldrawUiTooltip children must be a single element"),bT.default.cloneElement(p,{onMouseEnter:a=>{p.props.onMouseEnter?.(a),C0.handleEvent({type:"show",tooltip:{id:k.current,content:b,targetElement:a.currentTarget,side:o,sideOffset:d,showOnMobile:f,delayDuration:i}})},onMouseLeave:a=>{p.props.onMouseLeave?.(a),C0.handleEvent({type:"hide",tooltipId:k.current,editor:j,instant:!1})},onFocus:a=>{p.props.onFocus?.(a),C0.handleEvent({type:"show",tooltip:{id:k.current,content:b,targetElement:a.currentTarget,side:o,sideOffset:d,showOnMobile:f,delayDuration:i}})},onBlur:a=>{p.props.onBlur?.(a),C0.handleEvent({type:"hide",tooltipId:k.current,editor:j,instant:!1})}})}),C6={horizontal:CX,vertical:CY,grid:CZ},C7=bT.default.forwardRef(({children:a,className:b,label:c,orientation:d="horizontal",tooltipSide:e,...f},g)=>{let h=C6[d];return(0,bS.jsx)(h,{asChild:!0,tooltipSide:e,children:(0,bS.jsx)(CM.Root,{ref:g,...f,className:(0,jb.default)("tlui-toolbar",b),"aria-label":c,orientation:"grid"===d?"horizontal":d,children:a})})}),C8=bT.default.forwardRef(({asChild:a,children:b,type:c,isActive:d,tooltip:e,...f},g)=>{let h=(0,bS.jsx)(CM.Button,{ref:g,asChild:a,draggable:!1,"data-isactive":d,...f,"aria-label":f.title,title:void 0,className:(0,jb.default)("tlui-button",`tlui-button__${c}`,f.className),children:b}),i=e||f.title;return(0,bS.jsx)(C5,{content:i,children:h})}),C9=({children:a,className:b,type:c,asChild:d,...e})=>(0,bS.jsx)(CM.ToggleGroup,{asChild:d,type:c,...e,role:"radiogroup",className:(0,jb.default)("tlui-toolbar-toggle-group",b),children:a}),Da=({children:a,className:b,type:c,value:d,tooltip:e,...f})=>{let g=(0,bS.jsx)(CM.ToggleItem,{...f,title:void 0,className:(0,jb.default)("tlui-button",`tlui-button__${c}`,"tlui-toolbar-toggle-group-item",b),value:d,children:a}),h=e||f.title;return(0,bS.jsx)(C5,{content:h,children:g})};function Db({disabled:a=!1,spinner:b=!1,readonlyOk:c=!1,id:d,kbd:e,label:f,icon:g,iconLeft:h,onSelect:i,noClose:j,isSelected:k,onDragStart:l}){let{type:m,sourceId:n}=A2(),o=Am(),[p,q]=(0,bT.useState)(!1);if(BE()&&!c)return null;let r=Jo(f,m),s=e?BJ(e):void 0,t=r?o(r):void 0,u=t&&s?`${t} ${s}`:t;switch(m){case"menu":return(0,bS.jsx)(BY,{children:(0,bS.jsxs)(Ao,{type:"menu","data-testid":`${n}.${d}`,disabled:a,onClick:a=>{j&&jm(a),p?q(!1):i(n)},children:[h&&(0,bS.jsx)(AF,{icon:h,small:!0}),(0,bS.jsx)(AB,{children:t}),e&&(0,bS.jsx)(B$,{children:e})]})});case"context-menu":if(a)return null;return(0,bS.jsxs)(BD.Item,{dir:"ltr",draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${n}.${d}`,onSelect:a=>{j&&jm(a),p?q(!1):i(n)},children:[(0,bS.jsx)("span",{className:"tlui-button__label",draggable:!1,children:t}),h&&(0,bS.jsx)(AF,{icon:h,small:!0}),e&&(0,bS.jsx)(B$,{children:e}),b&&(0,bS.jsx)(BK,{})]});case"small-icons":case"icons":return(0,bS.jsx)(C8,{"data-testid":`${n}.${d}`,type:"icon",title:u,disabled:a,onClick:()=>i(n),children:(0,bS.jsx)(AF,{icon:g,small:!0})});case"keyboard-shortcuts":if(!e)return console.warn(`Menu item '${f}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null;return(0,bS.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${n}.${d}`,children:[(0,bS.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:t}),(0,bS.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,bS.jsx)(B$,{visibleOnMobileLayout:!0,children:e})})]});case"helper-buttons":return(0,bS.jsxs)(Ao,{type:"low","data-testid":`${n}.${d}`,onClick:()=>i(n),children:[(0,bS.jsx)(AF,{icon:g}),(0,bS.jsx)(AB,{children:t})]});case"toolbar":if(l)return(0,bS.jsx)(Dc,{id:d,icon:g,onSelect:i,onDragStart:l,labelStr:t,titleStr:u,disabled:a,isSelected:k});return(0,bS.jsx)(C8,{"aria-label":t,"aria-pressed":k?"true":"false","data-testid":`tools.${d}`,"data-value":d,disabled:a,onClick:()=>i("toolbar"),onTouchStart:a=>{jm(a),i("toolbar")},title:u,type:"tool",children:(0,bS.jsx)(AF,{icon:g})});case"toolbar-overflow":if(l)return(0,bS.jsx)(Dc,{id:d,icon:g,onSelect:i,onDragStart:l,labelStr:t,titleStr:u,disabled:a,isSelected:k,overflow:!0});return(0,bS.jsx)(C8,{"aria-label":t,"aria-pressed":k?"true":"false",isActive:k,"data-testid":`tools.more.${d}`,"data-value":d,disabled:a,onClick:()=>i("toolbar"),title:u,type:"icon",children:(0,bS.jsx)(AF,{icon:g})});default:throw cc(m)}}function Dc({id:a,labelStr:b,titleStr:c,disabled:d,isSelected:e,icon:f,onSelect:g,onDragStart:h,overflow:i}){let j,k=(j=jA(),(0,bT.useMemo)(()=>{let a={name:"idle"};return{onPointerDown:function(b){a={name:"pointing",screenSpaceStart:{x:b.clientX,y:b.clientY}},b.currentTarget.setPointerCapture(b.pointerId)},onPointerMove:function(b){if(!b.isSpecialRedispatchedEvent&&"pointing"===a.name&&iK.Dist2(a.screenSpaceStart,{x:b.clientX,y:b.clientY})>(j.getInstanceState().isCoarsePointer?j.options.uiCoarseDragDistanceSquared:j.options.uiDragDistanceSquared)){let c=a.screenSpaceStart;a={name:"dragging",screenSpaceStart:c},j.run(()=>{j.setCurrentTool("select"),j.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...js(j,b),point:c}),j.selectNone(),h?.("toolbar",{type:"pointer",target:"canvas",name:"pointer_move",...js(j,b),point:c}),C1(),j.getContainer().focus()})}},onPointerUp:function(a){a.isSpecialRedispatchedEvent||(a.currentTarget.releasePointerCapture(a.pointerId),j.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...js(j,a)}))},onClick:function(){if("dragging"===a.name||"dragged"===a.name)return a={name:"idle"},!0;a={name:"idle"},g?.("toolbar")}}},[h,j,g]));return i?(0,bS.jsx)(C8,{"aria-label":b,"aria-pressed":e?"true":"false",isActive:e,className:"tlui-button-grid__button","data-testid":`tools.more.${a}`,"data-value":a,disabled:d,title:c,type:"icon",...k,children:(0,bS.jsx)(AF,{icon:f})}):(0,bS.jsx)(C8,{"aria-label":b,"aria-pressed":e?"true":"false","data-testid":`tools.${a}`,"data-value":a,disabled:d,onTouchStart:a=>{jm(a),g("toolbar")},title:c,type:"tool",...k,children:(0,bS.jsx)(AF,{icon:f})})}function Dd({actionId:a="",...b}){let c=Jn()[a];return c?(0,bS.jsx)(Db,{...c,...b}):null}function De({id:a,label:b,className:c,children:d}){let e=A2(),{orientation:f}=CW(),g=Am(),h=Jo(b,e.type),i=h?g(h):void 0;switch(e.type){case"menu":return(0,bS.jsx)(BX,{className:c,"data-testid":`${e.sourceId}-group.${a}`,children:d});case"context-menu":return(0,bS.jsx)("div",{dir:"ltr",className:(0,jb.default)("tlui-menu__group",c),"data-testid":`${e.sourceId}-group.${a}`,children:d});case"keyboard-shortcuts":return(0,bS.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${e.sourceId}-group.${a}`,children:[(0,bS.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:i}),(0,bS.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:d})]});case"toolbar":return(0,bS.jsx)("horizontal"===f?CX:CY,{className:"tlui-main-toolbar__group","data-testid":`${e.sourceId}-group.${a}`,children:d});case"toolbar-overflow":return(0,bS.jsx)(CZ,{className:"tlui-main-toolbar__group","data-testid":`${e.sourceId}-group.${a}`,children:d});default:return d}}let Df=(0,bT.createContext)(null);function Dg({context:a,children:b}){let c=(0,bT.useContext)(Df),d=BP(),e=d4("dialogs",[]),f=(0,bT.useMemo)(()=>({dialogs:e,addDialog(b){let c=b.id??cs(void 0);return e.update(a=>[...a.filter(a=>a.id!==b.id),{...b,id:c}]),d("open-menu",{source:"dialog",id:c}),mi.addOpenMenu(c,a),c},removeDialog(b){let c=e.get().find(a=>a.id===b);return c&&(c.onClose?.(),d("close-menu",{source:"dialog",id:b}),mi.deleteOpenMenu(b,a),e.update(a=>a.filter(a=>a!==c))),b},clearDialogs(){let b=e.get();0!==b.length&&(b.forEach(b=>{b.onClose?.(),d("close-menu",{source:"dialog",id:b.id}),mi.deleteOpenMenu(b.id,a)}),e.set([]))}}),[d,e,a]);return c?(0,bS.jsx)(bS.Fragment,{children:b}):(0,bS.jsx)(Df.Provider,{value:f,children:b})}function Dh(){let a=(0,bT.useContext)(Df);if(!a)throw Error("useDialogs must be used within a DialogsProvider");return a}var Di=a.i(680265),Dj=a.i(377586),Dk=a.i(534452),Dl=a.i(594721),Dm=Symbol("radix.slottable");function Dn(a){return bT.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===Dm}var Do=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{var c,d;let e,f,g,h=(d=c=`Primitive.${b}`,(e=bT.forwardRef((a,b)=>{let{children:c,...d}=a;if(bT.isValidElement(c)){var e;let a,f,g=(e=c,(f=(a=Object.getOwnPropertyDescriptor(e.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.ref:(f=(a=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?e.props.ref:e.props.ref||e.ref),h=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==bT.Fragment&&(h.ref=b?(0,A6.composeRefs)(b,g):g),bT.cloneElement(c,h)}return bT.Children.count(c)>1?bT.Children.only(null):null})).displayName=`${d}.SlotClone`,f=e,(g=bT.forwardRef((a,b)=>{let{children:c,...d}=a,e=bT.Children.toArray(c),g=e.find(Dn);if(g){let a=g.props.children,c=e.map(b=>b!==g?b:bT.Children.count(a)>1?bT.Children.only(null):bT.isValidElement(a)?a.props.children:null);return(0,bS.jsx)(f,{...d,ref:b,children:bT.isValidElement(a)?bT.cloneElement(a,void 0,c):null})}return(0,bS.jsx)(f,{...d,ref:b,children:c})})).displayName=`${c}.Slot`,g),i=bT.forwardRef((a,c)=>{let{asChild:d,...e}=a;return(0,bS.jsx)(d?h:b,{...e,ref:c})});return i.displayName=`Primitive.${b}`,{...a,[b]:i}},{}),Dp=a.i(806462),Dq=a.i(854931),Dr="ToastProvider",[Ds,Dt,Du]=(0,Di.createCollection)("Toast"),[Dv,Dw]=function(a,b=[]){let c=[],d=()=>{let b=c.map(a=>bT.createContext(a));return function(c){let d=c?.[a]||b;return bT.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return d.scopeName=a,[function(b,d){let e=bT.createContext(d),f=c.length;c=[...c,d];let g=b=>{let{scope:c,children:d,...g}=b,h=c?.[a]?.[f]||e,i=bT.useMemo(()=>g,Object.values(g));return(0,bS.jsx)(h.Provider,{value:i,children:d})};return g.displayName=b+"Provider",[g,function(c,g){let h=g?.[a]?.[f]||e,i=bT.useContext(h);if(i)return i;if(void 0!==d)return d;throw Error(`\`${c}\` must be used within \`${b}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return bT.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(d,...b)]}("Toast",[Du]),[Dx,Dy]=Dv(Dr),Dz=a=>{let{__scopeToast:b,label:c="Notification",duration:d=5e3,swipeDirection:e="right",swipeThreshold:f=50,children:g}=a,[h,i]=bT.useState(null),[j,k]=bT.useState(0),l=bT.useRef(!1),m=bT.useRef(!1);return c.trim()||console.error(`Invalid prop \`label\` supplied to \`${Dr}\`. Expected non-empty \`string\`.`),(0,bS.jsx)(Ds.Provider,{scope:b,children:(0,bS.jsx)(Dx,{scope:b,label:c,duration:d,swipeDirection:e,swipeThreshold:f,toastCount:j,viewport:h,onViewportChange:i,onToastAdd:bT.useCallback(()=>k(a=>a+1),[]),onToastRemove:bT.useCallback(()=>k(a=>a-1),[]),isFocusedToastEscapeKeyDownRef:l,isClosePausedRef:m,children:g})})};Dz.displayName=Dr;var DA="ToastViewport",DB=["F8"],DC="toast.viewportPause",DD="toast.viewportResume",DE=bT.forwardRef((a,b)=>{let{__scopeToast:c,hotkey:d=DB,label:e="Notifications ({hotkey})",...f}=a,g=Dy(DA,c),h=Dt(c),i=bT.useRef(null),j=bT.useRef(null),k=bT.useRef(null),l=bT.useRef(null),m=(0,A6.useComposedRefs)(b,l,g.onViewportChange),n=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),o=g.toastCount>0;bT.useEffect(()=>{let a=a=>{0!==d.length&&d.every(b=>a[b]||a.code===b)&&l.current?.focus()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[d]),bT.useEffect(()=>{let a=i.current,b=l.current;if(o&&a&&b){let c=()=>{if(!g.isClosePausedRef.current){let a=new CustomEvent(DC);b.dispatchEvent(a),g.isClosePausedRef.current=!0}},d=()=>{if(g.isClosePausedRef.current){let a=new CustomEvent(DD);b.dispatchEvent(a),g.isClosePausedRef.current=!1}},e=b=>{a.contains(b.relatedTarget)||d()},f=()=>{a.contains(document.activeElement)||d()};return a.addEventListener("focusin",c),a.addEventListener("focusout",e),a.addEventListener("pointermove",c),a.addEventListener("pointerleave",f),window.addEventListener("blur",c),window.addEventListener("focus",d),()=>{a.removeEventListener("focusin",c),a.removeEventListener("focusout",e),a.removeEventListener("pointermove",c),a.removeEventListener("pointerleave",f),window.removeEventListener("blur",c),window.removeEventListener("focus",d)}}},[o,g.isClosePausedRef]);let p=bT.useCallback(({tabbingDirection:a})=>{let b=h().map(b=>{let c=b.ref.current,d=[c,...function(a){let b=[],c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{let b="INPUT"===a.tagName&&"hidden"===a.type;return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)b.push(c.currentNode);return b}(c)];return"forwards"===a?d:d.reverse()});return("forwards"===a?b.reverse():b).flat()},[h]);return bT.useEffect(()=>{let a=l.current;if(a){let b=b=>{let c=b.altKey||b.ctrlKey||b.metaKey;if("Tab"===b.key&&!c){let c=document.activeElement,d=b.shiftKey;if(b.target===a&&d)return void j.current?.focus();let e=p({tabbingDirection:d?"backwards":"forwards"}),f=e.findIndex(a=>a===c);DW(e.slice(f+1))?b.preventDefault():d?j.current?.focus():k.current?.focus()}};return a.addEventListener("keydown",b),()=>a.removeEventListener("keydown",b)}},[h,p]),(0,bS.jsxs)(Dj.Branch,{ref:i,role:"region","aria-label":e.replace("{hotkey}",n),tabIndex:-1,style:{pointerEvents:o?void 0:"none"},children:[o&&(0,bS.jsx)(DG,{ref:j,onFocusFromOutsideViewport:()=>{DW(p({tabbingDirection:"forwards"}))}}),(0,bS.jsx)(Ds.Slot,{scope:c,children:(0,bS.jsx)(Do.ol,{tabIndex:-1,...f,ref:m})}),o&&(0,bS.jsx)(DG,{ref:k,onFocusFromOutsideViewport:()=>{DW(p({tabbingDirection:"backwards"}))}})]})});DE.displayName=DA;var DF="ToastFocusProxy",DG=bT.forwardRef((a,b)=>{let{__scopeToast:c,onFocusFromOutsideViewport:d,...e}=a,f=Dy(DF,c);return(0,bS.jsx)(Dq.VisuallyHidden,{tabIndex:0,...e,ref:b,style:{position:"fixed"},onFocus:a=>{let b=a.relatedTarget;f.viewport?.contains(b)||d()}})});DG.displayName=DF;var DH="Toast",DI=bT.forwardRef((a,b)=>{let{forceMount:c,open:d,defaultOpen:e,onOpenChange:f,...g}=a,[h,i]=(0,Bc.useControllableState)({prop:d,defaultProp:e??!0,onChange:f,caller:DH});return(0,bS.jsx)(Dl.Presence,{present:c||h,children:(0,bS.jsx)(DL,{open:h,...g,ref:b,onClose:()=>i(!1),onPause:(0,Bb.useCallbackRef)(a.onPause),onResume:(0,Bb.useCallbackRef)(a.onResume),onSwipeStart:(0,A5.composeEventHandlers)(a.onSwipeStart,a=>{a.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:(0,A5.composeEventHandlers)(a.onSwipeMove,a=>{let{x:b,y:c}=a.detail.delta;a.currentTarget.setAttribute("data-swipe","move"),a.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${b}px`),a.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${c}px`)}),onSwipeCancel:(0,A5.composeEventHandlers)(a.onSwipeCancel,a=>{a.currentTarget.setAttribute("data-swipe","cancel"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),a.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:(0,A5.composeEventHandlers)(a.onSwipeEnd,a=>{let{x:b,y:c}=a.detail.delta;a.currentTarget.setAttribute("data-swipe","end"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),a.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),a.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${b}px`),a.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${c}px`),i(!1)})})})});DI.displayName=DH;var[DJ,DK]=Dv(DH,{onClose(){}}),DL=bT.forwardRef((a,b)=>{let{__scopeToast:c,type:d="foreground",duration:e,open:f,onClose:g,onEscapeKeyDown:h,onPause:i,onResume:j,onSwipeStart:k,onSwipeMove:l,onSwipeCancel:m,onSwipeEnd:n,...o}=a,p=Dy(DH,c),[q,r]=bT.useState(null),s=(0,A6.useComposedRefs)(b,a=>r(a)),t=bT.useRef(null),u=bT.useRef(null),v=e||p.duration,w=bT.useRef(0),y=bT.useRef(v),z=bT.useRef(0),{onToastAdd:A,onToastRemove:B}=p,C=(0,Bb.useCallbackRef)(()=>{q?.contains(document.activeElement)&&p.viewport?.focus(),g()}),D=bT.useCallback(a=>{a&&a!==1/0&&(window.clearTimeout(z.current),w.current=new Date().getTime(),z.current=window.setTimeout(C,a))},[C]);bT.useEffect(()=>{let a=p.viewport;if(a){let b=()=>{D(y.current),j?.()},c=()=>{let a=new Date().getTime()-w.current;y.current=y.current-a,window.clearTimeout(z.current),i?.()};return a.addEventListener(DC,c),a.addEventListener(DD,b),()=>{a.removeEventListener(DC,c),a.removeEventListener(DD,b)}}},[p.viewport,v,i,j,D]),bT.useEffect(()=>{f&&!p.isClosePausedRef.current&&D(v)},[f,v,p.isClosePausedRef,D]),bT.useEffect(()=>(A(),()=>B()),[A,B]);let E=bT.useMemo(()=>q?function a(b){let c=[];return Array.from(b.childNodes).forEach(b=>{var d;if(b.nodeType===b.TEXT_NODE&&b.textContent&&c.push(b.textContent),(d=b).nodeType===d.ELEMENT_NODE){let d=b.ariaHidden||b.hidden||"none"===b.style.display,e=""===b.dataset.radixToastAnnounceExclude;if(!d)if(e){let a=b.dataset.radixToastAnnounceAlt;a&&c.push(a)}else c.push(...a(b))}}),c}(q):null,[q]);return p.viewport?(0,bS.jsxs)(bS.Fragment,{children:[E&&(0,bS.jsx)(DM,{__scopeToast:c,role:"status","aria-live":"foreground"===d?"assertive":"polite",children:E}),(0,bS.jsx)(DJ,{scope:c,onClose:C,children:kU.createPortal((0,bS.jsx)(Ds.ItemSlot,{scope:c,children:(0,bS.jsx)(Dj.Root,{asChild:!0,onEscapeKeyDown:(0,A5.composeEventHandlers)(h,()=>{p.isFocusedToastEscapeKeyDownRef.current||C(),p.isFocusedToastEscapeKeyDownRef.current=!1}),children:(0,bS.jsx)(Do.li,{tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":p.swipeDirection,...o,ref:s,style:{userSelect:"none",touchAction:"none",...a.style},onKeyDown:(0,A5.composeEventHandlers)(a.onKeyDown,a=>{"Escape"===a.key&&(h?.(a.nativeEvent),a.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,C()))}),onPointerDown:(0,A5.composeEventHandlers)(a.onPointerDown,a=>{0===a.button&&(t.current={x:a.clientX,y:a.clientY})}),onPointerMove:(0,A5.composeEventHandlers)(a.onPointerMove,a=>{if(!t.current)return;let b=a.clientX-t.current.x,c=a.clientY-t.current.y,d=!!u.current,e=["left","right"].includes(p.swipeDirection),f=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,g=e?f(0,b):0,h=e?0:f(0,c),i="touch"===a.pointerType?10:2,j={x:g,y:h},m={originalEvent:a,delta:j};d?(u.current=j,DU("toast.swipeMove",l,m,{discrete:!1})):DV(j,p.swipeDirection,i)?(u.current=j,DU("toast.swipeStart",k,m,{discrete:!1}),a.target.setPointerCapture(a.pointerId)):(Math.abs(b)>i||Math.abs(c)>i)&&(t.current=null)}),onPointerUp:(0,A5.composeEventHandlers)(a.onPointerUp,a=>{let b=u.current,c=a.target;if(c.hasPointerCapture(a.pointerId)&&c.releasePointerCapture(a.pointerId),u.current=null,t.current=null,b){let c=a.currentTarget,d={originalEvent:a,delta:b};DV(b,p.swipeDirection,p.swipeThreshold)?DU("toast.swipeEnd",n,d,{discrete:!0}):DU("toast.swipeCancel",m,d,{discrete:!0}),c.addEventListener("click",a=>a.preventDefault(),{once:!0})}})})})}),p.viewport)})]}):null}),DM=a=>{let{__scopeToast:b,children:c,...d}=a,e=Dy(DH,b),[f,g]=bT.useState(!1),[h,i]=bT.useState(!1);return function(a=()=>{}){let b=(0,Bb.useCallbackRef)(a);(0,Dp.useLayoutEffect)(()=>{let a=0,c=0;return a=window.requestAnimationFrame(()=>c=window.requestAnimationFrame(b)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(c)}},[b])}(()=>g(!0)),bT.useEffect(()=>{let a=window.setTimeout(()=>i(!0),1e3);return()=>window.clearTimeout(a)},[]),h?null:(0,bS.jsx)(Dk.Portal,{asChild:!0,children:(0,bS.jsx)(Dq.VisuallyHidden,{...d,children:f&&(0,bS.jsxs)(bS.Fragment,{children:[e.label," ",c]})})})},DN=bT.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a;return(0,bS.jsx)(Do.div,{...d,ref:b})});DN.displayName="ToastTitle";var DO=bT.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a;return(0,bS.jsx)(Do.div,{...d,ref:b})});DO.displayName="ToastDescription";var DP="ToastAction",DQ=bT.forwardRef((a,b)=>{let{altText:c,...d}=a;return c.trim()?(0,bS.jsx)(DT,{altText:c,asChild:!0,children:(0,bS.jsx)(DS,{...d,ref:b})}):(console.error(`Invalid prop \`altText\` supplied to \`${DP}\`. Expected non-empty \`string\`.`),null)});DQ.displayName=DP;var DR="ToastClose",DS=bT.forwardRef((a,b)=>{let{__scopeToast:c,...d}=a,e=DK(DR,c);return(0,bS.jsx)(DT,{asChild:!0,children:(0,bS.jsx)(Do.button,{type:"button",...d,ref:b,onClick:(0,A5.composeEventHandlers)(a.onClick,e.onClose)})})});DS.displayName=DR;var DT=bT.forwardRef((a,b)=>{let{__scopeToast:c,altText:d,...e}=a;return(0,bS.jsx)(Do.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...e,ref:b})});function DU(a,b,c,{discrete:d}){let e=c.originalEvent.currentTarget,f=new CustomEvent(a,{bubbles:!0,cancelable:!0,detail:c});if(b&&e.addEventListener(a,b,{once:!0}),d)e&&kU.flushSync(()=>e.dispatchEvent(f));else e.dispatchEvent(f)}var DV=(a,b,c=0)=>{let d=Math.abs(a.x),e=Math.abs(a.y),f=d>e;return"left"===b||"right"===b?f&&d>c:!f&&e>c};function DW(a){let b=document.activeElement;return a.some(a=>a===b||(a.focus(),document.activeElement!==b))}a.s(["Action",()=>DQ,"Close",()=>DS,"Description",()=>DO,"Provider",()=>Dz,"Root",()=>DI,"Title",()=>DN,"Toast",()=>DI,"ToastAction",()=>DQ,"ToastClose",()=>DS,"ToastDescription",()=>DO,"ToastProvider",()=>Dz,"ToastTitle",()=>DN,"ToastViewport",()=>DE,"Viewport",()=>DE,"createToastScope",()=>Dw],520828);var DX=a.i(520828),DX=DX;let DY=(0,bT.createContext)(null);function DZ({children:a}){let b=d4("toasts",[]),c=(0,bT.useContext)(DY),d=(0,bT.useMemo)(()=>({toasts:b,addToast(a){let c=a.id??cs(void 0);return b.update(b=>[...b.filter(b=>b.id!==a.id),{...a,id:c}]),c},removeToast:a=>(b.update(b=>b.filter(b=>b.id!==a)),a),clearToasts(){b.set([])}}),[b]);return c?(0,bS.jsx)(bS.Fragment,{children:a}):(0,bS.jsx)(DX.Provider,{children:(0,bS.jsx)(DY.Provider,{value:d,children:a})})}function D$(){let a=(0,bT.useContext)(DY);if(!a)throw Error("useToasts must be used within a ToastsProvider");return a}function D_(a){return new Promise(b=>{let{allowMultiple:c=!0,mimeTypes:d=[]}=a||{},e=document.createElement("input");function f(){e.removeEventListener("change",g),e.removeEventListener("cancel",h),e.remove()}async function g(a){let c=a.target.files;if(!c||0===c.length){b([]),f();return}let d=Array.from(c);e.value="",b(d),f()}function h(){b([]),f()}e.type="file",e.accept=d?.join(","),e.multiple=c,e.style.display="none",document.body.appendChild(e),e.addEventListener("cancel",h),e.addEventListener("change",g),e?.click()})}var D0=a.i(238005);let D1="web image/vnd.tldraw+png",D2={png:D1},D3={[D1]:"image/png"};async function D4(a,b,c,d){let e=b.map(a=>a instanceof File?a:new File([a],"tldrawFile",{type:a.type}));a.markHistoryStoppingPoint("paste"),await a.putExternalContent({type:"files",files:e,point:c,sources:d})}async function D5(a,b,c,d){return a.markHistoryStoppingPoint("paste"),await a.putExternalContent({type:"url",point:c,url:b,sources:d})}let D6=[D1,"image/png","image/jpeg","image/webp","image/svg+xml"];function D7(a){let b=document.implementation.createHTMLDocument("");return b.documentElement.innerHTML=a.trim(),b.body.textContent||b.body.innerText||""}let D8=["input","select","textarea"];function D9(a){let{activeElement:b}=document;return a.menus.hasAnyOpenMenus()||b&&(b.isContentEditable||D8.indexOf(b.tagName.toLowerCase())>-1)}let Ea=(a,b,c,d)=>{let e=(a=>{let b=a.split(/[\n\s]/);for(let a of b)try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)return}catch{return}return rN(b)})(b);if(e)for(let b of e)D5(a,b,c);else if((a=>{try{let b=new URL(a);return"http:"===b.protocol||"https:"===b.protocol}catch{return!1}})(b))D5(a,b,c);else/^<svg/.test(b)?(a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"svg-text",text:b,point:c,sources:d})):(a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"text",text:b,point:c,sources:d}))},Eb=async(a,b,c)=>{if(null!==a.getEditingShapeId())return;if(!b)throw Error("No clipboard data");let d=[];for(let a of Object.values(b.items))switch(a.kind){case"file":d.push({type:"file",source:new Promise(b=>b(a.getAsFile()))});break;case"string":"text/html"===a.type?d.push({type:"html",source:new Promise(b=>a.getAsString(b))}):"text/plain"===a.type?d.push({type:"text",source:new Promise(b=>a.getAsString(b))}):d.push({type:a.type,source:new Promise(b=>a.getAsString(b))})}Ed(a,d,c)},Ec=async({editor:a,clipboardItems:b,point:c,fallbackFiles:d})=>{let e=[];for(let a of b){for(let b of D6)if(a.types.includes(b)){let c=a.getType(b).then(a=>co.rewriteMimeType(a,cF(D3,b)??b));e.push({type:"blob",source:c});break}a.types.includes("text/html")&&e.push({type:"html",source:(async()=>{let b=await a.getType("text/html");return await co.blobToText(b)})()}),a.types.includes("text/uri-list")&&e.push({type:"url",source:(async()=>{let b=await a.getType("text/uri-list");return await co.blobToText(b)})()}),a.types.includes("text/plain")&&e.push({type:"text",source:(async()=>{let b=await a.getType("text/plain");return await co.blobToText(b)})()})}return d?.length&&1===e.length&&"text"===e[0].type?(e.pop(),e.push(...d.map(a=>({type:"file",source:Promise.resolve(a)})))):d?.length&&0===e.length&&e.push(...d.map(a=>({type:"file",source:Promise.resolve(a)}))),await Ed(a,e,c)};async function Ed(a,b,c){let d=b.filter(a=>("file"===a.type||"blob"===a.type)&&null!==a.source);if(d.length){if(d.length>a.options.maxFilesAtOnce)throw Error("Too many files");let b=b4(await Promise.all(d.map(a=>a.source)));return await D4(a,b,c)}let e=await Promise.all(b.filter(a=>"file"!==a.type).map(a=>new Promise(b=>{"file"===a.type?b({type:"error",data:null,reason:"unexpected file"}):a.source.then(c=>{let d=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(d)try{let a;try{a=JSON.parse(d)}catch{let c=D0.default.decompressFromBase64(d);if(null===c)return void b({type:"error",data:null,reason:"found tldraw data comment but could not parse"});a=JSON.parse(c)}if("application/tldraw"!==a.type)return void b({type:"error",data:a,reason:`found tldraw data comment but JSON was of a different type: ${a.type}`});if(3===a.version)try{let c=JSON.parse(D0.default.decompressFromBase64(a.data.otherCompressed)||"{}"),d={assets:a.data.assets||[],...c};b({type:"tldraw",data:d});return}catch(c){b({type:"error",data:a,reason:`failed to decompress version 2 clipboard data: ${c}`});return}if(2===a.version)b({type:"tldraw",data:a.data});else{if("string"==typeof a.data)return void b({type:"error",data:a,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});b({type:"tldraw",data:a.data});return}}catch{b({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===a.type)return void b({type:"text",data:c,subtype:"html"});if("url"===a.type)return void b({type:"text",data:c,subtype:"url"});try{let a=JSON.parse(c);if("excalidraw/clipboard"===a.type)return void b({type:"excalidraw",data:a});return void b({type:"text",data:c,subtype:"json"})}catch{b({type:"text",data:c,subtype:"text"});return}}b({type:"error",data:c,reason:"unhandled case"})})})));for(let b of e)if("tldraw"===b.type){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"tldraw",content:b.data,point:c});return}for(let b of e)if("excalidraw"===b.type){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"excalidraw",content:b.data,point:c});return}for(let b of e){if("text"===b.type&&"html"===b.subtype){let d=new DOMParser().parseFromString(b.data,"text/html").querySelector("body");if(d&&1===Array.from(d.children).filter(a=>1===a.nodeType).length&&d.firstElementChild&&"A"===d.firstElementChild.tagName&&d.firstElementChild.hasAttribute("href")&&""!==d.firstElementChild.getAttribute("href"))return void Ea(a,d.firstElementChild.getAttribute("href"),c,e);if(!e.some(a=>"text"===a.type&&"html"!==a.subtype)&&b.data.trim()&&D7(b.data))return void Ea(a,D7(b.data),c,e);if(e.some(a=>"text"===a.type&&"html"!==a.subtype)){let d=D7(b.data)??"";if(d){a.markHistoryStoppingPoint("paste"),a.putExternalContent({type:"text",text:d,html:b.data,point:c,sources:e});return}}}if("text"===b.type&&"text"===b.subtype&&b.data.startsWith("<iframe ")){let d=new DOMParser().parseFromString(b.data,"text/html").querySelector("body");if(d&&1===Array.from(d.children).filter(a=>1===a.nodeType).length&&d.firstElementChild&&"IFRAME"===d.firstElementChild.tagName&&d.firstElementChild.hasAttribute("src")&&""!==d.firstElementChild.getAttribute("src"))return void Ea(a,d.firstElementChild.getAttribute("src"),c,e)}}for(let b of e)if("text"===b.type&&"url"===b.subtype)return void D5(a,b.data,c,e);for(let b of e)if("text"===b.type&&"text"===b.subtype&&b.data.trim())return void Ea(a,b.data,c,e)}let Ee=async a=>{let b=a.getContainer().ownerDocument?.defaultView?.navigator??globalThis.navigator,c=await a.resolveAssetsInContent(a.getContentFromCurrentPage(a.getSelectedShapeIds()));if(!c){b&&b.clipboard&&b.clipboard.writeText("");return}let{assets:d,...e}=c,f=JSON.stringify({type:"application/tldraw",kind:"content",version:3,data:{assets:d||[],otherCompressed:D0.default.compressToBase64(JSON.stringify(e))}});if(void 0!==b){let d=c.shapes.map(b=>a.getShapeUtil(b).getText(b)).filter(di);if(b.clipboard?.write){let a=new Blob([`<div data-tldraw>${f}</div>`],{type:"text/html"}),c=d.join(" ");""===c&&(c=" "),b.clipboard.write([new ClipboardItem({"text/html":a,"text/plain":new Blob([c],{type:"text/plain"})})])}else b.clipboard.writeText&&b.clipboard.writeText(`<div data-tldraw>${f}</div>`)}},Ef={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};async function Eg(a){await navigator.clipboard?.writeText?.(await a())}async function Eh(a,b,c){var d;let e,f,g=c.name;if(!g&&(g=`shapes at ${Ei()}`,1===b.length)){let c=a.getShape(b[0]);g=a.isShapeOfType(c,"frame")?c.props.name||"frame":`${jw(c.id)} at ${Ei()}`}g+=`.${c.format}`;let{blob:h}=await a.toImage(b,c);d=new File([h],g,{type:h.type}),e=document.createElement("a"),e.href=f=URL.createObjectURL(d),e.download=d.name,e.click(),URL.revokeObjectURL(f)}function Ei(){let a=new Date,b=String(a.getFullYear()).slice(2),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),e=String(a.getHours()).padStart(2,"0"),f=String(a.getMinutes()).padStart(2,"0"),g=String(a.getSeconds()).padStart(2,"0");return`${b}-${c}-${d} ${e}.${f}.${g}`}let Ej=(0,bT.createContext)([]);function Ek(){let a,b,c,d,e,f,g,h,i=jB(),{addToast:j,removeToast:k,clearToasts:l}=D$(),{addDialog:m,clearDialogs:n,removeDialog:o}=Dh(),p=Am(),q=(a=jB(),b=(0,bT.useRef)(null),c=(0,bT.useRef)(null),(0,bT.useCallback)(async function(){cd(a,"usePrint: editor is required");let d=document.createElement("div"),e=document.createElement("style"),f=(a,b)=>{a&&(a.innerHTML=""),b&&document.head.contains(b)&&document.head.removeChild(b),a&&document.body.contains(a)&&document.body.removeChild(a)};f(b.current,c.current),b.current=d,c.current=e;let g=`tl-print-surface-${cs(void 0)}`;d.className=g,e.innerHTML=`
			.${g} {
				display: none;
			}

			.${g} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${g} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${g}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${g}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${g}__item__header {
					display: none;
				}

				.${g}__item__footer {
					display: none;
					text-align: right;
				}

				.${g}__item__footer__hide {
					display: none;
				}

				
			}

		`;let h=()=>{document.head.appendChild(e),document.body.appendChild(d)},i=()=>{a.once("tick",()=>{f(d,e)})};function j(a,b,c){try{d.innerHTML+=`<div class="${g}__item">
        <div class="${g}__item__header">
          ${a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${g}__item__main">
          ${c}
        </div>
        <div class="${g}__item__footer ${g}__item__footer__${b?"":"hide"}">
          ${b??""}
        </div>
      </div>`}catch(a){console.error(a)}}function k(){window.print()}window.addEventListener("beforeprint",h),window.addEventListener("afterprint",i);let l=a.getSelectedShapeIds(),m=a.getCurrentPageId(),n=a.getPages(),o={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(a.getSelectedShapeIds().length>0){let b=await a.getSvgString(l,o);if(b){let a=n.find(a=>a.id===m);j(`tldraw \u2014 ${a?.name}`,null,b.svg),k()}}else{let b=a.getCurrentPage(),c=await a.getSvgString(a.getSortedChildIdsForParent(b.id),o);c&&(j(`tldraw \u2014 ${b.name}`,null,c.svg),k())}window.removeEventListener("beforeprint",h),window.removeEventListener("afterprint",i)},[a])),{cut:r,copy:s,paste:t}=(d=jB(),e=BP(),f=(0,bT.useCallback)(async function(a){cd(d,"editor is required for copy"),0!==d.getSelectedShapeIds().length&&(await Ee(d),e("copy",{source:a}))},[d,e]),g=(0,bT.useCallback)(async function(a){d&&0!==d.getSelectedShapeIds().length&&(await Ee(d),d.deleteShapes(d.getSelectedShapeIds()),e("cut",{source:a}))},[d,e]),{copy:f,cut:g,paste:h=(0,bT.useCallback)(async function(a,b,c){d&&null===d.getEditingShapeId()&&(Array.isArray(a)&&a[0]instanceof ClipboardItem?(Ec({editor:d,clipboardItems:a,point:c}),e("paste",{source:"menu"})):navigator.clipboard.read().then(a=>{h(a,b,c)}))},[d,e])}),u=function(){let a=jB(),{addToast:b}=D$(),c=Am();return(0,bT.useCallback)((d,e="svg")=>{cd(a,"useCopyAs: editor is required"),(function(a,b,c){if(!navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(navigator.clipboard.write){let{blobPromise:d,mimeType:e}=function(a,b,c={}){let d=b?.length?b:[...a.getCurrentPageShapeIds()],e=c.format??"png";return{blobPromise:a.toImage(d,c).then(a=>co.rewriteMimeType(a.blob,Ef[e])),mimeType:Ef[e]}}(a,b,c),f={[e]:d},g=cF(D2,c.format)??null;g&&"u">typeof ClipboardItem&&"supports"in ClipboardItem&&ClipboardItem.supports(g)&&(f[g]=d.then(a=>co.rewriteMimeType(a,g)));let h=Object.entries(f);for(let[a,b]of h)b.catch(a=>console.error(a));return navigator.clipboard.write([new ClipboardItem(f)]).catch(a=>(console.error(a),Promise.all(h.map(async([a,b])=>[a,await b])).then(a=>{let b=cJ(a);return navigator.clipboard.write([new ClipboardItem(b)])})))}switch(c.format){case"svg":return Eg(async()=>{let d=await a.getSvgString(b,c);if(!d)throw Error("Failed to copy");return d.svg});case"png":throw Error("Copy not supported");default:cc(c.format)}})(a,d,{format:e}).catch(()=>{b({id:"copy-fail",severity:"warning",title:c("toast.error.copy-fail.title"),description:c("toast.error.copy-fail.desc")})})},[a,b,c])}(),v=function(){let a=jB(),{addToast:b}=D$(),c=Am();return(0,bT.useCallback)((d,e={})=>{cd(a,"useExportAs: editor is required");let{format:f="png",name:g,scale:h=1}=e;Eh(a,d,{format:f,name:g,scale:h}).catch(a=>{console.error(a.message),b({id:"export-fail",title:c("toast.error.export-fail.title"),description:c("toast.error.export-fail.desc"),severity:"error"})})},[a,b,c])}(),w=AW(),y=A0()<AZ.TABLET_SM,z=jX((0,bT.useContext)(Ej)),A=(0,bT.useCallback)(async()=>{if(!i)return;let a=await D_({allowMultiple:!0,mimeTypes:z});a.length&&(i.markHistoryStoppingPoint("insert media"),i.putExternalContent({type:"files",files:a,point:i.getViewportPageBounds().center}))},[i,z]),B=(0,bT.useCallback)(async a=>{if(!i)return;let b=await D_({allowMultiple:!1,mimeTypes:z?.filter(b=>a?b.startsWith("image/"):b.startsWith("video/"))});if(!b.length)return;let c=i.getOnlySelectedShape();if(!c||a&&"image"!==c.type||!a&&"video"!==c.type)return;i.markHistoryStoppingPoint("replace media");let d=b[0];i.replaceExternalContent({type:"file-replace",file:d,shapeId:c.id,isImage:a})},[i,z]),C=(0,bT.useCallback)(()=>B(!0),[B]),D=(0,bT.useCallback)(()=>B(!1),[B]);return(0,bT.useMemo)(()=>({addToast:j,removeToast:k,clearToasts:l,addDialog:m,removeDialog:o,clearDialogs:n,msg:p,isMobile:y,insertMedia:A,replaceImage:C,replaceVideo:D,printSelectionOrPages:q,cut:r,copy:s,paste:t,copyAs:u,exportAs:v,getEmbedDefinition:w}),[j,k,l,m,o,n,p,y,A,C,D,q,r,s,t,u,v,w])}function El(a){return(0,bT.useMemo)(()=>a,a)}function Em(a){let b=El(null==a?[]:Array.isArray(a)?a:[a]);return(0,bT.useMemo)(()=>{let a={};for(let c of b)if(c.translations)for(let[b,d]of cI(c.translations)){let c=a[b];c||(c=a[b]={}),Object.assign(c,d)}return a},[b])}let En=bT.createContext(null);function Eo({overrides:a,children:b}){let c=jB(),d=BP(),e=Ac(),f=Am(),g=Ek(),h=bT.useCallback((a,b,c)=>{e.announce({msg:f(b.label)}),d("select-tool",{source:a,id:c??b.id})},[e,f,d]),i=bT.useMemo(()=>{if(!c)return{};let b=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(a){if(c.isIn("select")){let a=c.root.getCurrent();a.exit({},a.id),a.enter({},a.id)}c.setCurrentTool("select"),h(a,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(a){c.setCurrentTool("hand"),h(a,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(a){c.setCurrentTool("eraser"),h(a,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(a){c.setCurrentTool("draw"),h(a,this)}},...[...h$.values].map(a=>({id:a,label:`tool.${a}`,meta:{geo:a},kbd:"rectangle"===a?"r":"ellipse"===a?"o":void 0,icon:"geo-"+a,onSelect(b){c.run(()=>{c.setStyleForNextShapes(h$,a),c.setCurrentTool("geo"),h(b,this,`geo-${a}`)})},onDragStart(b,e){Eq(c,e,{createShape:b=>c.createShape({id:b,type:"geo",props:{w:200,h:200,geo:a}})}),d("drag-tool",{source:b,id:"geo"})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(a){c.setCurrentTool("arrow"),h(a,this)},onDragStart(a,b){Eq(c,b,{createShape:a=>c.createShape({id:a,type:"arrow",props:{start:{x:0,y:200},end:{x:200,y:0}}})}),d("drag-tool",{source:a,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(a){c.setCurrentTool("line"),h(a,this)},onDragStart(a,b){Eq(c,b,{createShape:a=>{let[b,d]=c1(null,null,2);c.createShape({id:a,type:"line",props:{points:{[b]:{id:b,index:b,x:0,y:200},[d]:{id:d,index:d,x:200,y:0}}}})}}),d("drag-tool",{source:a,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(a){c.setCurrentTool("frame"),h(a,this)},onDragStart(a,b){Eq(c,b,{createShape:a=>c.createShape({id:a,type:"frame"})}),d("drag-tool",{source:a,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(a){c.setCurrentTool("text"),h(a,this)},onDragStart(a,b){Eq(c,b,{createShape:a=>c.createShape({id:a,type:"text",props:{richText:gb("Text")}}),onDragEnd:a=>{z9(c,a,{selectAll:!0})}}),d("drag-tool",{source:a,id:"text"})}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(a){g.insertMedia(),h(a,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(a){c.setCurrentTool("note"),h(a,this)},onDragStart(a,b){Eq(c,b,{createShape:a=>c.createShape({id:a,type:"note"}),onDragEnd:a=>{z9(c,a,{selectAll:!0})}}),d("drag-tool",{source:a,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(a){c.setCurrentTool("laser"),h(a,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(a){g.addDialog({component:AX}),h(a,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(a){c.setCurrentTool("highlight"),h(a,this)}}];b.forEach(a=>a.onSelect=a.onSelect.bind(a));let e=Object.fromEntries(b.map(a=>[a.id,a]));return a?a(c,e,g):e},[a,c,g,h,d]);return(0,bS.jsx)(En.Provider,{value:i,children:b})}function Ep(){let a=bT.useContext(En);if(!a)throw Error("useTools must be used within a ToolProvider");return a}function Eq(a,b,c){let{x:d,y:e}=a.inputs.getCurrentPagePoint(),f=a.markHistoryStoppingPoint("drag shape tool");a.setCurrentTool("select.translating");let g=gi();c.createShape(g);let h=ce(a.getShape(g),"Shape not found"),{w:i,h:j}=a.getShapePageBounds(g);a.updateShape({id:g,type:h.type,x:d-i/2,y:e-j/2}),a.select(g),a.setCurrentTool("select.translating",{...b,target:"shape",shape:a.getShape(g),isCreating:!0,creatingMarkId:f,onCreate(){a.setCurrentTool("select.idle"),a.select(g),c.onDragEnd?.(g)}}),a.getCurrentTool().setCurrentToolIdMask(h.type)}function Er({toolId:a="",...b}){let c=Ep()[a];return c?(0,bS.jsx)(Db,{...c,...b}):null}function Es(){let a=A4();return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(De,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,bS.jsx)(Dd,{actionId:"toggle-tool-lock"}),(0,bS.jsx)(Dd,{actionId:"insert-media"}),(0,bS.jsx)(Er,{toolId:"select"}),(0,bS.jsx)(Er,{toolId:"draw"}),(0,bS.jsx)(Er,{toolId:"eraser"}),(0,bS.jsx)(Er,{toolId:"hand"}),(0,bS.jsx)(Er,{toolId:"rectangle"}),(0,bS.jsx)(Er,{toolId:"ellipse"}),(0,bS.jsx)(Er,{toolId:"arrow"}),(0,bS.jsx)(Er,{toolId:"line"}),(0,bS.jsx)(Er,{toolId:"text"}),(0,bS.jsx)(Er,{toolId:"frame"}),(0,bS.jsx)(Er,{toolId:"note"}),(0,bS.jsx)(Er,{toolId:"laser"}),(0,bS.jsx)(Db,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,bS.jsx)(Dd,{actionId:"toggle-dark-mode"}),(0,bS.jsx)(Dd,{actionId:"toggle-focus-mode"}),(0,bS.jsx)(Dd,{actionId:"toggle-grid"})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,bS.jsx)(Dd,{actionId:"undo"}),(0,bS.jsx)(Dd,{actionId:"redo"}),(0,bS.jsx)(Dd,{actionId:"cut"}),(0,bS.jsx)(Dd,{actionId:"copy"}),(0,bS.jsx)(Dd,{actionId:"paste"}),(0,bS.jsx)(Dd,{actionId:"select-all"}),(0,bS.jsx)(Dd,{actionId:"delete"}),(0,bS.jsx)(Dd,{actionId:"duplicate"})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.view",id:"view",children:[(0,bS.jsx)(Dd,{actionId:"select-zoom-tool"}),(0,bS.jsx)(Dd,{actionId:"zoom-in"}),(0,bS.jsx)(Dd,{actionId:"zoom-out"}),(0,bS.jsx)(Dd,{actionId:"zoom-to-100"}),(0,bS.jsx)(Dd,{actionId:"zoom-to-fit"}),(0,bS.jsx)(Dd,{actionId:"zoom-to-selection"}),(0,bS.jsx)(Db,{id:"zoom-quick",label:"action.zoom-quick",kbd:"shift+z",onSelect:()=>{}})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,bS.jsx)(Dd,{actionId:"bring-to-front"}),(0,bS.jsx)(Dd,{actionId:"bring-forward"}),(0,bS.jsx)(Dd,{actionId:"send-backward"}),(0,bS.jsx)(Dd,{actionId:"send-to-back"}),(0,bS.jsx)(Dd,{actionId:"group"}),(0,bS.jsx)(Dd,{actionId:"ungroup"}),(0,bS.jsx)(Dd,{actionId:"flip-horizontal"}),(0,bS.jsx)(Dd,{actionId:"flip-vertical"}),(0,bS.jsx)(Dd,{actionId:"align-top"}),(0,bS.jsx)(Dd,{actionId:"align-center-vertical"}),(0,bS.jsx)(Dd,{actionId:"align-bottom"}),(0,bS.jsx)(Dd,{actionId:"align-left"}),(0,bS.jsx)(Dd,{actionId:"align-center-horizontal"}),(0,bS.jsx)(Dd,{actionId:"align-right"})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.text-formatting",id:"text",children:[(0,bS.jsx)(Db,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+alt+[[1-6]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),(0,bS.jsxs)(De,{label:"shortcuts-dialog.a11y",id:"a11y",children:[(0,bS.jsx)(Db,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+[[↑→↓←]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+[[↑↓]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+[[↑→↓←]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"[[↑→↓←]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+[[↑→↓←]]",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-rotate-shape-cw",label:"a11y.rotate-shape-cw",kbd:"shift+﹥",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-rotate-shape-cw-fine",label:"a11y.rotate-shape-cw-fine",kbd:"shift+alt+﹥",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-rotate-shape-ccw",label:"a11y.rotate-shape-ccw",kbd:"shift+﹤",onSelect:()=>{}}),(0,bS.jsx)(Db,{id:"a11y-rotate-shape-ccw-fine",label:"a11y.rotate-shape-ccw-fine",kbd:"shift+alt+﹤",onSelect:()=>{}}),(0,bS.jsx)(Dd,{actionId:"enlarge-shapes"}),(0,bS.jsx)(Dd,{actionId:"shrink-shapes"}),(0,bS.jsx)(Dd,{actionId:"a11y-repeat-shape-announce"}),(0,bS.jsx)(Db,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),a&&(0,bS.jsx)(De,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,bS.jsx)(Dd,{actionId:"open-cursor-chat"})})]})}let Et=(0,bT.memo)(function({children:a}){let b=Am(),c=A0(),d=a??(0,bS.jsx)(Es,{});return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(AG,{className:"tlui-shortcuts-dialog__header",children:[(0,bS.jsx)(AH,{children:b("shortcuts-dialog.title")}),(0,bS.jsx)(AI,{})]}),(0,bS.jsx)(AJ,{className:(0,jb.default)("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":c<=AZ.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":c<=AZ.TABLET}),children:(0,bS.jsx)(A3,{type:"keyboard-shortcuts",sourceId:"kbd",children:d})}),(0,bS.jsx)("div",{className:"tlui-dialog__scrim"})]})});async function Eu(a,b,c){let d=b4(b.map(b=>{let c=a.getShape(b);if(c&&void 0!==a.getShapeUtil(c.type).toSvg)return c}));if(0===d.length)return;if(1===d.length){let b=d[0];if(!b||a.isShapeOfType(b,"image"))return}let e=[];if(void 0!==c){let b=d.map(b=>({shape:b,bounds:a.getShapeMaskedPageBounds(b).clone().expandBy(c)}));for(let a=0;a<b.length;a++){let c=b[a];if(0===a){e[0]={shapes:[c.shape],bounds:c.bounds};continue}let d=!1;for(let a of e)if(a.bounds.includes(c.bounds)){a.shapes.push(c.shape),a.bounds.expand(c.bounds),d=!0;break}d||e.push({shapes:[c.shape],bounds:c.bounds})}}else{let b=kt.Common(d.map(b=>a.getShapeMaskedPageBounds(b)));e.push({shapes:d,bounds:b})}let f=a.options.flattenImageBoundsPadding;for(let b of e){void 0!==c&&b.bounds.expandBy(-c);let d=await a.getSvgString(b.shapes,{padding:f,background:!1});if(!d?.svg)continue;let e=await a.getAssetForExternalContent({type:"file",file:new File([d.svg],"asset.svg",{type:"image/svg+xml"})});e&&(b.asset=e)}let g=[];return dH(()=>{for(let b of e){let c,d,e,{asset:h,bounds:i,shapes:j}=b;if(!h)continue;let k=a.findCommonAncestor(j)??a.getCurrentPageId();if(!k)continue;let l="a1";for(let a of j)if(a.parentId===k){a.index>l&&(l=a.index);break}if(gh(k)){let b=a.getShape(k);if(!b)continue;let g=a.getPointInShapeSpace(b,{x:i.x,y:i.y});e=a.getShapePageTransform(k).rotation(),g.sub(new iK(f,f).rot(-e)),c=g.x,d=g.y}else c=i.x-f,d=i.y-f,e=0;a.deleteShapes(j),a.createAssets([{...h,id:h.id}]);let m=gi();a.createShape({id:m,type:"image",index:l,parentId:k,x:c,y:d,rotation:-e,props:{assetId:h.id,w:i.w+2*f,h:i.h+2*f}}),g.push(m)}}),g}var Ev=a.i(723376),Ev=Ev;function Ew({id:a,children:b,onOpenChange:c,open:d,className:e}){let[f,g]=BQ(a,c);return(0,bS.jsx)(Ev.Root,{onOpenChange:g,open:d||f,children:(0,bS.jsx)("div",{className:(0,jb.default)("tlui-popover",e),children:b})})}function Ex({children:a}){return(0,bS.jsx)(Ev.Trigger,{asChild:!0,dir:"ltr",children:a})}function Ey({side:a,children:b,align:c="center",sideOffset:d=8,alignOffset:e=0,disableEscapeKeyDown:f=!1,autoFocusFirstButton:g=!0}){let h=jG(),i=bT.default.useRef(null),j=bT.default.useCallback(()=>{if(!g)return;let a=[...i.current?.querySelectorAll("button:not([disabled])")??[]].filter(a=>a.offsetWidth||a.offsetHeight)[0];a&&a.focus()},[g]);return(0,bS.jsx)(Ev.Portal,{container:h,children:(0,bS.jsx)(Ev.Content,{className:"tlui-popover__content",side:a,sideOffset:d,align:c,alignOffset:e,dir:"ltr",ref:i,onOpenAutoFocus:j,onEscapeKeyDown:a=>f&&a.preventDefault(),children:b})})}function Ez(a,b,c){let{arrowheadStart:d,arrowheadEnd:e}=b.props,f=Fg(a,b,c),g=f.start.clone(),h=f.end.clone(),i=iK.Med(g,h);if(iK.Equals(g,h))return{bindings:c,type:"straight",start:{handle:g,point:g,arrowhead:b.props.arrowheadStart},end:{handle:h,point:h,arrowhead:b.props.arrowheadEnd},middle:i,isValid:!1,length:0};let j=iK.Sub(h,g).uni(),k=Fa(a,b,"start"),l=Fa(a,b,"end"),m=a.getShapePageTransform(b);EA(h,f.start,m,l),EA(g,f.end,m,k);let n=0,o=0,p=0,q=0,r=Fj*b.props.scale,s=k&&l&&k.shape===l.shape,t=k&&l?Fn(a,k.shape.id,l.shape.id):"safe";"safe"===t&&k&&l&&!s&&!k.isExact&&!l.isExact&&(l.didIntersect&&!k.didIntersect?k.isClosed&&g.setTo(h.clone().add(j.clone().mul(Fj*b.props.scale))):!l.didIntersect&&l.isClosed&&h.setTo(g.clone().sub(j.clone().mul(Fj*b.props.scale))));let u=iK.Sub(h,g),v=iK.Len(u)?u.uni():iK.From(u),w=!iK.Equals(v,j);s||("start-contains-end"!==t&&k&&"none"!==d&&!k.isExact&&(n=(Fk+(p=Fm[b.props.size]/2+("size"in k.shape.props?Fm[k.shape.props.size]/2:0)))*b.props.scale,r+=p*b.props.scale),"end-contains-start"!==t&&l&&"none"!==e&&!l.isExact&&(o=(Fk+(q=Fm[b.props.size]/2+("size"in l.shape.props?Fm[l.shape.props.size]/2:0)))*b.props.scale,r+=q*b.props.scale));let y=g.clone().add(v.clone().mul(n*(w?-1:1))),z=h.clone().sub(v.clone().mul(o*(w?-1:1)));iK.DistMin(y,z,r)&&(0!==n&&0!==o?(n*=-1.5,o*=-1.5):0!==n?n*=-1:0!==o&&(o*=-1)),g.add(v.clone().mul(n*(w?-1:1))),h.sub(v.clone().mul(o*(w?-1:1))),w?(k&&l&&h.setTo(iK.Add(g,v.clone().mul(-Fj*b.props.scale))),i.setTo(iK.Med(f.start,f.end))):i.setTo(iK.Med(g,h));let A=iK.Dist(g,h);return{bindings:c,type:"straight",start:{handle:f.start,point:g,arrowhead:b.props.arrowheadStart},end:{handle:f.end,point:h,arrowhead:b.props.arrowheadEnd},middle:i,isValid:A>0,length:A}}function EA(a,b,c,d){let e;if(void 0===d||d.isExact)return;let f=ku.applyToPoint(c,b),g=ku.applyToPoint(c,a),h=ku.applyToPoint(ku.Inverse(d.transform),f),i=ku.applyToPoint(ku.Inverse(d.transform),g),j=Array.from(d.geometry.intersectLineSegment(h,i,{includeLabels:!1,includeInternal:!1}));if(j.length&&(e=j.sort((a,b)=>iK.Dist2(a,h)-iK.Dist2(b,h))[0]??(d.isClosed?void 0:i)),void 0===e&&(e=d.geometry.nearestPoint(i,{includeLabels:!1,includeInternal:!1}),!iK.DistMin(e,i,1)))return;let k=ku.applyToPoint(d.transform,e),l=ku.applyToPoint(ku.Inverse(c),k);a.setTo(l),d.didIntersect=!0}function EB(a,b,c){let d=i9(a,b,c)??iK.Med(a,b),e=iK.Dist(d,a),f=+iK.Clockwise(a,c,b),g=((a.y-b.y)**2+(a.x-b.x)**2)**.5,h=((b.y-c.y)**2+(b.x-c.x)**2)**.5,i=((c.y-a.y)**2+(c.x-a.x)**2)**.5,j=2*Math.acos((h*h+i*i-g*g)/(2*h*i)),k=+(iO>j),l=(iQ-j)*(f?1:-1);return{center:d,radius:e,size:l,length:l*e,largeArcFlag:k,sweepFlag:f}}let EC=["right","bottom","left","top"],ED={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},EE={left:"x",right:"x",top:"y",bottom:"y"},EF={top:"bottom",right:"left",bottom:"top",left:"right"},EG={x:{v:(a,b)=>new iK(a,b),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(a,b)=>new iK(b,a),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function EH(a,b){return{min:Math.min(a,b),max:Math.max(a,b)}}function EI(a,b){return a>=b.min&&a<=b.max}function EJ(a){if(!a)return;let b=a.cross.min;a.cross.min=-a.cross.max,a.cross.max=-b,a.crossTarget=-a.crossTarget}function EK(a){a&&(a.value=-a.value,a.expanded=null===a.expanded?null:-a.expanded)}let EL={x:1,y:1,transpose:!1},EM={x:-1,y:1,transpose:!0},EN={x:-1,y:-1,transpose:!1},EO={x:1,y:-1,transpose:!0},EP={x:1,y:-1,transpose:!1};function EQ(a,b,c){let d=a[b];a[b]=a[c],a[c]=d}function ER(a,b){b.x=a.x*b.x,b.y=a.y*b.y,a.transpose&&EQ(b,"x","y")}function ES(a,b){-1===a.x&&(b.x=-(b.x+b.width)),-1===a.y&&(b.y=-(b.y+b.height)),a.transpose&&(EQ(b,"x","y"),EQ(b,"width","height"))}function ET(a,b){-1===a.x&&(EQ(b,"left","right"),EJ(b.top),EJ(b.bottom),EK(b.left),EK(b.right)),-1===a.y&&(EQ(b,"top","bottom"),EJ(b.left),EJ(b.right),EK(b.top),EK(b.bottom)),a.transpose&&(EQ(b,"left","top"),EQ(b,"right","bottom"))}class EU{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(a){this.options=a.options,this.A=a.A,this.B=a.B,this.common=a.common,this.midX=a.midX,this.midY=a.midY,this.gapX=a.gapX,this.gapY=a.gapY,this.bias=new iK(1,1)}transform=EL;inverse=EL;apply(a){var b,c;let d;if(this.transform=(b=this.transform,d={...a},b.transpose&&(EQ(d,"x","y"),d.transpose=!d.transpose),-1===b.x&&(d.x=-d.x),-1===b.y&&(d.y=-d.y),d),this.inverse=(c=this.transform).transpose?{x:c.y,y:c.x,transpose:!0}:c,ES(a,this.A.original),ES(a,this.B.original),ES(a,this.common.original),ES(a,this.A.expanded),ES(a,this.B.expanded),ES(a,this.common.expanded),ET(a,this.A.edges),ET(a,this.B.edges),ER(a,this.bias),-1===a.x&&(this.gapX=-this.gapX,this.midX=null===this.midX?null:-this.midX),-1===a.y&&(this.gapY=-this.gapY,this.midY=null===this.midY?null:-this.midY),a.transpose){let a=this.midX;this.midX=this.midY,this.midY=a,a=this.gapX,this.gapX=this.gapY,this.gapY=a}}reset(){this.apply(this.inverse)}vec(a,b){let c=new iK(a,b);return ER(this.inverse,c),c}}class EV{constructor(a,b){this.info=a,this.name=b}points=[];add(a,b){return this.points.push(this.info.vec(a,b)),this}_midpointHandle=null;midpointHandle(a){cd(null===this._midpointHandle,"midX/midY called multiple times");let b=iK.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?"x"===a?"y":"x":a,point:b,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){let a=[];for(let b=0;b<this.points.length;b++){let c=this.points[b],d=a[a.length-1],e=a[a.length-2];if(d&&e){let b=Math.abs(c.x-d.x),f=Math.abs(c.y-d.y),g=Math.abs(c.x-e.x),h=Math.abs(c.y-e.y);b<.01&&f<.01||(b<.01&&g<.01?d.y=c.y:f<.01&&h<.01?d.x=c.x:a.push(c))}else a.push(c)}return{name:this.name,points:a,distance:function(a){let b=0;for(let c=0;c<a.length-1;c++){let d=a[c],e=a[c+1];b+=Math.abs(e.x-d.x)+Math.abs(e.y-d.y)}return b}(a),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function EW(a){let b=a.A.edges.right,c=a.B.edges.left;if(!b||!c)return null;if(b.crossTarget>c.crossTarget&&a.apply(EP),a.gapX>0&&null!==a.midX)return new EV(a,"to left 1").add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,c.crossTarget).midpointHandle("x").add(c.value,c.crossTarget).build();if(null===b.expanded||null===c.expanded)return null;if(null!==a.midY)return new EV(a,"to left 2").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(c.expanded,a.midY).midpointHandle("y").add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build();let d=Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.common.expanded.bottom)+Math.abs(a.common.expanded.right-c.expanded)+Math.abs(a.common.expanded.bottom-c.crossTarget)+a.options.expandElbowLegLength+6,e=a.options.expandElbowLegLength+Math.abs(b.crossTarget-a.common.expanded.top)+Math.abs(b.expanded-a.common.expanded.left)+Math.abs(a.common.expanded.top-c.crossTarget)+Math.abs(a.common.expanded.left-c.value)+6+a.bias.y,f=a.gapX<0&&null!==a.midX?a.options.expandElbowLegLength+Math.abs(b.crossTarget-a.A.expanded.bottom)+a.common.expanded.width+Math.abs(a.A.expanded.bottom-a.B.expanded.top)+Math.abs(a.B.expanded.top-c.crossTarget)+a.options.expandElbowLegLength+8:1/0;return d<e&&d<f?new EV(a,"to left 3").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,a.common.expanded.bottom).add(c.expanded,a.common.expanded.bottom).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build():e<f?new EV(a,"to left 4").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.common.expanded.top).add(a.common.expanded.left,a.common.expanded.top).add(a.common.expanded.left,c.crossTarget).add(c.value,c.crossTarget).build():null!==a.midX?new EV(a,"to left 5").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded.bottom).add(a.midX,a.A.expanded.bottom).add(a.midX,a.B.expanded.top).midpointHandle("y").add(c.expanded,a.B.expanded.top).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build():null}function EX(a){let b=a.A.edges.right,c=a.B.edges.top;if(!b||!c)return null;if(b.crossTarget<(c.expanded??c.value)&&c.crossTarget>(b.expanded??b.value)||a.A.isPoint&&a.B.expanded.containsPoint(a.A.original.center))return new EV(a,"to top 1").add(b.value,b.crossTarget).add(c.crossTarget,b.crossTarget).add(c.crossTarget,c.value).build();if(a.gapX>0&&null!==a.midX&&null!==c.expanded)return new EV(a,"to top 2").add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,c.expanded).midpointHandle("x").add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build();if(a.gapY>0&&null!==b.expanded&&c.crossTarget<b.expanded&&null!==a.midY)return new EV(a,"to top 3").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(c.crossTarget,a.midY).midpointHandle("y").add(c.crossTarget,c.value).build();let d=Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.common.expanded.top)+Math.abs(c.crossTarget-a.common.expanded.right)+Math.abs(c.value-a.common.expanded.top),e=null!==b.expanded&&null!==a.midY&&null!==c.expanded?Math.abs(b.value-b.expanded)+Math.abs(a.B.expanded.left-b.expanded)+Math.abs(a.B.expanded.left-c.crossTarget)+Math.abs(b.crossTarget-a.B.expanded.top)+Math.abs(c.value-c.expanded):1/0,f=null!==b.expanded&&null!==a.midX&&null!==c.expanded?Math.abs(b.value-a.common.expanded.right)+Math.abs(b.crossTarget-a.A.expanded.bottom)+Math.abs(b.expanded-c.crossTarget)+Math.abs(a.A.expanded.bottom-c.expanded)+Math.abs(c.expanded-c.value):1/0;return d<e&&d<f?new EV(a,"to top 4").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,a.common.expanded.top).add(c.crossTarget,a.common.expanded.top).add(c.crossTarget,c.value).build():null!==c.expanded&&null!==b.expanded&&null!==a.midY&&e<f?new EV(a,"to top 5").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.midY).add(a.B.expanded.left,a.midY).midpointHandle("y").add(a.B.expanded.left,c.expanded).add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build():null!==c.expanded&&null!==b.expanded&&null!==a.midX?new EV(a,"to top 6").add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded.bottom).add(a.midX,a.A.expanded.bottom).add(a.midX,c.expanded).midpointHandle("x").add(c.crossTarget,c.expanded).add(c.crossTarget,c.value).build():null}function EY(a){return a.apply(EP),EX(a)}function EZ(a){let b=a.A.edges.right,c=a.B.edges.right;if(!b||!c)return null;if((a.gapX<=0||b.crossTarget>a.B.expanded.bottom||b.crossTarget<a.B.expanded.top)&&(c.value>a.A.original.left||c.crossTarget>a.A.expanded.bottom||c.crossTarget<a.A.expanded.top))return new EV(a,"to right 1").add(b.value,b.crossTarget).add(a.common.expanded.right,b.crossTarget).add(a.common.expanded.right,c.crossTarget).add(c.value,c.crossTarget).build();if(null===a.midX)return null;if(null!==c.expanded&&a.gapX>=0){let d=Math.abs(c.crossTarget-a.B.expanded.bottom)+Math.abs(b.crossTarget-a.B.expanded.bottom)<Math.abs(c.crossTarget-a.B.expanded.top)+Math.abs(b.crossTarget-a.B.expanded.top)?"bottom":"top";return new EV(a,`to right 2 via ${d}`).add(b.value,b.crossTarget).add(a.midX,b.crossTarget).add(a.midX,a.B.expanded[d]).midpointHandle("x").add(c.expanded,a.B.expanded[d]).add(c.expanded,c.crossTarget).add(c.value,c.crossTarget).build()}if(null!==b.expanded&&a.gapX<=0){let d=Math.abs(c.crossTarget-a.A.expanded.bottom)+Math.abs(b.crossTarget-a.A.expanded.bottom)<Math.abs(c.crossTarget-a.A.expanded.top)+Math.abs(b.crossTarget-a.A.expanded.top)?"bottom":"top";return new EV(a,`to right 3 via ${d}`).add(b.value,b.crossTarget).add(b.expanded,b.crossTarget).add(b.expanded,a.A.expanded[d]).add(a.midX,a.A.expanded[d]).add(a.midX,c.crossTarget).midpointHandle("x").add(c.value,c.crossTarget).build()}return null}let E$={top:{top:[EO,EZ],left:[EO,EX],bottom:[EO,EW],right:[EO,EY]},right:{top:[EL,EX],right:[EL,EZ],bottom:[EL,EY],left:[EL,EW]},bottom:{top:[EM,EW],left:[EM,EY],bottom:[EM,EZ],right:[EM,EX]},left:{top:[EN,EY],left:[EN,EZ],bottom:[EN,EX],right:[EN,EW]}};function E_(a,b,c){let[d,e]=E$[b][c];a.apply(d);let f=e(a);return a.reset(),f}function E0(a,b){let c=null,d=1/0,e=1/0,f=0;for(let[g,h,i,j]of b){f+=1;let b=E_(a,g,h);b&&(b.aEdgePicking=i,b.bEdgePicking=j,b.points.length<d?(d=b.points.length,e=b.distance,c=b):b.points.length===d&&b.distance+f<e&&(e=b.distance,c=b))}return c}function E1(a,b,c){var d,e,f,g,h;let i,j,k=a.getShapeUtil(b.type).options,l={elbowMidpoint:b.props.elbowMidPoint,expandElbowLegLength:k.expandElbowLegLength[b.props.size]*b.props.scale,minElbowLegLength:k.minElbowLegLength[b.props.size]*b.props.scale},m=E2(a,b,c.start,b.props.start),n=E2(a,b,c.end,b.props.end);m=E9(m,n,l),n=E9(n,m,l);let o=!!(!m.side&&n.side),{aTerminal:p,bTerminal:q}=o?{aTerminal:n,bTerminal:m}:{aTerminal:m,bTerminal:n},r={top:E4(p,q,"top",l),right:E4(p,q,"right",l),bottom:E4(p,q,"bottom",l),left:E4(p,q,"left",l)},s={top:E4(q,p,"top",l),right:E4(q,p,"right",l),bottom:E4(q,p,"bottom",l),left:E4(q,p,"left",l)},t=E5(r,p.side),u=E5(s,q.side),v=!1;t&&u||(v=!0,t||(q=E7(q)),u||(p=E7(p)),q.bounds.containsPoint(p.target,l.expandElbowLegLength)&&(q=E7(q)),p.bounds.containsPoint(q.target,l.expandElbowLegLength)&&(p=E7(p))),v&&(r={top:E4(p,q,"top",l),right:E4(p,q,"right",l),bottom:E4(p,q,"bottom",l),left:E4(p,q,"left",l)},s={top:E4(q,p,"top",l),right:E4(q,p,"right",l),bottom:E4(q,p,"bottom",l),left:E4(q,p,"left",l)});let w=p.isPoint?p.bounds:p.bounds.clone().expandBy(l.expandElbowLegLength),y=q.isPoint?q.bounds:q.bounds.clone().expandBy(l.expandElbowLegLength),z={original:kt.Common([p.bounds,q.bounds]),expanded:kt.Common([w,y])},A=q.bounds.minX-p.bounds.maxX;A<0&&((A=p.bounds.minX-q.bounds.maxX)<0&&(A=0),A=-A);let B=q.bounds.minY-p.bounds.maxY;B<0&&((B=p.bounds.minY-q.bounds.maxY)<0&&(B=0),B=-B);let C=3*p.minEndSegmentLength,D=3*q.minEndSegmentLength,E=(p.isPoint?C:l.minElbowLegLength)+(q.isPoint?D:l.minElbowLegLength),F=null;A>E?F={a:p.isPoint?p.bounds.maxX+C:w.maxX,b:q.isPoint?q.bounds.minX-D:y.minX}:A<-E&&(F={a:p.isPoint?p.bounds.minX-C:w.minX,b:q.isPoint?q.bounds.maxX+D:y.maxX});let G=null;B>E?G={a:p.isPoint?p.bounds.maxY+C:w.maxY,b:q.isPoint?q.bounds.minY-D:y.minY}:B<-E&&(G={a:p.isPoint?p.bounds.minY-C:w.minY,b:q.isPoint?q.bounds.maxY+D:y.maxY});let H=o?1-l.elbowMidpoint:l.elbowMidpoint,I=F?(d=F.a,d+(F.b-d)*H):null,J=G?(e=G.a,e+(G.b-e)*H):null,K={options:l,swapOrder:o,A:{isPoint:p.isPoint,target:p.target,isExact:p.isExact,arrowheadOffset:p.arrowheadOffset,minEndSegmentLength:p.minEndSegmentLength,original:p.bounds,expanded:w,edges:r,geometry:p.geometry},B:{isPoint:q.isPoint,target:q.target,isExact:q.isExact,arrowheadOffset:q.arrowheadOffset,minEndSegmentLength:q.minEndSegmentLength,original:q.bounds,expanded:y,edges:s,geometry:q.geometry},common:z,gapX:A,gapY:B,midX:I,midY:J},L=new EU(K),M=E6(p,q,K.A.edges),N=E6(q,p,K.B.edges);return M&&N?j=(i=E_(f=L,g=M,h=N))?i:f.A.isPoint&&f.B.isPoint?E0(f,[[EF[g],EF[h],"manual","manual"],[g,EF[h],"manual","auto"],[EF[g],h,"auto","manual"]]):f.A.isPoint?E_(f,EF[g],h):f.B.isPoint?E_(f,g,EF[h]):null:M&&!N&&(j=function(a,b){let c=null,d=a.A.edges.right,e=a.A.edges.left,f=a.B.edges.top,g=a.B.edges.bottom;switch(b){case"right":a.gapX>0&&a.gapX>Math.abs(a.gapY)&&null!==a.midX?c=E_(a,"right","left"):d&&f&&(d.expanded??d.value)<=f.crossTarget&&d.crossTarget<=(f.expanded??f.value)?c=E_(a,"right","top"):d&&g&&(d.expanded??d.value)<=g.crossTarget&&d.crossTarget>=(g.expanded??g.value)&&(c=E_(a,"right","bottom"));break;case"left":a.gapX<0&&Math.abs(a.gapX)>Math.abs(a.gapY)&&null!==a.midX?c=E_(a,"left","right"):e&&f&&(e.expanded??e.value)>=f.crossTarget&&e.crossTarget<=(f.expanded??f.value)?c=E_(a,"left","top"):e&&g&&(e.expanded??e.value)>=g.crossTarget&&e.crossTarget>=(g.expanded??g.value)&&(c=E_(a,"left","bottom"));break;case"top":case"bottom":break;default:cc(b)}if(c)return c.aEdgePicking="manual",c.bEdgePicking="auto",c;switch(b){case"top":return E0(a,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return E0(a,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return E0(a,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return E0(a,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}(L,M)),j||(j=function(a,b){let c=null;if(Math.abs(a.gapX)+1>Math.abs(a.gapY)&&null!==a.midX)c=a.gapX>0?E_(a,"right","left"):E_(a,"left","right");else{let b=a.A.edges.right,d=a.A.edges.left,e=a.B.edges.top,f=a.B.edges.bottom;a.A.isPoint&&a.B.isPoint?c=a.gapY>0?E_(a,"bottom","top"):E_(a,"top","bottom"):b&&e&&(b.expanded??b.value)<=e.crossTarget&&b.crossTarget<=(e.expanded??e.value)?c=E_(a,"right","top"):b&&f&&(b.expanded??b.value)<=f.crossTarget&&b.crossTarget>=(f.expanded??f.value)?c=E_(a,"right","bottom"):d&&e&&(d.expanded??d.value)>=e.crossTarget&&d.crossTarget<=(e.expanded??e.value)?c=E_(a,"left","top"):d&&f&&(d.expanded??d.value)>=f.crossTarget&&d.crossTarget>=(f.expanded??f.value)?c=E_(a,"left","bottom"):a.gapY>0&&null!==a.midY?c=E_(a,"bottom","top"):a.gapY<0&&null!==a.midY&&(c=E_(a,"top","bottom"))}if(c)return c.aEdgePicking=b,c.bEdgePicking=b,c;let d=EC.filter(b=>a.A.edges[b]),e=EC.filter(b=>a.B.edges[b]);return E0(a,d.flatMap(a=>e.map(c=>[a,c,b,b])))}(L,M||N?"fallback":"auto")),j&&(E8("first",K.A,K.B,j),E8("last",K.B,K.A,j),function(a,b,c){if(a){if(a.points.length>=3){let c=a.points[0],d=a.points[1];if(iK.ManhattanDist(c,d)<b.minEndSegmentLength&&(a.points.splice(1,1),a.points.length>=3)){let b=iU(c.x,d.x)?"y":"x";a.points[1][b]=c[b]}}if(a.points.length>=3){let b=a.points[a.points.length-1],d=a.points[a.points.length-2];if(iK.ManhattanDist(b,d)<c.minEndSegmentLength&&(a.points.splice(a.points.length-2,1),a.points.length>=3)){let c=iU(b.x,d.x)?"y":"x";a.points[a.points.length-2][c]=b[c]}}}}(j,p,q),o&&j.points.reverse()),{...K,route:j,midXRange:F?o?{lo:F.b,hi:F.a}:{lo:F.a,hi:F.b}:null,midYRange:G?o?{lo:G.b,hi:G.a}:{lo:G.a,hi:G.b}:null}}function E2(a,b,c,d){let e=Fm[b.props.size]*b.props.scale/2,f=3*e;if(c){let d=a.getShape(c.toId),h=function(a,b,c,d){var e,f,g,h;let i="start"===d.terminal?"none"!==b.props.arrowheadStart:"none"!==b.props.arrowheadEnd,j=a.getShapeGeometry(c,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!j)return null;let k=a.getShapePageTransform(b.id),l=a.getShapePageTransform(c),m=k.clone().invert().multiply(l),n=j.transform(m),o={x:.5,y:.5},p=d.isPrecise?d.normalizedAnchor:o,q={x:(e=j.bounds.minX,e+(j.bounds.maxX-e)*p.x),y:(f=j.bounds.minY,f+(j.bounds.maxY-f)*p.y)},r={x:(g=j.bounds.minX,g+(j.bounds.maxX-g)*o.x),y:(h=j.bounds.minY,h+(j.bounds.maxY-h)*o.y)},s=ku.applyToPoint(m,q),t=ku.applyToPoint(m,r);return{bounds:n.bounds,geometry:n,target:s,center:t,shapeToArrowTransform:m}}(a,b,c.toId,c.props);if(h&&d){var g;let a=0,i="start"===c.props.terminal?"arrowheadStart":"arrowheadEnd";if("none"!==b.props[i]){let c="scale"in d.props?d.props.scale:1;a=e+("size"in d.props?(Fm[d.props.size]??0)*c/2:0)+Fk*b.props.scale}let j=null,k=h.target;return c.props.isPrecise&&(j=iU((g=iK.RotWith(c.props.normalizedAnchor,{x:.5,y:.5},h.shapeToArrowTransform.rotation())).x,.5)&&iU(g.y,.5)?null:Math.abs(g.x-.5)>Math.abs(g.y-.5)-1e-4?g.x<.5?"left":"right":g.y<.5?"top":"bottom"),{targetShapeId:c.toId,isPoint:!1,isExact:c.props.isExact,bounds:h.bounds,geometry:h.geometry,target:k,arrowheadOffset:a,minEndSegmentLength:f,side:j,snap:c.props.snap}}}return{targetShapeId:null,bounds:kt.FromCenter(d,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:iK.From(d),arrowheadOffset:0,minEndSegmentLength:f,side:null,snap:"none"}}let E3={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function E4(a,b,c,d){var e,f,g,h,i;let j,k=E3[c],l=a.targetShapeId===b.targetShapeId&&null!==a.targetShapeId&&("edge"===a.snap||"edge-point"===a.snap)&&("edge"===b.snap||"edge-point"===b.snap),m=a.bounds[k.main],n=a.isPoint?null:m+k.expand*d.expandElbowLegLength,o=EH(a.bounds[k.crossMin],a.bounds[k.crossMax]),p=o;if(!p)return null;cd(o);let q=EH(b.bounds[k.main],b.bounds[k.opposite]);b.isPoint||(q[k.bRangeExpand]-=2*d.minElbowLegLength*k.expand);let r=(e=EH(b.bounds[k.crossMin],b.bounds[k.crossMax]),f=d.expandElbowLegLength,(j={min:e.min-f,max:e.max+f}).min>j.max?null:j);cd(q&&r);let s=!1;if(EI(m,q)&&!a.isPoint&&!b.isPoint&&!l){let a=(cd((g=p).min<=g.max&&r.min<=r.max),g.min<=r.min&&r.max<=g.max)?[{min:g.min,max:r.min},{min:r.max,max:g.max}]:r.max<=g.min||r.min>=g.max?[g]:r.min<=g.min&&g.max<=r.max?[]:EI(g.min,r)?[{min:r.max,max:g.max}]:EI(g.max,r)?[{min:g.min,max:r.min}]:[];switch(a.length){case 0:return null;case 1:s=a[0]!==p,p=a[0];break;case 2:s=!0,p=(h=a[0]).max-h.min>(i=a[1]).max-i.min?a[0]:a[1];break;default:cc(a)}}return EI(a.target[k.crossAxis],p)?{value:m,expanded:n,cross:p,crossTarget:a.target[k.crossAxis],isPartial:s}:null}function E5(a,b){return null===b?!!(a.bottom||a.left||a.right||a.top):"x"===b?!!a.left||!!a.right:"y"===b?!!a.top||!!a.bottom:!!a[b]}function E6(a,b,c){switch(a.side){case null:return null;case"x":if(a.bounds.center.x>b.bounds.center.x&&c?.left)return"left";if(c?.right)return"right";return null;case"y":if(a.bounds.center.y>b.bounds.center.y&&c?.top)return"top";if(c?.bottom)return"bottom";return null;default:return a.side}}function E7(a){if(a.isPoint)return a;let b=null,c=0;return("edge"===a.snap||"edge-point"===a.snap)&&(c=a.arrowheadOffset,("x"===a.side||"left"===a.side||"right"===a.side)&&(b="x"),("y"===a.side||"top"===a.side||"bottom"===a.side)&&(b="y")),{targetShapeId:a.targetShapeId,side:b,bounds:new kt(a.target.x,a.target.y,0,0),geometry:a.geometry,target:a.target,arrowheadOffset:c,minEndSegmentLength:a.minEndSegmentLength,isExact:a.isExact,isPoint:!0,snap:a.snap}}function E8(a,b,c,d){if(!b.geometry)return;let e="first"===a?d.points[0]:d.points[d.points.length-1],f="first"===a?d.points[1]:d.points[d.points.length-2],g=b.geometry.isClosed?f:b.target,h=iK.ManhattanDist(e,g),i=null,j=1/0;if(b.isExact)i=b.target;else if(b.geometry){let a=b.geometry.intersectLineSegment(f,b.target,{includeLabels:!1,includeInternal:!1});for(let c of(b.geometry.hitTestPoint(b.target,Math.max(1,b.arrowheadOffset),!0,kE)&&a.push(b.target),a)){let a=iK.ManhattanDist(g,c);a<j&&(j=a,i=c)}}if(i){let g=b.arrowheadOffset,j=iK.ManhattanDist(f,i),k=2*b.arrowheadOffset;j<k&&(g=j-(k-b.arrowheadOffset)),g<b.minEndSegmentLength&&(g=b.geometry.bounds.containsPoint(c.target)?Math.max(0,g):-b.arrowheadOffset);let l=i,m=!1;if(!b.isExact&&0!==g){let a=iK.Nudge(i,f,g);l=a,g<0&&!b.geometry.hitTestPoint(a,0,!0,kE)?l=i:(g<0&&(m=!0),l=a)}let n=iK.ManhattanDist(f,l);if(d.distance+=n-h,e.x=l.x,e.y=l.y,m){let b=iK.Lrp(f,e,.5);d.skipPointsWhenDrawing.add(b),d.points.splice("first"===a?1:d.points.length-1,0,b)}}}function E9(a,b,c){if(!a.geometry||a.geometry.isClosed)return a;let d=a.geometry.uninterpolateAlongEdge(a.target,kE),e=a.geometry.interpolateAlongEdge(d-.01/a.geometry.length),f=a.geometry.interpolateAlongEdge(d+.01/a.geometry.length).sub(e).per().uni(),g=Math.abs(f.x)>Math.abs(f.y)?EG.x:EG.y;if(a.geometry.bounds.containsPoint(b.target,c.expandElbowLegLength))return a.side=g.self,E7(a);let h=g.v(a.target[g.self]-2*a.bounds[g.size],a.target[g.cross]),i=g.v(a.target[g.self]+2*a.bounds[g.size],a.target[g.cross]),j=null,k=0,l=null,m=0,n=g.self;for(let b of a.geometry.intersectLineSegment(h,i,kE))!(1>Math.abs(b[g.self]-a.target[g.self]))&&(b[g.self]<a.target[g.self]?iK.ManhattanDist(b,a.target)>k&&(k=iK.ManhattanDist(b,a.target),j=b):iK.ManhattanDist(b,a.target)>m&&(m=iK.ManhattanDist(b,a.target),l=b));return j&&l?n=k>m?g.hiEdge:g.loEdge:j&&!l?n=g.hiEdge:!j&&l&&(n=g.loEdge),a.side=n,a}function Fa(a,b,c){let d=a.getBindingsFromShape(b,"arrow").find(a=>a.props.terminal===c);if(!d)return;let e=a.getShape(d.toId);if(!e)return;let f=a.getShapePageTransform(e),g="start"===c?"none"!==b.props.arrowheadStart:"none"!==b.props.arrowheadEnd,h=a.getShapeGeometry(e,g?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:e,transform:f,isClosed:h.isClosed,isExact:d.props.isExact,didIntersect:!1,geometry:h}}function Fb(a,b,c,d){let e=a.getShape(c.toId);if(!e)return new iK(0,0);{let{point:f,size:g}=a.getShapeGeometry(e).bounds,h=iK.Add(f,iK.MulV(c.props.isPrecise||d?c.props.normalizedAnchor:{x:.5,y:.5},g)),i=ku.applyToPoint(a.getShapePageTransform(e),h);return ku.applyToPoint(ku.Inverse(b),i)}}let Fc=fe("arrow bindings",(a,b)=>{let c=a.getBindingsFromShape(b.id,"arrow");return{start:c.find(a=>"start"===a.props.terminal),end:c.find(a=>"end"===a.props.terminal)}},{areRecordsEqual:(a,b)=>a.id===b.id,areResultsEqual:(a,b)=>a.start===b.start&&a.end===b.end});function Fd(a,b){return Fc.get(a,b.id)}let Fe=fe("arrow info",(a,b)=>{let c=Fd(a,b);if("elbow"===b.props.kind){let d=E1(a,b,c);if(!d?.route)return Ez(a,b,c);let e=d.swapOrder?d.B:d.A,f=d.swapOrder?d.A:d.B;return{type:"elbow",bindings:c,start:{handle:e.target,point:d.route.points[0],arrowhead:b.props.arrowheadStart},end:{handle:f.target,point:d.route.points[d.route.points.length-1],arrowhead:b.props.arrowheadEnd},elbow:d,route:d.route,isValid:!0}}return"arc"===b.props.kind&&Math.abs(b.props.bend)<8*b.props.scale?Ez(a,b,c):function(a,b,c){let{arrowheadEnd:d,arrowheadStart:e}=b.props,f=b.props.bend;if(Math.abs(f)>Math.abs(b.props.bend*(Fl*b.props.scale)))return Ez(a,b,c);let g=Fg(a,b,c),h=iK.Med(g.start,g.end),i=iK.Sub(g.end,g.start),j=iK.Len(i)?i.uni():iK.From(i),k=iK.Add(h,j.per().mul(-f)),l=Fa(a,b,"start"),m=Fa(a,b,"end"),n=g.start.clone(),o=g.end.clone(),p=k.clone();if(iK.Equals(n,o))return{bindings:c,type:"straight",start:{handle:n,point:n,arrowhead:b.props.arrowheadStart},end:{handle:o,point:o,arrowhead:b.props.arrowheadEnd},middle:p,isValid:!1,length:0};let q=b.props.bend<0,r=q?iX:iY,s=EB(n,o,p),t=iK.Angle(s.center,n),u=iK.Angle(s.center,o),v=r(t,u);if(0===s.length||0===s.size||!i7(s.length)||!i7(s.size))return Ez(a,b,c);let w=n.clone(),y=o.clone(),z=p.clone(),A=a.getShapePageTransform(b),B=0,C=0,D=Fj*b.props.scale;if(l&&!l.isExact){let c,d=ku.applyToPoint(A,w),f=ku.applyToPoint(A,s.center),g=ku.applyToPoint(A,y),h=ku.Inverse(l.transform),i=ku.applyToPoint(h,d),j=ku.applyToPoint(h,f),k=ku.applyToPoint(h,g),{isClosed:m}=l,n=Array.from(l.geometry.intersectCircle(j,s.radius,{includeLabels:!1,includeInternal:!1}));if(n.length){let a=j.angle(i),b=r(a,j.angle(k));n=n.filter(c=>r(a,j.angle(c))<=b);let d=.25*b;n.sort(m?(b,c)=>Math.abs(r(a,j.angle(b))-d)<Math.abs(r(a,j.angle(c))-d)?-1:1:(b,c)=>r(a,j.angle(b))<r(a,j.angle(c))?-1:1),c=n[0]}if(!c)if(m){let a=l.geometry.nearestPoint(i,{includeInternal:!1,includeLabels:!1});iK.DistMin(a,i,1)&&(c=a)}else c=i;if(c&&(w.setTo(a.getPointInShapeSpace(b,ku.applyToPoint(l.transform,c))),l.didIntersect=!0,"none"!==e)){let a=Fm[b.props.size]/2+("size"in l.shape.props?Fm[l.shape.props.size]/2:0);B=(Fk+a)*b.props.scale,D+=a*b.props.scale}}if(m&&!m.isExact){let c,e=ku.applyToPoint(A,w),f=ku.applyToPoint(A,y),g=ku.applyToPoint(A,s.center),h=ku.Inverse(m.transform),i=ku.applyToPoint(h,e),j=ku.applyToPoint(h,g),k=ku.applyToPoint(h,f),l=m.isClosed,n=Array.from(m.geometry.intersectCircle(j,s.radius,{includeLabels:!1,includeInternal:!1}));if(n.length){let a=j.angle(i),b=r(a,j.angle(k)),d=.75*b;(n=n.filter(c=>r(a,j.angle(c))<=b)).sort(l?(b,c)=>Math.abs(r(a,j.angle(b))-d)<Math.abs(r(a,j.angle(c))-d)?-1:1:(b,c)=>r(a,j.angle(b))<r(a,j.angle(c))?-1:1),c=n[0]}if(!c)if(l){let a=m.geometry.nearestPoint(k,{includeInternal:!1,includeLabels:!1});iK.DistMin(a,k,1)&&(c=a)}else c=k;if(c&&(y.setTo(a.getPointInShapeSpace(b,ku.applyToPoint(m.transform,c))),m.didIntersect=!0,"none"!==d)){let a=Fm[b.props.size]/2+("size"in m.shape.props?Fm[m.shape.props.size]/2:0);C=(Fk+a)*b.props.scale,D+=a*b.props.scale}}let E=iK.Angle(s.center,w),F=iK.Angle(s.center,y),G=r(E,F),H=G*s.radius,I=w.clone(),J=y.clone();if(0!==B&&I.setTo(s.center).add(iK.FromAngle(E+B/H*(q?1:-1)*G).mul(s.radius)),0!==C&&J.setTo(s.center).add(iK.FromAngle(F+C/H*(q?-1:1)*G).mul(s.radius)),iK.DistMin(I,J,D)){0!==B&&0!==C?(B*=-1.5,C*=-1.5):0!==B?B*=-2:0!==C&&(C*=-2);let a=.1-r(t,E)*s.radius,b=.1-r(F,u)*s.radius;B=Math.max(B,a),C=Math.max(C,b)}if(0!==B&&w.setTo(s.center).add(iK.FromAngle(E+B/H*(q?1:-1)*G).mul(s.radius)),0!==C&&y.setTo(s.center).add(iK.FromAngle(F+C/H*(q?-1:1)*G).mul(s.radius)),l&&m&&!l.isExact&&!m.isExact){H=(G=r(E=iK.Angle(s.center,w),F=iK.Angle(s.center,y)))*s.radius;let c=Fn(a,l.shape.id,m.shape.id);"double-bound"===c&&H<30?(w.setTo(n),y.setTo(o),z.setTo(p)):"safe"===c&&(l&&!l.didIntersect&&w.setTo(n),(m&&!m.didIntersect||r(t,E)>r(t,F))&&y.setTo(s.center).add(iK.FromAngle(E+G*(Math.min(.9,Fj*b.props.scale/H)*(q?1:-1))).mul(s.radius)))}(function(a,b,c,d,e,f,g){let h=iK.Angle(a,c),i=iX(h,iK.Angle(a,d));if(g||(i=iQ-i),e.setTo(a).add(iK.FromAngle(h+.5*(g?1:-1)*i).mul(b)),i>f){e.rotWith(a,iO);let b=d.clone();d.setTo(c),c.setTo(b)}})(s.center,s.radius,w,y,z,v,q),w.equals(y)&&(w.setTo(z.clone().addXY(1,1)),y.setTo(z.clone().subXY(1,1))),n.setTo(w),o.setTo(y),p.setTo(z);let K=EB(n,o,p);return{bindings:c,type:"arc",start:{point:n,handle:g.start,arrowhead:b.props.arrowheadStart},end:{point:o,handle:g.end,arrowhead:b.props.arrowheadEnd},middle:p,handleArc:s,bodyArc:K,isValid:0!==K.length&&isFinite(K.center.x)&&isFinite(K.center.y)}}(a,b,c)},{areRecordsEqual:(a,b)=>a.props===b.props,areResultsEqual:function(a,b,c=1e-6){return(0,b0.default)(a,b,(a,b)=>{if("number"==typeof a&&"number"==typeof b)return Math.abs(a-b)<c})}});function Ff(a,b){let c="string"==typeof b?b:b.id;return Fe.get(a,c)}function Fg(a,b,c){let d=a.getShapePageTransform(b),e=Fn(a,c.start?.toId,c.end?.toId);return{start:c.start?Fb(a,d,c.start,"double-bound"===e||"start-contains-end"===e):iK.From(b.props.start),end:c.end?Fb(a,d,c.end,"double-bound"===e||"end-contains-start"===e):iK.From(b.props.end)}}function Fh(a,b,c,d){let e="string"==typeof b?b:b.id,f="string"==typeof c?c:c.id,g=a.getBindingsFromShape(e,"arrow").filter(a=>a.props.terminal===d.terminal);g.length>1&&a.deleteBindings(g.slice(1));let h=g[0];h?a.updateBinding({...h,toId:f,props:d}):a.createBinding({type:"arrow",fromId:e,toId:f,props:d})}function Fi(a,b,c){let d=a.getBindingsFromShape(b,"arrow").filter(a=>a.props.terminal===c);a.deleteBindings(d)}let Fj=10,Fk=10,Fl=10,Fm={s:2,m:3.5,l:5,xl:10};function Fn(a,b,c){if(!b||!c)return"safe";if(b===c)return"double-bound";let d=a.getShapePageBounds(b),e=a.getShapePageBounds(c);if(d&&e){if(d.contains(e))return"start-contains-end";if(e.contains(d))return"end-contains-start"}return"safe"}let Fo=()=>{let a=jA();return d8("threeStackableItems",()=>a.getSelectedShapeIds().map(b=>a.getShape(b)).filter(b=>{if(!b)return!1;if(a.isShapeOfType(b,"arrow")){let c=Fd(a,b);if(c.start||c.end)return!1}return!0}).length>2,[a])},Fp=()=>{let a=jA();return d8("isInSelectState",()=>a.isIn("select"),[a])},Fq=()=>{let a=jA();return d8("allow group",()=>{let b=a.getSelectedShapes();if(b.length<2)return!1;for(let c of b)if(a.isShapeOfType(c,"arrow")){let d=Fd(a,c);if(d.start&&!b.some(a=>a.id===d.start.toId)||d.end&&!b.some(a=>a.id===d.end.toId))return!1}return!0},[a])},Fr=()=>{let a=jA();return d8("allowUngroup",()=>a.getSelectedShapeIds().some(b=>a.getShape(b)?.type==="group"),[a])};function Fs(a,b){let c=jA();return d8("selectedShapes",()=>{let d=c.getSelectedShapes().filter(a=>!c.isShapeOrAncestorLocked(a)).length;if(void 0===a)if(void 0===b)return d;else return d<=b;return void 0===b?d>=a:d>=a&&d<=b},[c])}function Ft(){let a=jA();return d8("hasLinkShapeSelected",()=>{let b=a.getOnlySelectedShape();return!!(b&&"embed"!==b.type&&"url"in b.props&&!b.isLocked)},[a])}function Fu(){let a=jA();return d8("useCanRedo",()=>a.getCanRedo(),[a])}function Fv(){let a=jA();return d8("useCanUndo",()=>a.getCanUndo(),[a])}function Fw(){let a=jA();return d8("canApplySelectionAction",()=>a.isIn("select")&&a.getSelectedShapeIds().length>0,[a])}function Fx(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Fy,{}),(0,bS.jsx)(Fz,{}),(0,bS.jsx)(FA,{}),(0,bS.jsx)(FB,{}),(0,bS.jsx)(FC,{}),(0,bS.jsx)(FE,{}),(0,bS.jsx)(FF,{}),(0,bS.jsx)(FG,{})]})}function Fy(){let a=Fs(2),b=Fp(),c=a&&b;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"align-left",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"align-center-horizontal",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"align-right",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"stretch-horizontal",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"align-top",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"align-center-vertical",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"align-bottom",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"stretch-vertical",disabled:!c})]})}function Fz(){let a=Fs(3),b=Fp(),c=a&&b;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"distribute-horizontal",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"distribute-vertical",disabled:!c})]})}function FA(){let a=Fo(),b=Fp(),c=a&&b;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"stack-horizontal",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"stack-vertical",disabled:!c})]})}function FB(){let a=Fs(1),b=Fp(),c=a&&b;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"send-to-back",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"send-backward",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"bring-forward",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"bring-to-front",disabled:!c})]})}function FC(){return A0()<AZ.TABLET_SM?(0,bS.jsx)(JC,{}):(0,bS.jsx)(FD,{})}function FD(){let a=Fs(1),b=Fp();return(0,bS.jsx)(Dd,{actionId:"rotate-ccw",disabled:!(a&&b)})}function FE(){let a=Fs(1),b=Fp();return(0,bS.jsx)(Dd,{actionId:"rotate-cw",disabled:!(a&&b)})}function FF(){let a=Ft(),b=Fp();return(0,bS.jsx)(Dd,{actionId:"edit-link",disabled:!(a&&b)})}function FG(){let a=Fq(),b=Fr();return a?(0,bS.jsx)(FH,{}):b?(0,bS.jsx)(FI,{}):(0,bS.jsx)(FH,{})}function FH(){let a=Fs(2),b=Fp();return(0,bS.jsx)(Dd,{actionId:"group",disabled:!(a&&b)})}function FI(){return(0,bS.jsx)(Dd,{actionId:"ungroup"})}let FJ=(0,bT.memo)(function({children:a}){let b=Am(),c=A0(),d=BE(),{orientation:e}=CW(),f=(0,bT.useRef)(null);qq(f);let g=jA(),h=d8("should display quick actions when in readonly",()=>g.isInAny("hand","zoom"),[g]),i=a??(0,bS.jsx)(Fx,{});if(!d||h)return(0,bS.jsxs)(Ew,{id:"actions-menu",children:[(0,bS.jsx)(Ex,{children:(0,bS.jsx)(C8,{type:"icon","data-testid":"actions-menu.button",title:b("actions-menu.title"),children:(0,bS.jsx)(AF,{icon:"horizontal"===e?"dots-vertical":"dots-horizontal",small:!0})})}),(0,bS.jsx)(Ey,{side:"horizontal"===e?c>=AZ.TABLET?"bottom":"top":"right",sideOffset:6,children:(0,bS.jsx)(C7,{ref:f,label:b("actions-menu.title"),className:"tlui-actions-menu","data-testid":"actions-menu.content",orientation:"grid",children:(0,bS.jsx)(A3,{type:"icons",sourceId:"actions-menu",children:i})})})]})});var BD=BD;function FK(){let a=jA(),b=A4(),c=d8("isSelectToolActive",()=>"select"===a.getCurrentToolId(),[a]),d=d8("isSinglePageMode",()=>a.options.maxPages<=1,[a]);return c?(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(J6,{}),(0,bS.jsxs)(De,{id:"modify",children:[(0,bS.jsx)(JN,{}),(0,bS.jsx)(JO,{}),(0,bS.jsx)(JR,{}),!d&&(0,bS.jsx)(JS,{})]}),(0,bS.jsx)(JF,{}),(0,bS.jsx)(JK,{}),(0,bS.jsx)(De,{id:"select-all",children:(0,bS.jsx)(JL,{})})]}):null}let FL=(0,bT.memo)(function({children:a,disabled:b=!1}){let c=jA(),d=Am(),{Canvas:e}=q_(),f=(0,bT.useCallback)(a=>{"Escape"===a.key&&(a.stopPropagation(),c.getContainer().focus())},[c]);(0,bT.useEffect)(()=>()=>{document.body.removeEventListener("keydown",f,{capture:!0})},[f]);let g=(0,bT.useCallback)(a=>{if(a){if(document.body.addEventListener("keydown",f,{capture:!0}),c.getInstanceState().isCoarsePointer){let a=c.getSelectedShapes(),b=c.inputs.getCurrentPagePoint(),d=c.getShapesAtPoint(b);if(!c.getSelectedShapes().length||!d.some(b=>a.includes(b))){let a=d.filter(a=>c.isShapeOrAncestorLocked(a));a.length&&c.select(...a.map(a=>a.id))}}}else{let a=c.getOnlySelectedShape();a&&c.isShapeOrAncestorLocked(a)&&c.setSelectedShapes([]),c.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",f,{capture:!0})})}},[c,f]),h=jG(),[i,j]=BQ("context menu",g),k=a??(0,bS.jsx)(FK,{});return(0,bS.jsxs)(BD.Root,{dir:"ltr",onOpenChange:j,modal:!1,children:[(0,bS.jsx)(BD.Trigger,{onContextMenu:void 0,dir:"ltr",disabled:b,children:e?(0,bS.jsx)(e,{}):null}),i&&(0,bS.jsx)(BD.Portal,{container:h,children:(0,bS.jsx)(BD.Content,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":d("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:jm,children:(0,bS.jsx)(A3,{type:"context-menu",sourceId:"context-menu",children:k})})})]})}),FM=d3(function(){let a=jA(),{isChatting:b,chatMessage:c}=a.getInstanceState(),d=(0,bT.useRef)(-1),[e,f]=(0,bT.useState)("");return((0,bT.useEffect)(()=>((!b&&c||b)&&(d.current=a.timers.setTimeout(()=>{a.updateInstanceState({chatMessage:"",isChatting:!1}),f(""),a.focus()},b?5e3:2e3)),()=>{clearTimeout(d.current)}),[a,c,b]),b)?(0,bS.jsx)(FP,{value:e,setValue:f,chatMessage:c}):c.trim()?(0,bS.jsx)(FO,{chatMessage:c}):null});function FN(a){let b=jA();(0,bT.useLayoutEffect)(()=>{if(!a.current)return;let{x:c,y:d}=b.inputs.getCurrentScreenPoint();function e(c){let{minX:d,minY:e}=b.getViewportScreenBounds();a.current?.style.setProperty("transform",`translate(${c.clientX-d}px, ${c.clientY-e}px)`)}return a.current?.style.setProperty("transform",`translate(${c}px, ${d}px)`),window.addEventListener("pointermove",e),()=>{window.removeEventListener("pointermove",e)}},[a,b])}let FO=({chatMessage:a})=>{let b=jA(),c=(0,bT.useRef)(null);return FN(c),(0,bS.jsx)("div",{ref:c,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:b.user.getColor()},children:a})},FP=d3(function({chatMessage:a,value:b,setValue:c}){let d=jA(),e=Am(),f=(0,bT.useRef)(null),g=a||e("cursor-chat.type-to-chat");FN(f),(0,bT.useLayoutEffect)(()=>{let a=f.current;if(!a)return;let c=d.textMeasure.measureText(b||g,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});a.style.setProperty("width",c.w+"px")},[d,b,g]),(0,bT.useLayoutEffect)(()=>{let a=d.timers.requestAnimationFrame(()=>{f.current?.focus()});return()=>{cancelAnimationFrame(a)}},[d]);let h=(0,bT.useCallback)(()=>{d.updateInstanceState({isChatting:!1}),d.focus()},[d]),i=(0,bT.useCallback)(a=>{let{value:b}=a.target;c(b.slice(0,64)),d.updateInstanceState({chatMessage:b})},[d,c]),j=(0,bT.useCallback)(a=>{let b=f.current;if(!b)return;let{value:d}=b;switch(a.key){case"Enter":if(jm(a),a.stopPropagation(),!d)return void h();c("");break;case"Escape":jm(a),a.stopPropagation(),h()}},[h,c]),k=(0,bT.useCallback)(a=>{a.stopPropagation()},[]);return(0,bS.jsx)("input",{ref:f,className:"tl-cursor-chat",style:{backgroundColor:d.user.getColor()},onBlur:h,onChange:i,onKeyDown:j,onPaste:k,value:b,placeholder:g,spellCheck:!1})});function FQ({checked:a}){let b=Am();return(0,bS.jsx)(AD,{"data-checked":!!a,label:b(a?"ui.checked":"ui.unchecked"),icon:a?"check":"none",className:"tlui-button__icon",small:!0})}var BD=BD,BL=BL;function FR({id:a,kbd:b,label:c,lang:d,readonlyOk:e,onSelect:f,toggle:g=!1,disabled:h=!1,checked:i=!1}){let{type:j,sourceId:k}=A2(),l=BE(),m=Am();if(l&&!e)return null;let n=Jo(c,j),o=n?m(n):void 0;switch(j){case"menu":return(0,bS.jsxs)(BL.CheckboxItem,{dir:"ltr",lang:d,className:"tlui-button tlui-button__menu tlui-button__checkbox",title:o,onSelect:a=>{f?.(k),jm(a)},disabled:h,checked:i,children:[(0,bS.jsx)(AD,{small:!0,label:m(i?"ui.checked":"ui.unchecked"),icon:g?i?"toggle-on":"toggle-off":i?"check":"none"}),o&&(0,bS.jsx)("span",{className:"tlui-button__label",draggable:!1,children:o}),b&&(0,bS.jsx)(B$,{children:b})]});case"context-menu":return(0,bS.jsxs)(BD.CheckboxItem,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",lang:d,title:o,onSelect:a=>{f(k),jm(a)},disabled:h,checked:i,children:[(0,bS.jsx)(AD,{small:!0,label:m(i?"ui.checked":"ui.unchecked"),icon:g?i?"toggle-on":"toggle-off":i?"check":"none"}),o&&(0,bS.jsx)("span",{className:"tlui-button__label",draggable:!1,children:o}),b&&(0,bS.jsx)(B$,{children:b})]},a);default:return null}}var BD=BD;function FS({id:a,disabled:b=!1,label:c,size:d="small",children:e}){let{type:f,sourceId:g}=A2(),h=jG(),i=Am(),j=c?"string"==typeof c?c:c[f]??c.default:void 0,k=j?i(j):void 0;switch(f){case"menu":return(0,bS.jsxs)(BU,{id:`${g}-sub.${a}`,children:[(0,bS.jsx)(BV,{id:`${g}-sub.${a}-button`,disabled:b,label:k,title:k}),(0,bS.jsx)(BW,{id:`${g}-sub.${a}-content`,size:d,children:e})]});case"context-menu":if(b)return null;return(0,bS.jsxs)(FT,{id:`${g}-sub.${a}`,children:[(0,bS.jsx)(BD.ContextMenuSubTrigger,{dir:"ltr",disabled:b,asChild:!0,children:(0,bS.jsxs)(Ao,{"data-testid":`${g}-sub.${a}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,bS.jsx)(AB,{children:k}),(0,bS.jsx)(AF,{icon:"chevron-right",small:!0})]})}),(0,bS.jsx)(BD.ContextMenuPortal,{container:h,children:(0,bS.jsx)(BD.ContextMenuSubContent,{"data-testid":`${g}-sub.${a}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":d,children:e})})]});default:return e}}function FT({id:a,children:b}){let[c,d]=BQ(a);return(0,bS.jsx)(BD.ContextMenuSub,{open:c,onOpenChange:d,children:b})}function FU({customDebugFlags:a,customFeatureFlags:b}){let c=jA(),{addToast:d}=D$(),{addDialog:e}=Dh(),[f,g]=bT.default.useState(!1);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(De,{id:"items",children:[(0,bS.jsx)(Db,{id:"hard-reset",onSelect:jL,label:"Hard reset"}),(0,bS.jsx)(Db,{id:"add-toast",onSelect:()=>{d({id:cs(void 0),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),d({id:cs(void 0),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),d({id:cs(void 0),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),d({id:cs(void 0),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,bS.jsx)(Db,{id:"show-dialog",label:"Show dialog",onSelect:()=>{e({component:({onClose:a})=>(0,bS.jsx)(FX,{displayDontShowAgain:!0,onCancel:()=>a(),onContinue:()=>a()}),onClose:()=>{}})}}),(0,bS.jsx)(Db,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>(function(a,b){let c=a.options.adjacentShapeMargin,d=Array(100),e=Math.floor(Math.sqrt(100));for(let a=0;a<100;a++)FZ++,d[a]={id:gi("box"+FZ),type:"geo",x:a%e*(100+c),y:Math.floor(a/e)*(100+c)};a.run(()=>{a.createShapes(d).setSelectedShapes(d.map(a=>a.id))})})(c,100)}),(0,bS.jsx)(Db,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{let a=c.getSelectedShapes(),b=0===a.length?c.getRenderingShapes():a;window.alert(`Shapes ${b.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(f)throw Error("oh no!");return null})(),(0,bS.jsx)(Db,{id:"throw-error",onSelect:()=>g(!0),label:"Throw error"})]}),(0,bS.jsxs)(De,{id:"flags",children:[(0,bS.jsx)(FV,{customDebugFlags:a}),(0,bS.jsx)(FW,{customFeatureFlags:b})]})]})}function FV(a){let b=Object.values(a.customDebugFlags??ji);return b.length?(0,bS.jsx)(FS,{id:"debug flags",label:"Debug flags",children:(0,bS.jsx)(De,{id:"debug flags",children:b.map(a=>(0,bS.jsx)(FY,{flag:a},a.name))})}):null}function FW(a){let b=Object.values(a.customFeatureFlags??jg);return b.length?(0,bS.jsx)(FS,{id:"feature flags",label:"Feature flags",children:(0,bS.jsx)(De,{id:"feature flags",children:b.map(a=>(0,bS.jsx)(FY,{flag:a},a.name))})}):null}function FX({title:a="title",body:b="hello hello hello",cancel:c="Cancel",confirm:d="Continue",displayDontShowAgain:e=!1,maxWidth:f="350",onCancel:g,onContinue:h}){let[i,j]=bT.default.useState(!1);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(AG,{children:[(0,bS.jsx)(AH,{children:a}),(0,bS.jsx)(AI,{})]}),(0,bS.jsx)(AJ,{style:{maxWidth:f},children:b}),(0,bS.jsxs)(AK,{className:"tlui-dialog__footer__actions",children:[e&&(0,bS.jsxs)(Ao,{type:"normal",onClick:()=>j(!i),style:{marginRight:"auto"},children:[(0,bS.jsx)(FQ,{checked:i}),(0,bS.jsx)(AB,{children:"Don’t show again"})]}),(0,bS.jsx)(Ao,{type:"normal",onClick:g,children:(0,bS.jsx)(AB,{children:c})}),(0,bS.jsx)(Ao,{type:"primary",onClick:async()=>h(),children:(0,bS.jsx)(AB,{children:d})})]})]})}let FY=d3(function({flag:a,onChange:b}){let c=a.get();return(0,bS.jsx)(FR,{id:a.name,title:a.name,label:a.name.replace(/([a-z0-9])([A-Z])/g,a=>`${a[0]} ${a[1].toLowerCase()}`).replace(/^[a-z]/,a=>a.toUpperCase()),checked:c,onSelect:()=>{a.set(!c),b?.(!c)}})}),FZ=0;function F$({children:a}){let b=a??(0,bS.jsx)(FU,{});return(0,bS.jsxs)(BR,{id:"debug",children:[(0,bS.jsx)(BS,{children:(0,bS.jsx)(Ao,{type:"icon",title:"Debug menu",children:(0,bS.jsx)(AF,{icon:"dots-horizontal"})})}),(0,bS.jsx)(BT,{side:"top",align:"end",alignOffset:0,children:(0,bS.jsx)(A3,{type:"menu",sourceId:"debug-panel",children:b})})]})}let F_=(0,bT.memo)(function(){let{DebugMenu:a}=Ji(),b=(0,bT.useRef)(null);return qq(b),(0,bS.jsxs)("footer",{ref:b,className:"tlui-debug-panel",children:[(0,bS.jsx)(F0,{}),(0,bS.jsx)(F1,{}),a&&(0,bS.jsx)(a,{})]})}),F0=d3(function(){let a=jA().getPath();return(0,bS.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${a}`})});function F1(){let a=jA(),b=d8("show_fps",()=>ji.showFps.get(),[ji]),c=(0,bT.useRef)(null);return((0,bT.useEffect)(()=>{if(!b)return;let d=0,e=-1,f=performance.now(),g=0,h=0,i=!1;return!function b(){if(h++,(g=performance.now()-f)>250){let a=Math.round(250/g*h*4);a>d&&(d=a);let b=.75*d;(a<b&&!i||a>=b&&i)&&(i=!i),c.current.innerHTML=`FPS ${a.toString()} (max: ${d})`,c.current.className="tlui-debug-panel__fps"+(i?" tlui-debug-panel__fps__slow":""),g-=250,h=0,f=performance.now()}e=a.timers.requestAnimationFrame(b)}(),()=>{cancelAnimationFrame(e)}},[b,a]),b)?(0,bS.jsx)("div",{ref:c}):null}function F2(){let a=jA(),b=d8("follow",()=>a.getInstanceState().followingUserId,[a]);return b?(0,bS.jsx)(F3,{userId:b}):null}function F3({userId:a}){let b=rQ(a);return b?(0,bS.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:b.color}}):null}let F4=(0,bT.memo)(function(){let a=A0(),b=Am(),c=(0,bT.useRef)(null);qq(c);let{MainMenu:d,QuickActions:e,ActionsMenu:f,PageMenu:g}=Ji(),h=jA(),i=d8("isSinglePageMode",()=>h.options.maxPages<=1,[h]),j="menu"===h.options.actionShortcutsLocation||"toolbar"!==h.options.actionShortcutsLocation&&a>=AZ.TABLET;return d||g||j?(0,bS.jsx)("nav",{ref:c,className:"tlui-menu-zone",children:(0,bS.jsxs)(CX,{children:[d&&(0,bS.jsx)(d,{}),g&&!i&&(0,bS.jsx)(g,{}),j?(0,bS.jsxs)(C7,{orientation:"horizontal",label:b("actions-menu.title"),children:[e&&(0,bS.jsx)(e,{}),f&&(0,bS.jsx)(f,{})]}):null]})}):null});var AC=AC;let F5=({id:a,component:b,preventBackgroundClose:c})=>{let{removeDialog:d}=Dh(),e=(0,bT.useRef)(!1),f=jG(),g=(0,bT.useCallback)(b=>{b||d(a)},[a,d]);return(0,bS.jsx)(AC.Root,{onOpenChange:g,defaultOpen:!0,children:(0,bS.jsx)(AC.Portal,{container:f,children:(0,bS.jsx)(AC.Overlay,{dir:"ltr",className:"tlui-dialog__overlay",onClick:a=>{!e.current&&(c||a.target!==a.currentTarget||g(!1))},children:(0,bS.jsx)(AC.Content,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>e.current=!0,onMouseUp:()=>e.current=!1,onInteractOutside:a=>{e.current=!1,c&&a.preventDefault()},children:(0,bS.jsx)(b,{onClose:()=>{e.current=!1,g(!1)}})})})})})},F6=(0,bT.memo)(function(){let{dialogs:a}=Dh();return d8("dialogs",()=>a.get(),[a]).map(a=>(0,bS.jsx)(F5,{...a},a.id))});function F7(){let a=jA(),b=Jn(),[c,d]=(0,bT.useState)(!1),e=(0,bT.useRef)(!1);return(d6("toggle showback to content",()=>{let b=e.current,c=a.getCurrentPageShapeIds(),f=!1;c.size&&(f=c.size===a.getNotVisibleShapes().size),b!==f&&(d(f),e.current=f)},[a]),c)?(0,bS.jsx)(Dd,{actionId:"back-to-content",onSelect:()=>{b["back-to-content"].onSelect("helper-buttons"),d(!1)}}):null}function F8(){let a=jA();return d8("is pen mode",()=>a.getInstanceState().isPenMode,[a])?(0,bS.jsx)(Dd,{actionId:"exit-pen-mode"}):null}function F9(){let a=jA(),b=Jn();return d8("is following user",()=>!!a.getInstanceState().followingUserId,[a])?(0,bS.jsx)(Db,{...b["stop-following"]}):null}function Ga(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(F8,{}),(0,bS.jsx)(F7,{}),(0,bS.jsx)(F9,{})]})}function Gb({children:a}){let b=a??(0,bS.jsx)(Ga,{});return(0,bS.jsx)("div",{className:"tlui-helper-buttons",children:(0,bS.jsx)(A3,{type:"helper-buttons",sourceId:"helper-buttons",children:b})})}var BL=BL;let Gc=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function Gd(){let a=jA(),b=BP(),c=d8("colorScheme",()=>a.user.getUserPreferences().colorScheme??(a.user.getIsDarkMode()?"dark":"light"),[a]);return(0,bS.jsx)(FS,{id:"help menu color-scheme",label:"menu.theme",children:(0,bS.jsx)(De,{id:"theme",children:Gc.map(({colorScheme:d,label:e})=>(0,bS.jsx)(FR,{id:`color-scheme-${d}`,label:e,checked:d===c,readonlyOk:!0,onSelect:()=>{a.user.updateUserPreferences({colorScheme:d}),b("color-scheme",{source:"menu",value:d})}},d))})})}function Ge(){let a=jB(),b=BP(),c=d8("locale",()=>a?.user.getLocale(),[a]);return a?(0,bS.jsx)(FS,{id:"help menu language",label:"menu.language",children:(0,bS.jsx)(De,{id:"languages",className:"tlui-language-menu",children:iz.map(({locale:d,label:e})=>(0,bS.jsx)(FR,{id:`language-${d}`,lang:d,title:d,label:e,checked:d===c,readonlyOk:!0,onSelect:()=>{a.user.updateUserPreferences({locale:d}),b("change-language",{source:"menu",locale:d})}},d))})}):null}function Gf(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Ge,{}),(0,bS.jsx)(Gg,{})]})}function Gg(){let{KeyboardShortcutsDialog:a}=Ji(),{addDialog:b}=Dh(),c=(0,bT.useCallback)(()=>{a&&b({component:a})},[b,a]);return a?(0,bS.jsx)(Db,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:c}):null}let Gh=["auto","trackpad","mouse"];function Gi(){let a=jA(),b=BP(),c=d8("inputMode",()=>a.user.getUserPreferences().inputMode,[a]),d=d8("wheelBehavior",()=>a.getCameraOptions().wheelBehavior,[a]);return(0,bS.jsxs)(FS,{id:"help menu input-mode",label:"menu.input-device",children:[(0,bS.jsx)(De,{id:"peripheral-mode",children:Gh.map(e=>(0,bS.jsx)(FR,{id:`peripheral-mode-${e}`,label:"auto"===e?`action.toggle-auto-${d}`:"trackpad"===e?"action.toggle-trackpad":"action.toggle-mouse",checked:"auto"===e?null===c:c===e,readonlyOk:!0,onSelect:()=>{switch(b("input-mode",{source:"menu",value:e}),e){case"auto":a.user.updateUserPreferences({inputMode:null});break;case"trackpad":a.user.updateUserPreferences({inputMode:"trackpad"});break;case"mouse":a.user.updateUserPreferences({inputMode:"mouse"})}}},e))}),(0,bS.jsx)(De,{id:"invert-zoom-group",children:(0,bS.jsx)(J_,{})})]})}function Gj(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(De,{id:"basic",children:[(0,bS.jsx)(Gl,{}),(0,bS.jsx)(Gp,{}),(0,bS.jsx)(Gk,{}),(0,bS.jsx)(Gq,{})]}),(0,bS.jsx)(Gr,{})]})}function Gk(){return(0,bS.jsxs)(FS,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,bS.jsxs)(De,{id:"export-all-as-group",children:[(0,bS.jsx)(Dd,{actionId:"export-all-as-svg"}),(0,bS.jsx)(Dd,{actionId:"export-all-as-png"})]}),(0,bS.jsx)(De,{id:"export-all-as-bg",children:(0,bS.jsx)(JA,{})})]})}function Gl(){return(0,bS.jsxs)(FS,{id:"edit",label:"menu.edit",children:[(0,bS.jsx)(Go,{}),(0,bS.jsx)(JF,{}),(0,bS.jsx)(JK,{}),(0,bS.jsx)(Gm,{}),(0,bS.jsx)(Gn,{}),(0,bS.jsx)(De,{id:"select-all",children:(0,bS.jsx)(JL,{})})]})}function Gm(){return(0,bS.jsxs)(De,{id:"misc",children:[(0,bS.jsx)(Jv,{}),(0,bS.jsx)(Jw,{}),(0,bS.jsx)(Jr,{}),(0,bS.jsx)(Jq,{}),(0,bS.jsx)(Jx,{}),(0,bS.jsx)(Jy,{}),(0,bS.jsx)(JU,{}),(0,bS.jsx)(JT,{}),(0,bS.jsx)(Jt,{})]})}function Gn(){return(0,bS.jsxs)(De,{id:"lock",children:[(0,bS.jsx)(Jz,{}),(0,bS.jsx)(JB,{})]})}function Go(){let a=Fv(),b=Fu();return(0,bS.jsxs)(De,{id:"undo-redo",children:[(0,bS.jsx)(Dd,{actionId:"undo",disabled:!a}),(0,bS.jsx)(Dd,{actionId:"redo",disabled:!b})]})}function Gp(){return(0,bS.jsx)(FS,{id:"view",label:"menu.view",children:(0,bS.jsxs)(De,{id:"view-actions",children:[(0,bS.jsx)(Dd,{actionId:"zoom-in"}),(0,bS.jsx)(Dd,{actionId:"zoom-out"}),(0,bS.jsx)(JC,{}),(0,bS.jsx)(JD,{}),(0,bS.jsx)(JE,{})]})})}function Gq(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"insert-embed"}),(0,bS.jsx)(Dd,{actionId:"insert-media"})]})}function Gr(){return(0,bS.jsxs)(De,{id:"preferences",children:[(0,bS.jsxs)(FS,{id:"preferences",label:"menu.preferences",children:[(0,bS.jsxs)(De,{id:"preferences-actions",children:[(0,bS.jsx)(JV,{}),(0,bS.jsx)(JW,{}),(0,bS.jsx)(JX,{}),(0,bS.jsx)(JY,{}),(0,bS.jsx)(JZ,{}),(0,bS.jsx)(J$,{}),(0,bS.jsx)(J4,{}),(0,bS.jsx)(J5,{}),(0,bS.jsx)(J3,{})]}),(0,bS.jsxs)(De,{id:"user-interface-submenus",children:[(0,bS.jsx)(Gd,{}),(0,bS.jsx)(J7,{}),(0,bS.jsx)(Gi,{})]})]}),(0,bS.jsx)(Ge,{}),(0,bS.jsx)(Gg,{})]})}let Gs=(0,bT.memo)(function({children:a}){let b=jG(),[c,d]=BQ("main menu"),e=Am(),f=a??(0,bS.jsx)(Gj,{});return(0,bS.jsxs)(BL.Root,{dir:"ltr",open:c,onOpenChange:d,modal:!1,children:[(0,bS.jsx)(BL.Trigger,{asChild:!0,dir:"ltr",children:(0,bS.jsx)(Ao,{type:"icon","data-testid":"main-menu.button",title:e("menu.title"),children:(0,bS.jsx)(AF,{icon:"menu",small:!0})})}),(0,bS.jsx)(BL.Portal,{container:b,children:(0,bS.jsx)(BL.Content,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,bS.jsx)(A3,{type:"menu",sourceId:"main-menu",children:f})})})]})}),Gt={};function Gu(a){if(Gt[a])return Gt[a];let b=document.createElement("canvas").getContext("2d");b.fillStyle=a,b.fillRect(0,0,1,1);let[c,d,e,f]=b.getImageData(0,0,1,1).data,g=new Float32Array([c/255,d/255,e/255,f/255]);return Gt[a]=g,g}function Gv(a,{center:b,radius:c,numArcSegments:d=20,startAngle:e=0,endAngle:f=iQ,offset:g=0}){let h=(f-e)/d,i=g;for(let d=e;d<f;d+=h)a[i++]=b.x,a[i++]=b.y,a[i++]=b.x+Math.cos(d)*c,a[i++]=b.y+Math.sin(d)*c,a[i++]=b.x+Math.cos(d+h)*c,a[i++]=b.y+Math.sin(d+h)*c;return a}function Gw(a,b,c,d,e,f){a[b++]=c,a[b++]=d,a[b++]=c,a[b++]=d+f,a[b++]=c+e,a[b++]=d,a[b++]=c+e,a[b++]=d,a[b++]=c,a[b++]=d+f,a[b++]=c+e,a[b++]=d+f}function Gx(a,b){let c=a.createBuffer();if(!c)throw Error("Failed to create buffer");return{buffer:c,vertices:new Float32Array(b)}}function Gy(a,b,c){let d=a.vertices.length;for(;d<b+c.length;)d*=2;if(d!=a.vertices.length){let b=new Float32Array(d);b.set(a.vertices),a.vertices=b}a.vertices.set(c,b)}var Gz=Object.create,GA=Object.defineProperty,GB=Object.getOwnPropertyDescriptor,GC=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),GD=a=>{throw TypeError(a)},GE=(a,b,c)=>b in a?GA(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,GF=(a,b)=>GA(a,"name",{value:b,configurable:!0}),GG=["class","method","getter","setter","accessor","field","value","get","set"],GH=a=>void 0!==a&&"function"!=typeof a?GD("Function expected"):a,GI=(a,b,c,d,e)=>({kind:GG[a],name:b,metadata:d,addInitializer:a=>c._?GD("Already initialized"):e.push(GH(a||null))}),GJ=(a,b)=>GE(b,GC("metadata"),a[3]),GK=(a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=GG[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&GB(l<4?e:{get[c](){return GO(this,f)},set[c](x){return GP(this,f,x)}},c));l?n&&l<4&&GF(f,(l>2?"set ":l>1?"get ":"")+c):GF(e,c);for(var t=d.length-1;t>=0;t--)j=GI(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>GN(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?GO:GQ)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>GP(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?GH(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?GD("Object expected"):(GH(g=h.get)&&(s.get=g),GH(g=h.set)&&(s.set=g),GH(g=h.init)&&q.unshift(g));return l||GJ(a,e),s&&GA(e,c,s),n?4^l?f:s:e},GL=(a,b,c)=>GE(a,"symbol"!=typeof b?b+"":b,c),GM=(a,b,c)=>b.has(a)||GD("Cannot "+c),GN=(a,b)=>Object(b)!==b?GD('Cannot use the "in" operator on this value'):a.has(b),GO=(a,b,c)=>(GM(a,b,"read from private field"),c?c.call(a):b.get(a)),GP=(a,b,c,d)=>(GM(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),GQ=(a,b,c)=>(GM(a,b,"access private method"),c);bL=[ch],bK=[dQ],bJ=[dQ],bI=[dQ],bH=[dQ],bG=[dQ],bF=[dQ],bE=[dQ],bD=[dQ],bC=[ch];class GR{constructor(a,b,c){this.editor=a,this.elem=b,this.container=c,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bM,5,this),GL(this,"disposables",[]),GL(this,"gl"),GL(this,"shapeGeometryCache"),GL(this,"colors"),GL(this,"id",function(a){return cs(void 0)}()),GL(this,"canvasBoundingClientRect",d$("canvasBoundingClientRect",new kt)),GL(this,"originPagePoint",new iK),GL(this,"originPageCenter",new iK),GL(this,"isInViewport",!1),this.gl=function(a){if(!a)throw Error("Canvas element not found");let b=a.getContext("webgl2",{premultipliedAlpha:!1});if(!b)throw Error("Failed to get webgl2 context");let c=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,d=b.createShader(b.VERTEX_SHADER);if(!d)throw Error("Failed to create vertex shader");if(b.shaderSource(d,c),b.compileShader(d),!b.getShaderParameter(d,b.COMPILE_STATUS))throw Error("Failed to compile vertex shader");let e=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,f=b.createShader(b.FRAGMENT_SHADER);if(!f)throw Error("Failed to create fragment shader");if(b.shaderSource(f,e),b.compileShader(f),!b.getShaderParameter(f,b.COMPILE_STATUS))throw Error("Failed to compile fragment shader");let g=b.createProgram();if(!g)throw Error("Failed to create program");if(b.attachShader(g,d),b.attachShader(g,f),b.linkProgram(g),!b.getProgramParameter(g,b.LINK_STATUS))throw Error("Failed to link program");b.useProgram(g);let h=b.getAttribLocation(g,"shapeVertexPosition");if(h<0)throw Error("Failed to get shapeVertexPosition attribute location");b.enableVertexAttribArray(h);let i=b.getUniformLocation(g,"canvasPageBounds"),j=b.getUniformLocation(g,"fillColor");if(!b.createBuffer()||!b.createBuffer())throw Error("Failed to create buffer");return{context:b,selectedShapes:Gx(b,1024),unselectedShapes:Gx(b,4096),viewport:Gx(b,300),collaborators:Gx(b,1024),prepareTriangles(a,c){b.bindBuffer(b.ARRAY_BUFFER,a.buffer),b.bufferData(b.ARRAY_BUFFER,a.vertices,b.STATIC_DRAW,0,c),b.enableVertexAttribArray(h),b.vertexAttribPointer(h,2,b.FLOAT,!1,0,0)},drawTrianglesTransparently(a){b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.drawArrays(b.TRIANGLES,0,a/2),b.disable(b.BLEND)},drawTriangles(a){b.drawArrays(b.TRIANGLES,0,a/2)},setFillColor(a){b.uniform4fv(j,a)},setCanvasPageBounds(a){b.uniform4fv(i,a)}}}(b),this.shapeGeometryCache=a.store.createComputedCache("webgl-geometry",b=>{let c=a.getShapeMaskedPageBounds(b.id);if(!c)return null;let d=new Float32Array(12);return Gw(d,0,c.x,c.y,c.w,c.h),d}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),dA("minimap render",this.render))}close(){return this.disposables.forEach(a=>a())}_getColors(){let a=getComputedStyle(this.editor.getContainer());return{shapeFill:Gu(a.getPropertyValue("--tl-color-text-3").trim()),selectFill:Gu(a.getPropertyValue("--tl-color-selected").trim()),viewportFill:Gu(a.getPropertyValue("--tl-color-muted-1").trim()),background:Gu(a.getPropertyValue("--tl-color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){let a=this.editor.getViewportPageBounds(),b=this.editor.getCurrentPageBounds();return b?kt.Expand(b,a):a}getContentScreenBounds(){let a=this.getContentPageBounds(),b=this.editor.pageToScreen(a.point),c=this.editor.pageToScreen(new iK(a.maxX,a.maxY));return new kt(b.x,b.y,c.x-b.x,c.y-b.y)}_getCanvasBoundingRect(){let{x:a,y:b,width:c,height:d}=this.elem.getBoundingClientRect();return new kt(a,b,c,d)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){let a=new ResizeObserver(()=>{let a=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(a)});return a.observe(this.elem),a.observe(this.container),()=>a.disconnect()}getCanvasSize(){let a=this.canvasBoundingClientRect.get(),b=this.getDpr();return new iK(a.width*b,a.height*b)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){let a=this.getCanvasScreenBounds(),b=this.getContentPageBounds(),c=a.width/a.height,d=b.width,e=d/c;e<b.height&&(d=(e=b.height)*c);let f=new kt(0,0,d,e);return f.center=b.center,f}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){let{x:a,y:b,w:c,h:d}=this.getCanvasPageBounds();return new Float32Array([a,b,c,d])}getMinimapPagePoint(a,b){let c=this.getCanvasPageBounds(),d=this.getCanvasScreenBounds(),e=a-d.x,f=b-d.y;return e*=c.width/d.width,f*=c.height/d.height,new iK(e+=c.minX,f+=c.minY,1)}minimapScreenPointToPagePoint(a,b,c=!1,d=!1){let{editor:e}=this,f=e.getViewportPageBounds(),{x:g,y:h}=this.getMinimapPagePoint(a,b);if(d){let a=this.editor.getCurrentPageBounds()??new kt,b=a.minX-f.width/2,c=a.maxX+f.width/2,d=a.minY-f.height/2,e=a.maxY+f.height/2,i=Math.max(0,b+f.width-g),j=Math.max(0,-(c-f.width-g)),k=Math.max(0,d+f.height-h),l=Math.max(0,-(e-f.height-h));g+=(i-j)/2,h+=(k-l)/2,g=iS(g,b,c),h=iS(h,d,e)}if(c){let{originPagePoint:a}=this;Math.abs(g-a.x)>Math.abs(h-a.y)?h=a.y:g=a.x}return new iK(g,h)}render(){let a=this.gl.context,b=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=b.x,this.elem.height=b.y,a.viewport(0,0,b.x,b.y),a.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),a.clear(a.COLOR_BUFFER_BIT);let c=new Set(this.editor.getSelectedShapeIds()),d=this.colors,e=0,f=0,g=this.editor.getCurrentPageShapeIdsSorted();for(let a=0,b=g.length;a<b;a++){let b=g[a],d=this.shapeGeometryCache.get(b);if(!d)continue;let h=d.length,i=this.editor.getShape(b);if(i){let a=this.editor.getShapeUtil(i.type);if(a.hideInMinimap?.(i))continue}c.has(b)?(Gy(this.gl.selectedShapes,e,d),e+=h):(Gy(this.gl.unselectedShapes,f,d),f+=h)}this.drawShapes(this.gl.unselectedShapes,f,d.shapeFill),this.drawShapes(this.gl.selectedShapes,e,d.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(a,b,c){this.gl.prepareTriangles(a,b),this.gl.setFillColor(c),this.gl.drawTriangles(b)}drawViewport(){let a=this.editor.getViewportPageBounds(),b=function(a,b,c){c=Math.min(c,Math.min(b.w,b.h)/2);let d=kt.ExpandBy(b,-c);if(d.w<=0||d.h<=0)return Gv(a,{center:b.center,radius:c,numArcSegments:40}),240;let e=0;return Gw(a,0,d.minX,d.minY,d.w,d.h),Gw(a,e+=12,d.minX,b.minY,d.w,c),Gw(a,e+=12,d.maxX,d.minY,c,d.h),Gw(a,e+=12,d.minX,d.maxY,d.w,c),Gw(a,e+=12,b.minX,d.minY,c,d.h),Gv(a,{numArcSegments:10,offset:e+=12,center:d.point,radius:c,startAngle:iO,endAngle:1.5*iO}),Gv(a,{numArcSegments:10,offset:e+=60,center:iK.Add(d.point,new iK(d.w,0)),radius:c,startAngle:1.5*iO,endAngle:iQ}),Gv(a,{numArcSegments:10,offset:e+=60,center:iK.Add(d.point,d.size),radius:c,startAngle:0,endAngle:iP}),Gv(a,{numArcSegments:10,offset:e+=60,center:iK.Add(d.point,new iK(0,d.h)),radius:c,startAngle:iP,endAngle:iO}),300}(this.gl.viewport.vertices,a,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,b),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(b)}drawCollaborators(){let a=this.editor.getCollaboratorsOnCurrentPage();if(!a.length)return;let b=120*a.length;this.gl.collaborators.vertices.length<b&&(this.gl.collaborators.vertices=new Float32Array(b));let c=this.gl.collaborators.vertices,d=0,e=this.getZoom();for(let{cursor:b}of a)b&&(Gv(c,{center:iK.From(b),radius:3*e,offset:d,numArcSegments:20}),d+=120);for(let{color:c}of(this.gl.prepareTriangles(this.gl.collaborators,b),d=0,a))this.gl.setFillColor(Gu(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,d/2,60),d+=120}}function GS(){let a=jA(),b=jG(),c=Am(),d=bT.useRef(null),e=bT.useRef(!1),f=bT.useRef(void 0);bT.useEffect(()=>{try{return f.current=new GR(a,d.current,b),f.current.close}catch(b){a.annotateError(b,{origin:"minimap",willCrashApp:!1}),a.timers.setTimeout(()=>{throw b})}},[a,b]);let g=bT.useCallback(b=>{if(!a.getCurrentPageShapeIds().size||!f.current)return;let c=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!1),d=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!0);f.current.originPagePoint.setTo(d),f.current.originPageCenter.setTo(a.getViewportPageBounds().center),a.centerOnPoint(c,{animation:{duration:a.options.animationMediumMs}})},[a]),h=bT.useCallback(b=>{if(!f.current)return;let c=b.currentTarget;if(jn(c,b),!a.getCurrentPageShapeIds().size)return;e.current=!0,f.current.isInViewport=!1;let d=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!1),g=a.getViewportPageBounds(),h=f.current.getContentPageBounds();if(new kt(h.x-g.width/2,h.y-g.height/2,h.width+g.width,h.height+g.height).containsPoint(d)&&!g.containsPoint(d)){f.current.isInViewport=g.containsPoint(d);let b=iK.Sub(g.center,g.point),c=iK.Add(d,b);f.current.originPagePoint.setTo(c),f.current.originPageCenter.setTo(d),a.centerOnPoint(d,{animation:{duration:a.options.animationMediumMs}})}else{let a=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,!1,!0);f.current.isInViewport=g.containsPoint(a),f.current.originPagePoint.setTo(a),f.current.originPageCenter.setTo(g.center)}document.body.addEventListener("pointerup",function a(b){c&&jo(c,b),e.current=!1,document.body.removeEventListener("pointerup",a)})},[a]),i=bT.useCallback(b=>{if(!f.current)return;let c=f.current.minimapScreenPointToPagePoint(b.clientX,b.clientY,b.shiftKey,!0);if(e.current){if(f.current.isInViewport){let b=f.current.originPagePoint.clone().sub(f.current.originPageCenter);a.centerOnPoint(iK.Sub(c,b));return}a.centerOnPoint(c)}let d=f.current.getMinimapPagePoint(b.clientX,b.clientY),g=a.pageToScreen(d),h={type:"pointer",target:"canvas",name:"pointer_move",...js(a,b),point:g,isPen:a.getInstanceState().isPenMode};a.dispatch(h)},[a]),j=bT.useCallback(b=>{let c=rG(b);a.dispatch({type:"wheel",name:"wheel",delta:c,point:new iK(b.clientX,b.clientY),shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:jr(b)})},[a]),k=pC();return bT.useEffect(()=>{a.timers.setTimeout(()=>{f.current?.updateColors(),f.current?.render()})},[k,a]),(0,bS.jsx)("div",{className:"tlui-minimap",children:(0,bS.jsx)("canvas",{role:"img","aria-label":c("navigation-zone.minimap"),"data-testid":"minimap.canvas",ref:d,className:"tlui-minimap__canvas",onDoubleClick:g,onPointerMove:i,onPointerDown:h,onWheelCapture:j})})}GK(bM=[,,,Gz((void 0)??null)],1,"close",bL,GR),GK(bM,1,"getDpr",bK,GR),GK(bM,1,"getContentPageBounds",bJ,GR),GK(bM,1,"getContentScreenBounds",bI,GR),GK(bM,1,"getCanvasSize",bH,GR),GK(bM,1,"getCanvasClientPosition",bG,GR),GK(bM,1,"getCanvasPageBounds",bF,GR),GK(bM,1,"getZoom",bE,GR),GK(bM,1,"getCanvasPageBoundsArray",bD,GR),GK(bM,1,"render",bC,GR),GJ(bM,GR);let GT=(0,bT.memo)(function(){let a=Jn(),b=Am(),c=A0(),d=(0,bT.useRef)(null);qq(d);let[e,f]=function(a,b){let[c,d]=bT.default.useState(b);return bT.default.useLayoutEffect(()=>{let b=c8(a);if(b)try{d(JSON.parse(b))}catch{console.error(`Could not restore value ${a} from local storage.`)}},[a]),[c,bT.default.useCallback(b=>{d(c=>{let d="function"==typeof b?b(c):b;return c9(a,JSON.stringify(d)),d})},[a])]}("minimap",!0),g=(0,bT.useCallback)(()=>{f(a=>!a)},[f]),{ZoomMenu:h,Minimap:i}=Ji();return c<AZ.MOBILE?null:(0,bS.jsxs)("div",{ref:d,className:"tlui-navigation-panel",children:[(0,bS.jsx)(C7,{orientation:"horizontal",label:b("navigation-zone.title"),children:h&&c<AZ.TABLET?(0,bS.jsx)(h,{}):(0,bS.jsxs)(bS.Fragment,{children:[!e&&(0,bS.jsx)(C8,{type:"icon","data-testid":"minimap.zoom-out",title:`${b(Jo(a["zoom-out"].label))} ${BJ(a["zoom-out"].kbd)}`,onClick:()=>a["zoom-out"].onSelect("navigation-zone"),children:(0,bS.jsx)(AF,{small:!0,icon:"minus"})}),h&&(0,bS.jsx)(h,{},"zoom-menu"),!e&&(0,bS.jsx)(C8,{type:"icon","data-testid":"minimap.zoom-in",title:`${b(Jo(a["zoom-in"].label))} ${BJ(a["zoom-in"].kbd)}`,onClick:()=>a["zoom-in"].onSelect("navigation-zone"),children:(0,bS.jsx)(AF,{small:!0,icon:"plus"})}),i&&(0,bS.jsx)(C8,{type:"icon","data-testid":"minimap.toggle-button",title:b("navigation-zone.toggle-minimap"),onClick:g,children:(0,bS.jsx)(AF,{small:!0,icon:e?"chevron-right":"chevron-left"})})]})}),i&&c>=AZ.TABLET&&!e&&(0,bS.jsx)(i,{})]})}),GU=function({name:a,id:b,isCurrentPage:c,onCancel:d,onComplete:e}){let f=jA(),g=BP(),h=(0,bT.useRef)(null),i=(0,bT.useRef)(null),j=(0,bT.useCallback)(()=>{i.current=f.markHistoryStoppingPoint("rename page")},[f]),k=(0,bT.useCallback)(a=>{f.renamePage(b,a||"New Page"),g("rename-page",{source:"page-menu"})},[f,b,g]),l=(0,bT.useCallback)(()=>{i.current&&f.bailToMark(i.current),d()},[f,d]);return(0,bS.jsx)(AL,{className:"tlui-page-menu__item__input",ref:a=>{h.current=a},defaultValue:a,onValueChange:k,onComplete:e,onCancel:l,onFocus:j,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:c,autoSelect:!0})},GV=(a,b,c,d,e)=>{let f,g=a.getPages(),h=c>d?g[d-1]:g[d],i=c>d?g[d]:g[d+1];(f=h&&!i?c4(h.index):!h&&i?function(a=null){return c0(null,a,1)[0]}(g[0].index):c3(h.index,i.index))!==g[c].index&&(a.markHistoryStoppingPoint("moving page"),a.updatePage({id:b,index:f}),e("move-page",{source:"page-menu"}))},GW=d3(function({index:a,listSize:b,item:c,onRename:d}){let e=jA(),f=Am(),g=e.getPages(),h=BP(),i=(0,bT.useCallback)(()=>{e.markHistoryStoppingPoint("creating page");let a=gZ.createId();e.duplicatePage(c.id,a),h("duplicate-page",{source:"page-menu"})},[e,c,h]),j=(0,bT.useCallback)(()=>{GV(e,c.id,a,a-1,h)},[e,c,a,h]),k=(0,bT.useCallback)(()=>{GV(e,c.id,a,a+1,h)},[e,c,a,h]),l=(0,bT.useCallback)(()=>{e.markHistoryStoppingPoint("deleting page"),e.deletePage(c.id),h("delete-page",{source:"page-menu"})},[e,c,h]);return(0,bS.jsxs)(BR,{id:`page item submenu ${a}`,children:[(0,bS.jsx)(BS,{children:(0,bS.jsx)(Ao,{type:"icon",title:f("page-menu.submenu.title"),children:(0,bS.jsx)(AF,{icon:"dots-vertical",small:!0})})}),(0,bS.jsx)(BT,{alignOffset:0,side:"right",sideOffset:-4,children:(0,bS.jsxs)(A3,{type:"menu",sourceId:"page-menu",children:[(0,bS.jsxs)(De,{id:"modify",children:[d&&(0,bS.jsx)(Db,{id:"rename",label:"page-menu.submenu.rename",onSelect:d}),(0,bS.jsx)(Db,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:i,disabled:g.length>=e.options.maxPages}),a>0&&(0,bS.jsx)(Db,{id:"move-up",onSelect:j,label:"page-menu.submenu.move-up"}),a<b-1&&(0,bS.jsx)(Db,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:k})]}),b>1&&(0,bS.jsx)(De,{id:"delete",children:(0,bS.jsx)(Db,{id:"delete",onSelect:l,label:"page-menu.submenu.delete"})})]})})]})}),GX=(0,bT.memo)(function(){let a=jA(),b=BP(),c=Am(),d=A0(),[e,f]=BQ("page-menu",(0,bT.useCallback)(()=>o(!1),[])),g=(0,bT.useRef)(null),h=d8("pages",()=>a.getPages(),[a]),i=d8("currentPage",()=>a.getCurrentPage(),[a]),j=d8("currentPageId",()=>a.getCurrentPageId(),[a]),k=BE(),l=d8("maxPageCountReached",()=>a.getPages().length>=a.options.maxPages,[a]),m=d8("isCoarsePointer",()=>a.getInstanceState().isCoarsePointer,[a]),[n,o]=(0,bT.useState)(!1);(0,bT.useEffect)(function(){function b(){n||document.activeElement===document.body&&a.menus.clearOpenMenus()}return document.addEventListener("keydown",b,{passive:!0}),()=>{document.removeEventListener("keydown",b)}},[a,n]);let p=(0,bT.useCallback)(()=>{k||o(a=>!a)},[k]),q=(0,bT.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[r,s]=(0,bT.useState)(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}])));(0,bT.useLayoutEffect)(()=>{s(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}])))},[36,h]),(0,bT.useEffect)(()=>{e&&a.timers.requestAnimationFrame(()=>{let a=document.querySelector(`[data-pageid="${j}"]`);if(a){a.querySelector("button")?.focus();let b=g.current;if(!b)return;let c=a.offsetTop;c<b.scrollTop&&b.scrollTo({top:c});let d=c+36;d>b.scrollTop+b.offsetHeight&&b.scrollTo({top:d-b.offsetHeight})}})},[36,j,e,a]);let t=(0,bT.useCallback)(a=>{let{clientY:b,currentTarget:c}=a,{dataset:{id:d,index:e}}=c;if(!d||!e)return;let f=q.current;jn(a.currentTarget,a),f.status="pointing",f.pointing={id:d,index:+e};let g=r[d].y;f.startY=b,f.startIndex=Math.max(0,Math.min(Math.round(g/36),h.length-1))},[36,h.length,r]),u=(0,bT.useCallback)(a=>{let b=q.current;if("pointing"===b.status){let{clientY:c}=a;Math.abs(c-b.startY)>5&&(b.status="dragging")}if("dragging"===b.status){let{clientY:c}=a,d=c-b.startY,e=r[b.pointing.id],{startIndex:f,pointing:g}=b,i=Math.max(0,Math.min(Math.round((e.y+d)/36),h.length-1)),j={...r};if(j[g.id]={y:e.y,offsetY:d,isSelected:!0},i!==b.dragIndex){b.dragIndex=i;for(let a=0;a<h.length;a++){let c=h[a];if(c.id===b.pointing.id)continue;let{y:d}=j[c.id];i===f?d=36*a:i<f?d=i<=a&&a<f?(a+1)*36:36*a:i>f&&(d=i>=a&&a>f?(a-1)*36:36*a),d!==j[c.id].y&&(j[c.id]={y:d,offsetY:0,isSelected:!0})}}s(j)}},[36,h,r]),v=(0,bT.useCallback)(c=>{let d=q.current;if("dragging"===d.status){let{id:c,index:e}=d.pointing;GV(a,c,e,d.dragIndex,b)}jo(c.currentTarget,c),d.status="idle"},[a,b]),w=(0,bT.useCallback)(a=>{let b=q.current;"Escape"===a.key&&("dragging"===b.status&&s(Object.fromEntries(h.map((a,b)=>[a.id,{y:36*b,offsetY:0,isSelected:!1}]))),b.status="idle")},[36,h]),y=(0,bT.useCallback)(()=>{k||(a.run(()=>{a.markHistoryStoppingPoint("creating page");let b=gZ.createId();a.createPage({name:c("page-menu.new-page-initial-name"),id:b}),a.setCurrentPage(b),o(!0),a.timers.requestAnimationFrame(()=>{let a=document.querySelector(`[data-pageid="${b}"]`);a&&a.querySelector("button")?.focus()})}),b("new-page",{source:"page-menu"}))},[a,c,k,b]),z=(0,bT.useCallback)(c=>{a.setCurrentPage(c),b("change-page",{source:"page-menu"})},[a,b]),A=(0,bT.useCallback)((c,d)=>{a.renamePage(c,d),b("rename-page",{source:"page-menu"})},[a,b]),B=d<AZ.TABLET_SM&&m;return(0,bS.jsxs)(Ew,{id:"pages",onOpenChange:f,open:e,children:[(0,bS.jsx)(Ex,{"data-testid":"main.page-menu",children:(0,bS.jsxs)(Ao,{type:"menu",title:i.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,bS.jsx)("div",{className:"tlui-page-menu__name",children:i.name}),(0,bS.jsx)(AF,{icon:"chevron-down",small:!0})]})}),(0,bS.jsx)(Ey,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:n,children:(0,bS.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,bS.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,bS.jsx)("div",{className:"tlui-page-menu__header__title",children:c("page-menu.title")}),!k&&(0,bS.jsxs)(CX,{children:[(0,bS.jsx)(Ao,{type:"icon","data-testid":"page-menu.edit",title:c(n?"page-menu.edit-done":"page-menu.edit-start"),onClick:p,children:(0,bS.jsx)(AF,{icon:n?"check":"edit"})}),(0,bS.jsx)(Ao,{type:"icon","data-testid":"page-menu.create",title:c(l?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:l,onClick:y,children:(0,bS.jsx)(AF,{icon:"plus"})})]})]}),(0,bS.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*h.length+4},ref:g,children:h.map((b,d)=>{let e=r[b.id]??{position:40*d,offsetY:0};return n?(0,bS.jsxs)("div",{"data-testid":"page-menu.item","data-pageid":b.id,className:"tlui-page_menu__item__sortable",style:{zIndex:b.id===i.id?888:d,transform:`translate(0px, ${e.y+e.offsetY}px)`},children:[(0,bS.jsx)(Ao,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:t,onPointerUp:v,onPointerMove:u,onKeyDown:w,"data-id":b.id,"data-index":d,children:(0,bS.jsx)(AF,{icon:"drag-handle-dots"})}),B?(0,bS.jsxs)(Ao,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let a=window.prompt(c("action.rename"),b.name);a&&a!==b.name&&A(b.id,a)},onDoubleClick:p,children:[(0,bS.jsx)(FQ,{checked:b.id===i.id}),(0,bS.jsx)(AB,{children:b.name})]}):(0,bS.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,bS.jsx)(GU,{id:b.id,name:b.name,isCurrentPage:b.id===i.id,onComplete:()=>{o(!1)},onCancel:()=>{o(!1)}})}),!k&&(0,bS.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":n,children:(0,bS.jsx)(GW,{index:d,item:b,listSize:h.length})})]},b.id+"_editing"):(0,bS.jsxs)("div",{"data-pageid":b.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,bS.jsxs)(Ao,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>z(b.id),onDoubleClick:p,title:c("page-menu.go-to-page"),onKeyDown:c=>{"Enter"===c.key&&b.id===i.id&&(p(),a.markEventAsHandled(c))},children:[(0,bS.jsx)(FQ,{checked:b.id===i.id}),(0,bS.jsx)(AB,{children:b.name})]}),!k&&(0,bS.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,bS.jsx)(GW,{index:d,item:b,listSize:h.length,onRename:()=>{if(B){let a=window.prompt(c("action.rename"),b.name);a&&a!==b.name&&A(b.id,a)}else o(!0),j!==b.id&&z(b.id)}})})]},b.id)})})]})})]})});function GY(){let a=jA(),b=BE(),c=d8("should display quick actions",()=>a.isInAny("select","hand","zoom"),[a]);if(!b||c)return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(G$,{}),(0,bS.jsx)(GZ,{})]})}function GZ(){let a=Fs(1),b=Fp(),c=a&&b;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"delete",disabled:!c}),(0,bS.jsx)(Dd,{actionId:"duplicate",disabled:!c})]})}function G$(){let a=Fv(),b=Fu();return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"undo",disabled:!a}),(0,bS.jsx)(Dd,{actionId:"redo",disabled:!b})]})}let G_=(0,bT.memo)(function({children:a}){let b=a??(0,bS.jsx)(GY,{});return(0,bS.jsx)(A3,{type:"small-icons",sourceId:"quick-actions",children:b})});var Ev=Ev;function G0(){let a=Am();return(0,bS.jsx)(C5,{content:a("status.offline"),children:(0,bS.jsx)("div",{className:"tlui-offline-indicator",children:(0,bS.jsx)(AD,{icon:"status-offline",label:a("status.offline"),small:!0})})})}function G1({userId:a}){let b=rQ(a);return b?(0,bS.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:b.color},children:b.userName?.[0]??""},a):null}let G2=d3(function({userId:a}){let b=jA(),c=Am(),d=BP(),e=rQ(a),f=(0,bT.useCallback)(()=>{b.getInstanceState().followingUserId===a?(b.stopFollowingUser(),d("stop-following",{source:"people-menu"})):(b.startFollowingUser(a),d("start-following",{source:"people-menu"}))},[b,a,d]),g=e?.followingUserId===b.user.getId(),h=b.getInstanceState().followingUserId===a;return e?(0,bS.jsxs)(CX,{className:"tlui-people-menu__item","data-follow":h||g,children:[(0,bS.jsxs)(Ao,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>b.zoomToUser(a),onDoubleClick:f,children:[(0,bS.jsx)(AD,{label:c("people-menu.avatar-color"),icon:"color",color:e.color}),(0,bS.jsx)("div",{className:"tlui-people-menu__name",children:e.userName?.trim()||c("people-menu.anonymous-user")})]}),(0,bS.jsx)(Ao,{type:"icon",className:"tlui-people-menu__item__follow",title:c(g?"people-menu.leading":h?"people-menu.following":"people-menu.follow"),onClick:f,disabled:g,children:(0,bS.jsx)(AF,{icon:g?"leading":h?"following":"follow"})})]}):null});function G3({count:a}){return(0,bS.jsx)("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(a)})}var Ev=Ev;let G4=d3(function(){let a=jA(),b=jG(),c=Am(),d=BP(),e=(0,bT.useRef)(!1),[f,g]=(0,bT.useState)(!1),h=(0,bT.useCallback)(a=>{g(a)},[]),i=a.user.getColor(),j=(0,bT.useCallback)(b=>{a.user.updateUserPreferences({color:b}),d("set-color",{source:"people-menu"})},[a,d]),{handleButtonClick:k,handleButtonPointerDown:l,handleButtonPointerEnter:m,handleButtonPointerUp:n}=bT.default.useMemo(()=>{let a=()=>{e.current=!1,window.removeEventListener("pointerup",a)};return{handleButtonClick:a=>{let{id:b}=a.currentTarget.dataset;b&&i!==b&&j(b)},handleButtonPointerDown:b=>{let{id:c}=b.currentTarget.dataset;c&&(j(c),e.current=!0,window.addEventListener("pointerup",a))},handleButtonPointerEnter:a=>{if(!e.current)return;let{id:b}=a.currentTarget.dataset;b&&j(b)},handleButtonPointerUp:a=>{let{id:b}=a.currentTarget.dataset;b&&j(b)}}},[i,j]);return(0,bS.jsxs)(Ev.Root,{onOpenChange:h,open:f,children:[(0,bS.jsx)(Ev.Trigger,{dir:"ltr",asChild:!0,children:(0,bS.jsx)(Ao,{type:"icon",className:"tlui-people-menu__user__color",style:{color:a.user.getColor()},title:c("people-menu.change-color"),children:(0,bS.jsx)(AF,{icon:"color"})})}),(0,bS.jsx)(Ev.Portal,{container:b,children:(0,bS.jsx)(Ev.Content,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,bS.jsx)(CZ,{children:j1.map(a=>(0,bS.jsx)(Ao,{type:"icon","data-id":a,"data-testid":a,"aria-label":a,isActive:i===a,title:a,style:{color:a},onPointerEnter:m,onPointerDown:l,onPointerUp:n,onClick:k,children:(0,bS.jsx)(AF,{icon:"color"})},a))})})})]})});function G5(){let a=jA(),b=BP(),c=d8("userName",()=>a.user.getName(),[]),d=Am(),e=(0,bT.useRef)(c),f=(0,bT.useRef)(c),[g,h]=(0,bT.useState)(!1),i=(0,bT.useCallback)(()=>{h(a=>!a)},[]),j=(0,bT.useCallback)(b=>{f.current=b,a.user.updateUserPreferences({name:b})},[a]),k=(0,bT.useCallback)(()=>{e.current!==f.current&&(b("change-user-name",{source:"people-menu"}),e.current=f.current)},[b]),l=(0,bT.useCallback)(()=>{h(!1),a.user.updateUserPreferences({name:e.current}),a.menus.clearOpenMenus()},[a]);return(0,bS.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,bS.jsx)(G4,{}),g?(0,bS.jsx)(AL,{className:"tlui-people-menu__user__input",defaultValue:c,onValueChange:j,onComplete:i,onCancel:l,onBlur:k,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{g||h(!0)},children:c||d("people-menu.anonymous-user")}),c?null:(0,bS.jsx)("div",{className:"tlui-people-menu__user__label",children:d("people-menu.user")})]}),(0,bS.jsx)(Ao,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:d("people-menu.change-name"),onClick:i,children:(0,bS.jsx)(AF,{icon:g?"check":"edit"})})]})}function G6({children:a}){let b,c=Am(),d=jG(),e=jA(),f=rP(),g=d8("user",()=>e.user.getColor(),[e]),h=d8("user",()=>e.user.getName(),[e]),[i,j]=BQ("people menu"),k=A0()<=AZ.MOBILE_XS?1:5;return"offline"===d8("sync status",()=>b?.store.props.collaboration?.status?b.store.props.collaboration.status.get():null,[b=jB()])?(0,bS.jsx)(G0,{}):f.length?(0,bS.jsxs)(Ev.Root,{onOpenChange:j,open:i,children:[(0,bS.jsx)(Ev.Trigger,{dir:"ltr",asChild:!0,children:(0,bS.jsx)("button",{className:"tlui-people-menu__avatars-button",title:c("people-menu.title"),children:(0,bS.jsxs)("div",{className:"tlui-people-menu__avatars",children:[f.slice(-k).map(a=>(0,bS.jsx)(G1,{userId:a},a)),f.length>0&&(0,bS.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:g},children:h?.[0]??""}),f.length>k&&(0,bS.jsx)(G3,{count:f.length-k})]})})}),(0,bS.jsx)(Ev.Portal,{container:d,children:(0,bS.jsx)(Ev.Content,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:(0,bS.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,bS.jsx)("div",{className:"tlui-people-menu__section",children:(0,bS.jsx)(G5,{})}),f.length>0&&(0,bS.jsx)("div",{className:"tlui-people-menu__section",children:f.map(a=>(0,bS.jsx)(G2,{userId:a},a+"_presence"))}),a]})})})]}):null}function G7(){return(0,bS.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,bS.jsx)(G6,{})})}let G8=Object.freeze([gr,gv,gw,gz]);function G9(a=G8){let b=jA();return d8("getRelevantStyles",()=>{let c=new mn(b.getSharedStyles()),d=!!b.root.getCurrent()?.shapeType,e=b.isIn("select")&&b.getSelectedShapeIds().length>0;if(0===c.size&&b.isIn("select")&&0===b.getSelectedShapeIds().length)for(let d of a)c.applyValue(d,b.getStyleForNextShape(d));return d||e||c.size>0?c:null},[b])}let Ha=[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],Hb=[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"}],Hc=[{value:"pattern",icon:"fill-pattern"},{value:"lined-fill",icon:"fill-lined-fill"},{value:"fill",icon:"fill-fill"}],Hd=[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],He=[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],Hf=[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],Hg=[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],Hh=[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],Hi=[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],Hj=[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],Hk=[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],Hl=[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],Hm=[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],Hn=[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}];var Ho=a.i(380935),Ho=Ho;let Hp=bT.default.forwardRef(function({onHistoryMark:a,title:b,min:c,steps:d,value:e,label:f,onValueChange:g,"data-testid":h,ariaValueModifier:i=1},j){let k=Am(),[l,m]=(0,bT.useState)(""),[n,o]=(0,bT.useState)(-1);(0,bT.useEffect)(()=>{o(0)},[]);let p=(0,bT.useCallback)(a=>{g(a[0])},[g]),q=(0,bT.useCallback)(()=>{C1(),a?.("click slider")},[a]);(0,bT.useEffect)(()=>{let a=mj.setTimeout("set title and label",()=>{m(b+" — "+k(f))},0);return()=>clearTimeout(a)},[f,k,b]);let r=(0,bT.useCallback)(a=>{"Tab"===a.key&&a.stopPropagation()},[]);return(0,bS.jsx)("div",{className:"tlui-slider__container",children:(0,bS.jsx)(C5,{content:l,children:(0,bS.jsxs)(Ho.Root,{"data-testid":h,className:"tlui-slider",dir:"ltr",min:c??0,max:d,step:1,value:null!==e?[e]:void 0,onPointerDown:q,onValueChange:p,onKeyDownCapture:r,onKeyUpCapture:r,children:[(0,bS.jsx)(Ho.Track,{className:"tlui-slider__track",dir:"ltr",children:null!==e&&(0,bS.jsx)(Ho.Range,{className:"tlui-slider__range",dir:"ltr"})}),null!==e&&(0,bS.jsx)(Ho.Thumb,{"aria-valuemin":(c??0)*i,"aria-valuenow":e*i,"aria-valuemax":d*i,"aria-label":l,className:"tlui-slider__thumb",dir:"ltr",ref:j,tabIndex:n})]})})})});function Hq(){return gq({isDarkMode:pC()})}let Hr=(0,bT.createContext)(null);function Hs({children:a,styles:b}){let c=jA(),d=BP(),e=(0,bT.useCallback)(a=>c.markHistoryStoppingPoint(a),[c]),f=d8("enhancedA11yMode",()=>c.user.getEnhancedA11yMode(),[c]),g=(0,bT.useCallback)(function(a,b){c.run(()=>{c.isIn("select")&&c.setStyleForSelectedShapes(a,b),c.setStyleForNextShapes(a,b),c.updateInstanceState({isChangingStyle:!0})}),d("set-style",{source:"style-panel",id:a.id,value:b})},[c,d]);return(0,bS.jsx)(Hr.Provider,{value:{styles:b,enhancedA11yMode:f,onHistoryMark:e,onValueChange:g},children:a})}function Ht(){let a=(0,bT.useContext)(Hr);if(!a)throw Error("useStylePanelContext must be used within a StylePanelContextProvider");return a}function Hu({children:a}){return(0,bS.jsx)("h3",{className:"tlui-style-panel__subheading",children:a})}let Hv=(0,bT.memo)(function(a){let{enhancedA11yMode:b}=Ht();return(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(Hu,{children:a.title}),(0,bS.jsx)(C7,{label:a.title,children:(0,bS.jsx)(Hw,{...a})})]})}),Hw=(0,bT.memo)(function(a){let b=Ht(),{uiType:c,items:d,title:e,style:f,value:g,onValueChange:h=b.onValueChange,onHistoryMark:i=b.onHistoryMark}=a,j=Hq(),k=jA(),l=Am(),m=A0(),n=(0,bT.useRef)(!1),o=(0,bT.useRef)(null),{handleButtonClick:p,handleButtonPointerDown:q,handleButtonPointerEnter:r,handleButtonPointerUp:s}=(0,bT.useMemo)(()=>{let a=()=>{n.current=!1,window.removeEventListener("pointerup",a);let b=o.current;b&&(["TEXTAREA","INPUT"].includes(b.nodeName)||b.isContentEditable)?b.focus():m>=AZ.TABLET_SM&&k.getContainer().focus(),o.current=null};return{handleButtonClick:a=>{let{id:b}=a.currentTarget.dataset;("shared"!==g.type||g.value!==b)&&(i?.("point picker item"),h(f,b))},handleButtonPointerDown:b=>{let{id:c}=b.currentTarget.dataset;i?.("point picker item"),h(f,c),n.current=!0,o.current=document.activeElement,window.addEventListener("pointerup",a)},handleButtonPointerEnter:a=>{if(!n.current)return;let{id:b}=a.currentTarget.dataset;h(f,b)},handleButtonPointerUp:a=>{let{id:b}=a.currentTarget.dataset;("shared"!==g.type||g.value!==b)&&h(f,b)}}},[k,m,g,i,h,f]),t=d.length>4?CZ:CX;return(0,bS.jsx)(C9,{"data-testid":`style.${c}`,type:"single",value:"shared"===g.type?g.value:null,asChild:!0,children:(0,bS.jsx)(t,{children:d.map(a=>{let b="shared"===g.type&&g.value===a.value,d=e+" — "+l(`${c}-style.${a.value}`);return(0,bS.jsx)(Da,{type:"icon","data-id":a.value,"data-testid":`style.${c}.${a.value}`,"aria-label":d+(b?` (${l("style-panel.selected")})`:""),tooltip:(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("div",{children:d}),b?(0,bS.jsxs)("div",{children:["(",l("style-panel.selected"),")"]}):null]}),value:a.value,"data-state":"shared"===g.type&&g.value===a.value?"on":"off","data-isactive":b,title:d,style:f===gr?{color:gu(j,a.value,"solid")}:void 0,onPointerEnter:r,onPointerDown:q,onPointerUp:s,onClick:p,children:(0,bS.jsx)(AF,{icon:a.icon})},a.value)})})})}),Hx=bT.memo(function(a){let b=Am();return(0,bS.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,bS.jsx)("div",{title:b(a.label),className:"tlui-style-panel__double-select-picker-label",children:b(a.label)}),(0,bS.jsx)(C7,{orientation:"horizontal",label:b(a.label),children:(0,bS.jsx)(Hy,{...a})})]})}),Hy=bT.memo(function(a){let b=Ht(),{uiTypeA:c,uiTypeB:d,labelA:e,labelB:f,itemsA:g,itemsB:h,styleA:i,styleB:j,valueA:k,valueB:l,onValueChange:m=b.onValueChange}=a,n=jA(),o=Am(),[p,q]=bT.useState(!1),[r,s]=bT.useState(!1),t=bT.useMemo(()=>g.find(a=>"shared"===k.type&&k.value===a.value)?.icon??"mixed",[g,k]),u=bT.useMemo(()=>h.find(a=>"shared"===l.type&&l.value===a.value)?.icon??"mixed",[h,l]);if(void 0===k&&void 0===l)return null;let v=`style panel ${c} A`,w=`style panel ${d} B`;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(Ew,{id:v,open:p,onOpenChange:q,children:[(0,bS.jsx)(Ex,{children:(0,bS.jsx)(C8,{type:"icon","data-testid":`style.${c}`,title:o(e)+" — "+(null===k||"mixed"===k.type?o("style-panel.mixed"):o(`${c}-style.${k.value}`)),children:(0,bS.jsx)(AF,{icon:t,small:!0,invertIcon:!0})})}),(0,bS.jsx)(Ey,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,bS.jsx)(C7,{orientation:"grid",label:o(e),children:(0,bS.jsx)(A3,{type:"icons",sourceId:"style-panel",children:g.map(a=>(0,bS.jsx)(C8,{"data-testid":`style.${c}.${a.value}`,type:"icon",onClick:()=>{m(i,a.value),mi.deleteOpenMenu(v,n.contextId),q(!1)},title:`${o(e)} \u2014 ${o(`${c}-style.${a.value}`)}`,children:(0,bS.jsx)(AF,{icon:a.icon,invertIcon:!0})},a.value))})})})]}),(0,bS.jsxs)(Ew,{id:w,open:r,onOpenChange:s,children:[(0,bS.jsx)(Ex,{children:(0,bS.jsx)(C8,{type:"icon","data-testid":`style.${d}`,title:o(f)+" — "+(null===l||"mixed"===l.type?o("style-panel.mixed"):o(`${d}-style.${l.value}`)),children:(0,bS.jsx)(AF,{icon:u,small:!0})})}),(0,bS.jsx)(Ey,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,bS.jsx)(C7,{orientation:"grid",label:o(f),children:(0,bS.jsx)(A3,{type:"icons",sourceId:"style-panel",children:h.map(a=>(0,bS.jsx)(C8,{type:"icon",title:`${o(f)} \u2014 ${o(`${d}-style.${a.value}`)}`,"data-testid":`style.${d}.${a.value}`,onClick:()=>{m(j,a.value),mi.deleteOpenMenu(w,n.contextId),s(!1)},children:(0,bS.jsx)(AF,{icon:a.icon})},a.value))})})})]})]})}),Hz=bT.memo(function(a){let b=Am()(a.label?a.label:`style-panel.${a.stylePanelType}`);return(0,bS.jsx)(C7,{label:b,children:(0,bS.jsx)(HA,{...a})})}),HA=bT.memo(function(a){let b=Ht(),{id:c,label:d,uiType:e,stylePanelType:f,style:g,items:h,type:i,value:j,onValueChange:k=b.onValueChange,testIdType:l=e}=a,m=Am(),n=jA(),[o,p]=bT.useState(!1),q=bT.useMemo(()=>"mixed"===j.type?"mixed":h.find(a=>a.value===j.value)?.icon??h[0]?.icon,[h,j]),r=m(`style-panel.${f}`),s="mixed"===j.type?m("style-panel.mixed"):r+" — "+m(`${e}-style.${j.value}`),t=d?m(d):"",u=`style panel ${c}`;return(0,bS.jsxs)(Ew,{id:u,open:o,onOpenChange:p,className:"tlui-style-panel__dropdown-picker",children:[(0,bS.jsx)(Ex,{children:(0,bS.jsxs)(C8,{type:i,"data-testid":`style.${l}`,"data-direction":"left",title:s,children:[t&&(0,bS.jsx)(AB,{children:t}),(0,bS.jsx)(AF,{icon:q})]})}),(0,bS.jsx)(Ey,{side:"left",align:"center",children:(0,bS.jsx)(C7,{orientation:h.length>4?"grid":"horizontal",label:t,children:(0,bS.jsx)(A3,{type:"icons",sourceId:"style-panel",children:h.map(a=>(0,bS.jsx)(C8,{type:"icon","data-testid":`style.${l}.${a.value}`,title:r+" — "+m(`${e}-style.${a.value}`),isActive:q===a.icon,onClick:()=>{b.onHistoryMark("select style dropdown item"),k(g,a.value),mi.deleteOpenMenu(u,n.contextId),p(!1)},children:(0,bS.jsx)(AF,{icon:a.icon})},a.value))})})})]})});function HB(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(HC,{children:[(0,bS.jsx)(HD,{}),(0,bS.jsx)(HF,{})]}),(0,bS.jsxs)(HC,{children:[(0,bS.jsx)(HG,{}),(0,bS.jsx)(HH,{}),(0,bS.jsx)(HI,{})]}),(0,bS.jsxs)(HC,{children:[(0,bS.jsx)(HJ,{}),(0,bS.jsx)(HK,{}),(0,bS.jsx)(HL,{})]}),(0,bS.jsxs)(HC,{children:[(0,bS.jsx)(HM,{}),(0,bS.jsx)(HN,{}),(0,bS.jsx)(HO,{}),(0,bS.jsx)(HP,{})]})]})}function HC({children:a}){return(0,bS.jsx)("div",{className:"tlui-style-panel__section",children:a})}function HD(){let{styles:a}=Ht(),b=Am(),c=a.get(gr);return void 0===c?null:(0,bS.jsx)(Hv,{title:b("style-panel.color"),uiType:"color",style:gr,items:Ha,value:c})}let HE=[.1,.25,.5,.75,1];function HF(){let a=jA(),{onHistoryMark:b,enhancedA11yMode:c}=Ht(),d=d8("opacity",()=>a.getSharedOpacity(),[a]),e=BP(),f=Am(),g=bT.default.useCallback(b=>{let c=HE[b];a.run(()=>{a.isIn("select")&&a.setOpacityForSelectedShapes(c),a.setOpacityForNextShapes(c),a.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:"opacity",value:b})},[a,e]);if(void 0===d)return null;let h="mixed"===d.type?-1:HE.indexOf(b6(HE,a=>Math.abs(a-d.value)));return(0,bS.jsxs)(bS.Fragment,{children:[c&&(0,bS.jsx)(Hu,{children:f("style-panel.opacity")}),(0,bS.jsx)(Hp,{"data-testid":"style.opacity",value:h>=0?h:HE.length-1,label:"mixed"===d.type?"style-panel.mixed":`opacity-style.${d.value}`,onValueChange:g,steps:HE.length-1,title:f("style-panel.opacity"),onHistoryMark:b,ariaValueModifier:25})]})}function HG(){let{styles:a,enhancedA11yMode:b}=Ht(),c=Am(),d=a.get(gw);if(void 0===d)return null;let e=c("style-panel.fill");return(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(Hu,{children:e}),(0,bS.jsxs)(C7,{orientation:"horizontal",label:e,children:[(0,bS.jsx)(Hw,{title:e,uiType:"fill",style:gw,items:Hb,value:d}),(0,bS.jsx)(HA,{type:"icon",id:"fill-extra",uiType:"fill",testIdType:"fill-extra",stylePanelType:"fill",style:gw,items:Hc,value:d})]})]})}function HH(){let{styles:a}=Ht(),b=Am(),c=a.get(gv);return void 0===c?null:(0,bS.jsx)(Hv,{title:b("style-panel.dash"),uiType:"dash",style:gv,items:Hd,value:c})}function HI(){let a=jA(),{styles:b,onValueChange:c}=Ht(),d=Am(),e=b.get(gz);return void 0===e?null:(0,bS.jsx)(Hv,{title:d("style-panel.size"),uiType:"size",style:gz,items:He,value:e,onValueChange:(b,d)=>{c(b,d);let e=a.getSelectedShapeIds();e.length>0&&sB(a,e)}})}function HJ(){let{styles:a}=Ht(),b=Am(),c=a.get(gx);return void 0===c?null:(0,bS.jsx)(Hv,{title:b("style-panel.font"),uiType:"font",style:gx,items:Hf,value:c})}function HK(){let{styles:a,enhancedA11yMode:b}=Ht(),c=Am(),d=a.get(ik);if(void 0===d)return null;let e=c("style-panel.align");return(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(Hu,{children:e}),(0,bS.jsxs)(C7,{orientation:"horizontal",label:e,children:[(0,bS.jsx)(Hw,{title:e,uiType:"align",style:ik,items:Hg,value:d}),(0,bS.jsx)(C8,{type:"icon",title:c("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,bS.jsx)(AF,{icon:"vertical-align-middle"})})]})]})}function HL(){let{styles:a,enhancedA11yMode:b}=Ht(),c=Am(),d=a.get(hY),e=a.get(hZ);if(void 0===d)return null;let f=c("style-panel.label-align");return(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(Hu,{children:f}),(0,bS.jsxs)(C7,{orientation:"horizontal",label:f,children:[(0,bS.jsx)(Hw,{title:f,uiType:"align",style:hY,items:Hh,value:d}),void 0===e?(0,bS.jsx)(C8,{type:"icon",title:c("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,bS.jsx)(AF,{icon:"vertical-align-middle"})}):(0,bS.jsx)(HA,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:hZ,items:Hi,value:e})]})]})}function HM(){let{styles:a}=Ht(),b=a.get(h$);return void 0===b?null:(0,bS.jsx)(Hz,{label:"style-panel.geo",type:"menu",id:"geo",uiType:"geo",stylePanelType:"geo",style:h$,items:Hj,value:b})}function HN(){let{styles:a}=Ht(),b=a.get(gA);return void 0===b?null:(0,bS.jsx)(Hz,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:gA,items:Hk,value:b})}function HO(){let{styles:a}=Ht(),b=a.get(gD),c=a.get(gC);return void 0===b||void 0===c?null:(0,bS.jsx)(Hx,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:gC,itemsA:Hl,valueA:c,uiTypeB:"arrowheadEnd",styleB:gD,itemsB:Hm,valueB:b,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function HP(){let{styles:a}=Ht(),b=a.get(ib);return void 0===b?null:(0,bS.jsx)(Hz,{type:"menu",id:"spline",uiType:"spline",stylePanelType:"spline",label:"style-panel.spline",style:ib,items:Hn,value:b})}let HQ=(0,bT.memo)(function({isMobile:a,styles:b,children:c}){let d=jA(),e=d8("enhancedA11yMode",()=>d.user.getEnhancedA11yMode(),[d]),f=(0,bT.useRef)(null);qq(f);let g=(0,bT.useCallback)(()=>{a||d.updateInstanceState({isChangingStyle:!1})},[d,a]),h=G9();return void 0===b&&(b=h),(0,bT.useEffect)(()=>{function a(a){"Escape"===a.key&&f.current?.contains(document.activeElement)&&(a.stopPropagation(),d.getContainer().focus())}let b=f.current;return b?.addEventListener("keydown",a,{capture:!0}),()=>{b?.removeEventListener("keydown",a,{capture:!0})}},[d]),b&&(0,bS.jsx)("div",{ref:f,"data-testid":"style.panel",className:(0,jb.default)("tlui-style-panel",{"tlui-style-panel__wrapper":!a}),"data-ismobile":a,"data-enhanced-a11y-mode":e,onPointerLeave:g,children:(0,bS.jsx)(Hs,{styles:b,children:c??(0,bS.jsx)(HB,{})})})});var DX=DX;let HR={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function HS({toast:a}){let{removeToast:b}=D$(),c=Am(),d=a.actions&&a.actions.length>0,e=a.icon||a.severity&&HR[a.severity],f=a.iconLabel||(a.severity?c(`toast.${a.severity}`):"");return(0,bS.jsxs)(DX.Root,{onOpenChange:c=>{c||b(a.id)},className:"tlui-toast__container",duration:a.keepOpen?1/0:4e3,"data-severity":a.severity,children:[e&&(0,bS.jsx)("div",{className:"tlui-toast__icon",children:(0,bS.jsx)(AD,{label:f,icon:e})}),(0,bS.jsxs)("div",{className:"tlui-toast__main","data-title":!!a.title,"data-description":!!a.description,"data-actions":!!a.actions,children:[(0,bS.jsxs)("div",{className:"tlui-toast__content",children:[a.title&&(0,bS.jsx)(DX.Title,{className:"tlui-toast__title",children:a.title}),a.description&&(0,bS.jsx)(DX.Description,{className:"tlui-toast__description",children:a.description})]}),a.actions&&(0,bS.jsxs)("div",{className:"tlui-toast__actions",children:[a.actions.map((a,b)=>(0,bS.jsx)(DX.Action,{altText:a.label,asChild:!0,onClick:a.onClick,children:(0,bS.jsx)(Ao,{type:a.type,children:(0,bS.jsx)(AB,{children:a.label})})},b)),(0,bS.jsx)(DX.Close,{asChild:!0,children:(0,bS.jsx)(Ao,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,bS.jsx)(AB,{children:a.closeLabel??c("toast.close")})})})]})]}),!d&&(0,bS.jsx)(DX.Close,{asChild:!0,children:(0,bS.jsx)(Ao,{type:"normal",className:"tlui-toast__close",children:(0,bS.jsx)(AB,{children:a.closeLabel??c("toast.close")})})})]})}let HT=(0,bT.memo)(function(){let{toasts:a}=D$(),b=d8("toasts",()=>a.get(),[]);return(0,bS.jsxs)(bS.Fragment,{children:[b.map(a=>(0,bS.jsx)(HS,{toast:a},a.id)),(0,bS.jsx)(DX.ToastViewport,{className:"tlui-toast__viewport"})]})}),HU=({children:a,className:b,isMousingDown:c,getSelectionBounds:d,changeOnlyWhenYChanges:e=!1,label:f})=>{let g=jA(),h=(0,bT.useRef)(null);qq(h);if(!h)throw Error("usePassThroughWheelEvents must be passed a ref");let i=jG(),j=jB();(0,bT.useEffect)(()=>{function a(a){if(!j?.getInstanceState().isFocused||a.isSpecialRedispatchedEvent)return;jm(a);let b=i.querySelector(".tl-canvas");if(!b)return;let c=new PointerEvent(a.type,a);c.isSpecialRedispatchedEvent=!0,b.dispatchEvent(c)}let b=h.current;if(b)return b.addEventListener("mouseover",a,{passive:!1}),()=>{b.removeEventListener("mouseover",a)}},[i,j,h]);let{isVisible:k,isInteractive:l,hide:m,show:n,position:o,move:p}=function(a){let b=jA(),c=(0,bT.useRef)({name:"hidden"}),[d,e]=(0,bT.useState)(!1),[f,g]=(0,bT.useState)(!1),[h,i]=(0,bT.useState)({x:-1e3,y:-1e3}),j=(0,bT.useRef)(new iK(-1e3,-1e3)),k=(0,bT.useRef)(new iK(-1e3,-1e3)),l=(0,bT.useRef)(-1),m=(0,bT.useRef)(-1),n=(0,bT.useCallback)((d,e,f=!1)=>{if(k.current.x=d,k.current.y=e,"hidden"===c.current.name||"showing"===c.current.name)return;clearTimeout(m.current);let g=()=>{var b,d;if("shown"===c.current.name&&(b=k.current,d=j.current,a?iK.Sub(d,b).y**2>=256:iK.Len2(iK.Sub(d,b))>=256)){let{x:a,y:b}=k.current;j.current=new iK(a,b),f?(0,kU.flushSync)(()=>i({x:a,y:b})):i({x:a,y:b})}};f?g():m.current=b.timers.setTimeout(g,150)},[b,a]),o=(0,bT.useCallback)((a=!1)=>{switch(c.current.name){case"showing":clearTimeout(l.current),c.current={name:"hidden"};break;case"shown":c.current={name:"hiding"},e(!1),a?(c.current={name:"hidden"},g(!1)):l.current=b.timers.setTimeout(()=>{c.current={name:"hidden"},g(!1)},16)}},[b]);return{isVisible:f,isInteractive:d,show:(0,bT.useCallback)(()=>{switch(c.current.name){case"hidden":c.current={name:"showing"},l.current=b.timers.setTimeout(()=>{let{x:a,y:b}=k.current;j.current=new iK(a,b),i({x:a,y:b}),c.current={name:"shown"},g(!0),e(!0)},16);break;case"hiding":clearTimeout(l.current),c.current={name:"shown"},e(!0),n(k.current.x,k.current.y)}},[b,n]),hide:o,move:n,position:h}}(e),q=(0,bT.useRef)(!1),[r,s]=(0,bT.useState)(!1),t=d4("content size update counter",0);(0,bT.useEffect)(()=>{cd(h.current);let a=new ResizeObserver(()=>{t.update(a=>a+1)});return a.observe(h.current),()=>a.disconnect()},[t]),(0,bT.useEffect)(()=>{let a=t.get();return dA("toolbar position",function(){let b=h.current;if(!b)return;let c=t.get();g.getCamera(),t.get();let e=function(a,b,c){let d=c()?.clone();if(!d)return;let e=a.getViewportScreenBounds();if(d.x-=e.x,d.y-=e.y,d.midY<16||d.midY>e.h-16||d.midX<16||d.midX>e.w-16)return;let f=HV(b.getBoundingClientRect());if(!f.width||!f.height)return;let{scrollLeft:g,scrollTop:h}=a.getContainer(),i=d.midX-f.w/2,j=d.y-f.h-8;return i=iS(i,16,e.w-f.w-16),j=iS(j,16,e.h-f.h-16),i+=g,j+=h,{x:i=Math.round(i),y:j=Math.round(j)}}(g,b,d);if(e){if("moving"===g.getCameraState()){let a=h.current;a&&a.style.setProperty("transform",`translate(${e.x}px, ${e.y}px)`)}else{let b=a!==c;p(e.x,e.y,b)}q.current||(q.current=!0,s(!0))}else q.current&&(q.current=!1,s(!1));a=c})},[g,d,t,p]);let u=d8("camera state",()=>g.getCameraState(),[g]);return(0,bT.useEffect)(()=>{c||!r?m():n()},[r,u,c,n,m]),(0,bT.useLayoutEffect)(()=>{let a=h.current;a&&(a.dataset.visible=`${k}`)},[k,o]),(0,bT.useLayoutEffect)(()=>{let a=h.current;a&&a.style.setProperty("transform",`translate(${o.x}px, ${o.y}px)`)},[o]),(0,bT.useLayoutEffect)(()=>{let a=h.current;a&&(a.dataset.interactive=`${l}`)},[l]),(0,bS.jsx)("div",{ref:h,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:(0,jb.default)("tlui-contextual-toolbar",b),onPointerDown:g.markEventAsHandled,children:(0,bS.jsx)(C7,{orientation:"horizontal",className:"tlui-menu",label:f,tooltipSide:"top",children:a})})};function HV(a){return new kt(a.x,a.y,a.width,a.height)}function HW({shapeId:a,onClose:b,source:c}){let d=jA(),[e,f]=(0,bT.useState)(()=>{let b=d.getShape(a);if(!b)return"";if(!("altText"in b.props))throw Error("Shape does not have altText property");return b.props.altText||""}),g=Am(),h=(0,bT.useRef)(null),i=BP(),j=d.getIsReadonly(),k=()=>{i("set-alt-text",{source:c});let f=d.getShape(a);f&&(d.updateShapes([{id:f.id,type:f.type,props:{altText:e}}]),b())},l=(0,bT.useCallback)(()=>b(),[b]);return(0,bT.useEffect)(()=>{function a(a){"Escape"===a.key&&(a.stopPropagation(),l())}return h.current?.select(),document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0})}},[l]),(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(AL,{ref:h,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:e,placeholder:g("tool.media-alt-text-desc"),"aria-label":g("tool.media-alt-text-desc"),onValueChange:a=>f(a),onComplete:k,onCancel:l,disabled:j}),!j&&(0,bS.jsx)(Ao,{title:g("tool.media-alt-text-confirm"),"data-testid":"tool.media-alt-text-confirm",type:"icon",onPointerDown:jm,onClick:()=>k(),children:(0,bS.jsx)(AF,{small:!0,icon:"check"})})]})}var zY=b_;function HX(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}let HY=["original","square","circle","landscape","portrait","wide"],HZ={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function H$(a,b){return b?{w:a.w/(b.bottomRight.x-b.topLeft.x),h:a.h/(b.bottomRight.y-b.topLeft.y)}:{w:a.w,h:a.h}}function H_(a){return{width:a.bottomRight.x-a.topLeft.x,height:a.bottomRight.y-a.topLeft.y}}function H0(a){let{width:b,height:c}=H_(a);return{x:a.topLeft.x+b/2,y:a.topLeft.y+c/2}}function H1(a,b,c,d,e){let f=Math.max(0,Math.min(1-c,a-c/2)),g=Math.max(0,Math.min(1-d,b-d/2));return{topLeft:{x:f,y:g},bottomRight:{x:f+c,y:g+d},isCircle:e}}let H2=d3(function({imageShapeId:a,isManipulating:b,onEditAltTextStart:c,onManipulatingStart:d,onManipulatingEnd:e}){let f=jA(),g=BP(),h=Am(),i=(0,bT.useRef)(null),j=f.getIsReadonly(),k=d8("crop",()=>f.getShape(a).props.crop,[f,a]),l=k?Math.min(1-(k.bottomRight.x-k.topLeft.x),1-(k.bottomRight.y-k.topLeft.y)):0,[m,n]=(0,bT.useState)(k?Math.max(l,1-.3333333333333333):3),o=Jn();(0,bT.useEffect)(()=>{n(k?Math.max(l,1-.3333333333333333):3)},[k,l,m]);let p=(0,bT.useCallback)(a=>f.markHistoryStoppingPoint(a),[f]),q=(0,bT.useCallback)((a,b)=>Math.pow(a/b,1.5)*b,[]),r=k&&m?cD(q(l,m),[0,m],[0,100],!0):0,s=(0,bT.useCallback)(b=>{f.setCurrentTool("select.crop.idle");let c=Math.pow(b/100,.6666666666666666)*Math.min(1-.3333333333333333,m??1-.3333333333333333),d=f.getShape(a);if(!d)return;let e=function(a,b,c){let d,e,f=b.props.crop||HX(),{width:g,height:h}=H_(f),i=g/h,j=1+a*((c?1/(1-c):3)-1);i>1?e=(d=Math.min(1,1/j))/i:d=(e=Math.min(1,1/j))*i;let k=function(a,b,c,d=!0,e=!1){let f,g,{w:h,h:i}=H$(a.props,a.props.crop??HX()),j=a.props.crop||HX(),k=a.x+a.props.w/2,l=a.y+a.props.h/2;if(d){let{x:a,y:b}=H0(j);f=a,g=b}else f=.5,g=.5;let m=H1(f,g,b,c,e),n=b*h,o=c*i;return{crop:m,w:n,h:o,x:k-n/2,y:l-o/2}}(b,d,e,!0,f.isCircle),l=Math.min(3,g/d);k.w*=l,k.h*=l;let m=b.x+b.props.w/2,n=b.y+b.props.h/2;return k.x=m-k.w/2,k.y=n-k.h/2,k}(c>=1?1:c/(2*(1-c)),d,m);f.updateShape({id:d.id,type:d.type,x:e.x,y:e.y,props:{w:e.w,h:e.h,crop:e.crop}}),g("set-style",{source:"image-toolbar",id:"zoom",value:b})},[f,g,a,m]),t=(0,bT.useCallback)(()=>o["image-replace"].onSelect("image-toolbar"),[o]),u=(0,bT.useCallback)(()=>o["download-original"].onSelect("image-toolbar"),[o]),v=d8("altText",()=>f.getShape(a).props.altText,[f,a]),w=d8("shapeAspectRatio",()=>{let b=f.getShape(a);return b.props.w/b.props.h},[f,a]),y=!k||(0,zY.default)(k,HX());return((0,bT.useEffect)(()=>{b&&f.timers.setTimeout(()=>i.current?.focus(),0)},[f,b]),(0,bT.useEffect)(()=>{function a(a){b&&("Escape"===a.key?(f.cancel(),e()):"Enter"===a.key&&(f.complete(),e()))}let c=i.current;return c&&c.addEventListener("keydown",a),()=>{c&&c.removeEventListener("keydown",a)}},[f,b,e]),b)?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Hp,{ref:i,value:r,label:"tool.image-zoom",onValueChange:s,onHistoryMark:p,min:0,steps:100,"data-testid":"tool.image-zoom",title:h("tool.image-zoom")}),(0,bS.jsxs)(BR,{id:"image-toolbar-aspect-ratio",children:[(0,bS.jsx)(BS,{children:(0,bS.jsx)(C8,{title:h("tool.aspect-ratio"),type:"icon","data-testid":"tool.image-aspect-ratio",children:(0,bS.jsx)(AF,{icon:"corners"})})}),(0,bS.jsx)(BT,{side:"top",align:"center",children:HY.map(b=>{let c=!1;return y?"original"===b&&(c=!0):c="circle"===b?!!k.isCircle:"square"===b?!k?.isCircle&&iU(w,HZ[b],.1):"original"!==b&&!y&&iU(w,HZ[b],.01),(0,bS.jsx)(BZ,{onSelect:()=>{let c;(c=f.getShape(a))&&f.run(()=>{f.setCurrentTool("select.crop.idle");let d=function(a,b){let c,d;if("original"===a){let{w:a,h:c}=H$(b.props,b.props.crop??HX()),d=b.x+b.props.w/2,e=b.y+b.props.h/2;return{crop:HX(),w:a,h:c,x:d-a/2,y:e-c/2}}let e=HZ[a],{w:f,h:g}=H$(b.props,b.props.crop||HX()),h=f/g,i=b.props.crop||HX(),{width:j,height:k}=H_(i),l=H0(i),m=Math.min(1/j,1/k);if(0!==h&&Number.isFinite(h)&&0!==e){let a,b,i=j*f,l=k*g,m=Math.max(i,l);i>=l?b=(a=m)/e:a=(b=m)*e,c=a/f,d=b/g,c>1&&(c=1,d=h/e),d>1&&(d=1,c=e/h),c=Math.max(0,Math.min(1,c)),d=Math.max(0,Math.min(1,d))}else c=1,d=1;let n=Math.min(1/c,1/d);c*=n/m,d*=n/m,c=Math.max(0,Math.min(1,c)),d=Math.max(0,Math.min(1,d));let o=H1(l.x,l.y,c,d,"circle"===a),p=o.bottomRight.x-o.topLeft.x,q=o.bottomRight.y-o.topLeft.y,r=1;j>0?r=b.props.w/(j*f):k>0&&(r=b.props.h/(k*g));let s=p*f*r,t=q*g*r;return{crop:o,w:s,h:t,x:b.x+b.props.w/2-s/2,y:b.y+b.props.h/2-t/2}}(b,c);f.markHistoryStoppingPoint("aspect ratio"),f.updateShape({id:a,type:"image",x:d.x,y:d.y,props:{crop:d.crop,w:d.w,h:d.h}}),sB(f,[a])})},checked:c,title:h(`tool.aspect-ratio.${b}`),children:(0,bS.jsx)(AB,{children:h(`tool.aspect-ratio.${b}`)})},b)})})]}),(0,bS.jsx)(C8,{type:"icon",onClick:e,"data-testid":"tool.image-crop-confirm",style:{borderLeft:"1px solid var(--tl-color-divider)",marginLeft:"2px"},title:h("tool.image-crop-confirm"),children:(0,bS.jsx)(AF,{small:!0,icon:"check"})})]}):(0,bS.jsxs)(bS.Fragment,{children:[!j&&(0,bS.jsx)(C8,{type:"icon","data-testid":"tool.image-replace",onClick:t,title:h("tool.replace-media"),children:(0,bS.jsx)(AF,{small:!0,icon:"tool-media"})}),!j&&(0,bS.jsx)(C8,{type:"icon",title:h("tool.image-crop"),onClick:d,"data-testid":"tool.image-crop",children:(0,bS.jsx)(AF,{small:!0,icon:"crop"})}),(0,bS.jsx)(C8,{type:"icon",title:h("action.download-original"),onClick:u,"data-testid":"tool.image-download",children:(0,bS.jsx)(AF,{small:!0,icon:"download"})}),(v||!j)&&(0,bS.jsx)(C8,{type:"icon",title:h("tool.media-alt-text"),"data-testid":"tool.image-alt-text",onClick:()=>{g("alt-text-start",{source:"image-toolbar"}),c()},children:(0,bS.jsx)(AF,{small:!0,icon:"alt"})})]})});function H3({children:a}){let b=jA(),c=d8("imageShape",()=>{let a=b.getOnlySelectedShape();return a&&"image"===a.type?a.id:null},[b]),d=d8("showToolbar",()=>b.isInAny("select.idle","select.pointing_shape","select.crop"),[b]),e=d8("locked",()=>!!c&&b.getShape(c)?.isLocked,[b,c]);return c&&d&&!e?(0,bS.jsx)(H4,{imageShapeId:c,children:a},c):null}function H4({children:a,imageShapeId:b}){let c=jA(),d=Am(),e=d8("editor path",()=>c.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[c]),f=d8("camera",()=>c.getCamera(),[c]),g=d8("editor path",()=>c.isIn("select.crop."),[c]),h=(0,bT.useRef)(void 0),i=(0,bT.useCallback)(()=>{c.setCroppingShape(null),c.setCurrentTool("select.idle")},[c]),[j,k]=(0,bT.useState)(!1),l=(0,bT.useCallback)(()=>k(!0),[]),m=(0,bT.useCallback)(()=>c.setCurrentTool("select.crop.idle"),[c]),n=(0,bT.useCallback)(()=>k(!1),[]);(0,bT.useEffect)(()=>{h.current=void 0},[f]);let o=(0,bT.useCallback)(()=>{if(g&&h.current)return h.current;let a=c.getSelectionScreenBounds();if(!a)return;let b=new kt(a.x,a.y,a.width,0);return h.current=b,b},[c,g]);return e?(h.current=void 0,null):(0,bS.jsx)(HU,{className:"tlui-image__toolbar",getSelectionBounds:o,label:d("tool.image-toolbar-title"),children:a||(j?(0,bS.jsx)(HW,{shapeId:b,onClose:n,source:"image-toolbar"}):(0,bS.jsx)(H2,{imageShapeId:b,isManipulating:g,onEditAltTextStart:l,onManipulatingStart:m,onManipulatingEnd:i}))})}function H5({textEditor:a,onEditLinkStart:b}){let c=BP(),d=Am(),[e,f]=(0,bT.useState)(0);return(0,bT.useEffect)(function(){function b(){f(a=>a+1)}a.on("update",b),a.on("selectionUpdate",b)},[a]),(0,bT.useEffect)(()=>{function a(a){b&&jr(a)&&a.shiftKey&&"k"===a.key&&(a.preventDefault(),b())}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[b]),(0,bT.useMemo)(()=>{function d(b,d){a.view&&(c("rich-text",{operation:b,source:"rich-text-menu"}),a.chain().focus()[d]().run())}return[{name:"bold",onSelect(){d("bold","toggleBold")}},{name:"italic",onSelect(){d("bold","toggleItalic")}},{name:"code",onSelect(){d("bold","toggleCode")}},b?{name:"link",onSelect(){b()}}:void 0,{name:"bulletList",onSelect(){d("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){d("bulletList","toggleHighlight")}}].filter(Boolean)},[a,c,b]).map(({name:b,attrs:c,onSelect:e})=>{let f=!!a.view&&a.isActive(b,c);return(0,bS.jsx)(C8,{title:d(`tool.rich-text-${b}`),"data-testid":`rich-text.${b}`,type:"icon",isActive:f,onPointerDown:jm,onClick:e,role:"option","aria-pressed":f,children:(0,bS.jsx)(AF,{small:!0,icon:b})},b)})}function H6({textEditor:a,value:b,onClose:c}){let d=jA(),[e,f]=(0,bT.useState)(b),g=Am(),h=(0,bT.useRef)(null),i=BP(),j="rich-text-menu",k=e.startsWith("http")?e:`https://${e}`;return(0,bT.useEffect)(()=>{h.current?.focus()},[e]),(0,bT.useEffect)(()=>{f(b)},[b]),(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(AL,{ref:h,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:e,onValueChange:a=>f(a),onComplete:b=>{i("rich-text",{operation:"link-edit",source:j}),b.startsWith("http://")||b.startsWith("https://")||(b=`https://${b}`),a.chain().setLink({href:b}).run(),d.getInstanceState().isCoarsePointer?a.commands.blur():a.commands.focus(),c()},onCancel:()=>c(),placeholder:"example.com","aria-label":"example.com"}),(0,bS.jsx)(Ao,{className:"tlui-rich-text__toolbar-link-visit",title:g("tool.rich-text-link-visit"),type:"icon",onPointerDown:jm,onClick:()=>{i("rich-text",{operation:"link-visit",source:j}),zX(k,"_blank"),c()},disabled:!e,children:(0,bS.jsx)(AF,{small:!0,icon:"external-link"})}),(0,bS.jsx)(Ao,{className:"tlui-rich-text__toolbar-link-remove",title:g("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:jm,onClick:()=>{i("rich-text",{operation:"link-remove",source:j}),a.chain().unsetLink().focus().run(),c()},children:(0,bS.jsx)(AF,{small:!0,icon:"trash"})})]})}let H7=d3(function({children:a}){let b=jA(),c=d8("textEditor",()=>b.getRichTextEditor(),[b]);return b.getInstanceState().isCoarsePointer||!c?null:(0,bS.jsx)(H8,{textEditor:c,children:a})});function H8({textEditor:a,children:b}){let{isEditingLink:c,onEditLinkStart:d,onEditLinkClose:e}=function(a){let[b,c]=(0,bT.useState)(!1);(0,bT.useEffect)(()=>{if(!a)return void c(!1);let b=()=>{c(a.isActive("link"))};return a.view.dom.addEventListener("click",b),()=>{a.isInitialized&&a.view.dom.removeEventListener("click",b)}},[a,b]),(0,bT.useEffect)(()=>{if(a&&a.isActive("link"))try{let{from:b,to:c}=xL(a.state.doc.resolve(a.state.selection.from),a.schema.marks.link);a.state.selection.empty&&a.commands.setTextSelection({from:b,to:c})}catch{}},[a,b]);let d=(0,bT.useCallback)(()=>{c(!0)},[]),e=(0,bT.useCallback)(()=>{c(!1)},[]);return{isEditingLink:b,onEditLinkStart:d,onEditLinkClose:(0,bT.useCallback)(()=>{if(c(!1),!a)return;let b=a.state.selection.from;a.commands.setTextSelection({from:b,to:b})},[a]),onEditLinkCancel:e}}(a),[f,g]=(0,bT.useState)(null),h=(0,bT.useRef)(void 0),i=function(a){let[b,c]=(0,bT.useState)(!1);return(0,bT.useEffect)(()=>{if(!a)return;let b=cj(({isPointing:a})=>{c(a)},16),d=()=>b({isPointing:!0}),e=()=>b({isPointing:!1}),f=["touchstart","pointerdown","mousedown"],g=["touchend","pointerup","mouseup"];return f.forEach(b=>{a.view.dom.addEventListener(b,d)}),g.forEach(a=>{document.body.addEventListener(a,e)}),()=>{f.forEach(b=>{a.isInitialized&&a.view.dom.removeEventListener(b,d)}),g.forEach(a=>{document.body.removeEventListener(a,e)})}},[a]),b}(a),j=Am(),k=(0,bT.useCallback)(()=>{if(c)return h.current;let a=window.getSelection();if(!f||!a||0===a.rangeCount||a.isCollapsed)return;let b=[];for(let c=0;c<a.rangeCount;c++){let d=a.getRangeAt(c);b.push(HV(d.getBoundingClientRect()))}let d=kt.Common(b);return h.current=d,d},[f,c]);return(0,bT.useEffect)(()=>{let b=({editor:a})=>g(a.state.selection);return a.on("selectionUpdate",b),b({editor:a}),()=>{a.off("selectionUpdate",b)}},[a]),(0,bS.jsx)(HU,{className:"tlui-rich-text__toolbar",getSelectionBounds:k,isMousingDown:i,changeOnlyWhenYChanges:!0,label:j("tool.rich-text-toolbar-title"),children:b||(c?(0,bS.jsx)(H6,{textEditor:a,value:a.isActive("link")?a.getAttributes("link").href:"",onClose:e}):(0,bS.jsx)(H5,{textEditor:a,onEditLinkStart:d}))})}function H9(){let a=jA(),b=Am(),{orientation:c}=CW(),d=G9(),e=d?.get(gr),f=gq({isDarkMode:a.user.getIsDarkMode()}),g=e?.type==="shared"?gu(f,e.value,"solid"):gu(f,"black","solid"),h=d8("disable style panel",()=>a.isInAny("hand","zoom","eraser","laser"),[a]),i=(0,bT.useCallback)(b=>{b||a.updateInstanceState({isChangingStyle:!1})},[a]),{StylePanel:j}=Ji();return j?(0,bS.jsxs)(Ew,{id:"mobile style menu",onOpenChange:i,children:[(0,bS.jsx)(Ex,{children:(0,bS.jsx)(Ao,{type:"tool","data-testid":"mobile-styles.button",style:{color:h?"var(--tl-color-muted-1)":g},title:b("style-panel.title"),disabled:h,children:(0,bS.jsx)(AF,{icon:h?"blob":e?.type==="mixed"?"mixed":"blob"})})}),(0,bS.jsx)(Ey,{side:"horizontal"===c?"top":"right",align:"end",children:j&&(0,bS.jsx)(j,{isMobile:!0})})]}):null}function Ia(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Ic,{}),(0,bS.jsx)(Id,{}),(0,bS.jsx)(Ie,{}),(0,bS.jsx)(If,{}),(0,bS.jsx)(Ig,{}),(0,bS.jsx)(Ih,{}),(0,bS.jsx)(Ii,{}),(0,bS.jsx)(Ij,{}),(0,bS.jsx)(Ik,{}),(0,bS.jsx)(Il,{}),(0,bS.jsx)(In,{}),(0,bS.jsx)(Im,{}),(0,bS.jsx)(Iq,{}),(0,bS.jsx)(It,{}),(0,bS.jsx)(Io,{}),(0,bS.jsx)(Is,{}),(0,bS.jsx)(Ir,{}),(0,bS.jsx)(Ip,{}),(0,bS.jsx)(Iu,{}),(0,bS.jsx)(Iv,{}),(0,bS.jsx)(Iw,{}),(0,bS.jsx)(Ix,{}),(0,bS.jsx)(Iy,{}),(0,bS.jsx)(Iz,{}),(0,bS.jsx)(IA,{}),(0,bS.jsx)(IB,{}),(0,bS.jsx)(ID,{}),(0,bS.jsx)(IC,{})]})}function Ib({tool:a}){var b;let c,d,e=(b=Ep()[a],c=jA(),d=b?.meta?.geo,d8("is tool selected",()=>{if(!b)return!1;let a=c.getCurrentToolId();return"geo"===a?d===c.getSharedStyles().getAsKnownValue(h$):a===b.id},[c,b?.id,d]));return(0,bS.jsx)(Er,{toolId:a,isSelected:e})}function Ic(){return(0,bS.jsx)(Ib,{tool:"select"})}function Id(){return(0,bS.jsx)(Ib,{tool:"hand"})}function Ie(){return(0,bS.jsx)(Ib,{tool:"draw"})}function If(){return(0,bS.jsx)(Ib,{tool:"eraser"})}function Ig(){return(0,bS.jsx)(Ib,{tool:"arrow"})}function Ih(){return(0,bS.jsx)(Ib,{tool:"text"})}function Ii(){return(0,bS.jsx)(Ib,{tool:"note"})}function Ij(){return(0,bS.jsx)(Er,{toolId:"asset"})}function Ik(){return(0,bS.jsx)(Ib,{tool:"rectangle"})}function Il(){return(0,bS.jsx)(Ib,{tool:"ellipse"})}function Im(){return(0,bS.jsx)(Ib,{tool:"diamond"})}function In(){return(0,bS.jsx)(Ib,{tool:"triangle"})}function Io(){return(0,bS.jsx)(Ib,{tool:"rhombus"})}function Ip(){return(0,bS.jsx)(Ib,{tool:"heart"})}function Iq(){return(0,bS.jsx)(Ib,{tool:"hexagon"})}function Ir(){return(0,bS.jsx)(Ib,{tool:"cloud"})}function Is(){return(0,bS.jsx)(Ib,{tool:"star"})}function It(){return(0,bS.jsx)(Ib,{tool:"oval"})}function Iu(){return(0,bS.jsx)(Ib,{tool:"x-box"})}function Iv(){return(0,bS.jsx)(Ib,{tool:"check-box"})}function Iw(){return(0,bS.jsx)(Ib,{tool:"arrow-left"})}function Ix(){return(0,bS.jsx)(Ib,{tool:"arrow-up"})}function Iy(){return(0,bS.jsx)(Ib,{tool:"arrow-down"})}function Iz(){return(0,bS.jsx)(Ib,{tool:"arrow-right"})}function IA(){return(0,bS.jsx)(Ib,{tool:"line"})}function IB(){return(0,bS.jsx)(Ib,{tool:"highlight"})}function IC(){return(0,bS.jsx)(Ib,{tool:"frame"})}function ID(){return(0,bS.jsx)(Ib,{tool:"laser"})}let IE="u">typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function IF(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on".concat(b),c)}function IG(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on".concat(b),c)}function IH(a,b){let c=b.slice(0,b.length-1);for(let b=0;b<c.length;b++)c[b]=a[c[b].toLowerCase()];return c}function II(a){"string"!=typeof a&&(a="");let b=(a=a.replace(/\s/g,"")).split(","),c=b.lastIndexOf("");for(;c>=0;)b[c-1]+=",",b.splice(c,1),c=b.lastIndexOf("");return b}let IJ={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":IE?173:189,"=":IE?61:187,";":IE?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},IK={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},IL={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},IM={16:!1,18:!1,17:!1,91:!1},IN={};for(let a=1;a<20;a++)IJ["f".concat(a)]=111+a;let IO=[],IP=null,IQ="all",IR=new Map,IS=a=>IJ[a.toLowerCase()]||IK[a.toLowerCase()]||a.toUpperCase().charCodeAt(0);function IT(a){IQ=a||"all"}function IU(){return IQ||"all"}function IV(a){if(void 0===a)Object.keys(IN).forEach(a=>{Array.isArray(IN[a])&&IN[a].forEach(a=>IW(a)),delete IN[a]}),I$(null);else if(Array.isArray(a))a.forEach(a=>{a.key&&IW(a)});else if("object"==typeof a)a.key&&IW(a);else if("string"==typeof a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let[e,f]=c;"function"==typeof e&&(f=e,e=""),IW({key:a,scope:e,method:f,splitKey:"+"})}}let IW=a=>{let{key:b,scope:c,method:d,splitKey:e="+"}=a;II(b).forEach(a=>{let b=a.split(e),f=b.length,g=b[f-1],h="*"===g?"*":IS(g);if(!IN[h])return;c||(c=IU());let i=f>1?IH(IK,b):[],j=[];IN[h]=IN[h].filter(a=>{let b=(!d||a.method===d)&&a.scope===c&&function(a,b){let c=a.length>=b.length?a:b,d=a.length>=b.length?b:a,e=!0;for(let a=0;a<c.length;a++)-1===d.indexOf(c[a])&&(e=!1);return e}(a.mods,i);return b&&j.push(a.element),!b}),j.forEach(a=>I$(a))})};function IX(a,b,c,d){let e;if(b.element===d&&(b.scope===c||"all"===b.scope)){for(let a in e=b.mods.length>0,IM)Object.prototype.hasOwnProperty.call(IM,a)&&(!IM[a]&&b.mods.indexOf(+a)>-1||IM[a]&&-1===b.mods.indexOf(+a))&&(e=!1);(0!==b.mods.length||IM[16]||IM[18]||IM[17]||IM[91])&&!e&&"*"!==b.shortcut||(b.keys=[],b.keys=b.keys.concat(IO),!1===b.method(a,b)&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0)))}}function IY(a,b){let c=IN["*"],d=a.keyCode||a.which||a.charCode;if(a.key&&"capslock"===a.key.toLowerCase()||!IZ.filter.call(this,a))return;if((93===d||224===d)&&(d=91),-1===IO.indexOf(d)&&229!==d&&IO.push(d),["metaKey","ctrlKey","altKey","shiftKey"].forEach(b=>{let c=IL[b];a[b]&&-1===IO.indexOf(c)?IO.push(c):!a[b]&&IO.indexOf(c)>-1?IO.splice(IO.indexOf(c),1):"metaKey"===b&&a[b]&&(IO=IO.filter(a=>a in IL||a===d))}),d in IM){for(let b in IM[d]=!0,IK)if(Object.prototype.hasOwnProperty.call(IK,b)){let c=IL[IK[b]];IZ[b]=a[c]}if(!c)return}for(let b in IM)Object.prototype.hasOwnProperty.call(IM,b)&&(IM[b]=a[IL[b]]);a.getModifierState&&!(a.altKey&&!a.ctrlKey)&&a.getModifierState("AltGraph")&&(-1===IO.indexOf(17)&&IO.push(17),-1===IO.indexOf(18)&&IO.push(18),IM[17]=!0,IM[18]=!0);let e=IU();if(c)for(let d=0;d<c.length;d++)c[d].scope===e&&("keydown"===a.type&&c[d].keydown||"keyup"===a.type&&c[d].keyup)&&IX(a,c[d],e,b);if(!(d in IN))return;let f=IN[d],g=f.length;for(let c=0;c<g;c++)if(("keydown"===a.type&&f[c].keydown||"keyup"===a.type&&f[c].keyup)&&f[c].key){let d=f[c],{splitKey:g}=d,h=d.key.split(g),i=[];for(let a=0;a<h.length;a++)i.push(IS(h[a]));i.sort().join("")===IO.sort().join("")&&IX(a,d,e,b)}}function IZ(a,b,c){IO=[];let d=II(a),e=[],f="all",g=document,h=0,i=!1,j=!0,k="+",l=!1,m=!1;for(void 0===c&&"function"==typeof b&&(c=b),"[object Object]"===Object.prototype.toString.call(b)&&(b.scope&&(f=b.scope),b.element&&(g=b.element),b.keyup&&(i=b.keyup),void 0!==b.keydown&&(j=b.keydown),void 0!==b.capture&&(l=b.capture),"string"==typeof b.splitKey&&(k=b.splitKey),!0===b.single&&(m=!0)),"string"==typeof b&&(f=b),m&&IV(a,f);h<d.length;h++)a=d[h].split(k),e=[],a.length>1&&(e=IH(IK,a)),(a="*"===(a=a[a.length-1])?"*":IS(a))in IN||(IN[a]=[]),IN[a].push({keyup:i,keydown:j,scope:f,mods:e,shortcut:d[h],method:c,key:d[h],splitKey:k,element:g});if(void 0!==g&&window){if(!IR.has(g)){let a=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return IY(a,g)},b=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;IY(a,g);let b=a.keyCode||a.which||a.charCode;a.key&&"capslock"===a.key.toLowerCase()&&(b=IS(a.key));let c=IO.indexOf(b);if(c>=0&&IO.splice(c,1),a.key&&"meta"===a.key.toLowerCase()&&IO.splice(0,IO.length),(93===b||224===b)&&(b=91),b in IM)for(let a in IM[b]=!1,IK)IK[a]===b&&(IZ[a]=!1)};IR.set(g,{keydownListener:a,keyupListenr:b,capture:l}),IF(g,"keydown",a,l),IF(g,"keyup",b,l)}if(!IP){let a=()=>{IO=[]};IP={listener:a,capture:l},IF(window,"focus",a,l)}}}function I$(a){let b=Object.values(IN).flat();if(0>b.findIndex(b=>{let{element:c}=b;return c===a})){let{keydownListener:b,keyupListenr:c,capture:d}=IR.get(a)||{};b&&c&&(IG(a,"keyup",c,d),IG(a,"keydown",b,d),IR.delete(a))}if((b.length<=0||IR.size<=0)&&(Object.keys(IR).forEach(a=>{let{keydownListener:b,keyupListenr:c,capture:d}=IR.get(a)||{};b&&c&&(IG(a,"keyup",c,d),IG(a,"keydown",b,d),IR.delete(a))}),IR.clear(),Object.keys(IN).forEach(a=>delete IN[a]),IP)){let{listener:a,capture:b}=IP;IG(window,"focus",a,b),IP=null}}let I_={getPressedKeyString:function(){return IO.map(a=>Object.keys(IJ).find(b=>IJ[b]===a)||Object.keys(IK).find(b=>IK[b]===a)||String.fromCharCode(a))},setScope:IT,getScope:IU,deleteScope:function(a,b){let c,d;for(let b in a||(a=IU()),IN)if(Object.prototype.hasOwnProperty.call(IN,b))for(d=0,c=IN[b];d<c.length;)c[d].scope===a?c.splice(d,1).forEach(a=>{let{element:b}=a;return I$(b)}):d++;IU()===a&&IT(b||"all")},getPressedKeyCodes:function(){return IO.slice(0)},getAllKeyCodes:function(){let a=[];return Object.keys(IN).forEach(b=>{IN[b].forEach(b=>{let{key:c,scope:d,mods:e,shortcut:f}=b;a.push({scope:d,shortcut:f,mods:e,keys:c.split("+").map(a=>IS(a))})})}),a},isPressed:function(a){return"string"==typeof a&&(a=IS(a)),-1!==IO.indexOf(a)},filter:function(a){let b=a.target||a.srcElement,{tagName:c}=b,d=!0,e="INPUT"===c&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(b.type);return(b.isContentEditable||(e||"TEXTAREA"===c||"SELECT"===c)&&!b.readOnly)&&(d=!1),d},trigger:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(IN).forEach(c=>{IN[c].filter(c=>c.scope===b&&c.shortcut===a).forEach(a=>{a&&a.method&&a.method()})})},unbind:IV,keyMap:IJ,modifier:IK,modifierMap:IL};for(let a in I_)Object.prototype.hasOwnProperty.call(I_,a)&&(IZ[a]=I_[a]);let I0=["copy","cut","paste","asset"];function I1(a){return a.menus.hasAnyOpenMenus()||null!==a.getEditingShapeId()||a.getCrashingError()||!a.user.getAreKeyboardShortcutsEnabled()}function I2(a){return(function(a){"string"!=typeof a&&(a="");let b=(a=a.replace(/\s/g,"")).split(","),c=b.lastIndexOf("");for(;c>=0;)b[c-1]+=",",b.splice(c,1),c=b.lastIndexOf("");return b})(a).map(a=>{let b=a.includes("!"),c=a.includes("?"),d=a.includes("$"),e=a.replace(/[!?$]/g,"");return b&&c&&d?`cmd+shift+alt+${e},ctrl+shift+alt+${e}`:b&&d?`cmd+shift+${e},ctrl+shift+${e}`:c&&d?`cmd+alt+${e},ctrl+alt+${e}`:c&&b?`shift+alt+${e}`:b?`shift+${e}`:c?`alt+${e}`:d?`cmd+${e},ctrl+${e}`:e}).join(",")}let I3=(0,bT.createContext)(!1),I4={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function I5({children:a,orientation:b,sizingParentClassName:c,minItems:d,minSizePx:e,maxItems:f,maxSizePx:g}){let h=jA(),i=ju(),j=A0(),k=Am(),l=(0,bT.useRef)([]),[m,n]=(0,bT.useState)(!1),o=(0,bT.useRef)(null),[p,q]=(0,bT.useState)(null),[r,s]=(0,bT.useState)(null),[t,u]=(0,bT.useState)(!1),v=lP(()=>{if(!o.current)return;let a="horizontal"===b?"offsetWidth":"offsetHeight",h=j(o.current.children),i=p?j(p.children):null;function j(a){let b=[];for(let c of a)c.classList.contains("tlui-main-toolbar__group")?b.push({type:"group",items:j(c.children),element:c}):c.hasAttribute("data-radix-popper-content-wrapper")||b.push({type:"item",element:c});return b}let k=Math.floor(cD(I6(o.current,c)[a],[e,g],[d,f],!0)),m=0,n=null,q=!1,t=[],{didShowAnyInOverflow:v}=function a(b,c){c&&cd(b.length===c.length);let d=!1,e=!1;for(let f=0;f<b.length;f++){let g=b[f],h=c?.[f];if("item"===g.type){let a,b=g.element.getAttribute("data-value")===r;a=r?m<k||b:m<=k;let c=m>=k;d||=a,e||=c,I7(g.element,"data-toolbar-visible",a?"true":"false"),h&&(cd("item"===h.type),I7(h.element,"data-toolbar-visible",c?"true":"false")),c&&"true"===g.element.getAttribute("aria-pressed")&&(n=g.element.getAttribute("data-value")),a&&"BUTTON"===g.element.tagName&&t.push(g.element),!c&&b&&(q=!0),m++}else{let b,c;h?(cd("group"===h.type),c=h,b=a(g.items,c.items)):b=a(g.items,null),d||=b.didShowAnyInMain,e||=b.didShowAnyInOverflow,I7(g.element,"data-toolbar-visible",b.didShowAnyInMain?"true":"false"),c&&I7(c.element,"data-toolbar-visible",b.didShowAnyInOverflow?"true":"false")}}return{didShowAnyInMain:d,didShowAnyInOverflow:e}}(h,i);u(v),n?s(n):q&&s(null),l.current=t});(0,bT.useLayoutEffect)(()=>{v()}),(0,bT.useLayoutEffect)(()=>{if(!o.current)return;let a=new MutationObserver(v);a.observe(o.current,{childList:!0,subtree:!0,attributes:!0,characterData:!0});let b=I6(o.current,c),d=new ResizeObserver(v);return d.observe(b),()=>{a.disconnect(),d.disconnect()}},[v,c]),(0,bT.useEffect)(()=>{if(h.options.enableToolbarKeyboardShortcuts)return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)};function a(a){if(I1(h)||jq(!0)||a.ctrlKey||a.metaKey||a.altKey||a.shiftKey)return;let b=I4[a.key];"number"==typeof b&&(jm(a),l.current[b]?.click())}},[h]);let w="toolbar overflow";return(0,bS.jsx)(bS.Fragment,{children:(0,bS.jsxs)(C7,{orientation:b,className:(0,jb.default)("tlui-main-toolbar__tools",{"tlui-main-toolbar__tools__mobile":j<AZ.TABLET_SM}),label:k("tool-panel.title"),children:[(0,bS.jsx)("horizontal"===b?CX:CY,{id:`${i}_main`,ref:o,children:(0,bS.jsx)(A3,{type:"toolbar",sourceId:"toolbar",children:a})}),t&&(0,bS.jsx)(I3.Provider,{value:!0,children:(0,bS.jsxs)(Ew,{id:w,open:m,onOpenChange:n,children:[(0,bS.jsx)(Ex,{children:(0,bS.jsx)(C8,{title:k("tool-panel.more"),type:"tool",className:"tlui-main-toolbar__overflow","data-testid":"tools.more-button",children:(0,bS.jsx)(AF,{icon:"horizontal"===b?"chevron-up":"chevron-right"})})}),(0,bS.jsx)(Ey,{side:"horizontal"===b?"top":"right",align:"horizontal"===b?"center":"end",children:(0,bS.jsx)(C7,{orientation:"grid",className:"tlui-main-toolbar__overflow-content",ref:q,"data-testid":"tools.more-content",label:k("tool-panel.more"),id:`${i}_more`,onClick:()=>{mi.deleteOpenMenu(w,h.contextId),n(!1)},children:(0,bS.jsx)(A3,{type:"toolbar-overflow",sourceId:"toolbar",children:a})})})]})})]})})}function I6(a,b){let c=a;for(;c;){if(c.classList.contains(b))return c;c=c.parentElement}throw Error("Could not find parent with class name "+b)}function I7(a,b,c){a.getAttribute(b)!==c&&a.setAttribute(b,c)}function I8({activeToolId:a}){let b=jA(),c=A0(),d=Am(),e=Jn(),f=d8("is tool locked",()=>b.getInstanceState().isToolLocked,[b]),g=d8("current tool",()=>b.getCurrentTool(),[b]);if(!a||!g.isLockable)return null;let h=e["toggle-tool-lock"],i=h?.kbd?`${d("action.toggle-tool-lock")} ${BJ(h.kbd)}`:d("action.toggle-tool-lock");return(0,bS.jsx)(C5,{content:i,children:(0,bS.jsx)(Ao,{type:"normal","data-testid":"tool-lock",className:(0,jb.default)("tlui-main-toolbar__lock-button",{"tlui-main-toolbar__lock-button__mobile":c<AZ.TABLET_SM}),onClick:()=>b.updateInstanceState({isToolLocked:!f}),children:(0,bS.jsx)(AF,{icon:f?"lock":"unlock",small:!0})})})}let I9=(0,bT.memo)(function({children:a,orientation:b="horizontal",minItems:c=4,minSizePx:d=310,maxItems:e=8,maxSizePx:f=470}){let g=jA(),h=Am(),i=A0(),j=BE(),k=d8("current tool id",()=>g.getCurrentToolId(),[g]),l=(0,bT.useRef)(null);qq(l);let{ActionsMenu:m,QuickActions:n}=Ji(),o="menu"!==g.options.actionShortcutsLocation&&("toolbar"===g.options.actionShortcutsLocation||i<AZ.TABLET);return(0,bS.jsx)(CV,{orientation:b,tooltipSide:"horizontal"===b?"top":"right",children:(0,bS.jsx)("div",{ref:l,className:(0,jb.default)("tlui-main-toolbar",`tlui-main-toolbar--${b}`),children:(0,bS.jsxs)("div",{className:"tlui-main-toolbar__inner",children:[(0,bS.jsxs)("div",{className:"tlui-main-toolbar__left",children:[!j&&(0,bS.jsxs)("div",{className:"tlui-main-toolbar__extras",children:[o&&(0,bS.jsxs)(C7,{orientation:b,className:"tlui-main-toolbar__extras__controls",label:h("actions-menu.title"),children:[n&&(0,bS.jsx)(n,{}),m&&(0,bS.jsx)(m,{})]}),(0,bS.jsx)(I8,{activeToolId:k})]}),(0,bS.jsx)(I5,{orientation:b,sizingParentClassName:"tlui-main-toolbar",minItems:c,maxItems:e,minSizePx:d,maxSizePx:f,children:a??(0,bS.jsx)(Ia,{})})]}),i<AZ.TABLET_SM&&!j&&(0,bS.jsx)("div",{className:"tlui-main-toolbar__tools tlui-main-toolbar__mobile-style-panel",children:(0,bS.jsx)(H9,{})})]})})})}),Ja=d3(function({videoShapeId:a,onEditAltTextStart:b}){let c=jA(),d=BP(),e=Am(),f=c.getIsReadonly(),g=Jn(),h=(0,bT.useCallback)(()=>g["video-replace"].onSelect("video-toolbar"),[g]),i=(0,bT.useCallback)(()=>g["download-original"].onSelect("video-toolbar"),[g]),j=d8("altText",()=>c.getShape(a).props.altText,[c,a]);return(0,bS.jsxs)(bS.Fragment,{children:[!f&&(0,bS.jsx)(Ao,{type:"icon",title:e("tool.replace-media"),onClick:h,"data-testid":"tool.video-replace",children:(0,bS.jsx)(AF,{small:!0,icon:"tool-media"})}),(0,bS.jsx)(Ao,{type:"icon",title:e("action.download-original"),onClick:i,"data-testid":"tool.video-download",children:(0,bS.jsx)(AF,{small:!0,icon:"download"})}),(j||!f)&&(0,bS.jsx)(C8,{type:"icon",isActive:!!j,title:e("tool.media-alt-text"),"data-testid":"tool.video-alt-text",onClick:()=>{d("alt-text-start",{source:"video-toolbar"}),b()},children:(0,bS.jsx)(AF,{small:!0,icon:"alt"})})]})}),Jb=d3(function({children:a}){let b=jA(),c=d8("videoShape",()=>{let a=b.getOnlySelectedShape();return a&&"video"===a.type?a.id:null},[b]),d=b.isInAny("select.idle","select.pointing_shape"),e=d8("locked",()=>!!c&&b.getShape(c)?.isLocked,[b,c]);return c&&d&&!e?(0,bS.jsx)(Jc,{videoShapeId:c,children:a},c):null});function Jc({children:a,videoShapeId:b}){let c=jA(),d=Am(),[e,f]=(0,bT.useState)(!1),g=(0,bT.useCallback)(()=>f(!0),[]),h=(0,bT.useCallback)(()=>f(!1),[]),i=(0,bT.useCallback)(()=>{let a=c.getSelectionScreenBounds();if(a)return new kt(a.x,a.y,a.width,0)},[c]);return(0,bS.jsx)(HU,{className:"tlui-video__toolbar",getSelectionBounds:i,label:d("tool.video-toolbar-title"),children:a||(e?(0,bS.jsx)(HW,{shapeId:b,onClose:h,source:"video-toolbar"}):(0,bS.jsx)(Ja,{videoShapeId:b,onEditAltTextStart:g}))})}var BL=BL;function Jd(){return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(Dd,{actionId:"zoom-in",noClose:!0}),(0,bS.jsx)(Dd,{actionId:"zoom-out",noClose:!0}),(0,bS.jsx)(JC,{}),(0,bS.jsx)(JD,{}),(0,bS.jsx)(JE,{})]})}let Je=(0,bT.memo)(function({children:a}){let b=jG(),[c,d]=BQ("zoom menu"),e=a??(0,bS.jsx)(Jd,{});return(0,bS.jsxs)(BL.Root,{dir:"ltr",open:c,onOpenChange:d,modal:!1,children:[(0,bS.jsx)(Jf,{}),(0,bS.jsx)(BL.Portal,{container:b,children:(0,bS.jsx)(BL.Content,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,bS.jsx)(A3,{type:"menu",sourceId:"zoom-menu",children:e})})})]})}),Jf=()=>{let a=jA(),b=A0(),c=d8("zoom",()=>a.getZoomLevel(),[a]),d=Am(),e=(0,bT.useCallback)(()=>{a.resetZoom(a.getViewportScreenCenter(),{animation:{duration:a.options.animationMediumMs}})},[a]),f=`${Math.floor(100*c)}%`;return(0,bS.jsx)(C8,{asChild:!0,type:"icon","aria-label":`${d("navigation-zone.zoom")} \u2014 ${f}`,title:`${d("navigation-zone.zoom")} \u2014 ${f}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:e,children:(0,bS.jsx)(BL.Trigger,{dir:"ltr",children:b<AZ.MOBILE?null:(0,bS.jsx)("span",{style:{flexGrow:0,textAlign:"center"},children:f})})})},Jg=(0,bT.createContext)(null);function Jh({overrides:a={},children:b}){let c=jV(a,jY),d=A4();return(0,bS.jsx)(Jg.Provider,{value:(0,bT.useMemo)(()=>({ContextMenu:FL,ActionsMenu:FJ,HelpMenu:null,ZoomMenu:Je,MainMenu:Gs,Minimap:GS,StylePanel:HQ,PageMenu:GX,NavigationPanel:GT,Toolbar:I9,RichTextToolbar:H7,ImageToolbar:H3,VideoToolbar:Jb,KeyboardShortcutsDialog:Et,QuickActions:G_,HelperButtons:Gb,DebugPanel:F_,DebugMenu:F$,MenuPanel:F4,SharePanel:d?G7:null,CursorChatBubble:d?FM:null,TopPanel:null,Dialogs:F6,Toasts:HT,A11y:Aq,FollowingIndicator:F2,...c}),[c,d]),children:b})}function Ji(){let a=(0,bT.useContext)(Jg);if(!a)throw Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return a}let Jj=bT.createContext(null);function Jk(a,b){return(b.isShapeOfType(a,"image")||b.isShapeOfType(a,"video"))&&!!a.props.assetId}function Jl(a,b){if(0===a.getSelectedShapes().length)return a.getDocumentSettings().name||b}function Jm({overrides:a,children:b}){let c=jB(),d=A4(),e=Ek(),f=Ji(),g=BP(),h=Ac(),i=Am(),j=e.msg("document.default-name"),k=bT.useMemo(()=>{if(!c)return{};function b(){return c.isIn("select")||(c.complete(),c.setCurrentTool("select")),!1}function k(){return c.isIn("select")&&c.getSelectedShapeIds().length>0}function l(a){if(!k())return;b(),c.markHistoryStoppingPoint("resize shapes");let d=c.getSelectedShapeIds();0!==d.length&&c.run(()=>{d.map(a=>c.getShape(a)).filter(Boolean).forEach(b=>{c.resizeShape(b.id,new iK(a,a),{scaleOrigin:c.getSelectionPageBounds()?.center})})})}let m=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(a){k()&&(b(),g("edit-link",{source:a}),c.markHistoryStoppingPoint("edit-link"),e.addDialog({component:AP}))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(a){g("insert-embed",{source:a}),e.addDialog({component:AX})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(a){g("open-kbd-shortcuts",{source:a}),e.addDialog({component:f.KeyboardShortcutsDialog??Et})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(a){g("insert-media",{source:a}),e.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(a){g("undo",{source:a}),c.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(a){g("redo",{source:a}),c.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-as",{format:"svg",source:a}),e.exportAs(b,{format:"svg",name:Jl(c,j)}))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-as",{format:"png",source:a}),e.exportAs(b,{format:"png",name:Jl(c,j)}))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("export-all-as",{format:"svg",source:a}),e.exportAs(Array.from(c.getCurrentPageShapeIds()),{format:"svg",name:Jl(c,j)}))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(a){let b=Array.from(c.getCurrentPageShapeIds().values());0!==b.length&&(g("export-all-as",{format:"png",source:a}),e.exportAs(b,{format:"png",name:Jl(c,j)}))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("copy-as",{format:"svg",source:a}),e.copyAs(b,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(a){let b=c.getSelectedShapeIds();0===b.length&&(b=Array.from(c.getCurrentPageShapeIds().values())),0!==b.length&&(g("copy-as",{format:"png",source:a}),e.copyAs(b,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(a){k()&&(b(),g("toggle-auto-size",{source:a}),c.markHistoryStoppingPoint("toggling auto size"),c.run(()=>{let a=c.getSelectedShapes().filter(a=>c.isShapeOfType(a,"text")&&!1===a.props.autoSize);c.updateShapes(a.map(a=>({id:a.id,type:a.type,props:{...a.props,w:8,autoSize:!0}}))),sB(c,a.map(a=>a.id))}))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(a){g("open-embed-link",{source:a});let b=c.getSelectedShapeIds(),d="No embed shapes selected";if(1!==b.length)return void console.error(d);let e=c.getShape(b[0]);e&&c.isShapeOfType(e,"embed")?zX(e.props.url,"_blank"):console.error(d)}},{id:"select-zoom-tool",label:"action.select-zoom-tool",readonlyOk:!0,kbd:"z, !z",onSelect(a){if(c.inputs.getAccelKey())return;let b=c.getPath();b.endsWith(".idle")&&c.root.getCurrent()?.id!=="zoom"&&(g("zoom-tool",{source:a}),c.setCurrentTool("zoom",{onInteractionEnd:b,maskAs:"zoom"}))}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",async onSelect(a){if(!k())return;b(),g("convert-to-bookmark",{source:a});let d=c.getSelectedShapes(),e=c.markHistoryStoppingPoint("convert shapes to bookmark"),f=[];for(let a of d){if(!a||!c.isShapeOfType(a,"embed")||!a.props.url)continue;let b=c.getShapePageBounds(a)?.center;b&&(c.deleteShapes([a.id]),f.push(Ax(c,{url:a.props.url,center:b}).then(a=>{if(!a.ok)throw Error(a.error);return a})))}await Promise.all(f).catch(a=>{c.bailToMark(e),console.error(a)})}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(a){k()&&(b(),g("convert-to-embed",{source:a}),c.run(()=>{let a=b4(c.getSelectedShapeIds().map(a=>c.getShape(a))),b=[],d=[];for(let f of a){if(!c.isShapeOfType(f,"bookmark"))continue;let{url:a}=f.props,g=e.getEmbedDefinition(a);if(!g||!g.definition)continue;let{width:h,height:i}=g.definition,j=new iK(f.x,f.y);j.rot(-f.rotation),j.add(new iK(f.props.w/2-h/2,f.props.h/2-i/2)),j.rot(f.rotation);let k={id:gi(),type:"embed",x:j.x,y:j.y,rotation:f.rotation,props:{url:a,w:h,h:i}};b.push(k),d.push(f.id)}c.markHistoryStoppingPoint("convert shapes to embed"),c.deleteShapes(d),c.createShapes(b)}))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(a){let d,e;if(!k())return;b(),g("duplicate-shapes",{source:a});let f=c.getInstanceState();if(f.duplicateProps)d=f.duplicateProps.shapeIds,e=f.duplicateProps.offset;else{d=c.getSelectedShapeIds();let a=kt.Common(b4(d.map(a=>c.getShapePageBounds(a))));e=c.getCameraOptions().isLocked?{x:c.options.adjacentShapeMargin,y:c.options.adjacentShapeMargin}:{x:a.width+c.options.adjacentShapeMargin,y:0}}c.markHistoryStoppingPoint("duplicate shapes"),c.duplicateShapes(d,e),f.duplicateProps&&c.updateInstanceState({duplicateProps:{...f.duplicateProps,shapeIds:c.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(a){k()&&(b(),g("ungroup-shapes",{source:a}),c.markHistoryStoppingPoint("ungroup"),c.ungroupShapes(c.getSelectedShapeIds()))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(a){if(!k())return;b(),g("group-shapes",{source:a});let d=c.getOnlySelectedShape();d&&c.isShapeOfType(d,"group")?(c.markHistoryStoppingPoint("ungroup"),c.ungroupShapes(c.getSelectedShapeIds())):(c.markHistoryStoppingPoint("group"),c.groupShapes(c.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(a){if(!k())return;g("remove-frame",{source:a});let b=c.getSelectedShapes();b.length>0&&b.every(a=>c.isShapeOfType(a,"frame"))&&(c.markHistoryStoppingPoint("remove-frame"),function(a,b){let c=b4(b.map(b=>a.getShape(b)).filter(b=>b&&a.isShapeOfType(b,"frame")));if(!c.length)return;let d=[];a.run(()=>{c.map(b=>{let e=a.getSortedChildIdsForParent(b.id);e.length&&(sB(a,e,{filter:a=>!c.find(b=>b.id===a.id)}),d.push(...e))}),a.setSelectedShapes(d),a.deleteShapes(b)})}(c,b.map(a=>a.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(a){if(!k())return;g("fit-frame-to-content",{source:a});let b=c.getOnlySelectedShape();b&&c.isShapeOfType(b,"frame")&&(c.markHistoryStoppingPoint("fit-frame-to-content"),Az(c,b.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(a){k()&&(b(),g("align-shapes",{operation:"left",source:a}),c.markHistoryStoppingPoint("align left"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"left"),sB(c,a)}))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(a){k()&&(b(),g("align-shapes",{operation:"center-horizontal",source:a}),c.markHistoryStoppingPoint("align center horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"center-horizontal"),sB(c,a)}))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(a){k()&&(b(),g("align-shapes",{operation:"right",source:a}),c.markHistoryStoppingPoint("align right"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"right"),sB(c,a)}))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(a){k()&&(b(),g("align-shapes",{operation:"center-vertical",source:a}),c.markHistoryStoppingPoint("align center vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"center-vertical"),sB(c,a)}))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(a){k()&&(b(),g("align-shapes",{operation:"top",source:a}),c.markHistoryStoppingPoint("align top"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"top"),sB(c,a)}))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(a){k()&&(b(),g("align-shapes",{operation:"bottom",source:a}),c.markHistoryStoppingPoint("align bottom"),c.run(()=>{let a=c.getSelectedShapeIds();c.alignShapes(a,"bottom"),sB(c,a)}))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(a){k()&&(b(),g("distribute-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("distribute horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.distributeShapes(a,"horizontal"),sB(c,a)}))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(a){k()&&(b(),g("distribute-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("distribute vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.distributeShapes(a,"vertical"),sB(c,a)}))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(a){k()&&(b(),g("stretch-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("stretch horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.stretchShapes(a,"horizontal"),sB(c,a)}))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(a){k()&&(b(),g("stretch-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("stretch vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.stretchShapes(a,"vertical"),sB(c,a)}))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(a){k()&&(b(),g("flip-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("flip horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.flipShapes(a,"horizontal"),sB(c,a)}))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(a){k()&&(b(),g("flip-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("flip vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.flipShapes(a,"vertical"),sB(c,a)}))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(a){k()&&(b(),g("pack-shapes",{source:a}),c.markHistoryStoppingPoint("pack"),c.run(()=>{let a=c.getSelectedShapeIds();c.packShapes(a,c.options.adjacentShapeMargin),sB(c,a)}))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(a){k()&&(b(),g("stack-shapes",{operation:"vertical",source:a}),c.markHistoryStoppingPoint("stack-vertical"),c.run(()=>{let a=c.getSelectedShapeIds();c.stackShapes(a,"vertical",c.options.adjacentShapeMargin),sB(c,a)}))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(a){k()&&(b(),g("stack-shapes",{operation:"horizontal",source:a}),c.markHistoryStoppingPoint("stack-horizontal"),c.run(()=>{let a=c.getSelectedShapeIds();c.stackShapes(a,"horizontal",c.options.adjacentShapeMargin),sB(c,a)}))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"toFront",source:a}),c.markHistoryStoppingPoint("bring to front"),c.bringToFront(c.getSelectedShapeIds()))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"forward",source:a}),c.markHistoryStoppingPoint("bring forward"),c.bringForward(c.getSelectedShapeIds()))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"backward",source:a}),c.markHistoryStoppingPoint("send backward"),c.sendBackward(c.getSelectedShapeIds()))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(a){k()&&(b(),g("reorder-shapes",{operation:"toBack",source:a}),c.markHistoryStoppingPoint("send to back"),c.sendToBack(c.getSelectedShapeIds()))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(a){k()&&(b(),c.markHistoryStoppingPoint("cut"),e.cut(a))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(a){k()&&(b(),e.copy(a))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(a){navigator.clipboard?.read().then(b=>{e.paste(b,a,"context-menu"===a?c.inputs.getCurrentPagePoint():void 0)}).catch(()=>{e.addToast({title:e.msg("action.paste-error-title"),description:e.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(a){c.run(()=>{b(),g("select-all-shapes",{source:a}),c.markHistoryStoppingPoint("select all kbd"),c.selectAll()})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(a){k()&&(b(),g("select-none-shapes",{source:a}),c.markHistoryStoppingPoint("select none"),c.selectNone())}},{id:"delete",label:"action.delete",kbd:"⌫,del",icon:"trash",onSelect(a){k()&&(b(),g("delete-shapes",{source:a}),c.markHistoryStoppingPoint("delete"),c.deleteShapes(c.getSelectedShapeIds()))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",kbd:"shift+.,shift+alt+.",onSelect(a){if(!k())return;b();let d=c.inputs.getAltKey();g("rotate-cw",{source:a,fine:d}),c.markHistoryStoppingPoint("rotate-cw"),c.run(()=>{let a=iP/(d?96:6),b=c.getSelectionRotation()%a,e=iU(b,0)||iU(b,a),f=c.getSelectedShapeIds();c.rotateShapesBy(f,a-(e?0:b)),sB(c,f)})}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",kbd:"shift+,,shift+alt+,",onSelect(a){if(!k())return;b();let d=c.inputs.getAltKey();g("rotate-ccw",{source:a,fine:d}),c.markHistoryStoppingPoint("rotate-ccw"),c.run(()=>{let a=iP/(d?96:6),b=c.getSelectionRotation()%a,e=iU(b,0),f=c.getSelectedShapeIds();c.rotateShapesBy(f,e?-a:-b),sB(c,f)})}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(a){g("zoom-in",{source:a,towardsCursor:!1}),c.zoomIn(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(a){g("zoom-in",{source:a,towardsCursor:!0}),c.zoomIn(c.inputs.getCurrentScreenPoint(),{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(a){g("zoom-out",{source:a,towardsCursor:!1}),c.zoomOut(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(a){g("zoom-out",{source:a,towardsCursor:!0}),c.zoomOut(c.inputs.getCurrentScreenPoint(),{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(a){g("reset-zoom",{source:a}),c.resetZoom(void 0,{animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(a){g("zoom-to-fit",{source:a}),c.zoomToFit({animation:{duration:c.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(a){k()&&(b(),g("zoom-to-selection",{source:a}),c.zoomToSelection({animation:{duration:c.options.animationMediumMs}}))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(a){g("toggle-snap-mode",{source:a}),c.user.updateUserPreferences({isSnapMode:!c.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(a){let b=c.user.getIsDarkMode()?"light":"dark";g("color-scheme",{source:a,value:b}),c.user.updateUserPreferences({colorScheme:b})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(a){g("toggle-wrap-mode",{source:a}),c.user.updateUserPreferences({isWrapMode:!c.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(a){g("toggle-dynamic-size-mode",{source:a}),c.user.updateUserPreferences({isDynamicSizeMode:!c.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(a){g("toggle-paste-at-cursor",{source:a}),c.user.updateUserPreferences({isPasteAtCursorMode:!c.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(a){g("toggle-reduce-motion",{source:a}),c.user.updateUserPreferences({animationSpeed:+(0===c.user.getAnimationSpeed())})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(a){g("toggle-keyboard-shortcuts",{source:a}),c.user.updateUserPreferences({areKeyboardShortcutsEnabled:!c.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"enhanced-a11y-mode",label:{default:"action.enhanced-a11y-mode",menu:"action.enhanced-a11y-mode.menu"},readonlyOk:!0,onSelect(a){g("enhanced-a11y-mode",{source:a}),c.user.updateUserPreferences({enhancedA11yMode:!c.user.getEnhancedA11yMode()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(a){g("toggle-edge-scrolling",{source:a}),c.user.updateUserPreferences({edgeScrollSpeed:+(0===c.user.getEdgeScrollSpeed())})},checkbox:!0},{id:"toggle-invert-zoom",label:{default:"action.toggle-invert-zoom",menu:"action.toggle-invert-zoom.menu"},readonlyOk:!0,onSelect(a){g("toggle-invert-zoom",{source:a}),c.user.updateUserPreferences({isZoomDirectionInverted:!c.user.getIsZoomDirectionInverted()})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(a){g("toggle-transparent",{source:a}),c.updateInstanceState({exportBackground:!c.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(a){g("toggle-tool-lock",{source:a}),c.updateInstanceState({isToolLocked:!c.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(a){g("unlock-all",{source:a});let b=[];for(let a of c.getCurrentPageShapes())a.isLocked&&b.push({id:a.id,type:a.type,isLocked:!1});b.length>0&&c.updateShapes(b)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(a){c.timers.requestAnimationFrame(()=>{c.run(()=>{g("toggle-focus-mode",{source:a}),e.clearDialogs(),e.clearToasts(),c.updateInstanceState({isFocusMode:!c.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(a){g("toggle-grid-mode",{source:a}),c.updateInstanceState({isGridMode:!c.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(a){g("toggle-debug-mode",{source:a}),c.updateInstanceState({isDebugMode:!c.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(a){g("print",{source:a}),e.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(a){g("exit-pen-mode",{source:a}),c.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(a){g("stop-following",{source:a}),c.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(a){g("zoom-to-content",{source:a});let b=c.getSelectionPageBounds()??c.getCurrentPageBounds();b&&c.zoomToBounds(b,{targetZoom:Math.min(1,c.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(a){k()&&(c.markHistoryStoppingPoint("locking"),g("toggle-lock",{source:a}),c.toggleLock(c.getSelectedShapeIds()))}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(a){let b=gZ.createId(),d=c.getSelectedShapeIds();c.run(()=>{c.markHistoryStoppingPoint("move_shapes_to_page"),c.createPage({name:e.msg("page-menu.new-page-initial-name"),id:b}),c.moveShapesToPage(d,b)}),g("move-to-new-page",{source:a})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-color"),c.isIn("select")&&c.setStyleForSelectedShapes(gr,"white"),c.setStyleForNextShapes(gr,"white")}),g("set-style",{source:a,id:gr.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-fill"),c.isIn("select")&&c.setStyleForSelectedShapes(gw,"fill"),c.setStyleForNextShapes(gw,"fill")}),g("set-style",{source:a,id:gw.id,value:"fill"})}},{id:"select-fill-lined-fill",label:"fill-style.lined-fill",kbd:"alt+shift+f",onSelect(a){c.run(()=>{c.markHistoryStoppingPoint("change-fill"),c.isIn("select")&&c.setStyleForSelectedShapes(gw,"lined-fill"),c.setStyleForNextShapes(gw,"lined-fill")}),g("set-style",{source:a,id:gw.id,value:"lined-fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async a=>{let b=c.getSelectedShapeIds();if(0===b.length)return;c.markHistoryStoppingPoint("flattening to image"),g("flatten-to-image",{source:a});let d=await Eu(c,b,c.options.flattenImageBoundsExpand);d?.length&&c.setSelectedShapes(d)}},{id:"select-geo-tool",kbd:"g",onSelect:async a=>{g("select-tool",{source:a,id:"geo-previous"}),c.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async a=>{let b=c.getPages(),d=b.findIndex(a=>a.id===c.getCurrentPageId());d<1||(g("change-page",{source:a,direction:"prev"}),c.setCurrentPage(b[d-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async a=>{let b=c.getPages(),d=b.findIndex(a=>a.id===c.getCurrentPageId());if(-1===d||d>=b.length-1){if(c.getCurrentPageShapes().length<=0||c.getIsReadonly())return;g("new-page",{source:a}),c.run(()=>{c.markHistoryStoppingPoint("creating page");let a=gZ.createId();c.createPage({name:e.msg("page-menu.new-page-initial-name"),id:a}),c.setCurrentPage(a)});return}c.setCurrentPage(b[d+1].id),g("change-page",{source:a,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async a=>{if(!k())return;let b=c.getOnlySelectedShape();if(b&&(c.isShapeOfType(b,"image")||c.isShapeOfType(b,"video"))){let a=c.getContainer().querySelector(".tlui-contextual-toolbar button:first-child");a?.focus();return}let d=c.getContainer().querySelector(".tlui-style-panel button");d?.focus(),g("adjust-shape-styles",{source:a})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async a=>{if(!k())return;let b=c.getSelectionPageBounds();if(!b)return;let d=b.x+b.width/2,e=b.y+b.height/2,f=c.pageToScreen(new iK(d,e));c.getContainer().querySelector(".tl-canvas")?.dispatchEvent(new PointerEvent("contextmenu",{clientX:f.x,clientY:f.y,bubbles:!0})),g("open-context-menu",{source:a})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async a=>{k()&&(l(1.1),g("enlarge-shapes",{source:a}))}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async a=>{k()&&(l(1/1.1),g("shrink-shapes",{source:a}))}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async a=>{let b=c.getSelectedShapeIds();if(!b.length)return;let d=Ar({editor:c,selectedShapeIds:b,msg:i});d&&(h.announce({msg:""}),c.timers.requestAnimationFrame(()=>{h.announce({msg:d})}),g("a11y-repeat-shape-announce",{source:a}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async a=>{g("image-replace",{source:a}),e.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async a=>{g("video-replace",{source:a}),e.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async a=>{let b=c.getSelectedShapes();if(0===b.length)return;let d=b.filter(a=>Jk(a,c));if(0!==d.length){for(let a of d){let b=c.getAsset(a.props.assetId);if(!b||!b.props.src)continue;let d=await c.resolveAssetUrl(b.id,{shouldResolveToOriginal:!0});if(!d)return;let e=document.createElement("a");e.href=d,"video"!==b.type&&"image"!==b.type||b.props.src.startsWith("asset:")?e.download="download":e.download=b.props.name,document.body.appendChild(e),e.click(),document.body.removeChild(e)}g("download-original",{source:a})}}}];d&&m.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(a){g("open-cursor-chat",{source:a}),c.getInstanceState().isCoarsePointer||c.timers.requestAnimationFrame(()=>{c.updateInstanceState({isChatting:!0})})}});let n=Object.fromEntries(m.map(a=>[a.id,a]));return a?a(c,n,e):n},[e,c,g,a,j,d,i,h,f]);return(0,bS.jsx)(Jj.Provider,{value:k,children:b})}function Jn(){let a=bT.useContext(Jj);if(!a)throw Error("useTools must be used within a ToolProvider");return a}function Jo(a,b){return a?"string"==typeof a?a:b?a[b]??a.default:void 0:void 0}function Jp({actionId:a="",...b}){let c=Jn()[a];return c?(0,bS.jsx)(FR,{...c,...b}):null}function Jq(){let a;return d8("showAutoSizeToggle",()=>{let b=a.getSelectedShapes();return 1===b.length&&a.isShapeOfType(b[0],"text")&&!1===b[0].props.autoSize},[a=jA()])?(0,bS.jsx)(Dd,{actionId:"toggle-auto-size"}):null}function Jr(){return Ft()?(0,bS.jsx)(Dd,{actionId:"edit-link"}):null}function Js(){return Fs(1)?(0,bS.jsx)(Dd,{actionId:"duplicate"}):null}function Jt(){let a=jA();return d8("should display flatten option",()=>{if(0===a.getSelectedShapeIds().length)return!1;let b=a.getOnlySelectedShape();return!(b&&a.isShapeOfType(b,"image"))},[a])?(0,bS.jsx)(Dd,{actionId:"flatten-to-image"}):null}function Ju(){let a=jA();return d8("should display download original option",()=>{let b=a.getSelectedShapes();return 0!==b.length&&b.some(b=>Jk(b,a))},[a])?(0,bS.jsx)(Dd,{actionId:"download-original"}):null}function Jv(){return Fq()?(0,bS.jsx)(Dd,{actionId:"group"}):null}function Jw(){return Fr()?(0,bS.jsx)(Dd,{actionId:"ungroup"}):null}function Jx(){let a=jA();return d8("allow unframe",()=>{let b=a.getSelectedShapes();return 0!==b.length&&b.every(b=>a.isShapeOfType(b,"frame"))},[a])?(0,bS.jsx)(Dd,{actionId:"remove-frame"}):null}function Jy(){let a=jA();return d8("allow fit frame to content",()=>{let b=a.getOnlySelectedShape();return!!b&&a.isShapeOfType(b,"frame")&&a.getSortedChildIdsForParent(b).length>0},[a])?(0,bS.jsx)(Dd,{actionId:"fit-frame-to-content"}):null}function Jz(){let a=jA();return d8("selected shapes",()=>a.getSelectedShapes().length>0,[a])?(0,bS.jsx)(Dd,{actionId:"toggle-lock"}):null}function JA(){let a=jA(),b=d8("isTransparentBg",()=>!a.getInstanceState().exportBackground,[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-transparent",checked:b,toggle:!0})}function JB(){let a=jA(),b=d8("any shapes",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bS.jsx)(Dd,{actionId:"unlock-all",disabled:!b})}function JC(){let a=jA(),b=d8("zoomed to 100",()=>1===a.getEfficientZoomLevel(),[a]);return(0,bS.jsx)(Dd,{actionId:"zoom-to-100",noClose:!0,disabled:b})}function JD(){let a=jA(),b=d8("has shapes",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bS.jsx)(Dd,{actionId:"zoom-to-fit",disabled:!b,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function JE(){let a=Fw();return(0,bS.jsx)(Dd,{actionId:"zoom-to-selection",disabled:!a,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function JF(){return(0,bS.jsxs)(De,{id:"clipboard",children:[(0,bS.jsx)(JH,{}),(0,bS.jsx)(JI,{}),(0,bS.jsx)(JJ,{}),(0,bS.jsx)(Js,{}),(0,bS.jsx)(JM,{})]})}function JG(){let a=jA(),b=d8("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bS.jsxs)(FS,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!b,children:[(0,bS.jsxs)(De,{id:"copy-as-group",children:[(0,bS.jsx)(Dd,{actionId:"copy-as-svg"}),!!window.navigator.clipboard?.write&&(0,bS.jsx)(Dd,{actionId:"copy-as-png"})]}),(0,bS.jsx)(De,{id:"copy-as-bg",children:(0,bS.jsx)(JA,{})})]})}function JH(){let a=Fw(),b=Fs(1);return(0,bS.jsx)(Dd,{actionId:"cut",disabled:!a||!b})}function JI(){let a=Fw();return(0,bS.jsx)(Dd,{actionId:"copy",disabled:!a})}function JJ(){return(0,bS.jsx)(Dd,{actionId:"paste",disabled:!0})}function JK(){let a=jA();return d8("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a])?(0,bS.jsxs)(De,{id:"conversions",children:[(0,bS.jsx)(JG,{}),(0,bS.jsxs)(FS,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,bS.jsxs)(De,{id:"export-as-group",children:[(0,bS.jsx)(Dd,{actionId:"export-as-svg"}),(0,bS.jsx)(Dd,{actionId:"export-as-png"})]}),(0,bS.jsx)(De,{id:"export-as-bg",children:(0,bS.jsx)(JA,{})})]}),(0,bS.jsx)(Ju,{})]}):null}function JL(){let a=jA(),b=d8("atLeastOneShapeOnPage",()=>a.getCurrentPageShapeIds().size>0,[a]);return(0,bS.jsx)(Dd,{actionId:"select-all",disabled:!b})}function JM(){let a=Fw(),b=Fs(1);return(0,bS.jsx)(Dd,{actionId:"delete",disabled:!a||!b})}function JN(){let a,b=BE();return!d8("selectedShapes",()=>{let b=a.getSelectedShapes().length;return b>=1},[a=jA(),1,void 0])||b?null:(0,bS.jsxs)(FS,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,bS.jsx)(Jv,{}),(0,bS.jsx)(Jw,{}),(0,bS.jsx)(Jt,{}),(0,bS.jsx)(Jr,{}),(0,bS.jsx)(Jy,{}),(0,bS.jsx)(Jx,{}),(0,bS.jsx)(JU,{}),(0,bS.jsx)(JT,{}),(0,bS.jsx)(Jq,{}),(0,bS.jsx)(Jz,{})]})}function JO(){let a,b=Fs(2),c=d8("onlyFlippableShape",()=>{let b=a.getOnlySelectedShape();return b&&(a.isShapeOfType(b,"group")||a.isShapeOfType(b,"image")||a.isShapeOfType(b,"arrow")||a.isShapeOfType(b,"line")||a.isShapeOfType(b,"draw"))},[a=jA()]);return BE()||!(b||c)?null:(0,bS.jsxs)(FS,{id:"arrange",label:"context-menu.arrange",size:"small",children:[b&&(0,bS.jsxs)(De,{id:"align",children:[(0,bS.jsx)(Dd,{actionId:"align-left"}),(0,bS.jsx)(Dd,{actionId:"align-center-horizontal"}),(0,bS.jsx)(Dd,{actionId:"align-right"}),(0,bS.jsx)(Dd,{actionId:"align-top"}),(0,bS.jsx)(Dd,{actionId:"align-center-vertical"}),(0,bS.jsx)(Dd,{actionId:"align-bottom"})]}),(0,bS.jsx)(JP,{}),b&&(0,bS.jsxs)(De,{id:"stretch",children:[(0,bS.jsx)(Dd,{actionId:"stretch-horizontal"}),(0,bS.jsx)(Dd,{actionId:"stretch-vertical"})]}),(b||c)&&(0,bS.jsxs)(De,{id:"flip",children:[(0,bS.jsx)(Dd,{actionId:"flip-horizontal"}),(0,bS.jsx)(Dd,{actionId:"flip-vertical"})]}),(0,bS.jsx)(JQ,{})]})}function JP(){return Fs(3)?(0,bS.jsxs)(De,{id:"distribute",children:[(0,bS.jsx)(Dd,{actionId:"distribute-horizontal"}),(0,bS.jsx)(Dd,{actionId:"distribute-vertical"})]}):null}function JQ(){let a=Fs(2),b=Fo();return a?(0,bS.jsxs)(De,{id:"order",children:[(0,bS.jsx)(Dd,{actionId:"pack"}),b&&(0,bS.jsx)(Dd,{actionId:"stack-horizontal"}),b&&(0,bS.jsx)(Dd,{actionId:"stack-vertical"})]}):null}function JR(){let a=BE(),b=Fs(1);return a||!b?null:(0,bS.jsx)(FS,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,bS.jsxs)(De,{id:"reorder",children:[(0,bS.jsx)(Dd,{actionId:"bring-to-front"}),(0,bS.jsx)(Dd,{actionId:"bring-forward"}),(0,bS.jsx)(Dd,{actionId:"send-backward"}),(0,bS.jsx)(Dd,{actionId:"send-to-back"})]})})}function JS(){let a=jA(),b=d8("pages",()=>a.getPages(),[a]),c=d8("current page id",()=>a.getCurrentPageId(),[a]),{addToast:d}=D$(),e=BP(),f=BE();return!Fs(1)||f?null:(0,bS.jsxs)(FS,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,bS.jsx)(De,{id:"pages",children:b.map(b=>(0,bS.jsx)(Db,{id:b.id,disabled:c===b.id,label:b.name.length>30?`${b.name.slice(0,30)}\u2026`:b.name,onSelect:()=>{a.markHistoryStoppingPoint("move_shapes_to_page"),a.moveShapesToPage(a.getSelectedShapeIds(),b.id);let f=a.getPage(b.id);f&&d({title:"Changed page",description:`Moved to ${f.name}.`,actions:[{label:"Go back",type:"primary",onClick:()=>{a.markHistoryStoppingPoint("change-page"),a.setCurrentPage(c)}}]}),e("move-to-page",{source:"context-menu"})}},b.id))}),(0,bS.jsx)(De,{id:"new-page",children:(0,bS.jsx)(Dd,{actionId:"move-to-new-page"})})]})}function JT(){let a=jA();return d8("oneEmbedSelected",()=>{let b=a.getOnlySelectedShape();return!!b&&!!(a.isShapeOfType(b,"embed")&&b.props.url&&!a.isShapeOrAncestorLocked(b))},[a])?(0,bS.jsx)(Dd,{actionId:"convert-to-bookmark"}):null}function JU(){let a=jA(),b=AW();return d8("oneEmbeddableBookmarkSelected",()=>{let c=a.getOnlySelectedShape();return!!c&&!!(a.isShapeOfType(c,"bookmark")&&c.props.url&&b(c.props.url)&&!a.isShapeOrAncestorLocked(c))},[a])?(0,bS.jsx)(Dd,{actionId:"convert-to-embed"}):null}function JV(){let a=jA(),b=d8("isSnapMode",()=>a.user.getIsSnapMode(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-snap-mode",checked:b})}function JW(){let a=jA(),b=d8("isToolLock",()=>a.getInstanceState().isToolLocked,[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-tool-lock",checked:b})}function JX(){let a=jA(),b=d8("isGridMode",()=>a.getInstanceState().isGridMode,[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-grid",checked:b})}function JY(){let a=jA(),b=d8("isWrapMode",()=>a.user.getIsWrapMode(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-wrap-mode",checked:b})}function JZ(){let a=jA(),b=d8("isFocusMode",()=>a.getInstanceState().isFocusMode,[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-focus-mode",checked:b})}function J$(){let a=jA(),b=d8("edgeScrollSpeed",()=>a.user.getEdgeScrollSpeed(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-edge-scrolling",checked:1===b})}function J_(){let a=jA(),b=d8("inputMode",()=>"mouse"===a.user.getUserPreferences().inputMode,[a]),c=d8("isZoomDirectionInverted",()=>a.user.getIsZoomDirectionInverted(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-invert-zoom",checked:c,disabled:!b})}function J0(){let a=jA(),b=d8("animationSpeed",()=>a.user.getAnimationSpeed(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-reduce-motion",checked:0===b})}function J1(){let a=jA(),b=d8("keyboardShortcuts",()=>a.user.getAreKeyboardShortcutsEnabled(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-keyboard-shortcuts",checked:b})}function J2(){let a=jA(),b=d8("enhancedA11yMode",()=>a.user.getEnhancedA11yMode(),[a]);return(0,bS.jsx)(Jp,{actionId:"enhanced-a11y-mode",checked:b})}function J3(){let a=jA(),b=d8("isDebugMode",()=>a.getInstanceState().isDebugMode,[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-debug-mode",checked:b})}function J4(){let a=jA(),b=d8("dynamic resize",()=>a.user.getIsDynamicResizeMode(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-dynamic-size-mode",checked:b})}function J5(){let a=jA(),b=d8("paste at cursor",()=>a.user.getIsPasteAtCursorMode(),[a]);return(0,bS.jsx)(Jp,{actionId:"toggle-paste-at-cursor",checked:b})}function J6(){let a=jA();return d8("show cursor chat",()=>"select"===a.getCurrentToolId()&&!a.getInstanceState().isCoarsePointer,[a])?(0,bS.jsx)(Dd,{actionId:"open-cursor-chat"}):null}function J7(){return(0,bS.jsx)(FS,{id:"help menu accessibility",label:"menu.accessibility",children:(0,bS.jsxs)(De,{id:"accessibility",children:[(0,bS.jsx)(J0,{}),(0,bS.jsx)(J1,{}),(0,bS.jsx)(J2,{})]})})}function J8(a,b){let c,d,e,f=a.getShape(b);if(!f)return;let{start:g,end:h}=Fd(a,f),i=g?a.getShape(g.toId):void 0,j=h?a.getShape(h.toId):void 0,k=a.getAncestorPageId(f);if(!k)return;if(i&&j)c=a.findCommonAncestor([i,j])??k;else{if(!i&&!j)return;let a=(i||j)?.parentId;c=a&&a===f.parentId?f.parentId:k}c&&c!==f.parentId&&a.reparentShapes([b],c);let l=a.getShape(b);if(!l)throw Error("no reparented arrow");let m=a.getShapeNearestSibling(l,i),n=a.getShapeNearestSibling(l,j);if(m&&n)d=m.index>n.index?m:n;else if(m&&!n)d=m;else{if(!n||m)return;d=n}let o=a.getSortedChildIdsForParent(d.parentId).map(b=>a.getShape(b)).filter(a=>a.index>d.index);if(o.length){let a=o.find(a=>"arrow"!==a.type);if(l.index>d.index&&(!a||l.index<a.index))return;e=c3(d.index,o[0].index)}else e=c4(d.index);e!==l.index&&a.updateShapes([{id:b,type:"arrow",index:e}])}function J9(a,b){let c=Fd(a,b);for(let d of["start","end"]){let e=c[d];if(!e)continue;let f=a.getShape(e.toId),g=a.getAncestorPageId(b)===a.getAncestorPageId(f);f&&g||Ka({editor:a,arrow:b,terminal:d,unbind:!0})}J8(a,b.id)}function Ka({editor:a,arrow:b,terminal:c,unbind:d=!1,useHandle:e=!1}){let f=Ff(a,b);if(!f)throw Error("expected arrow info");let g=e?f.start.handle:f.start.point,h=e?f.end.handle:f.end.point,i="start"===c?g:h,j={id:b.id,type:"arrow",props:{[c]:{x:i.x,y:i.y},bend:b.props.bend}};if("arc"===f.type){let a="start"===c?g:f.start.handle,d="end"===c?h:f.end.handle,e=iK.Med(a,d),i=iK.Sub(a,d).per().uni().mul(2*f.handleArc.radius*Math.sign(b.props.bend)),k=kw(f.handleArc.center,iK.Add(e,i),f.handleArc.center,f.handleArc.radius);cd(k?.length===1);let l=iK.Dist(e,k[0])*Math.sign(b.props.bend);iU(l,j.props.bend)||(j.props.bend=l)}a.updateShape(j),d&&Fi(a,b,c)}function Kb({size:a,width:b,height:c,hideAlternateHandles:d}){let e=i5(a/3),f=e/2,g=Am();return(0,bS.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,bS.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${i5(0-f)},${i5(a)} 
						${i5(0-f)},${i5(0-f)} 
						${i5(a)},${i5(0-f)}`,strokeWidth:e,"data-testid":"selection.crop.top_left",role:"button","aria-label":g("handle.crop.top-left")}),(0,bS.jsx)("line",{className:(0,jb.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:i5(b/2-a),y1:i5(0-f),x2:i5(b/2+a),y2:i5(0-f),strokeWidth:e,"data-testid":"selection.crop.top",role:"button","aria-label":g("handle.crop.top")}),(0,bS.jsx)("polyline",{className:(0,jb.default)("tl-corner-crop-handle",{"tl-hidden":d}),points:`
						${i5(b-a)},${i5(0-f)} 
						${i5(b+f)},${i5(0-f)} 
						${i5(b+f)},${i5(a)}`,strokeWidth:e,"data-testid":"selection.crop.top_right",role:"button","aria-label":g("handle.crop.top-right")}),(0,bS.jsx)("line",{className:(0,jb.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:i5(b+f),y1:i5(c/2-a),x2:i5(b+f),y2:i5(c/2+a),strokeWidth:e,"data-testid":"selection.crop.right",role:"button","aria-label":g("handle.crop.right")}),(0,bS.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${i5(b+f)},${i5(c-a)} 
						${i5(b+f)},${i5(c+f)}
						${i5(b-a)},${i5(c+f)}`,strokeWidth:e,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":g("handle.crop.bottom-right")}),(0,bS.jsx)("line",{className:(0,jb.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:i5(b/2-a),y1:i5(c+f),x2:i5(b/2+a),y2:i5(c+f),strokeWidth:e,"data-testid":"selection.crop.bottom",role:"button","aria-label":g("handle.crop.bottom")}),(0,bS.jsx)("polyline",{className:(0,jb.default)("tl-corner-crop-handle",{"tl-hidden":d}),points:`
						${i5(0+a)},${i5(c+f)} 
						${i5(0-f)},${i5(c+f)}
						${i5(0-f)},${i5(c-a)}`,strokeWidth:e,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":g("handle.crop.bottom-left")}),(0,bS.jsx)("line",{className:(0,jb.default)("tl-corner-crop-edge-handle",{"tl-hidden":d}),x1:i5(0-f),y1:i5(c/2-a),x2:i5(0-f),y2:i5(c/2+a),strokeWidth:e,"data-testid":"selection.crop.left",role:"button","aria-label":g("handle.crop.left")})]})}function Kc({children:a}){let b=jA();return d8("shouldDisplayHandles",()=>{if(b.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(b.isInAny("select.editing_shape")){let a=b.getOnlySelectedShape();return a&&b.isShapeOfType(a,"note")}return!1},[b])?(0,bS.jsx)("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:a}):null}let Kd=new ci;function Ke(a){return Kd.get(a,()=>d$("arrowTarget",null))}function Kf(a){Ke(a).set(null)}function Kg({editor:a,pointInPageSpace:b,arrow:c,isPrecise:d,currentBinding:e,oppositeBinding:f}){var g,h,i,j;let k=a.getShapeUtil("arrow");if(k.options.shouldIgnoreTargets(a))return Ke(a).set(null),null;let l=c?c.props.kind:a.getStyleForNextShape(gA),m=a.getShapeAtPoint(b,{hitInside:!0,hitFrameInside:!0,margin:"elbow"===l?8:[8,0],filter:b=>!b.isLocked&&a.canBindShapes({fromShape:c??Kh,toShape:b,binding:"arrow"})});if(!m)return Ke(a).set(null),null;let n=a.getShapeGeometry(m),o=kt.ZeroFix(n.bounds),p=n.center,q=a.getShapePageTransform(m),r=a.getPointInShapeSpace(m,b),s=Math.max(n.bounds.width,n.bounds.height),t=cL(ED,(a,b)=>{let c=EG[EE[a]],d=iK.Mul(b,s).add(p),e=!1,f=c.v(o[a],o[c.crossMid]),g=0;for(let a of n.intersectLineSegment(p,d,kE)){let b=iK.Dist2(a,p);b>g&&(g=b,f=a,e=n.isClosed)}return{point:q.applyToPoint(f),isEnabled:e,far:q.applyToPoint(d)}}),u=a.getZoomLevel(),v=k.options.minElbowHandleDistance/u,w=q.applyToPoint(p);for(let a of cG(t)){let b=t[a];iK.DistMin(b.point,w,v)&&(b.isEnabled=!1)}let y=d;y||e&&(!e||m.id===e.toId)||(y=.5>a.inputs.getPointerVelocity().len()),!d&&(n.isClosed||(y=!0),f&&m.id===f.toId&&f.props.isPrecise&&(y=!0));let z=k.options.shouldBeExact(a,y);z&&(y=!0);let A=!z&&y&&n.isClosed,B=!z&&(y&&"elbow"===l||!n.isClosed),C=!z&&y&&"elbow"===l&&n.isClosed,D=y&&(n.isClosed||z),E=!z&&y&&"elbow"===l&&n.isClosed,F="none",G=b;if(D||(F="center",G=w),B){let c=D?Ki(a,o,k.options.elbowArrowEdgeSnapDistance):1/0,d=n.nearestPoint(r,{includeLabels:!1,includeInternal:!1}),e=q.applyToPoint(d);iK.Dist(e,b)<c&&(F="edge",G=e)}if(E){let c=Ki(a,o,k.options.elbowArrowAxisSnapDistance),d=iK.DistanceToLineSegment(t.left.far,t.right.far,b),e=iK.DistanceToLineSegment(t.top.far,t.bottom.far,b),f=d<e&&d<c?"x":e<c?"y":null;if(f){let a=EG[f],c=iK.Dist2(t[a.loEdge].far,b)<iK.Dist2(t[a.hiEdge].far,b)?a.loEdge:a.hiEdge;t[c].isEnabled&&(F="edge-point",G=t[c].point)}}if(C){let c=Ki(a,o,k.options.elbowArrowPointSnapDistance),d=null,e=1/0;for(let[a,f]of cI(t)){if(!f.isEnabled)continue;let g=iK.Dist(f.point,b);g<c&&g<e&&(e=g,d=a)}d&&(F="edge-point",G=t[d].point)}if(A){let b=Ki(a,o,"elbow"===l?k.options.elbowArrowCenterSnapDistance:k.options.arcArrowCenterSnapDistance);iK.Dist(r,o.center)<b&&(F="center",G=w)}let H=a.getPointInShapeSpace(m,G),I={target:m,arrowKind:l,handlesInPageSpace:t,centerInPageSpace:w,anchorInPageSpace:G,isExact:z,isPrecise:y,snap:F,normalizedAnchor:{x:(g=o.minX,h=o.maxX,(H.x-g)/(h-g)),y:(i=o.minY,j=o.maxY,(H.y-i)/(j-i))}};return Ke(a).set(I),I}let Kh={type:"arrow"};function Ki(a,b,c){return iS(.15*Math.min(b.width,b.height),4,c)/a.getZoomLevel()}function Kj(){let a=jA();return d8("should show arrow hints",()=>{if(a.isInAny("arrow.idle","arrow.pointing"))return!0;if(a.isIn("select.pointing_handle")){let b=a.getStateDescendant("select.pointing_handle");if("arrow"===b.info.shape.type&&("start"===b.info.handle.id||"end"===b.info.handle.id))return!0}if(a.isIn("select.dragging_handle")){let b=a.getStateDescendant("select.dragging_handle");if("arrow"===b.info.shape.type&&("start"===b.info.handle.id||"end"===b.info.handle.id))return!0}return!1},[a])?(0,bS.jsx)(Kk,{}):null}function Kk(){let a=jA(),{ShapeIndicator:b}=q_(),c=d8("arrow target info",()=>Ke(a).get(),[a]);if(!c)return null;let{handlesInPageSpace:d,snap:e,anchorInPageSpace:f,arrowKind:g,isExact:h,isPrecise:i}=c;return(0,bS.jsxs)(bS.Fragment,{children:[b&&(0,bS.jsx)(b,{shapeId:c.target.id}),!h&&"elbow"===g&&(0,bS.jsxs)("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[(0,bS.jsx)("circle",{cx:f.x,cy:f.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${i?e??"none":"none"}`}),Object.entries(d).map(([a,b])=>b.isEnabled?(0,bS.jsx)("circle",{cx:b.point.x,cy:b.point.y,className:"tl-arrow-hint-handle"},a):null)]})]})}let{PI:Kl}=Math,Km=Kl+1e-4;function Kn(a,b={}){let c,{size:d=16,smoothing:e=.5}=b;if(0===a.length||d<=0)return{left:[],right:[]};let f=a[0],g=a[a.length-1],h=g.runningLength,i=Math.pow(d*e,2),j=[],k=[],l=a[0].vector,m=a[0].point,n=m,o=m,p=n,q=!1;for(let b=0;b<a.length;b++){c=a[b];let{point:d,vector:e}=a[b],r=c.vector.dpr(l),s=(b<a.length-1?a[b+1]:a[b]).vector,t=b<a.length-1?s.dpr(c.vector):1,u=null!==t&&t<.2;if(r<0&&!q||u){if(t>-.62&&h-c.runningLength>c.radius){let a=l.clone().mul(c.radius);0>l.clone().cpr(s)?(o=iK.Add(d,a),p=iK.Sub(d,a)):(o=iK.Sub(d,a),p=iK.Add(d,a)),j.push(o),k.push(p)}else{let a=l.clone().mul(c.radius).per(),b=iK.Sub(c.input,a);for(let a=1/13,d=0;d<1;d+=a)o=iK.RotWith(b,c.input,Km*d),j.push(o),p=iK.RotWith(b,c.input,Km+-(Km*d)),k.push(p)}m=o,n=p,u&&(q=!0);continue}if(q=!1,c===f||c===g){let a=iK.Per(e).mul(c.radius);j.push(iK.Sub(d,a)),k.push(iK.Add(d,a));continue}let v=iK.Lrp(s,e,t).per().mul(c.radius);o=iK.Sub(d,v),(b<=1||iK.Dist2(m,o)>i)&&(j.push(o),m=o),p=iK.Add(d,v),(b<=1||iK.Dist2(n,p)>i)&&(k.push(p),n=p),l=e}return{left:j,right:k}}function Ko(a,b={}){let{size:c=16,start:d={},end:e={},last:f=!1}=b,{cap:g=!0}=d,{cap:h=!0}=e;if(0===a.length||c<=0)return[];let i=a[0],j=a[a.length-1],k=j.runningLength,l=!1===d.taper?0:!0===d.taper?Math.max(c,k):d.taper,m=!1===e.taper?0:!0===e.taper?Math.max(c,k):e.taper,{left:n,right:o}=Kn(a,b),p=i.point,q=a.length>1?a[a.length-1].point:iK.AddXY(i.point,1,1);if(1===a.length&&(!(l||m)||f)){let a=iK.Add(p,iK.Sub(p,q).uni().per().mul(-i.radius)),b=[];for(let c=1/13,d=c;d<=1;d+=c)b.push(iK.RotWith(a,p,2*Km*d));return b}let r=[];if(l||m&&1===a.length);else if(g)for(let a=1/8,b=a;b<=1;b+=a){let a=iK.RotWith(o[0],p,Km*b);r.push(a)}else{let a=iK.Sub(n[0],o[0]),b=iK.Mul(a,.5),c=iK.Mul(a,.51);r.push(iK.Sub(p,b),iK.Sub(p,c),iK.Add(p,c),iK.Add(p,b))}let s=[],t=j.vector.clone().per().neg();if(m||l&&1===a.length)s.push(q);else if(h){let a=iK.Add(q,iK.Mul(t,j.radius));for(let b=1/29,c=b;c<1;c+=b)s.push(iK.RotWith(a,q,3*Km*c))}else s.push(iK.Add(q,iK.Mul(t,j.radius)),iK.Add(q,iK.Mul(t,.99*j.radius)),iK.Sub(q,iK.Mul(t,.99*j.radius)),iK.Sub(q,iK.Mul(t,j.radius)));return n.concat(s,o.reverse(),r)}function Kp(a,b={}){let c,d,{streamline:e=.5,size:f=16,simulatePressure:g=!1}=b;if(0===a.length)return[];let h=.15+(1-e)*.85,i=a.map(iK.From),j=0;if(!g){let a=i[0];for(;a&&!(a.z>=.025);)i.shift(),a=i[0]}if(!g){let a=i[i.length-1];for(;a&&!(a.z>=.01);)i.pop(),a=i[i.length-1]}if(0===i.length)return[{point:iK.From(a[0]),input:iK.From(a[0]),pressure:g?.5:.15,vector:new iK(1,1),distance:0,runningLength:0,radius:1}];let k=i[1];for(;k&&!(iK.Dist2(k,i[0])>(f/3)**2);)i[0].z=Math.max(i[0].z,k.z),i.splice(1,1),k=i[1];let l=i.pop();for(k=i[i.length-1];k&&!(iK.Dist2(k,l)>(f/3)**2);)i.pop(),k=i[i.length-1],j++;i.push(l);let m=b.last||!b.simulatePressure||i.length>1&&iK.Dist2(i[i.length-1],i[i.length-2])<f**2||j>0;if(2===i.length&&b.simulatePressure){let a=i[1];i=i.slice(0,-1);for(let b=1;b<5;b++){let c=iK.Lrp(i[0],a,b/4);c.z=(i[0].z+(a.z-i[0].z))*b/4,i.push(c)}}let n=[{point:i[0],input:i[0],pressure:g?.5:i[0].z,vector:new iK(1,1),distance:0,runningLength:0,radius:1}],o=0,p=n[0];m&&e>0&&i.push(i[i.length-1].clone());for(let a=1,e=i.length;a<e;a++)c=!h||b.last&&a===e-1?i[a].clone():i[a].clone().lrp(p.point,1-h),!p.point.equals(c)&&(o+=d=iK.Dist(c,p.point),a<4&&o<f||(p={input:i[a],point:c,pressure:g?.5:i[a].z,vector:iK.Sub(p.point,c).uni(),distance:d,runningLength:o,radius:1},n.push(p)));if(n[1]?.vector&&(n[0].vector=n[1].vector.clone()),o<1){let a=Math.max(.5,...n.map(a=>a.pressure));n.forEach(b=>b.pressure=a)}return n}let{min:Kq}=Math;function Kr(a,b){let c,d,{size:e=16,thinning:f=.5,simulatePressure:g=!0,easing:h=a=>a,start:i={},end:j={}}=b,{easing:k=iF}=i,{easing:l=iG}=j,m=a[a.length-1].runningLength,n=a[0].pressure;if(!g&&m<e){let b=a.reduce((a,b)=>Math.max(a,b.pressure),.5);return a.forEach(a=>{a.pressure=b,a.radius=e*h(.5-f*(.5-a.pressure))}),a}{let b;for(let c=0,f=a.length;c<f&&!((d=a[c]).runningLength>5*e);c++){let a=Kq(1,d.distance/e);if(g){let c=Kq(1,1-a);b=Kq(1,n+.275*a*(c-n))}else b=Kq(1,n+(d.pressure-n)*.5);n+=(b-n)*.5}for(let b=0;b<a.length;b++){if(d=a[b],f){let{pressure:a}=d,b=Kq(1,d.distance/e);if(g){let c=Kq(1,1-b);a=Kq(1,n+.275*b*(c-n))}else a=Kq(1,n+.275*b*(a-n));d.radius=e*h(.5-f*(.5-a)),n=a}else d.radius=e/2;void 0===c&&(c=d.radius)}}let o=!1===i.taper?0:!0===i.taper?Math.max(e,m):i.taper,p=!1===j.taper?0:!0===j.taper?Math.max(e,m):j.taper;if(o||p)for(let b=0;b<a.length;b++){let{runningLength:c}=d=a[b],e=c<o?k(c/o):1,f=m-c<p?l((m-c)/p):1;d.radius=Math.max(.01,d.radius*Math.min(e,f))}return a}function Ks({scribble:a,zoom:b,color:c,opacity:d,className:e}){let f;if(!a.points.length)return null;let g=function(a,b={}){return Ko(Kr(Kp(a,b),b),b)}(a.points,{size:a.size/b,start:{taper:a.taper,easing:iD},last:"complete"===a.state||"stopping"===a.state,simulatePressure:!1,streamline:.32});if(g.length<4){let c=a.size/b/2,{x:d,y:e}=a.points[a.points.length-1];f=`M ${d-c},${e} a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 ${-(2*c)},0`}else f=qK(g);return(0,bS.jsx)("svg",{className:e?(0,jb.default)("tl-overlays__item",e):e,children:(0,bS.jsx)("path",{className:"tl-scribble",d:f,fill:c??`var(--tl-color-${a.color})`,opacity:d??a.opacity})})}let Kt=d3(function({bounds:a,rotation:b}){let c=jA(),d=Am(),e=(0,bT.useRef)(null),f=BE(),g=sv("top"),h=sv("right"),i=sv("bottom"),j=sv("left"),k=sv("top_left"),l=sv("top_right"),m=sv("bottom_right"),n=sv("bottom_left"),o="default"===c.getInstanceState().cursor.type,p=c.getInstanceState().isCoarsePointer,q=c.getOnlySelectedShape(),r=q&&c.isShapeOrAncestorLocked(q),s=q?c.getShapeUtil(q).expandSelectionOutlinePx(q):0,t=s instanceof kt?a.clone().expand(s).zeroFix():a.clone().expandBy(s).zeroFix(),u=c.getSelectionRotation(),v=u/iP>1.6&&u/iP<2.4;if(iC(e,a?.x,a?.y,1,u,{x:t.x-a.x,y:t.y-a.y}),q&&c.isShapeHidden(q))return null;let w=c.getEfficientZoomLevel(),y=c.getInstanceState().isChangingStyle,z=t.width,A=t.height,B=8/w,C=z<2*B,D=A<2*B,E=z<4*B,F=A<4*B,G=z<5*B,H=A<5*B,I=p?1.75:1,J=6/w*I,K=.75*I*(E?J/2:J),L=.75*I*(F?J/2:J),M=(!q||!c.getShapeUtil(q).hideSelectionBoundsFg(q))&&!y,N=M&&c.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||M&&c.isIn("select.resizing")&&q&&c.isShapeOfType(q,"text");q;let O=c.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!y&&!f,P=c.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!y&&!f,Q=!p&&!(C||D)&&(P||O)&&(!q||!c.getShapeUtil(q).hideRotateHandle(q))&&!r,R=p&&(!E||!F)&&(P||O)&&(!q||!c.getShapeUtil(q).hideRotateHandle(q))&&!r,S=P&&(!q||c.getShapeUtil(q).canResize(q)&&!c.getShapeUtil(q).hideResizeHandles(q))&&!O&&!r,T=C||D,U=C&&D,V=G||H,W=S||O,X=!Q,Y=!P||!R,Z=!P||!W,$=!P||!W||T,_=!P||!W||T,aa=!P||!W||U&&!O,ab=!0,ac=!0;if(O)ab=V,ac=V;else if(S){ab=T||U||p;let a=p&&q&&"text"===q.type;ac=ab&&!a}let ad=Math.min(24/w,A-3*L),ae=P&&p&&q&&c.isShapeOfType(q,"text")&&ad*w>=4,af=q&&(c.isShapeOfType(q,"image")||c.isShapeOfType(q,"video"));return(0,bS.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:(0,bS.jsxs)("g",{ref:e,children:[N&&(0,bS.jsx)("rect",{className:"tl-selection__fg__outline",width:i5(z),height:i5(A)}),(0,bS.jsx)(Kv,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:J,corner:"top_left_rotate",cursor:o?pJ("nwse-rotate",b):void 0,isHidden:X}),(0,bS.jsx)(Kv,{"data-testid":"selection.rotate.top-right",cx:z+3*J,cy:0,targetSize:J,corner:"top_right_rotate",cursor:o?pJ("nesw-rotate",b):void 0,isHidden:X}),(0,bS.jsx)(Kv,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:A+3*J,targetSize:J,corner:"bottom_left_rotate",cursor:o?pJ("swne-rotate",b):void 0,isHidden:X}),(0,bS.jsx)(Kv,{"data-testid":"selection.rotate.bottom-right",cx:z+3*J,cy:A+3*J,targetSize:J,corner:"bottom_right_rotate",cursor:o?pJ("senw-rotate",b):void 0,isHidden:X}),(0,bS.jsx)(Kx,{"data-testid":"selection.rotate.mobile",cx:E?-(1.5*J):z/2,cy:E?A/2:af&&!v?A+1.5*J:-(1.5*J),size:B,isHidden:Y}),(0,bS.jsx)(Ku,{hide:ab,dataTestId:"selection.resize.top",ariaLabel:d("handle.resize-top"),x:0,y:i5(0-(F?2*L:L)),width:i5(z),height:i5(Math.max(1,2*L)),cursor:o?pJ("ns-resize",b):void 0,events:g}),(0,bS.jsx)(Ku,{hide:ac,dataTestId:"selection.resize.right",ariaLabel:d("handle.resize-right"),x:i5(z-(E?0:K)),y:0,height:i5(A),width:i5(Math.max(1,2*K)),cursor:o?pJ("ew-resize",b):void 0,events:h}),(0,bS.jsx)(Ku,{hide:ab,dataTestId:"selection.resize.bottom",ariaLabel:d("handle.resize-bottom"),x:0,y:i5(A-(F?0:L)),width:i5(z),height:i5(Math.max(1,2*L)),cursor:o?pJ("ns-resize",b):void 0,events:i}),(0,bS.jsx)(Ku,{hide:ac,dataTestId:"selection.resize.left",ariaLabel:d("handle.resize-left"),x:i5(0-(E?2*K:K)),y:0,height:i5(A),width:i5(Math.max(1,2*K)),cursor:o?pJ("ew-resize",b):void 0,events:j}),(0,bS.jsx)(Ku,{hide:Z,dataTestId:"selection.target.top-left",ariaLabel:d("handle.resize-top-left"),x:i5(0-(E?2*K:1.5*K)),y:i5(0-(F?2*L:1.5*L)),width:i5(3*K),height:i5(3*L),cursor:o?pJ("nwse-resize",b):void 0,events:k}),(0,bS.jsx)(Ku,{hide:$,dataTestId:"selection.target.top-right",ariaLabel:d("handle.resize-top-right"),x:i5(z-(E?0:1.5*K)),y:i5(0-(F?2*L:1.5*L)),width:i5(3*K),height:i5(3*L),cursor:o?pJ("nesw-resize",b):void 0,events:l}),(0,bS.jsx)(Ku,{hide:aa,dataTestId:"selection.target.bottom-right",ariaLabel:d("handle.resize-bottom-right"),x:i5(z-(E?K:1.5*K)),y:i5(A-(F?L:1.5*L)),width:i5(3*K),height:i5(3*L),cursor:o?pJ("nwse-resize",b):void 0,events:m}),(0,bS.jsx)(Ku,{hide:_,dataTestId:"selection.target.bottom-left",ariaLabel:d("handle.resize-bottom-left"),x:i5(0-(E?3*K:1.5*K)),y:i5(A-(F?0:1.5*L)),width:i5(3*K),height:i5(3*L),cursor:o?pJ("nesw-resize",b):void 0,events:n}),S&&(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("rect",{"data-testid":"selection.resize.top-left",className:(0,jb.default)("tl-corner-handle",{"tl-hidden":Z}),x:i5(0-B/2),y:i5(0-B/2),width:i5(B),height:i5(B)}),(0,bS.jsx)("rect",{"data-testid":"selection.resize.top-right",className:(0,jb.default)("tl-corner-handle",{"tl-hidden":$}),x:i5(z-B/2),y:i5(0-B/2),width:i5(B),height:i5(B)}),(0,bS.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:(0,jb.default)("tl-corner-handle",{"tl-hidden":aa}),x:i5(z-B/2),y:i5(A-B/2),width:i5(B),height:i5(B)}),(0,bS.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:(0,jb.default)("tl-corner-handle",{"tl-hidden":_}),x:i5(0-B/2),y:i5(A-B/2),width:i5(B),height:i5(B)})]}),ae&&(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:i5(0-B/4),y:i5(A/2-ad/2),rx:B/4,width:i5(B/2),height:i5(ad)}),(0,bS.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:B/4,x:i5(z-B/4),y:i5(A/2-ad/2),width:i5(B/2),height:i5(ad)})]}),O&&(0,bS.jsx)(Kb,{size:B,width:z,height:A,hideAlternateHandles:V})]})})}),Ku=function({hide:a,dataTestId:b,ariaLabel:c,x:d,y:e,width:f,height:g,cursor:h,events:i}){return(0,bS.jsx)("rect",{className:(0,jb.default)("tl-resize-handle","tl-transparent",{"tl-hidden":a}),"data-testid":b,role:"button","aria-label":c,pointerEvents:"all",x:d,y:e,width:f,height:g,cursor:h,...i})},Kv=function({cx:a,cy:b,targetSize:c,corner:d,cursor:e,isHidden:f,"data-testid":g}){let h=sv(d),i=Am()(`handle.rotate.${d}`);return(0,bS.jsx)("rect",{className:(0,jb.default)("tl-transparent","tl-rotate-corner",{"tl-hidden":f}),"data-testid":g,role:"button","aria-label":i,pointerEvents:"all",x:i5(a-3*c),y:i5(b-3*c),width:i5(Math.max(1,3*c)),height:i5(Math.max(1,3*c)),cursor:e,...h})},Kw=Math.sqrt(Math.PI),Kx=function({cx:a,cy:b,size:c,isHidden:d,"data-testid":e}){let f=sv("mobile_rotate"),g=jA(),h=d8("zoom level",()=>g.getEfficientZoomLevel(),[g]),i=Math.max(1/h*14,20/Math.max(1,h)),j=Am();return(0,bS.jsxs)("g",{role:"button","aria-label":j("handle.rotate.mobile_rotate"),children:[(0,bS.jsx)("circle",{"data-testid":e,pointerEvents:"all",className:(0,jb.default)("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":d}),cx:a,cy:b,r:i,...f}),(0,bS.jsx)("circle",{className:(0,jb.default)("tl-mobile-rotate__fg",{"tl-hidden":d}),cx:a,cy:b,r:c/Kw})]})};function Ky(){let a=jA(),b=d8("is in a valid select state",()=>a.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[a]);return(0,bS.jsx)(qS,{hideAll:!b})}let Kz=[class extends sm{static type="arrow";static props=gJ;static migrations=gL;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:a}){let b=this.editor.getShape(a.fromId);b&&J9(this.editor,b)}onAfterChange({bindingAfter:a}){let b=this.editor.getShape(a.fromId);b&&J9(this.editor,b)}onAfterChangeFromShape({shapeBefore:a,shapeAfter:b,reason:c}){("ancestry"===c||a.parentId!==b.parentId||a.index!==b.index)&&J9(this.editor,b)}onAfterChangeToShape({binding:a,shapeBefore:b,shapeAfter:c,reason:d}){("ancestry"===d||b.parentId!==c.parentId||b.index!==c.index)&&J8(this.editor,a.fromId)}onBeforeIsolateFromShape({binding:a}){let b=this.editor.getShape(a.fromId);b&&Ka({editor:this.editor,arrow:b,terminal:a.props.terminal})}}],KA={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},KB={s:2,m:3.5,l:5,xl:10},KC={s:18,m:24,l:36,xl:44},KD={s:18,m:22,l:26,xl:32},KE={s:18,m:20,l:24,xl:28},KF={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};async function KG(a,b,c){let{elements:d,files:e}=b,f={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:a.store.schema.serialize()},g=new Map,h=new Map,i=a.getCurrentPageId(),j=new Map,k=[],l=new Set;d.forEach(a=>{if(j.set(a.id,gi()),null!==a.boundElements)for(let b of a.boundElements)"text"===b.type&&l.add(b.id)});let m="a0";for(let b of d){if(l.has(b.id))continue;let c=j.get(b.id),n={id:c,typeName:"shape",parentId:i,index:m,x:b.x,y:b.y,rotation:0,isLocked:b.locked,opacity:KH(b.opacity),meta:{}};switch(0!==b.angle&&h.set(c,b.angle),b.groupIds&&b.groupIds.length>0?g.has(b.groupIds[0])?g.get(b.groupIds[0])?.push(c):g.set(b.groupIds[0],[c]):k.push(c),b.type){case"rectangle":case"ellipse":case"diamond":{let c="",e="middle";if(null!==b.boundElements){for(let a of b.boundElements)if("text"===a.type){let b=d.find(b=>b.id===a.id);b&&(c=b.text,e=KQ[b.textAlign])}}let g="transparent"===b.backgroundColor?b.strokeColor:b.backgroundColor;f.shapes.push({...n,type:"geo",props:{...a.getShapeUtil("geo").getDefaultProps(),geo:b.type,url:b.link??"",w:b.width,h:b.height,size:KI[b.strokeWidth]??"draw",color:KN[g]??"black",richText:gb(c),align:e,dash:KT(b),fill:KU(b)}});break}case"freedraw":{let c=b.points.map(([a,b,c=.5])=>({x:a,y:b,z:c})),d=hM.encodePoints(c);f.shapes.push({...n,type:"draw",props:{...a.getShapeUtil("draw").getDefaultProps(),dash:KT(b),size:KI[b.strokeWidth],color:KN[b.strokeColor]??"black",segments:[{type:"free",path:d}]}});break}case"line":{if(b.points.slice().length<2)break;let c=c5(b.points.length);f.shapes.push({...n,type:"line",props:{...a.getShapeUtil("line").getDefaultProps(),dash:KT(b),size:KI[b.strokeWidth],color:KN[b.strokeColor]??"black",spline:b.roundness?"cubic":"line",points:{...Object.fromEntries(b.points.map(([a,b],d)=>{let e=c[d];return[e,{id:e,index:e,x:a,y:b}]}))}}});break}case"arrow":{let e="";if(null!==b.boundElements){for(let a of b.boundElements)if("text"===a.type){let b=d.find(b=>b.id===a.id);b&&(e=b.text)}}let g=b.points[0],h=b.points[b.points.length-1],i=j.get(b.startBinding?.elementId),k=j.get(b.endBinding?.elementId);f.shapes.push({...n,type:"arrow",props:{...a.getShapeUtil("arrow").getDefaultProps(),richText:gb(e),kind:b.elbowed?"elbow":"arc",bend:function(a,b,c){let d=0;if(a.points.length>2){let e=new iK(b[0],b[1]),f=new iK(c[0],c[1]),g=new iK(a.points[1][0],a.points[1][1]),h=iK.Sub(f,e),i=iK.Per(h),j=iK.Med(f,e),k=iK.Sub(j,i),l=iK.Add(j,i),m=iK.NearestPointOnLineSegment(k,l,g,!1);d=iK.Dist(m,j),iK.Clockwise(m,f,j)&&(d*=-1)}return d}(b,g,h),dash:KT(b),size:KI[b.strokeWidth]??"m",color:KN[b.strokeColor]??"black",start:{x:g[0],y:g[1]},end:{x:h[0],y:h[1]},arrowheadEnd:KS[b.endArrowhead]??"none",arrowheadStart:KS[b.startArrowhead]??"none"}}),i&&f.bindings.push({id:f9(),typeName:"binding",type:"arrow",fromId:c,toId:i,props:{terminal:"start",snap:"none",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),k&&f.bindings.push({id:f9(),typeName:"binding",type:"arrow",fromId:c,toId:k,props:{terminal:"end",snap:"none",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{let{size:c,scale:d}=function(a){let b=KJ[a];return b?{size:b,scale:1}:a<16?{size:"s",scale:a/16}:a>36?{size:"xl",scale:a/36}:{size:"m",scale:1}}(b.fontSize);f.shapes.push({...n,type:"text",props:{...a.getShapeUtil("text").getDefaultProps(),size:c,scale:d,font:KK[b.fontFamily]??"draw",color:KN[b.strokeColor]??"black",richText:gb(b.text),textAlign:KR[b.textAlign]}});break}case"image":{let c=e[b.fileId];if(!c)break;let d=hz.createId();f.assets.push({id:d,typeName:"asset",type:"image",props:{w:b.width,h:b.height,fileSize:c.size,name:b.id??"Untitled",isAnimated:!1,mimeType:c.mimeType,src:c.dataURL},meta:{}}),f.shapes.push({...n,type:"image",props:{...a.getShapeUtil("image").getDefaultProps(),w:b.width,h:b.height,assetId:d}})}}m=c4(m)}let n=c??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():void 0);for(let b of(a.putContentOntoCurrentPage(f,{point:n,select:!1,preserveIds:!0}),g.values()))if(b.length>1){a.groupShapes(b);let c=a.getShape(b[0]);c?.parentId&&gh(c.parentId)&&k.push(c.parentId)}for(let[b,c]of h)a.select(b),a.rotateShapesBy([b],c);let o=b4(k.map(b=>a.getShape(b))),p=kt.Common(o.map(b=>a.getShapePageBounds(b))),q=a.getViewportPageBounds().center;a.updateShapes(o.map(a=>{let b={x:(a.x??0)-(p.x+p.w/2),y:(a.y??0)-(p.y+p.h/2)};return{id:a.id,type:a.type,x:q.x+b.x,y:q.y+b.y}})),a.setSelectedShapes(k)}let KH=a=>{let b=a/100;return b<.2?.1:b<.4?.25:b<.6?.5:b<.8?.75:1},KI={1:"s",2:"m",3:"l",4:"xl"},KJ={16:"s",20:"m",28:"l",36:"xl"},KK={1:"draw",2:"sans",3:"mono"},KL={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function KM(a,b,c){return Object.fromEntries([0,1,2,3,4].map(b=>KL[a][b]).map((a,d)=>[a,d<3?b:c]))}let KN={...KM("gray","grey","black"),...KM("red","light-red","red"),...KM("pink","light-red","red"),...KM("grape","light-violet","violet"),...KM("blue","light-blue","blue"),...KM("cyan","light-blue","blue"),...KM("teal","light-green","green"),...KM("green","light-green","green"),...KM("yellow","yellow","orange"),...KM("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},KO={solid:"draw",dashed:"dashed",dotted:"dotted"},KP={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},KQ={left:"start",center:"middle",right:"end"},KR={left:"start",center:"middle",right:"end"},KS={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},KT=a=>{let b=KO[a.strokeStyle]??"draw";return"draw"===b&&0===a.roughness&&(b="solid"),b},KU=a=>"transparent"===a.backgroundColor?"none":KP[a.fillStyle]??"solid";var KV=/(^|[^`])`([^`]+)`(?!`)$/,KW=/(^|[^`])`([^`]+)`(?!`)/g,KX=zn.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:a}){return["code",yz(this.options.HTMLAttributes,a),0]},markdownTokenName:"codespan",parseMarkdown:(a,b)=>b.applyMark("code",[{type:"text",text:a.text||""}]),renderMarkdown:(a,b)=>a.content?`\`${b.renderChildren(a.content)}\``:"",addCommands(){return{setCode:()=>({commands:a})=>a.setMark(this.name),toggleCode:()=>({commands:a})=>a.toggleMark(this.name),unsetCode:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[zH({find:KV,type:this.type})]},addPasteRules(){return[zU({find:KW,type:this.type})]}}),KY=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,KZ=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,K$=zn.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:a=>a.getAttribute("data-color")||a.style.backgroundColor,renderHTML:a=>a.color?{"data-color":a.color,style:`background-color: ${a.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes:a}){return["mark",yz(this.options.HTMLAttributes,a),0]},renderMarkdown:(a,b)=>`==${b.renderChildren(a)}==`,parseMarkdown:(a,b)=>b.applyMark("highlight",b.parseInline(a.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:a=>a.indexOf("=="),tokenize(a,b,c){let d=/^(==)([^=]+)(==)/.exec(a);if(d){let a=d[2].trim(),b=c.inlineTokens(a);return{type:"highlight",raw:d[0],text:a,tokens:b}}}},addCommands(){return{setHighlight:a=>({commands:b})=>b.setMark(this.name,a),toggleHighlight:a=>({commands:b})=>b.toggleMark(this.name,a),unsetHighlight:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[zH({find:KY,type:this.type})]},addPasteRules(){return[zU({find:KZ,type:this.type})]}}),K_=(a,b)=>{if("slot"===a)return 0;if(a instanceof Function)return a(b);let{children:c,...d}=null!=b?b:{};if("svg"===a)throw Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[a,d,c]},K0=/^\s*>\s$/,K1=zT.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:a}){return K_("blockquote",{...yz(this.options.HTMLAttributes,a),children:K_("slot",{})})},parseMarkdown:(a,b)=>b.createNode("blockquote",void 0,b.parseChildren(a.tokens||[])),renderMarkdown:(a,b)=>{if(!a.content)return"";let c=[];return a.content.forEach(a=>{let d=b.renderChildren([a]).split("\n").map(a=>""===a.trim()?">":`> ${a}`);c.push(d.join("\n"))}),c.join(`
>
`)},addCommands(){return{setBlockquote:()=>({commands:a})=>a.wrapIn(this.name),toggleBlockquote:()=>({commands:a})=>a.toggleWrap(this.name),unsetBlockquote:()=>({commands:a})=>a.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[zJ({find:K0,type:this.type})]}}),K2=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,K3=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,K4=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,K5=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,K6=zn.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:a=>"normal"!==a.style.fontWeight&&null},{style:"font-weight=400",clearMark:a=>a.type.name===this.name},{style:"font-weight",getAttrs:a=>/^(bold(er)?|[5-9]\d{2,})$/.test(a)&&null}]},renderHTML({HTMLAttributes:a}){return K_("strong",{...yz(this.options.HTMLAttributes,a),children:K_("slot",{})})},markdownTokenName:"strong",parseMarkdown:(a,b)=>b.applyMark("bold",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`**${b.renderChildren(a)}**`,addCommands(){return{setBold:()=>({commands:a})=>a.setMark(this.name),toggleBold:()=>({commands:a})=>a.toggleMark(this.name),unsetBold:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[zH({find:K2,type:this.type}),zH({find:K4,type:this.type})]},addPasteRules(){return[zU({find:K3,type:this.type}),zU({find:K5,type:this.type})]}}),K7=/^```([a-z]+)?[\s\n]$/,K8=/^~~~([a-z]+)?[\s\n]$/,K9=zT.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:a=>{var b;let{languageClassPrefix:c}=this.options;if(!c)return null;let d=[...(null==(b=a.firstElementChild)?void 0:b.classList)||[]].filter(a=>a.startsWith(c)).map(a=>a.replace(c,""))[0];return d||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:a,HTMLAttributes:b}){return["pre",yz(this.options.HTMLAttributes,b),["code",{class:a.attrs.language?this.options.languageClassPrefix+a.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(a,b)=>{var c;return(null==(c=a.raw)?void 0:c.startsWith("```"))===!1&&"indented"!==a.codeBlockStyle?[]:b.createNode("codeBlock",{language:a.lang||null},a.text?[b.createTextNode(a.text)]:[])},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.language)||"";return a.content?[`\`\`\`${d}`,b.renderChildren(a.content),"```"].join("\n"):`\`\`\`${d}

\`\`\``},addCommands(){return{setCodeBlock:a=>({commands:b})=>b.setNode(this.name,a),toggleCodeBlock:a=>({commands:b})=>b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:a,$anchor:b}=this.editor.state.selection,c=1===b.pos;return!!a&&b.parent.type.name===this.name&&(!!c||!b.parent.textContent.length)&&this.editor.commands.clearNodes()},Tab:({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;if(f.parent.type!==this.type)return!1;let h=" ".repeat(c);return g?a.commands.insertContent(h):a.commands.command(({tr:a})=>{let{from:b,to:c}=e,f=d.doc.textBetween(b,c,"\n","\n").split("\n").map(a=>h+a).join("\n");return a.replaceWith(b,c,d.schema.text(f)),!0})},"Shift-Tab":({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;return f.parent.type===this.type&&(g?a.commands.command(({tr:a})=>{var b;let{pos:e}=f,g=f.start(),h=f.end(),i=d.doc.textBetween(g,h,"\n","\n").split("\n"),j=0,k=0,l=e-g;for(let a=0;a<i.length;a+=1){if(k+i[a].length>=l){j=a;break}k+=i[a].length+1}let m=Math.min(((null==(b=i[j].match(/^ */))?void 0:b[0])||"").length,c);if(0===m)return!0;let n=g;for(let a=0;a<j;a+=1)n+=i[a].length+1;return a.delete(n,n+m),e-n<=m&&a.setSelection(t3.create(a.doc,n)),!0}):a.commands.command(({tr:a})=>{let{from:b,to:f}=e,g=d.doc.textBetween(b,f,"\n","\n").split("\n").map(a=>{var b;let d=Math.min(((null==(b=a.match(/^ */))?void 0:b[0])||"").length,c);return a.slice(d)}).join("\n");return a.replaceWith(b,f,d.schema.text(g)),!0}))},Enter:({editor:a})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:b}=a,{selection:c}=b,{$from:d,empty:e}=c;if(!e||d.parent.type!==this.type)return!1;let f=d.parentOffset===d.parent.nodeSize-2,g=d.parent.textContent.endsWith("\n\n");return!!f&&!!g&&a.chain().command(({tr:a})=>(a.delete(d.pos-2,d.pos),!0)).exitCode().run()},ArrowDown:({editor:a})=>{if(!this.options.exitOnArrowDown)return!1;let{state:b}=a,{selection:c,doc:d}=b,{$from:e,empty:f}=c;if(!f||e.parent.type!==this.type||e.parentOffset!==e.parent.nodeSize-2)return!1;let g=e.after();return void 0!==g&&(d.nodeAt(g)?a.commands.command(({tr:a})=>(a.setSelection(t_.near(d.resolve(g))),!0)):a.commands.exitCode())}}},addInputRules(){return[zI({find:K7,type:this.type,getAttributes:a=>({language:a[1]})}),zI({find:K8,type:this.type,getAttributes:a=>({language:a[1]})})]},addProseMirrorPlugins(){return[new uh({key:new uk("codeBlockVSCodeHandler"),props:{handlePaste:(a,b)=>{if(!b.clipboardData||this.editor.isActive(this.type.name))return!1;let c=b.clipboardData.getData("text/plain"),d=b.clipboardData.getData("vscode-editor-data"),e=d?JSON.parse(d):void 0,f=null==e?void 0:e.mode;if(!c||!f)return!1;let{tr:g,schema:h}=a.state,i=h.text(c.replace(/\r\n?/g,"\n"));return g.replaceSelectionWith(this.type.create({language:f},i)),g.selection.$from.parent.type!==this.type&&g.setSelection(t3.near(g.doc.resolve(Math.max(0,g.selection.from-2)))),g.setMeta("paste",!0),a.dispatch(g),!0}}})]}}),La=zT.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n\n"):""}),Lb=zT.create({name:"hardBreak",markdownTokenName:"br",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:a}){return["br",yz(this.options.HTMLAttributes,a)]},renderText:()=>"\n",renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:a,chain:b,state:c,editor:d})=>a.first([()=>a.exitCode(),()=>a.command(()=>{let{selection:a,storedMarks:e}=c;if(a.$from.parent.type.spec.isolating)return!1;let{keepMarks:f}=this.options,{splittableMarks:g}=d.extensionManager,h=e||a.$to.parentOffset&&a.$from.marks();return b().insertContent({type:this.name}).command(({tr:a,dispatch:b})=>{if(b&&h&&f){let b=h.filter(a=>g.includes(a.type.name));a.ensureMarks(b)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Lc=zT.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(a=>({tag:`h${a}`,attrs:{level:a}}))},renderHTML({node:a,HTMLAttributes:b}){let c=this.options.levels.includes(a.attrs.level)?a.attrs.level:this.options.levels[0];return[`h${c}`,yz(this.options.HTMLAttributes,b),0]},parseMarkdown:(a,b)=>b.createNode("heading",{level:a.depth||1},b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.level)?parseInt(a.attrs.level,10):1,e="#".repeat(d);return a.content?`${e} ${b.renderChildren(a.content)}`:""},addCommands(){return{setHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.setNode(this.name,a),toggleHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return this.options.levels.reduce((a,b)=>({...a,...{[`Mod-Alt-${b}`]:()=>this.editor.commands.toggleHeading({level:b})}}),{})},addInputRules(){return this.options.levels.map(a=>zI({find:RegExp(`^(#{${Math.min(...this.options.levels)},${a}})\\s$`),type:this.type,getAttributes:{level:a}}))}}),Ld=zT.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{},nextNodeType:"paragraph"}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:a}){return["hr",yz(this.options.HTMLAttributes,a)]},markdownTokenName:"hr",parseMarkdown:(a,b)=>b.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:a,state:b})=>{if(!function(a,b){let{selection:c}=a,{$from:d}=c;if(c instanceof t5){let a=d.index();return d.parent.canReplaceWith(a,a+1,b)}let e=d.depth;for(;e>=0;){let a=d.index(e);if(d.node(e).contentMatchAt(a).matchType(b))return!0;e-=1}return!1}(b,b.schema.nodes[this.name]))return!1;let{selection:c}=b,{$to:d}=c,e=a();return yT(c)?e.insertContentAt(d.pos,{type:this.name}):e.insertContent({type:this.name}),e.command(({state:a,tr:b,dispatch:c})=>{if(c){let{$to:c}=b.selection,d=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?b.setSelection(t3.create(b.doc,c.pos+1)):c.nodeAfter.isBlock?b.setSelection(t5.create(b.doc,c.pos)):b.setSelection(t3.create(b.doc,c.pos));else{let e=a.schema.nodes[this.options.nextNodeType]||c.parent.type.contentMatch.defaultType,f=null==e?void 0:e.create();f&&(b.insert(d,f),b.setSelection(t3.create(b.doc,d+1)))}b.scrollIntoView()}return!0}).run()}}},addInputRules(){var a;return[new zj({find:(a={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type}).find,handler:({state:b,range:c,match:d})=>{let e=yw(a.getAttributes,void 0,d)||{},{tr:f}=b,g=c.from,h=c.to,i=a.type.create(e);if(d[1]){let a=g+d[0].lastIndexOf(d[1]);a>h?a=h:h=a+d[1].length;let b=d[0][d[0].length-1];f.insertText(b,g+d[0].length-1),f.replaceWith(a,h,i)}else if(d[0]){let b=a.type.isInline?g:g-1;f.insert(b,a.type.create(e)).delete(f.mapping.map(g),f.mapping.map(h))}f.scrollIntoView()},undoable:a.undoable})]}}),Le=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Lf=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Lg=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Lh=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Li=zn.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:a=>"normal"!==a.style.fontStyle&&null},{style:"font-style=normal",clearMark:a=>a.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:a}){return["em",yz(this.options.HTMLAttributes,a),0]},addCommands(){return{setItalic:()=>({commands:a})=>a.setMark(this.name),toggleItalic:()=>({commands:a})=>a.toggleMark(this.name),unsetItalic:()=>({commands:a})=>a.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(a,b)=>b.applyMark("italic",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`*${b.renderChildren(a)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[zH({find:Le,type:this.type}),zH({find:Lg,type:this.type})]},addPasteRules(){return[zU({find:Lf,type:this.type}),zU({find:Lh,type:this.type})]}});let Lj="numeric",Lk="ascii",Ll="alpha",Lm="asciinumeric",Ln="alphanumeric",Lo="domain",Lp="emoji",Lq="whitespace";function Lr(a,b,c){for(let d in b[Lj]&&(b[Lm]=!0,b[Ln]=!0),b[Lk]&&(b[Lm]=!0,b[Ll]=!0),b[Lm]&&(b[Ln]=!0),b[Ll]&&(b[Ln]=!0),b[Ln]&&(b[Lo]=!0),b[Lp]&&(b[Lo]=!0),b){let b=(d in c||(c[d]=[]),c[d]);0>b.indexOf(a)&&b.push(a)}}function Ls(a=null){this.j={},this.jr=[],this.jd=null,this.t=a}Ls.groups={},Ls.prototype={accepts(){return!!this.t},go(a){let b=this.j[a];if(b)return b;for(let b=0;b<this.jr.length;b++){let c=this.jr[b][0],d=this.jr[b][1];if(d&&c.test(a))return d}return this.jd},has(a,b=!1){return b?a in this.j:!!this.go(a)},ta(a,b,c,d){for(let e=0;e<a.length;e++)this.tt(a[e],b,c,d)},tr(a,b,c,d){let e;return d=d||Ls.groups,b&&b.j?e=b:(e=new Ls(b),c&&d&&Lr(b,c,d)),this.jr.push([a,e]),e},ts(a,b,c,d){let e=this,f=a.length;if(!f)return e;for(let b=0;b<f-1;b++)e=e.tt(a[b]);return e.tt(a[f-1],b,c,d)},tt(a,b,c,d){if(d=d||Ls.groups,b&&b.j)return this.j[a]=b,b;let e,f=this.go(a);return f?(Object.assign((e=new Ls).j,f.j),e.jr.push.apply(e.jr,f.jr),e.jd=f.jd,e.t=f.t):e=new Ls,b&&(d&&(e.t&&"string"==typeof e.t?Lr(b,Object.assign(function(a,b){let c={};for(let d in b)b[d].indexOf(a)>=0&&(c[d]=!0);return c}(e.t,d),c),d):c&&Lr(b,c,d)),e.t=b),this.j[a]=e,e}};let Lt=(a,b,c,d,e)=>a.ta(b,c,d,e),Lu=(a,b,c,d,e)=>a.tr(b,c,d,e),Lv=(a,b,c,d,e)=>a.ts(b,c,d,e),Lw=(a,b,c,d,e)=>a.tt(b,c,d,e),Lx="WORD",Ly="UWORD",Lz="ASCIINUMERICAL",LA="ALPHANUMERICAL",LB="LOCALHOST",LC="UTLD",LD="SCHEME",LE="SLASH_SCHEME",LF="OPENBRACE",LG="CLOSEBRACE",LH="OPENBRACKET",LI="CLOSEBRACKET",LJ="OPENPAREN",LK="CLOSEPAREN",LL="OPENANGLEBRACKET",LM="CLOSEANGLEBRACKET",LN="FULLWIDTHLEFTPAREN",LO="FULLWIDTHRIGHTPAREN",LP="LEFTCORNERBRACKET",LQ="RIGHTCORNERBRACKET",LR="LEFTWHITECORNERBRACKET",LS="RIGHTWHITECORNERBRACKET",LT="FULLWIDTHLESSTHAN",LU="FULLWIDTHGREATERTHAN",LV="AMPERSAND",LW="APOSTROPHE",LX="ASTERISK",LY="BACKSLASH",LZ="BACKTICK",L$="CARET",L_="COLON",L0="COMMA",L1="DOLLAR",L2="EQUALS",L3="EXCLAMATION",L4="HYPHEN",L5="PERCENT",L6="PIPE",L7="PLUS",L8="POUND",L9="QUERY",Ma="QUOTE",Mb="FULLWIDTHMIDDLEDOT",Mc="SEMI",Md="SLASH",Me="TILDE",Mf="UNDERSCORE",Mg="EMOJI";var Mh=Object.freeze({__proto__:null,ALPHANUMERICAL:LA,AMPERSAND:LV,APOSTROPHE:LW,ASCIINUMERICAL:Lz,ASTERISK:LX,AT:"AT",BACKSLASH:LY,BACKTICK:LZ,CARET:L$,CLOSEANGLEBRACKET:LM,CLOSEBRACE:LG,CLOSEBRACKET:LI,CLOSEPAREN:LK,COLON:L_,COMMA:L0,DOLLAR:L1,DOT:"DOT",EMOJI:Mg,EQUALS:L2,EXCLAMATION:L3,FULLWIDTHGREATERTHAN:LU,FULLWIDTHLEFTPAREN:LN,FULLWIDTHLESSTHAN:LT,FULLWIDTHMIDDLEDOT:Mb,FULLWIDTHRIGHTPAREN:LO,HYPHEN:L4,LEFTCORNERBRACKET:LP,LEFTWHITECORNERBRACKET:LR,LOCALHOST:LB,NL:"NL",NUM:"NUM",OPENANGLEBRACKET:LL,OPENBRACE:LF,OPENBRACKET:LH,OPENPAREN:LJ,PERCENT:L5,PIPE:L6,PLUS:L7,POUND:L8,QUERY:L9,QUOTE:Ma,RIGHTCORNERBRACKET:LQ,RIGHTWHITECORNERBRACKET:LS,SCHEME:LD,SEMI:Mc,SLASH:Md,SLASH_SCHEME:LE,SYM:"SYM",TILDE:Me,TLD:"TLD",UNDERSCORE:Mf,UTLD:LC,UWORD:Ly,WORD:Lx,WS:"WS"});let Mi=/[a-z]/,Mj=/\p{L}/u,Mk=/\p{Emoji}/u,Ml=/\d/,Mm=/\s/,Mn=null,Mo=null;function Mp(a,b){let c=function(a){let b=[],c=a.length,d=0;for(;d<c;){let e,f=a.charCodeAt(d),g=f<55296||f>56319||d+1===c||(e=a.charCodeAt(d+1))<56320||e>57343?a[d]:a.slice(d,d+2);b.push(g),d+=g.length}return b}(b.replace(/[A-Z]/g,a=>a.toLowerCase())),d=c.length,e=[],f=0,g=0;for(;g<d;){let h=a,i=null,j=0,k=null,l=-1,m=-1;for(;g<d&&(i=h.go(c[g]));)(h=i).accepts()?(l=0,m=0,k=h):l>=0&&(l+=c[g].length,m++),j+=c[g].length,f+=c[g].length,g++;f-=l,g-=m,j-=l,e.push({t:k.t,v:b.slice(f-j,f),s:f-j,e:f})}return e}function Mq(a,b,c,d,e){let f,g=b.length;for(let c=0;c<g-1;c++){let g=b[c];a.j[g]?f=a.j[g]:((f=new Ls(d)).jr=e.slice(),a.j[g]=f),a=f}return(f=new Ls(c)).jr=e.slice(),a.j[b[g-1]]=f,f}function Mr(a){let b=[],c=[],d=0;for(;d<a.length;){let e=0;for(;"0123456789".indexOf(a[d+e])>=0;)e++;if(e>0){b.push(c.join(""));for(let b=parseInt(a.substring(d,d+e),10);b>0;b--)c.pop();d+=e}else c.push(a[d]),d++}return b}let Ms={defaultProtocol:"http",events:null,format:Mu,formatHref:Mu,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Mt(a,b=null){let c=Object.assign({},Ms);a&&(c=Object.assign(c,a instanceof Mt?a.o:a));let d=c.ignoreTags,e=[];for(let a=0;a<d.length;a++)e.push(d[a].toUpperCase());this.o=c,b&&(this.defaultRender=b),this.ignoreTags=e}function Mu(a){return a}function Mv(a,b){this.t="token",this.v=a,this.tk=b}function Mw(a,b){class c extends Mv{constructor(b,c){super(b,c),this.t=a}}for(let a in b)c.prototype[a]=b[a];return c.t=a,c}Mt.prototype={o:Ms,ignoreTags:[],defaultRender:a=>a,check(a){return this.get("validate",a.toString(),a)},get(a,b,c){let d=null!=b,e=this.o[a];return e&&("object"==typeof e?"function"==typeof(e=c.t in e?e[c.t]:Ms[a])&&d&&(e=e(b,c)):"function"==typeof e&&d&&(e=e(b,c.t,c))),e},getObj(a,b,c){let d=this.o[a];return"function"==typeof d&&null!=b&&(d=d(b,c.t,c)),d},render(a){let b=a.render(this);return(this.get("render",null,a)||this.defaultRender)(b,a.t,a)}},Mv.prototype={isLink:!1,toString(){return this.v},toHref(a){return this.toString()},toFormattedString(a){let b=this.toString(),c=a.get("truncate",b,this),d=a.get("format",b,this);return c&&d.length>c?d.substring(0,c)+"…":d},toFormattedHref(a){return a.get("formatHref",this.toHref(a.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(a=Ms.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(a),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(a){return{type:this.t,value:this.toFormattedString(a),isLink:this.isLink,href:this.toFormattedHref(a),start:this.startIndex(),end:this.endIndex()}},validate(a){return a.get("validate",this.toString(),this)},render(a){let b=this.toHref(a.get("defaultProtocol")),c=a.get("formatHref",b,this),d=a.get("tagName",b,this),e=this.toFormattedString(a),f={},g=a.get("className",b,this),h=a.get("target",b,this),i=a.get("rel",b,this),j=a.getObj("attributes",b,this),k=a.getObj("events",b,this);return f.href=c,g&&(f.class=g),h&&(f.target=h),i&&(f.rel=i),j&&Object.assign(f,j),{tagName:d,attributes:f,content:e,eventListeners:k}}};let Mx=Mw("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),My=Mw("text"),Mz=Mw("nl"),MA=Mw("url",{isLink:!0,toHref(a=Ms.defaultProtocol){return this.hasProtocol()?this.v:`${a}://${this.v}`},hasProtocol(){let a=this.tk;return a.length>=2&&a[0].t!==LB&&a[1].t===L_}}),MB=a=>new Ls(a);function MC(a,b,c){let d=c[0].s,e=c[c.length-1].e;return new a(b.slice(d,e),c)}let MD="u">typeof console&&console&&console.warn||(()=>{}),ME={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function MF(a,b=!1){if(ME.initialized&&MD(`linkifyjs: already initialized - will not register custom scheme "${a}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(a))throw Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);ME.customSchemes.push([a,b])}function MG(a){return ME.initialized||function(){ME.scanner=function(a=[]){let b={};Ls.groups=b;let c=new Ls;null==Mn&&(Mn=Mr("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==Mo&&(Mo=Mr("ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2")),Lw(c,"'",LW),Lw(c,"{",LF),Lw(c,"}",LG),Lw(c,"[",LH),Lw(c,"]",LI),Lw(c,"(",LJ),Lw(c,")",LK),Lw(c,"<",LL),Lw(c,">",LM),Lw(c,"（",LN),Lw(c,"）",LO),Lw(c,"「",LP),Lw(c,"」",LQ),Lw(c,"『",LR),Lw(c,"』",LS),Lw(c,"＜",LT),Lw(c,"＞",LU),Lw(c,"&",LV),Lw(c,"*",LX),Lw(c,"@","AT"),Lw(c,"`",LZ),Lw(c,"^",L$),Lw(c,":",L_),Lw(c,",",L0),Lw(c,"$",L1),Lw(c,".","DOT"),Lw(c,"=",L2),Lw(c,"!",L3),Lw(c,"-",L4),Lw(c,"%",L5),Lw(c,"|",L6),Lw(c,"+",L7),Lw(c,"#",L8),Lw(c,"?",L9),Lw(c,'"',Ma),Lw(c,"/",Md),Lw(c,";",Mc),Lw(c,"~",Me),Lw(c,"_",Mf),Lw(c,"\\",LY),Lw(c,"・",Mb);let d=Lu(c,Ml,"NUM",{[Lj]:!0});Lu(d,Ml,d);let e=Lu(d,Mi,Lz,{[Lm]:!0}),f=Lu(d,Mj,LA,{[Ln]:!0}),g=Lu(c,Mi,Lx,{[Lk]:!0});Lu(g,Ml,e),Lu(g,Mi,g),Lu(e,Ml,e),Lu(e,Mi,e);let h=Lu(c,Mj,Ly,{[Ll]:!0});Lu(h,Mi),Lu(h,Ml,f),Lu(h,Mj,h),Lu(f,Ml,f),Lu(f,Mi),Lu(f,Mj,f);let i=Lw(c,"\n","NL",{[Lq]:!0}),j=Lw(c,"\r","WS",{[Lq]:!0}),k=Lu(c,Mm,"WS",{[Lq]:!0});Lw(c,"￼",k),Lw(j,"\n",i),Lw(j,"￼",k),Lu(j,Mm,k),Lw(k,"\r"),Lw(k,"\n"),Lu(k,Mm,k),Lw(k,"￼",k);let l=Lu(c,Mk,Mg,{[Lp]:!0});Lw(l,"#"),Lu(l,Mk,l),Lw(l,"️",l);let m=Lw(l,"‍");Lw(m,"#"),Lu(m,Mk,l);let n=[[Mi,g],[Ml,e]],o=[[Mi,null],[Mj,h],[Ml,f]];for(let a=0;a<Mn.length;a++)Mq(c,Mn[a],"TLD",Lx,n);for(let a=0;a<Mo.length;a++)Mq(c,Mo[a],LC,Ly,o);Lr("TLD",{tld:!0,ascii:!0},b),Lr(LC,{utld:!0,alpha:!0},b),Mq(c,"file",LD,Lx,n),Mq(c,"mailto",LD,Lx,n),Mq(c,"http",LE,Lx,n),Mq(c,"https",LE,Lx,n),Mq(c,"ftp",LE,Lx,n),Mq(c,"ftps",LE,Lx,n),Lr(LD,{scheme:!0,ascii:!0},b),Lr(LE,{slashscheme:!0,ascii:!0},b),a=a.sort((a,b)=>a[0]>b[0]?1:-1);for(let b=0;b<a.length;b++){let d=a[b][0],e=a[b][1]?{scheme:!0}:{slashscheme:!0};d.indexOf("-")>=0?e[Lo]=!0:Mi.test(d)?Ml.test(d)?e[Lm]=!0:e[Lk]=!0:e[Lj]=!0,Lv(c,d,d,e)}return Lv(c,"localhost",LB,{ascii:!0}),c.jd=new Ls("SYM"),{start:c,tokens:Object.assign({groups:b},Mh)}}(ME.customSchemes);for(let a=0;a<ME.tokenQueue.length;a++)ME.tokenQueue[a][1]({scanner:ME.scanner});ME.parser=function({groups:a}){let b=a.domain.concat([LV,LX,"AT",LY,LZ,L$,L1,L2,L4,"NUM",L5,L6,L7,L8,Md,"SYM",Me,Mf]),c=[LW,L_,L0,"DOT",L3,L5,L9,Ma,Mc,LL,LM,LF,LG,LI,LH,LJ,LK,LN,LO,LP,LQ,LR,LS,LT,LU],d=[LV,LW,LX,LY,LZ,L$,L1,L2,L4,LF,LG,L5,L6,L7,L8,L9,Md,"SYM",Me,Mf],e=MB(),f=Lw(e,Me);Lt(f,d,f),Lt(f,a.domain,f);let g=MB(),h=MB(),i=MB();Lt(e,a.domain,g),Lt(e,a.scheme,h),Lt(e,a.slashscheme,i),Lt(g,d,f),Lt(g,a.domain,g);let j=Lw(g,"AT");Lw(f,"AT",j),Lw(h,"AT",j),Lw(i,"AT",j);let k=Lw(f,"DOT");Lt(k,d,f),Lt(k,a.domain,f);let l=MB();Lt(j,a.domain,l),Lt(l,a.domain,l);let m=Lw(l,"DOT");Lt(m,a.domain,l);let n=MB(Mx);Lt(m,a.tld,n),Lt(m,a.utld,n),Lw(j,LB,n);let o=Lw(l,L4);Lw(o,L4,o),Lt(o,a.domain,l),Lt(n,a.domain,l),Lw(n,"DOT",m),Lw(n,L4,o),Lt(Lw(n,L_),a.numeric,Mx);let p=Lw(g,L4),q=Lw(g,"DOT");Lw(p,L4,p),Lt(p,a.domain,g),Lt(q,d,f),Lt(q,a.domain,g);let r=MB(MA);Lt(q,a.tld,r),Lt(q,a.utld,r),Lt(r,a.domain,g),Lt(r,d,f),Lw(r,"DOT",q),Lw(r,L4,p),Lw(r,"AT",j);let s=Lw(r,L_),t=MB(MA);Lt(s,a.numeric,t);let u=MB(MA),v=MB();Lt(u,b,u),Lt(u,c,v),Lt(v,b,u),Lt(v,c,v),Lw(r,Md,u),Lw(t,Md,u);let w=Lw(h,L_),y=Lw(i,L_),z=Lw(y,Md),A=Lw(z,Md);Lt(h,a.domain,g),Lw(h,"DOT",q),Lw(h,L4,p),Lt(i,a.domain,g),Lw(i,"DOT",q),Lw(i,L4,p),Lt(w,a.domain,u),Lw(w,Md,u),Lw(w,L9,u),Lt(A,a.domain,u),Lt(A,b,u),Lw(A,Md,u);let B=[[LF,LG],[LH,LI],[LJ,LK],[LL,LM],[LN,LO],[LP,LQ],[LR,LS],[LT,LU]];for(let a=0;a<B.length;a++){let[d,e]=B[a],f=Lw(u,d);Lw(v,d,f),Lw(f,e,u);let g=MB(MA);Lt(f,b,g);let h=MB();Lt(f,c),Lt(g,b,g),Lt(g,c,h),Lt(h,b,g),Lt(h,c,h),Lw(g,e,u),Lw(h,e,u)}return Lw(e,LB,r),Lw(e,"NL",Mz),{start:e,tokens:Mh}}(ME.scanner.tokens);for(let a=0;a<ME.pluginQueue.length;a++)ME.pluginQueue[a][1]({scanner:ME.scanner,parser:ME.parser});ME.initialized=!0}(),function(a,b,c){let d=c.length,e=0,f=[],g=[];for(;e<d;){let h=a,i=null,j=null,k=0,l=null,m=-1;for(;e<d&&!(i=h.go(c[e].t));)g.push(c[e++]);for(;e<d&&(j=i||h.go(c[e].t));)i=null,(h=j).accepts()?(m=0,l=h):m>=0&&m++,e++,k++;if(m<0)(e-=k)<d&&(g.push(c[e]),e++);else{g.length>0&&(f.push(MC(My,b,g)),g=[]),e-=m,k-=m;let a=l.t,d=c.slice(e-k,e);f.push(MC(a,b,d))}}return g.length>0&&f.push(MC(My,b,g)),f}(ME.parser.start,a,Mp(ME.scanner.start,a))}function MH(a,b=null,c=null){if(b&&"object"==typeof b){if(c)throw Error(`linkifyjs: Invalid link type ${b}; must be a string`);c=b,b=null}let d=new Mt(c),e=MG(a),f=[];for(let a=0;a<e.length;a++){let c=e[a];c.isLink&&(!b||c.t===b)&&d.check(c)&&f.push(c.toFormattedObject(d))}return f}MG.scan=Mp;var MI="[\0-   ᠎ -\u2029 　]",MJ=new RegExp(MI),MK=RegExp(`${MI}$`),ML=RegExp(MI,"g");function MM(a,b){let c=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return b&&b.forEach(a=>{let b="string"==typeof a?a:a.scheme;b&&c.push(b)}),!a||a.replace(ML,"").match(RegExp(`^(?:(?:${c.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var MN=zn.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(a=>{"string"==typeof a?MF(a):MF(a.scheme,a.optionalSlashes)})},onDestroy(){Ls.groups={},ME.scanner=null,ME.parser=null,ME.tokenQueue=[],ME.pluginQueue=[],ME.customSchemes=[],ME.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(a,b)=>!!MM(a,b.protocols),validate:a=>!!a,shouldAutoLink:a=>{let b=/^[a-z][a-z0-9+.-]*:\/\//i.test(a),c=/^[a-z][a-z0-9+.-]*:/i.test(a);if(b||c&&!a.includes("@"))return!0;let d=(a.includes("@")?a.split("@").pop():a).split(/[/?#:]/)[0];return!/^\d{1,3}(\.\d{1,3}){3}$/.test(d)&&!!/\./.test(d)}}),addAttributes(){return{href:{default:null,parseHTML:a=>a.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class},title:{default:null}}},parseHTML(){return[{tag:"a[href]",getAttrs:a=>{let b=a.getAttribute("href");return!!b&&!!this.options.isAllowedUri(b,{defaultValidate:a=>!!MM(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&null}}]},renderHTML({HTMLAttributes:a}){return this.options.isAllowedUri(a.href,{defaultValidate:a=>!!MM(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",yz(this.options.HTMLAttributes,a),0]:["a",yz(this.options.HTMLAttributes,{...a,href:""}),0]},markdownTokenName:"link",parseMarkdown:(a,b)=>b.applyMark("link",b.parseInline(a.tokens||[]),{href:a.href,title:a.title||null}),renderMarkdown:(a,b)=>{var c,d,e,f;let g=null!=(d=null==(c=a.attrs)?void 0:c.href)?d:"",h=null!=(f=null==(e=a.attrs)?void 0:e.title)?f:"",i=b.renderChildren(a);return h?`[${i}](${g} "${h}")`:`[${i}](${g})`},addCommands(){return{setLink:a=>({chain:b})=>{let{href:c}=a;return!!this.options.isAllowedUri(c,{defaultValidate:a=>!!MM(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&b().setMark(this.name,a).setMeta("preventAutolink",!0).run()},toggleLink:a=>({chain:b})=>{let{href:c}=a||{};return(!c||!!this.options.isAllowedUri(c,{defaultValidate:a=>!!MM(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&b().toggleMark(this.name,a,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:a})=>a().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[zU({find:a=>{let b=[];if(a){let{protocols:c,defaultProtocol:d}=this.options,e=MH(a).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:a=>!!MM(a,c),protocols:c,defaultProtocol:d}));e.length&&e.forEach(a=>{this.options.shouldAutoLink(a.value)&&b.push({text:a.value,data:{href:a.href},index:a.start})})}return b},type:this.type,getAttributes:a=>{var b;return{href:null==(b=a.data)?void 0:b.href}}})]},addProseMirrorPlugins(){var a,b,c;let d=[],{protocols:e,defaultProtocol:f}=this.options;return this.options.autolink&&d.push((a={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:a=>this.options.isAllowedUri(a,{defaultValidate:a=>!!MM(a,e),protocols:e,defaultProtocol:f}),shouldAutoLink:this.options.shouldAutoLink},new uh({key:new uk("autolink"),appendTransaction:(b,c,d)=>{let e=b.some(a=>a.docChanged)&&!c.doc.eq(d.doc),f=b.some(a=>a.getMeta("preventAutolink"));if(!e||f)return;let{tr:g}=d;if(yL(yq(c.doc,[...b])).forEach(({newRange:b})=>{var c,e;let f,h,i,j=(c=d.doc,e=a=>a.isTextblock,i=[],c.nodesBetween(b.from,b.to,(a,b)=>{e(a)&&i.push({node:a,pos:b})}),i);if(j.length>1)f=j[0],h=d.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(j.length){let a=d.doc.textBetween(b.from,b.to," "," ");if(!MK.test(a))return;f=j[0],h=d.doc.textBetween(f.pos,b.to,void 0," ")}if(f&&h){let b=h.split(MJ).filter(Boolean);if(b.length<=0)return!1;let c=b[b.length-1],e=f.pos+h.lastIndexOf(c);if(!c)return!1;let i=MG(c).map(b=>b.toObject(a.defaultProtocol));if(!(1===i.length?i[0].isLink:3===i.length&&!!i[1].isLink&&["()","[]"].includes(i[0].value+i[2].value)))return!1;i.filter(a=>a.isLink).map(a=>({...a,from:e+a.start+1,to:e+a.end+1})).filter(a=>!d.schema.marks.code||!d.doc.rangeHasMark(a.from,a.to,d.schema.marks.code)).filter(b=>a.validate(b.value)).filter(b=>a.shouldAutoLink(b.value)).forEach(b=>{yM(b.from,b.to,d.doc).some(b=>b.mark.type===a.type)||g.addMark(b.from,b.to,a.type.create({href:b.href}))})}}),g.steps.length)return g}}))),d.push((b={type:this.type,editor:this.editor,openOnClick:"whenNotEditable"===this.options.openOnClick||this.options.openOnClick,enableClickSelection:this.options.enableClickSelection},new uh({key:new uk("handleClickLink"),props:{handleClick:(a,c,d)=>{var e,f;if(0!==d.button||!a.editable)return!1;let g=null;if(d.target instanceof HTMLAnchorElement)g=d.target;else{let a=d.target;if(!a)return!1;let c=b.editor.view.dom;(g=a.closest("a"))&&!c.contains(g)&&(g=null)}if(!g)return!1;let h=!1;if(b.enableClickSelection&&(h=b.editor.commands.extendMarkRange(b.type.name)),b.openOnClick){let c=yK(a.state,b.type.name),d=null!=(e=g.href)?e:c.href,i=null!=(f=g.target)?f:c.target;d&&(window.open(d,i),h=!0)}return h}}}))),this.options.linkOnPaste&&d.push((c={editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink},new uh({key:new uk("handlePasteLink"),props:{handlePaste:(a,b,d)=>{let{shouldAutoLink:e}=c,{state:f}=a,{selection:g}=f,{empty:h}=g;if(h)return!1;let i="";d.content.forEach(a=>{i+=a.textContent});let j=MH(i,{defaultProtocol:c.defaultProtocol}).find(a=>a.isLink&&a.value===i);return!!i&&!!j&&(void 0===e||!!e(j.value))&&c.editor.commands.setMark(c.type,{href:j.href})}}}))),d}}),MO=Object.defineProperty,MP="textStyle",MQ=/^\s*([-+*])\s$/,MR=zT.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:a}){return["ul",yz(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>"list"!==a.type||a.ordered?[]:{type:"bulletList",content:a.items?b.parseChildren(a.items):[]},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(MP)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let a=zJ({find:MQ,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(a=zJ({find:MQ,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(MP),editor:this.editor})),[a]}}),MS=zT.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:a}){return["li",yz(this.options.HTMLAttributes,a),0]},markdownTokenName:"list_item",parseMarkdown:(a,b)=>{if("list_item"!==a.type)return[];let c=[];if(a.tokens&&a.tokens.length>0)if(a.tokens.some(a=>"paragraph"===a.type))c=b.parseChildren(a.tokens);else{let d=a.tokens[0];if(d&&"text"===d.type&&d.tokens&&d.tokens.length>0){if(c=[{type:"paragraph",content:b.parseInline(d.tokens)}],a.tokens.length>1){let d=a.tokens.slice(1),e=b.parseChildren(d);c.push(...e)}}else c=b.parseChildren(a.tokens)}return 0===c.length&&(c=[{type:"paragraph",content:[]}]),{type:"listItem",content:c}},renderMarkdown:(a,b,c)=>zS(a,b,a=>{var b,c;if("bulletList"===a.parentType)return"- ";if("orderedList"===a.parentType){let d=(null==(c=null==(b=a.meta)?void 0:b.parentAttrs)?void 0:c.start)||1;return`${d+a.index}. `}return"- "},c),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),MT={},MU={findListItemPos:()=>MW,getNextListDepth:()=>MX,handleBackspace:()=>M_,handleDelete:()=>M2,hasListBefore:()=>MY,hasListItemAfter:()=>M3,hasListItemBefore:()=>MZ,listItemHasSubList:()=>M$,nextListIsDeeper:()=>M0,nextListIsHigher:()=>M1};for(var MV in MU)MO(MT,MV,{get:MU[MV],enumerable:!0});var MW=(a,b)=>{let{$from:c}=b.selection,d=xB(a,b.schema),e=c.depth,f=c.pos,g=null;for(;e>0&&null===g;)c.node(e).type===d?g=e:(e-=1,f-=1);return null===g?null:{$pos:b.doc.resolve(f),depth:g}},MX=(a,b)=>{let c=MW(a,b);if(!c)return!1;let[,d]=((a,b,c,d=20)=>{let e=a.doc.resolve(c),f=d,g=null;for(;f>0&&null===g;){let a=e.node(f);(null==a?void 0:a.type.name)===b?g=a:f-=1}return[g,f]})(b,a,c.$pos.pos+4);return d},MY=(a,b,c)=>{let{$anchor:d}=a.selection,e=Math.max(0,d.pos-2),f=a.doc.resolve(e).node();return!!f&&!!c.includes(f.type.name)},MZ=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-2);return 0!==e.index()&&(null==(c=e.nodeBefore)?void 0:c.type.name)===a},M$=(a,b,c)=>{if(!c)return!1;let d=xB(a,b.schema),e=!1;return c.descendants(a=>{a.type===d&&(e=!0)}),e},M_=(a,b,c)=>{if(a.commands.undoInputRule())return!0;if(a.state.selection.from!==a.state.selection.to)return!1;if(!x8(a.state,b)&&MY(a.state,b,c)){let{$anchor:c}=a.state.selection,d=a.state.doc.resolve(c.before()-1),e=[];d.node().descendants((a,c)=>{a.type.name===b&&e.push({node:a,pos:c})});let f=e.at(-1);if(!f)return!1;let g=a.state.doc.resolve(d.start()+f.pos+1);return a.chain().cut({from:c.start()-1,to:c.end()+1},g.end()).joinForward().run()}if(!x8(a.state,b)||!(a=>{let{$from:b,$to:c}=a.selection;return!(b.parentOffset>0)&&b.pos===c.pos})(a.state))return!1;let d=MW(b,a.state);if(!d)return!1;let e=a.state.doc.resolve(d.$pos.pos-2).node(d.depth),f=M$(b,a.state,e);return MZ(b,a.state)&&!f?a.commands.joinItemBackward():a.chain().liftListItem(b).run()},M0=(a,b)=>{let c=MX(a,b),d=MW(a,b);return!!d&&!!c&&c>d.depth},M1=(a,b)=>{let c=MX(a,b),d=MW(a,b);return!!d&&!!c&&c<d.depth},M2=(a,b)=>{if(!x8(a.state,b)||!((a,b)=>{let{$from:c,$to:d,$anchor:e}=a.selection;if(b){let c=yr(a=>a.type.name===b)(a.selection);if(!c)return!1;let d=a.doc.resolve(c.pos+1);return e.pos+1===d.end()}return!(d.parentOffset<d.parent.nodeSize-2)&&c.pos===d.pos})(a.state,b))return!1;let{selection:c}=a.state,{$from:d,$to:e}=c;return!(!c.empty&&d.sameParent(e))&&(M0(b,a.state)?a.chain().focus(a.state.selection.from+4).lift(b).joinBackward().run():M1(b,a.state)?a.chain().joinForward().joinBackward().run():a.commands.joinItemForward())},M3=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-d.parentOffset-2);return e.index()!==e.parent.childCount-1&&(null==(c=e.nodeAfter)?void 0:c.type.name)===a},M4=zs.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&M2(a,c)&&(b=!0)}),b},"Mod-Delete":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&M2(a,c)&&(b=!0)}),b},Backspace:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&M_(a,c,d)&&(b=!0)}),b},"Mod-Backspace":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&M_(a,c,d)&&(b=!0)}),b}}}}),M5=/^(\s*)(\d+)\.\s+(.*)$/,M6=/^\s/,M7="textStyle",M8=/^(\d+)\.\s$/,M9=zT.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:a=>a.hasAttribute("start")?parseInt(a.getAttribute("start")||"",10):1},type:{default:null,parseHTML:a=>a.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:a}){let{start:b,...c}=a;return 1===b?["ol",yz(this.options.HTMLAttributes,c),0]:["ol",yz(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>{var c;if("list"!==a.type||!a.ordered)return[];let d=a.start||1,e=a.items?(c=a.items,c.map(a=>{if("list_item"!==a.type)return b.parseChildren([a])[0];let c=[];return a.tokens&&a.tokens.length>0&&a.tokens.forEach(a=>{if("paragraph"===a.type||"list"===a.type||"blockquote"===a.type||"code"===a.type)c.push(...b.parseChildren([a]));else if("text"===a.type&&a.tokens){let d=b.parseChildren([a]);c.push({type:"paragraph",content:d})}else{let d=b.parseChildren([a]);d.length>0&&c.push(...d)}}),{type:"listItem",content:c}})):[];return 1!==d?{type:"orderedList",attrs:{start:d},content:e}:{type:"orderedList",content:e}},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"orderedList",level:"block",start:a=>{let b=a.match(/^(\s*)(\d+)\.\s+/),c=null==b?void 0:b.index;return void 0!==c?c:-1},tokenize:(a,b,c)=>{var d;let e=a.split("\n"),[f,g]=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c],f=e.match(M5);if(!f)break;let[,g,h,i]=f,j=g.length,k=i,l=c+1,m=[e];for(;l<a.length;){let b=a[l];if(b.match(M5))break;if(""===b.trim())m.push(b),k+="\n",l+=1;else if(b.match(M6))m.push(b),k+=`
${b.slice(j+2)}`,l+=1;else break}b.push({indent:j,number:parseInt(h,10),content:k.trim(),raw:m.join("\n")}),d=l,c=l}return[b,d]}(e);if(0===f.length)return;let h=function a(b,c,d){var e;let f=[],g=0;for(;g<b.length;){let h=b[g];if(h.indent===c){let i=h.content.split("\n"),j=(null==(e=i[0])?void 0:e.trim())||"",k=[];j&&k.push({type:"paragraph",raw:j,tokens:d.inlineTokens(j)});let l=i.slice(1).join("\n").trim();if(l){let a=d.blockTokens(l);k.push(...a)}let m=g+1,n=[];for(;m<b.length&&b[m].indent>c;)n.push(b[m]),m+=1;if(n.length>0){let b=Math.min(...n.map(a=>a.indent)),c=a(n,b,d);k.push({type:"list",ordered:!0,start:n[0].number,items:c,raw:n.map(a=>a.raw).join("\n")})}f.push({type:"list_item",raw:h.raw,tokens:k}),g=m}else g+=1}return f}(f,0,c);if(0!==h.length)return{type:"list",ordered:!0,start:(null==(d=f[0])?void 0:d.number)||1,items:h,raw:e.slice(0,g).join("\n")}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(M7)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let a=zJ({find:M8,type:this.type,getAttributes:a=>({start:+a[1]}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(a=zJ({find:M8,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:a=>({start:+a[1],...this.editor.getAttributes(M7)}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1],editor:this.editor})),[a]}}),Na=/^\s*(\[([( |x])?\])\s$/,Nb=zT.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:a=>{let b=a.getAttribute("data-checked");return""===b||"true"===b},renderHTML:a=>({"data-checked":a.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:a,HTMLAttributes:b}){return["li",yz(this.options.HTMLAttributes,b,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:a.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(a,b)=>{let c=[];if(a.tokens&&a.tokens.length>0?c.push(b.createNode("paragraph",{},b.parseInline(a.tokens))):a.text?c.push(b.createNode("paragraph",{},[b.createNode("text",{text:a.text})])):c.push(b.createNode("paragraph",{},[])),a.nestedTokens&&a.nestedTokens.length>0){let d=b.parseChildren(a.nestedTokens);c.push(...d)}return b.createNode("taskItem",{checked:a.checked||!1},c)},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.checked)?"x":" ";return zS(a,b,`- [${d}] `)},addKeyboardShortcuts(){let a={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...a,Tab:()=>this.editor.commands.sinkListItem(this.name)}:a},addNodeView(){return({node:a,HTMLAttributes:b,getPos:c,editor:d})=>{let e=document.createElement("li"),f=document.createElement("label"),g=document.createElement("span"),h=document.createElement("input"),i=document.createElement("div"),j=a=>{var b,c;h.ariaLabel=(null==(c=null==(b=this.options.a11y)?void 0:b.checkboxLabel)?void 0:c.call(b,a,h.checked))||`Task item checkbox for ${a.textContent||"empty task item"}`};j(a),f.contentEditable="false",h.type="checkbox",h.addEventListener("mousedown",a=>a.preventDefault()),h.addEventListener("change",b=>{if(!d.isEditable&&!this.options.onReadOnlyChecked){h.checked=!h.checked;return}let{checked:e}=b.target;d.isEditable&&"function"==typeof c&&d.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:a})=>{let b=c();if("number"!=typeof b)return!1;let d=a.doc.nodeAt(b);return a.setNodeMarkup(b,void 0,{...null==d?void 0:d.attrs,checked:e}),!0}).run(),d.isEditable||!this.options.onReadOnlyChecked||this.options.onReadOnlyChecked(a,e)||(h.checked=!h.checked)}),Object.entries(this.options.HTMLAttributes).forEach(([a,b])=>{e.setAttribute(a,b)}),e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,f.append(h,g),e.append(f,i),Object.entries(b).forEach(([a,b])=>{e.setAttribute(a,b)});let k=new Set(Object.keys(b));return{dom:e,contentDOM:i,update:a=>{if(a.type!==this.type)return!1;e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,j(a);let b=yA(a,d.extensionManager.attributes),c=new Set(Object.keys(b)),f=this.options.HTMLAttributes;return k.forEach(a=>{c.has(a)||(a in f?e.setAttribute(a,f[a]):e.removeAttribute(a))}),Object.entries(b).forEach(([a,b])=>{null==b?a in f?e.setAttribute(a,f[a]):e.removeAttribute(a):e.setAttribute(a,b)}),k=c,!0}}}},addInputRules(){return[zJ({find:Na,type:this.type,getAttributes:a=>({checked:"x"===a[a.length-1]})})]}}),Nc=zT.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:a}){return["ul",yz(this.options.HTMLAttributes,a,{"data-type":this.name}),0]},parseMarkdown:(a,b)=>b.createNode("taskList",{},b.parseChildren(a.items||[])),renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"taskList",level:"block",start(a){var b;let c=null==(b=a.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))?void 0:b.index;return void 0!==c?c:-1},tokenize(a,b,c){let d=a=>{let b=zR(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);return b?[{type:"taskList",raw:b.raw,items:b.items}]:c.blockTokens(a)},e=zR(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);if(e)return{type:"taskList",raw:e.raw,items:e.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:a})=>a.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});zs.create({name:"listKit",addExtensions(){let a=[];return!1!==this.options.bulletList&&a.push(MR.configure(this.options.bulletList)),!1!==this.options.listItem&&a.push(MS.configure(this.options.listItem)),!1!==this.options.listKeymap&&a.push(M4.configure(this.options.listKeymap)),!1!==this.options.orderedList&&a.push(M9.configure(this.options.orderedList)),!1!==this.options.taskItem&&a.push(Nb.configure(this.options.taskItem)),!1!==this.options.taskList&&a.push(Nc.configure(this.options.taskList)),a}});var Nd="&nbsp;",Ne=zT.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:a}){return["p",yz(this.options.HTMLAttributes,a),0]},parseMarkdown:(a,b)=>{let c=a.tokens||[];if(1===c.length&&"image"===c[0].type)return b.parseChildren([c[0]]);let d=b.parseInline(c);return 1===d.length&&"text"===d[0].type&&(d[0].text===Nd||" "===d[0].text)?b.createNode("paragraph",void 0,[]):b.createNode("paragraph",void 0,d)},renderMarkdown:(a,b)=>{if(!a)return"";let c=Array.isArray(a.content)?a.content:[];return 0===c.length?Nd:b.renderChildren(c)},addCommands(){return{setParagraph:()=>({commands:a})=>a.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Nf=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Ng=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Nh=zn.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("line-through")&&{}}],renderHTML({HTMLAttributes:a}){return["s",yz(this.options.HTMLAttributes,a),0]},markdownTokenName:"del",parseMarkdown:(a,b)=>b.applyMark("strike",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`~~${b.renderChildren(a)}~~`,addCommands(){return{setStrike:()=>({commands:a})=>a.setMark(this.name),toggleStrike:()=>({commands:a})=>a.toggleMark(this.name),unsetStrike:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[zH({find:Nf,type:this.type})]},addPasteRules(){return[zU({find:Ng,type:this.type})]}}),Ni=zT.create({name:"text",group:"inline",parseMarkdown:a=>({type:"text",text:a.text||""}),renderMarkdown:a=>a.text||""}),Nj=zn.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("underline")&&{}}],renderHTML({HTMLAttributes:a}){return["u",yz(this.options.HTMLAttributes,a),0]},parseMarkdown(a,b){return b.applyMark(this.name||"underline",b.parseInline(a.tokens||[]))},renderMarkdown:(a,b)=>`++${b.renderChildren(a)}++`,markdownTokenizer:{name:"underline",level:"inline",start:a=>a.indexOf("++"),tokenize(a,b,c){let d=/^(\+\+)([\s\S]+?)(\+\+)/.exec(a);if(!d)return;let e=d[2].trim();return{type:"underline",raw:d[0],text:e,tokens:c.inlineTokens(e)}}},addCommands(){return{setUnderline:()=>({commands:a})=>a.setMark(this.name),toggleUnderline:()=>({commands:a})=>a.toggleMark(this.name),unsetUnderline:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});class Nk{constructor(a,b){var c;this.editorView=a,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!=(c=b.width)?c:1,this.color=!1===b.color?void 0:b.color||"black",this.class=b.class,this.handlers=["dragover","dragend","drop","dragleave"].map(b=>{let c=a=>{this[b](a)};return a.dom.addEventListener(b,c),{name:b,handler:c}})}destroy(){this.handlers.forEach(({name:a,handler:b})=>this.editorView.dom.removeEventListener(a,b))}update(a,b){null!=this.cursorPos&&b.doc!=a.state.doc&&(this.cursorPos>a.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(a){a!=this.cursorPos&&(this.cursorPos=a,null==a?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let a,b,c=this.editorView.state.doc.resolve(this.cursorPos),d=!c.parent.inlineContent,e,f=this.editorView.dom,g=f.getBoundingClientRect(),h=g.width/f.offsetWidth,i=g.height/f.offsetHeight;if(d){let a=c.nodeBefore,b=c.nodeAfter;if(a||b){let c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){let d=c.getBoundingClientRect(),f=a?d.bottom:d.top;a&&b&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*i;e={left:d.left,right:d.right,top:f-g,bottom:f+g}}}}if(!e){let a=this.editorView.coordsAtPos(this.cursorPos),b=this.width/2*h;e={left:a.left-b,right:a.left+b,top:a.top,bottom:a.bottom}}let j=this.editorView.dom.offsetParent;if(!this.element&&(this.element=j.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",d),this.element.classList.toggle("prosemirror-dropcursor-inline",!d),j&&(j!=document.body||"static"!=getComputedStyle(j).position)){let c=j.getBoundingClientRect(),d=c.width/j.offsetWidth,e=c.height/j.offsetHeight;a=c.left-j.scrollLeft*d,b=c.top-j.scrollTop*e}else a=-pageXOffset,b=-pageYOffset;this.element.style.left=(e.left-a)/h+"px",this.element.style.top=(e.top-b)/i+"px",this.element.style.width=(e.right-e.left)/h+"px",this.element.style.height=(e.bottom-e.top)/i+"px"}scheduleRemoval(a){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),a)}dragover(a){if(!this.editorView.editable)return;let b=this.editorView.posAtCoords({left:a.clientX,top:a.clientY}),c=b&&b.inside>=0&&this.editorView.state.doc.nodeAt(b.inside),d=c&&c.type.spec.disableDropCursor,e="function"==typeof d?d(this.editorView,b,a):d;if(b&&!e){let a=b.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let b=tN(this.editorView.state.doc,a,this.editorView.dragging.slice);null!=b&&(a=b)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(a){this.editorView.dom.contains(a.relatedTarget)||this.setCursor(null)}}class Nl extends t_{constructor(a){super(a,a)}map(a,b){let c=a.resolve(b.map(this.head));return Nl.valid(c)?new Nl(c):t_.near(c)}content(){return sJ.empty}eq(a){return a instanceof Nl&&a.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new Nl(a.resolve(b.pos))}getBookmark(){return new Nm(this.anchor)}static valid(a){let b=a.parent;if(b.isTextblock||!function(a){for(let b=a.depth;b>=0;b--){let c=a.index(b),d=a.node(b);if(0==c){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c-1);;a=a.lastChild){if(0==a.childCount&&!a.inlineContent||Nn(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a)||!function(a){for(let b=a.depth;b>=0;b--){let c=a.indexAfter(b),d=a.node(b);if(c==d.childCount){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c);;a=a.firstChild){if(0==a.childCount&&!a.inlineContent||Nn(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a))return!1;let c=b.type.spec.allowGapCursor;if(null!=c)return c;let d=b.contentMatchAt(a.index()).defaultType;return d&&d.isTextblock}static findGapCursorFrom(a,b,c=!1){h:for(;;){if(!c&&Nl.valid(a))return a;let d=a.pos,e=null;for(let c=a.depth;;c--){let f=a.node(c);if(b>0?a.indexAfter(c)<f.childCount:a.index(c)>0){e=f.child(b>0?a.indexAfter(c):a.index(c)-1);break}if(0==c)return null;d+=b;let g=a.doc.resolve(d);if(Nl.valid(g))return g}for(;;){let f=b>0?e.firstChild:e.lastChild;if(!f){if(e.isAtom&&!e.isText&&!t5.isSelectable(e)){a=a.doc.resolve(d+e.nodeSize*b),c=!1;continue h}break}e=f,d+=b;let g=a.doc.resolve(d);if(Nl.valid(g))return g}return null}}}Nl.prototype.visible=!1,Nl.findFrom=Nl.findGapCursorFrom,t_.jsonID("gapcursor",Nl);class Nm{constructor(a){this.pos=a}map(a){return new Nm(a.map(this.pos))}resolve(a){let b=a.resolve(this.pos);return Nl.valid(b)?new Nl(b):t_.near(b)}}function Nn(a){return a.isAtom||a.spec.isolating||a.spec.createGapCursor}let No=xo({ArrowLeft:Np("horiz",-1),ArrowRight:Np("horiz",1),ArrowUp:Np("vert",-1),ArrowDown:Np("vert",1)});function Np(a,b){let c="vert"==a?b>0?"down":"up":b>0?"right":"left";return function(a,d,e){let f=a.selection,g=b>0?f.$to:f.$from,h=f.empty;if(f instanceof t3){if(!e.endOfTextblock(c)||0==g.depth)return!1;h=!1,g=a.doc.resolve(b>0?g.after():g.before())}let i=Nl.findGapCursorFrom(g,b,h);return!!i&&(d&&d(a.tr.setSelection(new Nl(i))),!0)}}function Nq(a,b,c){if(!a||!a.editable)return!1;let d=a.state.doc.resolve(b);if(!Nl.valid(d))return!1;let e=a.posAtCoords({left:c.clientX,top:c.clientY});return!(e&&e.inside>-1&&t5.isSelectable(a.state.doc.nodeAt(e.inside)))&&(a.dispatch(a.state.tr.setSelection(new Nl(d))),!0)}function Nr(a,b){if("insertCompositionText"!=b.inputType||!(a.state.selection instanceof Nl))return!1;let{$from:c}=a.state.selection,d=c.parent.contentMatchAt(c.index()).findWrapping(a.state.schema.nodes.text);if(!d)return!1;let e=sD.empty;for(let a=d.length-1;a>=0;a--)e=sD.from(d[a].createAndFill(null,e));let f=a.state.tr.replace(c.pos,c.pos,new sJ(e,0,0));return f.setSelection(t3.near(f.doc.resolve(c.pos+1))),a.dispatch(f),!1}function Ns(a){if(!(a.selection instanceof Nl))return null;let b=document.createElement("div");return b.className="ProseMirror-gapcursor",wO.create(a.doc,[wL.widget(a.selection.head,b,{key:"gapcursor"})])}var Nt=function(){};Nt.prototype.append=function(a){return a.length?(a=Nt.from(a),!this.length&&a||a.length<200&&this.leafAppend(a)||this.length<200&&a.leafPrepend(this)||this.appendInner(a)):this},Nt.prototype.prepend=function(a){return a.length?Nt.from(a).append(this):this},Nt.prototype.appendInner=function(a){return new Nv(this,a)},Nt.prototype.slice=function(a,b){return(void 0===a&&(a=0),void 0===b&&(b=this.length),a>=b)?Nt.empty:this.sliceInner(Math.max(0,a),Math.min(this.length,b))},Nt.prototype.get=function(a){if(!(a<0)&&!(a>=this.length))return this.getInner(a)},Nt.prototype.forEach=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length),b<=c?this.forEachInner(a,b,c,0):this.forEachInvertedInner(a,b,c,0)},Nt.prototype.map=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length);var d=[];return this.forEach(function(b,c){return d.push(a(b,c))},b,c),d},Nt.from=function(a){return a instanceof Nt?a:a&&a.length?new Nu(a):Nt.empty};var Nu=function(a){function b(b){a.call(this),this.values=b}b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b;var c={length:{configurable:!0},depth:{configurable:!0}};return b.prototype.flatten=function(){return this.values},b.prototype.sliceInner=function(a,c){return 0==a&&c==this.length?this:new b(this.values.slice(a,c))},b.prototype.getInner=function(a){return this.values[a]},b.prototype.forEachInner=function(a,b,c,d){for(var e=b;e<c;e++)if(!1===a(this.values[e],d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){for(var e=b-1;e>=c;e--)if(!1===a(this.values[e],d+e))return!1},b.prototype.leafAppend=function(a){if(this.length+a.length<=200)return new b(this.values.concat(a.flatten()))},b.prototype.leafPrepend=function(a){if(this.length+a.length<=200)return new b(a.flatten().concat(this.values))},c.length.get=function(){return this.values.length},c.depth.get=function(){return 0},Object.defineProperties(b.prototype,c),b}(Nt);Nt.empty=new Nu([]);var Nv=function(a){function b(b,c){a.call(this),this.left=b,this.right=c,this.length=b.length+c.length,this.depth=Math.max(b.depth,c.depth)+1}return b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},b.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},b.prototype.forEachInner=function(a,b,c,d){var e=this.left.length;if(b<e&&!1===this.left.forEachInner(a,b,Math.min(c,e),d)||c>e&&!1===this.right.forEachInner(a,Math.max(b-e,0),Math.min(this.length,c)-e,d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){var e=this.left.length;if(b>e&&!1===this.right.forEachInvertedInner(a,b-e,Math.max(c,e)-e,d+e)||c<e&&!1===this.left.forEachInvertedInner(a,Math.min(b,e),c,d))return!1},b.prototype.sliceInner=function(a,b){if(0==a&&b==this.length)return this;var c=this.left.length;return b<=c?this.left.slice(a,b):a>=c?this.right.slice(a-c,b-c):this.left.slice(a,c).append(this.right.slice(0,b-c))},b.prototype.leafAppend=function(a){var c=this.right.leafAppend(a);if(c)return new b(this.left,c)},b.prototype.leafPrepend=function(a){var c=this.left.leafPrepend(a);if(c)return new b(c,this.right)},b.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new b(this.left,new b(this.right,a)):new b(this,a)},b}(Nt);class Nw{constructor(a,b){this.items=a,this.eventCount=b}popEvent(a,b){let c,d,e,f;if(0==this.eventCount)return null;let g=this.items.length;for(;;g--)if(this.items.get(g-1).selection){--g;break}b&&(d=(c=this.remapping(g,this.items.length)).maps.length);let h=a.tr,i=[],j=[];return this.items.forEach((a,b)=>{if(!a.step){c||(d=(c=this.remapping(g,b+1)).maps.length),d--,j.push(a);return}if(c){j.push(new Nx(a.map));let b=a.step.map(c.slice(d)),e;b&&h.maybeStep(b).doc&&(e=h.mapping.maps[h.mapping.maps.length-1],i.push(new Nx(e,void 0,void 0,i.length+j.length))),d--,e&&c.appendMap(e,d)}else h.maybeStep(a.step);if(a.selection)return e=c?a.selection.map(c.slice(d)):a.selection,f=new Nw(this.items.slice(0,g).append(j.reverse().concat(i)),this.eventCount-1),!1},this.items.length,0),{remaining:f,transform:h,selection:e}}addTransform(a,b,c,d){var e,f;let g,h=[],i=this.eventCount,j=this.items,k=!d&&j.length?j.get(j.length-1):null;for(let c=0;c<a.steps.length;c++){let e=a.steps[c].invert(a.docs[c]),f=new Nx(a.mapping.maps[c],e,b),g;(g=k&&k.merge(f))&&(f=g,c?h.pop():j=j.slice(0,j.length-1)),h.push(f),b&&(i++,b=void 0),d||(k=f)}let l=i-c.depth;return l>Nz&&(e=j,f=l,e.forEach((a,b)=>{if(a.selection&&0==f--)return g=b,!1}),j=e.slice(g),i-=l),new Nw(j.append(h),i)}remapping(a,b){let c=new tr;return this.items.forEach((b,d)=>{let e=null!=b.mirrorOffset&&d-b.mirrorOffset>=a?c.maps.length-b.mirrorOffset:void 0;c.appendMap(b.map,e)},a,b),c}addMaps(a){return 0==this.eventCount?this:new Nw(this.items.append(a.map(a=>new Nx(a))),this.eventCount)}rebased(a,b){if(!this.eventCount)return this;let c=[],d=Math.max(0,this.items.length-b),e=a.mapping,f=a.steps.length,g=this.eventCount;this.items.forEach(a=>{a.selection&&g--},d);let h=b;this.items.forEach(b=>{let d=e.getMirror(--h);if(null==d)return;f=Math.min(f,d);let i=e.maps[d];if(b.step){let f=a.steps[d].invert(a.docs[d]),j=b.selection&&b.selection.map(e.slice(h+1,d));j&&g++,c.push(new Nx(i,f,j))}else c.push(new Nx(i))},d);let i=[];for(let a=b;a<f;a++)i.push(new Nx(e.maps[a]));let j=new Nw(this.items.slice(0,d).append(i).append(c),g);return j.emptyItemCount()>500&&(j=j.compress(this.items.length-c.length)),j}emptyItemCount(){let a=0;return this.items.forEach(b=>{!b.step&&a++}),a}compress(a=this.items.length){let b=this.remapping(0,a),c=b.maps.length,d=[],e=0;return this.items.forEach((f,g)=>{if(g>=a)d.push(f),f.selection&&e++;else if(f.step){let a=f.step.map(b.slice(c)),g=a&&a.getMap();if(c--,g&&b.appendMap(g,c),a){let h=f.selection&&f.selection.map(b.slice(c));h&&e++;let i=new Nx(g.invert(),a,h),j,k=d.length-1;(j=d.length&&d[k].merge(i))?d[k]=j:d.push(i)}}else f.map&&c--},this.items.length,0),new Nw(Nt.from(d.reverse()),e)}}Nw.empty=new Nw(Nt.empty,0);class Nx{constructor(a,b,c,d){this.map=a,this.step=b,this.selection=c,this.mirrorOffset=d}merge(a){if(this.step&&a.step&&!a.selection){let b=a.step.merge(this.step);if(b)return new Nx(b.getMap().invert(),b,this.selection)}}}class Ny{constructor(a,b,c,d,e){this.done=a,this.undone=b,this.prevRanges=c,this.prevTime=d,this.prevComposition=e}}let Nz=20;function NA(a){let b=[];for(let c=a.length-1;c>=0&&0==b.length;c--)a[c].forEach((a,c,d,e)=>b.push(d,e));return b}function NB(a,b){if(!a)return null;let c=[];for(let d=0;d<a.length;d+=2){let e=b.map(a[d],1),f=b.map(a[d+1],-1);e<=f&&c.push(e,f)}return c}let NC=!1,ND=null;function NE(a){let b=a.plugins;if(ND!=b){NC=!1,ND=b;for(let a=0;a<b.length;a++)if(b[a].spec.historyPreserveItems){NC=!0;break}}return NC}let NF=new uk("history"),NG=new uk("closeHistory");function NH(a,b){return(c,d)=>{let e=NF.getState(c);if(!e||0==(a?e.undone:e.done).eventCount)return!1;if(d){let f=function(a,b,c){let d=NE(b),e=NF.get(b).spec.config,f=(c?a.undone:a.done).popEvent(b,d);if(!f)return null;let g=f.selection.resolve(f.transform.doc),h=(c?a.done:a.undone).addTransform(f.transform,b.selection.getBookmark(),e,d),i=new Ny(c?h:f.remaining,c?f.remaining:h,null,0,-1);return f.transform.setSelection(g).setMeta(NF,{redo:c,historyState:i})}(e,c,a);f&&d(b?f.scrollIntoView():f)}return!0}}let NI=NH(!1,!0),NJ=NH(!0,!0);NH(!1,!1),NH(!0,!1),zs.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:a=>a.length,wordCounter:a=>a.split(" ").filter(a=>""!==a).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc;if("textSize"===((null==a?void 0:a.mode)||this.options.mode)){let a=b.textBetween(0,b.content.size,void 0," ");return this.options.textCounter(a)}return b.nodeSize},this.storage.words=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc,c=b.textBetween(0,b.content.size," "," ");return this.options.wordCounter(c)}},addProseMirrorPlugins(){let a=!1;return[new uh({key:new uk("characterCount"),appendTransaction:(b,c,d)=>{if(a)return;let e=this.options.limit;if(null==e||0===e){a=!0;return}let f=this.storage.characters({node:d.doc});if(f>e){console.warn(`[CharacterCount] Initial content exceeded limit of ${e} characters. Content was automatically trimmed.`);let b=d.tr.deleteRange(0,f-e);return a=!0,b}a=!0},filterTransaction:(a,b)=>{let c=this.options.limit;if(!a.docChanged||0===c||null==c)return!0;let d=this.storage.characters({node:b.doc}),e=this.storage.characters({node:a.doc});if(e<=c||d>c&&e>c&&e<=d)return!0;if(d>c&&e>c&&e>d||!a.getMeta("paste"))return!1;let f=a.selection.$head.pos;return a.deleteRange(f-(e-c),f),!(this.storage.characters({node:a.doc})>c)}})]}});var NK=zs.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[function(a={}){return new uh({view:b=>new Nk(b,a)})}(this.options)]}});zs.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new uh({key:new uk("focus"),props:{decorations:({doc:a,selection:b})=>{let{isEditable:c,isFocused:d}=this.editor,{anchor:e}=b,f=[];if(!c||!d)return wO.create(a,[]);let g=0;"deepest"===this.options.mode&&a.descendants((a,b)=>{if(!a.isText){if(!(e>=b&&e<=b+a.nodeSize-1))return!1;g+=1}});let h=0;return a.descendants((a,b)=>!a.isText&&!!(e>=b&&e<=b+a.nodeSize-1)&&((h+=1,"deepest"===this.options.mode&&g-h>0||"shallowest"===this.options.mode&&h>1)?"deepest"===this.options.mode:void f.push(wL.node(b,b+a.nodeSize,{class:this.options.className})))),wO.create(a,f)}}})]}});var NL=zs.create({name:"gapCursor",addProseMirrorPlugins:()=>[new uh({props:{decorations:Ns,createSelectionBetween:(a,b,c)=>b.pos==c.pos&&Nl.valid(c)?new Nl(c):null,handleClick:Nq,handleKeyDown:No,handleDOMEvents:{beforeinput:Nr}}})],extendNodeSchema(a){var b;let c={name:a.name,options:a.options,storage:a.storage};return{allowGapCursor:null!=(b=yw(ys(a,"allowGapCursor",c)))?b:null}}}),NM="placeholder";function NN({types:a,node:b}){return b&&Array.isArray(a)&&a.includes(b.type)||(null==b?void 0:b.type)===a}zs.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:NM,placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){let a=this.options.dataAttribute?`data-${this.options.dataAttribute.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}`:`data-${NM}`;return[new uh({key:new uk("placeholder"),props:{decorations:({doc:b,selection:c})=>{let d=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:e}=c,f=[];if(!d)return null;let g=this.editor.isEmpty;return b.descendants((b,c)=>{let d=e>=c&&e<=c+b.nodeSize,h=!b.isLeaf&&yS(b);if((d||!this.options.showOnlyCurrent)&&h){let e=[this.options.emptyNodeClass];g&&e.push(this.options.emptyEditorClass);let h=wL.node(c,c+b.nodeSize,{class:e.join(" "),[a]:"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:b,pos:c,hasAnchor:d}):this.options.placeholder});f.push(h)}return this.options.includeChildren}),wO.create(b,f)}}})]}}),zs.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){let{editor:a,options:b}=this;return[new uh({key:new uk("selection"),props:{decorations:c=>c.selection.empty||a.isFocused||!a.isEditable||yT(c.selection)||a.view.dragging?null:wO.create(c.doc,[wL.inline(c.selection.from,c.selection.to,{class:b.className})])}})]}});var NO=zs.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var a;let b=new uk(this.name),c=this.options.node||(null==(a=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:a.name)||"paragraph",d=Object.entries(this.editor.schema.nodes).map(([,a])=>a).filter(a=>(this.options.notAfter||[]).concat(c).includes(a.name));return[new uh({key:b,appendTransaction:(a,d,e)=>{let{doc:f,tr:g,schema:h}=e,i=b.getState(e),j=f.content.size,k=h.nodes[c];if(i)return g.insert(j,k.create())},state:{init:(a,b)=>!NN({node:b.tr.doc.lastChild,types:d}),apply:(a,b)=>!a.docChanged||a.getMeta("__uniqueIDTransaction")?b:!NN({node:a.doc.lastChild,types:d})}})]}}),NP=zs.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:a,dispatch:b})=>NI(a,b),redo:()=>({state:a,dispatch:b})=>NJ(a,b)}),addProseMirrorPlugins(){return[function(a={}){return new uh({key:NF,state:{init:()=>new Ny(Nw.empty,Nw.empty,null,0,-1),apply:(b,c,d)=>(function(a,b,c,d){let e=c.getMeta(NF),f;if(e)return e.historyState;c.getMeta(NG)&&(a=new Ny(a.done,a.undone,null,0,-1));let g=c.getMeta("appendedTransaction");if(0==c.steps.length)return a;if(g&&g.getMeta(NF))if(g.getMeta(NF).redo)return new Ny(a.done.addTransform(c,void 0,d,NE(b)),a.undone,NA(c.mapping.maps),a.prevTime,a.prevComposition);else return new Ny(a.done,a.undone.addTransform(c,void 0,d,NE(b)),null,a.prevTime,a.prevComposition);if(!1===c.getMeta("addToHistory")||g&&!1===g.getMeta("addToHistory"))if(f=c.getMeta("rebased"))return new Ny(a.done.rebased(c,f),a.undone.rebased(c,f),NB(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);else return new Ny(a.done.addMaps(c.mapping.maps),a.undone.addMaps(c.mapping.maps),NB(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);{let e=c.getMeta("composition"),f=0==a.prevTime||!g&&a.prevComposition!=e&&(a.prevTime<(c.time||0)-d.newGroupDelay||!function(a,b){if(!b)return!1;if(!a.docChanged)return!0;let c=!1;return a.mapping.maps[0].forEach((a,d)=>{for(let e=0;e<b.length;e+=2)a<=b[e+1]&&d>=b[e]&&(c=!0)}),c}(c,a.prevRanges)),h=g?NB(a.prevRanges,c.mapping):NA(c.mapping.maps);return new Ny(a.done.addTransform(c,f?b.selection.getBookmark():void 0,d,NE(b)),Nw.empty,h,c.time,null==e?a.prevComposition:e)}})(c,d,b,a)},config:a={depth:a.depth||100,newGroupDelay:a.newGroupDelay||500},props:{handleDOMEvents:{beforeinput(a,b){let c=b.inputType,d="historyUndo"==c?NI:"historyRedo"==c?NJ:null;return!!d&&!!a.editable&&(b.preventDefault(),d(a.state,a.dispatch))}}}})}(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),NQ=zs.create({name:"starterKit",addExtensions(){var a,b,c,d;let e=[];return!1!==this.options.bold&&e.push(K6.configure(this.options.bold)),!1!==this.options.blockquote&&e.push(K1.configure(this.options.blockquote)),!1!==this.options.bulletList&&e.push(MR.configure(this.options.bulletList)),!1!==this.options.code&&e.push(KX.configure(this.options.code)),!1!==this.options.codeBlock&&e.push(K9.configure(this.options.codeBlock)),!1!==this.options.document&&e.push(La.configure(this.options.document)),!1!==this.options.dropcursor&&e.push(NK.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&e.push(NL.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&e.push(Lb.configure(this.options.hardBreak)),!1!==this.options.heading&&e.push(Lc.configure(this.options.heading)),!1!==this.options.undoRedo&&e.push(NP.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&e.push(Ld.configure(this.options.horizontalRule)),!1!==this.options.italic&&e.push(Li.configure(this.options.italic)),!1!==this.options.listItem&&e.push(MS.configure(this.options.listItem)),!1!==this.options.listKeymap&&e.push(M4.configure(null==(a=this.options)?void 0:a.listKeymap)),!1!==this.options.link&&e.push(MN.configure(null==(b=this.options)?void 0:b.link)),!1!==this.options.orderedList&&e.push(M9.configure(this.options.orderedList)),!1!==this.options.paragraph&&e.push(Ne.configure(this.options.paragraph)),!1!==this.options.strike&&e.push(Nh.configure(this.options.strike)),!1!==this.options.text&&e.push(Ni.configure(this.options.text)),!1!==this.options.underline&&e.push(Nj.configure(null==(c=this.options)?void 0:c.underline)),!1!==this.options.trailingNode&&e.push(NO.configure(null==(d=this.options)?void 0:d.trailingNode)),e}});let NR={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},NS=cH(NR).flatMap(a=>cH(a).flatMap(a=>Object.values(a))),NT=zs.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts:()=>({"Shift-Enter":({editor:a})=>a.commands.enter()})});KX.config.excludes=void 0,K$.config.priority=1100;let NU=[NQ.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1,link:{openOnClick:!1,autolink:!0},trailingNode:{notAfter:["paragraph","bulletList","orderedList","listItem"]}}),K$,NT,zr.TextDirection.configure({direction:"auto"})],NV=new ci;function NW(a,b){return NV.get(b,()=>{let c;return(c=yE(yG(a.getTextOptions().tipTapConfig?.extensions??NU),void 0),yu(sW.fromJSON(c,b).content,c)).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function NX(a,b){let c=NW(a,b);return`<div class="tl-rich-text">${c}</div>`}let NY=new ci;function NZ(a){return 1===a.content.length&&!a.content[0].content}function N$(a,b){return NZ(b)?"":NY.get(b,()=>(function(a,b,c){let{blockSeparator:d="\n\n",textSerializers:e={}}=c||{},f=yE(yG(b),void 0);return yI(sW.fromJSON(f,a),{blockSeparator:d,textSerializers:{...yJ(f),...e}})})(b,a.getTextOptions().tipTapConfig?.extensions??NU,{blockSeparator:"\n"}))}function N_(a,b,c){for(let c of a.marks)"bold"===c.type.name&&"bold"!==b.weight&&(b={...b,weight:"bold"}),"italic"===c.type.name&&"italic"!==b.style&&(b={...b,style:"italic"}),"code"===c.type.name&&"tldraw_mono"!==b.family&&(b={...b,family:"tldraw_mono"});let d=cF(NR,b.family);if(!d)return b;let e=cF(d,b.style);if(!e)return b;let f=cF(e,b.weight);return f&&c(f),b}class N0{static fixNewLines=/\r?\n|\r/g;static normalizeText(a){return a.replace(N0.fixNewLines,"\n")}static normalizeTextForDom(a){return a.replace(N0.fixNewLines,"\n").split("\n").map(a=>a||" ").join("\n")}}let N1=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/,N2={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},N3=RegExp(Object.keys(N2).join("|"),"g");function N4(a){return a.replace(N3,a=>N2[a])}async function N5(a,{file:b,assetId:c},d){Og(b,d)||cd(!1,"File checks failed");let e=await Oh(b,d,c),f=await a.uploadAsset(e,b);return e.props.src=f.src,f.meta&&(e.meta={...e.meta,...f.meta}),hz.create(e)}async function N6(a,{file:b,shapeId:c,isImage:d},e){Og(b,e)||cd(!1,"File checks failed");let f=a.getShape(c);f||cd(!1,"Shape not found");let g=cq(await b.arrayBuffer()),h=hz.createId(g);a.createTemporaryAssetPreview(h,b);let i=await Oe(b,h,d,!d);if(a.createAssets([i]),"image"===f.type){let b=f.props.crop,c=i.props.w,d=i.props.h,e=f.x,g=f.y,j=b;if(b){let a=function(a,b,c){let d=HX(),e=a.props.crop||d,f=a.props.w,g=a.props.h,h=d,i=f,j=g;if((0,zY.default)(a.props.crop,d))i=f,j=f*c/b;else{let d,f,{w:g,h:i}=H$(a.props,a.props.crop||HX()),{width:j,height:k}=H_(e),l=j/k,m=H0(e),n=b/c/(g/i)/l;if(f=(d=j)*n,n>1.5)if(1/f<1/d){let a=f/.3333333333333333;f/=a,d/=a}else{let a=d/.3333333333333333;d/=a,f/=a}d=Math.max(0,Math.min(1,d)),f=Math.max(0,Math.min(1,f)),h=H1(m.x,m.y,d,f,e.isCircle)}let k=a.x+f/2,l=a.y+g/2,m=k-i/2,n=l-j/2;return{crop:h,w:i,h:j,x:m,y:n}}(f,i.props.w,i.props.h);j=a.crop,c=a.w,d=a.h,e=a.x,g=a.y}a.updateShapes([{id:f.id,type:f.type,props:{assetId:h,crop:j,w:c,h:d},x:e,y:g}])}else"video"===f.type&&a.updateShapes([{id:f.id,type:f.type,props:{assetId:h,w:i.props.w,h:i.props.h}}]);let j=await a.getAssetForExternalContent({type:"file",file:b,assetId:h});return a.updateAssets([{...j,id:h}]),j}async function N7(a,{url:b},{toasts:c,msg:d}){let e;try{let a=await cm(b,{method:"GET",mode:"no-cors"}),c=await a.text(),d=new DOMParser().parseFromString(c,"text/html");(e={image:d.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:d.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??d.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:d.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??b,description:d.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}).image.startsWith("http")||(e.image=new URL(e.image,b).href),e.favicon.startsWith("http")||(e.favicon=new URL(e.favicon,b).href)}catch(a){console.error(a),c.addToast({title:d("assets.url.failed"),severity:"error"}),e={image:"",favicon:"",title:"",description:""}}return{id:hz.createId(cp(b)),typeName:"asset",type:"bookmark",props:{src:b,description:e.description,image:e.image,favicon:e.favicon,title:e.title},meta:{}}}async function N8(a,{point:b,text:c}){let d=b??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():a.getViewportPageBounds().center),e=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!e)throw Error("No <svg/> element present");let f=parseFloat(e.getAttribute("width")||"0"),g=parseFloat(e.getAttribute("height")||"0");if(!(f&&g)){document.body.appendChild(e);let a=e.getBoundingClientRect();document.body.removeChild(e),f=a.width,g=a.height}let h=await a.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!h)throw Error("Could not create an asset");Of(a,[h],d)}async function N9(a,{point:b,files:c},d){let{acceptedImageMimeTypes:e=cz,toasts:f,msg:g}=d;if(c.length>a.options.maxFilesAtOnce)return void f.addToast({title:g("assets.files.amount-too-many"),severity:"error"});let h=b??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():a.getViewportPageBounds().center),i=new iK(h.x,h.y),j=[],k=[];for(let b of c){if(!Og(b,d))continue;let c=await Oh(b,d);e.includes(b.type)&&a.createTemporaryAssetPreview(c.id,b),j.push(c),k.push({asset:c,file:b})}Promise.allSettled(k.map(async b=>{try{let c=await a.getAssetForExternalContent({type:"file",file:b.file});if(!c)throw Error("Could not create an asset");a.updateAssets([{...c,id:b.asset.id}])}catch(c){f.addToast({title:g("assets.files.upload-failed"),severity:"error"}),console.error(c),a.deleteAssets([b.asset.id]);return}})),Of(a,j,i)}async function Oa(a,{point:b,text:c,html:d}){let e,f,g,h,i,j,k=b??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():a.getViewportPageBounds().center),l=a.getShapeUtil("text").getDefaultProps(),m=(function(a){let b=a.split("\n");for(;b[0]&&0===b[0].trim().length;)b.shift();let c=1/0;for(let a of b)if(a.trim().length>0){let b=a.length-a.trimStart().length;c=Math.min(c,b)}return b.map(a=>a.slice(c)).join("\n")})(c.replace(/\t/g,"  ")).replace(/[ \t]+$/gm,"").replace(/\n+$/,""),n=d?(h=a.getTextOptions().tipTapConfig?.extensions??NU,i=yE(yG(h),void 0),j=xX(d),tb.fromSchema(i).parse(j).toJSON()):gb(m),o="middle",p=d??m.replace(/\n/g,"<br>"),q=d?n.content.length>1:m.split("\n").length>1,r=N1.test(m);q&&(o=q?r?"end":"start":"middle");let s=a.textMeasure.measureHtml(p,{...KA,fontFamily:KF[l.font],fontSize:KC[l.size],maxWidth:null}),t=Math.min(q?.9*a.getViewportPageBounds().width:920,Math.max(200,.9*a.getViewportPageBounds().width));if(s.w>t){let b=a.textMeasure.measureHtml(p,{...KA,fontFamily:KF[l.font],fontSize:KC[l.size],maxWidth:t});e=b.w,f=b.h,g=!1,o=r?"end":"start"}else e=Math.max(s.w,10),f=Math.max(s.h,10),g=!0;k.y-f/2<a.getViewportPageBounds().minY+40&&(k.y=a.getViewportPageBounds().minY+40+f/2);let u=ss(new iK(k.x-e/2,k.y-f/2),a),v=gi();a.createShapes([{id:v,type:"text",x:u.x,y:u.y,props:{richText:n,textAlign:o,autoSize:g,w:e}}])}async function Ob(a,{point:b,url:c},{toasts:d,msg:e}){let f=a.getShapeUtil("embed"),g=f?.getEmbedDefinition(c);if(g&&!1!==g.definition.embedOnPaste)return a.putExternalContent({type:"embed",url:g.url,point:b,embed:g.definition});let h=b??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():a.getViewportPageBounds().center);if(!(await Ax(a,{url:c,center:h})).ok)return void d.addToast({title:e("assets.url.failed"),severity:"error"})}async function Oc(a,{point:b,content:c}){a.run(()=>{let d=a.getSelectionPageBounds();for(let b of(a.markHistoryStoppingPoint("paste"),c.shapes))c.rootShapeIds.includes(b.id)&&(b.isLocked=!1);a.putContentOntoCurrentPage(c,{point:b,select:!0});let e=a.getSelectionPageBounds();d&&e&&d?.collides(e)&&(a.updateInstanceState({isChangingStyle:!0}),a.timers.setTimeout(()=>{a.updateInstanceState({isChangingStyle:!1})},150))})}async function Od(a,{point:b,content:c}){a.run(()=>{KG(a,c,b)})}async function Oe(a,b,c,d,e){let f=a.type;"video/quicktime"===a.type&&(f="video/mp4");let g=c?await cB.getImageSize(a):await cB.getVideoSize(a),h=await cB.isAnimated(a)||d,i={id:b,type:c?"image":"video",typeName:"asset",props:{name:a.name,src:"",w:g.w,h:g.h,fileSize:a.size,mimeType:f,isAnimated:h},meta:{}};if(e&&isFinite(e)){var j;let b,c,d={w:i.props.w,h:i.props.h},f=(j={w:e,h:e},b=d.w/j.w,c=d.h/j.h,b<=1&&c<=1?d:b>c?{w:d.w/b,h:d.h/b}:{w:d.w/c,h:d.h/c});d!==f&&cB.isStaticImageType(a.type)&&(i.props.w=f.w,i.props.h=f.h)}return i}async function Of(a,b,c){if(!b.length)return[];let d=iK.From(c),e=[];for(let a=0;a<b.length;a++){let c=b[a];switch(c.type){case"image":e.push({id:gi(),type:"image",x:d.x,y:d.y,opacity:1,props:{assetId:c.id,w:c.props.w,h:c.props.h}}),d.x+=c.props.w;break;case"video":e.push({id:gi(),type:"video",x:d.x,y:d.y,opacity:1,props:{assetId:c.id,w:c.props.w,h:c.props.h}}),d.x+=c.props.w}}return a.run(()=>{let d=b.filter(b=>!a.getAsset(b.id));a.store.atomic(()=>{a.canCreateShapes(e)&&(d.length&&a.createAssets(d),a.createShapes(e).select(...e.map(a=>a.id)),function(a,b){let c=a.getViewportPageBounds(),d=a.getSelectionPageBounds();if(d){let c=d.center.sub(b);a.updateShapes(a.getSelectedShapes().map(b=>{let d=a.getShapeParentTransform(b).decompose().rotation,e=iK.Rot(c,-d);return{id:b.id,type:b.type,x:b.x-e.x,y:b.y-e.y}}))}if((d=a.getSelectionPageBounds())&&a.getInstanceState().isGridMode){let b=a.getDocumentSettings().gridSize,c=new iK(d.minX,d.minY),e=c.clone().snapToGrid(b),f=iK.Sub(c,e);a.updateShapes(a.getSelectedShapes().map(a=>{let b={x:a.x-f.x,y:a.y-f.y};return{id:a.id,type:a.type,x:b.x,y:b.y}}))}(d=a.getSelectionPageBounds())&&!c.contains(d)&&a.zoomToSelection({animation:{duration:a.options.animationMediumMs}})}(a,c))})}),e.map(a=>a.id)}function Og(a,b){let{acceptedImageMimeTypes:c=cz,acceptedVideoMimeTypes:d=cA,maxAssetSize:e=0xa00000,toasts:f,msg:g}=b,h=c.includes(a.type),i=d.includes(a.type);return h||i?a.size>e?(f.addToast({title:g("assets.files.size-too-big"),description:g("assets.files.maximum-size").replace("{size}",(a=>{if(0===a)return"0 bytes";let b=Math.floor(Math.log(a)/Math.log(1024)),c=a/Math.pow(1024,b),d=c%1==0?c.toString():c.toFixed(1);return`${d} ${["bytes","KB","MB","GB","TB","PB"][b]}`})(e)),severity:"error"}),!1):!!a.type||(f.addToast({title:g("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1):(f.addToast({title:g("assets.files.type-not-allowed"),severity:"error"}),!1)}async function Oh(a,b,c){let{acceptedImageMimeTypes:d=cz,acceptedVideoMimeTypes:e=cA,maxImageDimension:f=5e3}=b,g=d.includes(a.type),h=e.includes(a.type),i=cq(await a.arrayBuffer());return c??=hz.createId(i),await Oe(a,c,g,h,f)}class Oi extends pd{static id="idle";isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(a){this.parent.transition("pointing",{...a,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){Kf(this.editor),null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(a){if(this.update(),"Enter"===a.key){let a=this.editor.getOnlySelectedShape();this.editor.canEditShape(a)&&z9(this.editor,a,{selectAll:!0})}}update(){let a=this.editor.getShapeUtil("arrow"),b=Kg({editor:this.editor,pointInPageSpace:this.editor.inputs.getCurrentPagePoint(),arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});b&&b.target.id!==this.preciseTargetId?(null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=b.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},a.options.hoverPreciseTimeout)):!b&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId))}}class Oj extends pd{static id="pointing";shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(a){(this.markId="",this.isPrecise=!!a.isPrecise,Kg({editor:this.editor,pointInPageSpace:this.editor.inputs.getCurrentPagePoint(),arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0})||(this.createArrowShape(),this.shape))?this.startPreciseTimeout():this.cancel()}onExit(){this.shape=void 0,Kf(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.getIsDragging()){if(this.shape||this.createArrowShape(),!this.shape)return void this.cancel();this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){let a=this.editor.inputs.getOriginPagePoint(),b=gi();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${b}`);let c=ss(a,this.editor);this.editor.createShape({id:b,type:"arrow",x:c.x,y:c.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let d=this.editor.getShape(b);if(!d)return;let e=this.editor.getShapeHandles(d);if(!e)throw Error("expected handles for arrow");let f=this.editor.getShapeUtil("arrow"),g=this.shape,h=e.find(a=>"start"===a.id),i=f.onHandleDrag?.(d,{handle:{...h,x:0,y:0},isPrecise:!0,isCreatingShape:!0,initial:g});i&&this.editor.updateShapes([i]),this.shape=this.editor.getShape(b),this.editor.select(b)}updateArrowShapeEndHandle(){let a=this.shape;if(!a)throw Error("expected shape");let b=this.editor.getShapeHandles(a);if(!b)throw Error("expected handles for arrow");{let c=this.editor.getShapeUtil("arrow"),d=this.shape,e=b.find(a=>"start"===a.id),f=c.onHandleDrag?.(a,{handle:{...e,x:0,y:0},isPrecise:this.isPrecise,isCreatingShape:!0,initial:d});f&&this.editor.updateShapes([f])}{let c=this.editor.getShapeUtil("arrow"),d=this.shape,e=this.editor.getPointInShapeSpace(a,this.editor.inputs.getCurrentPagePoint()),f=b.find(a=>"end"===a.id),g=c.onHandleDrag?.(this.editor.getShape(a),{handle:{...f,x:e.x,y:e.y},isPrecise:this.isPrecise,isCreatingShape:!0,initial:d});g&&this.editor.updateShapes([g])}this.shape=this.editor.getShape(a.id)}startPreciseTimeout(){let a=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},a.options.pointingPreciseTimeout)}clearPreciseTimeout(){null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}}class Ok extends pd{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;currentSegmentPoints=[];markId=null;onEnter(a){this.markId=null,this.info=a,this.lastRecordedPoint=this.editor.inputs.getCurrentPagePoint().clone(),this.startShape()}onPointerMove(){let{inputs:a}=this.editor,b=a.getIsPen();if(this.isPen&&!b&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}if(this.isPenOrStylus){let b=a.getCurrentPagePoint();iK.Dist(b,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=b.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0}else this.mergeNextPoint=!1;this.updateDrawingShape()}onKeyDown(a){if("Shift"===a.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.getCurrentPagePoint().clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(a){if("Shift"===a.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.getCurrentPagePoint().clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.getCurrentPagePoint().clone()}canClose(){return"highlight"!==this.shapeType}getIsClosed(a,b,c){if(!this.canClose())return!1;let d=KB[b],e=hM.decodeFirstPoint(a[0].path),f=a[a.length-1],g=hM.decodeLastPoint(f.path);return null!==e&&null!==g&&e!==g&&this.currentLineLength>4*d*c&&iK.DistMin(e,g,2*d*c)}startShape(){let a=this.editor.inputs,b=a.getOriginPagePoint(),c=a.getIsPen();this.markId=this.editor.markHistoryStoppingPoint("draw start");let{z:d=.5}=this.info.point;this.isPen=c,this.isPenOrStylus=c||d>0&&d<.5||d>.5&&d<1;let e=this.isPenOrStylus?1.25*d:.5;if(this.segmentMode=this.editor.inputs.getShiftKey()?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=b.clone(),this.initialShape){let a=this.editor.getShape(this.initialShape.id);if(a&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let c=b5(a.props.segments);if(!c)throw Error("Expected a previous segment!");let d=hM.decodeLastPoint(c.path);if(!d)throw Error("Expected a previous point!");let{x:f,y:g}=this.editor.getPointInShapeSpace(a,b).toFixed(),h={type:this.segmentMode,path:hM.encodePoints([{x:d.x,y:d.y,z:+e.toFixed(2)},{x:f,y:g,z:+e.toFixed(2)}])},i=ku.applyToPoint(this.editor.getShapePageTransform(a.id),d);this.pagePointWhereCurrentSegmentChanged=i,this.pagePointWhereNextSegmentChanged=null;let j=[...a.props.segments,h];this.currentLineLength<4*KB[a.props.size]&&(this.currentLineLength=this.getLineLength(j));let k={id:a.id,type:this.shapeType,props:{segments:j}};this.canClose()&&(k.props.isClosed=this.getIsClosed(j,a.props.size,a.props.scale)),this.editor.updateShapes([k]);return}}this.pagePointWhereCurrentSegmentChanged=b.clone();let f=gi(),g=new iK(0,0,+e.toFixed(2));(this.currentSegmentPoints=[g],this.editor.createShape({id:f,type:this.shapeType,x:b.x,y:b.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,path:hM.encodePoints([g])}]}}),this.editor.getShape(f))?(this.currentLineLength=0,this.initialShape=this.editor.getShape(f)):this.cancel()}updateDrawingShape(){let{initialShape:a}=this,{inputs:b}=this.editor;if(!a)return;let{id:c,props:{size:d,scale:e}}=a,f=this.editor.getShape(c);if(!f)return;let{segments:g}=f.props,h=b.getCurrentPagePoint(),{x:i,y:j,z:k}=this.editor.getPointInShapeSpace(f,h).toFixed(),l={x:i,y:j,z:this.isPenOrStylus?+(1.25*h.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:a}=this;if(null===a)throw Error("We should have a point where the segment changed");if(iK.Dist2(a,b.getCurrentPagePoint())>this.editor.options.dragDistanceSquared){let a;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let b=b5(g);if(!b)throw Error("Expected a previous segment!");let h=hM.decodeLastPoint(b.path);if(!h)throw Error("Expected a previous last point!");let i=this.editor.getPointInShapeSpace(f,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===b.type){this.currentLineLength+=iK.Dist(h,i),a={type:"straight",path:hM.encodePoints([h,i])};let b=this.editor.getShapePageTransform(f);this.pagePointWhereCurrentSegmentChanged=ku.applyToPoint(b,h)}else a={type:"straight",path:hM.encodePoints([i,l])};let j={id:c,type:this.shapeType,props:{segments:[...g,a]}};this.canClose()&&(j.props.isClosed=this.getIsClosed(g,d,e)),this.editor.updateShapes([j])}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:a}=this;if(null===a)throw Error("We should have a point where the segment changed");if(iK.Dist2(a,b.getCurrentPagePoint())>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let a=g.slice(),b=a[a.length-1],h=hM.decodeLastPoint(b.path);if(!h)throw Error("No previous point!");let i=iK.PointsBetween(h,l,6).map(a=>new iK(i6(a.x),i6(a.y),i6(a.z)));this.currentSegmentPoints=i;let j=[...a,{type:"free",path:hM.encodePoints(i)}];this.currentLineLength<4*KB[f.props.size]&&(this.currentLineLength=this.getLineLength(j));let k={id:c,type:this.shapeType,props:{segments:j}};this.canClose()&&(k.props.isClosed=this.getIsClosed(j,d,e)),this.editor.updateShapes([k])}break}case"straight":{let a,b,h=g.slice(),i=h[h.length-1],{pagePointWhereCurrentSegmentChanged:j}=this,k=this.editor.inputs,l=k.getCtrlKey(),m=k.getCurrentPagePoint();if(!j)throw Error("We should have a point where the segment changed");let n=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.getIsDragging()&&(n=!l,this.didJustShiftClickToExtendPreviousShapeLine=!1):n=!l;let o=this.editor.getPointInShapeSpace(f,m).toFixed().toJson(),p=!1;if((this.editor.user.getIsSnapMode()?!l:l)&&h.length>2){let a,c=8/this.editor.getZoomLevel();for(let d=0,e=g.length-2;d<e;d++){let e=g[d];if(!e)break;if("free"===e.type)continue;let f=hM.decodeFirstPoint(e.path),h=hM.decodeLastPoint(e.path);if(!(f&&h))continue;let i=iK.NearestPointOnLineSegment(f,h,o);if(iK.DistMin(i,o,c)){a=i.toFixed().toJson(),c=iK.Dist(i,o),b=e;break}}a&&(p=!0,o=a)}if(p&&b){let a=this.editor.getShapePageTransform(f),c=hM.decodeFirstPoint(b.path),d=hM.decodeLastPoint(b.path);if(!c||!d)throw Error("Expected a last point!");let e=ku.applyToPoint(a,c),g=ku.applyToPoint(a,d),h=ku.applyToPoint(a,o);this.editor.snaps.setIndicators([{id:cs(void 0),type:"points",points:[e,h,g]}])}else{if(this.editor.snaps.clearIndicators(),n){let b=iK.Angle(j,m),c=i$(b,24);a=iK.RotWith(m,j,c-b)}else a=m.clone();o=this.editor.getPointInShapeSpace(f,a).toFixed().toJson()}this.currentLineLength+=h.length&&hM.decodeFirstPoint(i.path)?iK.Dist(hM.decodeFirstPoint(i.path),iK.From(o)):0,h[h.length-1]={...i,type:"straight",path:hM.encodePoints([hM.decodeFirstPoint(i.path),iK.From(o)])};let q={id:c,type:this.shapeType,props:{segments:h}};this.canClose()&&(q.props.isClosed=this.getIsClosed(g,d,e)),this.editor.updateShapes([q]);break}case"free":{let a=this.currentSegmentPoints;if(a.length&&this.mergeNextPoint){let b=a[a.length-1];b.x=l.x,b.y=l.y,b.z=b.z?Math.max(b.z,l.z):l.z}else this.currentLineLength+=a.length?iK.Dist(a[a.length-1],l):0,a.push(new iK(l.x,l.y,l.z));let h=g.slice(),i=h[h.length-1];h[h.length-1]={...i,path:hM.encodePoints(a)},this.currentLineLength<4*KB[f.props.size]&&(this.currentLineLength=this.getLineLength(h));let j={id:c,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(j.props.isClosed=this.getIsClosed(h,d,e)),this.editor.updateShapes([j]),a.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:c,type:this.shapeType,props:{isComplete:!0}}]);let a=gi(),d=this.editor.getShape(c).props;if(!this.editor.canCreateShapes([a]))return this.cancel();let e=b.getCurrentPagePoint(),f=new iK(0,0,this.isPenOrStylus?+(1.25*k).toFixed():.5);this.currentSegmentPoints=[f],this.editor.createShape({id:a,type:this.shapeType,x:i6(e.x),y:i6(e.y),props:{isPen:this.isPenOrStylus,scale:d.scale,segments:[{type:"free",path:hM.encodePoints([f])}]}});let g=this.editor.getShape(a);if(!g)return this.cancel();this.initialShape=dk(g),this.mergeNextPoint=!1,this.lastRecordedPoint=e.clone(),this.currentLineLength=0}}}}getLineLength(a){let b=0;for(let c=0;c<a.length;c++){let d=hM.decodePoints(a[c].path);for(let a=0;a<d.length-1;a++)b+=iK.Dist2(d[a],d[a+1])}return Math.sqrt(b)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.getIsDragging()||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){let{initialShape:a}=this;a&&(this.editor.updateShapes([{id:a.id,type:a.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}class Ol extends pd{static id="idle";onPointerDown(a){this.parent.transition("drawing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class Om extends pd{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(a){let{editor:b}=this;if("Enter"===a.key){let a=b.getOnlySelectedShape();b.canEditShape(a)&&z9(b,a,{selectAll:!0})}}onCancel(){this.editor.setCurrentTool("select")}}class On extends pd{static id="pointing";onPointerUp(){this.complete()}onPointerMove(a){if(this.editor.inputs.getIsDragging()){let b=this.editor.inputs.getOriginPagePoint(),c=gi(),d=this.editor.markHistoryStoppingPoint(`creating_geo:${c}`),e=ss(b,this.editor);if(this.editor.createShapes([{id:c,type:"geo",x:e.x,y:e.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(h$),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(c),!this.editor.getShape(c))return void this.cancel();this.editor.setCurrentTool("select.resizing",{...a,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:d,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){let a=this.editor.inputs.getOriginPagePoint(),b=gi();this.editor.markHistoryStoppingPoint(`creating_geo:${b}`);let c=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,d=this.editor.getStyleForNextShape(h$);this.editor.createShapes([{id:b,type:"geo",x:a.x,y:a.y,props:{geo:this.editor.getStyleForNextShape(h$),scale:c,..."star"===d?{w:200,h:190}:"cloud"===d?{w:300,h:180}:{w:200,h:200}}}]);let e=this.editor.getShape(b);if(!e)return void this.cancel();let{w:f,h:g}=e.props,h=new iK(f/2,g/2).mul(c),i=this.editor.getShapeParentTransform(e);i&&h.rot(-i.rotation());let j=ss(new iK(e.x-h.x,e.y-h.y),this.editor);this.editor.select(b),this.editor.updateShape({id:e.id,type:"geo",x:j.x,y:j.y,props:{geo:this.editor.getStyleForNextShape(h$),w:f*c,h:g*c}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}class Oo extends pd{static id="idle";shapeId="";onEnter(a){this.shapeId=a.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}}class Op extends pd{static id="pointing";shape={};markId;onEnter(a){let{inputs:b}=this.editor,c=b.getCurrentPagePoint();this.markId=void 0;let d=a.shapeId&&this.editor.getShape(a.shapeId);if(d&&b.getShiftKey()){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${d.id}`),this.shape=d;let a=this.editor.getShapeHandles(this.shape);if(!a)return;let b=a.filter(a=>"vertex"===a.type).sort(c6),e=b[b.length-1],f=b[b.length-2],g=ku.applyToPoint(this.editor.getShapeParentTransform(this.shape),new iK(this.shape.x,this.shape.y)),h=ss(iK.Sub(c,g).addXY(.1,.1),this.editor),i=dk(this.shape.props.points);if(iK.DistMin(e,f,2)||iK.DistMin(h,e,2))i[e.id]={id:e.id,index:e.index,x:h.x,y:h.y};else{let a=c4(e.index);i[a]={id:a,index:a,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:i}}])}else{let a=gi();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${a}`);let b=ss(c,this.editor);if(this.editor.createShapes([{id:a,type:"line",x:b.x,y:b.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(a))return void this.cancel();this.editor.select(a),this.shape=this.editor.getShape(a)}}onPointerMove(){if(this.shape&&this.editor.inputs.getIsDragging()){let a=this.editor.getShapeHandles(this.shape);if(!a)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let b=b5(a);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...b,x:b.x-.1,y:b.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}}class Oq extends pd{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}let Or=new iK(100,100);function Os(a,b,c,d,e,f){return Object.fromEntries((function(a,b){if(1===b)return[[["a1"],new iK(100,-100-a.options.adjacentShapeMargin)],[["a2"],new iK(300+a.options.adjacentShapeMargin,100)],[["a3"],new iK(100,300+a.options.adjacentShapeMargin)],[["a4"],new iK(-100-a.options.adjacentShapeMargin,100)]];let c=200*b,d=a.options.adjacentShapeMargin*b;return[[["a1"],new iK(.5*c,-.5*c-d)],[["a2"],new iK(1.5*c+d,.5*c)],[["a3"],new iK(.5*c,1.5*c+d)],[["a4"],new iK(-.5*c-d,.5*c)]]})(a,f).map(([a,f],g)=>{let h=f.clone();return 0===g&&e?h.y-=e:2===g&&d&&(h.y+=d),[a,h.rot(c).add(b)]}))}function Ot(a,b,c,d){let e,f=new Set(a.getSelectedShapeIds()),g=(200+a.options.adjacentShapeMargin+d)**2,h=new Map,i=[];for(let e of a.getCurrentPageShapes()){if(!a.isShapeOfType(e,"note")||c!==e.props.scale||f.has(e.id))continue;let g=a.getShapePageTransform(e.id);b===g.rotation()&&(h.set(e,a.getShapePageBounds(e).center),i.push(...Object.values(Os(a,g.point(),b,e.props.growY,d,c))))}let j=i.length;for(let[b,c]of h)for(let d=0;d<j;d++)(e=i[d])&&!(iK.Dist2(c,e)>g)&&a.isPointInShape(b,e)&&(i[d]=void 0);return b4(i)}function Ou(a,b,c,d,e=!1){let f,g=a.getCurrentPageShapesSorted(),h=(200+a.options.adjacentShapeMargin**2)**b.props.scale;for(let d=g.length-1;d>=0;d--){let e=g[d];if("note"===e.type&&e.id!==b.id){let b=a.getShapePageBounds(e);if(b&&iK.Dist2(b.center,c)<h&&a.isPointInShape(e,c)){f=e;break}}}if(a.complete(),!f||e){a.markHistoryStoppingPoint("creating note shape");let e=gi();a.createShape({id:e,type:"note",x:c.x,y:c.y,rotation:d,opacity:b.opacity,props:{...b.props,richText:gb(""),growY:0,fontSizeAdjustment:0,url:""}});let g=a.getShape(e);if(!g)return;let h=a.getPointInParentSpace(g,iK.Sub(c,iK.Rot(Or.clone().mul(g.props.scale),d)));a.updateShape({id:e,type:"note",x:h.x,y:h.y}),f=a.getShape(e)}return a.zoomToSelectionIfOffscreen(16,{animation:{duration:a.options.animationMediumMs},inset:0}),f}class Ov extends pd{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){let{editor:a}=this,b=gi();this.markId=a.markHistoryStoppingPoint(`creating_note:${b}`);let c=this.editor.inputs.getOriginPagePoint().clone(),d=function(a,b,c){let d,e=10/a.getZoomLevel();for(let f of Ot(a,0,c,0)){let a=iK.Sub(b,f),c=a.len();c<e&&(e=c,d=a)}return d}(this.editor,c,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);d&&c.sub(d);let e=function(a,b,c){a.createShape({id:b,type:"note",x:c.x,y:c.y,props:{scale:a.user.getIsDynamicResizeMode()?1/a.getZoomLevel():1}});let d=a.getShape(b);if(!d)return;a.select(b);let e=a.getShapeGeometry(d).bounds,f=ss(new iK(d.x-e.width/2,d.y-e.height/2),a);return a.updateShapes([{id:b,type:"note",x:f.x,y:f.y}]),a.getShape(b)}(this.editor,b,c);e?this.shape=e:this.cancel()}onPointerMove(a){this.editor.inputs.getIsDragging()&&this.editor.setCurrentTool("select.translating",{...a,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{z9(this.editor,this.shape.id)}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):z9(this.editor,this.shape.id,{info:this.info})}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}var zZ=b1;let Ow=new WeakMap;function Ox(a){let b=a.getShapeAtPoint(a.inputs.getCurrentPagePoint(),{hitInside:!1,hitLabels:!1,margin:a.options.hitTestMargin/a.getZoomLevel(),renderingOnly:!0});if(!b)return null;let c=a.getOutermostSelectableShape(b);return(c===b||c.id===a.getFocusedGroupId()||a.getSelectedShapeIds().includes(c.id)?b:c).id}let Oy=(0,zZ.default)(function(a){if("moving"!==a.getCameraState()){Ow.set(a,!1);let b=Ox(a);return a.setHoveredShape(b)}if(Ow.get(a))return;let b=a.getHoveredShapeId();b?Ox(a)!==b&&(a.setHoveredShape(null),Ow.set(a,!0)):Ow.set(a,!0)},32);class Oz extends pd{static id="idle";onPointerMove(a){switch(a.target){case"shape":case"canvas":Oy(this.editor)}}onPointerDown(a){this.parent.transition("pointing",a)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){Oy.cancel()}onKeyDown(a){if("Enter"===a.key){let b=this.editor.getOnlySelectedShape();this.editor.canEditShape(b)&&(this.editor.setCurrentTool("select"),z9(this.editor,b.id,{info:a}))}}onCancel(){this.editor.setCurrentTool("select")}}class OA extends pd{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(a){if(Date.now()-this.enterTime<150)return;let{editor:b}=this;if(!b.inputs.getIsPointing())return;let c=b.inputs.getOriginPagePoint(),d=b.inputs.getCurrentPagePoint(),e=Math.abs(c.x-d.x);if(e>6*Math.sqrt(b.getInstanceState().isCoarsePointer?b.options.coarseDragDistanceSquared:b.options.dragDistanceSquared)/b.getZoomLevel()){let d=gi();this.markId=b.markHistoryStoppingPoint(`creating_text:${d}`);let f=this.createTextShape(d,c,!1,e);if(!f)return void this.cancel();this.shape=b.getShape(f),b.select(d);let g=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;b.setCurrentTool("select.resizing",{...a,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:e*g,y:1},onInteractionEnd:"text",onCreate:()=>{z9(b,f.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");let a=gi(),b=this.editor.inputs.getOriginPagePoint();this.createTextShape(a,b,!0,20)&&(this.editor.select(a),z9(this.editor,a))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(a,b,c,d){this.editor.createShape({id:a,type:"text",x:b.x,y:b.y,props:{richText:gb(""),autoSize:c,w:d,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let e=this.editor.getShape(a);if(!e)return void this.cancel();let f=this.editor.getShapePageBounds(e),g=new iK;if(c)switch(e.props.textAlign){case"start":g.x=0;break;case"middle":g.x=-f.width/2;break;case"end":g.x=-f.width}else g.x=0;if(g.y=-f.height/2,gh(e.parentId)){let a=this.editor.getShapeParentTransform(e);g.rot(-a.rotation())}let h=e.x+g.x,i=e.y+g.y;if(this.editor.getInstanceState().isGridMode){let a=new iK(h,i),b=ss(a,this.editor),c=iK.Sub(a,b);this.editor.updateShape({...e,x:h-c.x,y:i-c.y})}else this.editor.updateShape({...e,x:h,y:i});return e}}let OB=[class extends pd{static id="text";static initial="idle";static children(){return[Oz,OA]}shapeType="text"},class extends pd{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[Ol,Ok]}shapeType="draw";onExit(){this.children.drawing.initialShape=void 0}},class extends pd{static id="geo";static initial="idle";static children(){return[Om,On]}shapeType="geo"},class extends pd{static id="note";static initial="idle";static children(){return[Oq,Ov]}shapeType="note"},class extends pd{static id="line";static initial="idle";static children(){return[Oo,Op]}shapeType="line"},class extends st{static id="frame";static initial="idle";shapeType="frame";onCreate(a){if(!a)return;let b=this.editor.getShapePageBounds(a),c=[],d=this.editor.getShapeAncestors(a).map(a=>a.id);this.editor.getSortedChildIdsForParent(a.parentId).map(e=>{var f,g,h;let i=this.editor.getShape(e);if(!i||i.id===a.id||i.isLocked)return;let j=this.editor.getShapePageBounds(i);j&&b.contains(j)&&(f=i,g=d,h=a,!g.includes(f.id)&&f.parentId===h.parentId)&&c.push(i.id)}),this.editor.reparentShapes(c,a.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}},class extends pd{static id="arrow";static initial="idle";static children(){return[Oi,Oj]}shapeType="arrow"},class extends pd{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[Ol,Ok]}static isLockable=!1;shapeType="highlight";onExit(){this.children.drawing.initialShape=void 0}}];var zY=b_;let OC=bT.default.forwardRef(function({shapeId:a,isEditing:b,richText:c,handleFocus:d,handleChange:e,handleBlur:f,handleKeyDown:g,handleDoubleClick:h,hasCustomTabBehavior:i,handlePaste:j},k){let l=jA(),m=ju("tip-tap-editor"),n=l.getTextOptions().tipTapConfig,o=(0,bT.useRef)(c),p=(0,bT.useRef)(null),q=(0,bT.useRef)(null);(0,bT.useLayoutEffect)(()=>{p.current?(0,zY.default)(o.current,c)||p.current.commands.setContent(c):o.current=c},[c]);let r=(0,bT.useRef)({selectAll:!1,caretPosition:null});(0,bT.useLayoutEffect)(()=>{function a(a){a.shapeId===l.getEditingShapeId()&&(r.current.selectAll=!0)}function b(a){a.shapeId===l.getEditingShapeId()&&(r.current.caretPosition=a.point)}return l.on("select-all-text",a),l.on("place-caret",b),()=>{l.off("select-all-text",a),l.off("place-caret",b)}},[l,b]);let s=lP(e),t=lP(g),u=lP(d),v=lP(f),w=lP(h),y=lP(j);return((0,bT.useLayoutEffect)(()=>{if(!b||!n||!q.current)return;let{editorProps:c,...d}=n,e=new zG({element:q.current,autofocus:!0,editable:b,onUpdate:a=>{let b=a.editor.state.doc.toJSON();o.current=b,s({richText:b})},onFocus:u,onBlur:v,onCreate:b=>{if(l.getEditingShapeId()!==a)return;let c=b.editor;l.setRichTextEditor(c);let{selectAll:d,caretPosition:e}=r.current;if(d)c.chain().focus().selectAll().run();else if(e){let a=c.view.posAtCoords({left:e.x,top:e.y})?.pos;a?c.chain().focus().setTextSelection(a).run():c.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(a,b)=>{i||"Tab"!==b.key||function(a,b,c){c.preventDefault();let d=a.getRichTextEditor();if(d?.isActive("bulletList")||d?.isActive("orderedList"))return;let{state:e,dispatch:f}=b,{$from:g,$to:h}=e.selection,i=c.shiftKey,j=e.tr,k=h.end();for(;k>=g.start();){let a=e.doc.resolve(k).blockRange();if(!a)break;let b=a.start,c=a.end,d=e.doc.textBetween(b,c,"\n"),f=!1;e.doc.nodesBetween(b,c,a=>{if("bulletList"===a.type.name||"orderedList"===a.type.name)return f=!0,!1}),!f&&(i?d.startsWith("	")&&(j=j.delete(b+1,b+2)):j=j.insertText("	",b+1)),k=b-1}let l=e.selection.map(j.doc,j.mapping);j.setSelection(l),j.docChanged&&f(j)}(l,a,b),t(b)},handlePaste:(a,b)=>{if(y(b),b.defaultPrevented)return!0},handleDoubleClick:(a,b,c)=>w(c),...c},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:"\n"}},enableCoreExtensions:{textDirection:!1},textDirection:"auto",...d,content:o.current}),f=l.timers.setTimeout(()=>{r.current.caretPosition||r.current.selectAll?e.commands.focus():e.commands.focus("end"),r.current.selectAll=!1,r.current.caretPosition=null},100);return p.current=e,()=>{p.current=null,clearTimeout(f),e.destroy()}},[b,n,u,v,w,s,y,t,l,a,i]),b&&n)?(0,bS.jsx)("div",{id:m,ref:k,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:b?a=>a.stopPropagation():void 0,onPointerDownCapture:a=>a.stopPropagation(),onTouchEnd:a=>a.stopPropagation(),onDragStart:jm,children:(0,bS.jsx)("div",{className:"tl-rich-text",ref:q})}):null});function OD(a){return"start-legacy"===a||"middle-legacy"===a||"end-legacy"===a}function OE(a,b){return d8("isReadyForEditing",()=>{let c=a.getEditingShapeId();return null!==c&&(c===b||a.getHoveredShapeId()===b)},[a,b])}function OF(a){let b=jA(),c=d8("isEditing",()=>b.getEditingShapeId()===a,[b]),d=OE(b,a),e=(0,bT.useCallback)(c=>{b.dispatch({...js(b,c),type:"pointer",name:"pointer_down",target:"shape",shape:b.getShape(a)}),c.stopPropagation()},[b,a]),f=(0,bT.useCallback)(c=>{if(b.getEditingShapeId()===a&&c.clipboardData){let a=c.clipboardData.getData("text/html");a&&a.includes("<div data-tldraw")&&jm(c)}},[b,a]);return{handleFocus:ca,handleBlur:ca,handleInputPointerDown:e,handleDoubleClick:b.markEventAsHandled,handlePaste:f,isEditing:c,isReadyForEditing:d}}let OG=bT.default.memo(function({shapeId:a,type:b,richText:c,labelColor:d,font:e,fontSize:f,lineHeight:g,align:h,verticalAlign:i,wrap:j,isSelected:k,padding:l=0,onKeyDown:m,classNamePrefix:n,style:o,textWidth:p,textHeight:q,hasCustomTabBehavior:r,showTextOutline:s=!0}){let t,u,v,w,y,z=jA(),A=bT.default.useRef(!1),{rInput:B,isEmpty:C,isEditing:D,isReadyForEditing:E,...F}=(u=(t=OF(a)).isEditing,v=jA(),w=(0,bT.useRef)(null),y=c&&NZ(c),(0,bT.useEffect)(()=>{if(!u)return;let a=w.current?.querySelector("[contenteditable]");a&&document.activeElement!==w.current&&a.focus()},[v,u]),{rInput:w,handleKeyDown:(0,bT.useCallback)(b=>{v.getEditingShapeId()===a&&"Enter"===b.key&&jr(b)&&v.complete()},[v,a]),handleChange:(0,bT.useCallback)(({richText:c})=>{v.getEditingShapeId()===a&&v.updateShape({id:a,type:b,props:{richText:c}})},[v,a,b]),isEmpty:y,...t}),G=(0,bT.useMemo)(()=>{if(c)return NW(z,c)},[z,c]),H=d8("isSelectToolActive",()=>"select"===z.getCurrentToolId(),[z]);d7("isDragging",()=>{z.getInstanceState(),A.current=z.inputs.getIsDragging()},[z]);let I=OD(h);if(!D&&C)return null;let J=n||"tl-text";return(0,bS.jsx)("div",{className:(0,jb.default)(`${J}-label tl-text-wrapper tl-rich-text-wrapper`,s?"tl-text__outline":"tl-text__no-outline"),"aria-hidden":!D,"data-font":e,"data-align":h,"data-hastext":!C,"data-isediting":D,"data-textwrap":!!j,"data-isselected":k,style:{justifyContent:"middle"===h||I?"center":h,alignItems:"middle"===i?"center":i,padding:l,...o},children:(0,bS.jsxs)("div",{className:`${J}-label__inner tl-text-content__wrapper`,style:{fontSize:f,lineHeight:g.toString(),minHeight:Math.floor(f*g)+"px",minWidth:Math.ceil(p||0),color:d,width:p?Math.ceil(p):void 0,height:q?Math.ceil(q):void 0},children:[(0,bS.jsx)("div",{className:`${J} tl-text tl-text-content`,dir:"auto",children:c&&(0,bS.jsx)("div",{className:"tl-rich-text","data-is-select-tool-active":H,dangerouslySetInnerHTML:{__html:G||""},onPointerDown:a=>{if(a.target instanceof HTMLElement&&("A"===a.target.tagName||a.target.closest("a"))){if(jm(a),!H)return;let b=a.target.closest("a")?.getAttribute("href")??"",c=a=>{"pointer_up"===a.name&&b&&(A.current||zX(b,"_blank",!1),z.off("event",c))};z.on("event",c)}},"data-is-ready-for-editing":E})}),(E||k)&&(0,bS.jsx)(OC,{ref:B,richText:c,isEditing:D,shapeId:a,...F,hasCustomTabBehavior:r,handleKeyDown:m??F.handleKeyDown})]})})});function OH({bounds:a,richText:b,fontSize:c,font:d,align:e,verticalAlign:f,wrap:g,labelColor:h,padding:i,showTextOutline:j=!0}){let k=NW(jA(),b),l={display:"flex",fontFamily:gy[d],height:"100%",justifyContent:"middle"===e?"center":"start"===e?"flex-start":"flex-end",alignItems:"middle"===f?"center":"start"===f?"flex-start":"flex-end",padding:`${i}px`},m={fontSize:`${c}px`,wrap:g?"wrap":"nowrap",color:h,lineHeight:KA.lineHeight,textAlign:"middle"===e?"center":"start"===e?"start":"end",width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:j?"var(--tl-text-outline)":"none",tabSize:"var(--tl-tab-size, 2)"};return(0,bS.jsx)("foreignObject",{x:a.minX,y:a.minY,width:a.w,height:a.h,className:(0,jb.default)("tl-export-embed-styles tl-rich-text tl-rich-text-svg",j?"tl-text__outline":"tl-text__no-outline"),children:(0,bS.jsx)("div",{style:l,children:(0,bS.jsx)("div",{dangerouslySetInnerHTML:{__html:k},style:m})})})}function OI(a){return{key:`${gx.id}:${a}`,getElement:async()=>"pattern"!==a?null:(0,bS.jsx)(OJ,{})}}function OJ(){let a=OP(),b=ju(),c=Hq(),d=8/12;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)("mask",{id:b,children:[(0,bS.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,bS.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,bS.jsx)("line",{x1:+d,y1:3*d,x2:3*d,y2:+d}),(0,bS.jsx)("line",{x1:5*d,y1:7*d,x2:7*d,y2:5*d}),(0,bS.jsx)("line",{x1:9*d,y1:11*d,x2:11*d,y2:9*d})]})]}),(0,bS.jsx)("pattern",{id:a(1,c.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,bS.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:c.solid,mask:`url(#${b})`})})]})}function OK(){return{key:`${gx.id}:pattern`,component:OR}}let OL=(a,b,c)=>new Promise((d,e)=>{let f=8*b*a,g=document.createElement("canvas");g.width=f,g.height=f;let h=g.getContext("2d");if(!h)return;h.fillStyle=c?gp.solid:go.solid,h.fillRect(0,0,f,f),h.globalCompositeOperation="destination-out",h.lineCap="round",h.lineWidth=1.25*b*a;let i=8/12;h.beginPath(),h.moveTo(i*b*a,3*i*b*a),h.lineTo(3*i*b*a,i*b*a),h.moveTo(5*i*b*a,7*i*b*a),h.lineTo(7*i*b*a,5*i*b*a),h.moveTo(9*i*b*a,11*i*b*a),h.lineTo(11*i*b*a,9*i*b*a),h.stroke(),g.toBlob(a=>{!a||ji.throwToBlob.get()?e():d(a)})}),OM=(a,b)=>{let c=document.createElement("canvas");c.width=a[0],c.height=a[1];let d=c.getContext("2d");return d?(b(d),c.toDataURL()):""},ON=null;function OO(a){return Math.ceil(Math.log2(Math.max(1,a)))}function OP(){let a=jv("hash_pattern");return(0,bT.useCallback)((b,c)=>{let d=OO(b);return jt(a,`${c}_${d}`)},[a])}function OQ(a){let b=[],c=OO(a);for(let a=0;a<=c;a++)b.push(Math.pow(2,a));return b}function OR(){let a=jA(),b=(0,bT.useRef)(null),{defs:c,isReady:d}=function(){let a=jA(),b=d8("devicePixelRatio",()=>a.getInstanceState().devicePixelRatio,[a]),c=d8("maxZoom",()=>Math.ceil(b5(a.getCameraOptions().zoomSteps)),[a]),[d,e]=(0,bT.useState)(!1),[f,g]=(0,bT.useState)(()=>{let a;return ON||(ON={white:OM([1,1],a=>{a.fillStyle="#f8f9fa",a.fillRect(0,0,1,1)}),black:OM([1,1],a=>{a.fillStyle="#212529",a.fillRect(0,0,1,1)})}),a=ON,OQ(c).flatMap(b=>[{zoom:b,url:a.white,theme:"light"},{zoom:b,url:a.black,theme:"dark"}])}),h=OP();return(0,bT.useEffect)(()=>{let a=Promise.all(OQ(c).flatMap(a=>[OL(b,a,!1).then(b=>({zoom:a,theme:"light",url:URL.createObjectURL(b)})),OL(b,a,!0).then(b=>({zoom:a,theme:"dark",url:URL.createObjectURL(b)}))])),d=!1;return a.then(a=>{d||(g(a),e(!0))}),()=>{d=!0,e(!1),a.then(a=>{for(let{url:b}of a)URL.revokeObjectURL(b)})}},[b,c]),{defs:(0,bS.jsx)(bS.Fragment,{children:f.map(a=>{let b=h(a.zoom,a.theme);return(0,bS.jsx)("pattern",{id:b,width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,bS.jsx)("image",{href:a.url,width:8,height:8})},b)})}),isReady:d}}();return(0,bT.useEffect)(()=>{d&&0},[a,d]),(0,bS.jsx)("g",{ref:b,"data-testid":d?"ready-pattern-fill-defs":void 0,children:c})}let OS=bT.default.memo(function({theme:a,d:b,color:c,fill:d,scale:e}){switch(d){case"none":return null;case"solid":return(0,bS.jsx)("path",{fill:gu(a,c,"semi"),d:b});case"semi":return(0,bS.jsx)("path",{fill:a.solid,d:b});case"fill":return(0,bS.jsx)("path",{fill:gu(a,c,"fill"),d:b});case"pattern":return(0,bS.jsx)(OT,{theme:a,color:c,fill:d,d:b,scale:e});case"lined-fill":return(0,bS.jsx)("path",{fill:gu(a,c,"linedFill"),d:b})}});function OT({d:a,color:b,theme:c}){let d=jA(),e=lS(),f=d8("zoomLevel",()=>d.getEfficientZoomLevel(),[d]),g=OP(),h=f<=.18;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("path",{fill:gu(c,b,"pattern"),d:a}),(0,bS.jsx)("path",{fill:e?`url(#${g(1,c.id)})`:h?gu(c,b,"semi"):`url(#${g(f,c.id)})`,d:a})]})}function OU(a=.25){let b=jA();return d8("efficient zoom threshold",()=>b.getEfficientZoomLevel()<a,[b,a])}function OV(a){switch(a.type){case"straight":return new z3().moveTo(a.start.point.x,a.start.point.y,{offset:0,roundness:0}).lineTo(a.end.point.x,a.end.point.y,{offset:0,roundness:0});case"arc":return new z3().moveTo(a.start.point.x,a.start.point.y,{offset:0,roundness:0}).circularArcTo(a.bodyArc.radius,!!a.bodyArc.largeArcFlag,!!a.bodyArc.sweepFlag,a.end.point.x,a.end.point.y,{offset:0,roundness:0});case"elbow":{let b=new z3;b.moveTo(a.start.point.x,a.start.point.y,{offset:0});for(let c=1;c<a.route.points.length;c++){let d=a.route.points[c];a.route.skipPointsWhenDrawing.has(d)||b.lineTo(d.x,d.y,{offset:c===a.route.points.length-1?0:void 0})}return b}default:cc(a,"type")}}function OW(a,b){let c=Ff(a,b);switch(c.type){case"straight":return new kJ({start:iK.From(c.start.point),end:iK.From(c.end.point)});case"arc":return new sx({center:iK.Cast(c.handleArc.center),start:iK.Cast(c.start.point),end:iK.Cast(c.end.point),sweepFlag:c.bodyArc.sweepFlag,largeArcFlag:c.bodyArc.largeArcFlag});case"elbow":return new kK({points:c.route.points});default:cc(c,"type")}}a.i(183851);let OX=fe("arrow label size",(a,b)=>{a.fonts.trackFontsForShape(b);let c=0,d=0,e=OW(a,b),f=NX(a,NZ(b.props.richText)?gb("i"):b.props.richText),g=e.bounds,h=O0(b),{w:i,h:j}=a.textMeasure.measureHtml(f,{...KA,fontFamily:KF[b.props.font],fontSize:h,maxWidth:null});c=i,d=j;let k=!1,l=Ff(a,b),m=OZ(b),n="elbow"===l.type?Math.max(l.elbow.A.arrowheadOffset+m,32)+Math.max(l.elbow.B.arrowheadOffset+m,32):64;if(g.width>g.height?(c=Math.max(Math.min(i,n),Math.min(g.width-n,i)),k=!0):c>16*h&&(c=16*h,k=!0),k){let{w:e,h:g}=a.textMeasure.measureHtml(f,{...KA,fontFamily:KF[b.props.font],fontSize:h,maxWidth:c});c=e,d=g}return new iK(c,d).addScalar(8.5*b.props.scale)},{areRecordsEqual:(a,b)=>{if(a.props===b.props)return!0;let c=function(a,b){let c=[];for(let d in a)Object.is(a[d],b[d])||c.push(d);return c}(a.props,b.props);return 1===c.length&&"labelPosition"===c[0]}});function OY(a,b){return OX.get(a,b.id)??new iK(0,0)}function OZ(a){let b=KB[a.props.size];return(20+(b-KB.s)*2+20*(b===KB.xl))*a.props.scale}function O$(a,b){if(a.getEditingShapeId()!==b.id&&NZ(b.props.richText)){let c=OW(a,b).interpolateAlongEdge(.5);return{box:kt.FromCenter(c,new iK(0,0)),debugGeom:[]}}let c=[],d=Ff(a,b),e={hasStartBinding:!!d.bindings.start,hasEndBinding:!!d.bindings.end,hasStartArrowhead:"none"!==d.start.arrowhead,hasEndArrowhead:"none"!==d.end.arrowhead},f=function(a,b,c){let d,e,f=OW(a,b),g=[],h=[new kI({children:[f],debugColor:"lime"})],i=OY(a,b),j=OZ(b),k=j/f.length;if("elbow"===c.type)g.push(c.start.point,c.end.point),d=kt.FromCenter(c.start.point,i).expandBy(j),e=kt.FromCenter(c.end.point,i).expandBy(j);else{let a=f.interpolateAlongEdge(k),b=f.interpolateAlongEdge(1-k);g.push(a,b),d=kt.FromCenter(a,i),e=kt.FromCenter(b,i)}let l=f.intersectPolygon(d.corners),m=f.intersectPolygon(e.corners),n=O_(c.start.point,l),o=O_(c.end.point,m),p=n?f.uninterpolateAlongEdge(n):.5,q=o?f.uninterpolateAlongEdge(o):.5;for(let a of(p>q&&(p=.5,q=.5),[...l,...m,...g]))h.push(new sy({x:a.x-3,y:a.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return h.push(new kL({points:d.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new kL({points:e.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:p,end:q,dbg:h}}(a,b,d);f.dbg&&c.push(...f.dbg);let g=function(a,b,c){let{hasEndArrowhead:d,hasEndBinding:e,hasStartBinding:f,hasStartArrowhead:g}=c;return iS(a.props.labelPosition,g||f?b.start:0,d||e?b.end:1)}(b,f,e),h=OW(a,b).interpolateAlongEdge(g),i=OY(a,b);return{box:kt.FromCenter(h,i),debugGeom:c}}function O_(a,b){let c=null,d=-1/0;for(let e of b){let b=iK.Dist2(a,e);b>d&&(c=e,d=b)}return c}function O0(a){return KE[a.props.size]*a.props.scale}function O1(a,b){let c=Ff(a,b);switch(c.type){case"straight":case"arc":return .5;case"elbow":{let d=c.route.midpointHandle,e=OW(a,b);if(d&&e)return e.uninterpolateAlongEdge(d.point);return .5}default:cc(c,"type")}}function O2(a,b){if(!a.isShapeOfType(b,"arrow"))return!1;let c=a.getPointInShapeSpace(b,a.inputs.getCurrentPagePoint()),d=a.getShapeGeometry(b).children[1];return d&&i4(c,d.vertices)}function O3(a,b,c){let d="end"===b?a.end.arrowhead:a.start.arrowhead;if("none"===d)return;let e=function(a,b,c){let d,e="end"===b?a.end.point:a.start.point;switch(a.type){case"straight":{let f="end"===b?a.start.point:a.end.point,g=iS(iK.Dist(f,e)/5,c,3*c);d=iK.Nudge(e,f,g);break}case"arc":{var f,g;let h,i,j,k,l,m=iS(Math.abs(a.bodyArc.length)/5,c,3*c),n=(f=a.handleArc.center,g=a.handleArc.radius,k=((j=Math.sqrt((h=f.x-e.x)*h+(i=f.y-e.y)*i))*j-g*g+m*m)/(2*j),l=Math.sqrt(m*m-k*k),h/=j,i/=j,[new iK(e.x+h*k-i*l,e.y+i*k+h*l),new iK(e.x+h*k+i*l,e.y+i*k-h*l)]);d="end"===b?a.handleArc.sweepFlag?n[0]:n[1]:a.handleArc.sweepFlag?n[1]:n[0];break}case"elbow":{let f="end"===b?a.route.points[a.route.points.length-2]:a.route.points[1],g=iS(iK.ManhattanDist(f,e)/2,c,3*c);d=f?iK.Nudge(e,f,g):e;break}default:cc(a,"type")}return iK.IsNaN(d)&&(d=e),{point:e,int:d}}(a,b,c);switch(d){case"bar":return function({int:a,point:b}){let c=iK.Sub(a,b).div(2),d=iK.Add(b,iK.Rot(c,iP)),e=iK.Sub(b,iK.Rot(c,iP));return`M ${d.x} ${d.y} L ${e.x} ${e.y}`}(e);case"square":return function({int:a,point:b}){let c=iK.Lrp(b,a,.85),d=iK.Sub(c,b).div(2),e=iK.Add(b,iK.Rot(d,iP)),f=iK.Sub(b,iK.Rot(d,iP)),g=iK.Add(c,iK.Rot(d,iP)),h=iK.Sub(c,iK.Rot(d,iP));return`M ${e.x} ${e.y} L ${g.x} ${g.y} L ${h.x} ${h.y} L ${f.x} ${f.y} Z`}(e);case"diamond":return function({point:a,int:b}){let c=iK.Lrp(a,b,.75),d=iK.RotWith(c,a,iO/4),e=iK.RotWith(c,a,-iO/4),f=iK.Lrp(d,e,.5);return f.add(iK.Sub(f,a)),`M ${f.x} ${f.y} L ${e.x} ${e.y} ${a.x} ${a.y} L ${d.x} ${d.y} Z`}(e);case"dot":return function({point:a,int:b}){let c=iK.Lrp(a,b,.45),d=iK.Dist(c,a);return`M ${c.x-d},${c.y}
  a ${d},${d} 0 1,0 ${2*d},0
  a ${d},${d} 0 1,0 -${2*d},0 `}(e);case"inverted":return function({point:a,int:b}){let c=iK.Sub(b,a).div(2),d=iK.Add(a,iK.Rot(c,iP)),e=iK.Sub(a,iK.Rot(c,iP));return`M ${d.x} ${d.y} L ${b.x} ${b.y} L ${e.x} ${e.y} Z`}(e);case"arrow":return function({point:a,int:b}){let c=iK.RotWith(b,a,iO/6),d=iK.RotWith(b,a,-iO/6);return`M ${c.x} ${c.y} L ${a.x} ${a.y} L ${d.x} ${d.y}`}(e);case"triangle":return function({point:a,int:b}){let c=iK.RotWith(b,a,iO/6),d=iK.RotWith(b,a,-iO/6);return`M ${c.x} ${c.y} L ${d.x} ${d.y} L ${a.x} ${a.y} Z`}(e)}return""}function O4({arrow:a}){let b=jA(),c=d8("elbow arrow grid",()=>{try{return E1(b,b.getShape(a.id),Fd(b,a))}catch(a){console.error(a);return}},[b,a.id]);if(!c)return null;let d=kt.Common([c.A.original,c.B.original]).expandBy(50),e=c.route?.name??"",f=c.route?.midpointHandle;return(0,bS.jsxs)(bS.Fragment,{children:[null!==c.midX&&(0,bS.jsx)(O5,{a:{x:c.midX,y:d.minY},b:{x:c.midX,y:d.maxY},stroke:"red"}),null!==c.midY&&(0,bS.jsx)(O5,{a:{x:d.minX,y:c.midY},b:{x:d.maxX,y:c.midY},stroke:"blue"}),f?.axis==="x"&&c.midXRange&&(0,bS.jsx)(O5,{a:{x:c.midXRange.lo,y:f.point.y},b:{x:c.midXRange.hi,y:f.point.y},stroke:"red",strokeDasharray:"0 2"}),f?.axis==="y"&&c.midYRange&&(0,bS.jsx)(O5,{a:{x:f.point.x,y:c.midYRange.lo},b:{x:f.point.x,y:c.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),(0,bS.jsx)(O8,{box:c.A.original,stroke:"orange"}),(0,bS.jsx)(O8,{box:c.A.expanded,stroke:"orange",strokeWidth:.5}),(0,bS.jsx)(O8,{box:c.A.original.clone().expandBy(c.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),(0,bS.jsx)(O8,{box:c.B.original,stroke:"lightskyblue"}),(0,bS.jsx)(O8,{box:c.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),(0,bS.jsx)(O8,{box:c.B.original.clone().expandBy(c.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),(0,bS.jsx)(O7,{edge:c.A.edges.top,axis:"x",stroke:"orange"}),(0,bS.jsx)(O7,{edge:c.B.edges.top,axis:"x",stroke:"lightskyblue"}),(0,bS.jsx)(O7,{edge:c.A.edges.right,axis:"y",stroke:"orange"}),(0,bS.jsx)(O7,{edge:c.B.edges.right,axis:"y",stroke:"lightskyblue"}),(0,bS.jsx)(O7,{edge:c.A.edges.bottom,axis:"x",stroke:"orange"}),(0,bS.jsx)(O7,{edge:c.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),(0,bS.jsx)(O7,{edge:c.A.edges.left,axis:"y",stroke:"orange"}),(0,bS.jsx)(O7,{edge:c.B.edges.left,axis:"y",stroke:"lightskyblue"}),c.route&&(0,bS.jsx)(O6,{route:c.route.points,strokeWidth:10}),(0,bS.jsx)("text",{x:d.minX+5,y:d.minY-3,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:e}),(0,bS.jsxs)("text",{x:c.A.expanded.x,y:c.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",c.route&&`, ${c.route.aEdgePicking}`,c.A.isPoint&&", point"]}),(0,bS.jsxs)("text",{x:c.B.expanded.x,y:c.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",c.route&&`, ${c.route.bEdgePicking}`,c.B.isPoint&&", point"]})]})}function O5({a,b,...c}){return(0,bS.jsx)("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:a.x,y1:a.y,x2:b.x,y2:b.y,...c})}function O6({route:a,...b}){return(0,bS.jsx)("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:a.map(a=>`${a.x},${a.y}`).join(" "),...b})}function O7({edge:a,axis:b,...c}){if(!a||null===a.expanded)return null;let d=a=>"x"===b?{x:a.y,y:a.x}:a;return(0,bS.jsxs)("g",{children:[(0,bS.jsx)(O5,{a:d({x:a.expanded,y:a.cross.min}),b:d({x:a.expanded,y:a.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...c}),(0,bS.jsx)(O5,{a:d({x:a.expanded-4,y:a.cross.min}),b:d({x:a.expanded+4,y:a.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...c}),(0,bS.jsx)(O5,{a:d({x:a.expanded-4,y:a.cross.max}),b:d({x:a.expanded+4,y:a.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...c})]})}function O8({box:a,...b}){return(0,bS.jsx)("rect",{x:a.minX,y:a.minY,width:a.width,height:a.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...b})}let O9=new ci;function Pa(a,b){let c=iK.FromAngle(b).per();return iK.Dpr(a,c)}var Pb=((u=Pb||{}).Start="start",u.Middle="middle",u.End="end",u);class Pc extends kO{static type="arrow";static props=gE;static migrations=gH;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:3*KB.s,m:3*KB.m,l:3*KB.l,xl:3*KB.xl},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:a=>a.inputs.getAltKey(),shouldIgnoreTargets:a=>a.inputs.getCtrlKey(),showTextOutline:!0};canEdit(){return!0}canBind({toShape:a}){return"arrow"!==a.type}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}hideInMinimap(){return!0}canBeLaidOut(a,b){if("flip"===b.type){let{start:c,end:d}=Fd(this.editor,a),{shapes:e=[]}=b;if(c&&!e.find(a=>a.id===c.toId)||d&&!e.find(a=>a.id===d.toId))return!1}return!0}getFontFaces(a){return NZ(a.props.richText)?du:zW(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",richText:gb(""),labelPosition:.5,font:"draw",scale:1}}getGeometry(a){let b,c=this.editor.getEditingShapeId()===a.id,d=Ff(this.editor,a),e=[],f="straight"===d.type?new kJ({start:iK.From(d.start.point),end:iK.From(d.end.point)}):"arc"===d.type?new sx({center:iK.Cast(d.handleArc.center),start:iK.Cast(d.start.point),end:iK.Cast(d.end.point),sweepFlag:d.bodyArc.sweepFlag,largeArcFlag:d.bodyArc.largeArcFlag}):new kK({points:d.route.points});if(c||!NZ(a.props.richText)){let c=O$(this.editor,a);ji.debugGeometry.get()&&e.push(...c.debugGeom),b=new kM({x:c.box.x,y:c.box.y,width:c.box.w,height:c.box.h,isFilled:!0,isLabel:!0})}return new kI({children:[...b?[f,b]:[f],...e]})}getHandles(a){let b=Ff(this.editor,a),c=[{id:"start",type:"vertex",index:"a1",x:b.start.handle.x,y:b.start.handle.y},{id:"end",type:"vertex",index:"a3",x:b.end.handle.x,y:b.end.handle.y}];if("arc"===a.props.kind&&("straight"===b.type||"arc"===b.type)&&c.push({id:"middle",type:"virtual",index:"a2",x:b.middle.x,y:b.middle.y}),"elbow"===a.props.kind&&"elbow"===b.type&&b.route.midpointHandle){let d=this.editor.getShapePageTransform(a.id),e=d.applyToPoint(b.route.midpointHandle.segmentStart),f=d.applyToPoint(b.route.midpointHandle.segmentEnd);iK.Dist(e,f)*this.editor.getEfficientZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&c.push({id:"middle",type:"vertex",index:"a2",x:b.route.midpointHandle.point.x,y:b.route.midpointHandle.point.y})}return c}getText(a){return N$(this.editor,a.props.richText)}onHandleDrag(a,b){let c=b.handle.id;switch(c){case"middle":switch(a.props.kind){case"arc":return this.onArcMidpointHandleDrag(a,b);case"elbow":return this.onElbowMidpointHandleDrag(a,b);default:cc(a.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(a,b,c);default:cc(c)}}onArcMidpointHandleDrag(a,{handle:b}){let c=Fd(this.editor,a),{start:d,end:e}=Fg(this.editor,a,c),f=iK.Sub(e,d),g=iK.Per(f),h=iK.Med(e,d),i=iK.Sub(h,g),j=iK.Add(h,g),k=iK.NearestPointOnLineSegment(i,j,b,!1),l=iK.Dist(k,h);return iK.Clockwise(k,e,h)&&(l*=-1),{id:a.id,type:a.type,props:{bend:l}}}onElbowMidpointHandleDrag(a,{handle:b}){var c,d;let e=Ff(this.editor,a);if(e?.type!=="elbow")return;let f=this.editor.getShapePageTransform(a.id),g=f.applyToPoint(b),h=e.route.midpointHandle?.axis;if(!h)return;let i=EG[h],j=e.elbow[i.midRange];if(!j)return;let k=iK.Angle(f.applyToPoint(i.v(0,0)),f.applyToPoint(i.v(0,1)));k<0&&(k+=Math.PI);let l=Pa(g,k),m=Pa(f.applyToPoint(i.v(j.lo,0)),k),n=Pa(f.applyToPoint(i.v(j.hi,0)),k),o=this.options.elbowMidpointSnapDistance/this.editor.getEfficientZoomLevel(),p=Pa(f.applyToPoint(i.v((c=j.lo)+(j.hi-c)*.5,0)),k),q=p,r=Math.abs(p-l);for(let[a,b]of(d=this.editor,O9.get(d,a=>{let b=dQ("current selected arrow shape",()=>{let b=a.getOnlySelectedShape();return b&&a.isShapeOfType(b,"arrow")?b.id:null}),c=a.store.query.ids("shape",()=>{let a=b.get();return a?{type:{eq:"arrow"},id:{neq:a}}:{type:{eq:"arrow"}}});return dQ("elbow arrow snap lines",()=>{let b=new Map,d=a.getCurrentPageShapeIds(),e=a.getViewportPageBounds();for(let f of c.get()){if(!d.has(f))continue;let c=a.getShape(f);if(c?.type!=="arrow")continue;let g=a.getShapePageBounds(f);if(!g||!e.includes(g))continue;let h=Fd(a,c),i=a.getShapePageTransform(f);if(!i)continue;let j=a.getShapeGeometry(f),k=i.applyToPoints(j.vertices);for(let a=1;a<k.length;a++){let c=k[a-1],d=k[a],e=iK.Angle(c,d);e<0&&(e+=Math.PI);let f=b.get(e);f||(f=new Set,b.set(e,f));let g=Pa(c,e);f.add({perpDistance:g,startBoundShapeId:h.start?.toId,endBoundShapeId:h.end?.toId})}}return b})}).get())){let{isParallel:c,isFlippedParallel:d}=function(a,b,c=1e-4){let d=Math.abs(a-b),e=Math.abs(d-Math.PI)<c,f=Math.abs(d-iQ)<c;return{isParallel:d<c||f,isFlippedParallel:e}}(k,a);if(c||d)for(let a of b){let b=a.startBoundShapeId&&(a.startBoundShapeId===e.bindings.start?.toId||a.startBoundShapeId===e.bindings.end?.toId),c=a.endBoundShapeId&&(a.endBoundShapeId===e.bindings.start?.toId||a.endBoundShapeId===e.bindings.end?.toId);if(!b&&!c)continue;let f=d?-a.perpDistance:a.perpDistance,g=Math.abs(f-l);g<r&&(q=f,r=g)}}r>o&&(q=l);let s=iS((q-m)/(n-m),0,1);return{id:a.id,type:a.type,props:{elbowMidPoint:s}}}onTerminalHandleDrag(a,{handle:b,isPrecise:c},d){let e=Fd(this.editor,a),f={id:a.id,type:"arrow",props:{}},g=e[d],h=e["start"===d?"end":"start"],i=Kg({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(a.id).applyToPoint(b),arrow:a,isPrecise:c,currentBinding:g,oppositeBinding:h});if(!i){Fi(this.editor,a,d);let c=ss(new iK(b.x,b.y),this.editor);return f.props[d]={x:c.x,y:c.y},f}let j={terminal:d,normalizedAnchor:i.normalizedAnchor,isPrecise:i.isPrecise,isExact:i.isExact,snap:i.snap};Fh(this.editor,a,i.target.id,j);let k=Fd(this.editor,a);return k.start&&k.end&&k.start.toId===k.end.toId&&iK.Equals(k.start.props.normalizedAnchor,k.end.props.normalizedAnchor)&&Fh(this.editor,a,k.end.toId,{...k.end.props,normalizedAnchor:{x:k.end.props.normalizedAnchor.x+.05,y:k.end.props.normalizedAnchor.y}}),f}onTranslateStart(a){let b=Fd(this.editor,a);if("elbow"===a.props.kind&&this.editor.getOnlySelectedShapeId()===a.id){let c=Ff(this.editor,a);if(!c)return;let d={id:a.id,type:"arrow",props:{}};return b.start&&(d.props.start={x:c.start.point.x,y:c.start.point.y},Fi(this.editor,a,"start")),b.end&&(d.props.end={x:c.end.point.x,y:c.end.point.y},Fi(this.editor,a,"end")),d}let c=Fg(this.editor,a,b),d=this.editor.getShapePageTransform(a.id),e=this.editor.getSelectedShapeIds();if(!(b.start&&(e.includes(b.start.toId)||this.editor.isAncestorSelected(b.start.toId))||b.end&&(e.includes(b.end.toId)||this.editor.isAncestorSelected(b.end.toId))))for(let e of(Pf.set(a,{pagePosition:d.applyToPoint(a),terminalBindings:cL(c,(a,c)=>{let e=b[a];return e?{binding:e,shapePosition:c,pagePosition:d.applyToPoint(c)}:null})}),b.start&&(Ka({editor:this.editor,arrow:a,terminal:"start",useHandle:!0}),a=this.editor.getShape(a.id)),b.end&&Ka({editor:this.editor,arrow:a,terminal:"end",useHandle:!0}),["start","end"])){let a=b[e];a&&this.editor.updateBinding({...a,props:{...a.props,isPrecise:!0}})}}onTranslate(a,b){let c=Pf.get(a);if(!c)return;let d=this.editor.getShapePageTransform(b.id),e=iK.Sub(d.applyToPoint(b),c.pagePosition);for(let a of Object.values(c.terminalBindings)){if(!a)continue;let c=iK.Add(a.pagePosition,iK.Mul(e,.5)),d=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:a=>!a.isLocked&&this.editor.canBindShapes({fromShape:b,toShape:a,binding:"arrow"})});if(d?.id===a.binding.toId){let e=kt.ZeroFix(this.editor.getShapeGeometry(d).bounds),f=this.editor.getPointInShapeSpace(d,c),g={x:(f.x-e.minX)/e.width,y:(f.y-e.minY)/e.height};Fh(this.editor,b,d.id,{...a.binding.props,normalizedAnchor:g,isPrecise:!0})}else Fi(this.editor,b,a.binding.props.terminal)}}_resizeInitialBindings=new ci;onResize(a,b){let{scaleX:c,scaleY:d}=b,e=this._resizeInitialBindings.get(a,()=>Fd(this.editor,a)),f=Fg(this.editor,a,e),{start:g,end:h}=dk(a.props),{bend:i}=a.props;e.start||(g.x=f.start.x*c,g.y=f.start.y*d),e.end||(h.x=f.end.x*c,h.y=f.end.y*d);let j=Math.abs(c),k=Math.abs(d),l=e?.start?iK.From(e.start.props.normalizedAnchor):null,m=e?.end?iK.From(e.end.props.normalizedAnchor):null;return c<0&&d>=0?(0!==i&&(i*=-1*Math.max(j,k)),l&&(l.x=1-l.x),m&&(m.x=1-m.x)):c>=0&&d<0?(0!==i&&(i*=-1*Math.max(j,k)),l&&(l.y=1-l.y),m&&(m.y=1-m.y)):c>=0&&d>=0?0!==i&&(i*=Math.max(j,k)):c<0&&d<0&&(0!==i&&(i*=Math.max(j,k)),l&&(l.x=1-l.x,l.y=1-l.y),m&&(m.x=1-m.x,m.y=1-m.y)),e.start&&l&&Fh(this.editor,a,e.start.toId,{...e.start.props,normalizedAnchor:l.toJson()}),e.end&&m&&Fh(this.editor,a,e.end.toId,{...e.end.props,normalizedAnchor:m.toJson()}),{props:{start:g,end:h,bend:i}}}onDoubleClickHandle(a,b){switch(b.id){case"start":return{id:a.id,type:a.type,props:{...a.props,arrowheadStart:"none"===a.props.arrowheadStart?"arrow":"none"}};case"end":return{id:a.id,type:a.type,props:{...a.props,arrowheadEnd:"none"===a.props.arrowheadEnd?"arrow":"none"}}}}component(a){let b=Hq(),c=this.editor.getOnlySelectedShape(),d=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),e=Ff(this.editor,a);if(!e?.isValid)return null;let f=O$(this.editor,a),g=a.id===this.editor.getOnlySelectedShapeId(),h=this.editor.getEditingShapeId()===a.id||!NZ(a.props.richText);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)(ks,{style:{minWidth:50,minHeight:50},children:[(0,bS.jsx)(Pd,{shape:a,shouldDisplayHandles:d&&c?.id===a.id}),"elbow"===a.props.kind&&ji.debugElbowArrows.get()&&(0,bS.jsx)(O4,{arrow:a})]}),h&&(0,bS.jsx)(OG,{shapeId:a.id,type:"arrow",font:a.props.font,fontSize:O0(a),lineHeight:KA.lineHeight,align:"middle",verticalAlign:"middle",labelColor:gu(b,a.props.labelColor,"solid"),richText:a.props.richText,textWidth:f.box.w-8.5*a.props.scale,isSelected:g,padding:0,showTextOutline:this.options.showTextOutline,style:{transform:`translate(${f.box.center.x}px, ${f.box.center.y}px)`}})]})}indicator(a){var b;let c=su(a.id),d=jv(a.id+"_clip"),e=Ff(this.editor,a);if(!e)return null;let{start:f,end:g}=Fg(this.editor,a,e?.bindings),h=this.editor.getShapeGeometry(a),i=h.bounds,j=NZ(a.props.richText),k=c||!j?h.children[1]:null;if(iK.Equals(f,g))return null;let l=KB[a.props.size]*a.props.scale,m=e.start.arrowhead&&O3(e,"start",l),n=e.end.arrowhead&&O3(e,"end",l),o=m&&"arrow"!==e.start.arrowhead||n&&"arrow"!==e.end.arrowhead||!!k,p=k?k.getBounds():new kt(0,0,0,0);if(c&&k)return(0,bS.jsx)("rect",{x:i5(p.x),y:i5(p.y),width:p.w,height:p.h,rx:3.5*a.props.scale,ry:3.5*a.props.scale});let q="none"!==e.start.arrowhead&&"arrow"!==e.start.arrowhead,r="none"!==e.end.arrowhead&&"arrow"!==e.end.arrowhead;return(0,bS.jsxs)("g",{children:[o&&(0,bS.jsx)("defs",{children:(0,bS.jsx)(Pe,{radius:3.5*a.props.scale,hasText:!j,bounds:i,labelBounds:p,as:q&&m?m:"",ae:r&&n?n:""})}),(0,bS.jsxs)("g",{style:{clipPath:o?`url(#${d})`:void 0,WebkitClipPath:o?`url(#${d})`:void 0},children:[o&&(0,bS.jsx)("rect",{x:i.minX-100,y:i.minY-100,width:i.width+200,height:i.height+200,opacity:0}),(b="draw"===a.props.dash?{style:"draw",randomSeed:a.id,strokeWidth:1,passes:1,offset:0,roundness:2*l,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}},OV(e).toSvg(b))]}),m&&(0,bS.jsx)("path",{d:m}),n&&(0,bS.jsx)("path",{d:n}),k&&(0,bS.jsx)("rect",{x:i5(p.x),y:i5(p.y),width:p.w,height:p.h,rx:3.5,ry:3.5})]})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=Ff(this.editor,a);if(!b)return;let c=this.editor.getEditingShapeId()===a.id,{start:d,end:e}=Fg(this.editor,a,b?.bindings),f=this.editor.getShapeGeometry(a),g=NZ(a.props.richText),h=c||!g?f.children[1]:null;if(iK.Equals(d,e))return;let i=KB[a.props.size]*a.props.scale;if(c&&h){let b=h.getBounds(),c=new Path2D;return c.roundRect(b.x,b.y,b.w,b.h,3.5*a.props.scale),c}let j=this.editor.getEfficientZoomLevel()<.25*a.props.scale,k=OV(b).toPath2D("draw"!==a.props.dash||j?{style:"solid",strokeWidth:1}:{style:"draw",randomSeed:a.id,strokeWidth:1,passes:1,offset:0,roundness:2*i}),l=b.start.arrowhead&&O3(b,"start",i),m=b.end.arrowhead&&O3(b,"end",i),n=!!(l&&"arrow"!==b.start.arrowhead),o=!!(m&&"arrow"!==b.end.arrowhead);if(h||n||o){let b=f.bounds,c=new Path2D;if(c.rect(b.minX-100,b.minY-100,b.width+200,b.height+200),h){let b=h.getBounds(),d=3.5*a.props.scale;c.moveTo(b.x,b.y+d),c.lineTo(b.x,b.maxY-d),c.arcTo(b.x,b.maxY,b.x+d,b.maxY,d),c.lineTo(b.maxX-d,b.maxY),c.arcTo(b.maxX,b.maxY,b.maxX,b.maxY-d,d),c.lineTo(b.maxX,b.y+d),c.arcTo(b.maxX,b.y,b.maxX-d,b.y,d),c.lineTo(b.x+d,b.y),c.arcTo(b.x,b.y,b.x,b.y+d,d),c.closePath()}n&&l&&c.addPath(new Path2D(l)),o&&m&&c.addPath(new Path2D(m));let d=[];if(l&&d.push(new Path2D(l)),m&&d.push(new Path2D(m)),h){let a=h.getBounds(),b=new Path2D;b.roundRect(a.x,a.y,a.w,a.h,3.5),d.push(b)}return{path:k,clipPath:c,additionalPaths:d}}let p=new Path2D;return p.addPath(k),l&&p.addPath(new Path2D(l)),m&&p.addPath(new Path2D(m)),p}onEditStart(a){if(NZ(a.props.richText)){let b=O1(this.editor,a);this.editor.updateShape({id:a.id,type:a.type,props:{labelPosition:b}})}}toSvg(a,b){b.addExportDef(OI(a.props.fill));let c=gq(b),d=1/a.props.scale;return(0,bS.jsxs)("g",{transform:`scale(${d})`,children:[(0,bS.jsx)(Pd,{shape:a,shouldDisplayHandles:!1}),(0,bS.jsx)(OH,{fontSize:O0(a),font:a.props.font,align:"middle",verticalAlign:"middle",labelColor:gu(c,a.props.labelColor,"solid"),richText:a.props.richText,bounds:O$(this.editor,a).box.clone().expandBy(-4.25*a.props.scale),padding:0,showTextOutline:this.options.showTextOutline})]})}getCanvasSvgDefs(){return[OK(),{key:"arrow:dot",component:Pg},{key:"arrow:cross",component:Ph}]}getInterpolatedProps(a,b,c){var d,e,f,g,h,i,j;return{...c>.5?b.props:a.props,scale:(d=a.props.scale,d+(b.props.scale-d)*c),start:{x:(e=a.props.start.x,e+(b.props.start.x-e)*c),y:(f=a.props.start.y,f+(b.props.start.y-f)*c)},end:{x:(g=a.props.end.x,g+(b.props.end.x-g)*c),y:(h=a.props.end.y,h+(b.props.end.y-h)*c)},bend:(i=a.props.bend,i+(b.props.bend-i)*c),labelPosition:(j=a.props.labelPosition,j+(b.props.labelPosition-j)*c)}}}let Pd=d3(function({shape:a,shouldDisplayHandles:b}){var c;let d=jA(),e=Hq(),f=Ff(d,a),g=OU(.25*a.props.scale),h=jv(a.id+"_clip"),i=jv("arrowhead-dot"),j=jv("arrowhead-cross"),k=su(a.id),l=d.getShapeGeometry(a);if(!l)return null;let m=kt.ZeroFix(l.bounds),n=Fd(d,a),o=NZ(a.props.richText);if(!f?.isValid)return null;let p=KB[a.props.size]*a.props.scale,q=f.start.arrowhead&&O3(f,"start",p),r=f.end.arrowhead&&O3(f,"end",p),s=null;b&&(n.start||n.end)&&(s=function(a,b){switch(a.type){case"straight":return new z3().moveTo(a.start.handle.x,a.start.handle.y).lineTo(a.end.handle.x,a.end.handle.y).toSvg(b);case"arc":return new z3().moveTo(a.start.handle.x,a.start.handle.y).circularArcTo(a.handleArc.radius,!!a.handleArc.largeArcFlag,!!a.handleArc.sweepFlag,a.end.handle.x,a.end.handle.y).toSvg(b);case"elbow":{var c,d;let e,f,g,h,i,j,k,l=(c=a.elbow,d=a.route,e=c.swapOrder?c.B.target:c.A.target,f=c.swapOrder?c.A.target:c.B.target,g=iK.ManhattanDist(d.points[0],d.points[1]),h=iK.ManhattanDist(d.points[d.points.length-2],d.points[d.points.length-1]),i=iK.ManhattanDist(e,d.points[1]),j=iK.ManhattanDist(d.points[d.points.length-2],f),k=[e,...d.points,f],{name:d.name,distance:d.distance+(g-i)+(h-j),points:k.filter(a=>!d.skipPointsWhenDrawing.has(a)),aEdgePicking:d.aEdgePicking,bEdgePicking:d.bEdgePicking,skipPointsWhenDrawing:d.skipPointsWhenDrawing,midpointHandle:d.midpointHandle});return z3.lineThroughPoints(l.points).toSvg(b)}default:cc(a,"type")}}(f,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/d.getEfficientZoomLevel(),props:{className:"tl-arrow-hint",markerStart:n.start?n.start.props.isExact?"":n.start.props.isPrecise?`url(#${j})`:`url(#${i})`:"",markerEnd:n.end?n.end.props.isExact?"":n.end.props.isPrecise?`url(#${j})`:`url(#${i})`:"",opacity:.16}}));let t=O$(d,a),u="none"!==f.start.arrowhead&&"arrow"!==f.start.arrowhead,v="none"!==f.end.arrowhead&&"arrow"!==f.end.arrowhead;return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("defs",{children:(0,bS.jsx)("clipPath",{id:h,children:(0,bS.jsx)(Pe,{radius:3.5*a.props.scale,hasText:k||!o,bounds:m,labelBounds:t.box,as:u&&q?q:"",ae:v&&r?r:""})})}),(0,bS.jsxs)("g",{fill:"none",stroke:gu(e,a.props.color,"solid"),strokeWidth:p,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[s,(0,bS.jsxs)("g",{style:{clipPath:`url(#${h})`,WebkitClipPath:`url(#${h})`},children:[(0,bS.jsx)("rect",{x:i5(m.minX-100),y:i5(m.minY-100),width:i5(m.width+200),height:i5(m.height+200),opacity:0}),(c={style:a.props.dash,strokeWidth:p,forceSolid:g,randomSeed:a.id},OV(f).toSvg(c))]}),q&&u&&"none"!==a.props.fill&&(0,bS.jsx)(OS,{theme:e,d:q,color:a.props.color,fill:a.props.fill,scale:a.props.scale}),r&&v&&"none"!==a.props.fill&&(0,bS.jsx)(OS,{theme:e,d:r,color:a.props.color,fill:a.props.fill,scale:a.props.scale}),q&&(0,bS.jsx)("path",{d:q}),r&&(0,bS.jsx)("path",{d:r})]})]})});function Pe({radius:a,hasText:b,bounds:c,labelBounds:d,as:e,ae:f}){let g=(0,bT.useMemo)(()=>{let e=new z3;return e.moveTo(c.left-100,c.top-100).lineTo(c.right+100,c.top-100).lineTo(c.right+100,c.bottom+100).lineTo(c.left-100,c.bottom+100).close(),b&&e.moveTo(d.left,d.top+a).lineTo(d.left,d.bottom-a).circularArcTo(a,!1,!1,d.left+a,d.bottom).lineTo(d.right-a,d.bottom).circularArcTo(a,!1,!1,d.right,d.bottom-a).lineTo(d.right,d.top+a).circularArcTo(a,!1,!1,d.right-a,d.top).lineTo(d.left+a,d.top).circularArcTo(a,!1,!1,d.left,d.top+a).close(),e.toD()},[a,b,c.bottom,c.left,c.right,c.top,d.bottom,d.left,d.right,d.top]);return(0,bS.jsx)("path",{d:`${g}${e}${f}`})}let Pf=new WeakMap;function Pg(){let a=jv("arrowhead-dot");return(0,bS.jsx)("marker",{id:a,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,bS.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Ph(){let a=jv("arrowhead-cross");return(0,bS.jsxs)("marker",{id:a,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,bS.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,bS.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}var AA=f$;let Pi="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Pj({url:a}){let b=jA(),c=OU(),d=(0,bT.useCallback)(a=>{b.inputs.getShiftKey()||b.markEventAsHandled(a)},[b]);return(0,bS.jsx)("a",{className:(0,jb.default)("tl-hyperlink-button",{"tl-hyperlink-button__hidden":c}),href:a,target:"_blank",rel:"noopener noreferrer",onPointerDown:d,onPointerUp:d,title:a,draggable:!1,children:(0,bS.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Pi}") center 100% / 100% no-repeat`,WebkitMask:`url("${Pi}") center 100% / 100% no-repeat`}})})}let Pk="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Pl=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Pm(a){return Pl.map(b=>{let{offsetX:c,offsetY:d,blur:e,spread:f,color:g}=b,{x:h,y:i}=new iK(c,d).rot(-a);return`${h}px ${i}px ${e}px ${f}px ${g}`}).join(", ")}function Pn({w:a,h:b}){return(0,bS.jsx)("rect",{width:i5(a),height:i5(b),rx:"6",ry:"6"})}function Po({assetId:a,rotation:b,url:c,h:d,showImageContainer:e=!0}){let f=jA(),g=a?f.getAsset(a):null,h=!!lS()&&!1,i=(a=>{try{return new URL(a).hostname.replace(/^www\./,"")}catch{return a}})(c),[j,k]=(0,bT.useState)(!0),l=(0,bT.useCallback)(a=>{f.inputs.getShiftKey()||f.markEventAsHandled(a)},[f]);return(0,bS.jsx)(sl,{children:(0,bS.jsxs)("div",{className:(0,jb.default)("tl-bookmark__container",h&&"tl-bookmark__container--safariExport"),style:{boxShadow:h?void 0:Pm(b),maxHeight:d},children:[e&&(!g||g.props.image)&&(0,bS.jsxs)("div",{className:"tl-bookmark__image_container",children:[g?(0,bS.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:g?.props.image,alt:g?.props.title||""}):(0,bS.jsx)("div",{className:"tl-bookmark__placeholder"}),g?.props.image&&(0,bS.jsx)(Pj,{url:c})]}),(0,bS.jsxs)("div",{className:"tl-bookmark__copy_container",children:[g?.props.title?(0,bS.jsx)("a",{className:"tl-bookmark__link",href:c||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:l,onPointerUp:l,children:(0,bS.jsx)("h2",{className:"tl-bookmark__heading",children:N4(g.props.title)})}):null,g?.props.description&&g?.props.image?(0,bS.jsx)("p",{className:"tl-bookmark__description",children:g.props.description}):null,(0,bS.jsxs)("a",{className:"tl-bookmark__link",href:c||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:l,onPointerUp:l,children:[j&&g?.props.favicon?(0,bS.jsx)("img",{className:"tl-bookmark__favicon",src:g?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:()=>k(!1),alt:`favicon of ${i}`}):(0,bS.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Pk}") center 100% / 100% no-repeat`,WebkitMask:`url("${Pk}") center 100% / 100% no-repeat`}}),(0,bS.jsx)("span",{children:i})]})]})]})})}function Pp(a,b=!1){let c=a.length;if(c<2)return"";let d=a[0].point,e=a[1].point;if(2===c)return`M${iM(d)}L${iM(e)}`;let f="";for(let b=2,g=c-1;b<g;b++)f+=iN(d=a[b].point,e=a[b+1].point);return b?`M${iN(a[0].point,a[1].point)}Q${iM(a[1].point)}${iN(a[1].point,a[2].point)}T${f}${iN(a[c-1].point,a[0].point)}${iN(a[0].point,a[1].point)}Z`:`M${iM(a[0].point)}Q${iM(a[1].point)}${iN(a[1].point,a[2].point)}${a.length>3?"T":""}${f}L${iM(a[c-1].point)}`}function Pq(a){let b,c,d=a[0];for(;a.length>2;)if(b=a[1],iK.Dist2(d.point,b.point)<((d.radius+b.radius)/2*.5)**2)a.splice(1,1);else break;let e=a[a.length-1];for(;a.length>2;)if(c=a[a.length-2],iK.Dist2(e.point,c.point)<((e.radius+c.radius)/2*.5)**2)a.splice(a.length-2,1);else break;return a.length>1&&(a[0]={...a[0],vector:iK.Sub(a[0].point,a[1].point).uni()},a[a.length-1]={...a[a.length-1],vector:iK.Sub(a[a.length-2].point,a[a.length-1].point).uni()}),a}let Pr=(a,b,c)=>{let d=[],e=[];a.forEach(a=>d.push(...hM.decodePoints(a.path))),b.forEach(a=>e.push(...hM.decodePoints(a.path)));let f=Math.max(d.length,e.length),g=[],h=[];for(let a=0;a<f;a++)g.push(d[a]||d[d.length-1]),h.push(e[a]||e[e.length-1]);let i=g.map((a,b)=>{var d,e,f;let g=.5;return void 0!==h[b].z&&void 0!==a.z&&(d=a.z,g=d+(h[b].z-d)*c),{x:(e=a.x,e+(h[b].x-e)*c),y:(f=a.y,f+(h[b].y-f)*c),z:g}});return[{type:"free",path:hM.encodePoints(i)}]};function Ps(a,b){let c=(b+1)*.5;return`M ${a.x} ${a.y} m -${c}, 0 a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 -${2*c},0`}function Pt(a){return 1===a.props.segments.length&&a.props.segments[0].path.length<24}function Pu({shape:a,zoomOverride:b}){var c;let d=Hq(),e=jA(),f=z2(a.props.segments,a.props.scaleX,a.props.scaleY),g=a.props.isComplete||b5(a.props.segments)?.type==="straight",h=(KB[a.props.size]+1)*a.props.scale,i=d8("force solid",()=>{let a=b??e.getEfficientZoomLevel();return a<.5&&a<1.5/h},[e,h,b]),j=d8("dot adjustment",()=>(b??e.getEfficientZoomLevel())<.2?9:.1,[e,b]);i||a.props.isPen||"draw"!==a.props.dash||1!==f.length||(h+=cC(a.id)()*(h/6));let k=z1(a.props,h,g,i);if(!i&&"draw"===a.props.dash)return(0,bS.jsxs)(bS.Fragment,{children:[a.props.isClosed&&a.props.fill&&f.length>1?(0,bS.jsx)(OS,{d:Pp(Kp(f,k),a.props.isClosed),theme:d,color:a.props.color,fill:a.props.isClosed?a.props.fill:"none",scale:a.props.scale}):null,(0,bS.jsx)("path",{d:function(a,b={}){let{start:c={},end:d={}}=b,{cap:e=!0}=c,{cap:f=!0}=d;cd(!c.taper&&!d.taper,"cap taper not supported here"),cd(!c.easing&&!d.easing,"cap easing not supported here"),cd(e&&f,"cap must be true");let g=Kp(a,b);Kr(g,b);let h=function(a){let b,c,d,e,f;if(a.length<=2)return[a];let g=[],h=[a[0]],i=iK.Sub(a[1].point,a[0].point).uni();for(let j=1,k=a.length;j<k-1;j++){if(d=a[j-1],e=a[j],f=a[j+1],b=iK.Sub(f.point,e.point).uni(),c=iK.Dpr(i,b),i=b,c<-.8){let a={...e,point:e.input};h.push(a),g.push(Pq(h)),h=[a];continue}if(h.push(e),!(c>.7)&&(iK.Dist2(d.point,e.point)+iK.Dist2(e.point,f.point))/((d.radius+e.radius+f.radius)/3)**2<1.5){h.push(e),g.push(Pq(h)),h=[e];continue}}return h.push(a[a.length-1]),g.push(Pq(h)),g}(g),i="";for(let a of h)i+=function(a,b={}){if(0===a.length)return"";if(1===a.length){var c,d;return c=a[0].point.x,"M "+c+" "+a[0].point.y+" m -"+(d=a[0].radius)+", 0 a "+d+","+d+" 0 1,1 "+2*d+",0 a "+d+","+d+" 0 1,1 -"+2*d+",0"}let{left:e,right:f}=Kn(a,b);f.reverse();let g=`M${iM(e[0])}T`;for(let a=1;a<e.length;a++)g+=iN(e[a-1],e[a]);{let b=a[a.length-1],c=b.radius,d=b.vector.clone().per().neg(),e=iK.Add(b.point,iK.Mul(d,c)),f=iK.Add(b.point,iK.Mul(d,-c));g+=`${iM(e)}A${i5(c)},${i5(c)} 0 0 1 ${iM(f)}T`}for(let a=1;a<f.length;a++)g+=iN(f[a-1],f[a]);{let b=a[0],c=b.radius,d=b.vector.clone().per(),e=iK.Add(b.point,iK.Mul(d,c)),f=iK.Add(b.point,iK.Mul(d,-c));g+=`${iM(e)}A${i5(c)},${i5(c)} 0 0 1 ${iM(f)}Z`}return g}(a,b);return i}(f,k),strokeLinecap:"round",fill:gu(d,a.props.color,"solid")})]});let l=Kp(f,k),m=l.length<2,n=m?Ps(f[0],0):Pp(l,a.props.isClosed);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(OS,{d:n,theme:d,color:a.props.color,fill:m||a.props.isClosed?a.props.fill:"none",scale:a.props.scale}),(0,bS.jsx)("path",{d:n,strokeLinecap:"round",fill:m?gu(d,a.props.color,"solid"):"none",stroke:gu(d,a.props.color,"solid"),strokeWidth:h,strokeDasharray:m?"none":(c=h,({draw:"none",solid:"none",dotted:`${j} ${2*c}`,dashed:`${2*c} ${2*c}`})[a.props.dash]),strokeDashoffset:"0"})]})}let Pv=(a,b)=>!!a.find(a=>{let c=new RegExp(a.split("*").map(a=>(function(a){if("string"!=typeof a)throw TypeError("Expected a string");return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(a)).join(".+"));return b.match(c)});class Pw extends so{static type="embed";static props=hT;static migrations=hV;static embedDefinitions=AS;canEditWhileLocked(a){let b=this.getEmbedDefinition(a.props.url);return!b||(b.definition.canEditWhileLocked??!0)}static setEmbedDefinitions(a){Pw.embedDefinitions=a}getEmbedDefinitions(){return Pw.embedDefinitions}getEmbedDefinition(a){var b=Pw.embedDefinitions;try{return function(a,b){let c=dh(b);if(!c)return;let d=c.host.replace("www.","");for(let c of a)if(Pv(c.hostnames,d)){let a=c.toEmbedUrl(b);if(a)return{definition:c,embedUrl:a,url:b}}}(b,a)??function(a,b){let c=dh(b);if(!c)return;let d=c.host.replace("www.","");for(let c of a)if(Pv(c.hostnames,d)){let a=c.fromEmbedUrl(b);if(a)return{definition:c,url:a,embedUrl:b}}}(b,a)}catch{return}}getText(a){return a.props.url}getAriaDescriptor(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition.title}hideSelectionBoundsFg(a){return!this.canResize(a)}canEdit(){return!0}canResize(a){return!!this.getEmbedDefinition(a.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}getGeometry(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition?super.getGeometry(a):new kM({width:300,height:46,isFilled:!0})}isAspectRatioLocked(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition.isAspectRatioLocked??!1}onResize(a,b){let c=this.isAspectRatioLocked(a),d=this.getEmbedDefinition(a.props.url),e=d?.definition.minWidth??200,f=d?.definition.minHeight??200;if(c){let b=a.props.w/a.props.h;b>1?e*=b:f/=b}return sn(a,b,{minWidth:e,minHeight:f})}component(a){let b=lS(),{w:c,h:d,url:e}=a.props,f=su(a.id),g=this.getEmbedDefinition(e),h=d8("is hovering",()=>{let{editingShapeId:a,hoveredShapeId:b}=this.editor.getCurrentPageState();if(a&&b!==a){let b=this.editor.getShape(a);if(b&&this.editor.isShapeOfType(b,"embed"))return!0}return!1},[]),i=this.editor.getShapePageTransform(a).rotation();if(b)return(0,bS.jsx)(sl,{className:"tl-embed-container",id:a.id,children:(0,bS.jsx)("div",{className:"tl-embed",style:{border:0,boxShadow:Pm(i),borderRadius:g?.definition.overrideOutlineRadius??8,background:g?.definition.backgroundColor??"var(--tl-color-background)",width:c,height:d}})});let j=f||h;if(g?.definition.type==="github_gist"){let b=g.url.split("/").pop();if(!b)throw Error("No gist id!");return(0,bS.jsx)(sl,{className:"tl-embed-container",id:a.id,children:(0,bS.jsx)(Px,{id:b,width:i5(c),height:i5(d),isInteractive:j,pageRotation:i})})}let k=Object.entries({...AT,...g?.definition.overridePermissions??{}}).filter(([a,b])=>b).map(([a])=>a).join(" ");return(0,bS.jsx)(sl,{className:"tl-embed-container",id:a.id,children:g?.definition?(0,bS.jsx)("iframe",{className:"tl-embed",sandbox:k,src:g.embedUrl,width:i5(c),height:i5(d),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:f?0:-1,allowFullScreen:!0,style:{border:0,pointerEvents:j?"auto":"none",zIndex:j?"":"-1",boxShadow:Pm(i),borderRadius:g?.definition.overrideOutlineRadius??8,background:g?.definition.backgroundColor}}):(0,bS.jsx)(Po,{url:e,h:d,rotation:i,assetId:null,showImageContainer:!1})})}indicator(a){let b=this.getEmbedDefinition(a.props.url);return b?.definition?(0,bS.jsx)("rect",{width:i5(a.props.w),height:i5(a.props.h),rx:b?.definition.overrideOutlineRadius??8,ry:b?.definition.overrideOutlineRadius??8}):(0,bS.jsx)(Pn,{w:300,h:46})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=new Path2D,c=this.getEmbedDefinition(a.props.url);if(c?.definition){let d=c.definition.overrideOutlineRadius??8;b.roundRect(0,0,a.props.w,a.props.h,d)}else b.roundRect(0,0,300,46,6);return b}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}}function Px({id:a,isInteractive:b,width:c,height:d,style:e,pageRotation:f}){if(!a.match(/^[0-9a-f]+$/))throw Error("No gist id!");return(0,bS.jsx)("iframe",{className:"tl-embed",draggable:!1,width:i5(c),height:i5(d),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:b?0:-1,style:{...e,pointerEvents:b?"all":"none",zIndex:b?"":"-1",boxShadow:Pm(f)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${a}.js></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function Py(a,b){return Math.floor((2/Math.PI*(iW(a.getShapePageTransform(b.id).rotation())+Math.PI/4)+4)%4)}let Pz=new WeakMap;function PA(a,b,c){let d=Pz.get(b.props);if(!d){let e=PF(b.props.name,"Frame")+String.fromCharCode(8203),f=a.textMeasure.measureTextSpans(e,c),g=f[0],h=b5(f);d=h.box.w+h.box.x-g.box.x,Pz.set(b.props,d)}return new kt(0,-c.height,d,c.height)}function PB(a,b){return{fontSize:12,fontFamily:b?"Arial":"Inter, sans-serif",textAlign:"start",width:a,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function PC(a,b,c){let d,e=c?"":"px",f=c?"":"deg";switch(b){case 0:d="";break;case 3:d=`translate(${i5(a.props.w)}${e}, 0${e}) rotate(90${f})`;break;case 2:d=`translate(${i5(a.props.w)}${e}, ${i5(a.props.h)}${e}) rotate(180${f})`;break;case 1:d=`translate(0${e}, ${i5(a.props.h)}${e}) rotate(270${f})`;break;default:throw Error("labelSide out of bounds")}return d}let PD=(0,bT.forwardRef)(({id:a,name:b,isEditing:c},d)=>{let e=jA(),f=A0(),g=d8("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),h=f<AZ.TABLET_SM&&g,i=(0,bT.useRef)(!1),j=Am(),k=(0,bT.useCallback)(a=>{c&&e.markEventAsHandled(a)},[e,c]),l=(0,bT.useCallback)(a=>{"Enter"!==a.key||a.nativeEvent.isComposing||(e.markEventAsHandled(a),a.currentTarget.blur(),e.setEditingShape(null))},[e]),m=(0,bT.useCallback)(b=>{let c=e.getShape(a);c&&c.props.name!==b&&e.updateShapes([{id:a,type:"frame",props:{name:b}}])},[a,e]),n=(0,bT.useCallback)(a=>{m(a.currentTarget.value)},[m]),o=(0,bT.useCallback)(a=>{m(a.currentTarget.value)},[m]);return(0,bT.useEffect)(()=>{if(!c){i.current=!1;return}if(c&&h&&!i.current){i.current=!0;let b=e.getShape(a),c=b?.props.name??"",d=window.prompt(j("action.rename"),c);i.current=!1,null!==d&&m(d),e.setEditingShape(null)}},[c,h,a,j,m,e]),(0,bS.jsxs)("div",{className:`tl-frame-label ${c&&!h?"tl-frame-label__editing":""}`,children:[(0,bS.jsx)("input",{className:"tl-frame-name-input",ref:d,disabled:!c||h,readOnly:!c||h,style:{display:c?void 0:"none"},value:b,autoFocus:!h,onKeyDown:l,onBlur:n,onChange:o,onPointerDown:k,draggable:!1}),PF(b,"Frame")+String.fromCharCode(8203)]})}),PE=(0,bT.memo)(function({id:a,name:b,width:c,height:d,fill:e,stroke:f,color:g,offsetX:h,showColors:i}){let j=jA(),{side:k,translation:l}=d8("shape rotation",()=>{let b=j.getShape(a);if(!b)return{side:0,translation:"translate(0, 0)"};let c=Py(j,b);return{side:c,translation:PC(b,c,!1)}},[j,h,a]),m=(0,bT.useRef)(null),n=su(a);return(0,bT.useEffect)(()=>{let a=m.current;a&&n&&(a.focus(),a.select())},[m,n]),(0,bS.jsx)("div",{className:"tl-frame-heading",style:{overflow:n?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${0===k||2===k?Math.ceil(c):Math.ceil(d)}px + ${i?"0px":"var(--tl-frame-offset-width)"})`,bottom:"100%",transform:`${l} scale(min(var(--tl-scale), 3.5)) translateX(${h}px)`},children:(0,bS.jsx)("div",{className:"tl-frame-heading-hit-area",style:{color:g,backgroundColor:e,boxShadow:`inset 0px 0px 0px 1px ${f}`},children:(0,bS.jsx)(PD,{ref:m,id:a,name:b,isEditing:n})})})});function PF(a,b){return a.match(/^\s*$/)?b:a}var zY=b_;let PG=new ci;function PH(a){return PG.get(a,PI)}function PI(a){let b=Math.max(1,a.props.w),c=Math.max(1,a.props.h+a.props.growY),d=b/2,e=c/2,f=Fm[a.props.size]*a.props.scale,g="none"!==a.props.fill;switch(a.props.geo){case"arrow-down":{let a=.16*b,d=.38*Math.min(b,c);return new z3().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b-a,c-d).lineTo(b,c-d).lineTo(b/2,c).lineTo(0,c-d).lineTo(a,c-d).close()}case"arrow-left":{let a=.38*Math.min(b,c),d=.16*c;return new z3().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(a,d).lineTo(b,d).lineTo(b,c-d).lineTo(a,c-d).lineTo(a,c).lineTo(0,c/2).close()}case"arrow-right":{let a=.38*Math.min(b,c),d=.16*c;return new z3().moveTo(0,d,{geometry:{isFilled:g}}).lineTo(b-a,d).lineTo(b-a,0).lineTo(b,c/2).lineTo(b-a,c).lineTo(b-a,c-d).lineTo(0,c-d).close()}case"arrow-up":{let a=.16*b,d=.38*Math.min(b,c);return new z3().moveTo(b/2,0,{geometry:{isFilled:g}}).lineTo(b,d).lineTo(b-a,d).lineTo(b-a,c).lineTo(a,c).lineTo(a,d).lineTo(0,d).close()}case"check-box":{let a=.82*Math.min(b,c),d=(b-a)/2,e=(c-a)/2;return new z3().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b,c).lineTo(0,c).close().moveTo(iS(d+.25*a,0,b),iS(e+.52*a,0,c),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo(iS(d+.45*a,0,b),iS(e+.82*a,0,c)).lineTo(iS(d+.82*a,0,b),iS(e+.22*a,0,c),{offset:0})}case"diamond":return new z3().moveTo(d,0,{geometry:{isFilled:g}}).lineTo(b,e).lineTo(d,c).lineTo(0,e).close();case"ellipse":return new z3().moveTo(0,e,{geometry:{isFilled:g}}).arcTo(d,e,!1,!0,0,b,e).arcTo(d,e,!1,!0,0,0,e).close();case"heart":{let a=b/4,e=c/4;return new z3().moveTo(d,c,{geometry:{isFilled:g}}).cubicBezierTo(0,1.2*e,1.5*a,3*e,0,2.5*e).cubicBezierTo(d,.9*e,0,-(.32*e),1.85*a,-(.32*e)).cubicBezierTo(b,1.2*e,2.15*a,-(.32*e),b,-(.32*e)).cubicBezierTo(d,c,b,2.5*e,2.5*a,3*e).close()}case"hexagon":return z3.lineThroughPoints(i1(b,c,6),{geometry:{isFilled:g}}).close();case"octagon":return z3.lineThroughPoints(i1(b,c,8),{geometry:{isFilled:g}}).close();case"oval":var h,i,j,k=b,l=c,m=g;if(l>k){let a=k/2;return new z3().moveTo(0,a,{geometry:{isFilled:m}}).arcTo(a,a,!1,!0,0,k,a).lineTo(k,l-a).arcTo(a,a,!1,!0,0,0,l-a).close()}let n=l/2;return new z3().moveTo(n,l,{geometry:{isFilled:m}}).arcTo(n,n,!1,!0,0,n,0).lineTo(k-n,0).arcTo(n,n,!1,!0,0,k-n,l).close();case"pentagon":return z3.lineThroughPoints(i1(b,c,5),{geometry:{isFilled:g}}).close();case"rectangle":return new z3().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b,c).lineTo(0,c).close();case"rhombus":{let a=Math.min(.38*b,.38*c);return new z3().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b,0).lineTo(b-a,c).lineTo(0,c).close()}case"rhombus-2":{let a=Math.min(.38*b,.38*c);return new z3().moveTo(0,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b,c).lineTo(a,c).close()}case"star":let o,p,q,r,s,t,u,v,w,y,z,A,B,C;return h=b,i=c,j=g,o=iQ/5/2,q=Math.cos(-iP+(p=2*Math.floor(5/4))*o)*h/2,r=Math.cos(-iP+(10-p)*o)*h/2,s=Math.sin(-iP+0*o)*i/2,t=Math.sin(-iP+2*Math.floor(2.5)*o)*i/2,u=h-Math.abs(q-r),v=i-Math.abs(t-s),w=(h-(h/2+r-(h/2-q)))/2,y=(i-(i/2+s-(i/2-t)))/2,z=(h+u)/2,A=(i+v)/2,B=z/2,C=A/2,z3.lineThroughPoints(Array.from(Array(10),(a,b)=>{let c=-iP+b*o;return new iK(w+(b%2?B:z)*Math.cos(c),y+(b%2?C:A)*Math.sin(c))}),{geometry:{isFilled:j}}).close();case"trapezoid":{let a=Math.min(.38*b,.38*c);return new z3().moveTo(a,0,{geometry:{isFilled:g}}).lineTo(b-a,0).lineTo(b,c).lineTo(0,c).close()}case"triangle":return new z3().moveTo(d,0,{geometry:{isFilled:g}}).lineTo(b,c).lineTo(0,c).close();case"x-box":return function(a,b,c,d,e){let f=a/2,g=b/2,h=new z3().moveTo(0,0,{geometry:{isFilled:e}}).lineTo(a,0).lineTo(a,b).lineTo(0,b).close();if("dashed"===d||"dotted"===d)return h.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(a,b,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(0,b,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g).moveTo(a,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(f,g);let i=.62*("draw"===d);return h.moveTo(iS(c*i,0,a),iS(c*i,0,b),{geometry:{isInternal:!0,isFilled:!1}}).lineTo(iS(a-c*i,0,a),iS(b-c*i,0,b)).moveTo(iS(a-c*i,0,a),iS(c*i,0,b)).lineTo(iS(c*i,0,a),iS(b-c*i,0,b)),h}(b,c,f,a.props.dash,g);case"cloud":return function(a,b,c,d,e,f){let g=new z3,h=cC(c),i=PJ(a,b),j=Math.max(Math.ceil(i/PK[d]),6,Math.ceil(i/Math.min(a,b))),k=i/j*.2,l=Math.max(a-2*k,1),m=Math.max(b-2*k,1),n=PJ(l,m)/j,o=(a-l)/2,p=(b-m)/2,q=(function(a,b,c){let d=Math.min(a,b)/2,e=Math.max(a,b)-2*d,f=(2*d*Math.PI+2*e)/c,g=a>b?[{type:"straight",start:new iK(d,0),delta:new iK(1,0)},{type:"arc",center:new iK(a-d,d),startAngle:-iO/2},{type:"straight",start:new iK(a-d,b),delta:new iK(-1,0)},{type:"arc",center:new iK(d,d),startAngle:iO/2}]:[{type:"straight",start:new iK(a,d),delta:new iK(0,1)},{type:"arc",center:new iK(d,b-d),startAngle:0},{type:"straight",start:new iK(0,b-d),delta:new iK(0,-1)},{type:"arc",center:new iK(d,d),startAngle:iO}],h=0,i=[];for(let a=0;a<c;a++){let a=g[0];"straight"===a.type?i.push(iK.Add(a.start,iK.Mul(a.delta,h))):i.push(i0(a.center,d,a.startAngle+h/d)),h+=f;let b="straight"===a.type?e:iO*d;for(;h>b;)h-=b,g.push(g.shift()),b="straight"===g[0].type?e:iO*d}return i})(l,m,j).map(a=>a.addXY(o,p)),r=a<20?0:.3*k,s=b<20?0:.3*k,t=q.slice(0);for(let a=0;a<Math.floor(j/2);a++)t[a]=iK.AddXY(t[a],h()*r*e,h()*s*e),t[j-a-1]=iK.AddXY(t[j-a-1],h()*r*e,h()*s*e);for(let c=0;c<t.length;c++){let d=c===t.length-1?0:c+1,e=t[c],h=t[d],i=q[c],j=q[d],k=iK.Dist(i,j),l=(Math.max(o,p)+(n-k))*(iK.Dist(e,h)/k),m=iK.Lrp(i,j,.5).add(iK.Sub(j,i).uni().per().mul(l));m.x<0?m.x=0:m.x>a&&(m.x=a),m.y<0?m.y=0:m.y>b&&(m.y=b);let r=i9(e,h,m),s=iK.Dist(r||iK.Average([e,h]),e);0===c&&g.moveTo(e.x,e.y,{geometry:{isFilled:f}}),g.circularArcTo(s,!1,!0,h.x,h.y)}return g.close()}(b,c,a.id,a.props.size,a.props.scale,g);default:cc(a.props.geo)}}function PJ(a,b){return a>b?(b/2*iO+(a-b))*2:(a/2*iO+(b-a))*2}let PK={s:50,m:70,l:100,xl:130};function PL({shape:a,shouldScale:b,forceSolid:c}){let d=b?a.props.scale:1,e=Hq(),{props:f}=a,{color:g,fill:h,dash:i,size:j}=f,k=KB[j]*d,l=PH(a),m="draw"!==i||c?l.toD({onlyFilled:!0}):l.toDrawD({strokeWidth:k,randomSeed:a.id,passes:1,offset:0,onlyFilled:!0});return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(OS,{theme:e,d:m,color:g,fill:h,scale:d}),l.toSvg({style:i,strokeWidth:k,forceSolid:c,randomSeed:a.id,props:{fill:"none",stroke:gu(e,g,"solid")}})]})}let PM=Object.freeze({s:12,m:14,l:16,xl:20}),PN=Object.freeze({s:2,m:3.5,l:5,xl:10}),PO=Object.freeze({w:0,h:0});function PP(a){let{w:b,h:c,growY:d,scale:e}=a;return{w:b/e,h:c/e,growY:d/e}}function PQ(a,b,c){return b>a?b-a:c>0?0:null}let PR=new ci;function PS(a,b){return PR.get(b,()=>PT(a,b))}function PT(a,b){let{richText:c,font:d,size:e,w:f}=b.props,g=PM[e],h=NX(a,c),i=a.textMeasure.measureHtml(h,{...KA,fontFamily:KF[d],fontSize:KD[e],minWidth:g,maxWidth:Math.max(0,Math.ceil(g+PN[e]),Math.ceil(f/b.props.scale-32))});return{w:i.w+32,h:i.h+32}}function PU(a,b){let c=b/2;return`M ${a.x} ${a.y} m -${c}, 0 a ${c},${c} 0 1,0 ${2*c},0 a ${c},${c} 0 1,0 -${2*c},0`}function PV(a,b,c){let d=z2(a.props.segments,a.props.scaleX,a.props.scaleY),e=a.props.isComplete||b5(a.props.segments)?.type==="straight",f=b;return c||a.props.isPen||1!==d.length||(f+=cC(a.id)()*(b/6)),{strokePoints:Kp(d,z0({strokeWidth:f,showAsComplete:e})),sw:f}}function PW(a){return 1.12*KC[a.props.size]*a.props.scale}function PX(a){return 1===a.props.segments.length&&a.props.segments[0].path.length<24}function PY({strokeWidth:a,forceSolid:b,shape:c,opacity:d}){var e;let f=Hq(),g=z2(c.props.segments,c.props.scaleX,c.props.scaleY),h=a;b||c.props.isPen||1!==g.length||(h+=cC(c.id)()*(h/6));let i=Kp(g,z0({strokeWidth:h,showAsComplete:c.props.isComplete||b5(c.props.segments)?.type==="straight"})),j=i.length>1?Pp(i,!1):(e=g[0],`M ${e.x} ${e.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`),k=function(){let[a,b]=(0,bT.useState)(!1);return(0,bT.useEffect)(()=>{let a=CSS.supports("color","color(display-p3 1 1 1)"),c=matchMedia("(color-gamut: p3)");b(a&&c.matches);let d=()=>b(a&&c.matches);return c.addEventListener("change",d),()=>c.removeEventListener("change",d)},[]),d8(ji.forceSrgb)||!a?"srgb":"p3"}(),l=gu(f,c.props.color,"p3"===k?"highlightP3":"highlightSrgb");return(0,bS.jsx)("path",{d:j,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:h,opacity:d})}function PZ(a,b){return d8("forceSolid",()=>PW(b)/a.getEfficientZoomLevel()<1.5,[a])}function P$(){return(0,bS.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,bS.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,bS.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,bS.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function P_({shapeId:a,assetId:b,width:c}){let d=jA(),e=lS(),f=function(){let a=(0,bT.useContext)(lQ),[b]=(0,bT.useState)(cf);return(0,bT.useEffect)(()=>(a?.waitUntil(b),()=>{b.resolve()}),[b,a]),lP(()=>{b.resolve()})}(),[g,h]=(0,bT.useState)(()=>({asset:b?d.getAsset(b)??null:null,url:null})),i=(0,bT.useRef)(!1),j=(0,bT.useRef)(null),k=(0,bT.useRef)(!1),l=(0,bT.useRef)(null);return(0,bT.useEffect)(()=>{let g,m=j.current!==b;if(j.current=b,m&&(k.current=!0),!b)return;let n=!1,o=dA("update state",()=>{if(!e&&a&&d.getCulledShapes().has(a))return;let j=d.getAsset(b);if(!j)return void h(a=>({...a,asset:null,url:null}));if(!j.props.src){let a=d.getTemporaryAssetPreview(j.id);if(a){l.current!==a&&(l.current=a,h(b=>({...b,isPlaceholder:!0,url:a})),f());return}}let m=e?e.scale*(c/j.props.w):d.getEfficientZoomLevel()*(c/j.props.w);function o(a,b){n||l.current!==b&&(i.current=!0,l.current=b,h({asset:a,url:b}),f())}if(i.current&&!k.current){let a=0,c=()=>{++a>31.25&&(P0(d,b,m,e,a=>o(j,a)),g?.())};g?.(),d.on("tick",c),g=()=>d.off("tick",c)}else g?.(),P0(d,b,m,e,a=>o(j,a)),k.current=!1});return()=>{o(),g?.(),n=!0}},[d,b,e,f,a,c]),g}function P0(a,b,c,d,e){a.resolveAssetUrl(b,{screenScale:c,shouldResolveToOriginal:!!d&&null===d.pixelRatio,dpr:d?.pixelRatio??void 0}).then(a=>{e(a)})}async function P1(a){let b=await cm(a),c=await b.blob();return co.blobToDataUrl(c)}let P2=new ci,P3=(0,bT.memo)(function({shape:a}){let b=jA(),{w:c}=H$(a.props,a.props.crop),{asset:d,url:e}=P_({shapeId:a.id,assetId:a.props.assetId,width:c}),f=z7(),[g,h]=(0,bT.useState)(""),[i,j]=(0,bT.useState)(null),k=d&&P4(b,d.id);(0,bT.useEffect)(()=>{if(e&&k){let{promise:a,cancel:b}=P8(e);return a.then(a=>{h(a),j(e)}),()=>{b()}}},[b,k,f,e]);let l=d8("show crop preview",()=>a.id===b.getOnlySelectedShapeId()&&b.getCroppingShapeId()===a.id&&b.isIn("select.crop"),[b,a.id]),m=f&&(d?.props.mimeType?.includes("video")||k),n=P5(a),o=e===i?null:e,p=m?g:i;if(!e&&!d?.props.src)return(0,bS.jsxs)(sl,{id:a.id,style:{overflow:"hidden",width:a.props.w,height:a.props.h,color:"var(--tl-color-text-3)",backgroundColor:"var(--tl-color-low)",border:"1px solid var(--tl-color-low-border)"},children:[(0,bS.jsx)("div",{className:(0,jb.default)("tl-image-container",d&&"tl-image-container-loading"),style:n,children:d?null:(0,bS.jsx)(P$,{})}),"url"in a.props&&a.props.url&&(0,bS.jsx)(Pj,{url:a.props.url})]});let q=k?"anonymous":void 0;return(0,bS.jsxs)(bS.Fragment,{children:[l&&p&&(0,bS.jsx)("div",{style:n,children:(0,bS.jsx)("img",{className:"tl-image",style:{...P6(a),opacity:.1},crossOrigin:q,src:p,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),(0,bS.jsxs)(sl,{id:a.id,style:{overflow:"hidden",width:a.props.w,height:a.props.h,borderRadius:a.props.crop?.isCircle?"50%":void 0},children:[(0,bS.jsxs)("div",{className:(0,jb.default)("tl-image-container"),style:n,children:[p&&(0,bS.jsx)("img",{className:"tl-image",style:P6(a),crossOrigin:q,src:p,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},p),o&&(0,bS.jsx)("img",{className:"tl-image",style:P6(a),crossOrigin:q,src:o,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:a.props.altText,onLoad:()=>j(o)},o)]}),a.props.url&&(0,bS.jsx)(Pj,{url:a.props.url})]})]})});function P4(a,b){let c=b?a.getAsset(b):void 0;return!!c&&("mimeType"in c.props&&cB.isAnimatedImageType(c?.props.mimeType)||"isAnimated"in c.props&&c.props.isAnimated)}function P5(a){let b=a.props.crop,c=b?.topLeft;if(!c)return{width:a.props.w,height:a.props.h};let{w:d,h:e}=H$(a.props,b),f=-c.x*d,g=-c.y*e;return{transform:`translate(${f}px, ${g}px)`,width:d,height:e}}function P6(a,b){let c,d,{flipX:e,flipY:f,crop:g}=a.props;if(!e&&!f)return;if(g){let{w:b,h:e}=H$(a.props,g),f=g.bottomRight.x-g.topLeft.x,h=g.bottomRight.y-g.topLeft.y;c=cD(g.topLeft.x,[0,1-f],[0,b-a.props.w]),d=cD(g.topLeft.y,[0,1-h],[0,e-a.props.h])}let h=`scale(${e?-1:1}, ${f?-1:1})`,i=b?`translate(${(e?b.width:0)-(c||0)}px,
		             ${(f?b.height:0)-(d||0)}px)`:"";return{transform:`${i} ${h}`,transformOrigin:b?"0 0":"center center"}}function P7({shape:a,src:b}){let c=ju(),d=P5(a),e=a.props.crop;if(!d.transform||!e)return(0,bS.jsx)("image",{href:b,width:a.props.w,height:a.props.h,"aria-label":a.props.altText,style:P6(a,{width:a.props.w,height:a.props.h})});{let{transform:f,width:g,height:h}=d,i=(e.bottomRight.x-e.topLeft.x)*g,j=(e.bottomRight.y-e.topLeft.y)*h,k=[new iK(0,0),new iK(i,0),new iK(i,j),new iK(0,j)],l=P6(a,{width:g,height:h});return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("defs",{children:(0,bS.jsx)("clipPath",{id:c,children:e.isCircle?(0,bS.jsx)("ellipse",{cx:i/2,cy:j/2,rx:i/2,ry:j/2}):(0,bS.jsx)("polygon",{points:k.map(a=>`${a.x},${a.y}`).join(" ")})})}),(0,bS.jsx)("g",{clipPath:`url(#${c})`,children:(0,bS.jsx)("image",{href:b,width:g,height:h,"aria-label":a.props.altText,style:l?{...l}:{transform:f}})})]})}}function P8(a){let b=!1;return{promise:new Promise(c=>{let d=cn();d.onload=()=>{if(b)return;let a=document.createElement("canvas");a.width=d.width,a.height=d.height;let e=a.getContext("2d");e&&(e.drawImage(d,0,0),c(a.toDataURL()))},d.crossOrigin="anonymous",d.src=a}),cancel:()=>b=!0}}let P9=new ci;function Qa(a){return Object.values(a.props.points).sort(c6)}let Qb=new ci;function Qc(a){return Qb.get(a,()=>{let b=Qa(a).map(iK.From);switch(a.props.spline){case"cubic":return z3.cubicSplineThroughPoints(b,{endOffsets:0});case"line":return z3.lineThroughPoints(b,{endOffsets:0})}})}function Qd({shape:a,shouldScale:b=!1,forceSolid:c=!1}){let d=Hq(),e=Qc(a),{dash:f,color:g,size:h}=a.props,i=1/a.props.scale,j=Fm[h]*a.props.scale;return e.toSvg({style:f,strokeWidth:j,forceSolid:c,randomSeed:a.id,props:{transform:`scale(${b?i:1})`,stroke:gu(d,g,"solid"),fill:"none"}})}var zY=b_;function Qe(a,b){let{labelHeight:c,fontSizeAdjustment:d}=Qg(a,b),e=Math.max(0,c-200);if(e!==b.props.growY||d!==b.props.fontSizeAdjustment)return{...b,props:{...b.props,growY:e,fontSizeAdjustment:d}}}let Qf=new ci;function Qg(a,b){return Qf.get(b,()=>(function(a,b){let{richText:c}=b.props;if(NZ(c))return{labelHeight:KD[b.props.size]*KA.lineHeight+32,labelWidth:100,fontSizeAdjustment:0};let d=KD[b.props.size],e=0,f=0,g=200,h=200;do{e=Math.min(d,d-f);let i=NX(a,c),j=a.textMeasure.measureHtml(i,{...KA,fontFamily:KF[b.props.font],fontSize:e,maxWidth:167,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(g=j.h+32,h=j.w+32,e<=14){let d=NX(a,c),f=a.textMeasure.measureHtml(d,{...KA,fontFamily:KF[b.props.font],fontSize:e,maxWidth:167});g=f.h+32,h=f.w+32;break}if(j.scrollWidth.toFixed(0)===j.w.toFixed(0))break}while(f++<50)return{labelHeight:g,labelWidth:h,fontSizeAdjustment:e}})(a,b))}function Qh(a){return(200+a.props.growY)*a.props.scale}var zY=b_;let Qi=fe("text size",(a,b)=>(a.fonts.trackFontsForShape(b),Qj(a,b.props)),{areRecordsEqual:(a,b)=>a.props===b.props});function Qj(a,b){let{font:c,richText:d,size:e,w:f}=b,g=KC[e],h=b.autoSize?null:Math.max(16,Math.floor(f)),i=NX(a,d),j=a.textMeasure.measureHtml(i,{...KA,fontFamily:KF[c],fontSize:g,maxWidth:h});return{width:h??Math.max(16,j.w+1),height:Math.max(g,j.h)}}let Qk=new ci,Ql=(0,bT.memo)(function({shape:a}){let b=jA(),c=b.getShapeGeometry(a).bounds.w*b.getEfficientZoomLevel()>=110,d=su(a.id),e=z7(),{Spinner:f}=q_(),{asset:g,url:h}=P_({shapeId:a.id,assetId:a.props.assetId,width:a.props.w}),i=(0,bT.useRef)(null),[j,k]=(0,bT.useState)(!1),l=(0,bT.useCallback)(a=>{a.currentTarget&&k(!0)},[]),[m,n]=(0,bT.useState)(!1);return(0,bT.useEffect)(()=>{let a=()=>n(document.fullscreenElement===i.current);return document.addEventListener("fullscreenchange",a),()=>document.removeEventListener("fullscreenchange",a)}),(0,bT.useEffect)(()=>{let a=i.current;a&&d&&document.activeElement!==a&&a.focus()},[d,j]),(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(sl,{id:a.id,style:{color:"var(--tl-color-text-3)",backgroundColor:g?"transparent":"var(--tl-color-low)",border:g?"none":"1px solid var(--tl-color-low-border)"},children:(0,bS.jsx)("div",{className:"tl-counter-scaled",children:(0,bS.jsx)("div",{className:"tl-video-container",children:g?f&&!g.props.src?(0,bS.jsx)(f,{}):h?(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("video",{ref:i,style:d?{pointerEvents:"all"}:j?void 0:{display:"none"},className:(0,jb.default)("tl-video",`tl-video-shape-${a.id.split(":")[1]}`,{"tl-video-is-fullscreen":m}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:a.props.autoplay&&!e,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:d&&c,onLoadedData:l,hidden:!j,"aria-label":a.props.altText,children:(0,bS.jsx)("source",{src:h})},h),!j&&f&&(0,bS.jsx)(f,{})]}):null:(0,bS.jsx)(P$,{})})})}),"url"in a.props&&a.props.url&&(0,bS.jsx)(Pj,{url:a.props.url})]})}),Qm=[class extends kO{static type="text";static props=il;static migrations=io;options={extraArrowHorizontalPadding:10,showTextOutline:!0};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:gb("")}}getMinDimensions(a){return Qi.get(this.editor,a.id)}getGeometry(a,b){let{scale:c}=a.props,{width:d,height:e}=this.getMinDimensions(a),f=b?.context??"none";return new kM({x:("@tldraw/arrow-without-arrowhead"===f?-this.options.extraArrowHorizontalPadding:0)*c,width:(d+("@tldraw/arrow-without-arrowhead"===f?2*this.options.extraArrowHorizontalPadding:0))*c,height:e*c,isFilled:!0,isLabel:!0})}getFontFaces(a){return zW(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}getText(a){return N$(this.editor,a.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(a){var b;let c,{id:d,props:{font:e,size:f,richText:g,color:h,scale:i,textAlign:j}}=a,{width:k,height:l}=this.getMinDimensions(a),m=a.id===this.editor.getOnlySelectedShapeId(),n=Hq(),o=(b=d,c=jA(),(0,bT.useCallback)(a=>{c.getEditingShapeId()===b&&"Enter"===a.key&&(a.ctrlKey||a.metaKey)&&c.complete()},[c,b]));return(0,bS.jsx)(OG,{shapeId:d,classNamePrefix:"tl-text-shape",type:"text",font:e,fontSize:KC[f],lineHeight:KA.lineHeight,align:j,verticalAlign:"middle",richText:g,labelColor:gu(n,h,"solid"),isSelected:m,textWidth:k,textHeight:l,showTextOutline:this.options.showTextOutline,style:{transform:`scale(${i})`,transformOrigin:"top left"},wrap:!0,onKeyDown:o})}indicator(a){let b=this.editor.getShapeGeometry(a).bounds,c=jA();return a.props.autoSize&&c.getEditingShapeId()===a.id?null:(0,bS.jsx)("rect",{width:i5(b.width),height:i5(b.height)})}useLegacyIndicator(){return!1}getIndicatorPath(a){if(a.props.autoSize&&this.editor.getEditingShapeId()===a.id)return;let b=this.editor.getShapeGeometry(a).bounds,c=new Path2D;return c.rect(0,0,b.width,b.height),c}toSvg(a,b){let c=this.editor.getShapeGeometry(a).bounds,d=c.width/(a.props.scale??1),e=c.height/(a.props.scale??1),f=gq(b),g=new kt(0,0,d,e);return(0,bS.jsx)(OH,{fontSize:KC[a.props.size],font:a.props.font,align:a.props.textAlign,verticalAlign:"middle",richText:a.props.richText,labelColor:gu(f,a.props.color,"solid"),bounds:g,padding:0,showTextOutline:this.options.showTextOutline})}onResize(a,b){let{newPoint:c,initialBounds:d,initialShape:e,scaleX:f,handle:g}=b;if("scale_shape"===b.mode||"right"!==g&&"left"!==g)return{id:a.id,type:a.type,...sp(a,b)};{let b=Math.max(1,Math.abs(d.width*f)),{x:g,y:h}=f<0?iK.Sub(c,iK.FromAngle(a.rotation).mul(b)):c;return{id:a.id,type:a.type,x:g,y:h,props:{w:b/e.props.scale,autoSize:!1}}}}onEditEnd(a){0===N$(this.editor,a.props.richText).trimEnd().length&&this.editor.deleteShapes([a.id])}onBeforeUpdate(a,b){let c;if(!b.props.autoSize)return;let d=a.props.size!==b.props.size||a.props.textAlign!==b.props.textAlign||a.props.font!==b.props.font||1!==a.props.scale&&1===b.props.scale,e=!(0,zY.default)(a.props.richText,b.props.richText);if(!d&&!e)return;let f=this.getMinDimensions(a),g=Qj(this.editor,b.props),h=f.width*a.props.scale,i=f.height*a.props.scale,j=g.width*b.props.scale,k=g.height*b.props.scale;switch(b.props.textAlign){case"middle":c=new iK((j-h)/2,e?0:(k-i)/2);break;case"end":c=new iK(j-h,e?0:(k-i)/2);break;default:if(e)break;c=new iK(0,(k-i)/2)}if(!c)return{...b,props:{...b.props,w:j}};{c.rot(b.rotation);let{x:a,y:d}=b;return{...b,x:a-c.x,y:d-c.y,props:{...b.props,w:j}}}}},class extends so{static type="bookmark";static props=hA;static migrations=hC;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(a){return a.props.url}getAriaDescriptor(a){let b=a.props.assetId?this.editor.getAsset(a.props.assetId):null;if(b?.props.title)return N4(b.props.title)+(b.props.description?", "+b.props.description:"")}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(a){let{assetId:b,url:c,h:d}=a.props,e=this.editor.getShapePageTransform(a).rotation();return(0,bS.jsx)(Po,{assetId:b,url:c,h:d,rotation:e})}indicator(a){return(0,bS.jsx)(Pn,{w:a.props.w,h:a.props.h})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=new Path2D;return b.roundRect(0,0,a.props.w,a.props.h,6),b}onBeforeCreate(a){return Av(this.editor,a)}onBeforeUpdate(a,b){if(a.props.url!==b.props.url)if(!AA.linkUrl.isValid(b.props.url))return{...b,props:{...b.props,url:a.props.url}};else!function(a,b){let{url:c}=b.props,d=hz.createId(cp(c));a.getAsset(d)?b.props.assetId!==d&&a.updateShapes([{id:b.id,type:b.type,props:{assetId:d}}]):(a.updateShapes([{id:b.id,type:b.type,props:{assetId:null}}]),Aw(a,b))}(this.editor,b);if(a.props.assetId!==b.props.assetId)return Av(this.editor,b)}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}},class extends kO{static type="draw";static props=hO;static migrations=hQ;options={maxPointsPerShape:600};hideResizeHandles(a){return Pt(a)}hideRotateHandle(a){return Pt(a)}hideSelectionBoundsFg(a){return Pt(a)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1,scaleX:1,scaleY:1}}getGeometry(a){let b=z2(a.props.segments,a.props.scaleX,a.props.scaleY),c=(KB[a.props.size]+1)*a.props.scale;if(1===a.props.segments.length){let a=kt.FromPoints(b);if(a.width<2*c&&a.height<2*c)return new sy({x:-c,y:-c,radius:c,isFilled:!0})}let d=Kp(b,z1(a.props,c,a.props.isPen,!0)).map(a=>a.point);return a.props.isClosed&&d.length>2?new kL({points:d,isFilled:"none"!==a.props.fill}):1===d.length?new sy({x:-c,y:-c,radius:c,isFilled:!0}):new kK({points:d})}component(a){return(0,bS.jsx)(ks,{children:(0,bS.jsx)(Pu,{shape:a})})}indicator(a){let b=z2(a.props.segments,a.props.scaleX,a.props.scaleY),c=(KB[a.props.size]+1)*a.props.scale;d8("force solid",()=>{let a=this.editor.getEfficientZoomLevel();return a<.5&&a<1.5/c},[this.editor,c])||a.props.isPen||"draw"!==a.props.dash||1!==b.length||(c+=cC(a.id)()*(c/6));let d=a.props.isComplete||b5(a.props.segments)?.type==="straight",e=Kp(b,z1(a.props,c,d,!0)),f=e.length>1?Pp(e,a.props.isClosed):Ps(b[0],c);return(0,bS.jsx)("path",{d:f})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=z2(a.props.segments,a.props.scaleX,a.props.scaleY),c=(KB[a.props.size]+1)*a.props.scale,d=this.editor.getEfficientZoomLevel();d<.5&&d<1.5/c||a.props.isPen||"draw"!==a.props.dash||1!==b.length||(c+=cC(a.id)()*(c/6));let e=a.props.isComplete||b5(a.props.segments)?.type==="straight",f=Kp(b,z1(a.props,c,e,!0));return new Path2D(f.length>1?Pp(f,a.props.isClosed):Ps(b[0],c))}toSvg(a,b){b.addExportDef(OI(a.props.fill));let c=1/a.props.scale;return(0,bS.jsx)("g",{transform:`scale(${c})`,children:(0,bS.jsx)(Pu,{shape:a,zoomOverride:1})})}getCanvasSvgDefs(){return[OK()]}onResize(a,b){let{scaleX:c,scaleY:d}=b;return{props:{scaleX:c*a.props.scaleX,scaleY:d*a.props.scaleY}}}expandSelectionOutlinePx(a){let b="draw"===a.props.dash?1.6:1;return KB[a.props.size]*b/2*a.props.scale}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,segments:Pr(a.props.segments,b.props.segments,c),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends so{static type="geo";static props=h_;static migrations=h1;options={showTextOutline:!0};canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:gb("")}}getGeometry(a){var b,c,d,e,f,g,h;let i,j,k,l,{props:m}=a,{scale:n}=m,o=PH(a).toGeometry(),p=Math.max(1,m.w),q=Math.max(1,m.h+m.growY),r=NZ(m.richText);return new kI({children:[o,new kM({...(b=p/n,c=q/n,d=r?PO:PS(this.editor,a),e=m.size,f=m.align,g=m.verticalAlign,h=n,i=Math.min(100,b/2),j=Math.min(KD[e]*KA.lineHeight+32,c/2),k=Math.min(b,Math.max(d.w,Math.min(i,Math.max(1,b-8)))),l=Math.min(c,Math.max(d.h,Math.min(j,Math.max(1,c-8)))),{x:("start"===f?0:"end"===f?b-k:(b-k)/2)*h,y:("start"===g?0:"end"===g?c-l:(c-l)/2)*h,width:k*h,height:l*h}),isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0,isEmptyLabel:r})]})}getHandleSnapGeometry(a){let b=this.getGeometry(a),c=b.children[0];switch(a.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:c,points:[...c.vertices,b.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:c,points:[b.bounds.center]};default:cc(a.props.geo)}}getText(a){return N$(this.editor,a.props.richText)}getFontFaces(a){return NZ(a.props.richText)?du:zW(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}component(a){let{id:b,type:c,props:d}=a,{fill:e,font:f,align:g,verticalAlign:h,size:i,richText:j}=d,k=Hq(),{editor:l}=this,m=d8("isGeoOnlySelected",()=>a.id===l.getOnlySelectedShapeId(),[l]),n=OE(l,a.id),o=NZ(a.props.richText),p=OU(.25*a.props.scale);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(ks,{children:(0,bS.jsx)(PL,{shape:a,shouldScale:!0,forceSolid:p})}),(n||!o)&&(0,bS.jsx)(sl,{style:{overflow:"hidden",width:a.props.w,height:a.props.h+d.growY},children:(0,bS.jsx)(OG,{shapeId:b,type:c,font:f,fontSize:KD[i]*a.props.scale,lineHeight:KA.lineHeight,padding:16*a.props.scale,fill:e,align:g,verticalAlign:h,richText:j,isSelected:m,labelColor:gu(k,d.labelColor,"solid"),wrap:!0,showTextOutline:this.options.showTextOutline})}),a.props.url&&(0,bS.jsx)(Pj,{url:a.props.url})]})}indicator(a){let b=OU(.25*a.props.scale),{size:c,dash:d,scale:e}=a.props,f=KB[c];return PH(a).toSvg({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*f*e,props:{strokeWidth:void 0},forceSolid:b})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=this.editor.getEfficientZoomLevel()<.25*a.props.scale,{size:c,dash:d,scale:e}=a.props,f=KB[c];return PH(a).toPath2D({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*f*e,forceSolid:b})}toSvg(a,b){let c,d=a.props.scale,e={...a,props:{...a.props,w:a.props.w/d,h:(a.props.h+a.props.growY)/d,growY:0}},f=e.props;if(b.addExportDef(OI(f.fill)),!NZ(f.richText)){let e=gq(b),g=new kt(0,0,f.w,(a.props.h+a.props.growY)/d);c=(0,bS.jsx)(OH,{fontSize:KD[f.size],font:f.font,align:f.align,verticalAlign:f.verticalAlign,richText:f.richText,labelColor:gu(e,f.labelColor,"solid"),bounds:g,padding:16,showTextOutline:this.options.showTextOutline})}return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(PL,{shouldScale:!1,shape:e,forceSolid:!1}),c]})}getCanvasSvgDefs(){return[OK()]}onResize(a,{handle:b,newPoint:c,scaleX:d,scaleY:e,initialShape:f}){let g=PP(f.props),h=g.w*d,i=(g.h+g.growY)*e,j=0,k=0;if(!NZ(a.props.richText)){let b=Math.abs(h),c=Math.abs(i),d=Math.max(b,51),e=Math.max(c,51),f=PT(this.editor,{...a,props:{...a.props,w:d*a.props.scale,h:e*a.props.scale}}),g=Math.max(b,f.w),l=Math.max(c,f.h);j=g-b,k=l-c,h=g*Math.sign(h||1),i=l*Math.sign(i||1)}let l=h*a.props.scale,m=i*a.props.scale,n=new iK(0,0);d<0&&(n.x+=l),("left"===b||"top_left"===b||"bottom_left"===b)&&(n.x+=d<0?j:-j),e<0&&(n.y+=m),("top"===b||"top_left"===b||"top_right"===b)&&(n.y+=e<0?k:-k);let{x:o,y:p}=n.rot(a.rotation).add(c);return{x:o,y:p,props:{w:Math.max(Math.abs(l),1),h:Math.max(Math.abs(m),1),growY:0}}}onBeforeCreate(a){let{props:b}=a;if(NZ(b.richText))return 0!==b.growY?{...a,props:{...b,growY:0}}:void 0;let c=PQ(b.h/b.scale,PS(this.editor,a).h,b.growY/b.scale);if(null!==c)return{...a,props:{...b,growY:c*b.scale}}}onBeforeUpdate(a,b){let{props:c}=a,{props:d}=b;if((0,zY.default)(c.richText,d.richText)&&c.font===d.font&&c.size===d.size)return;let e=NZ(c.richText),f=NZ(d.richText);if(e&&f)return;if(f)return 0!==d.growY?{...b,props:{...d,growY:0}}:void 0;let g=PP(c),h=PS(this.editor,b),{scale:i}=d;if(e&&!f){let a=function(a,b,c){let d=Math.max(a,c.w),e=Math.max(b,c.h);if(a<51&&b<51){let a=Math.max(d=Math.max(d,51),e=Math.max(e,51));d=a,e=a}return{w:d,h:e}}(g.w,g.h,h);return{...b,props:{...d,w:a.w*i,h:a.h*i,growY:0}}}let j=b.props.w/i,k=h.w>j,l=PQ(g.h,h.h,g.growY);if(null!==l||k)return{...b,props:{...d,growY:(l??g.growY)*i,w:Math.max(j,h.w)*i}}}onDoubleClick(a){if(this.editor.inputs.getAltKey())switch(a.props.geo){case"rectangle":return{...a,props:{geo:"check-box"}};case"check-box":return{...a,props:{geo:"rectangle"}}}}getInterpolatedProps(a,b,c){var d,e,f;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c),scale:(f=a.props.scale,f+(b.props.scale-f)*c)}}},class extends kO{static type="note";static props=ih;static migrations=ij;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){let{resizeMode:a}=this.options;switch(a){case"none":return!0;case"scale":return!1;default:throw cc(a)}}isAspectRatioLocked(){return"scale"===this.options.resizeMode}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:gb(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(a){let{labelHeight:b,labelWidth:c}=Qg(this.editor,a),{scale:d}=a.props,e=b*d,f=c*d,g=200*d,h=Qh(a);return new kI({children:[new kM({width:g,height:h,isFilled:!0}),new kM({x:"start"===a.props.align?0:"end"===a.props.align?g-f:(g-f)/2,y:"start"===a.props.verticalAlign?0:"end"===a.props.verticalAlign?h-e:(h-e)/2,width:f,height:e,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getHandles(a){let{scale:b}=a.props;if(this.editor.getInstanceState().isCoarsePointer)return[];let c=this.editor.getEfficientZoomLevel();if(c*b<.25)return[];let d=Qh(a),e=200*b,f=0/c*b;return c*b<.5?[{id:"bottom",index:"a3",type:"clone",x:e/2,y:d+f}]:[{id:"top",index:"a1",type:"clone",x:e/2,y:-f},{id:"right",index:"a2",type:"clone",x:e+f,y:d/2},{id:"bottom",index:"a3",type:"clone",x:e/2,y:d+f},{id:"left",index:"a4",type:"clone",x:-f,y:d/2}]}onResize(a,b){let{resizeMode:c}=this.options;switch(c){case"none":return;case"scale":return sp(a,b);default:throw cc(c)}}getText(a){return N$(this.editor,a.props.richText)}getFontFaces(a){return NZ(a.props.richText)?du:zW(this.editor,a.props.richText,{family:`tldraw_${a.props.font}`,weight:"normal",style:"normal"})}component(a){var b,c,d,e;let f,g,h,i,j,k,l,m,n,{id:o,type:p,props:{labelColor:q,scale:r,color:s,font:t,size:u,align:v,richText:w,verticalAlign:y,fontSizeAdjustment:z}}=a,A=(b=o,f=jA(),g=(0,bT.useContext)(Ak),(0,bT.useCallback)(a=>{let c=f.getShape(b);if(!c)return;let d="Tab"===a.key,e=(a.metaKey||a.ctrlKey)&&"Enter"===a.key;if(d||e){var h;a.preventDefault();let i=f.getShapePageTransform(b),j=i.rotation(),k=!!(g?.dir==="rtl"||(h=N$(f,c.props.richText),N1.test(h))),l=(200+f.options.adjacentShapeMargin+(e&&!a.shiftKey?c.props.growY:0))*c.props.scale,m=new iK(d?a.shiftKey!=k?-1:1:0,e?a.shiftKey?-1:1:0).mul(l).add(Or.clone().mul(c.props.scale)).rot(j).add(i.point()),n=Ou(f,c,m,j);n&&z9(f,n,{selectAll:!0})}},[b,f,g?.dir])),B=Hq(),C=Qh(a),D=d8("shape rotation",()=>this.editor.getShapePageTransform(o)?.rotation()??0,[this.editor]),E=d8("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),F=OU(.25*r);E&&(F=!0);let G=a.id===this.editor.getOnlySelectedShapeId(),H=OE(this.editor,a.id),I=NZ(w);return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("div",{id:o,className:"tl-note__container",style:{width:200*r,height:C,backgroundColor:gu(B,s,"noteFill"),borderBottom:F?E?`${2*r}px solid rgb(20, 20, 20)`:`${2*r}px solid rgb(144, 144, 144)`:"none",boxShadow:F?"none":(c=a.id,d=D,e=r,i=Math.abs((h=cC(c))())+.5,j=Math.cos(d),k=5*e,l=4*e,m=6*e,n=7*e,`0px ${k-i}px ${k}px -${k}px rgba(15, 23, 31, .6),
	0px ${(l+i*n)*Math.max(0,j)}px ${m+i*n}px -${l+i*m}px rgba(15, 23, 31, ${(.3+.1*i).toFixed(2)}), 
	0px ${48*e}px ${10*e}px -${10*e}px inset rgba(15, 23, 44, ${((.022+.005*h())*((1+j)/2)).toFixed(2)})`)},children:(G||H||!I)&&(0,bS.jsx)(OG,{shapeId:o,type:p,font:t,fontSize:(z||KD[u])*r,lineHeight:KA.lineHeight,align:v,verticalAlign:y,richText:w,isSelected:G,labelColor:"black"===q?gu(B,s,"noteText"):gu(B,q,"fill"),wrap:!0,padding:16*r,hasCustomTabBehavior:!0,showTextOutline:!1,onKeyDown:A})}),"url"in a.props&&a.props.url&&(0,bS.jsx)(Pj,{url:a.props.url})]})}indicator(a){let{scale:b}=a.props;return(0,bS.jsx)("rect",{rx:b,width:i5(200*b),height:i5(Qh(a))})}useLegacyIndicator(){return!1}getIndicatorPath(a){let{scale:b}=a.props,c=new Path2D;return c.roundRect(0,0,200*b,Qh(a),b),c}toSvg(a,b){let c=gq({isDarkMode:b.isDarkMode}),d=new kt(0,0,200,200+a.props.growY),e=(0,bS.jsx)(OH,{fontSize:a.props.fontSizeAdjustment||KD[a.props.size],font:a.props.font,align:a.props.align,verticalAlign:a.props.verticalAlign,richText:a.props.richText,labelColor:gu(c,a.props.color,"noteText"),bounds:d,padding:16,showTextOutline:!1});return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("rect",{x:5,y:5,rx:1,width:190,height:d.h,fill:"rgba(0,0,0,.1)"}),(0,bS.jsx)("rect",{rx:1,width:200,height:d.h,fill:gu(c,a.props.color,"noteFill")}),e]})}onBeforeCreate(a){return Qe(this.editor,a)}onBeforeUpdate(a,b){if(!(0,zY.default)(a.props.richText,b.props.richText)||a.props.font!==b.props.font||a.props.size!==b.props.size)return Qe(this.editor,b)}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends kO{static type="line";static props=id;static migrations=ig;hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}hideInMinimap(){return!0}getDefaultProps(){let[a,b]=c5(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[a]:{id:a,index:a,x:0,y:0},[b]:{id:b,index:b,x:.1,y:.1}},scale:1}}getGeometry(a){let b=Qc(a).toGeometry();return cd(b instanceof z5),b}getHandles(a){return P9.get(a.props,()=>{let b=this.getGeometry(a),c=Qa(a),d=c.map(a=>({...a,id:a.index,type:"vertex",canSnap:!0}));for(let a=0;a<c.length-1;a++){let e=c3(c[a].index,c[a+1].index),f=b.getSegments()[a].interpolateAlongEdge(.5);d.push({id:e,type:"create",index:e,x:f.x,y:f.y,canSnap:!0})}return d.sort(c6)})}onResize(a,b){let{scaleX:c,scaleY:d}=b;return{props:{points:cL(a.props.points,(a,{id:b,index:e,x:f,y:g})=>({id:b,index:e,x:f*c,y:g*d}))}}}onBeforeCreate(a){let{props:{points:b}}=a,c=Object.keys(b);if(c.length<2)return;let d=b[c[0]];if(c.every(a=>{let c=b[a];return c.x===d.x&&c.y===d.y})){let d=c[c.length-1];return b[d]={...b[d],x:b[d].x+.1,y:b[d].y+.1},a}}onHandleDrag(a,{handle:b}){let c=ss(new iK(b.x,b.y),this.editor);return{...a,props:{...a.props,points:{...a.props.points,[b.id]:{id:b.id,index:b.index,x:c.x,y:c.y}}}}}onHandleDragStart(a,{handle:b}){if("create"===b.type)return{...a,props:{...a.props,points:{...a.props.points,[b.index]:{id:b.index,index:b.index,x:b.x,y:b.y}}}}}component(a){return(0,bS.jsx)(ks,{style:{minWidth:50,minHeight:50},children:(0,bS.jsx)(Qd,{shape:a})})}indicator(a){let b=Fm[a.props.size]*a.props.scale,c=Qc(a),{dash:d}=a.props;return c.toSvg({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*b,props:{strokeWidth:void 0}})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=Fm[a.props.size]*a.props.scale,c=Qc(a),{dash:d}=a.props;return c.toPath2D({style:"draw"===d?"draw":"solid",strokeWidth:1,passes:1,randomSeed:a.id,offset:0,roundness:2*b})}toSvg(a){return(0,bS.jsx)(Qd,{shouldScale:!0,shape:a})}getHandleSnapGeometry(a){let b=Qa(a);return{points:b,getSelfSnapPoints:c=>{let d=this.getHandles(a).filter(a=>"vertex"===a.type).findIndex(a=>a.id===c.id);return b.filter((a,b)=>Math.abs(b-d)>1).map(iK.From)},getSelfSnapOutline:b=>{let c=this.getHandles(a).filter(a=>"vertex"===a.type).findIndex(a=>a.id===b.id),d=this.getGeometry(a).getSegments().filter((a,b)=>b!==c-1&&b!==c);return d.length?new kI({children:d}):null}}}getInterpolatedProps(a,b,c){var d;let e=Qa(a),f=Qa(b),g=[],h=[],i="a0";if(e.length>f.length)for(let a=0;a<e.length;a++)g[a]={...e[a]},void 0===f[a]?h[a]={...f[f.length-1],id:i}:h[a]={...f[a],id:i},i=c4(i);else if(f.length>e.length)for(let a=0;a<f.length;a++)h[a]={...f[a]},void 0===e[a]?g[a]={...e[e.length-1],id:i}:g[a]={...e[a],id:i},i=c4(i);else for(let a=0;a<f.length;a++)g[a]=e[a],h[a]=f[a];return{...c>.5?b.props:a.props,points:Object.fromEntries(g.map((a,b)=>{var d,e;let f=h[b];return[a.id,{...a,x:(d=a.x,d+(f.x-d)*c),y:(e=a.y,e+(f.y-e)*c)}]})),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},class extends so{static type="frame";static props=hW;static migrations=hX;options={showColors:!1,resizeChildren:!1};static configure(a){let b=super.configure.call(this,a);return a.showColors&&(b.props={...b.props,color:gr}),b}canEdit(a,b){return"click-header"===b.type||"unknown"===b.type}canResize(){return!0}canResizeChildren(){return this.options.resizeChildren}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(a){return a.props.name}getGeometry(a){let b,c,{editor:d}=this,e=d.getEfficientZoomLevel(),f=Py(d,a),g=f%2==1,h=g?a.props.h:a.props.w,i=PA(d,a,PB(h,!1)),j=this.options.showColors,k=12/e,l=i.w/e,m=i.h/e,n=iS(l+k,32/e,h+(j?1:k)),o=(j?-1:-7)/e,p=4/e,q=g?m:n,r=g?n:m;switch(f){case 0:b=o,c=-(m+p);break;case 1:b=-(m+p),c=a.props.h-(o+n);break;case 2:b=a.props.w-(o+n),c=a.props.h+p;break;case 3:b=a.props.w+p,c=o}return new kI({children:[new kM({width:a.props.w,height:a.props.h,isFilled:!1}),new kM({x:b,y:c,width:q,height:r,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getText(a){return a.props.name}component(a){let b=Hq(),c=d8("is creating this shape",()=>{let b=this.editor.getStateDescendant("select.resizing");if(!b||!b.getIsActive())return!1;let c=b?.info;return!!c&&c.isCreating&&this.editor.getOnlySelectedShapeId()===a.id},[a.id]),d=this.options.showColors,e=d?a.props.color:"black",f=gu(b,e,"frameFill"),g=gu(b,e,"frameStroke"),h=d?gu(b,e,"frameHeadingStroke"):b.background,i=d?gu(b,e,"frameHeadingFill"):b.background,j=gu(b,e,"frameText");return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(ks,{children:(0,bS.jsx)("rect",{className:(0,jb.default)("tl-frame__body",{"tl-frame__creating":c}),fill:f,stroke:g,style:{width:`calc(${a.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${a.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),c?null:(0,bS.jsx)(PE,{id:a.id,name:a.props.name,fill:i,stroke:h,color:j,width:a.props.w,height:a.props.h,offsetX:d?-1:-7,showColors:this.options.showColors})]})}toSvg(a,b){let c=gq({isDarkMode:b.isDarkMode}),d=Py(this.editor,a),e=d%2==1?a.props.h:a.props.w,f=PC(a,d,!0),g=PB(e-12,!0),h=PF(a.props.name,"Frame")+String.fromCharCode(8203),i=PA(this.editor,a,g),j=this.editor.textMeasure.measureTextSpans(h,g),k=function(a,b,c){let{padding:d=0}=c;if(0===b.length)return null;let e=kt.From(b[0].box);for(let{box:a}of b)e.union(a);let f=d+(c.offsetX??0),g=(c.offsetY??0)+c.fontSize/2+("start"===c.verticalTextAlign?d:"end"===c.verticalTextAlign?c.height-d-e.height:(Math.ceil(c.height)-e.height)/2),h=null,i=[];for(let{text:a,box:c}of b)null!==h&&c.y>h&&i.push((0,bS.jsx)("tspan",{alignmentBaseline:"mathematical",x:f,y:c.y+g,children:"\n"},i.length)),i.push((0,bS.jsx)("tspan",{alignmentBaseline:"mathematical",x:c.x+f,y:c.y+g,unicodeBidi:"plaintext",children:a.replace(/\s/g," ")},i.length)),h=c.y;return(0,bS.jsx)("text",{fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:c.stroke,strokeWidth:c.strokeWidth,fill:c.fill,children:i})}(this.editor,j,g),l=this.options.showColors,m=l?a.props.color:"black",n=gu(c,m,"frameFill"),o=gu(c,m,"frameStroke"),p=l?gu(c,m,"frameHeadingStroke"):c.background,q=l?gu(c,m,"frameHeadingFill"):c.background,r=gu(c,m,"frameText");return(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)("rect",{width:a.props.w,height:a.props.h,fill:n,stroke:o,strokeWidth:1,x:0,rx:0,ry:0}),(0,bS.jsxs)("g",{fill:r,transform:f,children:[(0,bS.jsx)("rect",{x:i.x-6*!l,y:i.y-6,width:Math.min(e,i.width+12),height:i.height,fill:q,stroke:p,rx:4,ry:4}),(0,bS.jsx)("g",{transform:`translate(${8*!!l}, 4)`,children:k})]})]})}indicator(a){return(0,bS.jsx)("rect",{width:i5(a.props.w),height:i5(a.props.h)})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=new Path2D;return b.rect(0,0,a.props.w,a.props.h),b}providesBackgroundForChildren(){return!0}getClipPath(a){return this.editor.getShapeGeometry(a.id).vertices}canReceiveNewChildrenOfType(a){return!a.isLocked}onResize(a,b){return sn(a,b)}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c)}}onDoubleClickEdge(a,b){if("selection"!==b.target)return;let{handle:c}=b;if(!c)return;let d="left"===c||"right"===c,e="top"===c||"bottom"===c,f=this.editor.getSortedChildIdsForParent(a.id),g=b4(f.map(a=>this.editor.getShape(a)));if(!g.length)return;let{dx:h,dy:i,w:j,h:k}=Ay(g,this.editor,{padding:10});return this.editor.run(()=>{let a=f.map(a=>{let b=this.editor.getShape(a);return{id:b.id,type:b.type,x:d?b.x+h:b.x,y:e?b.y+i:b.y}});this.editor.updateShapes(a)}),{id:a.id,type:a.type,props:{w:d?j:a.props.w,h:e?k:a.props.h}}}onDoubleClickCorner(a){return Az(this.editor,a.id,{padding:10}),{id:a.id,type:a.type}}onDragShapesIn(a,b,{initialParentIds:c,initialIndices:d}){let{editor:e}=this;if(b.every(b=>b.parentId===a.id))return;let f=!1,g=b.filter(b=>a.id===c.get(b.id));if(g.length>0){let b=b4(e.getSortedChildIdsForParent(a).map(a=>e.getShape(a)));g.every(a=>!b.find(b=>b.index===a.index))&&(f=!0)}if(!b.some(b=>e.hasAncestor(a,b.id))&&(e.reparentShapes(b,a.id),f))for(let a of g)e.updateShape({id:a.id,type:a.type,index:d.get(a.id)})}onDragShapesOut(a,b,c){let{editor:d}=this;c.nextDraggingOverShapeId||d.reparentShapes(b.filter(b=>b.parentId===a.id&&this.canReceiveNewChildrenOfType(b)),d.getCurrentPageId())}},Pc,class extends kO{static type="highlight";static props=h4;static migrations=h6;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};hideResizeHandles(a){return PX(a)}hideRotateHandle(a){return PX(a)}hideSelectionBoundsFg(a){return PX(a)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1,scaleX:1,scaleY:1}}getGeometry(a){let b=PW(a);if(PX(a))return new sy({x:-b/2,y:-b/2,radius:b/2,isFilled:!0});let{strokePoints:c,sw:d}=PV(a,b,!0),e=z0({strokeWidth:d,showAsComplete:!0});return Kr(c,e),new kL({points:Ko(c,e),isFilled:!0})}component(a){let b=PZ(this.editor,a),c=PW(a);return(0,bS.jsx)(ks,{children:(0,bS.jsx)(PY,{shape:a,forceSolid:b,strokeWidth:c,opacity:this.options.overlayOpacity})})}backgroundComponent(a){let b=PZ(this.editor,a),c=PW(a);return(0,bS.jsx)(ks,{children:(0,bS.jsx)(PY,{shape:a,forceSolid:b,strokeWidth:c,opacity:this.options.underlayOpacity})})}indicator(a){let b,c=PZ(this.editor,a),d=PW(a),{strokePoints:e,sw:f}=PV(a,d,c),g=z2(a.props.segments,a.props.scaleX,a.props.scaleY);return b=e.length<2?PU(g[0],f):Pp(e,!1),(0,bS.jsx)("path",{d:b})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=PW(a),{strokePoints:c,sw:d}=PV(a,b,b/this.editor.getEfficientZoomLevel()<1.5),e=z2(a.props.segments,a.props.scaleX,a.props.scaleY);return new Path2D(c.length<2?PU(e[0],d):Pp(c,!1))}toSvg(a){let b=PW(a),c=1/a.props.scale;return(0,bS.jsx)("g",{transform:`scale(${c})`,children:(0,bS.jsx)(PY,{forceSolid:b<1.5,strokeWidth:b,shape:a,opacity:this.options.overlayOpacity})})}toBackgroundSvg(a){let b=PW(a),c=1/a.props.scale;return(0,bS.jsx)("g",{transform:`scale(${c})`,children:(0,bS.jsx)(PY,{forceSolid:b<1.5,strokeWidth:b,shape:a,opacity:this.options.underlayOpacity})})}onResize(a,b){let{scaleX:c,scaleY:d}=b;return{props:{scaleX:c*a.props.scaleX,scaleY:d*a.props.scaleY}}}getInterpolatedProps(a,b,c){var d;return{...c>.5?b.props:a.props,...b.props,segments:Pr(a.props.segments,b.props.segments,c),scale:(d=a.props.scale,d+(b.props.scale-d)*c)}}},Pw,class extends so{static type="image";static props=h8;static migrations=ia;isAspectRatioLocked(){return!0}canCrop(){return!0}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(a){return a.props.crop?.isCircle?new sA({width:a.props.w,height:a.props.h,isFilled:!0}):new kM({width:a.props.w,height:a.props.h,isFilled:!0})}getAriaDescriptor(a){return a.props.altText}onResize(a,b){let c=sn(a,b),{flipX:d,flipY:e}=b.initialShape.props,{scaleX:f,scaleY:g,mode:h}=b;if(c={...c,props:{...c.props,flipX:f<0!==d,flipY:g<0!==e}},!a.props.crop)return c;let i="scale_shape"===h&&-1===f||"resize_bounds"===h&&d!==c.props.flipX,j="scale_shape"===h&&-1===g||"resize_bounds"===h&&e!==c.props.flipY,{topLeft:k,bottomRight:l}=a.props.crop;return c.props.crop={topLeft:{x:i?1-l.x:k.x,y:j?1-l.y:k.y},bottomRight:{x:i?1-k.x:l.x,y:j?1-k.y:l.y},isCircle:a.props.crop.isCircle},c}component(a){return(0,bS.jsx)(P3,{shape:a})}indicator(a){return this.editor.getCroppingShapeId()===a.id?null:a.props.crop?.isCircle?(0,bS.jsx)("ellipse",{cx:i5(a.props.w/2),cy:i5(a.props.h/2),rx:i5(a.props.w/2),ry:i5(a.props.h/2)}):(0,bS.jsx)("rect",{width:i5(a.props.w),height:i5(a.props.h)})}useLegacyIndicator(){return!1}getIndicatorPath(a){if(this.editor.getCroppingShapeId()===a.id)return;let b=new Path2D;if(a.props.crop?.isCircle){let c=a.props.w/2,d=a.props.h/2;b.ellipse(c,d,c,d,0,0,2*Math.PI)}else b.rect(0,0,a.props.w,a.props.h);return b}async toSvg(a,b){let c=a.props;if(!c.assetId)return null;let d=this.editor.getAsset(c.assetId);if(!d)return null;let{w:e}=H$(a.props,c.crop),f=await P2.get(d,async()=>{let a=await b.resolveAssetUrl(d.id,e);if(!a)return null;if((a.startsWith("blob:")||a.startsWith("http")||a.startsWith("/")||a.startsWith("./"))&&(a=await P1(a)||""),P4(this.editor,d.id)){let{promise:b}=P8(a);a=await b}return a});return f?(0,bS.jsx)(P7,{shape:a,src:f}):null}onDoubleClickEdge(a){let b=a.props;if(!b||this.editor.getCroppingShapeId()!==a.id)return;let c=dk(b.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:d,h:e}=H$(a.props,c),f=new iK(c.topLeft.x*d,c.topLeft.y*e).rot(a.rotation),g={id:a.id,type:a.type,x:a.x-f.x,y:a.y-f.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:d,h:e}};this.editor.updateShapes([g])}getInterpolatedProps(a,b,c){var d,e;return{...c>.5?b.props:a.props,w:(d=a.props.w,d+(b.props.w-d)*c),h:(e=a.props.h,e+(b.props.h-e)*c),crop:function(a,b){var d,e,f,g;if(null===a.props.crop&&null===b.props.crop)return null;let h=a.props.crop?.topLeft||{x:0,y:0},i=a.props.crop?.bottomRight||{x:1,y:1},j=b.props.crop?.topLeft||{x:0,y:0},k=b.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:(d=h.x,d+(j.x-d)*c),y:(e=h.y,e+(j.y-e)*c)},bottomRight:{x:(f=i.x,f+(k.x-f)*c),y:(g=i.y,g+(k.y-g)*c)}}}(a,b)}}},class extends so{static type="video";static props=ip;static migrations=ir;options={autoplay:!0};canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(a){return a.props.altText}component(a){return(0,bS.jsx)(Ql,{shape:a})}indicator(a){return(0,bS.jsx)("rect",{width:i5(a.props.w),height:i5(a.props.h)})}useLegacyIndicator(){return!1}getIndicatorPath(a){let b=new Path2D;return b.rect(0,0,a.props.w,a.props.h),b}async toSvg(a,b){let c=a.props;if(!c.assetId)return null;let d=this.editor.getAsset(c.assetId);if(!d)return null;let e=await Qk.get(d,async()=>{let a=await b.resolveAssetUrl(d.id,c.w);if(!a)return null;let e=await cB.loadVideo(a);return await cB.getVideoFrameAsDataUrl(e,0)});return e?(0,bS.jsx)("image",{href:e,width:c.w,height:c.h,"aria-label":a.props.altText}):null}}];class Qn extends pd{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;_isHoldingAccelKey=!1;_firstErasingShapeId=null;_erasingShapeIds=[];onEnter(a){this._isHoldingAccelKey=jr(this.editor.inputs),this._firstErasingShapeId=this.editor.getErasingShapeIds()[0],this._erasingShapeIds=this.editor.getErasingShapeIds(),this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=a;let b=this.editor.inputs.getOriginPagePoint();this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(a=>{if(this.editor.isShapeOrAncestorLocked(a))return!0;if(this.editor.isShapeOfType(a,"group")||this.editor.isShapeOfType(a,"frame")){let c=this.editor.getPointInShapeSpace(a,b);return this.editor.getShapeGeometry(a).bounds.containsPoint(c)}return!1}).map(a=>a.id));let c=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=c.id,this.update()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.getCurrentPagePoint();this.editor.scribbles.addPoint(this.scribbleId,a,b)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onKeyUp(){this._isHoldingAccelKey=jr(this.editor.inputs),this.update()}onKeyDown(){this._isHoldingAccelKey=jr(this.editor.inputs),this.update()}update(){let{editor:a,excludedShapeIds:b}=this,c=a.getErasingShapeIds(),d=a.getZoomLevel(),e=a.inputs.getCurrentPagePoint(),f=a.inputs.getPreviousPagePoint();this.pushPointToScribble();let g=new Set(c),h=this.editor.options.hitTestMargin/d,i=kt.FromPoints([f,e]).expandBy(h),j=a.getShapeIdsInsideBounds(i);if(0===j.size)return void a.setErasingShapes(Array.from(g));for(let b of a.getCurrentPageRenderingShapesSorted().filter(a=>j.has(a.id))){if(a.isShapeOfType(b,"group"))continue;let c=a.getShapeMask(b.id);if(c&&!i4(e,c))continue;let d=a.getShapeGeometry(b),i=a.getShapePageTransform(b);if(!d||!i)continue;let j=i.clone().invert(),k=j.applyToPoint(f),l=j.applyToPoint(e),{bounds:m}=d;m.minX-h>Math.max(k.x,l.x)||m.minY-h>Math.max(k.y,l.y)||m.maxX+h<Math.min(k.x,l.x)||m.maxY+h<Math.min(k.y,l.y)||(d.hitTestLineSegment(k,l,h)&&g.add(a.getOutermostSelectableShape(b).id),this._erasingShapeIds=[...g])}if(this._isHoldingAccelKey&&this._firstErasingShapeId){let b=this._firstErasingShapeId;b&&this.editor.getShape(b)&&a.setErasingShapes([b]);return}this.editor.setErasingShapes(this._erasingShapeIds.filter(a=>!b.has(a)))}complete(){let{editor:a}=this;a.deleteShapes(a.getCurrentPageState().erasingShapeIds),this.parent.transition("idle"),this._erasingShapeIds=[],this._firstErasingShapeId=null}cancel(){let{editor:a}=this;a.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class Qo extends pd{static id="idle";onPointerDown(a){this.parent.transition("pointing",a)}onCancel(){this.editor.setCurrentTool("select")}}class Qp extends pd{static id="pointing";_isHoldingAccelKey=!1;onEnter(){this._isHoldingAccelKey=jr(this.editor.inputs);let a=this.editor.getZoomLevel(),b=this.editor.getCurrentPageRenderingShapesSorted(),c=this.editor.inputs.getCurrentPagePoint(),d=new Set,e=d.size;for(let f=b.length,g=f-1;g>=0;g--){let f=b[g];if(!(this.editor.isShapeOrAncestorLocked(f)||this.editor.isShapeOfType(f,"group"))&&this.editor.isPointInShape(f,c,{hitInside:!1,margin:this.editor.options.hitTestMargin/a})){let a=this.editor.getOutermostSelectableShape(f);if(this.editor.isShapeOfType(a,"frame")&&d.size>e||(d.add(a.id),this._isHoldingAccelKey))break}}this.editor.setErasingShapes([...d])}onKeyUp(){this._isHoldingAccelKey=jr(this.editor.inputs)}onKeyDown(){this._isHoldingAccelKey=jr(this.editor.inputs)}onLongPress(a){this.startErasing(a)}onExit(a,b){"erasing"!==b&&this.editor.setErasingShapes([])}onPointerMove(a){!this._isHoldingAccelKey&&this.editor.inputs.getIsDragging()&&this.startErasing(a)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(a){this.parent.transition("erasing",a)}complete(){let a=this.editor.getErasingShapeIds();a.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(a)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class Qq extends pd{static id="dragging";initialCamera=new iK;onEnter(){this.initialCamera=iK.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){let{initialCamera:a,editor:b}=this,c=b.inputs.getCurrentScreenPoint(),d=b.inputs.getOriginScreenPoint(),e=iK.Sub(c,d).div(b.getZoomLevel());0!==e.len2()&&b.setCamera(a.clone().add(e))}complete(){let{editor:a}=this,b=a.inputs.getPointerVelocity(),c=Math.min(b.len(),2);c>.1&&this.editor.slideCamera({speed:c,direction:b}),this.parent.transition("idle")}}class Qr extends pd{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(a){this.parent.transition("pointing",a)}onCancel(){this.editor.setCurrentTool("select")}}class Qs extends pd{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.getIsDragging()&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}}class Qt extends pd{static id="idle";onPointerDown(){let a=this.parent.getSessionId(),b=this.editor.scribbles.addScribbleToSession(a,{color:"laser",opacity:.7,size:4,taper:!1});this.parent.transition("lasering",{sessionId:a,scribbleId:b.id})}}class Qu extends pd{static id="lasering";scribbleId="";sessionId="";onEnter(a){this.sessionId=a.sessionId,this.scribbleId=a.scribbleId,this.pushPointToScribble()}onPointerMove(){this.pushPointToScribble()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.getCurrentPagePoint();this.editor.scribbles.addPointToSession(this.sessionId,this.scribbleId,a,b)}onTick(){this.editor.scribbles.extendSession(this.sessionId)}onPointerUp(){this.complete()}onCancel(){this.onComplete()}onComplete(){this.complete()}complete(){this.editor.scribbles.complete(this.scribbleId),this.parent.transition("idle")}}class Qv extends pd{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}onEnter(a){let{editor:b}=this,c=b.inputs.getAltKey();this.isWrapMode=b.user.getIsWrapMode(),this.viewportDidChange=!1;let d=!0;(this.cleanupViewportChangeReactor=dA("viewport change while brushing",()=>{b.getViewportPageBounds(),d||this.viewportDidChange||(this.viewportDidChange=!0)}),c)?this.parent.transition("scribble_brushing",a):(this.excludedShapeIds=new Set(b.getCurrentPageShapes().filter(a=>b.isShapeOfType(a,"group")||b.isShapeOrAncestorLocked(a)).map(a=>a.id)),this.info=a,this.initialSelectedShapeIds=b.getSelectedShapeIds().slice(),this.hitTestShapes(),d=!1)}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:a}){let{editor:b}=this;!b.inputs.getIsDragging()||b.inputs.getIsPanning()||b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(a){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",a)}onKeyDown(a){this.editor.inputs.getAltKey()?this.parent.transition("scribble_brushing",a):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){let a,b,c,d,e,f,{editor:g,excludedShapeIds:h,isWrapMode:i}=this,j=g.inputs.getOriginPagePoint(),k=g.inputs.getCurrentPagePoint(),l=g.inputs.getShiftKey(),m=g.inputs.getCtrlKey(),n=new Set(l?this.initialSelectedShapeIds:[]),o=i?!m:m,p=kt.FromPoints([j,k]),{corners:q}=p,r=g.getViewportPageBounds().contains(p),s=g.getCurrentPageId(),t=g.getShapeIdsInsideBounds(p);if(0===t.size){let a=g.getInstanceState().brush;a&&p.equals(a)||g.updateInstanceState({brush:{...p.toJson()}});let b=g.getSelectedShapeIds();(b.length!==n.size||b.some(a=>!n.has(a)))&&g.setSelectedShapes(Array.from(n));return}let u=(r&&!this.viewportDidChange?g.getCurrentPageRenderingShapesSorted():g.getCurrentPageShapesSorted()).filter(a=>t.has(a.id));for(let i=0,j=u.length;i<j;i++){if(c=u[i],!(h.has(c.id)||n.has(c.id))&&(d=g.getShapePageBounds(c))){if(p.contains(d)){this.handleHit(c,k,s,n,q);continue}if(!(o||g.isShapeOfType(c,"frame"))&&p.collides(d)){if(!(e=g.getShapePageTransform(c)))continue;f=e.clone().invert().applyToPoints(q);let d=g.getShapeGeometry(c);for(let e=0;e<4;e++)if(a=f[e],b=f[(e+1)%4],d.hitTestLineSegment(a,b,0)){this.handleHit(c,k,s,n,q);break}}}}let v=g.getInstanceState().brush;v&&p.equals(v)||g.updateInstanceState({brush:{...p.toJson()}});let w=g.getSelectedShapeIds();(w.length!==n.size||w.some(a=>!n.has(a)))&&g.setSelectedShapes(Array.from(n))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(a,b,c,d,e){if(a.parentId===c)return void d.add(a.id);let f=this.editor.getOutermostSelectableShape(a),g=this.editor.getShapeMask(f.id);(!g||kD(g,e)||i4(b,g))&&d.add(f.id)}}let Qw={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class Qx extends pd{static id="pointing_resize_handle";info={};updateCursor(){let a=this.editor.getSelectedShapes(),b=Qw[this.info.handle];this.editor.setCursor({type:b,rotation:1===a.length?this.editor.getSelectionRotation():0})}onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.getIsDragging()&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class Qy extends pd{static id="cropping";info={};markId="";snapshot={};onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0)}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;let a=Qw[this.info.handle];this.editor.setCursor({type:a,rotation:this.editor.getSelectionRotation()})}updateShapes(){let{shape:a,cursorHandleOffset:b}=this.snapshot;if(!a)return;let c=this.editor.getShapeUtil(a.type);if(!c)return;let d=this.editor.inputs.getShiftKey(),e=this.editor.inputs.getCurrentPagePoint().clone().sub(b),f=this.editor.inputs.getOriginPagePoint().clone().sub(b),g=e.clone().sub(f).rot(-a.rotation),h=a.props.crop??HX(),i=H$(a.props,h),j=(c.onCrop?.bind(c)??function(a,b,c={}){let{handle:d,change:e,crop:f,aspectRatioLocked:g}=b,{w:h,h:i}=b.uncroppedSize,{minWidth:j=8,minHeight:k=8}=c;if(h<j||i<k||0===e.x&&0===e.y)return;let l=new kt(f.topLeft.x*h,f.topLeft.y*i,(f.bottomRight.x-f.topLeft.x)*h,(f.bottomRight.y-f.topLeft.y)*i),m=l.aspectRatio,n=l.clone();if("top_left"===d||"bottom_left"===d||"left"===d)n.x=iS(n.x+e.x,0,l.maxX-j),n.w=l.maxX-n.x;else if("top_right"===d||"bottom_right"===d||"right"===d){let a=iS(n.maxX+e.x,l.x+j,h);n.w=a-n.x}if("top_left"===d||"top_right"===d||"top"===d)n.y=iS(n.y+e.y,0,l.maxY-k),n.h=l.maxY-n.y;else if("bottom_left"===d||"bottom_right"===d||"bottom"===d){let a=iS(n.maxY+e.y,l.y+k,i);n.h=a-n.y}if(g)switch(n.aspectRatio>m?n.h=n.w/m:n.w=n.h*m,d){case"top_left":n.x=l.maxX-n.w,n.y=l.maxY-n.h,n.x<=0&&(n.x=0,n.w=l.maxX-n.x,n.h=n.w/m,n.y=l.maxY-n.h),n.y<=0&&(n.y=0,n.h=l.maxY-n.y,n.w=n.h*m,n.x=l.maxX-n.w);break;case"top_right":n.x=l.x,n.y=l.maxY-n.h,n.maxX>=h&&(n.w=h-l.x,n.h=n.w/m,n.y=l.maxY-n.h),n.y<=0&&(n.y=0,n.h=l.maxY-n.y,n.w=n.h*m);break;case"bottom_left":n.x=l.maxX-n.w,n.y=l.y,n.x<=0&&(n.x=0,n.w=l.maxX-n.x,n.h=n.w/m),n.maxY>=i&&(n.h=i-l.y,n.w=n.h*m,n.x=l.maxX-n.w);break;case"bottom_right":n.x=l.x,n.y=l.y,n.maxX>=h&&(n.w=h-l.x,n.h=n.w/m),n.maxY>=i&&(n.h=i-l.y,n.w=n.h*m);break;case"top":n.h=l.maxY-n.y,n.w=n.h*m,n.x-=(n.w-l.w)/2,n.x<=0&&(n.w=2*l.midX,n.h=n.w/m,n.x=0),n.maxX>=h&&(n.w=2*(h-l.midX),n.h=n.w/m,n.x=h-n.w),n.y=l.maxY-n.h;break;case"right":n.w=n.maxX-l.x,n.h=n.w/m,n.y-=(n.h-l.h)/2,n.y<=0&&(n.h=2*l.midY,n.w=n.h*m,n.y=0),n.maxY>=i&&(n.h=2*(i-l.midY),n.w=n.h*m,n.y=i-n.h);break;case"bottom":n.h=n.maxY-l.y,n.w=n.h*m,n.x-=(n.w-l.w)/2,n.x<=0&&(n.w=2*l.midX,n.h=n.w/m,n.x=0),n.maxX>=h&&(n.w=2*(h-l.midX),n.h=n.w/m,n.x=h-n.w);break;case"left":n.w=l.maxX-n.x,n.h=n.w/m,n.y-=(n.h-l.h)/2,n.y<=0&&(n.h=2*l.midY,n.w=n.h*m,n.y=0),n.maxY>=i&&(n.h=2*(i-l.midY),n.w=n.h*m,n.y=i-n.h),n.x=l.maxX-n.w}let o={topLeft:{x:n.x/h,y:n.y/i},bottomRight:{x:n.maxX/h,y:n.maxY/i},isCircle:f.isCircle};if(o.topLeft.x===f.topLeft.x&&o.topLeft.y===f.topLeft.y&&o.bottomRight.x===f.bottomRight.x&&o.bottomRight.y===f.bottomRight.y)return;let p=new iK(n.x-f.topLeft.x*h,n.y-f.topLeft.y*i).rot(a.rotation).add(a);return{id:a.id,type:a.type,x:p.x,y:p.y,props:{...a.props,w:n.w,h:n.h,crop:o}}})(a,{handle:this.info.handle,change:g,crop:h,uncroppedSize:i,initialShape:this.snapshot.shape,aspectRatioLocked:d});j&&(this.editor.updateShapes([{id:a.id,type:a.type,...j}]),this.updateCursor())}complete(){this.updateShapes(),sB(this.editor,[this.snapshot.shape.id]);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){let a=this.editor.getSelectionRotation(),b=this.editor.inputs.getOriginPagePoint(),c=this.editor.getOnlySelectedShape(),d=this.editor.getSelectionRotatedPageBounds(),e=iK.RotWith(d.getHandlePoint(this.info.handle),d.point,a);return{shape:c,cursorHandleOffset:iK.Sub(b,e)}}}function Qz(a,b=!1){let c=a.getZoomLevel(),d=a.inputs.getCurrentPagePoint();return a.getShapeAtPoint(d,{hitInside:!1,hitLabels:b,margin:a.options.hitTestMargin/c,renderingOnly:!0})??a.getSelectedShapeAtPoint(d)}function QA(a,b,c){if(!b)throw Error("Needs to translate a cropped shape!");let{crop:d}=b.props;if(!d)return;let e=a.inputs.getShiftKey()?Math.abs(c.x)<Math.abs(c.y)?"x":"y":null;"x"===e?c.x=0:"y"===e&&(c.y=0),c.rot(-b.rotation);let{w:f,h:g}=H$(b.props,d),h=d.bottomRight.x-d.topLeft.x,i=d.bottomRight.y-d.topLeft.y,j=dk(d);return j.topLeft.x=iS(j.topLeft.x-c.x/f,0,1-h),j.topLeft.y=iS(j.topLeft.y-c.y/g,0,1-i),j.bottomRight.x=j.topLeft.x+h,j.bottomRight.y=j.topLeft.y+i,{id:b.id,type:b.type,props:{crop:j}}}class QB extends pd{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});let a=this.editor.getOnlySelectedShape();a&&this.editor.setCroppingShape(a.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(a){if(a.accelKey){this.cancel(),this.editor.root.handleEvent(a);return}switch(a.target){case"canvas":{let b=Qz(this.editor);if(b&&!this.editor.isShapeOfType(b,"group"))return void this.onPointerDown({...a,shape:b,target:"shape"});this.cancel(),this.editor.root.handleEvent(a);break}case"shape":if(a.shape.id===this.editor.getCroppingShapeId())return void this.editor.setCurrentTool("select.crop.pointing_crop",a);this.editor.getShapeUtil(a.shape)?.canCrop(a.shape)?(this.editor.setCroppingShape(a.shape.id),this.editor.setSelectedShapes([a.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",a)):(this.cancel(),this.editor.root.handleEvent(a));break;case"selection":switch(a.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...a,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...a,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}onDoubleClick(a){if(this.editor.inputs.getShiftKey()||"up"!==a.phase)return;let b=this.editor.getCroppingShapeId();if(!b)return;let c=this.editor.getShape(b);if(!c)return;let d=this.editor.getShapeUtil(c);if(d){if("selection"===a.target)return void d.onDoubleClickEdge?.(c,a);this.cancel(),this.editor.root.handleEvent(a)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(a){"Enter"===a.key&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(a=!1){let{editor:{inputs:{keys:b}}}=this,c=b.has("ShiftLeft"),d=new iK(0,0);if(b.has("ArrowLeft")&&(d.x+=1),b.has("ArrowRight")&&(d.x-=1),b.has("ArrowUp")&&(d.y+=1),b.has("ArrowDown")&&(d.y-=1),d.equals(new iK(0,0)))return;c&&d.mul(10);let e=this.editor.getShape(this.editor.getCroppingShapeId());if(!e)return;let f=QA(this.editor,e,d);f&&(a||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([f]))}}class QC extends pd{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(a){this.editor.inputs.getIsDragging()&&this.startDragging(a)}onLongPress(a){this.startDragging(a)}onPointerUp(a){this.editor.setCurrentTool("select.crop.idle",a)}startDragging(a){this.editor.setCurrentTool("select.crop.translating_crop",a)}}class QD extends pd{static id="pointing_crop_handle";info={};onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd);let b=this.editor.getSelectedShapes()[0];if(!b)return;let c=Qw[this.info.handle];this.editor.setCursor({type:c,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(b.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.getIsDragging()&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class QE extends pd{static id="translating_crop";info={};markId="";snapshot={};onEnter(a){this.info=a,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(a){switch(a.key){case"Alt":case"Shift":return void this.updateShapes()}}onKeyUp(a){switch(a.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){let a=this.snapshot.shape;if(!a)return;let b=this.editor.inputs.getOriginPagePoint(),c=this.editor.inputs.getCurrentPagePoint().clone().sub(b),d=QA(this.editor,a,c);d&&this.editor.updateShapes([d])}}class QF extends pd{static id="crop";static initial="idle";static children(){return[QB,QE,QC,QD,Qy]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}class QG extends pd{static id="dragging_handle";shapeId;initialHandle;initialAdjacentHandle;initialPagePoint;markId;initialPageTransform;initialPageRotation;info;isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(a){let{shape:b,isCreating:c,creatingMarkId:d,handle:e}=a;if(this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.shapeId=b.id,this.markId="",c)if(d)this.markId=d;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=dk(e),this.initialPageTransform=this.editor.getShapePageTransform(b),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.getOriginPagePoint().clone(),this.editor.setCursor({type:c?"cross":"grabbing",rotation:0});let f=this.editor.getShapeHandles(b).sort(c6),g=f.findIndex(b=>b.id===a.handle.id);if(this.initialAdjacentHandle=null,a.handle.snapReferenceHandleId){let b=f.find(b=>b.id===a.handle.snapReferenceHandleId);b&&(this.initialAdjacentHandle=b)}if(!this.initialAdjacentHandle){for(let b=g+1;b<f.length;b++){let c=f[b];if("vertex"===c.type&&"middle"!==c.id&&c.id!==a.handle.id){this.initialAdjacentHandle=c;break}}if(!this.initialAdjacentHandle)for(let b=f.length-1;b>=0;b--){let c=f[b];if("vertex"===c.type&&"middle"!==c.id&&c.id!==a.handle.id){this.initialAdjacentHandle=c;break}}}if(this.editor.isShapeOfType(b,"arrow")){let c=Fd(this.editor,b)[a.handle.id];this.isPrecise=!1,c&&(this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout())}let h={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:b},i=this.editor.getShapeUtil(b),j=i.onHandleDragStart?.(b,h);j&&this.editor.updateShapes([{...j,id:b.id,type:b.type}]),this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){let a=this.editor.getShapeUtil("arrow").options.pointingPreciseTimeout;-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},a)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),Kf(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),sB(this.editor,[this.shapeId]);let a=this.editor.getShape(this.shapeId);if(a){let b=this.editor.getShapeUtil(a),c={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape},d=b.onHandleDragEnd?.(a,c);d&&this.editor.updateShapes([{...d,id:a.id}])}let{onInteractionEnd:b}=this.info;if(b){if("string"!=typeof b)return void b?.();else if(this.editor.getInstanceState().isToolLocked&&b)return void this.editor.setCurrentTool(b,{shapeId:this.shapeId})}this.parent.transition("idle")}cancel(){let a=this.editor.getShape(this.shapeId);if(a){let b=this.editor.getShapeUtil(a),c={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape};b.onHandleDragCancel?.(a,c)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,{shapeId:this.shapeId}):b?.():this.parent.transition("idle")}update(){let{editor:a,shapeId:b,initialPagePoint:c}=this,{initialHandle:d,initialPageRotation:e,initialAdjacentHandle:f}=this,g=this.editor.user.getIsSnapMode(),{snaps:h}=a,i=a.inputs.getCurrentPagePoint(),j=a.inputs.getShiftKey(),k=a.inputs.getCtrlKey(),l=a.inputs.getAltKey(),m=a.inputs.getPointerVelocity(),n=this.info.shape,o=a.getShape(b);if(!o)return;let p=a.getShapeUtil(o),q=a.isShapeOfType(o,"arrow")?Fd(a,o)[d.id]:void 0,r=i.clone().sub(c).rot(-e).add(d);if(j&&f&&"middle"!==d.id){let a=iK.Angle(f,r),b=i$(a,24);r=iK.RotWith(r,f,b-a)}a.snaps.clearIndicators();let s={...d,x:r.x,y:r.y},t=!1;if(d.canSnap&&d.snapType){var u;u="canSnap is deprecated. Cannot use both canSnap and snapType together - snapping disabled. Please use only snapType.",dm.has(u)||(dm.add(u),console.warn(`[tldraw] ${u}`))}else t=d.canSnap||void 0!==d.snapType;if(t&&(g?!k:k)){if(!a.getShapePageTransform(o.id))throw Error("Expected a page transform");let c=h.handles.snapHandle({currentShapeId:b,handle:s});c&&(c.nudge.rot(-a.getShapeParentTransform(o).rotation()),r.add(c.nudge),s={...d,x:r.x,y:r.y})}let v=p.onHandleDrag?.(o,{handle:s,isPrecise:this.isPrecise||l,isCreatingShape:!!this.info.isCreating,initial:n}),w={id:o.id,type:o.type,...v};if("vertex"===d.type&&this.editor.isShapeOfType(o,"arrow")){let b=Fd(a,o)[d.id];b?q?.toId!==b.toId&&(this.pointingId=b.toId,this.isPrecise=.5>m.len()||l,this.isPreciseId=this.isPrecise?b.toId:null,this.resetExactTimeout()):q&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}v&&a.updateShapes([w])}}function QH(a){return a.isLabel?[a]:a instanceof kI?a.children.filter(a=>a.isLabel):[]}class QI extends pd{static id="editing_shape";hitLabelOnShapeForPointerUp=null;info={};didPointerDownOnEditingShape=!1;isTextInputFocused(){return this.editor.getContainer().contains(document.activeElement)&&(document.activeElement?.nodeName==="INPUT"||document.activeElement?.nodeName==="TEXTAREA"||document.activeElement?.isContentEditable)}onEnter(a){let b=this.editor.getEditingShape();if(!b)throw Error("Entered editing state without an editing shape");this.hitLabelOnShapeForPointerUp=null,this.didPointerDownOnEditingShape=!1,this.info=a,a.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),Oy(this.editor),this.editor.select(b)}onExit(){let{editingShapeId:a}=this.editor.getCurrentPageState();a&&(this.editor.setEditingShape(null),Oy.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(a){if(this.hitLabelOnShapeForPointerUp&&this.editor.inputs.getIsDragging()){if(this.editor.getIsReadonly()||this.hitLabelOnShapeForPointerUp.isLocked)return;this.editor.select(this.hitLabelOnShapeForPointerUp),this.parent.transition("translating",a),this.hitLabelOnShapeForPointerUp=null;return}if(this.didPointerDownOnEditingShape&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly())return;let b=this.editor.getEditingShape();if(!b||b.isLocked)return;if(!this.isTextInputFocused()){this.editor.select(b),this.parent.transition("translating",a),this.didPointerDownOnEditingShape=!1;return}this.didPointerDownOnEditingShape=!1}switch(a.target){case"shape":case"canvas":return void Oy(this.editor)}}onPointerDown(a){switch(this.hitLabelOnShapeForPointerUp=null,this.didPointerDownOnEditingShape=!1,a.target){case"canvas":{let b=Qz(this.editor,!0);if(b)return void this.onPointerDown({...a,shape:b,target:"shape"});break}case"shape":{let{shape:b}=a,c=this.editor.getEditingShape();if(!c)throw Error("Expected an editing shape!");let d=QH(this.editor.getShapeUtil(b).getGeometry(b)),e=1===d.length?d[0]:void 0,f=this.editor.isShapeOfType(c,"text")&&""===N$(this.editor,c.props.richText).trim();if(e&&!f){let a=this.editor.getPointInShapeSpace(b,this.editor.inputs.getCurrentPagePoint());if(e.bounds.containsPoint(a,0)&&e.hitTestPoint(a))if(b.id===c.id){this.didPointerDownOnEditingShape=!0;return}else{this.hitLabelOnShapeForPointerUp=b,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(b.id);return}}else{if(b.id!==c.id)return void this.parent.transition("pointing_shape",a);this.editor.isShapeOfType(b,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",a));return}}}this.parent.transition("idle",a),this.editor.root.handleEvent(a)}onPointerUp(a){if(this.didPointerDownOnEditingShape&&(this.didPointerDownOnEditingShape=!1,!this.isTextInputFocused()))return void this.editor.getRichTextEditor()?.commands.focus("all");let b=this.hitLabelOnShapeForPointerUp;if(!b)return;this.hitLabelOnShapeForPointerUp=null;let c=this.editor.getShapeUtil(b);if(b.isLocked)return;if(this.editor.getIsReadonly()&&!c.canEditInReadonly(b))return void this.parent.transition("pointing_shape",a);this.editor.select(b.id);let d=this.editor.getEditingShape(),e=d&&d.id!==b.id;this.editor.setEditingShape(b.id);this.editor.emit("place-caret",{shapeId:b.id,point:a.point}),Oy(this.editor)}onComplete(a){this.editor.getContainer().focus(),this.parent.transition("idle",a)}onCancel(a){this.editor.getContainer().focus(),this.parent.transition("idle",a)}}function QJ(a,b){let c=a.getSelectedShapeIds(),d=a.inputs.getCurrentPagePoint(),{shiftKey:e,altKey:f,accelKey:g}=b,h=e||g,i=a.getShapeAtPoint(d,{hitInside:!1,margin:a.options.hitTestMargin/a.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:a=>!a.isLocked});if(i){let b=a.getOutermostSelectableShape(i);if(h&&!f)a.cancelDoubleClick(),c.includes(b.id)?(a.markHistoryStoppingPoint("deselecting shape"),a.deselect(b)):(a.markHistoryStoppingPoint("shift selecting shape"),a.setSelectedShapes([...c,b.id]));else{let d;(d=b===i||b.id===a.getFocusedGroupId()||c.includes(b.id)?i:b)&&!c.includes(d.id)&&(a.markHistoryStoppingPoint("selecting shape"),a.select(d.id))}}else{if(h)return;c.length>0&&(a.markHistoryStoppingPoint("selecting none"),a.selectNone());let b=a.getFocusedGroupId();if(gh(b)){let c=a.getShape(b);a.isPointInShape(c,d,{margin:0,hitInside:!0})||a.setFocusedGroup(null)}}}let QK=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];class QL extends pd{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),Oy(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){Oy.cancel()}onPointerMove(){Oy(this.editor)}onPointerDown(a){switch(a.target){case"canvas":{let b=Qz(this.editor);if(b&&!b.isLocked)return void this.onPointerDown({...a,shape:b,target:"shape"});let c=this.editor.getSelectedShapeIds(),d=this.editor.getOnlySelectedShape(),e=this.editor.inputs.getCurrentPagePoint();if((c.length>1||d&&!this.editor.getShapeUtil(d).hideSelectionBoundsBg(d))&&QP(this.editor,e))return void this.onPointerDown({...a,target:"selection"});this.parent.transition("pointing_canvas",a);break}case"shape":{let{shape:b}=a;if(this.editor.isShapeOrAncestorLocked(b)){this.parent.transition("pointing_canvas",a);break}this.parent.transition("pointing_shape",a);break}case"handle":if(this.editor.getIsReadonly())break;this.editor.inputs.getAltKey()?this.parent.transition("pointing_shape",a):this.parent.transition("pointing_handle",a);break;case"selection":switch(a.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":if(a.accelKey){this.parent.transition("brushing",a);break}this.parent.transition("pointing_rotate_handle",a);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{let b=this.editor.getOnlySelectedShape();if(a.ctrlKey&&this.editor.canCropShape(b))this.parent.transition("crop.pointing_crop_handle",a);else{if(a.accelKey){this.parent.transition("brushing",a);break}this.parent.transition("pointing_resize_handle",a)}break}default:{let b=this.editor.getHoveredShape();if(b&&!this.editor.getSelectedShapeIds().includes(b.id)&&!b.isLocked)return void this.onPointerDown({...a,shape:b,target:"shape"});this.parent.transition("pointing_selection",a)}}}}onDoubleClick(a){if(!this.editor.inputs.getShiftKey()&&"up"===a.phase&&!a.ctrlKey&&!a.shiftKey)switch(a.target){case"canvas":{let b=this.editor.getHoveredShape(),c=this.editor.inputs.getCurrentPagePoint(),d=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getSelectedShapeAtPoint(c)??this.editor.getShapeAtPoint(c,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),e=this.editor.getFocusedGroupId();if(d){if(this.editor.isShapeOfType(d,"group"))return void QJ(this.editor,a);{let b=this.editor.getShape(d.parentId);if(b&&this.editor.isShapeOfType(b,"group")&&(!e||b.id!==e))return void QJ(this.editor,a)}this.onDoubleClick({...a,shape:d,target:"shape"});return}this.editor.inputs.getShiftKey()||this.handleDoubleClickOnCanvas(a);break}case"selection":{let b=this.editor.getOnlySelectedShape();if(b){let c=this.editor.getShapeUtil(b),d="right"===a.handle||"left"===a.handle||"top"===a.handle||"bottom"===a.handle,e="top_left"===a.handle||"top_right"===a.handle||"bottom_right"===a.handle||"bottom_left"===a.handle;if(this.editor.getIsReadonly()){this.editor.canEditShape(b,{type:e?"double-click-corner":d?"double-click-edge":"double-click"})&&this.startEditingShape(b,a,!0);break}if(d){let d=c.onDoubleClickEdge?.(b,a);if(d){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([d]),sB(this.editor,[b.id]);return}}if(e){let d=c.onDoubleClickCorner?.(b,a);if(d){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([d]),sB(this.editor,[b.id]);return}}if(this.editor.canCropShape(b))return void this.parent.transition("crop",a);this.editor.canEditShape(b)&&this.startEditingShape(b,a,!0)}break}case"shape":{let{shape:b}=a,c=this.editor.getShapeUtil(b);if("video"!==b.type&&"embed"!==b.type&&this.editor.getIsReadonly())break;if(c.onDoubleClick){let a=c.onDoubleClick?.(b);if(a)return void this.editor.updateShapes([a])}if(c.canCrop(b)&&!this.editor.isShapeOrAncestorLocked(b)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(a.shape?.id),this.parent.transition("crop",a);return}this.editor.canEditShape(b)?this.startEditingShape(b,a,!0):this.handleDoubleClickOnCanvas(a);break}case"handle":{if(this.editor.getIsReadonly())break;let{shape:b,handle:c}=a,d=this.editor.getShapeUtil(b),e=d.onDoubleClickHandle?.(b,c);e?this.editor.updateShapes([e]):this.editor.canEditShape(b)&&this.startEditingShape(b,a,!0)}}}onRightClick(a){switch(a.target){case"canvas":{let b=this.editor.getHoveredShape(),c=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getShapeAtPoint(this.editor.inputs.getCurrentPagePoint(),{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(c)return void this.onRightClick({...a,shape:c,target:"shape"});let d=this.editor.getSelectedShapeIds(),e=this.editor.getOnlySelectedShape(),f=this.editor.inputs.getCurrentPagePoint();if((d.length>1||e&&!this.editor.getShapeUtil(e).hideSelectionBoundsBg(e))&&QP(this.editor,f))return void this.onRightClick({...a,target:"selection"});this.editor.selectNone();break}case"shape":{let{selectedShapeIds:b}=this.editor.getCurrentPageState(),{shape:c}=a,d=this.editor.getOutermostSelectableShape(c,a=>!b.includes(a.id));b.includes(d.id)||this.editor.findShapeAncestor(d,a=>b.includes(a.id))||(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([d.id]))}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(a){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),a.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(a.accelKey)return void(a.shiftKey?"ArrowDown"===a.code?this.editor.selectFirstChildShape():"ArrowUp"===a.code&&this.editor.selectParentShape():this.editor.selectAdjacentShape(a.code.replace("Arrow","").toLowerCase()));this.nudgeSelectedShapes(!1);return}if(ji.editOnType.get()&&!QK.includes(a.key)&&!a.altKey&&!a.ctrlKey){let b=this.editor.getOnlySelectedShape();if(b&&this.editor.isShapeOfType(b,"note")&&this.editor.canEditShape(b))return void this.startEditingShape(b,{...a,target:"shape",shape:b},!0)}}onKeyRepeat(a){switch(a.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(a.accelKey)return void this.editor.selectAdjacentShape(a.code.replace("Arrow","").toLowerCase());this.nudgeSelectedShapes(!0);break;case"Tab":this.editor.getSelectedShapes().length&&!a.altKey&&this.editor.selectAdjacentShape(a.shiftKey?"prev":"next")}}onKeyUp(a){switch(a.key){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;let b=this.editor.getSelectedShapes();if(b.every(a=>this.editor.isShapeOfType(a,"group")))return void this.editor.setSelectedShapes(b.flatMap(a=>this.editor.getSortedChildIdsForParent(a.id)));let c=this.editor.getOnlySelectedShape();if(c&&this.editor.canEditShape(c,{type:"press_enter"}))return void this.startEditingShape(c,{...a,target:"shape",shape:c},!0);this.editor.canCropShape(c)&&this.parent.transition("crop",a);break}case"Tab":this.editor.getSelectedShapes().length&&!a.altKey&&this.editor.selectAdjacentShape(a.shiftKey?"prev":"next")}}startEditingShape(a,b,c){let{editor:d}=this;this.editor.markHistoryStoppingPoint("editing shape"),z8(a)?z9(d,a,{selectAll:c}):d.setEditingShape(a),this.parent.transition("editing_shape",b)}isOverArrowLabelTest(a){return!!a&&O2(this.editor,a)}handleDoubleClickOnCanvas(a){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");let b=gi(),{x:c,y:d}=this.editor.inputs.getCurrentPagePoint();this.editor.createShapes([{id:b,type:"text",x:c,y:d,props:{richText:gb(""),autoSize:!0}}]);let e=this.editor.getShape(b);!e||this.editor.canEditShape(e)&&z9(this.editor,b,{info:a})}nudgeSelectedShapes(a=!1){let{editor:{inputs:{keys:b}}}=this,c=b.has("ShiftLeft"),d=new iK(0,0);if(b.has("ArrowLeft")&&(d.x-=1),b.has("ArrowRight")&&(d.x+=1),b.has("ArrowUp")&&(d.y-=1),b.has("ArrowDown")&&(d.y+=1),d.equals(new iK(0,0)))return;a||this.editor.markHistoryStoppingPoint("nudge shapes");let{gridSize:e}=this.editor.getDocumentSettings(),f=this.editor.getInstanceState().isGridMode?c?e*QO:e:c?QM:QN,g=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(g,d.mul(f)),sB(this.editor,g)}}let QM=10,QN=1,QO=5;function QP(a,b){let c=a.getSelectionRotatedPageBounds();if(!c)return!1;let d=a.getSelectionRotation();return d?i4(b,c.corners.map(a=>iK.RotWith(a,c.point,d))):c.containsPoint(b)}class QQ extends pd{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(a){let{shape:b}=a;"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.info=a,this.shapeId=b.id,this.didDrag=!1,this.didCtrlOnEnter=a.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===b.id,this.updateCursor();let c=this.editor.getShapeGeometry(b).children[1];if(!c)throw Error(`Expected to find an arrow label geometry for shape: ${b.id}`);let d=this.editor.inputs.getCurrentPagePoint(),e=this.editor.getPointInShapeSpace(b,d);if(this._labelDragOffset=iK.Sub(c.center,e),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),a.shiftKey||a.accelKey){let a=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...a,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new iK(0,0);onPointerMove(){if(!this.editor.inputs.getIsDragging())return;if(this.didCtrlOnEnter)return void this.parent.transition("brushing",this.info);let a=this.editor.getShape(this.shapeId);if(!a)return;let b=this.editor.getShapeUtil("arrow").options,c=OW(this.editor,a),d=this.editor.getShapePageTransform(a.id),e=this.editor.getPointInShapeSpace(a,this.editor.inputs.getCurrentPagePoint()).add(this._labelDragOffset),f=O1(this.editor,a),g=c.uninterpolateAlongEdge(e);isNaN(g)&&(g=f);let h=d.applyToPoint(c.interpolateAlongEdge(g)),i=d.applyToPoint(c.interpolateAlongEdge(f));iK.DistMin(h,i,b.labelCenterSnapDistance/this.editor.getZoomLevel())&&(g=f),this.didDrag=!0,this.editor.updateShape({id:a.id,type:a.type,props:{labelPosition:g}})}onPointerUp(){let a=this.editor.getShape(this.shapeId);a&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.canEditShape(a)&&z9(this.editor,a.id))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId);let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class QR extends pd{static id="pointing_canvas";onEnter(a){!(a.shiftKey||a.accelKey)&&this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(a){this.editor.inputs.getIsDragging()&&this.parent.transition("brushing",a)}onPointerUp(a){QJ(this.editor,a),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}class QS extends pd{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(a){this.info=a,this.didCtrlOnEnter=a.accelKey;let{shape:b}=a;if(this.editor.isShapeOfType(b,"arrow")){let c=Fd(this.editor,b),d=c[a.handle.id],e=c["start"===a.handle.id?"end":"start"],f=this.editor.getShapePageTransform(b.id);d&&Kg({editor:this.editor,pointInPageSpace:f.applyToPoint(a.handle),arrow:b,isPrecise:d.props.isPrecise,currentBinding:d,oppositeBinding:e})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){let{shape:a,handle:b}=this.info;if(this.editor.isShapeOfType(a,"note")){let{editor:c}=this,d=QT(c,a,b,!1);if(d)return void z9(c,d,{selectAll:!0})}this.parent.transition("idle",this.info)}onPointerMove(a){let{editor:b}=this;b.inputs.getIsDragging()&&(this.didCtrlOnEnter?this.parent.transition("brushing",a):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){let{editor:a}=this;if(a.getIsReadonly())return;let{shape:b,handle:c}=this.info;if(a.isShapeOfType(b,"note")){let d=QT(a,b,c,!0);if(d){let c=a.getPointInParentSpace(d,a.inputs.getOriginPagePoint()).sub(iK.Rot(Or.clone().mul(b.props.scale),d.rotation));a.updateShape({...d,x:c.x,y:c.y}),a.setHoveredShape(d.id).select(d.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:a.getShape(d),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{z9(a,d,{selectAll:!0})}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function QT(a,b,c,d){let e=a.getShapePageTransform(b.id),f=e.point(),g=e.rotation(),h=Os(a,f,g,b.props.growY*b.props.scale,0,b.props.scale)[c.index];if(h)return Ou(a,b,h,g,d)}class QU extends pd{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:Qw[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.getIsDragging()&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a?.():this.parent.transition("idle")}cancel(){let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,{}):a():this.parent.transition("idle")}}class QV extends pd{static id="pointing_selection";info={};onEnter(a){this.info=a}onPointerUp(a){QJ(this.editor,a),this.parent.transition("idle",a)}onPointerMove(a){this.editor.inputs.getIsDragging()&&this.startTranslating(a)}onLongPress(a){this.startTranslating(a)}startTranslating(a){this.editor.getIsReadonly()||this.parent.transition("translating",a)}onDoubleClick(a){let b=this.editor.getHoveredShape(),c=b&&!this.editor.isShapeOfType(b,"group")?b:this.editor.getShapeAtPoint(this.editor.inputs.getCurrentPagePoint(),{hitInside:!0,margin:0,renderingOnly:!0});if(c){this.parent.transition("idle"),this.parent.onDoubleClick?.({...a,target:"shape",shape:this.editor.getShape(c)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class QW extends pd{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(a){let b=this.editor.getSelectedShapeIds(),c=this.editor.getSelectionRotatedPageBounds(),d=this.editor.getFocusedGroupId(),e=this.editor.inputs.getCurrentPagePoint(),{shiftKey:f,altKey:g,accelKey:h}=a;this.hitShape=a.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=h;let i=this.editor.getOutermostSelectableShape(a.shape),j=this.editor.findShapeAncestor(i,a=>b.includes(a.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(a.shape).onClick||i.id===d||b.includes(i.id)||j||b.length>1&&c?.containsPoint(e)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=i;return}this.didSelectOnEnter=!0,f&&!g?(this.editor.cancelDoubleClick(),b.includes(i.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...b,i.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]))}onPointerUp(a){let b=this.editor.getSelectedShapeIds(),c=this.editor.getFocusedGroupId(),d=this.editor.getZoomLevel(),e=this.editor.inputs.getCurrentPagePoint(),f=a.shiftKey||a.accelKey,g=this.editor.getShapeAtPoint(e,{margin:this.editor.options.hitTestMargin/d,hitInside:!0,renderingOnly:!0})??this.hitShape,h=g?this.editor.getOutermostSelectableShape(g):this.hitShapeForPointerUp;if(h){let d=this.editor.getShapeUtil(h);if(d.onClick){let b=d.onClick?.(h);if(b){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([b]),this.parent.transition("idle",a);return}}if(h.id===c){b.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",a);return}}if(!this.didSelectOnEnter){let c=this.editor.getOutermostSelectableShape(g,a=>!b.includes(a.id));if(b.includes(c.id))if(f)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(h);else if(b.includes(h.id)){if(1===b.length){let b=QH(this.editor.getShapeUtil(h).getGeometry(h)),c=1===b.length?b[0]:void 0;if(c){let b=this.editor.getPointInShapeSpace(h,e);if(c.bounds.containsPoint(b,0)&&c.hitTestPoint(b))return void this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(h.id),this.editor.canEditShape(h)&&(this.editor.setEditingShape(h.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:h.id}):this.editor.emit("place-caret",{shapeId:h.id,point:a.point}))})}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(h.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(h);else if(f){let a=this.editor.getShapeAncestors(c);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(b=>!a.find(a=>a.id===b)),c.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([c.id])}this.parent.transition("idle",a)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(a){if(this.editor.inputs.getIsDragging()){if(O2(this.editor,this.hitShape))return void this.parent.transition("pointing_arrow_label",{...a,shape:this.hitShape});this.didCtrlOnEnter?this.parent.transition("brushing",a):this.startTranslating(a)}}onLongPress(a){this.startTranslating(a)}startTranslating(a){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",a))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class QX extends pd{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(a){let{isCreating:b=!1,creatingMarkId:c,creationCursorOffset:d={x:0,y:0}}=a;this.info=a,this.didHoldCommand=!1,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.creationCursorOffset=d;try{this.snapshot=this._createSnapshot()}catch(a){console.error(a),this.cancel();return}if(this.markId="",b)if(c)this.markId=c;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");b&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:a}){let{editor:b}=this;!b.inputs.getIsDragging()||b.inputs.getIsPanning()||b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){let{shapeSnapshots:a}=this.snapshot;a.forEach(({shape:a})=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onResizeCancel?.(a,b)}}),this.editor.bailToMark(this.markId);let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,{}):b():this.parent.transition("idle")}complete(){if(sB(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate)return void this.info.onCreate?.(this.editor.getOnlySelectedShape());let{onInteractionEnd:a}=this.info;if(a){if("string"!=typeof a)return void a();else if(this.editor.getInstanceState().isToolLocked)return void this.editor.setCurrentTool(a,{})}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:a}=this.snapshot,b=[];a.forEach(({shape:a})=>{let c=this.editor.getShapeUtil(a),d=c.onResizeStart?.(a);d&&b.push(d)}),b.length>0&&this.editor.updateShapes(b)}handleResizeEnd(){let{shapeSnapshots:a}=this.snapshot,b=[];a.forEach(({shape:a})=>{let c=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onResizeEnd?.(a,c);e&&b.push(e)}),b.length>0&&this.editor.updateShapes(b)}updateShapes(){let a=this.editor.inputs.getAltKey(),b=this.editor.inputs.getShiftKey(),{frames:c,shapeSnapshots:d,selectionBounds:e,cursorHandleOffset:f,selectedShapeIds:g,selectionRotation:h,canShapesDeform:i}=this.snapshot,j=b||!i;if(1===d.size){let a=[...d.values()][0];this.editor.isShapeOfType(a.shape,"text")&&(j="left"!==this.info.handle&&"right"!==this.info.handle)}let k=jr(this.editor.inputs),l=this.editor.inputs.getCurrentPagePoint().clone().sub(f).sub(this.creationCursorOffset),m=this.editor.inputs.getOriginPagePoint().clone().sub(f);if(this.editor.getInstanceState().isGridMode&&!k){let{gridSize:a}=this.editor.getDocumentSettings();l.snapToGrid(a)}let n=this.info.handle,o=QZ(n,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!k:k)&&h%iP==0){let{nudge:b}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:iK.Sub(l,m),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:QZ(n,h),isAspectRatioLocked:j,isResizingFromCenter:a});l.add(b)}let p=iK.RotWith(a?e.center:e.getHandlePoint(o),e.point,h),q=iK.Sub(l,p).rot(-h),r=iK.Sub(m,p).rot(-h),s=iK.DivV(q,r);Number.isFinite(s.x)||(s.x=1),Number.isFinite(s.y)||(s.y=1);let t="top"===n||"bottom"===n,u="left"===n||"right"===n;for(let a of(j?u?s.y=Math.abs(s.x):t?s.x=Math.abs(s.y):Math.abs(s.x)>Math.abs(s.y)?s.y=Math.abs(s.x)*(s.y<0?-1:1):s.x=Math.abs(s.y)*(s.x<0?-1:1):(t&&(s.x=1),u&&(s.y=1)),this.info.isCreating||this.updateCursor({dragHandle:n,isFlippedX:s.x<0,isFlippedY:s.y<0,rotation:h}),d.keys())){let b=d.get(a);this.editor.resizeShape(a,s,{initialShape:b.shape,initialBounds:b.bounds,initialPageTransform:b.pageTransform,dragHandle:n,mode:1===g.length&&a===g[0]?"resize_bounds":"scale_shape",scaleOrigin:p,isAspectRatioLocked:j,scaleAxisRotation:h,skipStartAndEndCallbacks:!0})}if(k)for(let{id:a,children:b}of(this.didHoldCommand=!0,c)){if(!b.length)continue;let c=d.get(a).shape,e=this.editor.getShape(a);if(!(c&&e))continue;let f=new iK(e.x-c.x,e.y-c.y).rot(-c.rotation);if(0!==f.x||0!==f.y)for(let a of b)this.editor.updateShape({id:a.id,type:a.type,x:a.x-f.x,y:a.y-f.y})}else if(this.didHoldCommand){for(let{children:a}of(this.didHoldCommand=!1,c))if(a.length)for(let b of a)this.editor.updateShape({id:b.id,type:b.type,x:b.x,y:b.y})}}updateCursor({dragHandle:a,isFlippedX:b,isFlippedY:c,rotation:d}){let e={...this.editor.getInstanceState().cursor};switch(a){case"top_left":case"bottom_right":e.type="nwse-resize",b!==c&&(e.type="nesw-resize");break;case"top_right":case"bottom_left":e.type="nesw-resize",b!==c&&(e.type="nwse-resize")}e.rotation=d,this.editor.setCursor(e)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){let{editor:a}=this,b=a.getSelectedShapeIds(),c=a.getSelectionRotation(),d=a.inputs.getOriginPagePoint(),e=a.getSelectionRotatedPageBounds();if(!e)throw Error("Resizing but nothing is selected");let f=iK.RotWith(e.getHandlePoint(this.info.handle),e.point,c),g=iK.Sub(d,f),h=new Map,i=[],j=b=>{let c=a.getShape(b);if(!c)return!1;let d=a.getShapeUtil(c);if(d.canResize(c)){let b=a.getShapePageTransform(c);h.set(c.id,{shape:c,bounds:a.getShapeGeometry(c).bounds,pageTransform:b,pageRotation:ku.Decompose(b).rotation,isAspectRatioLocked:d.isAspectRatioLocked(c)})}if(a.isShapeOfType(c,"frame")&&i.push({id:c.id,children:b4(a.getSortedChildIdsForParent(c).map(b=>a.getShape(b)))}),!d.canResizeChildren(c))return!1};b.forEach(b=>{!1!==j(b)&&a.visitDescendants(b,j)});let k=![...h.values()].some(a=>!i_(a.pageRotation,c)||a.isAspectRatioLocked);return{shapeSnapshots:h,selectionBounds:e,cursorHandleOffset:g,selectionRotation:c,selectedShapeIds:b,canShapesDeform:k,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:i}}}let QY=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function QZ(a,b){let c=Math.round((b%=iQ)/(iO/4)),d=QY.indexOf(a);return QY[(d+c)%QY.length]}let Q$=Math.PI/180;class Q_ extends pd{static id="rotating";snapshot={};info={};markId="";onEnter(a){this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");let b=ms({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!b)return this.parent.transition("idle",this.info);this.snapshot=b;let c=this._getRotationFromPointerPosition({snapToNearestDegree:!1});mt({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Qw[this.info.handle],rotation:c+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){let a=this._getRotationFromPointerPosition({snapToNearestDegree:!1});mt({editor:this.editor,delta:a,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Qw[this.info.handle],rotation:a+this.snapshot.initialShapesRotation})}cancel(){let{shapeSnapshots:a}=this.snapshot;a.forEach(({shape:a})=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onRotateCancel?.(a,b)}}),this.editor.bailToMark(this.markId);let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b,this.info):b():this.parent.transition("idle",this.info)}complete(){mt({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),sB(this.editor,this.snapshot.shapeSnapshots.map(a=>a.shape.id));let{onInteractionEnd:a}=this.info;a?"string"==typeof a?this.editor.setCurrentTool(a,this.info):a():this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:a}){let b=this.editor.inputs.getShiftKey(),c=this.editor.inputs.getCurrentPagePoint(),{initialCursorAngle:d,initialShapesRotation:e,initialPageCenter:f}=this.snapshot,g=e+(f.angle(c)-d);if(b)g=i$(g,24);else if(a&&(g=Math.round(g/Q$)*Q$,this.editor.getInstanceState().isCoarsePointer)){let a=i$(g,4);Math.abs(iZ(g,a))<5*iO/180&&(g=a)}return g-e}}class Q0 extends pd{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.getShiftKey()?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let a=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=a.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.getAltKey()?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){let{x:a,y:b}=this.editor.inputs.getCurrentPagePoint();this.editor.scribbles.addPoint(this.scribbleId,a,b)}updateScribbleSelection(a){let b,c,d,e,{editor:f}=this,g=this.editor.inputs.getShiftKey(),h=this.editor.inputs.getOriginPagePoint(),i=this.editor.inputs.getPreviousPagePoint(),j=this.editor.inputs.getCurrentPagePoint(),{newlySelectedShapeIds:k,initialSelectedShapeIds:l}=this;a&&this.pushPointToScribble();let m=kt.FromPoints([i,j]).expandBy(0),n=f.getShapeIdsInsideBounds(m);if(0===n.size){let a=f.getSelectedShapeIds(),b=new Set(g?[...k,...l]:[...k]);(a.length!==b.size||a.some(a=>!b.has(a)))&&this.editor.setSelectedShapes(Array.from(b));return}let o=this.editor.getCurrentPageRenderingShapesSorted().filter(a=>n.has(a.id));for(let a=0,g=o.length;a<g;a++){if(b=o[a],f.isShapeOfType(b,"group")||k.has(b.id)||f.isShapeOrAncestorLocked(b)||(c=f.getShapeGeometry(b),f.isShapeOfType(b,"frame")&&c.bounds.containsPoint(f.getPointInShapeSpace(b,h))))continue;let g=f.getShapePageTransform(b);if(!c||!g)continue;let l=g.clone().invert();d=l.applyToPoint(i),e=l.applyToPoint(j);let{bounds:m}=c;if(!(m.minX-0>Math.max(d.x,e.x)||m.minY-0>Math.max(d.y,e.y)||m.maxX+0<Math.min(d.x,e.x)||m.maxY+0<Math.min(d.y,e.y))&&c.hitTestLineSegment(d,e,0)){let a=this.editor.getOutermostSelectableShape(b),c=this.editor.getShapeMask(a.id);if(c&&null!==kx(i,j,c)&&!i4(j,c))continue;k.add(a.id)}}let p=f.getSelectedShapeIds(),q=new Set(g?[...k,...l]:[...k]);(p.length!==q.size||p.some(a=>!q.has(a)))&&this.editor.setSelectedShapes(Array.from(q))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}var Q1=Object.create,Q2=Object.defineProperty,Q3=Object.getOwnPropertyDescriptor,Q4=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),Q5=a=>{throw TypeError(a)},Q6=(a,b,c)=>b in a?Q2(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,Q7=(a,b)=>Q2(a,"name",{value:b,configurable:!0}),Q8=["class","method","getter","setter","accessor","field","value","get","set"],Q9=a=>void 0!==a&&"function"!=typeof a?Q5("Function expected"):a,Ra=(a,b,c,d,e)=>({kind:Q8[a],name:b,metadata:d,addInitializer:a=>c._?Q5("Already initialized"):e.push(Q9(a||null))}),Rb=(a,b)=>Q6(b,Q4("metadata"),a[3]),Rc=(a,b,c)=>Q6(a,"symbol"!=typeof b?b+"":b,c),Rd=(a,b,c)=>b.has(a)||Q5("Cannot "+c),Re=(a,b)=>Object(b)!==b?Q5('Cannot use the "in" operator on this value'):a.has(b),Rf=(a,b,c)=>(Rd(a,b,"read from private field"),c?c.call(a):b.get(a)),Rg=(a,b,c,d)=>(Rd(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),Rh=(a,b,c)=>(Rd(a,b,"access private method"),c);bN=[ch];class Ri{constructor(a){this.editor=a,((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bO,5,this),Rc(this,"shapesToActuallyMove",[]),Rc(this,"draggedOverShapeIds",new Set),Rc(this,"initialGroupIds",new Map),Rc(this,"initialParentIds",new Map),Rc(this,"initialIndices",new Map),Rc(this,"initialDraggingOverShape"),Rc(this,"prevDraggingOverShape"),Rc(this,"prevPagePoint",new iK),Rc(this,"intervalTimerId",-1),a.disposables.add(this.dispose)}startDraggingShapes(a,b,c){let{editor:d}=this;if(-1!==this.intervalTimerId)return;let e=new Set(a),f=new Set;for(let a of e){let b=d.getShapeParent(a);b&&d.isShapeOfType(b,"group")&&!f.has(b)&&f.add(b)}for(let a of f){let b=b4(d.getSortedChildIdsForParent(a).map(a=>d.getShape(a)));for(let c of(e.add(a),b))e.delete(c)}for(let a of(this.initialParentIds.clear(),e)){let b=d.getShapeParent(a);b&&this.initialParentIds.set(a.id,b.id),this.initialIndices.set(a.id,a.index);let c=d.findShapeAncestor(a,a=>d.isShapeOfType(a,"group"));c&&this.initialGroupIds.set(a.id,c.id)}let g=d.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(e).filter(a=>!a.isLocked).sort((a,b)=>g.indexOf(a)-g.indexOf(b)),this.initialDraggingOverShape=d.getDraggingOverShape(b,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(b,c);let h=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{++h%3&&this.editor.inputs.getPointerVelocity().len()>.5||this.updateDraggingShapes(d.inputs.getCurrentPagePoint(),c)},a.length>10?320:60)}dropShapes(a){let{editor:b}=this,c=b.inputs.getCurrentPagePoint();this.updateDraggingShapes(c);let d=b.getDraggingOverShape(c,a);if(d){let c=b.getShapeUtil(d);c.onDropShapesOver?.(d,a,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(a,b){let{editor:c}=this,d=b4(this.shapesToActuallyMove.map(a=>c.getShape(a)));if(!d.length)return;let e=c.getDraggingOverShape(a,this.shapesToActuallyMove),f=c.inputs.getCurrentPagePoint(),g=!this.prevPagePoint.equals(f);this.prevPagePoint.setTo(f),c.run(()=>{if(this.prevDraggingOverShape?.id===e?.id){if(g&&e&&gh(e.id)&&!c.inputs.getPreviousPagePoint().equals(f)){let a=c.getShapeUtil(e);a.onDragShapesOver?.(e,d,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}return}if(this.prevDraggingOverShape){let a=c.getShapeUtil(this.prevDraggingOverShape);a.onDragShapesOut?.(this.editor.getShape(this.prevDraggingOverShape),d,{nextDraggingOverShapeId:e?.id??null,initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices})}if(e){let a=c.getShapeUtil(e);a.onDragShapesIn?.(e,d,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,prevDraggingOverShapeId:this.prevDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),c.setHintingShapes([e.id])}else this.prevDraggingOverShape&&c.setHintingShapes([]);b?.()}),this.prevDraggingOverShape=e}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=Q8[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&Q3(l<4?e:{get[c](){return Rf(this,f)},set[c](x){return Rg(this,f,x)}},c));l?n&&l<4&&Q7(f,(l>2?"set ":l>1?"get ":"")+c):Q7(e,c);for(var t=d.length-1;t>=0;t--)j=Ra(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>Re(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?Rf:Rh)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>Rg(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?Q9(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?Q5("Object expected"):(Q9(g=h.get)&&(s.get=g),Q9(g=h.set)&&(s.set=g),Q9(g=h.init)&&q.unshift(g));return l||Rb(a,e),s&&Q2(e,c,s),n})(bO=[,,,Q1((void 0)??null)],1,"dispose",bN,Ri),Rb(bO,Ri);var Rj=Object.create,Rk=Object.defineProperty,Rl=Object.getOwnPropertyDescriptor,Rm=(a,b)=>(b=Symbol[a])?b:Symbol.for("Symbol."+a),Rn=a=>{throw TypeError(a)},Ro=(a,b,c)=>b in a?Rk(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,Rp=(a,b)=>Rk(a,"name",{value:b,configurable:!0}),Rq=["class","method","getter","setter","accessor","field","value","get","set"],Rr=a=>void 0!==a&&"function"!=typeof a?Rn("Function expected"):a,Rs=(a,b,c,d,e)=>({kind:Rq[a],name:b,metadata:d,addInitializer:a=>c._?Rn("Already initialized"):e.push(Rr(a||null))}),Rt=(a,b)=>Ro(b,Rm("metadata"),a[3]),Ru=(a,b,c)=>Ro(a,"symbol"!=typeof b?b+"":b,c),Rv=(a,b,c)=>b.has(a)||Rn("Cannot "+c),Rw=(a,b)=>Object(b)!==b?Rn('Cannot use the "in" operator on this value'):a.has(b),Rx=(a,b,c)=>(Rv(a,b,"read from private field"),c?c.call(a):b.get(a)),Ry=(a,b,c,d)=>(Rv(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),Rz=(a,b,c)=>(Rv(a,b,"access private method"),c);class RA extends(bQ=pd,bP=[ch],bQ){constructor(){super(...arguments),((a,b,c,d)=>{for(var e=0,f=a[b>>1],g=f&&f.length;e<g;e++)1&b?f[e].call(c):d=f[e].call(c,d)})(bR,5,this),Ru(this,"info",{}),Ru(this,"selectionSnapshot",{}),Ru(this,"snapshot",{}),Ru(this,"markId",""),Ru(this,"isCloning",!1),Ru(this,"isCreating",!1),Ru(this,"dragAndDropManager",new Ri(this.editor))}onCreate(a){}onEnter(a){let{isCreating:b=!1,creatingMarkId:c,onCreate:d=()=>void 0}=a;if(!this.editor.getSelectedShapeIds()?.length)return void this.parent.transition("idle");if(this.info=a,"string"==typeof a.onInteractionEnd&&this.parent.setCurrentToolIdMask(a.onInteractionEnd),this.isCreating=b,this.markId="",b)if(c)this.markId=c;else{let a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=d,this.isCloning=!1,this.info=a,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=RB(this.editor),!this.isCreating&&this.editor.inputs.getAltKey()&&(this.startCloning(),this.isCloning)||(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:a}){let{editor:b}=this;!b.inputs.getIsDragging()||b.inputs.getIsPanning()||b.edgeScrollManager.updateEdgeScrolling(a)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.getAltKey()&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){!this.editor.inputs.getAltKey()&&this.isCloning?this.stopCloning():this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;let a=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(a)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=RB(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),sB(this.editor,this.snapshot.movingShapes.map(a=>a.id));let{onInteractionEnd:a}=this.info;if(a){if("string"!=typeof a)return void a();else if(this.editor.getInstanceState().isToolLocked)return void this.editor.setCurrentTool(a)}this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){let{movingShapes:a}=this.snapshot;a.forEach(a=>{let b=this.editor.getShape(a.id);if(b){let c=this.editor.getShapeUtil(a);c.onTranslateCancel?.(a,b)}}),this.reset();let{onInteractionEnd:b}=this.info;b?"string"==typeof b?this.editor.setCurrentTool(b):b():this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:a}=this.snapshot,b=[];a.forEach(a=>{let c=this.editor.getShapeUtil(a),d=c.onTranslateStart?.(a);d&&b.push(d)}),b.length>0&&this.editor.updateShapes(b),this.dragAndDropManager.startDraggingShapes(b4(this.snapshot.movingShapes.map(a=>this.editor.getShape(a.id))),this.editor.inputs.getOriginPagePoint(),this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:a}=this.snapshot;if(this.isCloning&&a.length>0){let b=iK.Average(a.map(a=>this.editor.getShapePageTransform(a.id).point())),c=iK.Sub(b,this.selectionSnapshot.averagePagePoint);iK.IsNaN(c)||this.editor.updateInstanceState({duplicateProps:{shapeIds:a.map(a=>a.id),offset:{x:c.x,y:c.y}}})}let b=[];a.forEach(a=>{let c=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onTranslateEnd?.(a,c);e&&b.push(e)}),b.length>0&&this.editor.updateShapes(b)}updateShapes(){let{snapshot:a}=this;this.dragAndDropManager.startDraggingShapes(a.movingShapes,this.editor.inputs.getOriginPagePoint(),this.updateParentTransforms),function({editor:a,snapshot:b}){let{inputs:c}=a,{noteSnapshot:d,noteAdjacentPositions:e,initialPageBounds:f,initialSnapPoints:g,shapeSnapshots:h,averagePagePoint:i}=b,j=a.inputs.getShiftKey(),k=a.inputs.getAccelKey(),l=a.getInstanceState().isGridMode,m=a.getDocumentSettings().gridSize,n=iK.Sub(c.getCurrentPagePoint(),c.getOriginPagePoint()),o=j?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===o?n.x=0:"y"===o&&(n.y=0),a.snaps.clearIndicators();let p=a.user.getIsSnapMode()?!k:k,q=!1;if(p&&.5>a.inputs.getPointerVelocity().len()){let{nudge:b}=a.snaps.shapeBounds.snapTranslateShapes({dragDelta:n,initialSelectionPageBounds:f,lockedAxis:o,initialSelectionSnapPoints:g});n.add(b)}else if(d&&e){let{scale:b}=d.shape.props,c=d.pagePoint.clone().add(n).add(Or.clone().mul(b).rot(d.pageRotation)),f=10/a.getZoomLevel(),g=new iK(0,0);for(let a of e){let b=iK.Sub(c,a),d=b.len();d<f&&(q=!0,f=d,g=b)}n.sub(g)}let r=iK.Add(i,n),s=a.snaps.getIndicators();!l||k||q||0!==s.length||r.snapToGrid(m);let t=iK.Sub(r,i);a.updateShapes(b4(h.map(({shape:a,pagePoint:b,parentTransform:c})=>{let d=iK.Add(b,t),e=c?ku.applyToPoint(c,d):d;return{id:a.id,type:a.type,x:e.x,y:e.y}})))}({editor:this.editor,snapshot:a});let{movingShapes:b}=a,c=[];b.forEach(a=>{let b=this.editor.getShape(a.id),d=this.editor.getShapeUtil(a),e=d.onTranslate?.(a,b);e&&c.push(e)}),c.length>0&&this.editor.updateShapes(c)}updateParentTransforms(){let{editor:a,snapshot:{shapeSnapshots:b}}=this,c=[];b.forEach(b=>{let d=a.getShape(b.shape.id);if(!d)return null;c.push(d),b.parentTransform=g$(d.parentId)?null:ku.Inverse(a.getShapePageTransform(d.parentId))})}}function RB(a){let b,c,d=[],e=[],f=b4(a.getSelectedShapeIds().map(b=>{let c=a.getShape(b);if(!c)return null;d.push(c);let f=a.getShapePageTransform(b),g=f.point(),h=f.rotation();e.push(g);let i=gZ.isId(c.parentId)?null:ku.Inverse(a.getShapePageTransform(c.parentId));return{shape:c,pagePoint:g,pageRotation:h,parentTransform:i}})),g=a.getOnlySelectedShape(),h=[];if(g)h=a.snaps.shapeBounds.getSnapPoints(g.id);else{let b=a.getSelectionPageBounds();b&&(h=b.cornersAndCenter.map((a,b)=>({id:"selection:"+b,x:a.x,y:a.y})))}let i=a.inputs.getOriginPagePoint(),j=f.filter(b=>a.isShapeOfType(b.shape,"note")&&a.isPointInShape(b.shape,i));if(0===j.length);else if(1===j.length)c=j[0];else{let b=a.getCurrentPageShapesSorted();c=j.map(a=>({snapshot:a,index:b.findIndex(b=>b.id===a.shape.id)})).sort((a,b)=>b.index-a.index)[0]?.snapshot}return c&&(b=Ot(a,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:iK.Average(e),movingShapes:d,shapeSnapshots:f,initialPageBounds:a.getSelectionPageBounds(),initialSnapPoints:h,noteAdjacentPositions:b,noteSnapshot:c}}((a,b,c,d,e,f)=>{var g,h,i,j,k,l=7&b,m=!!(8&b),n=!!(16&b),o=l>3?a.length+1:l?m?1:2:0,p=Rq[l+5],q=l>3&&(a[o-1]=[]),r=a[o]||(a[o]=[]),s=l&&(n||m||(e=e.prototype),l<5&&(l>3||!n)&&Rl(l<4?e:{get[c](){return Rx(this,f)},set[c](x){return Ry(this,f,x)}},c));l?n&&l<4&&Rp(f,(l>2?"set ":l>1?"get ":"")+c):Rp(e,c);for(var t=d.length-1;t>=0;t--)j=Rs(l,c,i={},a[3],r),l&&(j.static=m,j.private=n,k=j.access={has:n?a=>Rw(e,a):a=>c in a},3^l&&(k.get=n?a=>(1^l?Rx:Rz)(a,e,4^l?f:s.get):a=>a[c]),l>2&&(k.set=n?(a,b)=>Ry(a,e,b,4^l?f:s.set):(a,b)=>a[c]=b)),h=(0,d[t])(l?l<4?n?f:s[p]:l>4?void 0:{get:s.get,set:s.set}:e,j),i._=1,4^l||void 0===h?Rr(h)&&(l>4?q.unshift(h):l?n?f=h:s[p]=h:e=h):"object"!=typeof h||null===h?Rn("Object expected"):(Rr(g=h.get)&&(s.get=g),Rr(g=h.set)&&(s.set=g),Rr(g=h.init)&&q.unshift(g));return l||Rt(a,e),s&&Rk(e,c,s),n})(bR=[,,,Rj(bQ?.[Rm("metadata")]??null)],1,"updateParentTransforms",bP,RA),Rt(bR,RA),Ru(RA,"id","translating");class RC extends pd{static id="idle";info={};onEnter(a){this.info=a}onPointerDown(){this.parent.transition("pointing",this.info)}onKeyDown(a){"Shift"===a.key&&this.parent.transition("zoom_quick",this.info)}}class RD extends pd{static id="pointing";info={};onEnter(a){this.info=a}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.getIsDragging()&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){let a=this.editor.inputs.getCurrentScreenPoint();this.editor.inputs.getAltKey()?this.editor.zoomOut(a,{animation:{duration:220}}):this.editor.zoomIn(a,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class RE extends pd{static id="zoom_brushing";info={};zoomBrush=new kt;onEnter(a){this.info=a,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){let a=this.editor.inputs.getOriginPagePoint(),b=this.editor.inputs.getCurrentPagePoint();this.zoomBrush.setTo(kt.FromPoints([a,b])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:a}=this,b=8/this.editor.getZoomLevel();if(a.width<b&&a.height<b){let a=this.editor.inputs.getCurrentScreenPoint();this.editor.inputs.getAltKey()?this.editor.zoomOut(a,{animation:{duration:220}}):this.editor.zoomIn(a,{animation:{duration:220}})}else{let b=this.editor.inputs.getAltKey()?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(a,{targetZoom:b,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class RF extends pd{static id="zoom_quick";info={};qzState="idle";initialVpb=new kt;initialPp=new iK;overviewZoom=1;cleanupZoomReactor(){}nextVpb=new kt;onEnter(a){let{editor:b}=this;this.info=a,this.qzState="idle",this.initialVpb=b.getViewportPageBounds(),this.initialPp=iK.From(b.inputs.getCurrentPagePoint()),b.setCursor({type:"zoom-in",rotation:0});let c=this.initialVpb,d=b.getCurrentPageBounds(),e=d?kt.Expand(c,d):c.clone(),f=b.getViewportScreenBounds(),g=b.inputs.getCurrentScreenPoint(),h=g.x-f.x,i=g.y-f.y,{x:j,y:k}=this.initialPp,l=j-e.minX,m=e.maxX-j,n=k-e.minY,o=e.maxY-k,p=b.getCamera().z;l>0&&(p=Math.min(p,h/l)),m>0&&(p=Math.min(p,(f.w-h)/m)),n>0&&(p=Math.min(p,i/n)),o>0&&(p=Math.min(p,(f.h-i)/o)),p*=.85,p=Math.max(b.getCameraOptions().zoomSteps[0],p),this.overviewZoom=p,b.options.quickZoomPreservesScreenBounds&&(this.cleanupZoomReactor=dA("zoom change in quick zoom",()=>{b.getZoomLevel(),this.updateBrush()}));let{x:q,y:r,z:s}=b.getCamera(),t=s/p;b.setCamera(new iK((q+j)*t-j,(r+k)*t-k,p)),b.options.quickZoomPreservesScreenBounds||this.updateBrush()}onExit(){this.cleanupZoomReactor(),this.zoomToNewViewport(),this.editor.updateInstanceState({zoomBrush:null})}onPointerUp(){let a=this.info.onInteractionEnd?.split(".")[0]??"select";this.editor.setCurrentTool(a)}onCancel(){this.qzState="idle";let a=this.info.onInteractionEnd?.split(".")[0]??"select";this.editor.setCurrentTool(a)}onKeyUp(a){"Shift"===a.key&&this.parent.transition("idle",this.info)}updateBrush(){let{editor:a}=this,b=this.getNextVpb();this.nextVpb.setTo(b),a.updateInstanceState({zoomBrush:b.toJson()})}zoomToNewViewport(){let{editor:a}=this;switch(this.qzState){case"idle":a.zoomToBounds(this.initialVpb,{inset:0});break;case"moving":a.zoomToBounds(this.nextVpb,{inset:0})}}onPointerMove(){"moving"===this.qzState&&this.updateBrush()}onTick(){let{editor:a}=this;if("idle"===this.qzState){let b=a.getZoomLevel();iK.Dist2(a.inputs.getCurrentPagePoint(),this.initialPp)*b>a.options.dragDistanceSquared/b&&(this.qzState="moving",this.updateBrush())}}getNextVpb(){let a,b,{editor:c}=this;if(c.options.quickZoomPreservesScreenBounds){let d=this.overviewZoom/c.getCamera().z;a=this.initialVpb.w*d,b=this.initialVpb.h*d}else a=this.initialVpb.w,b=this.initialVpb.h;let{x:d,y:e}=c.inputs.getCurrentPagePoint(),f=c.getViewportScreenBounds(),g=c.inputs.getCurrentScreenPoint(),{x:h,y:i}=new iK((g.x-f.x)/f.w,(g.y-f.y)/f.h);return new kt(d-h*a,e-i*b,a,b)}}let RG=[class extends pd{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[Qo,Qp,Qn]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}},class extends pd{static id="hand";static initial="idle";static isLockable=!1;static children(){return[Qr,Qs,Qq]}onDoubleClick(a){if("settle"===a.phase){let a=this.editor.inputs.getCurrentScreenPoint();this.editor.zoomIn(a,{animation:{duration:220,easing:iI}})}}onTripleClick(a){if("settle"===a.phase){let a=this.editor.inputs.getCurrentScreenPoint();this.editor.zoomOut(a,{animation:{duration:320,easing:iI}})}}onQuadrupleClick(a){if("settle"===a.phase){let a=this.editor.getZoomLevel(),b=this.editor.inputs.getCurrentScreenPoint();1===a?this.editor.zoomToFit({animation:{duration:400,easing:iI}}):this.editor.resetZoom(b,{animation:{duration:320,easing:iI}})}}},class extends pd{static id="laser";static initial="idle";static children(){return[Qt,Qu]}static isLockable=!1;sessionId=null;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){this.sessionId=null}onCancel(){this.sessionId&&this.editor.scribbles.isSessionActive(this.sessionId)?(this.editor.scribbles.clearSession(this.sessionId),this.sessionId=null,this.transition("idle")):this.editor.setCurrentTool("select")}getSessionId(){return this.sessionId&&this.editor.scribbles.isSessionActive(this.sessionId)||(this.sessionId=this.editor.scribbles.startSession({selfConsume:!1,idleTimeoutMs:this.editor.options.laserDelayMs,fadeMode:"grouped",fadeEasing:"ease-in"})),this.sessionId}},class extends pd{static id="zoom";static initial="idle";static children(){return[RC,RD,RE,RF]}static isLockable=!1;info={};onEnter(a){this.info=a;let b=a.onInteractionEnd?.split(".")[0];this.parent.setCurrentToolIdMask(b),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}})}onKeyDown(){this.updateCursor()}onKeyUp(a){this.updateCursor(),"z"===a.key.toLowerCase()&&this.complete()}onInterrupt(){this.complete()}complete(){let a=this.info.onInteractionEnd?.split(".")[0]??"select";this.editor.setCurrentTool(a)}updateCursor(){this.editor.inputs.getAltKey()&&!this.editor.isIn("zoom.zoom_quick")?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}},class extends pd{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[QF,Qy,QL,QR,QW,RA,Qv,Q0,QD,QV,Qx,QI,QX,Q_,QU,QQ,QS,QG]}cleanUpDuplicateProps(){let a=this.editor.getSelectedShapeIds(),b=this.editor.getInstanceState();if(!b.duplicateProps)return;let c=new Set(b.duplicateProps.shapeIds);a.length===c.size&&a.every(a=>c.has(a))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=dA("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(a){console.error(a)}})}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}],RH=bT.default.forwardRef(function({isEditing:a,text:b,handleFocus:c,handleChange:d,handleKeyDown:e,handlePaste:f,handleBlur:g,handleInputPointerDown:h,handleDoubleClick:i},j){let k=jA();return(0,bS.jsx)("textarea",{ref:j,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!a,readOnly:!a,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:b,onFocus:c,onChange:a=>{d({plaintext:a.target.value})},onKeyDown:a=>e(a.nativeEvent),onBlur:g,onTouchEnd:k.markEventAsHandled,onContextMenu:a?a=>a.stopPropagation():void 0,onPointerDown:h,onPaste:f,onDoubleClick:i,onDragStart:jm})});bT.default.memo(function({shapeId:a,type:b,text:c,labelColor:d,font:e,fontSize:f,lineHeight:g,align:h,verticalAlign:i,wrap:j,isSelected:k,padding:l=0,onKeyDown:m,classNamePrefix:n,style:o,textWidth:p,textHeight:q,showTextOutline:r=!0}){let s,t,u,v,w,{rInput:y,isEmpty:z,isEditing:A,isReadyForEditing:B,...C}=(t=(s=OF(a)).isEditing,u=jA(),v=(0,bT.useRef)(null),w=0===(c||"").trim().length,(0,bT.useEffect)(()=>{function b(b){b.shapeId===a&&v.current?.select?.()}return u.on("select-all-text",b),()=>{u.off("select-all-text",b)}},[u,a,t]),(0,bT.useEffect)(()=>{t&&(document.activeElement!==v.current&&v.current?.focus(),u.getInstanceState().isCoarsePointer&&v.current?.select())},[u,t]),{rInput:v,handleKeyDown:(0,bT.useCallback)(b=>{u.getEditingShapeId()===a&&"Enter"===b.key&&(b.ctrlKey||b.metaKey)&&u.complete()},[u,a]),handleChange:(0,bT.useCallback)(({plaintext:c})=>{if(u.getEditingShapeId()!==a)return;let d=N0.normalizeText(c||"");u.updateShape({id:a,type:b,props:{text:d}})},[u,a,b]),isEmpty:w,...s}),D=N0.normalizeTextForDom(c||""),E=D.length>0,F=OD(h);if(!A&&!E)return null;let G=n||"tl-text";return(0,bS.jsx)("div",{className:`${G}-label tl-text-wrapper tl-plain-text-wrapper`,"aria-hidden":!A,"data-font":e,"data-align":h,"data-hastext":!z,"data-isediting":A,"data-is-ready-for-editing":B,"data-textwrap":!!j,"data-isselected":k,style:{justifyContent:"middle"===h||F?"center":h,alignItems:"middle"===i?"center":i,padding:l,...o},children:(0,bS.jsxs)("div",{className:`${G}-label__inner tl-text-content__wrapper`,style:{fontSize:f,lineHeight:g.toString(),minHeight:Math.floor(f*g)+"px",minWidth:Math.ceil(p||0),color:d,width:p?Math.ceil(p):void 0,height:q?Math.ceil(q):void 0},children:[(0,bS.jsx)("div",{className:(0,jb.default)(`${G} tl-text tl-text-content`,r?"tl-text__outline":"tl-text__no-outline"),dir:"auto",children:D.split("\n").map((a,b)=>(0,bS.jsx)("div",{dir:"auto",children:a},b))}),(B||k)&&(0,bS.jsx)(RH,{ref:y,text:c,isEditing:A,shapeId:a,...C,handleKeyDown:m??C.handleKeyDown})]})})});let RI={fonts:{tldraw_mono:`${mo()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${mo()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${mo()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${mo()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${mo()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${mo()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${mo()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${mo()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${mo()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${mo()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${mo()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${mo()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${mo()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${mo()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${mo()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${mo()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};function RJ(a){return(0,bT.useMemo)(()=>a?{fonts:{...RI.fonts,...a?.fonts}}:RI,[a])}let RK={...RI,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-lined-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map(a=>[a,`${mo()}/icons/icon/0_merged.svg#${a}`])),translations:Object.fromEntries(iz.map(a=>[a.locale,`${mo()}/translations/${a.locale}.json`])),embedIcons:Object.fromEntries(AS.map(a=>[a.type,`${mo()}/embed-icons/${a.type}.png`]))};function RL(a){return(0,bT.useMemo)(()=>a?{fonts:Object.assign({...RK.fonts},{...a?.fonts}),icons:Object.assign({...RK.icons},{...a?.icons}),embedIcons:Object.assign({...RK.embedIcons},{...a?.embedIcons}),translations:Object.assign({...RK.translations},{...a?.translations})}:RK,[a])}let RM=d3(function({overrides:a,components:b,assetUrls:c,onUiEvent:d,forceMobile:e,mediaMimeTypes:f,children:g}){let h=jB();return(0,bS.jsx)(Ej.Provider,{value:f,children:(0,bS.jsx)(C3,{children:(0,bS.jsx)(Ae,{assetUrls:RL(c),children:(0,bS.jsx)(Al,{overrides:Em(a),locale:h?.user.getLocale()??j3.locale,children:(0,bS.jsx)(BO,{onEvent:d,children:(0,bS.jsx)(DZ,{children:(0,bS.jsx)(Dg,{context:"tla",children:(0,bS.jsx)(Ab,{children:(0,bS.jsx)(A_,{forceMobile:e,children:(0,bS.jsx)(Jh,{overrides:b,children:(0,bS.jsx)(RN,{overrides:a,children:g})})})})})})})})})})})});function RN({overrides:a,children:b}){let c,d,e=(c=Ek(),d=El(null==a?[]:Array.isArray(a)?a:[a]),(0,bT.useMemo)(()=>(function(a,b){let c={};for(let b of a)if(b.translations)for(let[a,d]of cI(b.translations)){let b=c[a];b||(b=c[a]={}),Object.assign(b,d)}return{actions:(b,c,d)=>{for(let e of a)e.actions&&(c=e.actions(b,c,d));return c},tools:(c,d,e)=>{for(let f of a)f.tools&&(d=f.tools(c,d,{...b,...e}));return d},translations:c}})(d,c),[d,c]));return(0,bS.jsx)(Jm,{overrides:e.actions,children:(0,bS.jsx)(Eo,{overrides:e.tools,children:b})})}let RO=bT.default.memo(function({renderDebugMenuItems:a,children:b,hideUi:c,components:d,...e}){return(0,bS.jsx)(RM,{...e,components:d,children:(0,bS.jsx)(RP,{hideUi:c,renderDebugMenuItems:a,children:b})})}),RP=bT.default.memo(function({children:a,hideUi:b,...c}){let d,e,f,g,h,i,j,k,l;return d=jA(),e=BE(),f=Jn(),g=Ep(),h=d8("is focused",()=>d.getInstanceState().isFocused,[d]),(0,bT.useEffect)(()=>{var a;if(!h)return;let b=[],c=d.getContainer(),i=(a,d)=>{IZ(a,{element:c.ownerDocument.body},d),b.push(()=>{IZ.unbind(a,d)})};for(let a of Object.values(f))a.kbd&&(!e||a.readonlyOk)&&(I0.includes(a.id)||i(I2(a.kbd),b=>{(!I1(d)||a.isRequiredA11yAction)&&(jm(b),a.onSelect("kbd"))}));for(let a of Object.values(g))!(!a.kbd||!a.readonlyOk&&d.getIsReadonly())&&(I0.includes(a.id)||i(I2(a.kbd),b=>{I1(d)||(jm(b),a.onSelect("kbd"))}));return i(",",a=>{if(I1(d)||d.inputs.keys.has("Comma"))return;jm(a),d.focus(),d.inputs.keys.add("Comma");let{x:b,y:c,z:e}=d.inputs.getCurrentPagePoint(),f=d.pageToScreen({x:b,y:c}),g={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:e},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:jr(a),pointerId:0,button:0,isPen:d.getInstanceState().isPenMode,target:"canvas"};d.dispatch(g)}),a=a=>{if(I1(d)||!d.inputs.keys.has("Comma"))return;d.inputs.keys.delete("Comma");let{x:b,y:c,z:e}=d.inputs.getCurrentScreenPoint(),f={type:"pointer",name:"pointer_up",point:{x:b,y:c,z:e},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:jr(a),pointerId:0,button:0,isPen:d.getInstanceState().isPenMode,target:"canvas"};d.dispatch(f)},IZ(",",{element:c.ownerDocument.body,keyup:!0,keydown:!1},a),b.push(()=>{IZ.unbind(",",a)}),()=>{b.forEach(a=>a())}},[f,g,e,d,h]),j=(i=jA()).getContainer().ownerDocument,k=BP(),l=d8("editor.isFocused",()=>i.getInstanceState().isFocused,[i]),(0,bT.useEffect)(()=>{if(!l)return;let a=async a=>{0===i.getSelectedShapeIds().length||null!==i.getEditingShapeId()||D9(i)||(jm(a),await Ee(i),k("copy",{source:"kbd"}))};async function b(a){0===i.getSelectedShapeIds().length||null!==i.getEditingShapeId()||D9(i)||(jm(a),await Ee(i),i.deleteShapes(i.getSelectedShapeIds()),k("cut",{source:"kbd"}))}let c=!1,d=a=>{1===a.button&&(c=!0,i.timers.requestAnimationFrame(()=>{c=!1}))},e=a=>{let b;if(c)return void i.markEventAsHandled(a);if(null!==i.getEditingShapeId()||D9(i))return;let d=!1;i.inputs.getShiftKey()&&(d=!0),i.user.getIsPasteAtCursorMode()&&(d=!d),d&&(b=i.inputs.getCurrentPagePoint());let e=()=>{a.clipboardData&&Eb(i,a.clipboardData,b)};if(navigator.clipboard?.read){let c=Array.from(a.clipboardData?.files||[]);navigator.clipboard.read().then(a=>{Array.isArray(a)&&a[0]instanceof ClipboardItem&&Ec({editor:i,clipboardItems:a,point:b,fallbackFiles:c})},()=>{e()})}else e();jm(a),k("paste",{source:"kbd"})};return j?.addEventListener("copy",a),j?.addEventListener("cut",b),j?.addEventListener("paste",e),j?.addEventListener("pointerup",d),()=>{j?.removeEventListener("copy",a),j?.removeEventListener("cut",b),j?.removeEventListener("paste",e),j?.removeEventListener("pointerup",d)}},[i,k,l,j]),(0,bS.jsxs)(bS.Fragment,{children:[a,b?null:(0,bS.jsx)(RQ,{...c})]})}),RQ=bT.default.memo(function(){let a=jA(),b=Am(),c=A0(),d=BE(),e=d8("focus",()=>a.getInstanceState().isFocusMode,[a]),f=d8("debug",()=>a.getInstanceState().isDebugMode,[a]),{SharePanel:g,TopPanel:h,MenuPanel:i,StylePanel:j,Toolbar:k,HelpMenu:l,NavigationPanel:m,HelperButtons:n,DebugPanel:o,Toasts:p,Dialogs:q,A11y:r}=Ji();!function(){let a=jA(),{addToast:b}=D$();(0,bT.useEffect)(()=>{function c({name:a,count:c}){b({title:"Maximum shapes reached",description:`You've reached the maximum number of shapes allowed on ${a} (${c}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return a.addListener("max-shapes",c),()=>{a.removeListener("max-shapes",c)}},[a,b])}();let s=(0,bT.useRef)(!1),t=(0,bT.useRef)(-1),[u,v]=(0,bT.useState)(!1);d7("update hide toolbar while delayed",()=>{0},[]);let{"toggle-focus-mode":w}=Jn(),{breakpointsAbove:y,breakpointsBelow:z}=(0,bT.useMemo)(()=>{let a=[],b=[];for(let d=0;d<AY.length;d++)d<=c?a.push(d):b.push(d);return{breakpointsAbove:a,breakpointsBelow:b}},[c]);return(0,bS.jsxs)("div",{className:(0,jb.default)("tlui-layout",{"tlui-layout__mobile":c<AZ.TABLET_SM}),"data-iseditinganything":u,"data-breakpoint":c,"data-breakpoints-above":y.join(" "),"data-breakpoints-below":z.join(" "),children:[(0,bS.jsx)(Ap,{}),e?(0,bS.jsx)("div",{className:"tlui-layout__top",children:(0,bS.jsx)(Ao,{type:"icon",className:"tlui-focus-button",title:b("focus-mode.toggle-focus-mode"),onClick:()=>w.onSelect("menu"),children:(0,bS.jsx)(AF,{icon:"dot"})})}):(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsxs)("div",{className:"tlui-layout__top",children:[(0,bS.jsxs)("div",{className:"tlui-layout__top__left",children:[i&&(0,bS.jsx)(i,{}),n&&(0,bS.jsx)(n,{})]}),(0,bS.jsx)("div",{className:"tlui-layout__top__center",children:h&&(0,bS.jsx)(h,{})}),(0,bS.jsxs)("div",{className:"tlui-layout__top__right",children:[g&&(0,bS.jsx)(g,{}),j&&c>=AZ.TABLET_SM&&!d&&(0,bS.jsx)(j,{})]})]}),(0,bS.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,bS.jsxs)("div",{className:"tlui-layout__bottom__main",children:[m&&(0,bS.jsx)(m,{}),k&&(0,bS.jsx)(k,{}),l&&(0,bS.jsx)(l,{})]}),f&&o&&(0,bS.jsx)(o,{}),r&&(0,bS.jsx)(r,{})]})]}),p&&(0,bS.jsx)(p,{}),q&&(0,bS.jsx)(q,{})]})});function RR(){let{RichTextToolbar:a,ImageToolbar:b,VideoToolbar:c,CursorChatBubble:d,FollowingIndicator:e}=Ji();return(0,bS.jsxs)(bS.Fragment,{children:[a&&(0,bS.jsx)(a,{}),b&&(0,bS.jsx)(b,{}),c&&(0,bS.jsx)(c,{}),e&&(0,bS.jsx)(e,{}),d&&(0,bS.jsx)(d,{})]})}let RS=()=>{let{Spinner:a}=q_();return(0,bS.jsx)(qH,{children:a?(0,bS.jsx)(a,{}):null})},RT=[...RG,...OB];function RU(a){let{children:b,maxImageDimension:c,maxAssetSize:d,acceptedImageMimeTypes:e,acceptedVideoMimeTypes:f,onMount:g,components:h={},shapeUtils:i=[],bindingUtils:j=[],tools:k=[],embeds:l,options:m,textOptions:n,...o}=a,p=jV(h,jY),q=h?.InFrontOfTheCanvas,r=(0,bT.useMemo)(()=>o.hideUi?q??null:q?()=>(0,bS.jsxs)(bS.Fragment,{children:[(0,bS.jsx)(RR,{}),(0,bS.jsx)(q,{})]}):RR,[o.hideUi,q]),s=(0,bT.useMemo)(()=>({Scribble:Ks,ShapeIndicators:Ky,CollaboratorScribble:Ks,SelectionForeground:Kt,Handles:Kc,Overlays:Kj,Spinner:BK,LoadingScreen:RS,...p,InFrontOfTheCanvas:r}),[p,r]),t=jX(i),u=(0,bT.useMemo)(()=>b8("type",t,Qm),[t]),v=jX(j),w=(0,bT.useMemo)(()=>b8("type",v,Kz),[v]),y=jX(k),z=(0,bT.useMemo)(()=>b8("id",y,RT),[y]),A=jX(e??cz),B=jX(f??cA),C=m?.text??n,D=(0,bT.useMemo)(()=>({addFontsFromNode:N_,...C,tipTapConfig:{extensions:NU,...C?.tipTapConfig}}),[C]),E=(0,bT.useMemo)(()=>({...m,text:D}),[m,D]),F=(0,bT.useMemo)(()=>[...A,...B],[A,B]),G=RJ(o.assetUrls);return u.find(a=>"embed"===a.type)&&l&&Pw.setEmbedDefinitions(l),(0,bS.jsx)(Ae,{assetUrls:RL(o.assetUrls),children:(0,bS.jsx)(Al,{overrides:Em(o.overrides),locale:o.user?.userPreferences.get().locale??j3.locale,children:(0,bS.jsx)(qA,{initialState:"select",...o,components:s,shapeUtils:u,bindingUtils:w,tools:z,options:E,assetUrls:G,children:(0,bS.jsxs)(RO,{...o,components:s,mediaMimeTypes:F,children:[(0,bS.jsx)(RV,{maxImageDimension:c,maxAssetSize:d,acceptedImageMimeTypes:A,acceptedVideoMimeTypes:B,onMount:g}),b]})})})})}function RV({maxImageDimension:a,maxAssetSize:b,acceptedImageMimeTypes:c,acceptedVideoMimeTypes:d,onMount:e}){let f=jA(),g=D$(),h=Am(),i=BP();qI(()=>{var j;let k=[];return k.push(f.sideEffects.register({instance:{afterChange:(a,b)=>{a.cameraState!==b.cameraState&&"idle"===b.cameraState&&Oy(f)}},instance_page_state:{afterChange:(a,b)=>{if(a.croppingShapeId!==b.croppingShapeId){let c=f.isIn("select.crop");!a.croppingShapeId&&b.croppingShapeId?c||f.setCurrentTool("select.crop.idle"):a.croppingShapeId&&!b.croppingShapeId&&c&&f.setCurrentTool("select.idle")}if(a.editingShapeId!==b.editingShapeId)if(!a.editingShapeId&&b.editingShapeId){if(!f.isIn("select.editing_shape")){let a=f.getEditingShape();a&&"text"===a.type&&f.isInAny("text.pointing","select.resizing")&&f.getInstanceState().isToolLocked?f.setCurrentTool("select.editing_shape",{target:"shape",shape:a,isCreatingTextWhileToolLocked:!0}):f.setCurrentTool("select.editing_shape",{target:"shape",shape:a})}}else a.editingShapeId&&!b.editingShapeId&&f.isIn("select.editing_shape")&&f.setCurrentTool("select.idle")}}})),f.fonts.requestFonts(NS),f.once("edit",()=>i("edit",{source:"unknown"})),j={maxImageDimension:a,maxAssetSize:b,acceptedImageMimeTypes:c,acceptedVideoMimeTypes:d,toasts:g,msg:h},f.registerExternalAssetHandler("file",async a=>N5(f,a,j)),f.registerExternalAssetHandler("url",async a=>N7(f,a,j)),f.registerExternalContentHandler("svg-text",async a=>N8(f,a)),f.registerExternalContentHandler("embed",a=>(function(a,{point:b,url:c,embed:d}){let e=b??(a.inputs.getShiftKey()?a.inputs.getCurrentPagePoint():a.getViewportPageBounds().center),{width:f,height:g}=d,h=gi(),i=ss(new iK(e.x-(f||450)/2,e.y-(g||450)/2),a),j={id:h,type:"embed",x:i.x,y:i.y,props:{w:f,h:g,url:c}};a.canCreateShape(j)&&a.createShape(j).select(h)})(f,a)),f.registerExternalContentHandler("files",async a=>N9(f,a,j)),f.registerExternalContentHandler("file-replace",async a=>N6(f,a,j)),f.registerExternalContentHandler("text",async a=>Oa(f,a)),f.registerExternalContentHandler("url",async a=>Ob(f,a,j)),f.registerExternalContentHandler("tldraw",async a=>Oc(f,a)),f.registerExternalContentHandler("excalidraw",async a=>Od(f,a)),k.push(f.store.props.onMount(f)),k.push(e?.(f)),()=>{k.forEach(a=>a?.())}});let{Canvas:j}=q_(),{ContextMenu:k}=Ji();return k?(0,bS.jsx)(k,{}):j?(0,bS.jsx)(j,{}):null}let RW={text:{tipTapConfig:{extensions:NU},addFontsFromNode:N_}};(0,bT.memo)(function(a){let[b,c]=(0,bT.useState)(null),[d,e]=(0,bT.useState)(null),f=jX(a.shapeUtils??[]),g=(0,bT.useMemo)(()=>b8("type",f,Qm),[f]),h=jX(a.bindingUtils??[]),i=(0,bT.useMemo)(()=>b8("type",h,Kz),[h]),j=function(a){let[b,c]=(0,bT.useState)(()=>({store:pM(a),opts:a}));if(!cM(b.opts,a)){let b={store:pM(a),opts:a};return c(b),b.store}return b.store}({snapshot:a.snapshot,shapeUtils:g}),{pageId:k,bounds:l,scale:m,pixelRatio:n,background:o,padding:p,darkMode:q,preserveAspectRatio:r,format:s="svg",licenseKey:t,assetUrls:u,options:v,textOptions:w}=a,y=(0,bT.useMemo)(()=>({...RW,...v,text:{...RW.text,...v?.text??w}}),[v,w]),z=RJ(u);return(0,bT.useLayoutEffect)(()=>{if(!d||!j)return;let a=!1,b=document.createElement("div");d.appendChild(b),d.classList.add("tl-container","tl-theme__light");let e=new px({store:j,shapeUtils:g,bindingUtils:i,tools:[],getContainer:()=>b,licenseKey:t,fontAssetUrls:z.fonts,options:y});k&&e.setCurrentPage(k);let f=e.getCurrentPageShapeIds();return async function(){await e.fonts.loadRequiredFontsForCurrentPage(e.options.maxFontsToLoadBeforeRender);let b=await e.toImage([...f],{bounds:l,scale:m,background:o,padding:p,darkMode:q,preserveAspectRatio:r,format:s});!b||a||(c(URL.createObjectURL(b.blob)),e.dispose())}(),()=>{a=!0}},[s,d,j,g,i,k,l,m,o,p,q,r,t,n,z,y]),(0,bT.useEffect)(()=>()=>{b&&URL.revokeObjectURL(b)},[b]),(0,bS.jsx)("div",{ref:e,style:{position:"relative",width:"100%",height:"100%"},children:b&&(0,bS.jsx)("img",{src:b,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})}),(0,bT.memo)(function({children:a}){let b=Am(),c=A0(),d=(0,bT.useRef)(null);qq(d);let e=a??(0,bS.jsx)(Gf,{});return c<AZ.MOBILE?null:(0,bS.jsx)("div",{ref:d,className:"tlui-help-menu",children:(0,bS.jsxs)(BR,{id:"help menu",children:[(0,bS.jsx)(BS,{children:(0,bS.jsx)(Ao,{type:"help",title:b("help-menu.title"),"data-testid":"help-menu.button",children:(0,bS.jsx)(AF,{icon:"question-mark",small:!0})})}),(0,bS.jsx)(BT,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,bS.jsx)(A3,{type:"menu",sourceId:"help-menu",children:e})})]})})});var RX=a.i(437136),RX=RX;bT.forwardRef(function({children:a,className:b},c){return(0,bS.jsxs)(RX.Trigger,{ref:c,className:(0,jb.default)("tlui-button tlui-select__trigger",b),children:[a,(0,bS.jsx)(RX.Icon,{className:"tlui-select__chevron",children:(0,bS.jsx)(AD,{icon:"chevron-down",label:"",small:!0})})]})});var RY=((v=RY||{}).Sticky="sticky",v.Ellipse="ellipse",v.Rectangle="rectangle",v.Triangle="triangle",v.Draw="draw",v.Arrow="arrow",v.Text="text",v.Group="group",v.Image="image",v.Video="video",v),RZ=((w=RZ||{}).White="white",w.LightGray="lightGray",w.Gray="gray",w.Black="black",w.Green="green",w.Cyan="cyan",w.Blue="blue",w.Indigo="indigo",w.Violet="violet",w.Red="red",w.Orange="orange",w.Yellow="yellow",w),R$=((y=R$||{}).Small="small",y.Medium="medium",y.Large="large",y),R_=((z=R_||{}).Draw="draw",z.Solid="solid",z.Dashed="dashed",z.Dotted="dotted",z),R0=((A=R0||{}).Start="start",A.Middle="middle",A.End="end",A.Justify="justify",A),R1=((B=R1||{}).Script="script",B.Sans="sans",B.Serif="serif",B.Mono="mono",B),R2=((C=R2||{}).Arrow="arrow",C),R3=((D=R3||{}).Image="image",D.Video="video",D),AA=f$;let R4=AA.object({schemaVersion:AA.literal(1),storeVersion:AA.positiveInteger,recordVersions:AA.dict(AA.string,AA.object({version:AA.positiveInteger,subTypeVersions:AA.dict(AA.string,AA.positiveInteger).optional(),subTypeKey:AA.string.optional()}))}),R5=AA.object({schemaVersion:AA.literal(2),sequences:AA.dict(AA.string,AA.positiveInteger)});AA.object({tldrawFileFormatVersion:AA.nonZeroInteger,schema:AA.numberUnion("schemaVersion",{1:R4,2:R5}),records:AA.arrayOf(AA.object({id:AA.string,typeName:AA.string}).allowUnknownProperties())}),bV("tldraw","4.4.0","esm");let R6=()=>new Map,R7=a=>{let b=R6();return a.forEach((a,c)=>{b.set(c,a)}),b},R8=(a,b,c)=>{let d=a.get(b);return void 0===d&&a.set(b,d=c()),d},R9=()=>new Set,Sa=a=>a[a.length-1],Sb=(a,b)=>{for(let c=0;c<b.length;c++)a.push(b[c])},Sc=Array.from,Sd=Array.isArray;class Se{constructor(){this._observers=R6()}on(a,b){return R8(this._observers,a,R9).add(b),b}once(a,b){let c=(...d)=>{this.off(a,c),b(...d)};this.on(a,c)}off(a,b){let c=this._observers.get(a);void 0!==c&&(c.delete(b),0===c.size&&this._observers.delete(a))}emit(a,b){return Sc((this._observers.get(a)||R6()).values()).forEach(a=>a(...b))}destroy(){this._observers=R6()}}let Sf=Math.floor,Sg=Math.abs,Sh=(a,b)=>a<b?a:b,Si=(a,b)=>a>b?a:b,Sj=a=>0!==a?a<0:1/a<0,Sk=Number.MAX_SAFE_INTEGER,Sl=Number.isInteger||(a=>"number"==typeof a&&isFinite(a)&&Sf(a)===a);(0,String.fromCharCode)(65535);let Sm=/^\s*/g,Sn=/([A-Z])/g,So=(a,b)=>a.replace(Sn,a=>`${b}${a.toLowerCase()}`).replace(Sm,""),Sp="u">typeof TextEncoder?new TextEncoder:null,Sq=Sp?a=>Sp.encode(a):a=>{let b=unescape(encodeURIComponent(a)),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.codePointAt(a);return d},Sr="u"<typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Sr&&1===Sr.decode(new Uint8Array).length&&(Sr=null);class Ss{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let St=()=>new Ss,Su=a=>{let b=new Uint8Array((a=>{let b=a.cpos;for(let c=0;c<a.bufs.length;c++)b+=a.bufs[c].length;return b})(a)),c=0;for(let d=0;d<a.bufs.length;d++){let e=a.bufs[d];b.set(e,c),c+=e.length}return b.set(new Uint8Array(a.cbuf.buffer,0,a.cpos),c),b},Sv=(a,b)=>{let c=a.cbuf.length;a.cpos===c&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(2*c),a.cpos=0),a.cbuf[a.cpos++]=b},Sw=(a,b)=>{for(;b>127;)Sv(a,128|127&b),b=Sf(b/128);Sv(a,127&b)},Sx=(a,b)=>{let c=Sj(b);for(c&&(b=-b),Sv(a,128*(b>63)|64*!!c|63&b),b=Sf(b/64);b>0;)Sv(a,128*(b>127)|127&b),b=Sf(b/128)},Sy=new Uint8Array(3e4),Sz=Sy.length/3,SA=Sp&&Sp.encodeInto?(a,b)=>{if(b.length<Sz){let c=Sp.encodeInto(b,Sy).written||0;Sw(a,c);for(let b=0;b<c;b++)Sv(a,Sy[b])}else SC(a,Sq(b))}:(a,b)=>{let c=unescape(encodeURIComponent(b)),d=c.length;Sw(a,d);for(let b=0;b<d;b++)Sv(a,c.codePointAt(b))},SB=(a,b)=>{let c=a.cbuf.length,d=a.cpos,e=Sh(c-d,b.length),f=b.length-e;a.cbuf.set(b.subarray(0,e),d),a.cpos+=e,f>0&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(Si(2*c,f)),a.cbuf.set(b.subarray(e)),a.cpos=f)},SC=(a,b)=>{Sw(a,b.byteLength),SB(a,b)},SD=(a,b)=>{let c;(c=a.cbuf.length)-a.cpos<b&&(a.bufs.push(new Uint8Array(a.cbuf.buffer,0,a.cpos)),a.cbuf=new Uint8Array(2*Si(c,b)),a.cpos=0);let d=new DataView(a.cbuf.buffer,a.cpos,b);return a.cpos+=b,d},SE=new DataView(new ArrayBuffer(4)),SF=(a,b)=>{switch(typeof b){case"string":Sv(a,119),SA(a,b);break;case"number":if(Sl(b)&&0x7fffffff>=Sg(b))Sv(a,125),Sx(a,b);else if(SE.setFloat32(0,b),SE.getFloat32(0)===b)Sv(a,124),SD(a,4).setFloat32(0,b,!1);else Sv(a,123),SD(a,8).setFloat64(0,b,!1);break;case"bigint":Sv(a,122),SD(a,8).setBigInt64(0,b,!1);break;case"object":if(null===b)Sv(a,126);else if(Sd(b)){Sv(a,117),Sw(a,b.length);for(let c=0;c<b.length;c++)SF(a,b[c])}else if(b instanceof Uint8Array)Sv(a,116),SC(a,b);else{Sv(a,118);let c=Object.keys(b);Sw(a,c.length);for(let d=0;d<c.length;d++){let e=c[d];SA(a,e),SF(a,b[e])}}break;case"boolean":Sv(a,b?120:121);break;default:Sv(a,127)}};class SG extends Ss{constructor(a){super(),this.w=a,this.s=null,this.count=0}write(a){this.s===a?this.count++:(this.count>0&&Sw(this,this.count-1),this.count=1,this.w(this,a),this.s=a)}}let SH=a=>{a.count>0&&(Sx(a.encoder,1===a.count?a.s:-a.s),a.count>1&&Sw(a.encoder,a.count-2))};class SI{constructor(){this.encoder=new Ss,this.s=0,this.count=0}write(a){this.s===a?this.count++:(SH(this),this.count=1,this.s=a)}toUint8Array(){return SH(this),Su(this.encoder)}}let SJ=a=>{if(a.count>0){let b=2*a.diff+ +(1!==a.count);Sx(a.encoder,b),a.count>1&&Sw(a.encoder,a.count-2)}};class SK{constructor(){this.encoder=new Ss,this.s=0,this.count=0,this.diff=0}write(a){this.diff===a-this.s?(this.s=a,this.count++):(SJ(this),this.count=1,this.diff=a-this.s,this.s=a)}toUint8Array(){return SJ(this),Su(this.encoder)}}class SL{constructor(){this.sarr=[],this.s="",this.lensE=new SI}write(a){this.s+=a,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(a.length)}toUint8Array(){let a=new Ss;return this.sarr.push(this.s),this.s="",SA(a,this.sarr.join("")),SB(a,this.lensE.toUint8Array()),Su(a)}}let SM=()=>{throw Error("Method unimplemented")},SN=()=>{throw Error("Unexpected case")},SO=Error("Unexpected end of array"),SP=Error("Integer out of Range");class SQ{constructor(a){this.arr=a,this.pos=0}}let SR=a=>new SQ(a),SS=a=>{var b;let c;return b=SU(a),c=new Uint8Array(a.arr.buffer,a.pos+a.arr.byteOffset,b),a.pos+=b,c},ST=a=>a.arr[a.pos++],SU=a=>{let b=0,c=1,d=a.arr.length;for(;a.pos<d;){let d=a.arr[a.pos++];if(b+=(127&d)*c,c*=128,d<128)return b;if(b>Sk)throw SP}throw SO},SV=a=>{let b=a.arr[a.pos++],c=63&b,d=64,e=(64&b)>0?-1:1;if((128&b)==0)return e*c;let f=a.arr.length;for(;a.pos<f;){if(c+=(127&(b=a.arr[a.pos++]))*d,d*=128,b<128)return e*c;if(c>Sk)throw SP}throw SO},SW=Sr?a=>Sr.decode(SS(a)):a=>{let b=SU(a);if(0===b)return"";{let c=String.fromCodePoint(ST(a));if(--b<100)for(;b--;)c+=String.fromCodePoint(ST(a));else for(;b>0;){let d=b<1e4?b:1e4,e=a.arr.subarray(a.pos,a.pos+d);a.pos+=d,c+=String.fromCodePoint.apply(null,e),b-=d}return decodeURIComponent(escape(c))}},SX=(a,b)=>{let c=new DataView(a.arr.buffer,a.arr.byteOffset+a.pos,b);return a.pos+=b,c},SY=[a=>void 0,a=>null,SV,a=>SX(a,4).getFloat32(0,!1),a=>SX(a,8).getFloat64(0,!1),a=>SX(a,8).getBigInt64(0,!1),a=>!1,a=>!0,SW,a=>{let b=SU(a),c={};for(let d=0;d<b;d++)c[SW(a)]=SZ(a);return c},a=>{let b=SU(a),c=[];for(let d=0;d<b;d++)c.push(SZ(a));return c},SS],SZ=a=>SY[127-ST(a)](a);class S$ extends SQ{constructor(a,b){super(a),this.reader=b,this.s=null,this.count=0}read(){0===this.count&&(this.s=this.reader(this),this.pos!==this.arr.length?this.count=SU(this)+1:this.count=-1);return this.count--,this.s}}class S_ extends SQ{constructor(a){super(a),this.s=0,this.count=0}read(){if(0===this.count){this.s=SV(this);let a=Sj(this.s);this.count=1,a&&(this.s=-this.s,this.count=SU(this)+2)}return this.count--,this.s}}class S0 extends SQ{constructor(a){super(a),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){let a=SV(this);this.diff=Sf(a/2),this.count=1,1&a&&(this.count=SU(this)+2)}return this.s+=this.diff,this.count--,this.s}}class S1{constructor(a){this.decoder=new S_(a),this.str=SW(this.decoder),this.spos=0}read(){let a=this.spos+this.decoder.read(),b=this.str.slice(this.spos,a);return this.spos=a,b}}var S2=a.i(666680);S2.webcrypto.subtle;let S3=S2.webcrypto.getRandomValues.bind(S2.webcrypto),S4=()=>S3(new Uint32Array(1))[0],S5=Date.now,S6=a=>new Promise(a);Promise.all.bind(Promise);let S7=a=>void 0===a?null:a,S8=new class{constructor(){this.map=new Map}setItem(a,b){this.map.set(a,b)}getItem(a){return this.map.get(a)}};try{"u">typeof localStorage&&localStorage&&(S8=localStorage)}catch(a){}let S9=S8,Ta=Symbol("Equality"),Tb=Object.assign,Tc=Object.keys,Td=Object.freeze,Te=a=>{for(let b in a){let c=a[b];("object"==typeof c||"function"==typeof c)&&Te(a[b])}return Td(a)},Tf=(a,b,c=0)=>{try{for(;c<a.length;c++)a[c](...b)}finally{c<a.length&&Tf(a,b,c+1)}},Tg="u">typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("u">typeof process?process:0);"u">typeof navigator&&/Mac/.test(navigator.platform);let Th=[],Ti=a=>(()=>{if(void 0===i)if(Tg){i=R6();let a=process.argv,b=null;for(let c=0;c<a.length;c++){let d=a[c];"-"===d[0]?(null!==b&&i.set(b,""),b=d):null!==b?(i.set(b,d),b=null):Th.push(d)}null!==b&&i.set(b,"")}else"object"==typeof location?(i=R6(),(location.search||"?").slice(1).split("&").forEach(a=>{if(0!==a.length){let[b,c]=a.split("=");i.set(`--${So(b,"-")}`,c),i.set(`-${So(b,"-")}`,c)}})):i=R6();return i})().has(a),Tj=a=>Tg?S7(process.env[a.toUpperCase().replaceAll("-","_")]):S7(S9.getItem(a)),Tk=a=>Ti("--"+a)||null!==Tj(a);Tk("production");let Tl=Tg&&["true","1","2"].includes(process.env.FORCE_COLOR)||!Ti("--no-colors")&&!Tk("no-color")&&(!Tg||process.stdout.isTTY)&&(!Tg||Ti("--color")||null!==Tj("COLORTERM")||(Tj("TERM")||"").includes("color")),Tm=Symbol,Tn=Tm(),To=Tm(),Tp=Tm(),Tq=Tm(),Tr=Tm(),Ts=Tm(),Tt=Tm(),Tu=Tm(),Tv=Tm();S5();let Tw={[Tn]:"\x1b[1m",[To]:"\x1b[2m",[Tp]:"\x1b[34m",[Tr]:"\x1b[32m",[Tq]:"\x1b[37m",[Ts]:"\x1b[31m",[Tt]:"\x1b[35m",[Tu]:"\x1b[38;5;208m",[Tv]:"\x1b[0m"},Tx=Tl?a=>{1===a.length&&a[0]?.constructor===Function&&(a=a[0]());let b=[],c=[],d=0;for(;d<a.length;d++){let c=a[d],e=Tw[c];if(void 0!==e)b.push(e);else if(void 0===c)break;else if(c.constructor===String||c.constructor===Number)b.push(c);else break}for(d>0&&(b.push("\x1b[0m"),c.push(b.join("")));d<a.length;d++){let b=a[d];b instanceof Symbol||c.push(b)}return c}:a=>{1===a.length&&a[0]?.constructor===Function&&(a=a[0]());let b=[],c=[],d=0;for(;d<a.length;d++){let c=a[d];if(void 0===c)break;if(c.constructor===String||c.constructor===Number)b.push(c);else if(c.constructor===Object)break}for(d>0&&c.push(b.join(""));d<a.length;d++){let b=a[d];b instanceof Symbol||c.push(b)}return c},Ty=a=>({[Symbol.iterator](){return this},next:a}),Tz=(a,b)=>Ty(()=>{let{done:c,value:d}=a.next();return{done:c,value:c?void 0:b(d)}});class TA{constructor(a,b){this.clock=a,this.len=b}}class TB{constructor(){this.clients=new Map}}let TC=(a,b,c)=>b.clients.forEach((b,d)=>{let e=a.doc.store.clients.get(d);if(null!=e){let d=e[e.length-1],f=d.id.clock+d.length;for(let d=0,g=b[d];d<b.length&&g.clock<f;g=b[++d])T9(a,e,g.clock,g.len,c)}}),TD=(a,b)=>{let c=a.clients.get(b.client);return void 0!==c&&null!==((a,b)=>{let c=0,d=a.length-1;for(;c<=d;){let e=Sf((c+d)/2),f=a[e],g=f.clock;if(g<=b){if(b<g+f.len)return e;c=e+1}else d=e-1}return null})(c,b.clock)},TE=a=>{a.clients.forEach(a=>{let b,c;for(a.sort((a,b)=>a.clock-b.clock),b=1,c=1;b<a.length;b++){let d=a[c-1],e=a[b];d.clock+d.len>=e.clock?d.len=Si(d.len,e.clock+e.len-d.clock):(c<b&&(a[c]=e),c++)}a.length=c})},TF=(a,b,c,d)=>{R8(a.clients,b,()=>[]).push(new TA(c,d))},TG=(a,b)=>{Sw(a.restEncoder,b.clients.size),Sc(b.clients.entries()).sort((a,b)=>b[0]-a[0]).forEach(([b,c])=>{a.resetDsCurVal(),Sw(a.restEncoder,b);let d=c.length;Sw(a.restEncoder,d);for(let b=0;b<d;b++){let d=c[b];a.writeDsClock(d.clock),a.writeDsLen(d.len)}})},TH=(a,b,c)=>{let d=new TB,e=SU(a.restDecoder);for(let f=0;f<e;f++){a.resetDsCurVal();let e=SU(a.restDecoder),f=SU(a.restDecoder),g=c.clients.get(e)||[],h=T2(c,e);for(let c=0;c<f;c++){let c=a.readDsClock(),f=c+a.readDsLen();if(c<h){h<f&&TF(d,e,h,f-h);let a=T4(g,c),i=g[a];for(!i.deleted&&i.id.clock<c&&(g.splice(a+1,0,Vv(b,i,c-i.id.clock)),a++);a<g.length;)if((i=g[a++]).id.clock<f)i.deleted||(f<i.id.clock+i.length&&g.splice(a,0,Vv(b,i,f-i.id.clock)),i.delete(b));else break}else TF(d,e,c,f-c)}}if(d.clients.size>0){let a=new TQ;return Sw(a.restEncoder,0),TG(a,d),a.toUint8Array()}return null};class TI extends Se{constructor({guid:a="10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^S4()&15>>a/4).toString(16)),collectionid:b=null,gc:c=!0,gcFilter:d=()=>!0,meta:e=null,autoLoad:f=!1,shouldLoad:g=!0}={}){super(),this.gc=c,this.gcFilter=d,this.clientID=S4(),this.guid=a,this.collectionid=b,this.share=new Map,this.store=new T0,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=g,this.autoLoad=f,this.meta=e,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=S6(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});const h=()=>S6(a=>{let b=c=>{(void 0===c||!0===c)&&(this.off("sync",b),a())};this.on("sync",b)});this.on("sync",a=>{!1===a&&this.isSynced&&(this.whenSynced=h()),this.isSynced=void 0===a||!0===a,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=h()}load(){let a=this._item;null===a||this.shouldLoad||Uf(a.parent.doc,a=>{a.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Sc(this.subdocs).map(a=>a.guid))}transact(a,b=null){return Uf(this,a,b)}get(a,b=Ux){let c=R8(this.share,a,()=>{let a=new b;return a._integrate(this,null),a}),d=c.constructor;if(b!==Ux&&d!==b)if(d===Ux){let d=new b;d._map=c._map,c._map.forEach(a=>{for(;null!==a;a=a.left)a.parent=d}),d._start=c._start;for(let a=d._start;null!==a;a=a.right)a.parent=d;return d._length=c._length,this.share.set(a,d),d._integrate(this,null),d}else throw Error(`Type with the name ${a} has already been defined with a different constructor`);return c}getArray(a=""){return this.get(a,UN)}getText(a=""){return this.get(a,U3)}getMap(a=""){return this.get(a,UP)}getXmlElement(a=""){return this.get(a,U6)}getXmlFragment(a=""){return this.get(a,U5)}toJSON(){let a={};return this.share.forEach((b,c)=>{a[c]=b.toJSON()}),a}destroy(){this.isDestroyed=!0,Sc(this.subdocs).forEach(a=>a.destroy());let a=this._item;if(null!==a){this._item=null;let b=a.content;b.doc=new TI({guid:this.guid,...b.opts,shouldLoad:!1}),b.doc._item=a,Uf(a.parent.doc,c=>{let d=b.doc;a.deleted||c.subdocsAdded.add(d),c.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class TJ{constructor(a){this.restDecoder=a}resetDsCurVal(){}readDsClock(){return SU(this.restDecoder)}readDsLen(){return SU(this.restDecoder)}}class TK extends TJ{readLeftID(){return TZ(SU(this.restDecoder),SU(this.restDecoder))}readRightID(){return TZ(SU(this.restDecoder),SU(this.restDecoder))}readClient(){return SU(this.restDecoder)}readInfo(){return ST(this.restDecoder)}readString(){return SW(this.restDecoder)}readParentInfo(){return 1===SU(this.restDecoder)}readTypeRef(){return SU(this.restDecoder)}readLen(){return SU(this.restDecoder)}readAny(){return SZ(this.restDecoder)}readBuf(){var a=SS(this.restDecoder);let b=new Uint8Array(a.byteLength);return b.set(a),b}readJSON(){return JSON.parse(SW(this.restDecoder))}readKey(){return SW(this.restDecoder)}}class TL{constructor(a){this.dsCurrVal=0,this.restDecoder=a}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=SU(this.restDecoder),this.dsCurrVal}readDsLen(){let a=SU(this.restDecoder)+1;return this.dsCurrVal+=a,a}}class TM extends TL{constructor(a){super(a),this.keys=[],SU(a),this.keyClockDecoder=new S0(SS(a)),this.clientDecoder=new S_(SS(a)),this.leftClockDecoder=new S0(SS(a)),this.rightClockDecoder=new S0(SS(a)),this.infoDecoder=new S$(SS(a),ST),this.stringDecoder=new S1(SS(a)),this.parentInfoDecoder=new S$(SS(a),ST),this.typeRefDecoder=new S_(SS(a)),this.lenDecoder=new S_(SS(a))}readLeftID(){return new TX(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new TX(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return SZ(this.restDecoder)}readBuf(){return SS(this.restDecoder)}readJSON(){return SZ(this.restDecoder)}readKey(){let a=this.keyClockDecoder.read();if(a<this.keys.length)return this.keys[a];{let a=this.stringDecoder.read();return this.keys.push(a),a}}}class TN{constructor(){this.restEncoder=St()}toUint8Array(){return Su(this.restEncoder)}resetDsCurVal(){}writeDsClock(a){Sw(this.restEncoder,a)}writeDsLen(a){Sw(this.restEncoder,a)}}class TO extends TN{writeLeftID(a){Sw(this.restEncoder,a.client),Sw(this.restEncoder,a.clock)}writeRightID(a){Sw(this.restEncoder,a.client),Sw(this.restEncoder,a.clock)}writeClient(a){Sw(this.restEncoder,a)}writeInfo(a){Sv(this.restEncoder,a)}writeString(a){SA(this.restEncoder,a)}writeParentInfo(a){Sw(this.restEncoder,+!!a)}writeTypeRef(a){Sw(this.restEncoder,a)}writeLen(a){Sw(this.restEncoder,a)}writeAny(a){SF(this.restEncoder,a)}writeBuf(a){SC(this.restEncoder,a)}writeJSON(a){SA(this.restEncoder,JSON.stringify(a))}writeKey(a){SA(this.restEncoder,a)}}class TP{constructor(){this.restEncoder=St(),this.dsCurrVal=0}toUint8Array(){return Su(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(a){let b=a-this.dsCurrVal;this.dsCurrVal=a,Sw(this.restEncoder,b)}writeDsLen(a){0===a&&SN(),Sw(this.restEncoder,a-1),this.dsCurrVal+=a}}class TQ extends TP{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new SK,this.clientEncoder=new SI,this.leftClockEncoder=new SK,this.rightClockEncoder=new SK,this.infoEncoder=new SG(Sv),this.stringEncoder=new SL,this.parentInfoEncoder=new SG(Sv),this.typeRefEncoder=new SI,this.lenEncoder=new SI}toUint8Array(){let a=St();return Sw(a,0),SC(a,this.keyClockEncoder.toUint8Array()),SC(a,this.clientEncoder.toUint8Array()),SC(a,this.leftClockEncoder.toUint8Array()),SC(a,this.rightClockEncoder.toUint8Array()),SC(a,Su(this.infoEncoder)),SC(a,this.stringEncoder.toUint8Array()),SC(a,Su(this.parentInfoEncoder)),SC(a,this.typeRefEncoder.toUint8Array()),SC(a,this.lenEncoder.toUint8Array()),SB(a,Su(this.restEncoder)),Su(a)}writeLeftID(a){this.clientEncoder.write(a.client),this.leftClockEncoder.write(a.clock)}writeRightID(a){this.clientEncoder.write(a.client),this.rightClockEncoder.write(a.clock)}writeClient(a){this.clientEncoder.write(a)}writeInfo(a){this.infoEncoder.write(a)}writeString(a){this.stringEncoder.write(a)}writeParentInfo(a){this.parentInfoEncoder.write(+!!a)}writeTypeRef(a){this.typeRefEncoder.write(a)}writeLen(a){this.lenEncoder.write(a)}writeAny(a){SF(this.restEncoder,a)}writeBuf(a){SC(this.restEncoder,a)}writeJSON(a){SF(this.restEncoder,a)}writeKey(a){let b=this.keyMap.get(a);void 0===b?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(a)):this.keyClockEncoder.write(b)}}let TR=(a,b,c)=>{let d=new Map;c.forEach((a,c)=>{T2(b,c)>a&&d.set(c,a)}),T1(b).forEach((a,b)=>{c.has(b)||d.set(b,0)}),Sw(a.restEncoder,d.size),Sc(d.entries()).sort((a,b)=>b[0]-a[0]).forEach(([c,d])=>{((a,b,c,d)=>{d=Si(d,b[0].id.clock);let e=T4(b,d);Sw(a.restEncoder,b.length-e),a.writeClient(c),Sw(a.restEncoder,d);let f=b[e];f.write(a,d-f.id.clock);for(let c=e+1;c<b.length;c++)b[c].write(a,0)})(a,b.clients.get(c),c,d)})},TS=(a,b,c,d=TM)=>{let e=SR(b);((a,b,c,d=new TM(a))=>Uf(b,a=>{a.local=!1;let b=!1,c=a.doc,e=c.store,f=((a,b,c)=>{let d=[],e=Sc(c.keys()).sort((a,b)=>a-b);if(0===e.length)return null;let f=()=>{if(0===e.length)return null;let a=c.get(e[e.length-1]);for(;a.refs.length===a.i;){if(e.pop(),!(e.length>0))return null;a=c.get(e[e.length-1])}return a},g=f();if(null===g)return null;let h=new T0,i=new Map,j=(a,b)=>{let c=i.get(a);(null==c||c>b)&&i.set(a,b)},k=g.refs[g.i++],l=new Map,m=()=>{for(let a of d){let b=a.id.client,d=c.get(b);d?(d.i--,h.clients.set(b,d.refs.slice(d.i)),c.delete(b),d.i=0,d.refs=[]):h.clients.set(b,[a]),e=e.filter(a=>a!==b)}d.length=0};for(;;){if(k.constructor!==Vz){let e=R8(l,k.id.client,()=>T2(b,k.id.client))-k.id.clock;if(e<0)d.push(k),j(k.id.client,k.id.clock-1),m();else{let f=k.getMissing(a,b);if(null!==f){d.push(k);let a=c.get(f)||{refs:[],i:0};if(a.refs.length===a.i)j(f,T2(b,f)),m();else{k=a.refs[a.i++];continue}}else(0===e||e<k.length)&&(k.integrate(a,e),l.set(k.id.client,k.id.clock+k.length))}}if(d.length>0)k=d.pop();else if(null!==g&&g.i<g.refs.length)k=g.refs[g.i++];else{if(null===(g=f()))break;k=g.refs[g.i++]}}if(h.clients.size>0){let a=new TQ;return TR(a,h,new Map),Sw(a.restEncoder,0),{missing:i,update:a.toUint8Array()}}return null})(a,e,((a,b)=>{let c=R6(),d=SU(a.restDecoder);for(let e=0;e<d;e++){let d=SU(a.restDecoder),e=Array(d),f=a.readClient(),g=SU(a.restDecoder);c.set(f,{i:0,refs:e});for(let c=0;c<d;c++){let d=a.readInfo();switch(31&d){case 0:{let b=a.readLen();e[c]=new Vb(TZ(f,g),b),g+=b;break}case 10:{let b=SU(a.restDecoder);e[c]=new Vz(TZ(f,g),b),g+=b;break}default:{let h=(192&d)==0,i=new Vw(TZ(f,g),null,(128&d)==128?a.readLeftID():null,null,(64&d)==64?a.readRightID():null,h?a.readParentInfo()?b.get(a.readString()):a.readLeftID():null,h&&(32&d)==32?a.readString():null,Vx(a,d));e[c]=i,g+=i.length}}}}return c})(d,c)),g=e.pendingStructs;if(g){for(let[a,c]of g.missing)if(c<T2(e,a)){b=!0;break}if(f){for(let[a,b]of f.missing){let c=g.missing.get(a);(null==c||c>b)&&g.missing.set(a,b)}g.update=Uj([g.update,f.update])}}else e.pendingStructs=f;let h=TH(d,a,e);if(e.pendingDs){let b=new TM(SR(e.pendingDs));SU(b.restDecoder);let c=TH(b,a,e);h&&c?e.pendingDs=Uj([h,c]):e.pendingDs=h||c}else e.pendingDs=h;if(b){let b=e.pendingStructs.update;e.pendingStructs=null,TS(a.doc,b)}},c,!1))(e,a,c,new d(e))};class TT{constructor(){this.l=[]}}let TU=()=>new TT,TV=(a,b)=>{let c=a.l,d=c.length;a.l=c.filter(a=>b!==a),d===a.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},TW=(a,b,c)=>Tf(a.l,[b,c]);class TX{constructor(a,b){this.client=a,this.clock=b}}let TY=(a,b)=>a===b||null!==a&&null!==b&&a.client===b.client&&a.clock===b.clock,TZ=(a,b)=>new TX(a,b);p=new TB,new class a{constructor(a,b){this.ds=a,this.sv=b}}(p,new Map);let T$=(a,b)=>void 0===b?!a.deleted:b.sv.has(a.id.client)&&(b.sv.get(a.id.client)||0)>a.id.clock&&!TD(b.ds,a.id),T_=(a,b)=>{let c=R8(a.meta,T_,R9),d=a.doc.store;c.has(b)||(b.sv.forEach((b,c)=>{b<T2(d,c)&&T7(a,TZ(c,b))}),TC(a,b.ds,a=>{}),c.add(b))};class T0{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}let T1=a=>{let b=new Map;return a.clients.forEach((a,c)=>{let d=a[a.length-1];b.set(c,d.id.clock+d.length)}),b},T2=(a,b)=>{let c=a.clients.get(b);if(void 0===c)return 0;let d=c[c.length-1];return d.id.clock+d.length},T3=(a,b)=>{let c=a.clients.get(b.id.client);if(void 0===c)c=[],a.clients.set(b.id.client,c);else{let a=c[c.length-1];if(a.id.clock+a.length!==b.id.clock)throw SN()}c.push(b)},T4=(a,b)=>{let c=0,d=a.length-1,e=a[d],f=e.id.clock;if(f===b)return d;let g=Sf(b/(f+e.length-1)*d);for(;c<=d;){if((f=(e=a[g]).id.clock)<=b){if(b<f+e.length)return g;c=g+1}else d=g-1;g=Sf((c+d)/2)}throw SN()},T5=(a,b)=>{let c=a.clients.get(b.client);return c[T4(c,b.clock)]},T6=(a,b,c)=>{let d=T4(b,c),e=b[d];return e.id.clock<c&&e instanceof Vw?(b.splice(d+1,0,Vv(a,e,c-e.id.clock)),d+1):d},T7=(a,b)=>{let c=a.doc.store.clients.get(b.client);return c[T6(a,c,b.clock)]},T8=(a,b,c)=>{let d=b.clients.get(c.client),e=T4(d,c.clock),f=d[e];return c.clock!==f.id.clock+f.length-1&&f.constructor!==Vb&&d.splice(e+1,0,Vv(a,f,c.clock-f.id.clock+1)),f},T9=(a,b,c,d,e)=>{let f;if(0===d)return;let g=c+d,h=T6(a,b,c);do g<(f=b[h++]).id.clock+f.length&&T6(a,b,g),e(f);while(h<b.length&&b[h].id.clock<g)};class Ua{constructor(a,b,c){this.doc=a,this.deleteSet=new TB,this.beforeState=T1(a.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=b,this.meta=new Map,this.local=c,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}let Ub=(a,b)=>(0!==b.deleteSet.clients.size||!!((a,b)=>{for(let[c,d]of a)if(b(d,c))return!0;return!1})(b.afterState,(a,c)=>b.beforeState.get(c)!==a))&&(TE(b.deleteSet),TR(a,b.doc.store,b.beforeState),TG(a,b.deleteSet),!0),Uc=(a,b,c)=>{let d=b._item;(null===d||d.id.clock<(a.beforeState.get(d.id.client)||0)&&!d.deleted)&&R8(a.changed,b,R9).add(c)},Ud=(a,b)=>{let c=a[b],d=a[b-1],e=b;for(;e>0;c=d,d=a[--e-1]){if(d.deleted===c.deleted&&d.constructor===c.constructor&&d.mergeWith(c)){c instanceof Vw&&null!==c.parentSub&&c.parent._map.get(c.parentSub)===c&&c.parent._map.set(c.parentSub,d);continue}break}let f=b-e;return f&&a.splice(b+1-f,f),f},Ue=(a,b)=>{if(b<a.length){let c=a[b],d=c.doc,e=d.store,f=c.deleteSet,g=c._mergeStructs;try{TE(f),c.afterState=T1(c.doc.store),d.emit("beforeObserverCalls",[c,d]);let a=[];c.changed.forEach((b,d)=>a.push(()=>{null!==d._item&&d._item.deleted||d._callObserver(c,b)})),a.push(()=>{c.changedParentTypes.forEach((b,d)=>{d._dEH.l.length>0&&(null===d._item||!d._item.deleted)&&((b=b.filter(a=>null===a.target._item||!a.target._item.deleted)).forEach(a=>{a.currentTarget=d,a._path=null}),b.sort((a,b)=>a.path.length-b.path.length),a.push(()=>{TW(d._dEH,b,c)}))}),a.push(()=>d.emit("afterTransaction",[c,d])),a.push(()=>{c._needFormattingCleanup&&U0(c)})}),Tf(a,[])}finally{d.gc&&((a,b,c)=>{for(let[d,e]of a.clients.entries()){let a=b.clients.get(d);for(let d=e.length-1;d>=0;d--){let f=e[d],g=f.clock+f.len;for(let d=T4(a,f.clock),e=a[d];d<a.length&&e.id.clock<g;e=a[++d]){let e=a[d];if(f.clock+f.len<=e.id.clock)break;e instanceof Vw&&e.deleted&&!e.keep&&c(e)&&e.gc(b,!1)}}}})(f,e,d.gcFilter),f.clients.forEach((a,b)=>{let c=e.clients.get(b);for(let b=a.length-1;b>=0;b--){let d=a[b],e=Sh(c.length-1,1+T4(c,d.clock+d.len-1));for(let a=e,b=c[a];a>0&&b.id.clock>=d.clock;b=c[a])a-=1+Ud(c,a)}}),c.afterState.forEach((a,b)=>{let d=c.beforeState.get(b)||0;if(d!==a){let a=e.clients.get(b),c=Si(T4(a,d),1);for(let b=a.length-1;b>=c;)b-=1+Ud(a,b)}});for(let a=g.length-1;a>=0;a--){let{client:b,clock:c}=g[a].id,d=e.clients.get(b),f=T4(d,c);!(f+1<d.length&&Ud(d,f+1)>1)&&f>0&&Ud(d,f)}if(c.local||c.afterState.get(d.clientID)===c.beforeState.get(d.clientID)||(((...a)=>{console.log(...Tx(a))})(Tu,Tn,"[yjs] ",To,Ts,"Changed the client-id because another client seems to be using it."),d.clientID=S4()),d.emit("afterTransactionCleanup",[c,d]),d._observers.has("update")){let a=new TO;Ub(a,c)&&d.emit("update",[a.toUint8Array(),c.origin,d,c])}if(d._observers.has("updateV2")){let a=new TQ;Ub(a,c)&&d.emit("updateV2",[a.toUint8Array(),c.origin,d,c])}let{subdocsAdded:h,subdocsLoaded:i,subdocsRemoved:j}=c;(h.size>0||j.size>0||i.size>0)&&(h.forEach(a=>{a.clientID=d.clientID,null==a.collectionid&&(a.collectionid=d.collectionid),d.subdocs.add(a)}),j.forEach(a=>d.subdocs.delete(a)),d.emit("subdocs",[{loaded:i,added:h,removed:j},d,c]),j.forEach(a=>a.destroy())),a.length<=b+1?(d._transactionCleanups=[],d.emit("afterAllTransactions",[d,a])):Ue(a,b+1)}}},Uf=(a,b,c=null,d=!0)=>{let e=a._transactionCleanups,f=!1,g=null;null===a._transaction&&(f=!0,a._transaction=new Ua(a,c,d),e.push(a._transaction),1===e.length&&a.emit("beforeAllTransactions",[a]),a.emit("beforeTransaction",[a._transaction,a]));try{g=b(a._transaction)}finally{if(f){let b=a._transaction===e[0];a._transaction=null,b&&Ue(e,0)}}return g};class Ug{constructor(a,b){this.gen=function*(a){let b=SU(a.restDecoder);for(let c=0;c<b;c++){let b=SU(a.restDecoder),c=a.readClient(),d=SU(a.restDecoder);for(let e=0;e<b;e++){let b=a.readInfo();if(10===b){let b=SU(a.restDecoder);yield new Vz(TZ(c,d),b),d+=b}else if((31&b)!=0){let e=(192&b)==0,f=new Vw(TZ(c,d),null,(128&b)==128?a.readLeftID():null,null,(64&b)==64?a.readRightID():null,e?a.readParentInfo()?a.readString():a.readLeftID():null,e&&(32&b)==32?a.readString():null,Vx(a,b));yield f,d+=f.length}else{let b=a.readLen();yield new Vb(TZ(c,d),b),d+=b}}}}(a),this.curr=null,this.done=!1,this.filterSkips=b,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Vz)return this.curr}}class Uh{constructor(a){this.currClient=0,this.startClock=0,this.written=0,this.encoder=a,this.clientStructs=[]}}let Ui=(a,b)=>{if(a.constructor===Vb){let{client:c,clock:d}=a.id;return new Vb(TZ(c,d+b),a.length-b)}if(a.constructor===Vz){let{client:c,clock:d}=a.id;return new Vz(TZ(c,d+b),a.length-b)}{let{client:c,clock:d}=a.id;return new Vw(TZ(c,d+b),null,TZ(c,d+b-1),null,a.rightOrigin,a.parent,a.parentSub,a.content.splice(b))}},Uj=(a,b=TM,c=TQ)=>{if(1===a.length)return a[0];let d=a.map(a=>new b(SR(a))),e=d.map(a=>new Ug(a,!0)),f=null,g=new c,h=new Uh(g);for(;(e=e.filter(a=>null!==a.curr)).sort((a,b)=>{if(a.curr.id.client!==b.curr.id.client)return b.curr.id.client-a.curr.id.client;{let c=a.curr.id.clock-b.curr.id.clock;return 0===c?a.curr.constructor===b.curr.constructor?0:a.curr.constructor===Vz?1:-1:c}}),0!==e.length;){let a=e[0],b=a.curr.id.client;if(null!==f){let c=a.curr,d=!1;for(;null!==c&&c.id.clock+c.length<=f.struct.id.clock+f.struct.length&&c.id.client>=f.struct.id.client;)c=a.next(),d=!0;if(null===c||c.id.client!==b||d&&c.id.clock>f.struct.id.clock+f.struct.length)continue;if(b!==f.struct.id.client)Ul(h,f.struct,f.offset),f={struct:c,offset:0},a.next();else if(f.struct.id.clock+f.struct.length<c.id.clock)if(f.struct.constructor===Vz)f.struct.length=c.id.clock+c.length-f.struct.id.clock;else{Ul(h,f.struct,f.offset);let a=c.id.clock-f.struct.id.clock-f.struct.length;f={struct:new Vz(TZ(b,f.struct.id.clock+f.struct.length),a),offset:0}}else{let b=f.struct.id.clock+f.struct.length-c.id.clock;b>0&&(f.struct.constructor===Vz?f.struct.length-=b:c=Ui(c,b)),f.struct.mergeWith(c)||(Ul(h,f.struct,f.offset),f={struct:c,offset:0},a.next())}}else f={struct:a.curr,offset:0},a.next();for(let c=a.curr;null!==c&&c.id.client===b&&c.id.clock===f.struct.id.clock+f.struct.length&&c.constructor!==Vz;c=a.next())Ul(h,f.struct,f.offset),f={struct:c,offset:0}}return null!==f&&(Ul(h,f.struct,f.offset),f=null),Um(h),TG(g,(a=>{let b=new TB;for(let c=0;c<a.length;c++)a[c].clients.forEach((d,e)=>{if(!b.clients.has(e)){let f=d.slice();for(let b=c+1;b<a.length;b++)Sb(f,a[b].clients.get(e)||[]);b.clients.set(e,f)}});return TE(b),b})(d.map(a=>(a=>{let b=new TB,c=SU(a.restDecoder);for(let d=0;d<c;d++){a.resetDsCurVal();let c=SU(a.restDecoder),d=SU(a.restDecoder);if(d>0){let e=R8(b.clients,c,()=>[]);for(let b=0;b<d;b++)e.push(new TA(a.readDsClock(),a.readDsLen()))}}return b})(a)))),g.toUint8Array()},Uk=a=>{a.written>0&&(a.clientStructs.push({written:a.written,restEncoder:Su(a.encoder.restEncoder)}),a.encoder.restEncoder=St(),a.written=0)},Ul=(a,b,c)=>{a.written>0&&a.currClient!==b.id.client&&Uk(a),0===a.written&&(a.currClient=b.id.client,a.encoder.writeClient(b.id.client),Sw(a.encoder.restEncoder,b.id.clock+c)),b.write(a.encoder,c),a.written++},Um=a=>{Uk(a);let b=a.encoder.restEncoder;Sw(b,a.clientStructs.length);for(let c=0;c<a.clientStructs.length;c++){let d=a.clientStructs[c];Sw(b,d.written),SB(b,d.restEncoder)}},Un="You must not compute changes after the event-handler fired.";class Uo{constructor(a,b){this.target=a,this.currentTarget=a,this.transaction=b,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Up(this.currentTarget,this.target))}deletes(a){return TD(this.transaction.deleteSet,a.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw Error(Un);let a=new Map,b=this.target;this.transaction.changed.get(b).forEach(c=>{if(null!==c){let d,e,f=b._map.get(c);if(this.adds(f)){let a=f.left;for(;null!==a&&this.adds(a);)a=a.left;if(this.deletes(f))if(!(null!==a&&this.deletes(a)))return;else d="delete",e=Sa(a.content.getContent());else null!==a&&this.deletes(a)?(d="update",e=Sa(a.content.getContent())):(d="add",e=void 0)}else{if(!this.deletes(f))return;d="delete",e=Sa(f.content.getContent())}a.set(c,{action:d,oldValue:e})}}),this._keys=a}return this._keys}get delta(){return this.changes.delta}adds(a){return a.id.clock>=(this.transaction.beforeState.get(a.id.client)||0)}get changes(){let a=this._changes;if(null===a){if(0===this.transaction.doc._transactionCleanups.length)throw Error(Un);let b=this.target,c=R9(),d=R9(),e=[];if(a={added:c,deleted:d,delta:e,keys:this.keys},this.transaction.changed.get(b).has(null)){let a=null,f=()=>{a&&e.push(a)};for(let e=b._start;null!==e;e=e.right)e.deleted?this.deletes(e)&&!this.adds(e)&&((null===a||void 0===a.delete)&&(f(),a={delete:0}),a.delete+=e.length,d.add(e)):this.adds(e)?((null===a||void 0===a.insert)&&(f(),a={insert:[]}),a.insert=a.insert.concat(e.content.getContent()),c.add(e)):((null===a||void 0===a.retain)&&(f(),a={retain:0}),a.retain+=e.length);null!==a&&void 0===a.retain&&f()}this._changes=a}return a}}let Up=(a,b)=>{let c=[];for(;null!==b._item&&b!==a;){if(null!==b._item.parentSub)c.unshift(b._item.parentSub);else{let a=0,d=b._item.parent._start;for(;d!==b._item&&null!==d;)!d.deleted&&d.countable&&(a+=d.length),d=d.right;c.unshift(a)}b=b._item.parent}return c},Uq=()=>{((...a)=>{console.warn(...Tx(a))})("Invalid access: Add Yjs type to a document before reading data.")},Ur=0;class Us{constructor(a,b){a.marker=!0,this.p=a,this.index=b,this.timestamp=Ur++}}let Ut=(a,b,c)=>{a.p.marker=!1,a.p=b,b.marker=!0,a.index=c,a.timestamp=Ur++},Uu=(a,b)=>{if(null===a._start||0===b||null===a._searchMarker)return null;let c=0===a._searchMarker.length?null:a._searchMarker.reduce((a,c)=>Sg(b-a.index)<Sg(b-c.index)?a:c),d=a._start,e=0;for(null!==c&&(d=c.p,e=c.index,c.timestamp=Ur++);null!==d.right&&e<b;){if(!d.deleted&&d.countable){if(b<e+d.length)break;e+=d.length}d=d.right}for(;null!==d.left&&e>b;)!(d=d.left).deleted&&d.countable&&(e-=d.length);for(;null!==d.left&&d.left.id.client===d.id.client&&d.left.id.clock+d.left.length===d.id.clock;)!(d=d.left).deleted&&d.countable&&(e-=d.length);if(null!==c&&Sg(c.index-e)<d.parent.length/80)return Ut(c,d,e),c;var f=a._searchMarker,g=d,h=e;if(f.length>=80){let a=f.reduce((a,b)=>a.timestamp<b.timestamp?a:b);return Ut(a,g,h),a}{let a=new Us(g,h);return f.push(a),a}},Uv=(a,b,c)=>{for(let d=a.length-1;d>=0;d--){let e=a[d];if(c>0){let b=e.p;for(b.marker=!1;b&&(b.deleted||!b.countable);)(b=b.left)&&!b.deleted&&b.countable&&(e.index-=b.length);if(null===b||!0===b.marker){a.splice(d,1);continue}e.p=b,b.marker=!0}(b<e.index||c>0&&b===e.index)&&(e.index=Si(b,e.index+c))}},Uw=(a,b,c)=>{let d=a,e=b.changedParentTypes;for(;R8(e,a,()=>[]).push(c),null!==a._item;)a=a._item.parent;TW(d._eH,c,b)};class Ux{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=TU(),this._dEH=TU(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(a,b){this.doc=a,this._item=b}_copy(){throw SM()}clone(){throw SM()}_write(a){}get _first(){let a=this._start;for(;null!==a&&a.deleted;)a=a.right;return a}_callObserver(a,b){!a.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(a){let b;b=this._eH,b.l.push(a)}observeDeep(a){let b;b=this._dEH,b.l.push(a)}unobserve(a){TV(this._eH,a)}unobserveDeep(a){TV(this._dEH,a)}toJSON(){}}let Uy=(a,b,c)=>{a.doc??Uq(),b<0&&(b=a._length+b),c<0&&(c=a._length+c);let d=c-b,e=[],f=a._start;for(;null!==f&&d>0;){if(f.countable&&!f.deleted){let a=f.content.getContent();if(a.length<=b)b-=a.length;else{for(let c=b;c<a.length&&d>0;c++)e.push(a[c]),d--;b=0}}f=f.right}return e},Uz=a=>{a.doc??Uq();let b=[],c=a._start;for(;null!==c;){if(c.countable&&!c.deleted){let a=c.content.getContent();for(let c=0;c<a.length;c++)b.push(a[c])}c=c.right}return b},UA=(a,b)=>{let c=0,d=a._start;for(a.doc??Uq();null!==d;){if(d.countable&&!d.deleted){let e=d.content.getContent();for(let d=0;d<e.length;d++)b(e[d],c++,a)}d=d.right}},UB=(a,b)=>{let c=[];return UA(a,(d,e)=>{c.push(b(d,e,a))}),c},UC=(a,b)=>{a.doc??Uq();let c=Uu(a,b),d=a._start;for(null!==c&&(d=c.p,b-=c.index);null!==d;d=d.right)if(!d.deleted&&d.countable){if(b<d.length)return d.content.getContent()[b];b-=d.length}},UD=(a,b,c,d)=>{let e=c,f=a.doc,g=f.clientID,h=f.store,i=null===c?b._start:c.right,j=[],k=()=>{j.length>0&&((e=new Vw(TZ(g,T2(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new Vk(j))).integrate(a,0),j=[])};d.forEach(c=>{if(null===c)j.push(c);else switch(c.constructor){case Number:case Object:case Boolean:case Array:case String:j.push(c);break;default:switch(k(),c.constructor){case Uint8Array:case ArrayBuffer:(e=new Vw(TZ(g,T2(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new Vc(new Uint8Array(c)))).integrate(a,0);break;case TI:(e=new Vw(TZ(g,T2(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new Vf(c))).integrate(a,0);break;default:if(c instanceof Ux)(e=new Vw(TZ(g,T2(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new Vu(c))).integrate(a,0);else throw Error("Unexpected content type in insert operation")}}}),k()},UE=(a,b,c,d)=>{if(c>b._length)throw Error("Length exceeded!");if(0===c)return b._searchMarker&&Uv(b._searchMarker,c,d.length),UD(a,b,null,d);let e=c,f=Uu(b,c),g=b._start;for(null!==f&&(g=f.p,0==(c-=f.index)&&(c+=(g=g.prev)&&g.countable&&!g.deleted?g.length:0));null!==g;g=g.right)if(!g.deleted&&g.countable){if(c<=g.length){c<g.length&&T7(a,TZ(g.id.client,g.id.clock+c));break}c-=g.length}return b._searchMarker&&Uv(b._searchMarker,e,d.length),UD(a,b,g,d)},UF=(a,b,c,d)=>{if(0===d)return;let e=c,f=d,g=Uu(b,c),h=b._start;for(null!==g&&(h=g.p,c-=g.index);null!==h&&c>0;h=h.right)!h.deleted&&h.countable&&(c<h.length&&T7(a,TZ(h.id.client,h.id.clock+c)),c-=h.length);for(;d>0&&null!==h;)h.deleted||(d<h.length&&T7(a,TZ(h.id.client,h.id.clock+d)),h.delete(a),d-=h.length),h=h.right;if(d>0)throw Error("Length exceeded!");b._searchMarker&&Uv(b._searchMarker,e,-f+d)},UG=(a,b,c)=>{let d=b._map.get(c);void 0!==d&&d.delete(a)},UH=(a,b,c,d)=>{let e,f=b._map.get(c)||null,g=a.doc,h=g.clientID;if(null==d)e=new Vk([d]);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:e=new Vk([d]);break;case Uint8Array:e=new Vc(d);break;case TI:e=new Vf(d);break;default:if(d instanceof Ux)e=new Vu(d);else throw Error("Unexpected content type")}new Vw(TZ(h,T2(g.store,h)),f,f&&f.lastId,null,null,b,c,e).integrate(a,0)},UI=(a,b)=>{a.doc??Uq();let c=a._map.get(b);return void 0===c||c.deleted?void 0:c.content.getContent()[c.length-1]},UJ=a=>{let b={};return a.doc??Uq(),a._map.forEach((a,c)=>{a.deleted||(b[c]=a.content.getContent()[a.length-1])}),b},UK=(a,b)=>{a.doc??Uq();let c=a._map.get(b);return void 0!==c&&!c.deleted},UL=a=>{let b,c;return a.doc??Uq(),b=a._map.entries(),c=a=>!a[1].deleted,Ty(()=>{let a;do a=b.next();while(!a.done&&!c(a.value))return a})};class UM extends Uo{}class UN extends Ux{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(a){let b=new UN;return b.push(a),b}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new UN}clone(){let a=new UN;return a.insert(0,this.toArray().map(a=>a instanceof Ux?a.clone():a)),a}get length(){return this.doc??Uq(),this._length}_callObserver(a,b){super._callObserver(a,b),Uw(this,a,new UM(this,a))}insert(a,b){null!==this.doc?Uf(this.doc,c=>{UE(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}push(a){null!==this.doc?Uf(this.doc,b=>{((a,b,c)=>{let d=(b._searchMarker||[]).reduce((a,b)=>b.index>a.index?b:a,{index:0,p:b._start}).p;if(d)for(;d.right;)d=d.right;return UD(a,b,d,c)})(b,this,a)}):this._prelimContent.push(...a)}unshift(a){this.insert(0,a)}delete(a,b=1){null!==this.doc?Uf(this.doc,c=>{UF(c,this,a,b)}):this._prelimContent.splice(a,b)}get(a){return UC(this,a)}toArray(){return Uz(this)}slice(a=0,b=this.length){return Uy(this,a,b)}toJSON(){return this.map(a=>a instanceof Ux?a.toJSON():a)}map(a){return UB(this,a)}forEach(a){UA(this,a)}[Symbol.iterator](){let a,b,c;return a=this._start,b=null,c=0,{[Symbol.iterator](){return this},next:()=>{if(null===b){for(;null!==a&&a.deleted;)a=a.right;if(null===a)return{done:!0,value:void 0};b=a.content.getContent(),c=0,a=a.right}let d=b[c++];return b.length<=c&&(b=null),{done:!1,value:d}}}}_write(a){a.writeTypeRef(Vn)}}class UO extends Uo{constructor(a,b,c){super(a,b),this.keysChanged=c}}class UP extends Ux{constructor(a){super(),this._prelimContent=null,void 0===a?this._prelimContent=new Map:this._prelimContent=new Map(a)}_integrate(a,b){super._integrate(a,b),this._prelimContent.forEach((a,b)=>{this.set(b,a)}),this._prelimContent=null}_copy(){return new UP}clone(){let a=new UP;return this.forEach((b,c)=>{a.set(c,b instanceof Ux?b.clone():b)}),a}_callObserver(a,b){Uw(this,a,new UO(this,a,b))}toJSON(){this.doc??Uq();let a={};return this._map.forEach((b,c)=>{if(!b.deleted){let d=b.content.getContent()[b.length-1];a[c]=d instanceof Ux?d.toJSON():d}}),a}get size(){return[...UL(this)].length}keys(){return Tz(UL(this),a=>a[0])}values(){return Tz(UL(this),a=>a[1].content.getContent()[a[1].length-1])}entries(){return Tz(UL(this),a=>[a[0],a[1].content.getContent()[a[1].length-1]])}forEach(a){this.doc??Uq(),this._map.forEach((b,c)=>{b.deleted||a(b.content.getContent()[b.length-1],c,this)})}[Symbol.iterator](){return this.entries()}delete(a){null!==this.doc?Uf(this.doc,b=>{UG(b,this,a)}):this._prelimContent.delete(a)}set(a,b){return null!==this.doc?Uf(this.doc,c=>{UH(c,this,a,b)}):this._prelimContent.set(a,b),b}get(a){return UI(this,a)}has(a){return UK(this,a)}clear(){null!==this.doc?Uf(this.doc,a=>{this.forEach(function(b,c,d){UG(a,d,c)})}):this._prelimContent.clear()}_write(a){a.writeTypeRef(Vo)}}let UQ=(a,b)=>{let c,d;return a===b||"object"==typeof a&&"object"==typeof b&&a&&b&&((c=a)===(d=b)||Tc(c).length===Tc(d).length&&((a,b)=>{for(let c in a)if(!b(a[c],c))return!1;return!0})(c,(a,b)=>{let c,e,f;return(void 0!==a||(e=d,f=b,Object.prototype.hasOwnProperty.call(e,f)))&&((c=d[b])===a||!!c?.[Ta]?.(a))}))};class UR{constructor(a,b,c,d){this.left=a,this.right=b,this.index=c,this.currentAttributes=d}forward(){null===this.right&&SN(),this.right.content.constructor===Vh?this.right.deleted||UV(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}let US=(a,b,c)=>{for(;null!==b.right&&c>0;)b.right.content.constructor===Vh?b.right.deleted||UV(b.currentAttributes,b.right.content):b.right.deleted||(c<b.right.length&&T7(a,TZ(b.right.id.client,b.right.id.clock+c)),b.index+=b.right.length,c-=b.right.length),b.left=b.right,b.right=b.right.right;return b},UT=(a,b,c,d)=>{let e=new Map,f=d?Uu(b,c):null;return f?US(a,new UR(f.p.left,f.p,f.index,e),c-f.index):US(a,new UR(null,b._start,0,e),c)},UU=(a,b,c,d)=>{for(;null!==c.right&&(!0===c.right.deleted||c.right.content.constructor===Vh&&UQ(d.get(c.right.content.key),c.right.content.value));)c.right.deleted||d.delete(c.right.content.key),c.forward();let e=a.doc,f=e.clientID;d.forEach((d,g)=>{let h=c.left,i=c.right,j=new Vw(TZ(f,T2(e.store,f)),h,h&&h.lastId,i,i&&i.id,b,null,new Vh(g,d));j.integrate(a,0),c.right=j,c.forward()})},UV=(a,b)=>{let{key:c,value:d}=b;null===d?a.delete(c):a.set(c,d)},UW=(a,b)=>{for(;null!==a.right&&(a.right.deleted||a.right.content.constructor===Vh&&UQ(b[a.right.content.key]??null,a.right.content.value));){;a.forward()}},UX=(a,b,c,d)=>{let e=a.doc,f=e.clientID,g=new Map;for(let h in d){let i=d[h],j=c.currentAttributes.get(h)??null;if(!UQ(j,i)){g.set(h,j);let{left:d,right:k}=c;c.right=new Vw(TZ(f,T2(e.store,f)),d,d&&d.lastId,k,k&&k.id,b,null,new Vh(h,i)),c.right.integrate(a,0),c.forward()}}return g},UY=(a,b,c,d,e)=>{c.currentAttributes.forEach((a,b)=>{void 0===e[b]&&(e[b]=null)});let f=a.doc,g=f.clientID;UW(c,e);let h=UX(a,b,c,e),i=d.constructor===String?new Vl(d):d instanceof Ux?new Vu(d):new Vg(d),{left:j,right:k,index:l}=c;b._searchMarker&&Uv(b._searchMarker,c.index,i.getLength()),(k=new Vw(TZ(g,T2(f.store,g)),j,j&&j.lastId,k,k&&k.id,b,null,i)).integrate(a,0),c.right=k,c.index=l,c.forward(),UU(a,b,c,h)},UZ=(a,b,c,d,e)=>{let f=a.doc,g=f.clientID;UW(c,e);let h=UX(a,b,c,e);for(;null!==c.right&&(d>0||h.size>0&&(c.right.deleted||c.right.content.constructor===Vh));){if(!c.right.deleted)if(c.right.content.constructor===Vh){let{key:b,value:f}=c.right.content,g=e[b];if(void 0!==g){if(UQ(g,f))h.delete(b);else{if(0===d)break;h.set(b,f)}c.right.delete(a)}else c.currentAttributes.set(b,f)}else d<c.right.length&&T7(a,TZ(c.right.id.client,c.right.id.clock+d)),d-=c.right.length;c.forward()}if(d>0){let e="";for(;d>0;d--)e+="\n";c.right=new Vw(TZ(g,T2(f.store,g)),c.left,c.left&&c.left.lastId,c.right,c.right&&c.right.id,b,null,new Vl(e)),c.right.integrate(a,0),c.forward()}UU(a,b,c,h)},U$=(a,b,c,d,e)=>{let f=b,g=R6();for(;f&&(!f.countable||f.deleted);){if(!f.deleted&&f.content.constructor===Vh){let a=f.content;g.set(a.key,a)}f=f.right}let h=0,i=!1;for(;b!==f;){if(c===b&&(i=!0),!b.deleted){let c=b.content;if(c.constructor===Vh){let{key:f,value:j}=c,k=d.get(f)??null;(g.get(f)!==c||k===j)&&(b.delete(a),h++,i||(e.get(f)??null)!==j||k===j||(null===k?e.delete(f):e.set(f,k))),i||b.deleted||UV(e,c)}}b=b.right}return h},U_=a=>{let b=0;return Uf(a.doc,c=>{let d=a._start,e=a._start,f=R6(),g=R7(f);for(;e;)!1===e.deleted&&(e.content.constructor===Vh?UV(g,e.content):(b+=U$(c,d,e,f,g),f=R7(g),d=e)),e=e.right}),b},U0=a=>{let b=new Set,c=a.doc;for(let[d,e]of a.afterState.entries()){let f=a.beforeState.get(d)||0;e!==f&&T9(a,c.store.clients.get(d),f,e,a=>{a.deleted||a.content.constructor!==Vh||a.constructor===Vb||b.add(a.parent)})}Uf(c,c=>{for(let d of(TC(a,a.deleteSet,a=>{if(a instanceof Vb||!a.parent._hasFormatting||b.has(a.parent))return;let d=a.parent;if(a.content.constructor===Vh)b.add(d);else{for(var e=a;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let b=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Vh){let a=e.content.key;b.has(a)?e.delete(c):b.add(a)}e=e.left}}}),b))U_(d)})},U1=(a,b,c)=>{let d=c,e=R7(b.currentAttributes),f=b.right;for(;c>0&&null!==b.right;){if(!1===b.right.deleted)switch(b.right.content.constructor){case Vu:case Vg:case Vl:c<b.right.length&&T7(a,TZ(b.right.id.client,b.right.id.clock+c)),c-=b.right.length,b.right.delete(a)}b.forward()}f&&U$(a,f,b.right,e,b.currentAttributes);let g=(b.left||b.right).parent;return g._searchMarker&&Uv(g._searchMarker,b.index,-d+c),b};class U2 extends Uo{constructor(a,b,c){super(a,b),this.childListChanged=!1,this.keysChanged=new Set,c.forEach(a=>{null===a?this.childListChanged=!0:this.keysChanged.add(a)})}get changes(){if(null===this._changes){let a={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=a}return this._changes}get delta(){if(null===this._delta){let a=this.target.doc,b=[];Uf(a,a=>{let c=new Map,d=new Map,e=this.target._start,f=null,g={},h="",i=0,j=0,k=()=>{if(null!==f){let a=null;switch(f){case"delete":j>0&&(a={delete:j}),j=0;break;case"insert":("object"==typeof h||h.length>0)&&(a={insert:h},c.size>0&&(a.attributes={},c.forEach((b,c)=>{null!==b&&(a.attributes[c]=b)}))),h="";break;case"retain":i>0&&(a={retain:i},(a=>{for(let b in a)return!1;return!0})(g)||(a.attributes=Tb({},g))),i=0}a&&b.push(a),f=null}};for(;null!==e;){switch(e.content.constructor){case Vu:case Vg:this.adds(e)?this.deletes(e)||(k(),f="insert",h=e.content.getContent()[0],k()):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=1):e.deleted||("retain"!==f&&(k(),f="retain"),i+=1);break;case Vl:this.adds(e)?this.deletes(e)||("insert"!==f&&(k(),f="insert"),h+=e.content.str):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=e.length):e.deleted||("retain"!==f&&(k(),f="retain"),i+=e.length);break;case Vh:{let{key:b,value:h}=e.content;if(this.adds(e))this.deletes(e)||(UQ(c.get(b)??null,h)?null!==h&&e.delete(a):("retain"===f&&k(),UQ(h,d.get(b)??null)?delete g[b]:g[b]=h));else if(this.deletes(e)){d.set(b,h);let a=c.get(b)??null;UQ(a,h)||("retain"===f&&k(),g[b]=a)}else if(!e.deleted){d.set(b,h);let c=g[b];void 0!==c&&(UQ(c,h)?null!==c&&e.delete(a):("retain"===f&&k(),null===h?delete g[b]:g[b]=h))}e.deleted||("insert"===f&&k(),UV(c,e.content))}}e=e.right}for(k();b.length>0;){let a=b[b.length-1];if(void 0!==a.retain&&void 0===a.attributes)b.pop();else break}}),this._delta=b}return this._delta}}class U3 extends Ux{constructor(a){super(),this._pending=void 0!==a?[()=>this.insert(0,a)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Uq(),this._length}_integrate(a,b){super._integrate(a,b);try{this._pending.forEach(a=>a())}catch(a){console.error(a)}this._pending=null}_copy(){return new U3}clone(){let a=new U3;return a.applyDelta(this.toDelta()),a}_callObserver(a,b){super._callObserver(a,b);let c=new U2(this,a,b);Uw(this,a,c),!a.local&&this._hasFormatting&&(a._needFormattingCleanup=!0)}toString(){this.doc??Uq();let a="",b=this._start;for(;null!==b;)!b.deleted&&b.countable&&b.content.constructor===Vl&&(a+=b.content.str),b=b.right;return a}toJSON(){return this.toString()}applyDelta(a,{sanitize:b=!0}={}){null!==this.doc?Uf(this.doc,c=>{let d=new UR(null,this._start,0,new Map);for(let e=0;e<a.length;e++){let f=a[e];if(void 0!==f.insert){let g=b||"string"!=typeof f.insert||e!==a.length-1||null!==d.right||"\n"!==f.insert.slice(-1)?f.insert:f.insert.slice(0,-1);("string"!=typeof g||g.length>0)&&UY(c,this,d,g,f.attributes||{})}else void 0!==f.retain?UZ(c,this,d,f.retain,f.attributes||{}):void 0!==f.delete&&U1(c,d,f.delete)}}):this._pending.push(()=>this.applyDelta(a))}toDelta(a,b,c){this.doc??Uq();let d=[],e=new Map,f=this.doc,g="",h=this._start;function i(){if(g.length>0){let a={},b=!1;e.forEach((c,d)=>{b=!0,a[d]=c});let c={insert:g};b&&(c.attributes=a),d.push(c),g=""}}let j=()=>{for(;null!==h;){if(T$(h,a)||void 0!==b&&T$(h,b))switch(h.content.constructor){case Vl:{let d=e.get("ychange");void 0===a||T$(h,a)?void 0===b||T$(h,b)?void 0!==d&&(i(),e.delete("ychange")):(void 0===d||d.user!==h.id.client||"added"!==d.type)&&(i(),e.set("ychange",c?c("added",h.id):{type:"added"})):(void 0===d||d.user!==h.id.client||"removed"!==d.type)&&(i(),e.set("ychange",c?c("removed",h.id):{type:"removed"})),g+=h.content.str;break}case Vu:case Vg:{i();let a={insert:h.content.getContent()[0]};if(e.size>0){let b={};a.attributes=b,e.forEach((a,c)=>{b[c]=a})}d.push(a);break}case Vh:T$(h,a)&&(i(),UV(e,h.content))}h=h.right}i()};return a||b?Uf(f,c=>{a&&T_(c,a),b&&T_(c,b),j()},"cleanup"):j(),d}insert(a,b,c){if(b.length<=0)return;let d=this.doc;null!==d?Uf(d,d=>{let e=UT(d,this,a,!c);c||(c={},e.currentAttributes.forEach((a,b)=>{c[b]=a})),UY(d,this,e,b,c)}):this._pending.push(()=>this.insert(a,b,c))}insertEmbed(a,b,c){let d=this.doc;null!==d?Uf(d,d=>{let e=UT(d,this,a,!c);UY(d,this,e,b,c||{})}):this._pending.push(()=>this.insertEmbed(a,b,c||{}))}delete(a,b){if(0===b)return;let c=this.doc;null!==c?Uf(c,c=>{U1(c,UT(c,this,a,!0),b)}):this._pending.push(()=>this.delete(a,b))}format(a,b,c){if(0===b)return;let d=this.doc;null!==d?Uf(d,d=>{let e=UT(d,this,a,!1);null!==e.right&&UZ(d,this,e,b,c)}):this._pending.push(()=>this.format(a,b,c))}removeAttribute(a){null!==this.doc?Uf(this.doc,b=>{UG(b,this,a)}):this._pending.push(()=>this.removeAttribute(a))}setAttribute(a,b){null!==this.doc?Uf(this.doc,c=>{UH(c,this,a,b)}):this._pending.push(()=>this.setAttribute(a,b))}getAttribute(a){return UI(this,a)}getAttributes(){return UJ(this)}_write(a){a.writeTypeRef(Vp)}}class U4{constructor(a,b=()=>!0){this._filter=b,this._root=a,this._currentNode=a._start,this._firstCall=!0,a.doc??Uq()}[Symbol.iterator](){return this}next(){let a=this._currentNode,b=a&&a.content&&a.content.type;if(null!==a&&(!this._firstCall||a.deleted||!this._filter(b)))do if(b=a.content.type,a.deleted||b.constructor!==U6&&b.constructor!==U5||null===b._start)for(;null!==a;){let b=a.next;if(null!==b){a=b;break}a=a.parent===this._root?null:a.parent._item}else a=b._start;while(null!==a&&(a.deleted||!this._filter(a.content.type)))return(this._firstCall=!1,null===a)?{value:void 0,done:!0}:(this._currentNode=a,{value:a.content.type,done:!1})}}class U5 extends Ux{constructor(){super(),this._prelimContent=[]}get firstChild(){let a=this._first;return a?a.content.getContent()[0]:null}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new U5}clone(){let a=new U5;return a.insert(0,this.toArray().map(a=>a instanceof Ux?a.clone():a)),a}get length(){return this.doc??Uq(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(a){return new U4(this,a)}querySelector(a){a=a.toUpperCase();let b=new U4(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a).next();return b.done?null:b.value}querySelectorAll(a){return a=a.toUpperCase(),Sc(new U4(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a))}_callObserver(a,b){Uw(this,a,new U7(this,b,a))}toString(){return UB(this,a=>a.toString()).join("")}toJSON(){return this.toString()}toDOM(a=document,b={},c){let d=a.createDocumentFragment();return void 0!==c&&c._createAssociation(d,this),UA(this,e=>{d.insertBefore(e.toDOM(a,b,c),null)}),d}insert(a,b){null!==this.doc?Uf(this.doc,c=>{UE(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}insertAfter(a,b){if(null!==this.doc)Uf(this.doc,c=>{UD(c,this,a&&a instanceof Ux?a._item:a,b)});else{let c=this._prelimContent,d=null===a?0:c.findIndex(b=>b===a)+1;if(0===d&&null!==a)throw Error("Reference item not found");c.splice(d,0,...b)}}delete(a,b=1){null!==this.doc?Uf(this.doc,c=>{UF(c,this,a,b)}):this._prelimContent.splice(a,b)}toArray(){return Uz(this)}push(a){this.insert(this.length,a)}unshift(a){this.insert(0,a)}get(a){return UC(this,a)}slice(a=0,b=this.length){return Uy(this,a,b)}forEach(a){UA(this,a)}_write(a){a.writeTypeRef(Vr)}}class U6 extends U5{constructor(a="UNDEFINED"){super(),this.nodeName=a,this._prelimAttrs=new Map}get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_integrate(a,b){super._integrate(a,b),this._prelimAttrs.forEach((a,b)=>{this.setAttribute(b,a)}),this._prelimAttrs=null}_copy(){return new U6(this.nodeName)}clone(){let a=new U6(this.nodeName);var b,c,d=this.getAttributes();for(let e in d){b=d[e],c=e,a.setAttribute(c,b)}return a.insert(0,this.toArray().map(a=>a instanceof Ux?a.clone():a)),a}toString(){let a=this.getAttributes(),b=[],c=[];for(let b in a)c.push(b);c.sort();let d=c.length;for(let e=0;e<d;e++){let d=c[e];b.push(d+'="'+a[d]+'"')}let e=this.nodeName.toLocaleLowerCase(),f=b.length>0?" "+b.join(" "):"";return`<${e}${f}>${super.toString()}</${e}>`}removeAttribute(a){null!==this.doc?Uf(this.doc,b=>{UG(b,this,a)}):this._prelimAttrs.delete(a)}setAttribute(a,b){null!==this.doc?Uf(this.doc,c=>{UH(c,this,a,b)}):this._prelimAttrs.set(a,b)}getAttribute(a){return UI(this,a)}hasAttribute(a){return UK(this,a)}getAttributes(a){let b;return a?(b={},this._map.forEach((c,d)=>{let e=c;for(;null!==e&&(!a.sv.has(e.id.client)||e.id.clock>=(a.sv.get(e.id.client)||0));)e=e.left;null!==e&&T$(e,a)&&(b[d]=e.content.getContent()[e.length-1])}),b):UJ(this)}toDOM(a=document,b={},c){let d=a.createElement(this.nodeName),e=this.getAttributes();for(let a in e){let b=e[a];"string"==typeof b&&d.setAttribute(a,b)}return UA(this,e=>{d.appendChild(e.toDOM(a,b,c))}),void 0!==c&&c._createAssociation(d,this),d}_write(a){a.writeTypeRef(Vq),a.writeKey(this.nodeName)}}class U7 extends Uo{constructor(a,b,c){super(a,c),this.childListChanged=!1,this.attributesChanged=new Set,b.forEach(a=>{null===a?this.childListChanged=!0:this.attributesChanged.add(a)})}}class U8 extends UP{constructor(a){super(),this.hookName=a}_copy(){return new U8(this.hookName)}clone(){let a=new U8(this.hookName);return this.forEach((b,c)=>{a.set(c,b)}),a}toDOM(a=document,b={},c){let d,e=b[this.hookName];return(d=void 0!==e?e.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==c&&c._createAssociation(d,this),d}_write(a){a.writeTypeRef(Vs),a.writeKey(this.hookName)}}class U9 extends U3{get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_copy(){return new U9}clone(){let a=new U9;return a.applyDelta(this.toDelta()),a}toDOM(a=document,b,c){let d=a.createTextNode(this.toString());return void 0!==c&&c._createAssociation(d,this),d}toString(){return this.toDelta().map(a=>{let b=[];for(let c in a.attributes){let d=[];for(let b in a.attributes[c])d.push({key:b,value:a.attributes[c][b]});d.sort((a,b)=>a.key<b.key?-1:1),b.push({nodeName:c,attrs:d})}b.sort((a,b)=>a.nodeName<b.nodeName?-1:1);let c="";for(let a=0;a<b.length;a++){let d=b[a];c+=`<${d.nodeName}`;for(let a=0;a<d.attrs.length;a++){let b=d.attrs[a];c+=` ${b.key}="${b.value}"`}c+=">"}c+=a.insert;for(let a=b.length-1;a>=0;a--)c+=`</${b[a].nodeName}>`;return c}).join("")}toJSON(){return this.toString()}_write(a){a.writeTypeRef(Vt)}}class Va{constructor(a,b){this.id=a,this.length=b}get deleted(){throw SM()}mergeWith(a){return!1}write(a,b,c){throw SM()}integrate(a,b){throw SM()}}class Vb extends Va{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){b>0&&(this.id.clock+=b,this.length-=b),T3(a.doc.store,this)}write(a,b){a.writeInfo(0),a.writeLen(this.length-b)}getMissing(a,b){return null}}class Vc{constructor(a){this.content=a}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Vc(this.content)}splice(a){throw SM()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeBuf(this.content)}getRef(){return 3}}class Vd{constructor(a){this.len=a}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Vd(this.len)}splice(a){let b=new Vd(this.len-a);return this.len=a,b}mergeWith(a){return this.len+=a.len,!0}integrate(a,b){TF(a.deleteSet,b.id.client,b.id.clock,this.len),b.markDeleted()}delete(a){}gc(a){}write(a,b){a.writeLen(this.len-b)}getRef(){return 1}}let Ve=(a,b)=>new TI({guid:a,...b,shouldLoad:b.shouldLoad||b.autoLoad||!1});class Vf{constructor(a){a._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=a;const b={};this.opts=b,a.gc||(b.gc=!1),a.autoLoad&&(b.autoLoad=!0),null!==a.meta&&(b.meta=a.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Vf(Ve(this.doc.guid,this.opts))}splice(a){throw SM()}mergeWith(a){return!1}integrate(a,b){this.doc._item=b,a.subdocsAdded.add(this.doc),this.doc.shouldLoad&&a.subdocsLoaded.add(this.doc)}delete(a){a.subdocsAdded.has(this.doc)?a.subdocsAdded.delete(this.doc):a.subdocsRemoved.add(this.doc)}gc(a){}write(a,b){a.writeString(this.doc.guid),a.writeAny(this.opts)}getRef(){return 9}}class Vg{constructor(a){this.embed=a}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Vg(this.embed)}splice(a){throw SM()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeJSON(this.embed)}getRef(){return 5}}class Vh{constructor(a,b){this.key=a,this.value=b}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Vh(this.key,this.value)}splice(a){throw SM()}mergeWith(a){return!1}integrate(a,b){let c=b.parent;c._searchMarker=null,c._hasFormatting=!0}delete(a){}gc(a){}write(a,b){a.writeKey(this.key),a.writeJSON(this.value)}getRef(){return 6}}class Vi{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vi(this.arr)}splice(a){let b=new Vi(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let b=this.arr[d];a.writeString(void 0===b?"undefined":JSON.stringify(b))}}getRef(){return 2}}let Vj="development"===Tj("node_env");class Vk{constructor(a){this.arr=a,Vj&&Te(a)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vk(this.arr)}splice(a){let b=new Vk(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let b=this.arr[d];a.writeAny(b)}}getRef(){return 8}}class Vl{constructor(a){this.str=a}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vl(this.str)}splice(a){let b=new Vl(this.str.slice(a));this.str=this.str.slice(0,a);let c=this.str.charCodeAt(a-1);return c>=55296&&c<=56319&&(this.str=this.str.slice(0,a-1)+"�",b.str="�"+b.str.slice(1)),b}mergeWith(a){return this.str+=a.str,!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeString(0===b?this.str:this.str.slice(b))}getRef(){return 4}}let Vm=[a=>new UN,a=>new UP,a=>new U3,a=>new U6(a.readKey()),a=>new U5,a=>new U8(a.readKey()),a=>new U9],Vn=0,Vo=1,Vp=2,Vq=3,Vr=4,Vs=5,Vt=6;class Vu{constructor(a){this.type=a}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Vu(this.type._copy())}splice(a){throw SM()}mergeWith(a){return!1}integrate(a,b){this.type._integrate(a.doc,b)}delete(a){let b=this.type._start;for(;null!==b;)b.deleted?b.id.clock<(a.beforeState.get(b.id.client)||0)&&a._mergeStructs.push(b):b.delete(a),b=b.right;this.type._map.forEach(b=>{b.deleted?b.id.clock<(a.beforeState.get(b.id.client)||0)&&a._mergeStructs.push(b):b.delete(a)}),a.changed.delete(this.type)}gc(a){let b=this.type._start;for(;null!==b;)b.gc(a,!0),b=b.right;this.type._start=null,this.type._map.forEach(b=>{for(;null!==b;)b.gc(a,!0),b=b.left}),this.type._map=new Map}write(a,b){this.type._write(a)}getRef(){return 7}}let Vv=(a,b,c)=>{let{client:d,clock:e}=b.id,f=new Vw(TZ(d,e+c),b,TZ(d,e+c-1),b.right,b.rightOrigin,b.parent,b.parentSub,b.content.splice(c));return b.deleted&&f.markDeleted(),b.keep&&(f.keep=!0),null!==b.redone&&(f.redone=TZ(b.redone.client,b.redone.clock+c)),b.right=f,null!==f.right&&(f.right.left=f),a._mergeStructs.push(f),null!==f.parentSub&&null===f.right&&f.parent._map.set(f.parentSub,f),b.length=c,f};class Vw extends Va{constructor(a,b,c,d,e,f,g,h){super(a,h.getLength()),this.origin=c,this.left=b,this.right=d,this.rightOrigin=e,this.parent=f,this.parentSub=g,this.redone=null,this.content=h,this.info=2*!!this.content.isCountable()}set marker(a){(8&this.info)>0!==a&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(a){this.keep!==a&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(a){this.deleted!==a&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(a,b){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=T2(b,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=T2(b,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===TX&&this.id.client!==this.parent.client&&this.parent.clock>=T2(b,this.parent.client))return this.parent.client;if(this.origin&&(this.left=T8(a,b,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=T7(a,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vb||this.right&&this.right.constructor===Vb)this.parent=null;else if(this.parent){if(this.parent.constructor===TX){let a=T5(b,this.parent);a.constructor===Vb?this.parent=null:this.parent=a.content.type}}else this.left&&this.left.constructor===Vw?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Vw&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(a,b){if(b>0&&(this.id.clock+=b,this.left=T8(a,a.doc.store,TZ(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(b),this.length-=b),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let b,c=this.left;if(null!==c)b=c.right;else if(null!==this.parentSub)for(b=this.parent._map.get(this.parentSub)||null;null!==b&&null!==b.left;)b=b.left;else b=this.parent._start;let d=new Set,e=new Set;for(;null!==b&&b!==this.right;){if(e.add(b),d.add(b),TY(this.origin,b.origin)){if(b.id.client<this.id.client)c=b,d.clear();else if(TY(this.rightOrigin,b.rightOrigin))break}else if(null!==b.origin&&e.has(T5(a.doc.store,b.origin)))d.has(T5(a.doc.store,b.origin))||(c=b,d.clear());else break;b=b.right}this.left=c}if(null!==this.left){let a=this.left.right;this.right=a,this.left.right=this}else{let a;if(null!==this.parentSub)for(a=this.parent._map.get(this.parentSub)||null;null!==a&&null!==a.left;)a=a.left;else a=this.parent._start,this.parent._start=this;this.right=a}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(a)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),T3(a.doc.store,this),this.content.integrate(a,this),Uc(a,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(a)}else new Vb(this.id,this.length).integrate(a,0)}get next(){let a=this.right;for(;null!==a&&a.deleted;)a=a.right;return a}get prev(){let a=this.left;for(;null!==a&&a.deleted;)a=a.left;return a}get lastId(){return 1===this.length?this.id:TZ(this.id.client,this.id.clock+this.length-1)}mergeWith(a){if(this.constructor===a.constructor&&TY(a.origin,this.lastId)&&this.right===a&&TY(this.rightOrigin,a.rightOrigin)&&this.id.client===a.id.client&&this.id.clock+this.length===a.id.clock&&this.deleted===a.deleted&&null===this.redone&&null===a.redone&&this.content.constructor===a.content.constructor&&this.content.mergeWith(a.content)){let b=this.parent._searchMarker;return b&&b.forEach(b=>{b.p===a&&(b.p=this,!this.deleted&&this.countable&&(b.index-=this.length))}),a.keep&&(this.keep=!0),this.right=a.right,null!==this.right&&(this.right.left=this),this.length+=a.length,!0}return!1}delete(a){if(!this.deleted){let b=this.parent;this.countable&&null===this.parentSub&&(b._length-=this.length),this.markDeleted(),TF(a.deleteSet,this.id.client,this.id.clock,this.length),Uc(a,b,this.parentSub),this.content.delete(a)}}gc(a,b){if(!this.deleted)throw SN();if(this.content.gc(a),b){var c;let b;c=new Vb(this.id,this.length),(b=a.clients.get(this.id.client))[T4(b,this.id.clock)]=c}else this.content=new Vd(this.length)}write(a,b){let c=b>0?TZ(this.id.client,this.id.clock+b-1):this.origin,d=this.rightOrigin,e=this.parentSub,f=31&this.content.getRef()|128*(null!==c)|64*(null!==d)|32*(null!==e);if(a.writeInfo(f),null!==c&&a.writeLeftID(c),null!==d&&a.writeRightID(d),null===c&&null===d){let b=this.parent;if(void 0!==b._item){let c=b._item;if(null===c){let c=(a=>{for(let[b,c]of a.doc.share.entries())if(c===a)return b;throw SN()})(b);a.writeParentInfo(!0),a.writeString(c)}else a.writeParentInfo(!1),a.writeLeftID(c.id)}else b.constructor===String?(a.writeParentInfo(!0),a.writeString(b)):b.constructor===TX?(a.writeParentInfo(!1),a.writeLeftID(b)):SN();null!==e&&a.writeString(e)}this.content.write(a,b)}}let Vx=(a,b)=>Vy[31&b](a),Vy=[()=>{SN()},a=>new Vd(a.readLen()),a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++){let b=a.readString();"undefined"===b?c.push(void 0):c.push(JSON.parse(b))}return new Vi(c)},a=>new Vc(a.readBuf()),a=>new Vl(a.readString()),a=>new Vg(a.readJSON()),a=>new Vh(a.readKey(),a.readJSON()),a=>new Vu(Vm[a.readTypeRef()](a)),a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++)c.push(a.readAny());return new Vk(c)},a=>new Vf(Ve(a.readString(),a.readAny())),()=>{SN()}];class Vz extends Va{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){SN()}write(a,b){a.writeInfo(10),Sw(a.restEncoder,this.length-b)}getMissing(a,b){return null}}let VA="u">typeof globalThis?globalThis:a.g,VB="__ $YJS$ __";!0===VA[VB]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),VA[VB]=!0;var VC=a.i(88684),VD=a.i(333340),VE=a.i(19926),VF=a.i(178499),VG=a.i(293357);let VH=(0,VG.default)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),VI=(0,VG.default)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),VJ=function({sessionId:a,socket:b,userId:c,userName:d,role:e,className:f=""}){let g=(0,bT.useRef)(null),h=(0,bT.useRef)(!1),i=(0,bT.useRef)(null),j=(0,bT.useRef)(null),k=(0,bT.useRef)(null),l=(0,bT.useRef)(null),m=(0,bT.useRef)(!1),n=(0,bT.useRef)(null),[o,p]=(0,bT.useState)(!1),[q,r]=(0,bT.useState)(!1),s="tutor"===e||!q;(0,bT.useEffect)(()=>{l.current=b},[b]),(0,bT.useEffect)(()=>{m.current=s},[s]);let t=(0,bT.useCallback)((a,b)=>{a&&a.updateInstanceState({isReadonly:b})},[]),u=(0,bT.useCallback)(()=>{if(!g.current||!m.current)return;let b=k.current;b&&(i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{if(!g.current||h.current)return;let c=g.current.getSnapshot(),d="function"==typeof structuredClone?structuredClone(c):JSON.parse(JSON.stringify(c));b.set("snapshot",d),b.set("updatedAt",Date.now()),l.current?.emit("math_tl_snapshot",{sessionId:a,snapshot:d})},180))},[a]);(0,bT.useEffect)(()=>{n.current=u},[u]),(0,bT.useEffect)(()=>{if(!b)return;let f=new TI,l=f.getMap("meta");j.current=f,k.current=l;let m=(c,d)=>{b&&"remote"!==d&&b.emit("math_yjs_update",{sessionId:a,update:Array.from(c)})},n=()=>{let a=l.get("snapshot");if(a&&g.current&&!h.current){h.current=!0;try{g.current.loadSnapshot(a)}finally{window.setTimeout(()=>{h.current=!1},0)}}};f.on("update",m),l.observe(n);let o=()=>{b.emit("math_wb_join",{sessionId:a,userId:c,name:d||("tutor"===e?"Tutor":"Student"),role:e}),b.emit("math_wb_request_sync",a),p(!0)},q=()=>o(),s=()=>{p(!1)},t=a=>{r(!!a.locked),a.tldrawSnapshot&&l&&l.set("snapshot",a.tldrawSnapshot)},u=a=>{r(!!a.locked)},v=b=>{(!b.sessionId||b.sessionId===a)&&TS(f,Uint8Array.from(b.update||[]),"remote",TK)},w=b=>{(!b.sessionId||b.sessionId===a)&&(!b.actorId||b.actorId!==c)&&TS(f,Uint8Array.from(b.update||[]),"remote",TK)},y=b=>{if((!b.sessionId||b.sessionId===a)&&(!b.actorId||b.actorId!==c)&&b.snapshot&&g.current){h.current=!0;try{g.current.loadSnapshot(b.snapshot)}finally{window.setTimeout(()=>{h.current=!1},0)}}};return b.on("connect",q),b.on("disconnect",s),b.on("math_wb_state",t),b.on("math_wb_lock_changed",u),b.on("math_yjs_sync",v),b.on("math_yjs_update",w),b.on("math_tl_snapshot",y),b.connected&&o(),()=>{b.off("connect",q),b.off("disconnect",s),b.off("math_wb_state",t),b.off("math_wb_lock_changed",u),b.off("math_yjs_sync",v),b.off("math_yjs_update",w),b.off("math_tl_snapshot",y),b.emit("math_wb_leave",a),i.current&&clearTimeout(i.current),l.unobserve(n),f.off("update",m),j.current=null,k.current=null}},[e,a,b,c,d]);let v=(0,bT.useCallback)(a=>{g.current=a,t(a,!s);let b=a.fonts;b&&!b.__networkPatched&&(b.__networkPatched=!0,b.requestFonts=()=>{},b.ensureFontIsLoaded=async()=>void 0,b.loadRequiredFontsForCurrentPage=async()=>void 0);let c=k.current?.get("snapshot");c&&a.loadSnapshot(c);let d=a.store.listen(()=>{h.current||n.current?.()},{source:"user",scope:"document"});return()=>{d(),g.current=null}},[t,s]);(0,bT.useEffect)(()=>{t(g.current,!s)},[t,s]);let w=(0,bT.useMemo)(()=>o?(0,bS.jsxs)(VD.Badge,{variant:"outline",className:"gap-1",children:[(0,bS.jsx)(VH,{className:"h-3 w-3 text-green-600"}),"Synced"]}):(0,bS.jsxs)(VD.Badge,{variant:"outline",className:"gap-1",children:[(0,bS.jsx)(VI,{className:"h-3 w-3 text-amber-600"}),"Reconnecting"]}),[o]);return(0,bS.jsxs)("div",{className:`h-full min-h-0 flex flex-col rounded-lg border bg-white ${f}`,children:[(0,bS.jsxs)("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[(0,bS.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bS.jsx)("h3",{className:"text-sm font-semibold",children:"Math Whiteboard"}),w,(0,bS.jsx)(VD.Badge,{variant:s?"default":"secondary",children:s?"Editable":"Read only"})]}),"tutor"===e&&(0,bS.jsxs)(VC.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>b?.emit("math_wb_lock",{sessionId:a,locked:!q}),children:[q?(0,bS.jsx)(VF.Unlock,{className:"h-3 w-3"}):(0,bS.jsx)(VE.Lock,{className:"h-3 w-3"}),q?"Unlock Students":"Lock Students"]})]}),(0,bS.jsx)("div",{className:"relative flex-1 min-h-0",children:(0,bS.jsx)(RU,{onMount:v})})]})};function VK(a,b,c){var d;return(b="symbol"==typeof(d=function(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b);if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(b,"string"))?d:d+"")in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}class VL{constructor(){VK(this,"browserShadowBlurConstant",1),VK(this,"DPI",96),VK(this,"devicePixelRatio",1),VK(this,"perfLimitSizeTotal",2097152),VK(this,"maxCacheSideLimit",4096),VK(this,"minCacheSideLimit",256),VK(this,"disableStyleCopyPaste",!1),VK(this,"enableGLFiltering",!0),VK(this,"textureSize",4096),VK(this,"forceGLPutImageData",!1),VK(this,"cachesBoundsOfCurve",!1),VK(this,"fontPaths",{}),VK(this,"NUM_FRACTION_DIGITS",4)}}let VM=new class extends VL{constructor(a){super(),this.configure(a)}configure(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,a)}addFonts(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths={...this.fontPaths,...a}}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(a=>{delete this.fontPaths[a]})}clearFonts(){this.fontPaths={}}restoreDefaults(a){let b=new VL,c=(null==a?void 0:a.reduce((a,c)=>(a[c]=b[c],a),{}))||b;this.configure(c)}},VN=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return console[a]("fabric",...c)};class VO extends Error{constructor(a,b){super(`fabric: ${a}`,b)}}class VP extends VO{constructor(a){super(`${a} 'options.signal' is in 'aborted' state`)}}class VQ{}class VR extends VQ{testPrecision(a,b){let c=`precision ${b} float;
void main(){}`,d=a.createShader(a.FRAGMENT_SHADER);return!!d&&(a.shaderSource(d,c),a.compileShader(d),!!a.getShaderParameter(d,a.COMPILE_STATUS))}queryWebGL(a){let b=a.getContext("webgl");b&&(this.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(a=>this.testPrecision(b,a)),b.getExtension("WEBGL_lose_context").loseContext(),VN("log",`WebGL: max texture size ${this.maxTextureSize}`))}isSupported(a){return!!this.maxTextureSize&&this.maxTextureSize>=a}}let VS={},VT=()=>j||(j={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new VR,dispose(){},copyPasteData:VS}),VU=()=>{var a;return Math.max(null!=(a=VM.devicePixelRatio)?a:VT().window.devicePixelRatio,1)},VV=new class{constructor(){VK(this,"boundsOfCurveCache",{}),this.charWidthsCache=new Map}getFontCache(a){let{fontFamily:b,fontStyle:c,fontWeight:d}=a;b=b.toLowerCase();let e=this.charWidthsCache;e.has(b)||e.set(b,new Map);let f=e.get(b),g=`${c.toLowerCase()}_${(d+"").toLowerCase()}`;return f.has(g)||f.set(g,new Map),f.get(g)}clearFontCache(a){a?this.charWidthsCache.delete((a||"").toLowerCase()):this.charWidthsCache=new Map}limitDimsByArea(a){let{perfLimitSizeTotal:b}=VM,c=Math.sqrt(b*a);return[Math.floor(c),Math.floor(b/c)]}},VW="7.2.0";function VX(){}let VY=Math.PI/2,VZ=Math.PI/4,V$=2*Math.PI,V_=Math.PI/180,V0=Object.freeze([1,0,0,1,0,0]),V1="center",V2="left",V3="bottom",V4="right",V5="none",V6=/\r?\n/,V7="moving",V8="scaling",V9="rotating",Wa="rotate",Wb="skewing",Wc="resizing",Wd="modifyPoly",We="changed",Wf="scale",Wg="scaleX",Wh="scaleY",Wi="skewX",Wj="skewY",Wk="fill",Wl="stroke",Wm="modified",Wn="normal",Wo="json",Wp=new class{constructor(){this[Wo]=new Map,this.svg=new Map}has(a){return this[Wo].has(a)}getClass(a){let b=this[Wo].get(a);if(!b)throw new VO(`No class registered for ${a}`);return b}setClass(a,b){b?this[Wo].set(b,a):(this[Wo].set(a.type,a),this[Wo].set(a.type.toLowerCase(),a))}getSVGClass(a){return this.svg.get(a)}setSVGClass(a,b){this.svg.set(null!=b?b:a.type.toLowerCase(),a)}},Wq=new class extends Array{remove(a){let b=this.indexOf(a);b>-1&&this.splice(b,1)}cancelAll(){let a=this.splice(0);return a.forEach(a=>a.abort()),a}cancelByCanvas(a){if(!a)return[];let b=this.filter(b=>{var c;return b.target===a||"object"==typeof b.target&&(null==(c=b.target)?void 0:c.canvas)===a});return b.forEach(a=>a.abort()),b}cancelByTarget(a){if(!a)return[];let b=this.filter(b=>b.target===a);return b.forEach(a=>a.abort()),b}};class Wr{constructor(){VK(this,"__eventListeners",{})}on(a,b){return(this.__eventListeners||(this.__eventListeners={}),"object"==typeof a)?(Object.entries(a).forEach(a=>{let[b,c]=a;this.on(b,c)}),()=>this.off(a)):b?(this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b),()=>this.off(a,b)):()=>!1}once(a,b){if("object"==typeof a){let b=[];return Object.entries(a).forEach(a=>{let[c,d]=a;b.push(this.once(c,d))}),()=>b.forEach(a=>a())}if(b){let c=this.on(a,function(){for(var a=arguments.length,d=Array(a),e=0;e<a;e++)d[e]=arguments[e];b.call(this,...d),c()});return c}return()=>!1}_removeEventListener(a,b){if(this.__eventListeners[a])if(b){let c=this.__eventListeners[a],d=c.indexOf(b);d>-1&&c.splice(d,1)}else this.__eventListeners[a]=[]}off(a,b){if(this.__eventListeners)if(void 0===a)for(let a in this.__eventListeners)this._removeEventListener(a);else"object"==typeof a?Object.entries(a).forEach(a=>{let[b,c]=a;this._removeEventListener(b,c)}):this._removeEventListener(a,b)}fire(a,b){var c;if(!this.__eventListeners)return;let d=null==(c=this.__eventListeners[a])?void 0:c.concat();if(d)for(let a=0;a<d.length;a++)d[a].call(this,b||{})}}let Ws=(a,b)=>{let c=a.indexOf(b);return -1!==c&&a.splice(c,1),a},Wt=a=>{if(0===a)return 1;switch(Math.abs(a)/VY){case 1:case 3:return 0;case 2:return -1}return Math.cos(a)},Wu=a=>{if(0===a)return 0;let b=Math.sign(a);switch(a/VY){case 1:return b;case 2:return 0;case 3:return-b}return Math.sin(a)};class Wv{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof a?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}add(a){return new Wv(this.x+a.x,this.y+a.y)}addEquals(a){return this.x+=a.x,this.y+=a.y,this}scalarAdd(a){return new Wv(this.x+a,this.y+a)}scalarAddEquals(a){return this.x+=a,this.y+=a,this}subtract(a){return new Wv(this.x-a.x,this.y-a.y)}subtractEquals(a){return this.x-=a.x,this.y-=a.y,this}scalarSubtract(a){return new Wv(this.x-a,this.y-a)}scalarSubtractEquals(a){return this.x-=a,this.y-=a,this}multiply(a){return new Wv(this.x*a.x,this.y*a.y)}scalarMultiply(a){return new Wv(this.x*a,this.y*a)}scalarMultiplyEquals(a){return this.x*=a,this.y*=a,this}divide(a){return new Wv(this.x/a.x,this.y/a.y)}scalarDivide(a){return new Wv(this.x/a,this.y/a)}scalarDivideEquals(a){return this.x/=a,this.y/=a,this}eq(a){return this.x===a.x&&this.y===a.y}lt(a){return this.x<a.x&&this.y<a.y}lte(a){return this.x<=a.x&&this.y<=a.y}gt(a){return this.x>a.x&&this.y>a.y}gte(a){return this.x>=a.x&&this.y>=a.y}lerp(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return b=Math.max(Math.min(1,b),0),new Wv(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)}distanceFrom(a){let b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)}midPointFrom(a){return this.lerp(a)}min(a){return new Wv(Math.min(this.x,a.x),Math.min(this.y,a.y))}max(a){return new Wv(Math.max(this.x,a.x),Math.max(this.y,a.y))}toString(){return`${this.x},${this.y}`}setXY(a,b){return this.x=a,this.y=b,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setFromPoint(a){return this.x=a.x,this.y=a.y,this}swap(a){let b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c}clone(){return new Wv(this.x,this.y)}rotate(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ww,c=Wu(a),d=Wt(a),e=this.subtract(b);return new Wv(e.x*d-e.y*c,e.x*c+e.y*d).add(b)}transform(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Wv(a[0]*this.x+a[2]*this.y+(b?0:a[4]),a[1]*this.x+a[3]*this.y+(b?0:a[5]))}}let Ww=new Wv(0,0),Wx=a=>!!a&&Array.isArray(a._objects);function Wy(a){class b extends a{constructor(){super(...arguments),VK(this,"_objects",[])}_onObjectAdded(a){}_onObjectRemoved(a){}_onStackOrderChanged(a){}add(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];let d=this._objects.push(...b);return b.forEach(a=>this._onObjectAdded(a)),d}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return this._objects.splice(a,0,...c),c.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){let a=this._objects,b=[];for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return d.forEach(c=>{let d=a.indexOf(c);-1!==d&&(a.splice(d,1),b.push(c),this._onObjectRemoved(c))}),b}forEachObject(a){this.getObjects().forEach((b,c,d)=>a(b,c,d))}getObjects(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return 0===b.length?[...this._objects]:this._objects.filter(a=>a.isType(...b))}item(a){return this._objects[a]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(a,c){return!!this._objects.includes(a)||!!c&&this._objects.some(c=>c instanceof b&&c.contains(a,!0))}complexity(){return this._objects.reduce((a,b)=>a+=b.complexity?b.complexity():0,0)}sendObjectToBack(a){return!(!a||a===this._objects[0])&&(Ws(this._objects,a),this._objects.unshift(a),this._onStackOrderChanged(a),!0)}bringObjectToFront(a){return!(!a||a===this._objects[this._objects.length-1])&&(Ws(this._objects,a),this._objects.push(a),this._onStackOrderChanged(a),!0)}sendObjectBackwards(a,b){if(!a)return!1;let c=this._objects.indexOf(a);if(0!==c){let d=this.findNewLowerIndex(a,c,b);return Ws(this._objects,a),this._objects.splice(d,0,a),this._onStackOrderChanged(a),!0}return!1}bringObjectForward(a,b){if(!a)return!1;let c=this._objects.indexOf(a);if(c!==this._objects.length-1){let d=this.findNewUpperIndex(a,c,b);return Ws(this._objects,a),this._objects.splice(d,0,a),this._onStackOrderChanged(a),!0}return!1}moveObjectTo(a,b){return a!==this._objects[b]&&(Ws(this._objects,a),this._objects.splice(b,0,a),this._onStackOrderChanged(a),!0)}findNewLowerIndex(a,b,c){let d;if(c){d=b;for(let c=b-1;c>=0;--c)if(a.isOverlapping(this._objects[c])){d=c;break}}else d=b-1;return d}findNewUpperIndex(a,b,c){let d;if(c){d=b;for(let c=b+1;c<this._objects.length;++c)if(a.isOverlapping(this._objects[c])){d=c;break}}else d=b+1;return d}collectObjects(a){let{left:b,top:c,width:d,height:e}=a,{includeIntersecting:f=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=[],h=new Wv(b,c),i=h.add(new Wv(d,e));for(let a=this._objects.length-1;a>=0;a--){let b=this._objects[a];b.selectable&&b.visible&&(f&&b.intersectsWithRect(h,i)||b.isContainedWithinRect(h,i)||f&&b.containsPoint(h)||f&&b.containsPoint(i))&&g.push(b)}return g}}return b}class Wz extends Wr{_setOptions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let b in a)this.set(b,a[b])}_setObject(a){for(let b in a)this._set(b,a[b])}set(a,b){return"object"==typeof a?this._setObject(a):this._set(a,b),this}_set(a,b){this[a]=b}toggle(a){let b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this}get(a){return this[a]}}function WA(a){return VT().window.requestAnimationFrame(a)}function WB(a){return VT().window.cancelAnimationFrame(a)}let WC=0,WD=()=>WC++,WE=()=>{let a=VT().document.createElement("canvas");if(!a||void 0===a.getContext)throw new VO("Failed to create `canvas` element");return a},WF=()=>VT().document.createElement("img"),WG=a=>{let b=WE();return b.width=a.width,b.height=a.height,b},WH=(a,b,c)=>a.toDataURL(`image/${b}`,c),WI=(a,b,c)=>new Promise((d,e)=>{a.toBlob(d,`image/${b}`,c)}),WJ=a=>a*V_,WK=a=>a/V_,WL=a=>a.every((a,b)=>a===V0[b]),WM=(a,b,c)=>new Wv(a).transform(b,c),WN=a=>{let b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0],{x:d,y:e}=new Wv(a[4],a[5]).transform(c,!0);return c[4]=-d,c[5]=-e,c},WO=(a,b,c)=>[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]],WP=(a,b)=>a.reduceRight((a,c)=>c&&a?WO(c,a,b):c||a,void 0)||V0.concat(),WQ=a=>{let[b,c]=a;return Math.atan2(c,b)},WR=a=>{let b=WQ(a),c=Math.pow(a[0],2)+Math.pow(a[1],2),d=Math.sqrt(c),e=(a[0]*a[3]-a[2]*a[1])/d,f=Math.atan2(a[0]*a[2]+a[1]*a[3],c);return{angle:WK(b),scaleX:d,scaleY:e,skewX:WK(f),skewY:0,translateX:a[4]||0,translateY:a[5]||0}},WS=function(a){return[1,0,0,1,a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function WT(){let{angle:a=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:b=0,y:c=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=WJ(a),e=Wt(d),f=Wu(d);return[e,f,-f,e,b?b-(e*b-f*c):0,c?c-(f*b+e*c):0]}let WU=function(a){return[a,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,0,0]},WV=a=>Math.tan(WJ(a)),WW=a=>[1,0,WV(a),1,0,0],WX=a=>[1,WV(a),0,1,0,0],WY=a=>{let{scaleX:b=1,scaleY:c=1,flipX:d=!1,flipY:e=!1,skewX:f=0,skewY:g=0}=a,h=WU(d?-b:b,e?-c:c);return f&&(h=WO(h,WW(f),!0)),g&&(h=WO(h,WX(g),!0)),h},WZ=a=>{let{translateX:b=0,translateY:c=0,angle:d=0}=a,e=WS(b,c);d&&(e=WO(e,WT({angle:d})));let f=WY(a);return WL(f)||(e=WO(e,f)),e},W$=function(a){let{signal:b,crossOrigin:c=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(d,e){let f;if(b&&b.aborted)return e(new VP("loadImage"));let g=WF();b&&(f=function(a){g.src="",e(a)},b.addEventListener("abort",f,{once:!0}));let h=function(){g.onload=g.onerror=null,f&&(null==b||b.removeEventListener("abort",f)),d(g)};a?(g.onload=h,g.onerror=function(){f&&(null==b||b.removeEventListener("abort",f)),e(new VO(`Error loading ${g.src}`))},c&&(g.crossOrigin=c),g.src=a):h()})},W_=function(a){let{signal:b,reviver:c=VX}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((d,e)=>{let f=[];b&&b.addEventListener("abort",e,{once:!0}),Promise.all(a.map(a=>Wp.getClass(a.type).fromObject(a,{signal:b}).then(b=>(c(a,b),f.push(b),b)))).then(d).catch(a=>{f.forEach(a=>{a.dispose&&a.dispose()}),e(a)}).finally(()=>{b&&b.removeEventListener("abort",e)})})},W0=function(a){let{signal:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((c,d)=>{let e=[];b&&b.addEventListener("abort",d,{once:!0});let f=Object.values(a).map(a=>a&&a.type&&Wp.has(a.type)?W_([a],{signal:b}).then(a=>{let[b]=a;return e.push(b),b}):a),g=Object.keys(a);Promise.all(f).then(a=>a.reduce((a,b,c)=>(a[g[c]]=b,a),{})).then(c).catch(a=>{e.forEach(a=>{a.dispose&&a.dispose()}),d(a)}).finally(()=>{b&&b.removeEventListener("abort",d)})})},W1=function(a){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((b,c)=>(c in a&&(b[c]=a[c]),b),{})},W2=(a,b)=>Object.keys(a).reduce((c,d)=>(b(a[d],d,a)&&(c[d]=a[d]),c),{}),W3=(a,b)=>parseFloat(Number(a).toFixed(b)),W4=a=>"matrix("+a.map(a=>W3(a,VM.NUM_FRACTION_DIGITS)).join(" ")+")",W5=a=>!!a&&void 0!==a.toLive,W6=a=>!!a&&"function"==typeof a.toObject,W7=a=>!!a&&void 0!==a.offsetX&&"source"in a,W8=a=>!!a&&"multiSelectionStacking"in a;function W9(a){let b=a&&Xa(a),c=0,d=0;if(!a||!b)return{left:c,top:d};let e=a,f=b.documentElement,g=b.body||{scrollLeft:0,scrollTop:0};for(;e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===b?(c=g.scrollLeft||f.scrollLeft||0,d=g.scrollTop||f.scrollTop||0):(c+=e.scrollLeft||0,d+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:c,top:d}}let Xa=a=>a.ownerDocument||null,Xb=a=>{var b;return(null==(b=a.ownerDocument)?void 0:b.defaultView)||null},Xc=function(a,b,c){let{width:d,height:e}=c,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;a.width=d,a.height=e,f>1&&(a.setAttribute("width",(d*f).toString()),a.setAttribute("height",(e*f).toString()),b.scale(f,f))},Xd=(a,b)=>{let{width:c,height:d}=b;c&&(a.style.width="number"==typeof c?`${c}px`:c),d&&(a.style.height="number"==typeof d?`${d}px`:d)};function Xe(a){return void 0!==a.onselectstart&&(a.onselectstart=()=>!1),a.style.userSelect=V5,a}class Xf{constructor(a){VK(this,"_originalCanvasStyle",void 0),VK(this,"lower",void 0);const b=this.createLowerCanvas(a);this.lower={el:b,ctx:b.getContext("2d")}}createLowerCanvas(a){let b=a&&void 0!==a.getContext?a:a&&VT().document.getElementById(a)||WE();if(b.hasAttribute("data-fabric"))throw new VO("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=b.style.cssText,b.setAttribute("data-fabric","main"),b.classList.add("lower-canvas"),b}cleanupDOM(a){let{width:b,height:c}=a,{el:d}=this.lower;d.classList.remove("lower-canvas"),d.removeAttribute("data-fabric"),d.setAttribute("width",`${b}`),d.setAttribute("height",`${c}`),d.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(a,b){let{el:c,ctx:d}=this.lower;Xc(c,d,a,b)}setCSSDimensions(a){Xd(this.lower.el,a)}calcOffset(){return function(a){var b;let c=a&&Xa(a),d={left:0,top:0};if(!c)return d;let e=(null==(b=Xb(a))?void 0:b.getComputedStyle(a,null))||{};d.left+=parseInt(e.borderLeftWidth,10)||0,d.top+=parseInt(e.borderTopWidth,10)||0,d.left+=parseInt(e.paddingLeft,10)||0,d.top+=parseInt(e.paddingTop,10)||0;let f={left:0,top:0},g=c.documentElement;void 0!==a.getBoundingClientRect&&(f=a.getBoundingClientRect());let h=W9(a);return{left:f.left+h.left-(g.clientLeft||0)+d.left,top:f.top+h.top-(g.clientTop||0)+d.top}}(this.lower.el)}dispose(){VT().dispose(this.lower.el),delete this.lower}}let Xg={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...V0],patternQuality:"best"},Xh=a=>a.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Xi=a=>(k||k||(k="Intl"in VT().window&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),k)?Array.from(k.segment(a)).map(a=>{let{segment:b}=a;return b}):Xj(a),Xj=a=>{let b=[];for(let c,d=0;d<a.length;d++)!1!==(c=Xk(a,d))&&b.push(c);return b},Xk=(a,b)=>{let c=a.charCodeAt(b);if(isNaN(c))return"";if(c<55296||c>57343)return a.charAt(b);if(55296<=c&&c<=56319){if(a.length<=b+1)throw"High surrogate without following low surrogate";let c=a.charCodeAt(b+1);if(56320>c||c>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(0===b)throw"Low surrogate without preceding high surrogate";let d=a.charCodeAt(b-1);if(55296>d||d>56319)throw"Low surrogate without preceding high surrogate";return!1};var Xl=Object.freeze({__proto__:null,capitalize:function(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return`${a.charAt(0).toUpperCase()}${b?a.slice(1):a.slice(1).toLowerCase()}`},escapeXml:Xh,graphemeSplit:Xi});class Xm extends Wy(Wz){get lowerCanvasEl(){var a;return null==(a=this.elements.lower)?void 0:a.el}get contextContainer(){var a;return null==(a=this.elements.lower)?void 0:a.ctx}static getDefaults(){return Xm.ownDefaults}constructor(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(b),this.initElements(a),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(a){this.elements=new Xf(a)}add(){let a=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),a}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let e=super.insertAt(a,...c);return c.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}remove(){let a=super.remove(...arguments);return a.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),a}_onObjectAdded(a){a.canvas&&a.canvas!==this&&(VN("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),a.canvas.remove(a)),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added",{target:this})}_onObjectRemoved(a){a._set("canvas",void 0),this.fire("object:removed",{target:a}),a.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?VU():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}_setDimensionsImpl(a){let{cssOnly:b=!1,backstoreOnly:c=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!b){let b={width:this.width,height:this.height,...a};this.elements.setDimensions(b,this.getRetinaScaling()),this.hasLostContext=!0,this.width=b.width,this.height=b.height}c||this.elements.setCSSDimensions(a),this.calcOffset()}setDimensions(a,b){this._setDimensionsImpl(a,b),b&&b.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(a){this.viewportTransform=a,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(a,b){let c=[...this.viewportTransform],d=WM(a,WN(c));c[0]=b,c[3]=b;let e=WM(d,c);c[4]+=a.x-e.x,c[5]+=a.y-e.y,this.setViewportTransform(c)}setZoom(a){this.zoomToPoint(new Wv(0,0),a)}absolutePan(a){let b=[...this.viewportTransform];return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)}relativePan(a){return this.absolutePan(new Wv(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(a){a.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=WA(()=>this.renderAndReset()))}calcViewportBoundaries(){let a=this.width,b=this.height,c=WN(this.viewportTransform),d=WM({x:0,y:0},c),e=WM({x:a,y:b},c),f=d.min(e),g=d.max(e);return this.vptCoords={tl:f,tr:new Wv(g.x,f.y),bl:new Wv(f.x,g.y),br:g}}cancelRequestedRender(){this.nextRenderHandle&&(WB(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(a){}renderCanvas(a,b){if(this.destroyed)return;let c=this.viewportTransform,d=this.clipPath;this.calcViewportBoundaries(),this.clearContext(a),a.imageSmoothingEnabled=this.imageSmoothingEnabled,a.patternQuality=this.patternQuality,this.fire("before:render",{ctx:a}),this._renderBackground(a),a.save(),a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._renderObjects(a,b),a.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(a),d&&(d._set("canvas",this),d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(a,d)),this._renderOverlay(a),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(a),this.fire("after:render",{ctx:a}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(a,b){let c=this.viewportTransform;a.save(),a.transform(...c),a.globalCompositeOperation="destination-in",b.transform(a),a.scale(1/b.zoomX,1/b.zoomY),a.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),a.restore()}_renderObjects(a,b){for(let c=0,d=b.length;c<d;++c)b[c]&&b[c].render(a)}_renderBackgroundOrOverlay(a,b){let c=this[`${b}Color`],d=this[`${b}Image`],e=this.viewportTransform,f=this[`${b}Vpt`];if(!c&&!d)return;let g=W5(c);if(c){if(a.save(),a.beginPath(),a.moveTo(0,0),a.lineTo(this.width,0),a.lineTo(this.width,this.height),a.lineTo(0,this.height),a.closePath(),a.fillStyle=g?c.toLive(a):c,f&&a.transform(...e),g){a.transform(1,0,0,1,c.offsetX||0,c.offsetY||0);let b=c.gradientTransform||c.patternTransform;b&&a.transform(...b)}a.fill(),a.restore()}if(d){a.save();let{skipOffscreen:b}=this;this.skipOffscreen=f,f&&a.transform(...e),d.render(a),this.skipOffscreen=b,a.restore()}}_renderBackground(a){this._renderBackgroundOrOverlay(a,"background")}_renderOverlay(a){this._renderBackgroundOrOverlay(a,"overlay")}getCenterPoint(){return new Wv(this.width/2,this.height/2)}centerObjectH(a){return this._centerObject(a,new Wv(this.getCenterPoint().x,a.getCenterPoint().y))}centerObjectV(a){return this._centerObject(a,new Wv(a.getCenterPoint().x,this.getCenterPoint().y))}centerObject(a){return this._centerObject(a,this.getCenterPoint())}viewportCenterObject(a){return this._centerObject(a,this.getVpCenter())}viewportCenterObjectH(a){return this._centerObject(a,new Wv(this.getVpCenter().x,a.getCenterPoint().y))}viewportCenterObjectV(a){return this._centerObject(a,new Wv(a.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return WM(this.getCenterPoint(),WN(this.viewportTransform))}_centerObject(a,b){a.setXY(b,V1,V1),a.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(a){return this.toDatalessObject(a)}toObject(a){return this._toObjectMethod("toObject",a)}toJSON(){return this.toObject()}toDatalessObject(a){return this._toObjectMethod("toDatalessObject",a)}_toObjectMethod(a,b){let c=this.clipPath,d=c&&!c.excludeFromExport?this._toObject(c,a,b):null;return{version:VW,...W1(this,b),objects:this._objects.filter(a=>!a.excludeFromExport).map(c=>this._toObject(c,a,b)),...this.__serializeBgOverlay(a,b),...d?{clipPath:d}:null}}_toObject(a,b,c){let d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);let e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=!!d),e}__serializeBgOverlay(a,b){let c={},d=this.backgroundImage,e=this.overlayImage,f=this.backgroundColor,g=this.overlayColor;return W5(f)?f.excludeFromExport||(c.background=f.toObject(b)):f&&(c.background=f),W5(g)?g.excludeFromExport||(c.overlay=g.toObject(b)):g&&(c.overlay=g),d&&!d.excludeFromExport&&(c.backgroundImage=this._toObject(d,a,b)),e&&!e.excludeFromExport&&(c.overlayImage=this._toObject(e,a,b)),c}toSVG(){var a;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;b.reviver=c;let d=[];return this._setSVGPreamble(d,b),this._setSVGHeader(d,b),this.clipPath&&d.push(`<g clip-path="url(#${Xh(null!=(a=this.clipPath.clipPathId)?a:"")})" >
`),this._setSVGBgOverlayColor(d,"background"),this._setSVGBgOverlayImage(d,"backgroundImage",c),this._setSVGObjects(d,c),this.clipPath&&d.push("</g>\n"),this._setSVGBgOverlayColor(d,"overlay"),this._setSVGBgOverlayImage(d,"overlayImage",c),d.push("</svg>"),d.join("")}_setSVGPreamble(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(a,b){let c,d=b.width||`${this.width}`,e=b.height||`${this.height}`,f=VM.NUM_FRACTION_DIGITS,g=b.viewBox;if(g)c=`viewBox="${g.x} ${g.y} ${g.width} ${g.height}" `;else if(this.svgViewportTransformation){let a=this.viewportTransform;c=`viewBox="${W3(-a[4]/a[0],f)} ${W3(-a[5]/a[3],f)} ${W3(this.width/a[0],f)} ${W3(this.height/a[3],f)}" `}else c=`viewBox="0 0 ${this.width} ${this.height}" `;a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',d,'" ','height="',e,'" ',c,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",VW,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(b),"</defs>\n")}createSVGClipPathMarkup(a){let b=this.clipPath;return b?(b.clipPathId=`CLIPPATH_${WD()}`,`<clipPath id="${b.clipPathId}" >
${b.toClipPathSVG(a.reviver)}</clipPath>
`):""}createSVGRefElementsMarkup(){return["background","overlay"].map(a=>{let b=this[`${a}Color`];if(W5(b)){let c=this[`${a}Vpt`],d=this.viewportTransform,e={isType:()=>!1,width:this.width/(c?d[0]:1),height:this.height/(c?d[3]:1)};return b.toSVG(e,{additionalTransform:c?W4(d):""})}}).join("")}createSVGFontFacesMarkup(){let a=[],b={},c=VM.fontPaths;this._objects.forEach(function b(c){a.push(c),Wx(c)&&c._objects.forEach(b)}),a.forEach(a=>{if(!a||"function"!=typeof a._renderText)return;let{styles:d,fontFamily:e}=a;!b[e]&&c[e]&&(b[e]=!0,d&&Object.values(d).forEach(a=>{Object.values(a).forEach(a=>{let{fontFamily:d=""}=a;!b[d]&&c[d]&&(b[d]=!0)})}))});let d=Object.keys(b).map(a=>`		@font-face {
			font-family: '${a}';
			src: url('${c[a]}');
		}
`).join("");return d?`	<style type="text/css"><![CDATA[
${d}]]></style>
`:""}_setSVGObjects(a,b){this.forEachObject(c=>{c.excludeFromExport||this._setSVGObject(a,c,b)})}_setSVGObject(a,b,c){a.push(b.toSVG(c))}_setSVGBgOverlayImage(a,b,c){let d=this[b];d&&!d.excludeFromExport&&d.toSVG&&a.push(d.toSVG(c))}_setSVGBgOverlayColor(a,b){let c=this[`${b}Color`];if(c)if(W5(c)){let d=c.repeat||"",e=this.width,f=this.height,g=this[`${b}Vpt`]?W4(WN(this.viewportTransform)):"";a.push(`<rect transform="${g} translate(${e/2},${f/2})" x="${c.offsetX-e/2}" y="${c.offsetY-f/2}" width="${"repeat-y"!==d&&"no-repeat"!==d||!W7(c)?e:c.source.width}" height="${"repeat-x"!==d&&"no-repeat"!==d||!W7(c)?f:c.source.height}" fill="url(#SVGID_${c.id})"></rect>
`)}else a.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',c,'"',"></rect>\n")}loadFromJSON(a,b){let{signal:c}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!a)return Promise.reject(new VO("`json` is undefined"));let{objects:d=[],...e}="string"==typeof a?JSON.parse(a):a,{backgroundImage:f,background:g,overlayImage:h,overlay:i,clipPath:j}=e,k=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([W_(d,{reviver:b,signal:c}),W0({backgroundImage:f,backgroundColor:g,overlayImage:h,overlayColor:i,clipPath:j},{signal:c})]).then(a=>{let[b,c]=a;return this.clear(),this.add(...b),this.set(e),this.set(c),this.renderOnAddRemove=k,this})}clone(a){let b=this.toObject(a);return this.cloneWithoutData().loadFromJSON(b)}cloneWithoutData(){let a=WG(this);return new this.constructor(a)}toDataURL(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:b="png",quality:c=1,multiplier:d=1,enableRetinaScaling:e=!1}=a,f=d*(e?this.getRetinaScaling():1);return WH(this.toCanvasElement(f,a),b,c)}toBlob(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:b="png",quality:c=1,multiplier:d=1,enableRetinaScaling:e=!1}=a,f=d*(e?this.getRetinaScaling():1);return WI(this.toCanvasElement(f,a),b,c)}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:b,height:c,left:d,top:e,filter:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=(b||this.width)*a,h=(c||this.height)*a,i=this.getZoom(),j=this.width,k=this.height,l=this.skipControlsDrawing,m=i*a,n=this.viewportTransform,o=[m,0,0,m,(n[4]-(d||0))*a,(n[5]-(e||0))*a],p=this.enableRetinaScaling,q=WG({width:g,height:h}),r=f?this._objects.filter(a=>f(a)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=o,this.width=g,this.height=h,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(q.getContext("2d"),r),this.viewportTransform=n,this.width=j,this.height=k,this.calcViewportBoundaries(),this.enableRetinaScaling=p,this.skipControlsDrawing=l,q}dispose(){return this.disposed||this.elements.cleanupDOM({width:this.width,height:this.height}),Wq.cancelByCanvas(this),this.disposed=!0,new Promise((a,b)=>{let c=()=>{this.destroy(),a(!0)};c.kill=b,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?a(!1):this.nextRenderHandle?this.__cleanupTask=c:c()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(a=>a.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return`#<Canvas (${this.complexity()}): { objects: ${this._objects.length} }>`}}VK(Xm,"ownDefaults",Xg);let Xn=["touchstart","touchmove","touchend"],Xo=a=>{let b,c=W9(a.target),d=(b=a.changedTouches)&&b[0]?b[0]:a;return new Wv(d.clientX+c.left,d.clientY+c.top)},Xp=a=>Xn.includes(a.type)||"touch"===a.pointerType,Xq=a=>{a.preventDefault(),a.stopPropagation()},Xr=a=>{let b=0,c=0,d=0,e=0;for(let f=0,g=a.length;f<g;f++){let{x:g,y:h}=a[f];(g>d||!f)&&(d=g),(g<b||!f)&&(b=g),(h>e||!f)&&(e=h),(h<c||!f)&&(c=h)}return{left:b,top:c,width:d-b,height:e-c}},Xs=(a,b)=>Xt(a,WO(b,a.calcOwnMatrix())),Xt=(a,b)=>{let{translateX:c,translateY:d,scaleX:e,scaleY:f,...g}=WR(b),h=new Wv(c,d);a.flipX=!1,a.flipY=!1,Object.assign(a,g),a.set({scaleX:e,scaleY:f}),a.setPositionByOrigin(h,V1,V1)},Xu=a=>{a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},Xv=a=>({scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}),Xw=(a,b,c)=>{let d=a/2,e=b/2,f=Xr([new Wv(-d,-e),new Wv(d,-e),new Wv(-d,e),new Wv(d,e)].map(a=>a.transform(c)));return new Wv(f.width,f.height)},Xx=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V0;return WO(WN(arguments.length>1&&void 0!==arguments[1]?arguments[1]:V0),a)},Xy=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V0;return a.transform(Xx(b,c))},Xz=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V0;return a.transform(Xx(b,c),!0)},XA=(a,b,c)=>{let d=Xx(b,c);return Xt(a,WO(d,a.calcOwnMatrix())),d},XB={left:-.5,top:-.5,center:0,bottom:.5,right:.5},XC=a=>"string"==typeof a?XB[a]:a-.5,XD=new Wv(1,0),XE=new Wv,XF=(a,b)=>a.rotate(b),XG=(a,b)=>new Wv(b).subtract(a),XH=a=>a.distanceFrom(XE),XI=(a,b)=>Math.atan2(XM(a,b),XN(a,b)),XJ=a=>XI(XD,a),XK=a=>a.eq(XE)?a:a.scalarDivide(XH(a)),XL=function(a){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return XK(new Wv(-a.y,a.x).scalarMultiply(b?1:-1))},XM=(a,b)=>a.x*b.y-a.y*b.x,XN=(a,b)=>a.x*b.x+a.y*b.y,XO=(a,b,c)=>{if(a.eq(b)||a.eq(c))return!0;let d=XM(b,c),e=XM(b,a),f=XM(c,a);return d>=0?e>=0&&f<=0:!(e<=0&&f>=0)},XP="not-allowed";function XQ(a){return XC(a.originX)===XC(V1)&&XC(a.originY)===XC(V1)}let XR=(a,b)=>a[b],XS=(a,b,c,d)=>({e:a,transform:b,pointer:new Wv(c,d)});function XT(a,b,c){return Math.round((XJ(XG(Xy(a.getCenterPoint(),a.canvas.viewportTransform,void 0),c))+V$)%V$/VZ)}function XU(a,b,c,d,e){var f,g;let h,i,{target:j,corner:k}=a,l=j.controls[k],m=(null==(f=j.canvas)?void 0:f.getZoom())||1,n=j.padding/m,o=(g=new Wv(d,e),h=j.getRelativeCenterPoint(),i=void 0!==b&&void 0!==c?j.translateToGivenOrigin(h,V1,V1,b,c):new Wv(j.left,j.top),(j.angle?g.rotate(-WJ(j.angle),h):g).subtract(i));return o.x>=n&&(o.x-=n),o.x<=-n&&(o.x+=n),o.y>=n&&(o.y-=n),o.y<=n&&(o.y+=n),o.x-=l.offsetX,o.y-=l.offsetY,o}let XV={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},XW=(a,b,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a),XX=(a,b,c,d)=>{let e,f;a/=255;let g=Math.max(a,b/=255,c/=255),h=Math.min(a,b,c),i=(g+h)/2;if(g===h)e=f=0;else{let d=g-h;switch(f=i>.5?d/(2-g-h):d/(g+h),g){case a:e=(b-c)/d+6*(b<c);break;case b:e=(c-a)/d+2;break;case c:e=(a-b)/d+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*i),d]},XY=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(a)/(a.endsWith("%")?100:1)},XZ=a=>Math.min(Math.round(a),255).toString(16).toUpperCase().padStart(2,"0"),X$=a=>{let[b,c,d,e=1]=a,f=Math.round(.3*b+.59*c+.11*d);return[f,f,f,e]};class X_{constructor(a){if(VK(this,"isUnrecognised",!1),a)if(a instanceof X_)this.setSource([...a._source]);else if(Array.isArray(a)){const[b,c,d,e=1]=a;this.setSource([b,c,d,e])}else this.setSource(this._tryParsingColor(a));else this.setSource([0,0,0,1])}_tryParsingColor(a){return(a=a.toLowerCase())in XV&&(a=XV[a]),"transparent"===a?[255,255,255,0]:X_.sourceFromHex(a)||X_.sourceFromRgb(a)||X_.sourceFromHsl(a)||(this.isUnrecognised=!0,[0,0,0,1])}getSource(){return this._source}setSource(a){this._source=a}toRgb(){let[a,b,c]=this.getSource();return`rgb(${a},${b},${c})`}toRgba(){return`rgba(${this.getSource().join(",")})`}toHsl(){let[a,b,c]=XX(...this.getSource());return`hsl(${a},${b}%,${c}%)`}toHsla(){let[a,b,c,d]=XX(...this.getSource());return`hsla(${a},${b}%,${c}%,${d})`}toHex(){return this.toHexa().slice(0,6)}toHexa(){let[a,b,c,d]=this.getSource();return`${XZ(a)}${XZ(b)}${XZ(c)}${XZ(Math.round(255*d))}`}getAlpha(){return this.getSource()[3]}setAlpha(a){return this._source[3]=a,this}toGrayscale(){return this.setSource(X$(this.getSource())),this}toBlackWhite(a){let[b,,,c]=X$(this.getSource()),d=b<(a||127)?0:255;return this.setSource([d,d,d,c]),this}overlayWith(a){a instanceof X_||(a=new X_(a));let b=this.getSource(),c=a.getSource(),[d,e,f]=b.map((a,b)=>Math.round(.5*a+.5*c[b]));return this.setSource([d,e,f,b[3]]),this}static fromRgb(a){return X_.fromRgba(a)}static fromRgba(a){return new X_(X_.sourceFromRgb(a))}static sourceFromRgb(a){let b=a.replace(/\s+/g," ").match(/^rgba?\(\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d{0,3}(?:\.\d+)?%?)\s?)?\)$/i);if(b){let[a,c,d]=b.slice(1,4).map(a=>{let b=parseFloat(a);return a.endsWith("%")?Math.round(2.55*b):b});return[a,c,d,XY(b[4])]}}static fromHsl(a){return X_.fromHsla(a)}static fromHsla(a){return new X_(X_.sourceFromHsl(a))}static sourceFromHsl(a){let b,c,d,e=a.replace(/\s+/g," ").match(/^hsla?\(\s?([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d*(?:\.\d+)?%?)\s?)?\)$/i);if(!e)return;let f=(X_.parseAngletoDegrees(e[1])%360+360)%360/360,g=parseFloat(e[2])/100,h=parseFloat(e[3])/100;if(0===g)b=c=d=h;else{let a=h<=.5?h*(g+1):h+g-h*g,e=2*h-a;b=XW(e,a,f+1/3),c=XW(e,a,f),d=XW(e,a,f-1/3)}return[Math.round(255*b),Math.round(255*c),Math.round(255*d),XY(e[4])]}static fromHex(a){return new X_(X_.sourceFromHex(a))}static sourceFromHex(a){if(a.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){let b=a.slice(a.indexOf("#")+1),[c,d,e,f=255]=(b.length<=4?b.split("").map(a=>a+a):b.match(/.{2}/g)).map(a=>parseInt(a,16));return[c,d,e,f/255]}}static parseAngletoDegrees(a){let b=a.toLowerCase(),c=parseFloat(b);return b.includes("rad")?WK(c):b.includes("turn")?360*c:c}}let X0=function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,c=/\D{0,2}$/.exec(a),d=parseFloat(a),e=VM.DPI;switch(null==c?void 0:c[0]){case"mm":return d*e/25.4;case"cm":return d*e/2.54;case"in":return d*e;case"pt":return d*e/72;case"pc":return d*e/72*12;case"em":return d*b;default:return d}},X1=a=>{let[b,c]=a.trim().split(" "),[d,e]=b&&b!==V5?[b.slice(1,4),b.slice(5,8)]:b===V5?[b,b]:["Mid","Mid"];return{meetOrSlice:c||"meet",alignX:d,alignY:e}},X2=function(a,b){let c,d,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(b)if(b.toLive)c=`url(#SVGID_${Xh(b.id)})`;else{let a=new X_(b),e=a.getAlpha();c=a.toRgb(),1!==e&&(d=e.toString())}else c="none";return e?`${a}: ${c}; ${d?`${a}-opacity: ${d}; `:""}`:`${a}="${c}" ${d?`${a}-opacity="${d}" `:""}`};class X3{getSvgStyles(a){let b=this.fillRule?this.fillRule:"nonzero",c=this.strokeWidth?this.strokeWidth:"0",d=this.strokeDashArray?this.strokeDashArray.join(" "):V5,e=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i=void 0!==this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=a?"":this.getSvgFilter(),l=X2(Wk,this.fill);return[X2(Wl,this.stroke),"stroke-width: ",c,"; ","stroke-dasharray: ",d,"; ","stroke-linecap: ",f,"; ","stroke-dashoffset: ",e,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ",l,"fill-rule: ",b,"; ","opacity: ",i,";",k,j].map(a=>Xh(a)).join("")}getSvgFilter(){return this.shadow?`filter: url(#SVGID_${Xh(this.shadow.id)});`:""}getSvgCommons(){return[this.id?`id="${Xh(String(this.id))}" `:"",this.clipPath?`clip-path="url(#${this.clipPath.clipPathId})" `:""].join("")}getSvgTransform(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=a?this.calcTransformMatrix():this.calcOwnMatrix();return`transform="${W4(c)}${b}" `}_toSVG(a){return[""]}toSVG(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})}toClipPathSVG(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})}_createBaseClipPathSVGMarkup(a){let{reviver:b,additionalTransform:c=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=[this.getSvgTransform(!0,c),this.getSvgCommons()].join(""),e=a.indexOf("COMMON_PARTS");return a[e]=d,b?b(a.join("")):a.join("")}_createBaseSVGMarkup(a){let b,{noStyle:c,reviver:d,withShadow:e,additionalTransform:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=c?"":`style="${this.getSvgStyles()}" `,h=e?`style="${this.getSvgFilter()}" `:"",i=this.clipPath,j=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",k=i&&i.absolutePositioned,l=this.stroke,m=this.fill,n=this.shadow,o=[],p=a.indexOf("COMMON_PARTS");i&&(i.clipPathId=`CLIPPATH_${WD()}`,b=`<clipPath id="${i.clipPathId}" >
${i.toClipPathSVG(d)}</clipPath>
`),k&&o.push("<g ",h,this.getSvgCommons()," >\n"),o.push("<g ",this.getSvgTransform(!1),k?"":h+this.getSvgCommons()," >\n");let q=""+g+j+(c?"":this.addPaintOrder())+" "+(f?`transform="${f}" `:"");return a[p]=q,W5(m)&&o.push(m.toSVG(this)),W5(l)&&o.push(l.toSVG(this)),n&&o.push(n.toSVG(this)),i&&o.push(b),o.push(a.join("")),o.push("</g>\n"),k&&o.push("</g>\n"),d?d(o.join("")):o.join("")}addPaintOrder(){return this.paintFirst!==Wk?` paint-order="${Xh(this.paintFirst)}" `:""}}function X4(a){return RegExp("^("+a.join("|")+")\\b","i")}let X5="textDecorationThickness",X6=["fontSize","fontWeight","fontFamily","fontStyle"],X7=["underline","overline","linethrough"],X8=[...X6,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],X9=[...X8,...X7,"textBackgroundColor","direction",X5],Ya=[...X6,...X7,Wl,"strokeWidth",Wk,"deltaY","textBackgroundColor",X5],Yb="justify",Yc="justify-left",Yd="justify-right",Ye="justify-center",Yf=String.raw`[-+]?(?:\d*\.\d+|\d+\.?)(?:[eE][-+]?\d+)?`,Yg=String.raw`(?:\s*,?\s+|\s*,\s*)`,Yh=RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Yf+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Yf+"))?\\s+(.*)"),Yi={cx:V2,x:V2,r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":X5},Yj="font-size",Yk="clip-path",Yl=(X4(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),X4(["symbol","image","marker","pattern","view","svg"]),X4(["symbol","g","a","svg","clipPath","defs"])),Ym=(new RegExp(String.raw`^\s*(${Yf})${Yg}(${Yf})${Yg}(${Yf})${Yg}(${Yf})\s*$`),"(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?"),Yn=RegExp("(?:\\s|^)"+Ym+Ym+"("+Yf+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Yo{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const b="string"==typeof a?Yo.parseShadow(a):a;Object.assign(this,Yo.ownDefaults,b),this.id=WD()}static parseShadow(a){let b=a.trim(),[,c=0,d=0,e=0]=(Yn.exec(b)||[]).map(a=>parseFloat(a)||0);return{color:(b.replace(Yn,"")||"rgb(0,0,0)").trim(),offsetX:c,offsetY:d,blur:e}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(a){let b=XF(new Wv(this.offsetX,this.offsetY),WJ(-a.angle)),c=VM.NUM_FRACTION_DIGITS,d=new X_(this.color),e=40,f=40;return a.width&&a.height&&(e=100*W3((Math.abs(b.x)+this.blur)/a.width,c)+20,f=100*W3((Math.abs(b.y)+this.blur)/a.height,c)+20),a.flipX&&(b.x*=-1),a.flipY&&(b.y*=-1),`<filter id="SVGID_${Xh(this.id)}" y="-${f}%" height="${100+2*f}%" x="-${e}%" width="${100+2*e}%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="${W3(this.blur?this.blur/2:0,c)}"></feGaussianBlur>
	<feOffset dx="${W3(b.x,c)}" dy="${W3(b.y,c)}" result="oBlur" ></feOffset>
	<feFlood flood-color="${d.toRgb()}" flood-opacity="${d.getAlpha()}"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`}toObject(){let a={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},b=Yo.ownDefaults;return this.includeDefaultValues?a:W2(a,(a,c)=>a!==b[c])}static async fromObject(a){return new this(a)}}VK(Yo,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),VK(Yo,"type","shadow"),Wp.setClass(Yo,"shadow");let Yp=(a,b,c)=>Math.max(a,Math.min(b,c)),Yq=["top",V2,Wg,Wh,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Wi,Wj],Yr=[Wk,Wl,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Ys=(a,b,c,d)=>(a<Math.abs(b)?(a=b,d=c/4):d=0===b&&0===a?c/V$*Math.asin(1):c/V$*Math.asin(b/a),{a:a,c:b,p:c,s:d}),Yt=(a,b,c,d,e)=>a*Math.pow(2,10*(d-=1))*Math.sin((d*e-b)*V$/c),Yu=(a,b,c,d)=>-c*Math.cos(a/d*VY)+c+b,Yv=(a,b,c,d)=>(a/=d)<1/2.75?7.5625*a*a*c+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b,Yw=(a,b,c,d)=>c-Yv(d-a,0,c,d)+b;var Yx=Object.freeze({__proto__:null,defaultEasing:Yu,easeInBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},easeInBounce:Yw,easeInCirc:(a,b,c,d)=>-c*(Math.sqrt(1-(a/=d)*a)-1)+b,easeInCubic:(a,b,c,d)=>c*(a/d)**3+b,easeInElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);let{a:f,s:g,p:h}=Ys(c,c,e,1.70158);return-Yt(f,g,h,a,d)+b},easeInExpo:(a,b,c,d)=>0===a?b:c*2**(10*(a/d-1))+b,easeInOutBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(a/=d/2)<1?c/2*(a*a*((1+(e*=1.525))*a-e))+b:c/2*((a-=2)*a*((1+(e*=1.525))*a+e)+2)+b},easeInOutBounce:(a,b,c,d)=>a<d/2?.5*Yw(2*a,0,c,d)+b:.5*Yv(2*a-d,0,c,d)+.5*c+b,easeInOutCirc:(a,b,c,d)=>(a/=d/2)<1?-c/2*(Math.sqrt(1-a**2)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b,easeInOutCubic:(a,b,c,d)=>(a/=d/2)<1?c/2*a**3+b:c/2*((a-2)**3+2)+b,easeInOutElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(2==(a/=d/2))return b+c;e||(e=.3*1.5*d);let{a:f,s:g,p:h,c:i}=Ys(c,c,e,1.70158);return a<1?-.5*Yt(f,g,h,a,d)+b:f*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*V$/h)*.5+i+b},easeInOutExpo:(a,b,c,d)=>0===a?b:a===d?b+c:(a/=d/2)<1?c/2*2**(10*(a-1))+b:-(c/2*(2**(-10*--a)+2))+b,easeInOutQuad:(a,b,c,d)=>(a/=d/2)<1?c/2*a**2+b:-c/2*(--a*(a-2)-1)+b,easeInOutQuart:(a,b,c,d)=>(a/=d/2)<1?c/2*a**4+b:-c/2*((a-=2)*a**3-2)+b,easeInOutQuint:(a,b,c,d)=>(a/=d/2)<1?c/2*a**5+b:c/2*((a-2)**5+2)+b,easeInOutSine:(a,b,c,d)=>-c/2*(Math.cos(Math.PI*a/d)-1)+b,easeInQuad:(a,b,c,d)=>c*(a/=d)*a+b,easeInQuart:(a,b,c,d)=>c*(a/=d)*a**3+b,easeInQuint:(a,b,c,d)=>c*(a/d)**5+b,easeInSine:(a,b,c,d)=>-c*Math.cos(a/d*VY)+c+b,easeOutBack:function(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeOutBounce:Yv,easeOutCirc:(a,b,c,d)=>c*Math.sqrt(1-(a=a/d-1)*a)+b,easeOutCubic:(a,b,c,d)=>c*((a/d-1)**3+1)+b,easeOutElastic:(a,b,c,d)=>{let e=0;if(0===a)return b;if(1==(a/=d))return b+c;e||(e=.3*d);let{a:f,s:g,p:h,c:i}=Ys(c,c,e,1.70158);return f*2**(-10*a)*Math.sin((a*d-g)*V$/h)+i+b},easeOutExpo:(a,b,c,d)=>a===d?b+c:-(c*(2**(-10*a/d)+1))+b,easeOutQuad:(a,b,c,d)=>-c*(a/=d)*(a-2)+b,easeOutQuart:(a,b,c,d)=>-c*((a=a/d-1)*a**3-1)+b,easeOutQuint:(a,b,c,d)=>c*((a/d-1)**5+1)+b,easeOutSine:(a,b,c,d)=>c*Math.sin(a/d*VY)+b});let Yy=()=>!1;class Yz{constructor(a){let{startValue:b,byValue:c,duration:d=500,delay:e=0,easing:f=Yu,onStart:g=VX,onChange:h=VX,onComplete:i=VX,abort:j=Yy,target:k}=a;VK(this,"_state","pending"),VK(this,"durationProgress",0),VK(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=d,this.delay=e,this.easing=f,this._onStart=g,this._onChange=h,this._onComplete=i,this._abort=j,this.target=k,this.startValue=b,this.byValue=c,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){let a=a=>{"pending"===this._state&&(this.startTime=a||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>WA(a),this.delay):WA(a)}tick(a){let b=(a||+new Date)-this.startTime,c=Math.min(b,this.duration);this.durationProgress=c/this.duration;let{value:d,valueProgress:e}=this.calculate(c);this.value=Object.freeze(d),this.valueProgress=e,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):b>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),WA(this.tick)))}register(){Wq.push(this)}unregister(){Wq.remove(this)}abort(){this._state="aborted",this.unregister()}}class YA extends Yz{constructor(a){let{startValue:b=0,endValue:c=100,...d}=a;super({...d,startValue:b,byValue:c-b})}calculate(a){let b=this.easing(a,this.startValue,this.byValue,this.duration);return{value:b,valueProgress:Math.abs((b-this.startValue)/this.byValue)}}}class YB extends Yz{constructor(a){let{startValue:b=[0],endValue:c=[100],...d}=a;super({...d,startValue:b,byValue:c.map((a,c)=>a-b[c])})}calculate(a){let b=this.startValue.map((b,c)=>this.easing(a,b,this.byValue[c],this.duration,c));return{value:b,valueProgress:Math.abs((b[0]-this.startValue[0])/this.byValue[0])}}}let YC=(a,b,c,d)=>b+c*(1-Math.cos(a/d*VY)),YD=a=>a&&((b,c,d)=>a(new X_(b).toRgba(),c,d));class YE extends Yz{constructor(a){let{startValue:b,endValue:c,easing:d=YC,onChange:e,onComplete:f,abort:g,...h}=a;const i=new X_(b).getSource(),j=new X_(c).getSource();super({...h,startValue:i,byValue:j.map((a,b)=>a-i[b]),easing:d,onChange:YD(e),onComplete:YD(f),abort:YD(g)})}calculate(a){let[b,c,d,e]=this.startValue.map((b,c)=>this.easing(a,b,this.byValue[c],this.duration,c)),f=[...[b,c,d].map(Math.round),Yp(0,e,1)];return{value:f,valueProgress:f.map((a,b)=>0!==this.byValue[b]?Math.abs((a-this.startValue[b])/this.byValue[b]):0).find(a=>0!==a)||0}}}function YF(a){let b=Array.isArray(a.startValue)||Array.isArray(a.endValue)?new YB(a):new YA(a);return b.start(),b}function YG(a){let b=new YE(a);return b.start(),b}class YH{constructor(a){this.status=a,this.points=[]}includes(a){return this.points.some(b=>b.eq(a))}append(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.points=this.points.concat(b.filter(a=>!this.includes(a))),this}static isPointContained(a,b,c){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b.eq(c))return a.eq(b);if(b.x===c.x)return a.x===b.x&&(d||a.y>=Math.min(b.y,c.y)&&a.y<=Math.max(b.y,c.y));if(b.y===c.y)return a.y===b.y&&(d||a.x>=Math.min(b.x,c.x)&&a.x<=Math.max(b.x,c.x));{let e=XG(b,c),f=XG(b,a).divide(e);return d?Math.abs(f.x)===Math.abs(f.y):f.x===f.y&&f.x>=0&&f.x<=1}}static isPointInPolygon(a,b){let c=new Wv(a).setX(Math.min(a.x-1,...b.map(a=>a.x))),d=0;for(let e=0;e<b.length;e++){let f=this.intersectSegmentSegment(b[e],b[(e+1)%b.length],a,c);if(f.includes(a))return!0;d+=Number("Intersection"===f.status)}return d%2==1}static intersectLineLine(a,b,c,d){let e=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=b.x-a.x,h=b.y-a.y,i=d.x-c.x,j=d.y-c.y,k=a.x-c.x,l=a.y-c.y,m=i*l-j*k,n=g*l-h*k,o=j*g-i*h;if(0!==o){let b=m/o,c=n/o;return(e||0<=b&&b<=1)&&(f||0<=c&&c<=1)?new YH("Intersection").append(new Wv(a.x+b*g,a.y+b*h)):new YH}if(0===m||0===n){let g=e||f||YH.isPointContained(a,c,d)||YH.isPointContained(b,c,d)||YH.isPointContained(c,a,b)||YH.isPointContained(d,a,b);return new YH(g?"Coincident":void 0)}return new YH("Parallel")}static intersectSegmentLine(a,b,c,d){return YH.intersectLineLine(a,b,c,d,!1,!0)}static intersectSegmentSegment(a,b,c,d){return YH.intersectLineLine(a,b,c,d,!1,!1)}static intersectLinePolygon(a,b,c){let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],e=new YH,f=c.length;for(let g,h,i,j=0;j<f;j++){if(g=c[j],h=c[(j+1)%f],"Coincident"===(i=YH.intersectLineLine(a,b,g,h,d,!1)).status)return i;e.append(...i.points)}return e.points.length>0&&(e.status="Intersection"),e}static intersectSegmentPolygon(a,b,c){return YH.intersectLinePolygon(a,b,c,!1)}static intersectPolygonPolygon(a,b){let c=new YH,d=a.length,e=[];for(let f=0;f<d;f++){let g=a[f],h=a[(f+1)%d],i=YH.intersectSegmentPolygon(g,h,b);"Coincident"===i.status?(e.push(i),c.append(g,h)):c.append(...i.points)}return e.length>0&&e.length===a.length?new YH("Coincident"):(c.points.length>0&&(c.status="Intersection"),c)}static intersectPolygonRectangle(a,b,c){let d=b.min(c),e=b.max(c),f=new Wv(e.x,d.y),g=new Wv(d.x,e.y);return YH.intersectPolygonPolygon(a,[d,f,e,g])}}class YI extends Wz{getX(){return this.getXY().x}setX(a){this.setXY(this.getXY().setX(a))}getY(){return this.getXY().y}setY(a){this.setXY(this.getXY().setY(a))}getRelativeX(){return this.left}setRelativeX(a){this.left=a}getRelativeY(){return this.top}setRelativeY(a){this.top=a}getXY(){let a=this.getRelativeXY();return this.group?WM(a,this.group.calcTransformMatrix()):a}setXY(a,b,c){this.group&&(a=WM(a,WN(this.group.calcTransformMatrix()))),this.setRelativeXY(a,b,c)}getRelativeXY(){return new Wv(this.left,this.top)}setRelativeXY(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(a,b,c)}isStrokeAccountedForInDimensions(){return!1}getCoords(){let{tl:a,tr:b,br:c,bl:d}=this.aCoords||(this.aCoords=this.calcACoords()),e=[a,b,c,d];if(this.group){let a=this.group.calcTransformMatrix();return e.map(b=>WM(b,a))}return e}intersectsWithRect(a,b){return"Intersection"===YH.intersectPolygonRectangle(this.getCoords(),a,b).status}intersectsWithObject(a){let b=YH.intersectPolygonPolygon(this.getCoords(),a.getCoords());return"Intersection"===b.status||"Coincident"===b.status||a.isContainedWithinObject(this)||this.isContainedWithinObject(a)}isContainedWithinObject(a){return this.getCoords().every(b=>a.containsPoint(b))}isContainedWithinRect(a,b){let{left:c,top:d,width:e,height:f}=this.getBoundingRect();return c>=a.x&&c+e<=b.x&&d>=a.y&&d+f<=b.y}isOverlapping(a){return this.intersectsWithObject(a)||this.isContainedWithinObject(a)||a.isContainedWithinObject(this)}containsPoint(a){return YH.isPointInPolygon(a,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;let{tl:a,br:b}=this.canvas.vptCoords;return!!this.getCoords().some(c=>c.x<=b.x&&c.x>=a.x&&c.y<=b.y&&c.y>=a.y)||!!this.intersectsWithRect(a,b)||this.containsPoint(a.midPointFrom(b))}isPartiallyOnScreen(){if(!this.canvas)return!1;let{tl:a,br:b}=this.canvas.vptCoords;return!!this.intersectsWithRect(a,b)||this.getCoords().every(c=>(c.x>=b.x||c.x<=a.x)&&(c.y>=b.y||c.y<=a.y))&&this.containsPoint(a.midPointFrom(b))}getBoundingRect(){return Xr(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(a){this._set(Wg,a),this._set(Wh,a),this.setCoords()}scaleToWidth(a){let b=this.getBoundingRect().width/this.getScaledWidth();return this.scale(a/this.width/b)}scaleToHeight(a){let b=this.getBoundingRect().height/this.getScaledHeight();return this.scale(a/this.height/b)}getCanvasRetinaScaling(){var a;return(null==(a=this.canvas)?void 0:a.getRetinaScaling())||1}getTotalAngle(){return this.group?WK(WQ(this.calcTransformMatrix())):this.angle}getViewportTransform(){var a;return(null==(a=this.canvas)?void 0:a.viewportTransform)||V0.concat()}calcACoords(){let a=WT({angle:this.angle}),{x:b,y:c}=this.getRelativeCenterPoint(),d=WO(WS(b,c),a),e=this._getTransformedDimensions(),f=e.x/2,g=e.y/2;return{tl:WM({x:-f,y:-g},d),tr:WM({x:f,y:-g},d),bl:WM({x:-f,y:g},d),br:WM({x:f,y:g},d)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=[];return!a&&this.group&&(b=this.group.transformMatrixKey(a)),b.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,XC(this.originX),XC(this.originY)),b}calcTransformMatrix(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=this.calcOwnMatrix();if(a||!this.group)return b;let c=this.transformMatrixKey(a),d=this.matrixCache;return d&&d.key.every((a,b)=>a===c[b])?d.value:(this.group&&(b=WO(this.group.calcTransformMatrix(!1),b)),this.matrixCache={key:c,value:b},b)}calcOwnMatrix(){let a=this.transformMatrixKey(!0),b=this.ownMatrixCache;if(b&&b.key.every((b,c)=>b===a[c]))return b.value;let c=this.getRelativeCenterPoint(),d=WZ({angle:this.angle,translateX:c.x,translateY:c.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY});return this.ownMatrixCache={key:a,value:d},d}_getNonTransformedDimensions(){return new Wv(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(a){return this._getTransformedDimensions(a).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b={scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth,...a},c=b.strokeWidth,d=c,e=0;this.strokeUniform&&(d=0,e=c);let f=b.width+d,g=b.height+d;return(0===b.skewX&&0===b.skewY?new Wv(f*b.scaleX,g*b.scaleY):Xw(f,g,WY(b))).scalarAdd(e)}translateToGivenOrigin(a,b,c,d,e){let f=a.x,g=a.y,h=XC(d)-XC(b),i=XC(e)-XC(c);if(h||i){let a=this._getTransformedDimensions();f+=h*a.x,g+=i*a.y}return new Wv(f,g)}translateToCenterPoint(a,b,c){if(b===V1&&c===V1)return a;let d=this.translateToGivenOrigin(a,b,c,V1,V1);return this.angle?d.rotate(WJ(this.angle),a):d}translateToOriginPoint(a,b,c){let d=this.translateToGivenOrigin(a,V1,V1,b,c);return this.angle?d.rotate(WJ(this.angle),a):d}getCenterPoint(){let a=this.getRelativeCenterPoint();return this.group?WM(a,this.group.calcTransformMatrix()):a}getRelativeCenterPoint(){return this.translateToCenterPoint(new Wv(this.left,this.top),this.originX,this.originY)}getPointByOrigin(a,b){return this.getPositionByOrigin(a,b)}getPositionByOrigin(a,b){return this.translateToOriginPoint(this.getRelativeCenterPoint(),a,b)}setPositionByOrigin(a,b,c){let d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set({left:e.x,top:e.y})}_getLeftTopCoords(){return this.getPositionByOrigin(V2,"top")}positionByLeftTop(a){return this.setPositionByOrigin(a,V2,"top")}}let YJ=class a extends YI{static getDefaults(){return a.ownDefaults}get type(){let a=this.constructor.type;return"FabricObject"===a?"object":a.toLowerCase()}set type(a){VN("warn","Setting type has no effect",a)}constructor(b){super(),VK(this,"_cacheContext",null),Object.assign(this,a.ownDefaults),this.setOptions(b)}_createCacheCanvas(){this._cacheCanvas=WE(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(a){let b=a.width,c=a.height,d=VM.maxCacheSideLimit,e=VM.minCacheSideLimit;if(b<=d&&c<=d&&b*c<=VM.perfLimitSizeTotal)return b<e&&(a.width=e),c<e&&(a.height=e),a;let[f,g]=VV.limitDimsByArea(b/c),h=Yp(e,f,d),i=Yp(e,g,d);return b>h&&(a.zoomX/=b/h,a.width=h,a.capped=!0),c>i&&(a.zoomY/=c/i,a.height=i,a.capped=!0),a}_getCacheCanvasDimensions(){let a=this.getTotalObjectScaling(),b=this._getTransformedDimensions({skewX:0,skewY:0}),c=b.x*a.x/this.scaleX,d=b.y*a.y/this.scaleY;return{width:Math.ceil(c+2),height:Math.ceil(d+2),zoomX:a.x,zoomY:a.y,x:c,y:d}}_updateCacheCanvas(){let a=this._cacheCanvas,b=this._cacheContext,{width:c,height:d,zoomX:e,zoomY:f,x:g,y:h}=this._limitCacheSize(this._getCacheCanvasDimensions()),i=c!==a.width||d!==a.height,j=this.zoomX!==e||this.zoomY!==f;if(!a||!b)return!1;if(i||j){c!==a.width||d!==a.height?(a.width=c,a.height=d):(b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,a.width,a.height));let i=g/2,j=h/2;return this.cacheTranslationX=Math.round(a.width/2-i)+i,this.cacheTranslationY=Math.round(a.height/2-j)+j,b.translate(this.cacheTranslationX,this.cacheTranslationY),b.scale(e,f),this.zoomX=e,this.zoomY=f,!0}return!1}setOptions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(a)}transform(a){let b=this.group&&!this.group._transformDone||this.group&&this.canvas&&a===this.canvas.contextTop,c=this.calcTransformMatrix(!b);a.transform(c[0],c[1],c[2],c[3],c[4],c[5])}getObjectScaling(){if(!this.group)return new Wv(Math.abs(this.scaleX),Math.abs(this.scaleY));let a=WR(this.calcTransformMatrix());return new Wv(Math.abs(a.scaleX),Math.abs(a.scaleY))}getTotalObjectScaling(){let a=this.getObjectScaling();if(this.canvas){let b=this.canvas.getZoom(),c=this.getCanvasRetinaScaling();return a.scalarMultiply(b*c)}return a}getObjectOpacity(){let a=this.opacity;return this.group&&(a*=this.group.getObjectOpacity()),a}_constrainScale(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:0===a?1e-4:a}_set(a,b){a!==Wg&&a!==Wh||(b=this._constrainScale(b)),a===Wg&&b<0?(this.flipX=!this.flipX,b*=-1):"scaleY"===a&&b<0?(this.flipY=!this.flipY,b*=-1):"shadow"!==a||!b||b instanceof Yo||(b=new Yo(b));let c=this[a]!==b;return this[a]=b,c&&this.constructor.cacheProperties.includes(a)&&(this.dirty=!0),this.parent&&(this.dirty||c&&this.constructor.stateProperties.includes(a))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(a){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.drawObject(a,!1,{}),this.dirty=!1),a.restore())}drawSelectionBackground(a){}renderCache(a){if(a=a||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){let{zoomX:b,zoomY:c,cacheTranslationX:d,cacheTranslationY:e}=this,{width:f,height:g}=this._cacheCanvas;this.drawObject(this._cacheContext,a.forClipping,{zoomX:b,zoomY:c,cacheTranslationX:d,cacheTranslationY:e,width:f,height:g,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return!!this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return!!this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===Wl&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(a,b,c){a.save(),b.inverted?a.globalCompositeOperation="destination-out":a.globalCompositeOperation="destination-in",a.setTransform(1,0,0,1,0,0),a.drawImage(c,0,0),a.restore()}drawObject(a,b,c){let d=this.fill,e=this.stroke;b?(this.fill="black",this.stroke="",this._setClippingProperties(a)):this._renderBackground(a),this.fire("before:render",{ctx:a}),this._render(a),this._drawClipPath(a,this.clipPath,c),this.fill=d,this.stroke=e}createClipPathLayer(a,b){let c=WG(b),d=c.getContext("2d");if(d.translate(b.cacheTranslationX,b.cacheTranslationY),d.scale(b.zoomX,b.zoomY),a._cacheCanvas=c,b.parentClipPaths.forEach(a=>{a.transform(d)}),b.parentClipPaths.push(a),a.absolutePositioned){let a=WN(this.calcTransformMatrix());d.transform(a[0],a[1],a[2],a[3],a[4],a[5])}return a.transform(d),a.drawObject(d,!0,b),c}_drawClipPath(a,b,c){if(!b)return;b._transformDone=!0;let d=this.createClipPathLayer(b,c);this.drawClipPathOnCache(a,b,d)}drawCacheOnCanvas(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;let b=this._cacheCanvas,c=this._cacheContext;return!(!b||!c||a||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(b&&c&&!a&&(c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,b.width,b.height),c.restore()),!0)}_renderBackground(a){if(!this.backgroundColor)return;let b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}_setOpacity(a){this.group&&!this.group._transformDone?a.globalAlpha=this.getObjectOpacity():a.globalAlpha*=this.opacity}_setStrokeStyles(a,b){let c=b.stroke;c&&(a.lineWidth=b.strokeWidth,a.lineCap=b.strokeLineCap,a.lineDashOffset=b.strokeDashOffset,a.lineJoin=b.strokeLineJoin,a.miterLimit=b.strokeMiterLimit,W5(c)?"percentage"===c.gradientUnits||c.gradientTransform||c.patternTransform?this._applyPatternForTransformedGradient(a,c):(a.strokeStyle=c.toLive(a),this._applyPatternGradientTransform(a,c)):a.strokeStyle=b.stroke)}_setFillStyles(a,b){let{fill:c}=b;c&&(W5(c)?(a.fillStyle=c.toLive(a),this._applyPatternGradientTransform(a,c)):a.fillStyle=c)}_setClippingProperties(a){a.globalAlpha=1,a.strokeStyle="transparent",a.fillStyle="#000000"}_setLineDash(a,b){b&&0!==b.length&&a.setLineDash(b)}_setShadow(a){if(!this.shadow)return;let b=this.shadow,c=this.canvas,d=this.getCanvasRetinaScaling(),[e,,,f]=(null==c?void 0:c.viewportTransform)||V0,g=e*d,h=f*d,i=b.nonScaling?new Wv(1,1):this.getObjectScaling();a.shadowColor=b.color,a.shadowBlur=b.blur*VM.browserShadowBlurConstant*(g+h)*(i.x+i.y)/4,a.shadowOffsetX=b.offsetX*g*i.x,a.shadowOffsetY=b.offsetY*h*i.y}_removeShadow(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)}_applyPatternGradientTransform(a,b){if(!W5(b))return{offsetX:0,offsetY:0};let c=b.gradientTransform||b.patternTransform,d=-this.width/2+b.offsetX||0,e=-this.height/2+b.offsetY||0;return"percentage"===b.gradientUnits?a.transform(this.width,0,0,this.height,d,e):a.transform(1,0,0,1,d,e),c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),{offsetX:d,offsetY:e}}_renderPaintInOrder(a){this.paintFirst===Wl?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))}_render(a){}_renderFill(a){this.fill&&(a.save(),this._setFillStyles(a,this),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())}_renderStroke(a){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeUniform){let b=this.getObjectScaling();a.scale(1/b.x,1/b.y)}this._setLineDash(a,this.strokeDashArray),this._setStrokeStyles(a,this),a.stroke(),a.restore()}}_applyPatternForTransformedGradient(a,b){var c;let d=this._limitCacheSize(this._getCacheCanvasDimensions()),e=this.getCanvasRetinaScaling(),f=d.x/this.scaleX/e,g=d.y/this.scaleY/e,h=WG({width:Math.ceil(f),height:Math.ceil(g)}),i=h.getContext("2d");i&&(i.beginPath(),i.moveTo(0,0),i.lineTo(f,0),i.lineTo(f,g),i.lineTo(0,g),i.closePath(),i.translate(f/2,g/2),i.scale(d.zoomX/this.scaleX/e,d.zoomY/this.scaleY/e),this._applyPatternGradientTransform(i,b),i.fillStyle=b.toLive(a),i.fill(),a.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),a.scale(e*this.scaleX/d.zoomX,e*this.scaleY/d.zoomY),a.strokeStyle=null!=(c=i.createPattern(h,"no-repeat"))?c:"")}_findCenterFromElement(){return new Wv(this.left+this.width/2,this.top+this.height/2)}clone(a){let b=this.toObject(a);return this.constructor.fromObject(b)}cloneAsImage(a){let b=this.toCanvasElement(a);return new(Wp.getClass("image"))(b)}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=Xv(this),c=this.group,d=this.shadow,e=Math.abs,f=a.enableRetinaScaling?VU():1,g=(a.multiplier||1)*f,h=a.canvasProvider||(a=>new Xm(a,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,a.withoutTransform&&Xu(this),a.withoutShadow&&(this.shadow=null),a.viewportTransform&&XA(this,this.getViewportTransform()),this.setCoords();let i=WE(),j=this.getBoundingRect(),k=this.shadow,l=new Wv;if(k){let a=k.blur,b=k.nonScaling?new Wv(1,1):this.getObjectScaling();l.x=2*Math.round(e(k.offsetX)+a)*e(b.x),l.y=2*Math.round(e(k.offsetY)+a)*e(b.y)}let m=j.width+l.x,n=j.height+l.y;i.width=Math.ceil(m),i.height=Math.ceil(n);let o=h(i);"jpeg"===a.format&&(o.backgroundColor="#fff"),this.setPositionByOrigin(new Wv(o.width/2,o.height/2),V1,V1);let p=this.canvas;o._objects=[this],this.set("canvas",o),this.setCoords();let q=o.toCanvasElement(g||1,a);return this.set("canvas",p),this.shadow=d,c&&(this.group=c),this.set(b),this.setCoords(),o._objects=[],o.destroy(),q}toDataURL(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return WH(this.toCanvasElement(a),a.format||"png",a.quality||1)}toBlob(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return WI(this.toCanvasElement(a),a.format||"png",a.quality||1)}isType(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.includes(this.constructor.type)||b.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(a){let{centeredRotation:b,originX:c,originY:d}=this;if(b){let{x:a,y:b}=this.getRelativeCenterPoint();this.originX=V1,this.originY=V1,this.left=a,this.top=b}if(this.set("angle",a),b){let{x:a,y:b}=this.getPositionByOrigin(c,d);this.left=a,this.top=b,this.originX=c,this.originY=d}}setOnGroup(){}_setupCompositeOperation(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Wq.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&VT().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(a,b){return Object.entries(a).reduce((a,c)=>{let[d,e]=c;return a[d]=this._animate(d,e,b),a},{})}_animate(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=a.split("."),e=this.constructor.colorProperties.includes(d[d.length-1]),{abort:f,startValue:g,onChange:h,onComplete:i}=c,j={...c,target:this,startValue:null!=g?g:d.reduce((a,b)=>a[b],this),endValue:b,abort:null==f?void 0:f.bind(this),onChange:(a,b,c)=>{d.reduce((b,c,e)=>(e===d.length-1&&(b[c]=a),b[c]),this),h&&h(a,b,c)},onComplete:(a,b,c)=>{this.setCoords(),i&&i(a,b,c)}};return e?YG(j):YF(j)}isDescendantOf(a){let{parent:b,group:c}=this;return b===a||c===a||!!b&&b.isDescendantOf(a)||!!c&&c!==b&&c.isDescendantOf(a)}getAncestors(){let a=[],b=this;do(b=b.parent)&&a.push(b);while(b)return a}findCommonAncestors(a){if(this===a)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};let b=this.getAncestors(),c=a.getAncestors();if(0===b.length&&c.length>0&&this===c[c.length-1])return{fork:[],otherFork:[a,...c.slice(0,c.length-1)],common:[this]};for(let d,e=0;e<b.length;e++){if((d=b[e])===a)return{fork:[this,...b.slice(0,e)],otherFork:[],common:b.slice(e)};for(let f=0;f<c.length;f++){if(this===c[f])return{fork:[],otherFork:[a,...c.slice(0,f)],common:[this,...b]};if(d===c[f])return{fork:[this,...b.slice(0,e)],otherFork:[a,...c.slice(0,f)],common:b.slice(e)}}}return{fork:[this,...b],otherFork:[a,...c],common:[]}}hasCommonAncestors(a){let b=this.findCommonAncestors(a);return b&&!!b.common.length}isInFrontOf(a){if(this===a)return;let b=this.findCommonAncestors(a);if(b.fork.includes(a))return!0;if(b.otherFork.includes(this))return!1;let c=b.common[0]||this.canvas;if(!c)return;let d=b.fork.pop(),e=b.otherFork.pop(),f=c._objects.indexOf(d),g=c._objects.indexOf(e);return f>-1&&f>g}toObject(){let b,c=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(a.customProperties,this.constructor.customProperties||[]),d=VM.NUM_FRACTION_DIGITS,{clipPath:e,fill:f,stroke:g,shadow:h,strokeDashArray:i,left:j,top:k,originX:l,originY:m,width:n,height:o,strokeWidth:p,strokeLineCap:q,strokeDashOffset:r,strokeLineJoin:s,strokeUniform:t,strokeMiterLimit:u,scaleX:v,scaleY:w,angle:y,flipX:z,flipY:A,opacity:B,visible:C,backgroundColor:D,fillRule:E,paintFirst:F,globalCompositeOperation:G,skewX:H,skewY:I}=this;e&&!e.excludeFromExport&&(b=e.toObject(c.concat("inverted","absolutePositioned")));let J={...W1(this,c),type:this.constructor.type,version:VW,originX:l,originY:m,left:W3(j,d),top:W3(k,d),width:W3(n,d),height:W3(o,d),fill:W6(f)?f.toObject():f,stroke:W6(g)?g.toObject():g,strokeWidth:W3(p,d),strokeDashArray:i?i.concat():i,strokeLineCap:q,strokeDashOffset:r,strokeLineJoin:s,strokeUniform:t,strokeMiterLimit:W3(u,d),scaleX:W3(v,d),scaleY:W3(w,d),angle:W3(y,d),flipX:z,flipY:A,opacity:W3(B,d),shadow:h?h.toObject():h,visible:C,backgroundColor:D,fillRule:E,paintFirst:F,globalCompositeOperation:G,skewX:W3(H,d),skewY:W3(I,d),...b?{clipPath:b}:null};return this.includeDefaultValues?J:this._removeDefaultValues(J)}toDatalessObject(a){return this.toObject(a)}_removeDefaultValues(a){let b=this.constructor.getDefaults(),c=Object.keys(b).length>0?b:Object.getPrototypeOf(this);return W2(a,(a,b)=>{if(b===V2||"top"===b||"type"===b)return!0;let d=c[b];return a!==d&&!(Array.isArray(a)&&Array.isArray(d)&&0===a.length&&0===d.length)})}toString(){return`#<${this.constructor.type}>`}static _fromObject(a){let{type:b,...c}=a,{extraParam:d,...e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return W0(c,e).then(a=>d?(delete a[d],new this(c[d],a)):new this(a))}static fromObject(a,b){return this._fromObject(a,b)}};VK(YJ,"stateProperties",Yq),VK(YJ,"cacheProperties",Yr),VK(YJ,"ownDefaults",{top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:V1,originY:V1,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:Wk,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0}),VK(YJ,"type","FabricObject"),VK(YJ,"colorProperties",[Wk,Wl,"backgroundColor"]),VK(YJ,"customProperties",[]),Wp.setClass(YJ),Wp.setClass(YJ,"object");let YK=(a,b)=>{var c;let{transform:{target:d}}=b;null==(c=d.canvas)||c.fire(`object:${a}`,{...b,target:d}),d.fire(a,b)},YL=(a,b,c)=>(d,e,f,g)=>{let h=b(d,e,f,g);return h&&YK(a,{...XS(d,e,f,g),...c}),h};function YM(a){return(b,c,d,e)=>{let{target:f,originX:g,originY:h}=c,i=f.getPositionByOrigin(g,h),j=a(b,c,d,e);return f.setPositionByOrigin(i,c.originX,c.originY),j}}let YN=(a,b,c,d)=>(e,f,g,h)=>{let i=XU(f,f.originX,f.originY,g,h)[c],j=XC(f[b]);if(0===j||j>0&&i<0||j<0&&i>0){let{target:b}=f,c=b.strokeWidth/(b.strokeUniform?b[d]:1),e=XQ(f)?2:1,g=b[a],h=Math.abs(i*e/b[d])-c;return b.set(a,Math.max(h,1)),g!==b[a]}return!1},YO=YN("width","originX","x","scaleX"),YP=YN("height","originY","y","scaleY"),YQ=YL(Wc,YM(YO)),YR=YL(Wc,YM(YP));function YS(a,b,c,d,e){a.save();let{stroke:f,xSize:g,ySize:h,opName:i}=this.commonRenderProps(a,b,c,e,d),j=g;g>h?a.scale(1,h/g):h>g&&(j=h,a.scale(g/h,1)),a.beginPath(),a.arc(0,0,j/2,0,V$,!1),a[i](),f&&a.stroke(),a.restore()}function YT(a,b,c,d,e){a.save();let{stroke:f,xSize:g,ySize:h,opName:i}=this.commonRenderProps(a,b,c,e,d),j=g/2,k=h/2;a[`${i}Rect`](-j,-k,g,h),f&&a.strokeRect(-j,-k,g,h),a.restore()}class YU{constructor(a){VK(this,"visible",!0),VK(this,"actionName",Wf),VK(this,"angle",0),VK(this,"x",0),VK(this,"y",0),VK(this,"offsetX",0),VK(this,"offsetY",0),VK(this,"sizeX",0),VK(this,"sizeY",0),VK(this,"touchSizeX",0),VK(this,"touchSizeY",0),VK(this,"cursorStyle","crosshair"),VK(this,"withConnection",!1),Object.assign(this,a)}getTransformAnchorPoint(){var a;return null!=(a=this.transformAnchorPoint)?a:new Wv(.5-this.x,.5-this.y)}shouldActivate(a,b,c,d){var e;let{tl:f,tr:g,br:h,bl:i}=d;return(null==(e=b.canvas)?void 0:e.getActiveObject())===b&&b.isControlVisible(a)&&YH.isPointInPolygon(c,[f,g,h,i])}getActionHandler(a,b,c){return this.actionHandler}getMouseDownHandler(a,b,c){return this.mouseDownHandler}getMouseUpHandler(a,b,c){return this.mouseUpHandler}cursorStyleHandler(a,b,c,d){return b.cursorStyle}getActionName(a,b,c){return b.actionName}getVisibility(a,b){var c,d;return null!=(c=null==(d=a._controlsVisibility)?void 0:d[b])?c:this.visible}setVisibility(a,b,c){this.visible=a}positionHandler(a,b,c,d){return new Wv(this.x*a.x+this.offsetX,this.y*a.y+this.offsetY).transform(b)}calcCornerCoords(a,b,c,d,e,f){let g=WP([WS(c,d),WT({angle:a}),WU((e?this.touchSizeX:this.sizeX)||b,(e?this.touchSizeY:this.sizeY)||b)]);return{tl:new Wv(-.5,-.5).transform(g),tr:new Wv(.5,-.5).transform(g),br:new Wv(.5,.5).transform(g),bl:new Wv(-.5,.5).transform(g)}}commonRenderProps(a,b,c,d){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{cornerSize:f,cornerColor:g,transparentCorners:h,cornerStrokeColor:i}=e,j=f||d.cornerSize,k=this.sizeX||j,l=this.sizeY||j,m=void 0!==h?h:d.transparentCorners,n=m?Wl:Wk,o=i||d.cornerStrokeColor;return a.fillStyle=g||d.cornerColor||"",a.strokeStyle=o||"",a.translate(b,c),a.rotate(WJ(d.getTotalAngle())),{stroke:!m&&!!o,xSize:k,ySize:l,transparentCorners:m,opName:n}}render(a,b,c,d,e){"circle"===((d=d||{}).cornerStyle||e.cornerStyle)?YS.call(this,a,b,c,d,e):YT.call(this,a,b,c,d,e)}}let YV=(a,b,c)=>c.lockRotation?XP:b.cursorStyle,YW=YL(V9,YM((a,b,c,d)=>{let{target:e,ex:f,ey:g,theta:h,originX:i,originY:j}=b,k=e.getPositionByOrigin(i,j);if(XR(e,"lockRotation"))return!1;let l=Math.atan2(g-k.y,f-k.x),m=WK(Math.atan2(d-k.y,c-k.x)-l+h);if(e.snapAngle&&e.snapAngle>0){let a=e.snapAngle,b=e.snapThreshold||a,c=Math.ceil(m/a)*a,d=Math.floor(m/a)*a;Math.abs(m-d)<b?m=d:Math.abs(m-c)<b&&(m=c)}m<0&&(m=360+m),m%=360;let n=e.angle!==m;return e.angle=m,n}));function YX(a,b){let c=b.canvas,d=a[c.uniScaleKey];return c.uniformScaling&&!d||!c.uniformScaling&&d}function YY(a,b,c){let d=XR(a,"lockScalingX"),e=XR(a,"lockScalingY");if(d&&e||!b&&(d||e)&&c||d&&"x"===b||e&&"y"===b)return!0;let{width:f,height:g,strokeWidth:h}=a;return 0===f&&0===h&&"y"!==b||0===g&&0===h&&"x"!==b}let YZ=["e","se","s","sw","w","nw","n","ne","e"],Y$=(a,b,c,d)=>{let e=YX(a,c);if(YY(c,0!==b.x&&0===b.y?"x":0===b.x&&0!==b.y?"y":"",e))return XP;let f=XT(c,0,d);return`${YZ[f]}-resize`};function Y_(a,b,c,d){let e,f,g,h,i,j,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=b.target,m=k.by,n=YX(a,l);if(YY(l,m,n))return!1;if(b.gestureScale)f=b.scaleX*b.gestureScale,g=b.scaleY*b.gestureScale;else{if(e=XU(b,b.originX,b.originY,c,d),i="y"!==m?Math.sign(e.x||b.signX||1):1,j="x"!==m?Math.sign(e.y||b.signY||1):1,b.signX||(b.signX=i),b.signY||(b.signY=j),XR(l,"lockScalingFlip")&&(b.signX!==i||b.signY!==j))return!1;if(h=l._getTransformedDimensions(),n&&!m){let a=Math.abs(e.x)+Math.abs(e.y),{original:c}=b,d=a/(Math.abs(h.x*c.scaleX/l.scaleX)+Math.abs(h.y*c.scaleY/l.scaleY));f=c.scaleX*d,g=c.scaleY*d}else f=Math.abs(e.x*l.scaleX/h.x),g=Math.abs(e.y*l.scaleY/h.y);XQ(b)&&(f*=2,g*=2),b.signX!==i&&"y"!==m&&(b.originX=.5-XC(b.originX),f*=-1,b.signX=i),b.signY!==j&&"x"!==m&&(b.originY=.5-XC(b.originY),g*=-1,b.signY=j)}let o=l.scaleX,p=l.scaleY;return m?("x"===m&&l.set(Wg,f),"y"===m&&l.set(Wh,g)):(XR(l,"lockScalingX")||l.set(Wg,f),XR(l,"lockScalingY")||l.set(Wh,g)),o!==l.scaleX||p!==l.scaleY}let Y0=YL(V8,YM((a,b,c,d)=>Y_(a,b,c,d))),Y1=YL(V8,YM((a,b,c,d)=>Y_(a,b,c,d,{by:"x"}))),Y2=YL(V8,YM((a,b,c,d)=>Y_(a,b,c,d,{by:"y"}))),Y3={x:{counterAxis:"y",scale:Wg,skew:Wi,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:Wh,skew:Wj,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Y4=["ns","nesw","ew","nwse"],Y5=(a,b,c,d)=>{if(0!==b.x&&XR(c,"lockSkewingY")||0!==b.y&&XR(c,"lockSkewingX"))return XP;let e=XT(c,0,d)%4;return`${Y4[e]}-resize`};function Y6(a,b,c,d,e){let{target:f}=c,{counterAxis:g,origin:h,lockSkewing:i,skew:j,flip:k}=Y3[a];if(XR(f,i))return!1;let{origin:l,flip:m}=Y3[g],n=-Math.sign(XC(c[l])*(f[m]?-1:1))*(f[k]?-1:1),o=-(.5*((0===f[j]&&XU(c,V1,V1,d,e)[a]>0||f[j]>0?1:-1)*n))+.5;return YL(Wb,YM((b,c,d,e)=>(function(a,b,c){let{target:d,ex:e,ey:f,skewingSide:g,...h}=b,{skew:i}=Y3[a],j=c.subtract(new Wv(e,f)).divide(new Wv(d.scaleX,d.scaleY))[a],k=d[i],l=Math.tan(WJ(h[i])),m=WK(Math.atan(2*j*g/Math.max("y"===a?d._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:d._getTransformedDimensions({scaleX:1,scaleY:1}).y,1)+l));d.set(i,m);let n=k!==d[i];if(n&&"y"===a){let{skewX:a,scaleX:b}=d,c=d._getTransformedDimensions({skewY:k}),e=d._getTransformedDimensions(),f=0!==a?c.x/e.x:1;1!==f&&d.set(Wg,f*b)}return n})(a,c,new Wv(d,e))))(b,{...c,[h]:o,skewingSide:n},d,e)}let Y7=(a,b,c,d)=>Y6("x",a,b,c,d),Y8=(a,b,c,d)=>Y6("y",a,b,c,d);function Y9(a,b){return a[b.canvas.altActionKey]}let Za=(a,b,c)=>{let d=Y9(a,c);return 0===b.x?d?Wi:Wh:0===b.y?d?Wj:Wg:""},Zb=(a,b,c,d)=>Y9(a,c)?Y5(0,b,c,d):Y$(a,b,c,d),Zc=(a,b,c,d)=>Y9(a,b.target)?Y8(a,b,c,d):Y1(a,b,c,d),Zd=(a,b,c,d)=>Y9(a,b.target)?Y7(a,b,c,d):Y2(a,b,c,d),Ze=()=>({ml:new YU({x:-.5,y:0,cursorStyleHandler:Zb,actionHandler:Zc,getActionName:Za}),mr:new YU({x:.5,y:0,cursorStyleHandler:Zb,actionHandler:Zc,getActionName:Za}),mb:new YU({x:0,y:.5,cursorStyleHandler:Zb,actionHandler:Zd,getActionName:Za}),mt:new YU({x:0,y:-.5,cursorStyleHandler:Zb,actionHandler:Zd,getActionName:Za}),tl:new YU({x:-.5,y:-.5,cursorStyleHandler:Y$,actionHandler:Y0}),tr:new YU({x:.5,y:-.5,cursorStyleHandler:Y$,actionHandler:Y0}),bl:new YU({x:-.5,y:.5,cursorStyleHandler:Y$,actionHandler:Y0}),br:new YU({x:.5,y:.5,cursorStyleHandler:Y$,actionHandler:Y0}),mtr:new YU({x:0,y:-.5,actionHandler:YW,cursorStyleHandler:YV,offsetY:-40,withConnection:!0,actionName:Wa})}),Zf=()=>({mr:new YU({x:.5,y:0,actionHandler:YQ,cursorStyleHandler:Zb,actionName:Wc}),ml:new YU({x:-.5,y:0,actionHandler:YQ,cursorStyleHandler:Zb,actionName:Wc})}),Zg=()=>({...Ze(),...Zf()});class Zh extends YJ{static getDefaults(){return{...super.getDefaults(),...Zh.ownDefaults}}constructor(a){super(),Object.assign(this,this.constructor.createControls(),Zh.ownDefaults),this.setOptions(a)}static createControls(){return{controls:Ze()}}_updateCacheCanvas(){let a=this.canvas;if(this.noScaleCache&&a&&a._currentTransform){let b=a._currentTransform,c=b.target,d=b.action;if(this===c&&d&&d.startsWith(Wf))return!1}return super._updateCacheCanvas()}getActiveControl(){let a=this.__corner;return a?{key:a,control:this.controls[a],coord:this.oCoords[a]}:void 0}findControl(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;let c=Object.entries(this.oCoords);for(let d=c.length-1;d>=0;d--){let[e,f]=c[d],g=this.controls[e];if(g.shouldActivate(e,this,a,b?f.touchCorner:f.corner))return this.__corner=e,{key:e,control:g,coord:this.oCoords[e]}}}calcOCoords(){let a=this.getViewportTransform(),b=this.getCenterPoint(),c=WO(WS(b.x,b.y),WT({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)})),d=WO(a,c),e=WO(d,[1/a[0],0,0,1/a[3],0,0]),f=this.group?WR(this.calcTransformMatrix()):void 0;f&&(f.scaleX=Math.abs(f.scaleX),f.scaleY=Math.abs(f.scaleY));let g=this._calculateCurrentDimensions(f),h={};return this.forEachControl((a,b)=>{let c=a.positionHandler(g,e,this,a);h[b]=Object.assign(c,this._calcCornerCoords(a,c))}),h}_calcCornerCoords(a,b){let c=this.getTotalAngle();return{corner:a.calcCornerCoords(c,this.cornerSize,b.x,b.y,!1,this),touchCorner:a.calcCornerCoords(c,this.touchCornerSize,b.x,b.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(a){for(let b in this.controls)a(this.controls[b],b,this)}drawSelectionBackground(a){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;a.save();let b=this.getRelativeCenterPoint(),c=this._calculateCurrentDimensions(),d=this.getViewportTransform();a.translate(b.x,b.y),a.scale(1/d[0],1/d[3]),a.rotate(WJ(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-c.x/2,-c.y/2,c.x,c.y),a.restore()}strokeBorders(a,b){a.strokeRect(-b.x/2,-b.y/2,b.x,b.y)}_drawBorders(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d={hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray,...c};a.save(),a.strokeStyle=d.borderColor,this._setLineDash(a,d.borderDashArray),this.strokeBorders(a,b),d.hasControls&&this.drawControlsConnectingLines(a,b),a.restore()}_renderControls(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{hasBorders:c,hasControls:d}=this,e={hasBorders:c,hasControls:d,...b},f=this.getViewportTransform(),g=e.hasBorders,h=e.hasControls,i=WR(WO(f,this.calcTransformMatrix()));a.save(),a.translate(i.translateX,i.translateY),a.lineWidth=this.borderScaleFactor,this.group===this.parent&&(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(i.angle-=180),a.rotate(WJ(this.group?i.angle:this.angle)),g&&this.drawBorders(a,i,b),h&&this.drawControls(a,b),a.restore()}drawBorders(a,b,c){let d;if(c&&c.forActiveSelection||this.group){let a=Xw(this.width,this.height,WY(b)),c=this.isStrokeAccountedForInDimensions()?Ww:(this.strokeUniform?(new Wv).scalarAdd(this.canvas?this.canvas.getZoom():1):new Wv(b.scaleX,b.scaleY)).scalarMultiply(this.strokeWidth);d=a.add(c).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else d=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(a,d,c)}drawControlsConnectingLines(a,b){let c=!1;a.beginPath(),this.forEachControl((d,e)=>{d.withConnection&&d.getVisibility(this,e)&&(c=!0,a.moveTo(d.x*b.x,d.y*b.y),a.lineTo(d.x*b.x+d.offsetX,d.y*b.y+d.offsetY))}),c&&a.stroke()}drawControls(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.save();let c=this.getCanvasRetinaScaling(),{cornerStrokeColor:d,cornerDashArray:e,cornerColor:f}=this,g={cornerStrokeColor:d,cornerDashArray:e,cornerColor:f,...b};a.setTransform(c,0,0,c,0,0),a.strokeStyle=a.fillStyle=g.cornerColor,this.transparentCorners||(a.strokeStyle=g.cornerStrokeColor),this._setLineDash(a,g.cornerDashArray),this.forEachControl((b,c)=>{if(b.getVisibility(this,c)){let d=this.oCoords[c];b.render(a,d.x,d.y,g,this)}}),a.restore()}isControlVisible(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)}setControlVisible(a,b){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=b}setControlsVisibility(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(a).forEach(a=>{let[b,c]=a;return this.setControlVisible(b,c)})}clearContextTop(a){if(!this.canvas)return;let b=this.canvas.contextTop;if(!b)return;let c=this.canvas.viewportTransform;b.save(),b.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(b);let d=this.width+4,e=this.height+4;return b.clearRect(-d/2,-e/2,d,e),a||b.restore(),b}onDeselect(a){return!1}onSelect(a){return!1}shouldStartDragging(a){return!1}onDragStart(a){return!1}canDrop(a){return!1}renderDragSourceEffect(a){}renderDropTargetEffect(a){}}function Zi(a,b){return b.forEach(b=>{Object.getOwnPropertyNames(b.prototype).forEach(c=>{"constructor"!==c&&Object.defineProperty(a.prototype,c,Object.getOwnPropertyDescriptor(b.prototype,c)||Object.create(null))})}),a}VK(Zh,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Zj extends Zh{}Zi(Zj,[X3]),Wp.setClass(Zj),Wp.setClass(Zj,"object");let Zk=(a,b,c,d)=>{let e=2*(d=Math.round(d))+1,{data:f}=a.getImageData(b-d,c-d,e,e);for(let a=3;a<f.length;a+=4)if(f[a]>0)return!1;return!0};class Zl{constructor(a){this.options=a,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Wv(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Wv(1/this.options.scaleX,1/this.options.scaleY):new Wv(1,1)}createSideVector(a,b){let c=XG(a,b);return this.options.strokeUniform?c.multiply(this.scale):c}projectOrthogonally(a,b,c){return this.applySkew(a.add(this.calcOrthogonalProjection(a,b,c)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(a){let b=new Wv(a);return b.y+=b.x*Math.tan(WJ(this.options.skewY)),b.x+=b.y*Math.tan(WJ(this.options.skewX)),b}scaleUnitVector(a,b){return a.multiply(this.strokeUniformScalar).scalarMultiply(b)}}let Zm=new Wv;class Zn extends Zl{static getOrthogonalRotationFactor(a,b){return Math.abs(b?XI(a,b):XJ(a))<VY?-1:1}constructor(a,b,c,d){super(d),VK(this,"AB",void 0),VK(this,"AC",void 0),VK(this,"alpha",void 0),VK(this,"bisector",void 0),this.A=new Wv(a),this.B=new Wv(b),this.C=new Wv(c),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=XI(this.AB,this.AC),this.bisector=XK(XF(this.AB.eq(Zm)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,d=XL(this.createSideVector(a,b)),e=Zn.getOrthogonalRotationFactor(d,this.bisector);return this.scaleUnitVector(d,c*e)}projectBevel(){let a=[];return(this.alpha%V$==0?[this.B]:[this.B,this.C]).forEach(b=>{a.push(this.projectOrthogonally(this.A,b)),a.push(this.projectOrthogonally(this.A,b,-this.strokeProjectionMagnitude))}),a}projectMiter(){let a=[],b=1/Math.sin(Math.abs(this.alpha)/2),c=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*b),d=this.options.strokeUniform?XH(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return XH(c)/this.strokeProjectionMagnitude<=d&&a.push(this.applySkew(this.A.add(c))),a.push(...this.projectBevel()),a}projectRoundNoSkew(a,b){let c=[],d=new Wv(Zn.getOrthogonalRotationFactor(this.bisector),Zn.getOrthogonalRotationFactor(new Wv(this.bisector.y,this.bisector.x)));return[new Wv(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(d),new Wv(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(d)].forEach(d=>{XO(d,a,b)&&c.push(this.A.add(d))}),c}projectRoundWithSkew(a,b){let c=[],{skewX:d,skewY:e,scaleX:f,scaleY:g,strokeUniform:h}=this.options,i=new Wv(Math.tan(WJ(d)),Math.tan(WJ(e))),j=this.strokeProjectionMagnitude,k=h?j/g/Math.sqrt(1/g**2+1/f**2*i.y**2):j/Math.sqrt(1+i.y**2),l=new Wv(Math.sqrt(Math.max(j**2-k**2,0)),k),m=h?j/Math.sqrt(1+i.x**2*(1/g)**2/(1/f+1/f*i.x*i.y)**2):j/Math.sqrt(1+i.x**2/(1+i.x*i.y)**2),n=new Wv(m,Math.sqrt(Math.max(j**2-m**2,0)));return[n,n.scalarMultiply(-1),l,l.scalarMultiply(-1)].map(a=>this.applySkew(h?a.multiply(this.strokeUniformScalar):a)).forEach(d=>{XO(d,a,b)&&c.push(this.applySkew(this.A).add(d))}),c}projectRound(){let a=[];a.push(...this.projectBevel());let b=this.alpha%V$==0,c=this.applySkew(this.A),d=a[2*!b].subtract(c),e=a[+!!b].subtract(c),f=XM(d,b?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)))>0,g=f?d:e,h=f?e:d;return this.isSkewed()?a.push(...this.projectRoundWithSkew(g,h)):a.push(...this.projectRoundNoSkew(g,h)),a}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(a=>({originPoint:this.A,projectedPoint:a,angle:this.alpha,bisector:this.bisector}))}}class Zo extends Zl{constructor(a,b,c){super(c),this.A=new Wv(a),this.T=new Wv(b)}calcOrthogonalProjection(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,d=this.createSideVector(a,b);return this.scaleUnitVector(XL(d),c)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){let a=[];if(!this.isSkewed()&&this.A.eq(this.T)){let b=new Wv(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);a.push(this.applySkew(this.A.add(b)),this.applySkew(this.A.subtract(b)))}else a.push(...new Zn(this.A,this.T,this.T,this.options).projectRound());return a}projectSquare(){let a=[];if(this.A.eq(this.T)){let b=new Wv(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);a.push(this.A.add(b),this.A.subtract(b))}else{let b=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),c=this.scaleUnitVector(XK(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),d=this.A.add(c);a.push(d.add(b),d.subtract(b))}return a.map(a=>this.applySkew(a))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(a=>({originPoint:this.A,projectedPoint:a}))}}let Zp=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[];if(0===a.length)return d;let e=a.reduce((a,b)=>(a[a.length-1].eq(b)||a.push(new Wv(b)),a),[new Wv(a[0])]);if(1===e.length)c=!0;else if(!c){let a=e[0],b=((a,b)=>{for(let c=a.length-1;c>=0;c--)if(b(a[c],c,a))return c;return -1})(e,b=>!b.eq(a));e.splice(b+1)}return e.forEach((a,e,f)=>{let g,h;0===e?(h=f[1],g=c?a:f[f.length-1]):e===f.length-1?(g=f[e-1],h=c?a:f[0]):(g=f[e-1],h=f[e+1]),c&&1===f.length?d.push(...new Zo(a,a,b).project()):c&&(0===e||e===f.length-1)?d.push(...new Zo(a,0===e?h:g,b).project()):d.push(...new Zn(a,g,h,b).project())}),d},Zq=a=>{let b={};return Object.keys(a).forEach(c=>{b[c]={},Object.keys(a[c]).forEach(d=>{b[c][d]={...a[c][d]}})}),b},Zr=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a.fill!==b.fill||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth||a.fontSize!==b.fontSize||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.textDecorationThickness!==b.textDecorationThickness||a.textBackgroundColor!==b.textBackgroundColor||a.deltaY!==b.deltaY||c&&(a.overline!==b.overline||a.underline!==b.underline||a.linethrough!==b.linethrough)},Zs=(a,b)=>{let c=b.split("\n"),d=[],e=-1,f={};a=Zq(a);for(let b=0;b<c.length;b++){let g=Xi(c[b]);if(a[b])for(let c=0;c<g.length;c++){e++;let g=a[b][c];g&&Object.keys(g).length>0&&(Zr(f,g,!0)?d.push({start:e,end:e+1,style:g}):d[d.length-1].end++),f=g||{}}else e+=g.length,f={}}return d},Zt=(a,b)=>{if(!Array.isArray(a))return Zq(a);let c=b.split(V6),d={},e=-1,f=0;for(let b=0;b<c.length;b++){let g=Xi(c[b]);for(let c=0;c<g.length;c++)e++,a[f]&&a[f].start<=e&&e<a[f].end&&(d[b]=d[b]||{},d[b][c]={...a[f].style},e===a[f].end-1&&f++)}return d},Zu=["display","transform",Wk,"fill-opacity","fill-rule","opacity",Wl,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Zv(a,b){let c,d=a.nodeName,e=a.getAttribute("class"),f=a.getAttribute("id"),g="(?![a-zA-Z\\-]+)";if(c=RegExp("^"+d,"i"),b=b.replace(c,""),f&&b.length&&(c=RegExp("#"+f+g,"i"),b=b.replace(c,"")),e&&b.length){let a=e.split(" ");for(let d=a.length;d--;)c=RegExp("\\."+a[d]+g,"i"),b=b.replace(c,"")}return 0===b.length}let Zw=a=>{var b;return null!=(b=Yi[a])?b:a},Zx=RegExp(`(${Yf})`,"gi"),Zy=`(${Yf})`,Zz=String.raw`(skewX)\(${Zy}\)`,ZA=String.raw`(skewY)\(${Zy}\)`,ZB=String.raw`(rotate)\(${Zy}(?: ${Zy} ${Zy})?\)`,ZC=String.raw`(scale)\(${Zy}(?: ${Zy})?\)`,ZD=String.raw`(translate)\(${Zy}(?: ${Zy})?\)`,ZE=`(?:${String.raw`(matrix)\(${Zy} ${Zy} ${Zy} ${Zy} ${Zy} ${Zy}\)`}|${ZD}|${ZB}|${ZC}|${Zz}|${ZA})`,ZF=`(?:${ZE}*)`,ZG=new RegExp(String.raw`^\s*(?:${ZF}?)\s*$`),ZH=new RegExp(ZE),ZI=RegExp(ZE,"g");function ZJ(a){let b=[];if(!(a=a.replace(Zx," $1 ").replace(/,/gi," ").replace(/\s+/g," ").replace(/\s*([()])\s*/gi,"$1"))||a&&!ZG.test(a))return[...V0];for(let c of a.matchAll(ZI)){let a=ZH.exec(c[0]);if(!a)continue;let d=V0,[,e,...f]=a.filter(a=>!!a),[g,h,i,j,k,l]=f.map(a=>parseFloat(a));switch(e){case"translate":d=WS(g,h);break;case Wa:d=WT({angle:g},{x:h,y:i});break;case Wf:d=WU(g,h);break;case Wi:d=WW(g);break;case Wj:d=WX(g);break;case"matrix":d=[g,h,i,j,k,l]}b.push(d)}return WP(b)}let ZK={stroke:"strokeOpacity",fill:"fillOpacity"};function ZL(a,b,c){let d,e,f;if(!a)return{};let g,h={},i=16;a.parentNode&&Yl.test(a.parentNode.nodeName)&&(h=ZL(a.parentElement,b,c)).fontSize&&(g=i=X0(h.fontSize));let j={...b.reduce((b,c)=>{let d=a.getAttribute(c);return d&&(b[c]=d),b},{}),...function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={};for(let d in b)(function(a,b){let c=!0,d=Zv(a,b.pop());return d&&b.length&&(c=function(a,b){let c,d=!0;for(;a.parentElement&&1===a.parentElement.nodeType&&b.length;)d&&(c=b.pop()),d=Zv(a=a.parentElement,c);return 0===b.length}(a,b)),d&&c&&0===b.length})(a,d.split(" "))&&(c={...c,...b[d]});return c}(a,c),...(d={},(e=a.getAttribute("style"))&&("string"==typeof e?e.replace(/;\s*$/,"").split(";").forEach(a=>{if(!a)return;let[b,c]=a.split(":");d[b.trim().toLowerCase()]=c.trim()}):Object.entries(e).forEach(a=>{let[b,c]=a;void 0!==c&&(d[b.toLowerCase()]=c)})),d)};j[Yk]&&a.setAttribute(Yk,j[Yk]),j[Yj]&&(g=X0(j[Yj],i),j[Yj]=`${g}`);let k={};for(let a in j){let b=Zw(a),c=function(a,b,c,d){let e=Array.isArray(b),f,g=b;if(a!==Wk&&a!==Wl||b!==V5){if("strokeUniform"===a)return"non-scaling-stroke"===b;if("strokeDashArray"===a)g=b===V5?null:b.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===a)g=c&&c.transformMatrix?WO(c.transformMatrix,ZJ(b)):ZJ(b);else if("visible"===a)g=b!==V5&&"hidden"!==b,c&&!1===c.visible&&(g=!1);else if("opacity"===a)g=parseFloat(b),c&&void 0!==c.opacity&&(g*=c.opacity);else if("textAnchor"===a)g="start"===b?V2:"end"===b?V4:V1;else if("charSpacing"===a||a===X5)f=X0(b,d)/d*1e3;else if("paintFirst"===a){let a=b.indexOf(Wk),c=b.indexOf(Wl);g=Wk,(a>-1&&c>-1&&c<a||-1===a&&c>-1)&&(g=Wl)}else{if("href"===a||"xlink:href"===a||"font"===a||"id"===a)return b;if("imageSmoothing"===a)return"optimizeQuality"===b;f=e?b.map(X0):X0(b,d)}}else g="";return!e&&isNaN(f)?g:f}(b,j[a],h,g);k[b]=c}k&&k.font&&function(a,b){let c=a.match(Yh);if(!c)return;let d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=X0(f)),h&&(b.fontFamily=h),g&&(b.lineHeight=g===Wn?1:g)}(k.font,k);let l={...h,...k};return Yl.test(a.nodeName)||(f=Zj.getDefaults(),Object.entries(ZK).forEach(a=>{let[b,c]=a;if(void 0===l[c]||""===l[b])return;if(void 0===l[b]){if(!f[b])return;l[b]=f[b]}if(0===l[b].indexOf("url("))return;let d=new X_(l[b]);l[b]=d.setAlpha(W3(d.getAlpha()*l[c],2)).toRgba()})),l}let ZM=["rx","ry"];class ZN extends Zj{static getDefaults(){return{...super.getDefaults(),...ZN.ownDefaults}}constructor(a){super(),Object.assign(this,ZN.ownDefaults),this.setOptions(a),this._initRxRy()}_initRxRy(){let{rx:a,ry:b}=this;a&&!b?this.ry=a:b&&!a&&(this.rx=b)}_render(a){let{width:b,height:c}=this,d=-b/2,e=-c/2,f=this.rx?Math.min(this.rx,b/2):0,g=this.ry?Math.min(this.ry,c/2):0,h=0!==f||0!==g;a.beginPath(),a.moveTo(d+f,e),a.lineTo(d+b-f,e),h&&a.bezierCurveTo(d+b-.4477152502*f,e,d+b,e+.4477152502*g,d+b,e+g),a.lineTo(d+b,e+c-g),h&&a.bezierCurveTo(d+b,e+c-.4477152502*g,d+b-.4477152502*f,e+c,d+b-f,e+c),a.lineTo(d+f,e+c),h&&a.bezierCurveTo(d+.4477152502*f,e+c,d,e+c-.4477152502*g,d,e+c-g),a.lineTo(d,e+g),h&&a.bezierCurveTo(d,e+.4477152502*g,d+.4477152502*f,e,d+f,e),a.closePath(),this._renderPaintInOrder(a)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...ZM,...a])}_toSVG(){let{width:a,height:b,rx:c,ry:d}=this;return["<rect ","COMMON_PARTS",`x="${-a/2}" y="${-b/2}" rx="${Xh(c)}" ry="${Xh(d)}" width="${Xh(a)}" height="${Xh(b)}" />
`]}static async fromElement(a,b,c){let{left:d=0,top:e=0,width:f=0,height:g=0,visible:h=!0,...i}=ZL(a,this.ATTRIBUTE_NAMES,c);return new this({...b,...i,left:d,top:e,width:f,height:g,visible:!!(h&&f&&g)})}}VK(ZN,"type","Rect"),VK(ZN,"cacheProperties",[...Yr,...ZM]),VK(ZN,"ownDefaults",{rx:0,ry:0}),VK(ZN,"ATTRIBUTE_NAMES",[...Zu,"x","y","rx","ry","width","height"]),Wp.setClass(ZN),Wp.setSVGClass(ZN);let ZO="initialization",ZP="added",ZQ="removed",ZR="imperative",ZS=(a,b)=>{let{strokeUniform:c,strokeWidth:d,width:e,height:f,group:g}=b,h=g&&g!==a?Xx(g.calcTransformMatrix(),a.calcTransformMatrix()):null,i=h?b.getRelativeCenterPoint().transform(h):b.getRelativeCenterPoint(),j=!b.isStrokeAccountedForInDimensions(),k=c&&j?Xz(new Wv(d,d),void 0,a.calcTransformMatrix()):Ww,l=!c&&j?d:0,m=Xw(e+l,f+l,WP([h,b.calcOwnMatrix()],!0)).add(k).scalarDivide(2);return[i.subtract(m),i.add(m)]};class ZT{calcLayoutResult(a,b){if(this.shouldPerformLayout(a))return this.calcBoundingBox(b,a)}shouldPerformLayout(a){let{type:b,prevStrategy:c,strategy:d}=a;return b===ZO||b===ZR||!!c&&d!==c}shouldLayoutClipPath(a){let{type:b,target:{clipPath:c}}=a;return b!==ZO&&c&&!c.absolutePositioned}getInitialSize(a,b){return b.size}calcBoundingBox(a,b){let{type:c,target:d}=b;if(c===ZR&&b.overrides)return b.overrides;if(0===a.length)return;let{left:e,top:f,width:g,height:h}=Xr(a.map(a=>ZS(d,a)).reduce((a,b)=>a.concat(b),[])),i=new Wv(g,h),j=new Wv(e,f).add(i.scalarDivide(2));if(c===ZO){let a=this.getInitialSize(b,{size:i,center:j});return{center:j,relativeCorrection:new Wv(0,0),size:a}}return{center:j.transform(d.calcOwnMatrix()),size:i}}}VK(ZT,"type","strategy");class ZU extends ZT{shouldPerformLayout(a){return!0}}VK(ZU,"type","fit-content"),Wp.setClass(ZU);let ZV="layoutManager";class ZW{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ZU;VK(this,"strategy",void 0),this.strategy=a,this._subscriptions=new Map}performLayout(a){let b={bubbles:!0,strategy:this.strategy,...a,prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}};this.onBeforeLayout(b);let c=this.getLayoutResult(b);c&&this.commitLayout(b,c),this.onAfterLayout(b,c),this._prevLayoutStrategy=b.strategy}attachHandlers(a,b){let{target:c}=b;return[Wm,V7,Wc,V9,V8,Wb,We,Wd,"modifyPath"].map(b=>a.on(b,a=>this.performLayout(b===Wm?{type:"object_modified",trigger:b,e:a,target:c}:{type:"object_modifying",trigger:b,e:a,target:c})))}subscribe(a,b){this.unsubscribe(a,b);let c=this.attachHandlers(a,b);this._subscriptions.set(a,c)}unsubscribe(a,b){(this._subscriptions.get(a)||[]).forEach(a=>a()),this._subscriptions.delete(a)}unsubscribeTargets(a){a.targets.forEach(b=>this.unsubscribe(b,a))}subscribeTargets(a){a.targets.forEach(b=>this.subscribe(b,a))}onBeforeLayout(a){let{target:b,type:c}=a,{canvas:d}=b;if(c===ZO||c===ZP?this.subscribeTargets(a):c===ZQ&&this.unsubscribeTargets(a),b.fire("layout:before",{context:a}),d&&d.fire("object:layout:before",{target:b,context:a}),c===ZR&&a.deep){let{strategy:c,...d}=a;b.forEachObject(a=>a.layoutManager&&a.layoutManager.performLayout({...d,bubbles:!1,target:a}))}}getLayoutResult(a){let{target:b,strategy:c,type:d}=a,e=c.calcLayoutResult(a,b.getObjects());if(!e)return;let f=d===ZO?new Wv:b.getRelativeCenterPoint(),{center:g,correction:h=new Wv,relativeCorrection:i=new Wv}=e,j=f.subtract(g).add(h).transform(d===ZO?V0:WN(b.calcOwnMatrix()),!0).add(i);return{result:e,prevCenter:f,nextCenter:g,offset:j}}commitLayout(a,b){var c,d;let{target:e}=a,{result:{size:f},nextCenter:g}=b;(e.set({width:f.x,height:f.y}),this.layoutObjects(a,b),a.type===ZO)?e.set({left:null!=(c=a.x)?c:g.x+f.x*XC(e.originX),top:null!=(d=a.y)?d:g.y+f.y*XC(e.originY)}):(e.setPositionByOrigin(g,V1,V1),e.setCoords(),e.set("dirty",!0))}layoutObjects(a,b){let{target:c}=a;c.forEachObject(d=>{d.group===c&&this.layoutObject(a,b,d)}),a.strategy.shouldLayoutClipPath(a)&&this.layoutObject(a,b,c.clipPath)}layoutObject(a,b,c){let{offset:d}=b;c.set({left:c.left+d.x,top:c.top+d.y})}onAfterLayout(a,b){let{target:c,strategy:d,bubbles:e,prevStrategy:f,...g}=a,{canvas:h}=c;c.fire("layout:after",{context:a,result:b}),h&&h.fire("object:layout:after",{context:a,result:b,target:c});let i=c.parent;e&&null!=i&&i.layoutManager&&((g.path||(g.path=[])).push(c),i.layoutManager.performLayout({...g,target:i})),c.set("dirty",!0)}dispose(){let{_subscriptions:a}=this;a.forEach(a=>a.forEach(a=>a())),a.clear()}toObject(){return{type:ZV,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}Wp.setClass(ZW,ZV);class ZX extends ZW{performLayout(){}}class ZY extends Wy(Zj){static getDefaults(){return{...super.getDefaults(),...ZY.ownDefaults}}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),VK(this,"_activeObjects",[]),VK(this,"__objectSelectionTracker",void 0),VK(this,"__objectSelectionDisposer",void 0),Object.assign(this,ZY.ownDefaults),this.setOptions(b),this.groupInit(a,b)}groupInit(a,b){var c;this._objects=[...a],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(a=>{this.enterGroup(a,!1)}),this.layoutManager=null!=(c=b.layoutManager)?c:new ZW,this.layoutManager.performLayout({type:ZO,target:this,targets:[...a],x:b.left,y:b.top})}canEnterGroup(a){return a===this||this.isDescendantOf(a)?(VN("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(a)||(VN("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(a){return a.filter((a,b,c)=>this.canEnterGroup(a)&&c.indexOf(a)===b)}add(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];let d=this._filterObjectsBeforeEnteringGroup(b),e=super.add(...d);return this._onAfterObjectsChange(ZP,d),e}insertAt(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];let e=this._filterObjectsBeforeEnteringGroup(c),f=super.insertAt(a,...e);return this._onAfterObjectsChange(ZP,e),f}remove(){let a=super.remove(...arguments);return this._onAfterObjectsChange(ZQ,a),a}_onObjectAdded(a){this.enterGroup(a,!0),this.fire("object:added",{target:a}),a.fire("added",{target:this})}_onObjectRemoved(a,b){this.exitGroup(a,b),this.fire("object:removed",{target:a}),a.fire("removed",{target:this})}_onAfterObjectsChange(a,b){this.layoutManager.performLayout({type:a,targets:b,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(a,b){let c=this[a];return super._set(a,b),"canvas"===a&&c!==b&&(this._objects||[]).forEach(c=>{c._set(a,b)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(a,b){let{target:c}=b,d=this._activeObjects;if(a)d.push(c),this._set("dirty",!0);else if(d.length>0){let a=d.indexOf(c);a>-1&&(d.splice(a,1),this._set("dirty",!0))}}_watchObject(a,b){a&&this._watchObject(!1,b),a?(b.on("selected",this.__objectSelectionTracker),b.on("deselected",this.__objectSelectionDisposer)):(b.off("selected",this.__objectSelectionTracker),b.off("deselected",this.__objectSelectionDisposer))}enterGroup(a,b){a.group&&a.group.remove(a),a._set("parent",this),this._enterGroup(a,b)}_enterGroup(a,b){b&&Xt(a,WO(WN(this.calcTransformMatrix()),a.calcTransformMatrix())),this._shouldSetNestedCoords()&&a.setCoords(),a._set("group",this),a._set("canvas",this.canvas),this._watchObject(!0,a);let c=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();c&&(c===a||a.isDescendantOf(c))&&this._activeObjects.push(a)}exitGroup(a,b){this._exitGroup(a,b),a._set("parent",void 0),a._set("canvas",void 0)}_exitGroup(a,b){a._set("group",void 0),b||(Xt(a,WO(this.calcTransformMatrix(),a.calcTransformMatrix())),a.setCoords()),this._watchObject(!1,a);let c=this._activeObjects.length>0?this._activeObjects.indexOf(a):-1;c>-1&&this._activeObjects.splice(c,1)}shouldCache(){let a=Zj.prototype.shouldCache.call(this);if(a){for(let a=0;a<this._objects.length;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return a}willDrawShadow(){if(super.willDrawShadow())return!0;for(let a=0;a<this._objects.length;a++)if(this._objects[a].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(a,b,c){this._renderBackground(a);for(let b=0;b<this._objects.length;b++){var d;let c=this._objects[b];null!=(d=this.canvas)&&d.preserveObjectStacking&&c.group!==this?(a.save(),a.transform(...WN(this.calcTransformMatrix())),c.render(a),a.restore()):c.group===this&&c.render(a)}this._drawClipPath(a,this.clipPath,c)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(a=>a.setCoords())}triggerLayout(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout({target:this,type:ZR,...a})}render(a){this._transformDone=!0,super.render(a),this._transformDone=!1}__serializeObjects(a,b){let c=this.includeDefaultValues;return this._objects.filter(function(a){return!a.excludeFromExport}).map(function(d){let e=d.includeDefaultValues;d.includeDefaultValues=c;let f=d[a||"toObject"](b);return d.includeDefaultValues=e,f})}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this.layoutManager.toObject();return{...super.toObject(["subTargetCheck","interactive",...a]),..."fit-content"!==b.strategy||this.includeDefaultValues?{layoutManager:b}:{},objects:this.__serializeObjects("toObject",a)}}toString(){return`#<Group: (${this.complexity()})>`}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(a=>{this._watchObject(!1,a),a.dispose()}),super.dispose()}_createSVGBgRect(a){if(!this.backgroundColor)return"";let b=ZN.prototype._toSVG.call(this),c=b.indexOf("COMMON_PARTS");b[c]='for="group" ';let d=b.join("");return a?a(d):d}_toSVG(a){let b=["<g ","COMMON_PARTS"," >\n"],c=this._createSVGBgRect(a);c&&b.push("		",c);for(let c=0;c<this._objects.length;c++)b.push("		",this._objects[c].toSVG(a));return b.push("</g>\n"),b}getSvgStyles(){let a=void 0!==this.opacity&&1!==this.opacity?`opacity: ${Xh(this.opacity)};`:"",b=this.visible?"":" visibility: hidden;";return[a,this.getSvgFilter(),b].join("")}toClipPathSVG(a){let b=[],c=this._createSVGBgRect(a);c&&b.push("	",c);for(let c=0;c<this._objects.length;c++)b.push("	",this._objects[c].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(b,{reviver:a})}static fromObject(a,b){let{type:c,objects:d=[],layoutManager:e,...f}=a;return Promise.all([W_(d,b),W0(f,b)]).then(a=>{let[b,c]=a,d=new this(b,{...f,...c,layoutManager:new ZX});return e?d.layoutManager=new(Wp.getClass(e.type))(new(Wp.getClass(e.strategy))):d.layoutManager=new ZW,d.layoutManager.subscribeTargets({type:ZO,target:d,targets:d.getObjects()}),d.setCoords(),d})}}VK(ZY,"type","Group"),VK(ZY,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),Wp.setClass(ZY);let ZZ=(a,b)=>Math.min(b.width/a.width,b.height/a.height),Z$=(a,b)=>Math.max(b.width/a.width,b.height/a.height),Z_="\\s*,?\\s*",Z0=`${Z_}(${Yf})`,Z1=`${Z0}${Z0}${Z0}${Z_}([01])${Z_}([01])${Z0}${Z0}`,Z2={m:"l",M:"L"},Z3=(a,b,c,d,e,f,g,h,i,j,k)=>{let l=Wt(a),m=Wu(a),n=Wt(b),o=Wu(b),p=c*e*n-d*f*o+g,q=d*e*n+c*f*o+h;return["C",j+i*(-c*e*m-d*f*l),k+i*(-d*e*m+c*f*l),p+i*(c*e*o+d*f*n),q+i*(d*e*o-c*f*n),p,q]},Z4=(a,b,c,d)=>{let e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)};function Z5(a,b,c,d,e,f,g,h){let i;if(VM.cachesBoundsOfCurve&&(i=[...arguments].join(),VV.boundsOfCurveCache[i]))return VV.boundsOfCurveCache[i];let j=Math.sqrt,k=Math.abs,l=[],m=[[0,0],[0,0]],n=6*a-12*c+6*e,o=-3*a+9*c-9*e+3*g,p=3*c-3*a;for(let a=0;a<2;++a){if(a>0&&(n=6*b-12*d+6*f,o=-3*b+9*d-9*f+3*h,p=3*d-3*b),1e-12>k(o)){if(1e-12>k(n))continue;let a=-p/n;0<a&&a<1&&l.push(a);continue}let c=n*n-4*p*o;if(c<0)continue;let e=j(c),g=(-n+e)/(2*o);0<g&&g<1&&l.push(g);let i=(-n-e)/(2*o);0<i&&i<1&&l.push(i)}let q=l.length,r=q,s=Z9(a,b,c,d,e,f,g,h);for(;q--;){let{x:a,y:b}=s(l[q]);m[0][q]=a,m[1][q]=b}m[0][r]=a,m[1][r]=b,m[0][r+1]=g,m[1][r+1]=h;let t=[new Wv(Math.min(...m[0]),Math.min(...m[1])),new Wv(Math.max(...m[0]),Math.max(...m[1]))];return VM.cachesBoundsOfCurve&&(VV.boundsOfCurveCache[i]=t),t}let Z6=(a,b,c)=>{let[d,e,f,g,h,i,j,k]=c,l=((a,b,c,d,e,f,g)=>{if(0===c||0===d)return[];let h=0,i=0,j=0,k=Math.PI,l=g*V_,m=Wu(l),n=Wt(l),o=.5*(-n*a-m*b),p=.5*(-n*b+m*a),q=c**2,r=d**2,s=p**2,t=o**2,u=q*r-q*s-r*t,v=Math.abs(c),w=Math.abs(d);if(u<0){let a=Math.sqrt(1-u/(q*r));v*=a,w*=a}else j=(e===f?-1:1)*Math.sqrt(u/(q*s+r*t));let y=j*v*p/w,z=-j*w*o/v,A=n*y-m*z+.5*a,B=m*y+n*z+.5*b,C=Z4(1,0,(o-y)/v,(p-z)/w),D=Z4((o-y)/v,(p-z)/w,(-o-y)/v,(-p-z)/w);0===f&&D>0?D-=2*k:1===f&&D<0&&(D+=2*k);let E=Math.ceil(Math.abs(D/k*2)),F=[],G=D/E,H=8/3*Math.sin(G/4)*Math.sin(G/4)/Math.sin(G/2),I=C+G;for(let a=0;a<E;a++)F[a]=Z3(C,I,n,m,v,w,A,B,H,h,i),h=F[a][5],i=F[a][6],C=I,I+=G;return F})(j-a,k-b,e,f,h,i,g);for(let c=0,d=l.length;c<d;c++)l[c][1]+=a,l[c][2]+=b,l[c][3]+=a,l[c][4]+=b,l[c][5]+=a,l[c][6]+=b;return l},Z7=a=>{let b=0,c=0,d=0,e=0,f=[],g,h=0,i=0;for(let j of a){let a,k=[...j];switch(k[0]){case"l":k[1]+=b,k[2]+=c;case"L":a=["L",b=k[1],c=k[2]];break;case"h":k[1]+=b;case"H":a=["L",b=k[1],c];break;case"v":k[1]+=c;case"V":a=["L",b,c=k[1]];break;case"m":k[1]+=b,k[2]+=c;case"M":b=k[1],c=k[2],d=k[1],e=k[2],a=["M",b,c];break;case"c":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c,k[5]+=b,k[6]+=c;case"C":h=k[3],i=k[4],b=k[5],c=k[6],a=["C",k[1],k[2],h,i,b,c];break;case"s":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c;case"S":"C"===g?(h=2*b-h,i=2*c-i):(h=b,i=c),b=k[3],c=k[4],h=(a=["C",h,i,k[1],k[2],b,c])[3],i=a[4];break;case"q":k[1]+=b,k[2]+=c,k[3]+=b,k[4]+=c;case"Q":h=k[1],i=k[2],a=["Q",h,i,b=k[3],c=k[4]];break;case"t":k[1]+=b,k[2]+=c;case"T":"Q"===g?(h=2*b-h,i=2*c-i):(h=b,i=c),a=["Q",h,i,b=k[1],c=k[2]];break;case"a":k[6]+=b,k[7]+=c;case"A":Z6(b,c,k).forEach(a=>f.push(a)),b=k[6],c=k[7];break;case"z":case"Z":b=d,c=e,a=["Z"]}a?(f.push(a),g=a[0]):g=""}return f},Z8=(a,b,c,d)=>Math.sqrt((c-a)**2+(d-b)**2),Z9=(a,b,c,d,e,f,g,h)=>i=>{let j=i**3,k=3*i**2*(1-i),l=3*i*(1-i)**2,m=(1-i)**3;return new Wv(g*j+e*k+c*l+a*m,h*j+f*k+d*l+b*m)},$a=a=>2*a*(1-a),$b=(a,b,c,d,e,f,g,h)=>i=>{let j=i**2,k=$a(i),l=(1-i)**2;return Math.atan2(3*(l*(d-b)+k*(f-d)+j*(h-f)),3*(l*(c-a)+k*(e-c)+j*(g-e)))},$c=(a,b,c,d,e,f)=>g=>{let h=g**2,i=$a(g),j=(1-g)**2;return new Wv(e*h+c*i+a*j,f*h+d*i+b*j)},$d=(a,b,c,d,e,f)=>g=>{let h=1-g;return Math.atan2(2*(h*(d-b)+g*(f-d)),2*(h*(c-a)+g*(e-c)))},$e=(a,b,c)=>{let d=new Wv(b,c),e=0;for(let b=1;b<=100;b+=1){let c=a(b/100);e+=Z8(d.x,d.y,c.x,c.y),d=c}return e},$f=a=>{let b,c,d=0,e=0,f=0,g=0,h=0,i=[];for(let j of a){let a={x:e,y:f,command:j[0],length:0};switch(j[0]){case"M":(c=a).x=g=e=j[1],c.y=h=f=j[2];break;case"L":(c=a).length=Z8(e,f,j[1],j[2]),e=j[1],f=j[2];break;case"C":b=Z9(e,f,j[1],j[2],j[3],j[4],j[5],j[6]),(c=a).iterator=b,c.angleFinder=$b(e,f,j[1],j[2],j[3],j[4],j[5],j[6]),c.length=$e(b,e,f),e=j[5],f=j[6];break;case"Q":b=$c(e,f,j[1],j[2],j[3],j[4]),(c=a).iterator=b,c.angleFinder=$d(e,f,j[1],j[2],j[3],j[4]),c.length=$e(b,e,f),e=j[3],f=j[4];break;case"Z":(c=a).destX=g,c.destY=h,c.length=Z8(e,f,g,h),e=g,f=h}d+=c.length,i.push(c)}return i.push({length:d,x:e,y:f}),i},$g=function(a,b){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$f(a),d=0;for(;b-c[d].length>0&&d<c.length-2;)b-=c[d].length,d++;let e=c[d],f=b/e.length,g=a[d];switch(e.command){case"M":return{x:e.x,y:e.y,angle:0};case"Z":return{...new Wv(e.x,e.y).lerp(new Wv(e.destX,e.destY),f),angle:Math.atan2(e.destY-e.y,e.destX-e.x)};case"L":return{...new Wv(e.x,e.y).lerp(new Wv(g[1],g[2]),f),angle:Math.atan2(g[2]-e.y,g[1]-e.x)};case"C":case"Q":return((a,b)=>{let c,d=0,e=0,f={x:a.x,y:a.y},g={...f},h=.01,i=0,j=a.iterator,k=a.angleFinder;for(;e<b&&h>1e-4;)g=j(d),i=d,(c=Z8(f.x,f.y,g.x,g.y))+e>b?(d-=h,h/=2):(f=g,d+=h,e+=c);return{...g,angle:k(i)}})(e,b)}},$h=RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),$i=RegExp(Z1,"g"),$j=RegExp(Yf,"gi"),$k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},$l=a=>{var b;let c=[];for(let d of null!=(b=a.match($h))?b:[]){let a=d[0];if("z"===a||"Z"===a){c.push([a]);continue}let b=$k[a.toLowerCase()],e=[];if("a"===a||"A"===a){$i.lastIndex=0;for(let a=null;a=$i.exec(d);)e.push(...a.slice(1))}else e=d.match($j)||[];for(let d=0;d<e.length;d+=b){let f=Array(b),g=Z2[a];f[0]=d>0&&g?g:a;for(let a=0;a<b;a++)f[a+1]=parseFloat(e[d+a]);c.push(f)}}return c},$m=(a,b)=>a.map(a=>a.map((a,c)=>0===c||void 0===b?a:W3(a,b)).join(" ")).join(" ");function $n(a,b){let c=a.style;c&&Object.entries(b).forEach(a=>{let[b,d]=a;return c.setProperty(b,d)})}Object.freeze({__proto__:null,addTransformToObject:Xs,animate:YF,animateColor:YG,applyTransformToObject:Xt,calcAngleBetweenVectors:XI,calcDimensionsMatrix:WY,calcPlaneChangeMatrix:Xx,calcVectorRotation:XJ,cancelAnimFrame:WB,capValue:Yp,composeMatrix:WZ,copyCanvasElement:a=>{var b;let c=WG(a);return null==(b=c.getContext("2d"))||b.drawImage(a,0,0),c},cos:Wt,createCanvasElement:WE,createImage:WF,createRotateMatrix:WT,createScaleMatrix:WU,createSkewXMatrix:WW,createSkewYMatrix:WX,createTranslateMatrix:WS,createVector:XG,crossProduct:XM,degreesToRadians:WJ,dotProduct:XN,ease:Yx,enlivenObjectEnlivables:W0,enlivenObjects:W_,findScaleToCover:Z$,findScaleToFit:ZZ,getBoundsOfCurve:Z5,getOrthonormalVector:XL,getPathSegmentsInfo:$f,getPointOnPath:$g,getPointer:Xo,getRandomInt:(a,b)=>Math.floor(Math.random()*(b-a+1))+a,getRegularPolygonPath:(a,b)=>{let c=2*Math.PI/a,d=-VY;a%2==0&&(d+=c/2);let e=Array(a+1);for(let f=0;f<a;f++){let a=f*c+d,{x:g,y:h}=new Wv(Wt(a),Wu(a)).scalarMultiply(b);e[f]=[0===f?"M":"L",g,h]}return e[a]=["Z"],e},getSmoothPathFromPoints:function(a){let b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=new Wv(a[0]),e=new Wv(a[1]),f=1,g=0,h=[],i=a.length,j=i>2;for(j&&(f=a[2].x<e.x?-1:+(a[2].x!==e.x),g=a[2].y<e.y?-1:+(a[2].y!==e.y)),h.push(["M",d.x-f*c,d.y-g*c]),b=1;b<i;b++){if(!d.eq(e)){let a=d.midPointFrom(e);h.push(["Q",d.x,d.y,a.x,a.y])}d=a[b],b+1<a.length&&(e=a[b+1])}return j&&(f=d.x>a[b-2].x?1:d.x===a[b-2].x?0:-1,g=d.y>a[b-2].y?1:d.y===a[b-2].y?0:-1),h.push(["L",d.x+f*c,d.y+g*c]),h},getSvgAttributes:a=>{let b=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":return b.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return b.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return b.concat(["offset","stop-color","stop-opacity"])}return b},getUnitVector:XK,groupSVGElements:(a,b)=>a&&1===a.length?a[0]:new ZY(a,b),hasStyleChanged:Zr,invertTransform:WN,isBetweenVectors:XO,isIdentityMatrix:WL,isTouchEvent:Xp,isTransparent:Zk,joinPath:$m,loadImage:W$,magnitude:XH,makeBoundingBoxFromPoints:Xr,makePathSimpler:Z7,matrixToSVG:W4,mergeClipPaths:(a,b)=>{var c;let d=a,e=b;d.inverted&&!e.inverted&&(d=b,e=a),XA(e,null==(c=e.group)?void 0:c.calcTransformMatrix(),d.calcTransformMatrix());let f=d.inverted&&e.inverted;return f&&(d.inverted=e.inverted=!1),new ZY([d],{clipPath:e,inverted:f})},multiplyTransformMatrices:WO,multiplyTransformMatrixArray:WP,parsePath:$l,parsePreserveAspectRatioAttribute:X1,parseUnit:X0,pick:W1,projectStrokeOnPoints:Zp,qrDecompose:WR,radiansToDegrees:WK,removeFromArray:Ws,removeTransformFromObject:(a,b)=>{let c=WO(WN(b),a.calcOwnMatrix());Xt(a,c)},removeTransformMatrixForSvgParsing:(a,b)=>{let c=a._findCenterFromElement();a.transformMatrix&&((a=>{if(a.transformMatrix){let{scaleX:b,scaleY:c,angle:d,skewX:e}=WR(a.transformMatrix);a.flipX=!1,a.flipY=!1,a.set(Wg,b),a.set(Wh,c),a.angle=d,a.skewX=e,a.skewY=0}})(a),c=c.transform(a.transformMatrix)),delete a.transformMatrix,b&&(a.scaleX*=b.scaleX,a.scaleY*=b.scaleY,a.cropX=b.cropX,a.cropY=b.cropY,c.x+=b.offsetLeft,c.y+=b.offsetTop,a.width=b.width,a.height=b.height),a.setPositionByOrigin(c,V1,V1)},requestAnimFrame:WA,resetObjectTransform:Xu,rotateVector:XF,saveObjectTransform:Xv,sendObjectToPlane:XA,sendPointToPlane:Xy,sendVectorToPlane:Xz,sin:Wu,sizeAfterTransform:Xw,string:Xl,stylesFromArray:Zt,stylesToArray:Zs,toBlob:WI,toDataURL:WH,toFixed:W3,transformPath:(a,b,c)=>(c&&(b=WO(b,[1,0,0,1,-c.x,-c.y])),a.map(a=>{let c=[...a];for(let d=1;d<a.length-1;d+=2){let{x:e,y:f}=WM({x:a[d],y:a[d+1]},b);c[d]=e,c[d+1]=f}return c})),transformPoint:WM});class $o extends Xf{constructor(a){let{allowTouchScrolling:b=!1,containerClass:c=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(a),VK(this,"upper",void 0),VK(this,"container",void 0);const{el:d}=this.lower,e=this.createUpperCanvas();this.upper={el:e,ctx:e.getContext("2d")},this.applyCanvasStyle(d,{allowTouchScrolling:b}),this.applyCanvasStyle(e,{allowTouchScrolling:b,styles:{position:"absolute",left:"0",top:"0"}});const f=this.createContainerElement();f.classList.add(c),d.parentNode&&d.parentNode.replaceChild(f,d),f.append(d,e),this.container=f}createUpperCanvas(){let{el:a}=this.lower,b=WE();return b.className=a.className,b.classList.remove("lower-canvas"),b.classList.add("upper-canvas"),b.setAttribute("data-fabric","top"),b.style.cssText=a.style.cssText,b.setAttribute("draggable","true"),b}createContainerElement(){let a=VT().document.createElement("div");return a.setAttribute("data-fabric","wrapper"),$n(a,{position:"relative"}),Xe(a),a}applyCanvasStyle(a,b){let{styles:c,allowTouchScrolling:d}=b;$n(a,{...c,"touch-action":d?"manipulation":V5}),Xe(a)}setDimensions(a,b){super.setDimensions(a,b);let{el:c,ctx:d}=this.upper;Xc(c,d,a,b)}setCSSDimensions(a){super.setCSSDimensions(a),Xd(this.upper.el,a),Xd(this.container,a)}cleanupDOM(a){let b=this.container,{el:c}=this.lower,{el:d}=this.upper;super.cleanupDOM(a),b.removeChild(d),b.removeChild(c),b.parentNode&&b.parentNode.replaceChild(c,b)}dispose(){super.dispose(),VT().dispose(this.upper.el),delete this.upper,delete this.container}}let $p=(a,b,c,d)=>{let{target:e,offsetX:f,offsetY:g}=b,h=c-f,i=d-g,j=!XR(e,"lockMovementX")&&e.left!==h,k=!XR(e,"lockMovementY")&&e.top!==i;return j&&e.set(V2,h),k&&e.set("top",i),(j||k)&&YK(V7,XS(a,b,c,d)),j||k},$q=a=>function(b,c,d){let{points:e,pathOffset:f}=d;return new Wv(e[a]).subtract(f).transform(WO(d.getViewportTransform(),d.calcTransformMatrix()))},$r=(a,b,c,d)=>{let{target:e,pointIndex:f}=b,g=Xy(new Wv(c,d),void 0,e.calcOwnMatrix());return e.points[f]=g.add(e.pathOffset),e.setDimensions(),e.set("dirty",!0),!0},$s=(a,b)=>function(c,d,e,f){let g=d.target,h=new Wv(g.points[(a>0?a:g.points.length)-1]),i=h.subtract(g.pathOffset).transform(g.calcOwnMatrix()),j=b(c,{...d,pointIndex:a},e,f),k=h.subtract(g.pathOffset).transform(g.calcOwnMatrix()).subtract(i);return g.left-=k.x,g.top-=k.y,j},$t=a=>YL(Wd,$s(a,$r)),$u=(a,b,c)=>{let{path:d,pathOffset:e}=a,f=d[b];return new Wv(f[c]-e.x,f[c+1]-e.y).transform(WO(a.getViewportTransform(),a.calcTransformMatrix()))};function $v(a,b,c){let{commandIndex:d,pointIndex:e}=this;return $u(c,d,e)}function $w(a,b,c,d){let{target:e}=b,{commandIndex:f,pointIndex:g}=this,h=((a,b,c,d,e)=>{let{path:f,pathOffset:g}=a,h=f[(d>0?d:f.length)-1],i=new Wv(h[e],h[e+1]),j=i.subtract(g).transform(a.calcOwnMatrix()),k=Xy(new Wv(b,c),void 0,a.calcOwnMatrix());f[d][e]=k.x+g.x,f[d][e+1]=k.y+g.y,a.setDimensions();let l=i.subtract(a.pathOffset).transform(a.calcOwnMatrix()).subtract(j);return a.left-=l.x,a.top-=l.y,a.set("dirty",!0),!0})(e,c,d,f,g);return YK(this.actionName,{...XS(a,b,c,d),commandIndex:f,pointIndex:g}),h}class $x extends YU{constructor(a){super(a)}render(a,b,c,d,e){let f={...d,cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill};super.render(a,b,c,f,e)}}class $y extends $x{constructor(a){super(a)}render(a,b,c,d,e){let{path:f}=e,{commandIndex:g,pointIndex:h,connectToCommandIndex:i,connectToPointIndex:j}=this;a.save(),a.strokeStyle=this.controlStroke,this.connectionDashArray&&a.setLineDash(this.connectionDashArray);let[k]=f[g],l=$u(e,i,j);if("Q"===k){let d=$u(e,g,h+2);a.moveTo(d.x,d.y),a.lineTo(b,c)}else a.moveTo(b,c);a.lineTo(l.x,l.y),a.stroke(),a.restore(),super.render(a,b,c,d,e)}}let $z=(a,b,c,d,e,f)=>new(c?$y:$x)({commandIndex:a,pointIndex:b,actionName:"modifyPath",positionHandler:$v,actionHandler:$w,connectToCommandIndex:e,connectToPointIndex:f,...d,...c?d.controlPointStyle:d.pointStyle});Object.freeze({__proto__:null,changeHeight:YR,changeObjectHeight:YP,changeObjectWidth:YO,changeWidth:YQ,createObjectDefaultControls:Ze,createPathControls:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={},d="M";return a.path.forEach((a,e)=>{let f=a[0];switch("Z"!==f&&(c[`c_${e}_${f}`]=$z(e,a.length-2,!1,b)),f){case"C":let g;c[`c_${e}_C_CP_1`]=$z(e,1,!0,b,e-1,"C"===(g=d)?5:"Q"===g?3:1),c[`c_${e}_C_CP_2`]=$z(e,3,!0,b,e,5);break;case"Q":c[`c_${e}_Q_CP_1`]=$z(e,1,!0,b,e,3)}d=f}),c},createPolyActionHandler:$t,createPolyControls:function(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={};for(let d=0;d<("number"==typeof a?a:a.points.length);d++)c[`p${d}`]=new YU({actionName:Wd,positionHandler:$q(d),actionHandler:$t(d),...b});return c},createPolyPositionHandler:$q,createResizeControls:Zf,createTextboxDefaultControls:Zg,dragHandler:$p,factoryPolyActionHandler:$s,getLocalPoint:XU,polyActionHandler:$r,renderCircleControl:YS,renderSquareControl:YT,rotationStyleHandler:YV,rotationWithSnapping:YW,scaleCursorStyleHandler:Y$,scaleOrSkewActionName:Za,scaleSkewCursorStyleHandler:Zb,scalingEqually:Y0,scalingX:Y1,scalingXOrSkewingY:Zc,scalingY:Y2,scalingYOrSkewingX:Zd,skewCursorStyleHandler:Y5,skewHandlerX:Y7,skewHandlerY:Y8,wrapWithFireEvent:YL,wrapWithFixedAnchor:YM});class $A extends Xm{constructor(){super(...arguments),VK(this,"_hoveredTargets",[]),VK(this,"_currentTransform",null),VK(this,"_groupSelector",null),VK(this,"contextTopDirty",!1)}static getDefaults(){return{...super.getDefaults(),...$A.ownDefaults}}get upperCanvasEl(){var a;return null==(a=this.elements.upper)?void 0:a.el}get contextTop(){var a;return null==(a=this.elements.upper)?void 0:a.ctx}get wrapperEl(){return this.elements.container}initElements(a){this.elements=new $o(a,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(a){this._objectsToRender=void 0,super._onObjectAdded(a)}_onObjectRemoved(a){this._objectsToRender=void 0,a===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[a]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[a]}),a.fire("deselected",{target:a})),a===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(a)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){let a=this._activeObject;return!this.preserveObjectStacking&&a?this._objects.filter(b=>!b.group&&b!==a).concat(a):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this._objectsToRender||(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()}renderTop(){let a=this.contextTop;this.clearContext(a),this.renderTopLayer(a),this.fire("after:render",{ctx:a})}setTargetFindTolerance(a){a=Math.round(a),this.targetFindTolerance=a;let b=this.getRetinaScaling(),c=Math.ceil((2*a+1)*b);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=c,this.pixelFindContext.scale(b,b)}isTargetTransparent(a,b,c){let d=this.targetFindTolerance,e=this.pixelFindContext;this.clearContext(e),e.save(),e.translate(-b+d,-c+d),e.transform(...this.viewportTransform);let f=a.selectionBackgroundColor;a.selectionBackgroundColor="",a.render(e),a.selectionBackgroundColor=f,e.restore();let g=Math.round(d*this.getRetinaScaling());return Zk(e,g,g,g)}_isSelectionKeyPressed(a){let b=this.selectionKey;return!!b&&(Array.isArray(b)?!!b.find(b=>!!b&&!0===a[b]):a[b])}_shouldClearSelection(a,b){let c=this.getActiveObjects(),d=this._activeObject;return!!(!b||b&&d&&c.length>1&&-1===c.indexOf(b)&&d!==b&&!this._isSelectionKeyPressed(a)||b&&!b.evented||b&&!b.selectable&&d&&d!==b)}_shouldCenterTransform(a,b,c){let d;if(a)return b===Wf||b===Wg||b===Wh||b===Wc?d=this.centeredScaling||a.centeredScaling:b===Wa&&(d=this.centeredRotation||a.centeredRotation),d?!c:c}_getOriginFromCorner(a,b){let c=b?a.controls[b].getTransformAnchorPoint():{x:a.originX,y:a.originY};return b&&(["ml","tl","bl"].includes(b)?c.x=V4:["mr","tr","br"].includes(b)&&(c.x=V2),["tl","mt","tr"].includes(b)?c.y=V3:["bl","mb","br"].includes(b)&&(c.y="top")),c}_setupCurrentTransform(a,b,c){var d;let e=b.group?Xy(this.getScenePoint(a),void 0,b.group.calcTransformMatrix()):this.getScenePoint(a),{key:f="",control:g}=b.getActiveControl()||{},h=c&&g?null==(d=g.getActionHandler(a,b,g))?void 0:d.bind(g):$p,i=((a,b,c,d)=>{if(!b||!a)return"drag";let e=d.controls[b];return e.getActionName(c,e,d)})(c,f,a,b),j=a[this.centeredKey],k=this._shouldCenterTransform(b,i,j)?{x:V1,y:V1}:this._getOriginFromCorner(b,f),{scaleX:l,scaleY:m,skewX:n,skewY:o,left:p,top:q,angle:r,width:s,height:t,cropX:u,cropY:v}=b,w={target:b,action:i,actionHandler:h,actionPerformed:!1,corner:f,scaleX:l,scaleY:m,skewX:n,skewY:o,offsetX:e.x-p,offsetY:e.y-q,originX:k.x,originY:k.y,ex:e.x,ey:e.y,lastX:e.x,lastY:e.y,theta:WJ(r),width:s,height:t,shiftKey:a.shiftKey,altKey:j,original:{...Xv(b),originX:k.x,originY:k.y,cropX:u,cropY:v}};this._currentTransform=w,this.fire("before:transform",{e:a,transform:w})}setCursor(a){this.upperCanvasEl.style.cursor=a}_drawSelection(a){let{x:b,y:c,deltaX:d,deltaY:e}=this._groupSelector,f=new Wv(b,c).transform(this.viewportTransform),g=new Wv(b+d,c+e).transform(this.viewportTransform),h=this.selectionLineWidth/2,i=Math.min(f.x,g.x),j=Math.min(f.y,g.y),k=Math.max(f.x,g.x),l=Math.max(f.y,g.y);this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(i,j,k-i,l-j)),this.selectionLineWidth&&this.selectionBorderColor&&(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,i+=h,j+=h,k-=h,l-=h,Zj.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(i,j,k-i,l-j))}findTarget(a){if(this._targetInfo)return this._targetInfo;if(this.skipTargetFind)return{subTargets:[],currentSubTargets:[]};let b=this.getScenePoint(a),c=this._activeObject,d=this.getActiveObjects(),e=this.searchPossibleTargets(this._objects,b),{subTargets:f,container:g,target:h}=e,i={...e,currentSubTargets:f,currentContainer:g,currentTarget:h};if(!c)return i;let j={...this.searchPossibleTargets([c],b),currentSubTargets:f,currentContainer:g,currentTarget:h};return c.findControl(this.getViewportPoint(a),Xp(a))?{...j,target:c}:j.target&&(d.length>1||!this.preserveObjectStacking||this.preserveObjectStacking&&a[this.altSelectionKey])?j:i}_pointIsInObjectSelectionArea(a,b){let c=a.getCoords(),d=this.getZoom(),e=a.padding/d;if(e){let[a,b,d,f]=c,g=Math.atan2(b.y-a.y,b.x-a.x),h=Wt(g)*e,i=Wu(g)*e,j=h+i,k=h-i;c=[new Wv(a.x-k,a.y-j),new Wv(b.x+j,b.y-k),new Wv(d.x+k,d.y+j),new Wv(f.x-j,f.y+k)]}return YH.isPointInPolygon(b,c)}_checkTarget(a,b){if(a&&a.visible&&a.evented&&this._pointIsInObjectSelectionArea(a,b)){if(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing)return!0;{let c=b.transform(this.viewportTransform);if(!this.isTargetTransparent(a,c.x,c.y))return!0}}return!1}_searchPossibleTargets(a,b,c){let d=a.length;for(;d--;){let e=a[d];if(this._checkTarget(e,b)){if(Wx(e)&&e.subTargetCheck){let{target:a}=this._searchPossibleTargets(e._objects,b,c);a&&c.push(a)}return{target:e,subTargets:c}}}return{subTargets:[]}}searchPossibleTargets(a,b){let c=this._searchPossibleTargets(a,b,[]);c.container=c.target;let{container:d,subTargets:e}=c;if(d&&Wx(d)&&d.interactive&&e[0]){for(let a=e.length-1;a>0;a--){let b=e[a];if(!Wx(b)||!b.interactive)return c.target=b,c}return c.target=e[0],c}return c}getViewportPoint(a){return this._viewportPoint?this._viewportPoint:this._getPointerImpl(a,!0)}getScenePoint(a){return this._scenePoint?this._scenePoint:this._getPointerImpl(a)}_getPointerImpl(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=this.upperCanvasEl,d=c.getBoundingClientRect(),e=Xo(a),f=d.width||0,g=d.height||0;f&&g||("top"in d&&V3 in d&&(g=Math.abs(d.top-d.bottom)),V4 in d&&V2 in d&&(f=Math.abs(d.right-d.left))),this.calcOffset(),e.x=e.x-this._offset.left,e.y=e.y-this._offset.top,b||(e=Xy(e,void 0,this.viewportTransform));let h=this.getRetinaScaling();1!==h&&(e.x/=h,e.y/=h);let i=0===f||0===g?new Wv(1,1):new Wv(c.width/f,c.height/g);return e.multiply(i)}_setDimensionsImpl(a,b){this._resetTransformEventData(),super._setDimensionsImpl(a,b),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=WE(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){let a=this._activeObject;return W8(a)?a.getObjects():a?[a]:[]}_fireSelectionEvents(a,b){let c=!1,d=!1,e=this.getActiveObjects(),f=[],g=[];a.forEach(a=>{e.includes(a)||(c=!0,a.fire("deselected",{e:b,target:a}),g.push(a))}),e.forEach(d=>{a.includes(d)||(c=!0,d.fire("selected",{e:b,target:d}),f.push(d))}),a.length>0&&e.length>0?(d=!0,c&&this.fire("selection:updated",{e:b,selected:f,deselected:g})):e.length>0?(d=!0,this.fire("selection:created",{e:b,selected:f})):a.length>0&&(d=!0,this.fire("selection:cleared",{e:b,deselected:g})),d&&(this._objectsToRender=void 0)}setActiveObject(a,b){let c=this.getActiveObjects(),d=this._setActiveObject(a,b);return this._fireSelectionEvents(c,b),d}_setActiveObject(a,b){let c=this._activeObject;return c!==a&&!(!this._discardActiveObject(b,a)&&this._activeObject)&&!a.onSelect({e:b})&&(this._activeObject=a,W8(a)&&c!==a&&a.set("canvas",this),a.setCoords(),!0)}_discardActiveObject(a,b){let c=this._activeObject;return!!c&&!c.onDeselect({e:a,object:b})&&(this._currentTransform&&this._currentTransform.target===c&&this.endCurrentTransform(a),W8(c)&&c===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(a){let b=this.getActiveObjects(),c=this.getActiveObject();b.length&&this.fire("before:selection:cleared",{e:a,deselected:[c]});let d=this._discardActiveObject(a);return this._fireSelectionEvents(b,a),d}endCurrentTransform(a){let b=this._currentTransform;this._finalizeCurrentTransform(a),b&&b.target&&(b.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(a){let b=this._currentTransform,c=b.target,d={e:a,target:c,transform:b,action:b.action};c._scaling&&(c._scaling=!1),c.setCoords(),b.actionPerformed&&(this.fire("object:modified",d),c.fire(Wm,d))}setViewportTransform(a){super.setViewportTransform(a);let b=this._activeObject;b&&b.setCoords()}destroy(){let a=this._activeObject;W8(a)&&(a.removeAll(),a.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(a){let b=this._activeObject;b&&b._renderControls(a)}_toObject(a,b,c){let d=this._realizeGroupTransformOnObject(a),e=super._toObject(a,b,c);return a.set(d),e}_realizeGroupTransformOnObject(a){let{group:b}=a;if(b&&W8(b)&&this._activeObject===b){let c=W1(a,["angle","flipX","flipY",V2,Wg,Wh,Wi,Wj,"top"]);return Xs(a,b.calcOwnMatrix()),c}return{}}_setSVGObject(a,b,c){let d=this._realizeGroupTransformOnObject(b);super._setSVGObject(a,b,c),b.set(d)}}VK($A,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!0,fireRightClick:!0,fireMiddleClick:!0,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!0});class $B{constructor(a){VK(this,"targets",[]),VK(this,"__disposer",void 0);const b=()=>{let{hiddenTextarea:b}=a.getActiveObject()||{};b&&b.focus()},c=a.upperCanvasEl;c.addEventListener("click",b),this.__disposer=()=>c.removeEventListener("click",b)}exitTextEditing(){this.target=void 0,this.targets.forEach(a=>{a.isEditing&&a.exitEditing()})}add(a){this.targets.push(a)}remove(a){this.unregister(a),Ws(this.targets,a)}register(a){this.target=a}unregister(a){a===this.target&&(this.target=void 0)}onMouseMove(a){var b;(null==(b=this.target)?void 0:b.isEditing)&&this.target.updateSelectionOnMouseMove(a)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}let $C={passive:!1},$D=(a,b)=>({viewportPoint:a.getViewportPoint(b),scenePoint:a.getScenePoint(b)}),$E=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return a.addEventListener(...c)},$F=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return a.removeEventListener(...c)},$G={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class $H extends $A{constructor(a){super(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),VK(this,"_isClick",void 0),VK(this,"textEditingManager",new $B(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(a=>{this[a]=this[a].bind(this)}),this.addOrRemove($E)}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(a){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=this.upperCanvasEl,d=this._getEventPrefix();a(Xb(c),"resize",this._onResize),a(c,d+"down",this._onMouseDown),a(c,`${d}move`,this._onMouseMove,$C),a(c,`${d}out`,this._onMouseOut),a(c,`${d}enter`,this._onMouseEnter),a(c,"wheel",this._onMouseWheel,{passive:!1}),a(c,"contextmenu",this._onContextMenu),b||(a(c,"click",this._onClick),a(c,"dblclick",this._onClick)),a(c,"dragstart",this._onDragStart),a(c,"dragend",this._onDragEnd),a(c,"dragover",this._onDragOver),a(c,"dragenter",this._onDragEnter),a(c,"dragleave",this._onDragLeave),a(c,"drop",this._onDrop),this.enablePointerEvents||a(c,"touchstart",this._onTouchStart,$C)}removeListeners(){this.addOrRemove($F);let a=this._getEventPrefix(),b=Xa(this.upperCanvasEl);$F(b,`${a}up`,this._onMouseUp),$F(b,"touchend",this._onTouchEnd,$C),$F(b,`${a}move`,this._onMouseMove,$C),$F(b,"touchmove",this._onMouseMove,$C),clearTimeout(this._willAddMouseDown)}_onMouseWheel(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()}_onMouseOut(a){let b=this._hoveredTarget,c={e:a,...$D(this,a)};this.fire("mouse:out",{...c,target:b}),this._hoveredTarget=void 0,b&&b.fire("mouseout",{...c}),this._hoveredTargets.forEach(a=>{this.fire("mouse:out",{...c,target:a}),a&&a.fire("mouseout",{...c})}),this._hoveredTargets=[]}_onMouseEnter(a){let{target:b}=this.findTarget(a);this._currentTransform||b||(this.fire("mouse:over",{e:a,...$D(this,a)}),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(a){this._isClick=!1;let b=this.getActiveObject();if(b&&b.onDragStart(a)){this._dragSource=b;let c={e:a,target:b};return this.fire("dragstart",c),b.fire("dragstart",c),void $E(this.upperCanvasEl,"drag",this._onDragProgress)}Xq(a)}_renderDragEffects(a,b,c){let d=!1,e=this._dropTarget;e&&e!==b&&e!==c&&(e.clearContextTop(),d=!0),null==b||b.clearContextTop(),c!==b&&(null==c||c.clearContextTop());let f=this.contextTop;f.save(),f.transform(...this.viewportTransform),b&&(f.save(),b.transform(f),b.renderDragSourceEffect(a),f.restore(),d=!0),c&&(f.save(),c.transform(f),c.renderDropTargetEffect(a),f.restore(),d=!0),f.restore(),d&&(this.contextTopDirty=!0)}_onDragEnd(a){let{currentSubTargets:b}=this.findTarget(a),c=!!a.dataTransfer&&a.dataTransfer.dropEffect!==V5,d=c?this._activeObject:void 0,e={e:a,target:this._dragSource,subTargets:b,dragSource:this._dragSource,didDrop:c,dropTarget:d};$F(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",e),this._dragSource&&this._dragSource.fire("dragend",e),delete this._dragSource,this._onMouseUp(a)}_onDragProgress(a){let b={e:a,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",b),this._dragSource&&this._dragSource.fire("drag",b)}_onDragOver(a){let b,c="dragover",{currentContainer:d,currentSubTargets:e}=this.findTarget(a),f=this._dragSource,g={e:a,target:d,subTargets:e,dragSource:f,canDrop:!1,dropTarget:void 0};this.fire(c,g),this._fireEnterLeaveEvents(a,d,g),d&&(d.canDrop(a)&&(b=d),d.fire(c,g));for(let d=0;d<e.length;d++){let f=e[d];f.canDrop(a)&&(b=f),f.fire(c,g)}this._renderDragEffects(a,f,b),this._dropTarget=b}_onDragEnter(a){let{currentContainer:b,currentSubTargets:c}=this.findTarget(a),d={e:a,target:b,subTargets:c,dragSource:this._dragSource};this.fire("dragenter",d),this._fireEnterLeaveEvents(a,b,d)}_onDragLeave(a){let{currentSubTargets:b}=this.findTarget(a),c={e:a,target:this._draggedoverTarget,subTargets:b,dragSource:this._dragSource};this.fire("dragleave",c),this._fireEnterLeaveEvents(a,void 0,c),this._renderDragEffects(a,this._dragSource),this._dropTarget=void 0,this._hoveredTargets=[]}_onDrop(a){let{currentContainer:b,currentSubTargets:c}=this.findTarget(a),d=this._basicEventHandler("drop:before",{e:a,target:b,subTargets:c,dragSource:this._dragSource,...$D(this,a)});d.didDrop=!1,d.dropTarget=void 0,this._basicEventHandler("drop",d),this.fire("drop:after",d)}_onContextMenu(a){let{target:b,subTargets:c}=this.findTarget(a),d=this._basicEventHandler("contextmenu:before",{e:a,target:b,subTargets:c});return this.stopContextMenu&&Xq(a),this._basicEventHandler("contextmenu",d),!1}_onClick(a){let b=a.detail;b>3||b<2||(this._cacheTransformEventData(a),2==b&&"dblclick"===a.type&&this._handleEvent(a,"dblclick"),3==b&&this._handleEvent(a,"tripleclick"),this._resetTransformEventData())}fireEventFromPointerEvent(a,b,c){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._cacheTransformEventData(a);let{target:e,subTargets:f}=this.findTarget(a),g={e:a,target:e,subTargets:f,...$D(this,a),transform:this._currentTransform,...d};this.fire(b,g),e&&e.fire(c,g);for(let a=0;a<f.length;a++)f[a]!==e&&f[a].fire(c,g);this._resetTransformEventData()}getPointerId(a){let b=a.changedTouches;return b?b[0]&&b[0].identifier:this.enablePointerEvents?a.pointerId:-1}_isMainEvent(a){return!0===a.isPrimary||!1!==a.isPrimary&&("touchend"===a.type&&0===a.touches.length||!a.changedTouches||a.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(a){this._cacheTransformEventData(a);let b=!this.allowTouchScrolling,c=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a);let{target:d}=this.findTarget(a);(this.isDrawingMode||c&&d===c)&&(b=!0),b&&a.preventDefault();let e=this.upperCanvasEl,f=this._getEventPrefix(),g=Xa(e);$E(g,"touchend",this._onTouchEnd,$C),b&&$E(g,"touchmove",this._onMouseMove,$C),$F(e,`${f}down`,this._onMouseDown),this._resetTransformEventData()}_onMouseDown(a){this._cacheTransformEventData(a),this.__onMouseDown(a);let b=this.upperCanvasEl,c=this._getEventPrefix();$F(b,`${c}move`,this._onMouseMove,$C);let d=Xa(b);$E(d,`${c}up`,this._onMouseUp),$E(d,`${c}move`,this._onMouseMove,$C),this._resetTransformEventData()}_onTouchEnd(a){if(a.touches.length>0)return;this._cacheTransformEventData(a),this.__onMouseUp(a),this._resetTransformEventData(),delete this.mainTouchId;let b=this._getEventPrefix(),c=Xa(this.upperCanvasEl);$F(c,"touchend",this._onTouchEnd,$C),$F(c,"touchmove",this._onMouseMove,$C),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{$E(this.upperCanvasEl,`${b}down`,this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(a){this._cacheTransformEventData(a),this.__onMouseUp(a);let b=this.upperCanvasEl,c=this._getEventPrefix();if(this._isMainEvent(a)){let a=Xa(this.upperCanvasEl);$F(a,`${c}up`,this._onMouseUp),$F(a,`${c}move`,this._onMouseMove,$C),$E(b,`${c}move`,this._onMouseMove,$C)}this._resetTransformEventData()}_onMouseMove(a){this._cacheTransformEventData(a);let b=this.getActiveObject();this.allowTouchScrolling||b&&b.shouldStartDragging(a)||!a.preventDefault||a.preventDefault(),this.__onMouseMove(a),this._resetTransformEventData()}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(a){let b=this.getActiveObject();return!!b!=!!a||b&&a&&b!==a}__onMouseUp(a){var b;this._handleEvent(a,"up:before");let c=this._currentTransform,d=this._isClick,{target:e}=this.findTarget(a),{button:f}=a;if(f)return void((this.fireMiddleClick&&1===f||this.fireRightClick&&2===f)&&this._handleEvent(a,"up"));if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);if(!this._isMainEvent(a))return;let g,h,i=!1;if(c&&(this._finalizeCurrentTransform(a),i=c.actionPerformed),!d){let b=e===this._activeObject;this.handleSelection(a),i||(i=this._shouldRender(e)||!b&&e===this._activeObject)}if(e){let{key:b,control:d}=e.findControl(this.getViewportPoint(a),Xp(a))||{};if(h=b,e.selectable&&e!==this._activeObject&&"up"===e.activeOn)this.setActiveObject(e,a),i=!0;else if(d){let b=d.getMouseUpHandler(a,e,d);b&&(g=this.getScenePoint(a),b.call(d,a,c,g.x,g.y))}e.isMoving=!1}if(c&&(c.target!==e||c.corner!==h)){let b=c.target&&c.target.controls[c.corner],d=b&&b.getMouseUpHandler(a,c.target,b);g=g||this.getScenePoint(a),d&&d.call(b,a,c,g.x,g.y)}this._setCursorFromEvent(a,e),this._handleEvent(a,"up"),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=void 0),i?this.requestRenderAll():d||null!=(b=this._activeObject)&&b.isEditing||this.renderTop()}_basicEventHandler(a,b){let{target:c,subTargets:d=[]}=b;this.fire(a,b),c&&c.fire(a,b);for(let e=0;e<d.length;e++)d[e]!==c&&d[e].fire(a,b);return b}_handleEvent(a,b,c){let{target:d,subTargets:e}=this.findTarget(a),f={e:a,target:d,subTargets:e,...$D(this,a),transform:this._currentTransform,..."down:before"===b||"down"===b?c:{}};"up:before"!==b&&"up"!==b||(f.isClick=this._isClick),this.fire(`mouse:${b}`,f),d&&d.fire(`mouse${b}`,f);for(let a=0;a<e.length;a++)e[a]!==d&&e[a].fire(`mouse${b}`,f)}_onMouseDownInDrawingMode(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(a),this.requestRenderAll());let b=this.getScenePoint(a);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(b,{e:a,pointer:b}),this._handleEvent(a,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(a){if(this._isCurrentlyDrawing){let b=this.getScenePoint(a);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(b,{e:a,pointer:b})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")}_onMouseUpInDrawingMode(a){let b=this.getScenePoint(a);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:a,pointer:b}):this._isCurrentlyDrawing=!1,this._handleEvent(a,"up")}__onMouseDown(a){this._isClick=!0,this._handleEvent(a,"down:before");let{target:b}=this.findTarget(a),c=!!b&&b===this._activeObject,{button:d}=a;if(d)return void((this.fireMiddleClick&&1===d||this.fireRightClick&&2===d)&&this._handleEvent(a,"down",{alreadySelected:c}));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._isMainEvent(a)||this._currentTransform)return;let e=this._shouldRender(b),f=!1;if(this.handleMultiSelection(a,b)?(b=this._activeObject,f=!0,e=!0):this._shouldClearSelection(a,b)&&this.discardActiveObject(a),this.selection&&(!b||!b.selectable&&!b.isEditing&&b!==this._activeObject)){let b=this.getScenePoint(a);this._groupSelector={x:b.x,y:b.y,deltaY:0,deltaX:0}}if(c=!!b&&b===this._activeObject,b){b.selectable&&"down"===b.activeOn&&this.setActiveObject(b,a);let d=b.findControl(this.getViewportPoint(a),Xp(a));if(b===this._activeObject&&(d||!f)){this._setupCurrentTransform(a,b,c);let e=d?d.control:void 0,f=this.getScenePoint(a),g=e&&e.getMouseDownHandler(a,b,e);g&&g.call(e,a,this._currentTransform,f.x,f.y)}}e&&(this._objectsToRender=void 0),this._handleEvent(a,"down",{alreadySelected:c}),e&&this.requestRenderAll()}_resetTransformEventData(){this._targetInfo=this._viewportPoint=this._scenePoint=void 0}_cacheTransformEventData(a){this._resetTransformEventData(),this._viewportPoint=this.getViewportPoint(a),this._scenePoint=Xy(this._viewportPoint,void 0,this.viewportTransform),this._targetInfo=this.findTarget(a),this._currentTransform&&(this._targetInfo.target=this._currentTransform.target)}__onMouseMove(a){if(this._isClick=!1,this._handleEvent(a,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!this._isMainEvent(a))return;let b=this._groupSelector;if(b){let c=this.getScenePoint(a);b.deltaX=c.x-b.x,b.deltaY=c.y-b.y,this.renderTop()}else if(this._currentTransform)this._transformObject(a);else{let{target:b}=this.findTarget(a);this._setCursorFromEvent(a,b),this._fireOverOutEvents(a,b)}this.textEditingManager.onMouseMove(a),this._handleEvent(a,"move")}_fireOverOutEvents(a,b){let{_hoveredTarget:c,_hoveredTargets:d}=this,{subTargets:e}=this.findTarget(a),f=Math.max(d.length,e.length);this.fireSyntheticInOutEvents("mouse",{e:a,target:b,oldTarget:c,fireCanvas:!0});for(let g=0;g<f;g++)e[g]===b||d[g]&&d[g]===c||this.fireSyntheticInOutEvents("mouse",{e:a,target:e[g],oldTarget:d[g]});this._hoveredTarget=b,this._hoveredTargets=e}_fireEnterLeaveEvents(a,b,c){let d=this._draggedoverTarget,e=this._hoveredTargets,{subTargets:f}=this.findTarget(a),g=Math.max(e.length,f.length);this.fireSyntheticInOutEvents("drag",{...c,target:b,oldTarget:d,fireCanvas:!0});for(let a=0;a<g;a++)this.fireSyntheticInOutEvents("drag",{...c,target:f[a],oldTarget:e[a]});this._draggedoverTarget=b}fireSyntheticInOutEvents(a,b){let{target:c,oldTarget:d,fireCanvas:e,e:f,...g}=b,{targetIn:h,targetOut:i,canvasIn:j,canvasOut:k}=$G[a],l=d!==c;if(d&&l){let a={...g,e:f,target:d,nextTarget:c,...$D(this,f)};e&&this.fire(k,a),d.fire(i,a)}if(c&&l){let a={...g,e:f,target:c,previousTarget:d,...$D(this,f)};e&&this.fire(j,a),c.fire(h,a)}}_transformObject(a){let b=this.getScenePoint(a),c=this._currentTransform,d=c.target,e=d.group?Xy(b,void 0,d.group.calcTransformMatrix()):b;c.shiftKey=a.shiftKey,c.altKey=!!this.centeredKey&&a[this.centeredKey],this._performTransformAction(a,c,e),c.actionPerformed&&this.requestRenderAll()}_performTransformAction(a,b,c){let{action:d,actionHandler:e,target:f}=b,g=!!e&&e(a,b,c.x,c.y);g&&f.setCoords(),"drag"===d&&g&&(b.target.isMoving=!0,this.setCursor(b.target.moveCursor||this.moveCursor)),b.actionPerformed=b.actionPerformed||g}_setCursorFromEvent(a,b){if(!b)return void this.setCursor(this.defaultCursor);let c=b.hoverCursor||this.hoverCursor,d=W8(this._activeObject)?this._activeObject:null,e=(!d||b.group!==d)&&b.findControl(this.getViewportPoint(a));if(e){let{control:c,coord:d}=e;this.setCursor(c.cursorStyleHandler(a,c,b,d))}else{if(b.subTargetCheck){let{subTargets:b}=this.findTarget(a);b.concat().reverse().forEach(a=>{c=a.hoverCursor||c})}this.setCursor(c)}}handleMultiSelection(a,b){let c=this._activeObject,d=W8(c);if(c&&this._isSelectionKeyPressed(a)&&this.selection&&b&&b.selectable&&(c!==b||d)&&(d||!b.isDescendantOf(c)&&!c.isDescendantOf(b))&&!b.onSelect({e:a})&&!c.getActiveControl()){if(d){let d=c.getObjects(),e=[];if(b===c){let c=this.getScenePoint(a),f=this.searchPossibleTargets(d,c);if(b=f.target?f.target:(f=this.searchPossibleTargets(this._objects,c)).target,e=f.subTargets,!b||!b.selectable)return!1}b.group===c?(c.remove(b),this._hoveredTarget=b,this._hoveredTargets=e,1===c.size()&&this._setActiveObject(c.item(0),a)):(c.multiSelectAdd(b),this._hoveredTarget=c,this._hoveredTargets=e),this._fireSelectionEvents(d,a)}else{c.isEditing&&c.exitEditing();let d=new(Wp.getClass("ActiveSelection"))([],{canvas:this});d.multiSelectAdd(c,b),this._hoveredTarget=d,this._setActiveObject(d,a),this._fireSelectionEvents([c],a)}return!0}return!1}handleSelection(a){if(!this.selection||!this._groupSelector)return!1;let{x:b,y:c,deltaX:d,deltaY:e}=this._groupSelector,f=new Wv(b,c),g=f.add(new Wv(d,e)),h=f.min(g),i=f.max(g).subtract(h),j=this.collectObjects({left:h.x,top:h.y,width:i.x,height:i.y},{includeIntersecting:!this.selectionFullyContained}),k=f.eq(g)?j[0]?[j[0]]:[]:j.length>1?j.filter(b=>!b.onSelect({e:a})).reverse():j;if(1===k.length)this.setActiveObject(k[0],a);else if(k.length>1){let b=Wp.getClass("ActiveSelection");this.setActiveObject(new b(k,{canvas:this}),a)}return this._groupSelector=null,!0}toCanvasElement(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,{upper:c}=this.elements;c.ctx=void 0;let d=super.toCanvasElement(a,b);return c.ctx=c.el.getContext("2d"),d}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}let $I={x1:0,y1:0,x2:0,y2:0},$J={...$I,r1:0,r2:0},$K=(a,b)=>isNaN(a)&&"number"==typeof b?b:a;function $L(a){return a&&/%$/.test(a)&&Number.isFinite(parseFloat(a))}function $M(a,b){return Yp(0,$K("number"==typeof a?a:"string"==typeof a?parseFloat(a)/($L(a)?100:1):NaN,b),1)}let $N=/\s*;\s*/,$O=/\s*:\s*/;function $P(a){return"linearGradient"===a.nodeName||"LINEARGRADIENT"===a.nodeName?"linear":"radial"}function $Q(a){return"userSpaceOnUse"===a.getAttribute("gradientUnits")?"pixels":"percentage"}function $R(a,b){return a.getAttribute(b)}class $S{constructor(a){const{type:b="linear",gradientUnits:c="pixels",coords:d={},colorStops:e=[],offsetX:f=0,offsetY:g=0,gradientTransform:h,id:i}=a||{};Object.assign(this,{type:b,gradientUnits:c,coords:{..."radial"===b?$J:$I,...d},colorStops:e,offsetX:f,offsetY:g,gradientTransform:h,id:i?`${i}_${WD()}`:WD()})}addColorStop(a){for(let b in a)this.colorStops.push({offset:parseFloat(b),color:a[b]});return this}toObject(a){return{...W1(this,a),type:this.type,coords:{...this.coords},colorStops:this.colorStops.map(a=>({...a})),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0}}toSVG(a){let{additionalTransform:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=[],d=this.gradientTransform?this.gradientTransform.concat():V0.concat(),e="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",f=this.colorStops.map(a=>({...a})).sort((a,b)=>a.offset-b.offset),g=-this.offsetX,h=-this.offsetY;"objectBoundingBox"===e?(g/=a.width,h/=a.height):(g+=a.width/2,h+=a.height/2),a&&"function"==typeof a._renderPathCommands&&"percentage"!==this.gradientUnits&&(g-=a.pathOffset.x,h-=a.pathOffset.y),d[4]-=g,d[5]-=h;let i=`id="SVGID_${Xh(String(this.id))}" gradientUnits="${e}" gradientTransform="${b?b+" ":""}${W4(d)}" `;if("linear"===this.type){let{x1:a,y1:b,x2:d,y2:e}=this.coords,f=parseFloat(String(a)),g=parseFloat(String(b)),h=parseFloat(String(d)),j=parseFloat(String(e));c.push("<linearGradient ",i,' x1="',f,'" y1="',g,'" x2="',h,'" y2="',j,'">\n')}else if("radial"===this.type){let{x1:a,y1:b,x2:d,y2:e,r1:g,r2:h}=this.coords,j=parseFloat(String(a)),k=parseFloat(String(b)),l=parseFloat(String(d)),m=parseFloat(String(e)),n=parseFloat(String(g)),o=parseFloat(String(h)),p=n>o;c.push("<radialGradient ",i,' cx="',p?j:l,'" cy="',p?k:m,'" r="',p?n:o,'" fx="',p?l:j,'" fy="',p?m:k,'">\n'),p&&(f.reverse(),f.forEach(a=>{a.offset=1-a.offset}));let q=Math.min(n,o);if(q>0){let a=q/Math.max(n,o);f.forEach(b=>{b.offset+=a*(1-b.offset)})}}return f.forEach(a=>{let{color:b,offset:d}=a;c.push(`<stop offset="${100*d}%" style="stop-color:${b};"/>
`)}),c.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),c.join("")}toLive(a){let{x1:b,y1:c,x2:d,y2:e,r1:f,r2:g}=this.coords,h="linear"===this.type?a.createLinearGradient(b,c,d,e):a.createRadialGradient(b,c,f,d,e,g);return this.colorStops.forEach(a=>{let{color:b,offset:c}=a;h.addColorStop(c,b)}),h}static async fromObject(a){let{colorStops:b,gradientTransform:c}=a;return new this({...a,colorStops:b?b.map(a=>({...a})):void 0,gradientTransform:c?[...c]:void 0})}static fromElement(a,b,c){var d;let e=$Q(a),f=b._findCenterFromElement();return new this({id:a.getAttribute("id")||void 0,type:$P(a),coords:(d={width:c.viewBoxWidth||c.width,height:c.viewBoxHeight||c.height},function(a,b){let c,{width:d,height:e,gradientUnits:f}=b;return Object.entries(a).reduce((a,b)=>{let[g,h]=b;if("Infinity"===h)c=1;else if("-Infinity"===h)c=0;else{let a="string"==typeof h;c=a?parseFloat(h):h,a&&$L(h)&&(c*=.01,"pixels"===f&&("x1"!==g&&"x2"!==g&&"r2"!==g||(c*=d),"y1"!==g&&"y2"!==g||(c*=e)))}return a[g]=c,a},{})}("linear"===$P(a)?{x1:$R(a,"x1")||0,y1:$R(a,"y1")||0,x2:$R(a,"x2")||"100%",y2:$R(a,"y2")||0}:{x1:$R(a,"fx")||$R(a,"cx")||"50%",y1:$R(a,"fy")||$R(a,"cy")||"50%",r1:0,x2:$R(a,"cx")||"50%",y2:$R(a,"cy")||"50%",r2:$R(a,"r")||"50%"},{...d,gradientUnits:$Q(a)})),colorStops:function(a,b){let c=[],d=a.getElementsByTagName("stop"),e=$M(b,1);for(let a=d.length;a--;)c.push(function(a,b){let c,d,e=a.getAttribute("style");if(e){let a=e.split($N);""===a[a.length-1]&&a.pop();for(let b=a.length;b--;){let[e,f]=a[b].split($O).map(a=>a.trim());"stop-color"===e?c=f:"stop-opacity"===e&&(d=f)}}c=c||a.getAttribute("stop-color")||"rgb(0,0,0)",d=$K(parseFloat(d||a.getAttribute("stop-opacity")||""),1);let f=new X_(c);return f.setAlpha(f.getAlpha()*d*b),{offset:$M(a.getAttribute("offset"),0),color:f.toRgba()}}(d[a],e));return c}(a,c.opacity),gradientUnits:e,gradientTransform:ZJ(a.getAttribute("gradientTransform")||""),..."pixels"===e?{offsetX:b.width/2-f.x,offsetY:b.height/2-f.y}:{offsetX:0,offsetY:0}})}}VK($S,"type","Gradient"),Wp.setClass($S,"gradient"),Wp.setClass($S,"linear"),Wp.setClass($S,"radial");class $T{get type(){return"pattern"}set type(a){VN("warn","Setting type has no effect",a)}constructor(a){VK(this,"repeat","repeat"),VK(this,"offsetX",0),VK(this,"offsetY",0),VK(this,"crossOrigin",""),this.id=WD(),Object.assign(this,a)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(a){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?a.createPattern(this.source,this.repeat):null}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{repeat:b,crossOrigin:c}=this;return{...W1(this,a),type:"pattern",source:this.sourceToString(),repeat:b,crossOrigin:c,offsetX:W3(this.offsetX,VM.NUM_FRACTION_DIGITS),offsetY:W3(this.offsetY,VM.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null}}toSVG(a){let{width:b,height:c}=a,{source:d,repeat:e,id:f}=this,g=$K(this.offsetX/b,0),h=$K(this.offsetY/c,0),i="repeat-y"===e||"no-repeat"===e?1+Math.abs(g||0):$K(d.width/b,0),j="repeat-x"===e||"no-repeat"===e?1+Math.abs(h||0):$K(d.height/c,0);return`<pattern id="SVGID_${Xh(f)}" x="${g}" y="${h}" width="${i}" height="${j}">
<image x="0" y="0" width="${d.width}" height="${d.height}" xlink:href="${Xh(this.sourceToString())}"></image>
</pattern>
`}static async fromObject(a,b){let{type:c,source:d,patternTransform:e,...f}=a,g=await W$(d,{...b,crossOrigin:f.crossOrigin});return new this({...f,patternTransform:e&&e.slice(0),source:g})}}VK($T,"type","Pattern"),Wp.setClass($T),Wp.setClass($T,"pattern");class $U extends Zj{constructor(a){let{path:b,left:c,top:d,...e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,$U.ownDefaults),this.setOptions(e),this._setPath(a||[],!0),"number"==typeof c&&this.set(V2,c),"number"==typeof d&&this.set("top",d)}_setPath(a,b){this.path=Z7(Array.isArray(a)?a:$l(a)),this.setBoundingBox(b)}_findCenterFromElement(){let a=this._calcBoundsFromPath();return new Wv(a.left+a.width/2,a.top+a.height/2)}_renderPathCommands(a){let b=-this.pathOffset.x,c=-this.pathOffset.y;for(let d of(a.beginPath(),this.path))switch(d[0]){case"L":a.lineTo(d[1]+b,d[2]+c);break;case"M":a.moveTo(d[1]+b,d[2]+c);break;case"C":a.bezierCurveTo(d[1]+b,d[2]+c,d[3]+b,d[4]+c,d[5]+b,d[6]+c);break;case"Q":a.quadraticCurveTo(d[1]+b,d[2]+c,d[3]+b,d[4]+c);break;case"Z":a.closePath()}}_render(a){this._renderPathCommands(a),this._renderPaintInOrder(a)}toString(){return`#<Path (${this.complexity()}): { "top": ${this.top}, "left": ${this.left} }>`}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{...super.toObject(a),path:this.path.map(a=>a.slice())}}toDatalessObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this.toObject(a);return this.sourcePath&&(delete b.path,b.sourcePath=this.sourcePath),b}_toSVG(){return["<path ","COMMON_PARTS",`d="${$m(this.path,VM.NUM_FRACTION_DIGITS)}" stroke-linecap="round" />
`]}_getOffsetTransform(){let a=VM.NUM_FRACTION_DIGITS;return` translate(${W3(-this.pathOffset.x,a)}, ${W3(-this.pathOffset.y,a)})`}toClipPathSVG(a){let b=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})}toSVG(a){let b=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,additionalTransform:b})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(a){let{width:b,height:c,pathOffset:d}=this._calcDimensions();this.set({width:b,height:c,pathOffset:d}),a&&this.setPositionByOrigin(d,V1,V1)}_calcBoundsFromPath(){let a=[],b=0,c=0,d=0,e=0;for(let f of this.path)switch(f[0]){case"L":d=f[1],e=f[2],a.push({x:b,y:c},{x:d,y:e});break;case"M":d=f[1],e=f[2],b=d,c=e;break;case"C":a.push(...Z5(d,e,f[1],f[2],f[3],f[4],f[5],f[6])),d=f[5],e=f[6];break;case"Q":a.push(...Z5(d,e,f[1],f[2],f[1],f[2],f[3],f[4])),d=f[3],e=f[4];break;case"Z":d=b,e=c}return Xr(a)}_calcDimensions(){let a=this._calcBoundsFromPath();return{...a,pathOffset:new Wv(a.left+a.width/2,a.top+a.height/2)}}static fromObject(a){return this._fromObject(a,{extraParam:"path"})}static async fromElement(a,b,c){let{d:d,...e}=ZL(a,this.ATTRIBUTE_NAMES,c);return new this(d,{...e,...b,left:void 0,top:void 0})}}VK($U,"type","Path"),VK($U,"cacheProperties",[...Yr,"path","fillRule"]),VK($U,"ATTRIBUTE_NAMES",[...Zu,"d"]),Wp.setClass($U),Wp.setSVGClass($U);let $V=["radius","startAngle","endAngle","counterClockwise"];class $W extends Zj{static getDefaults(){return{...super.getDefaults(),...$W.ownDefaults}}constructor(a){super(),Object.assign(this,$W.ownDefaults),this.setOptions(a)}_set(a,b){return super._set(a,b),"radius"===a&&this.setRadius(b),this}_render(a){a.beginPath(),a.arc(0,0,this.radius,WJ(this.startAngle),WJ(this.endAngle),this.counterClockwise),this._renderPaintInOrder(a)}getRadiusX(){return this.get("radius")*this.get(Wg)}getRadiusY(){return this.get("radius")*this.get(Wh)}setRadius(a){this.radius=a,this.set({width:2*a,height:2*a})}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...$V,...a])}_toSVG(){let{radius:a,startAngle:b,endAngle:c}=this,d=(c-b)%360;if(0===d)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',`${Xh(a)}`,'" />\n'];{let e=WJ(b),f=WJ(c),g=Wt(e)*a,h=Wu(e)*a,i=Wt(f)*a,j=Wu(f)*a;return[`<path d="M ${g} ${h} A ${a} ${a} 0 ${+(d>180)} ${+!this.counterClockwise} ${i} ${j}" `,"COMMON_PARTS"," />\n"]}}static async fromElement(a,b,c){let{left:d=0,top:e=0,radius:f=0,...g}=ZL(a,this.ATTRIBUTE_NAMES,c);return new this({...g,radius:f,left:d-f,top:e-f})}static fromObject(a){return super._fromObject(a)}}VK($W,"type","Circle"),VK($W,"cacheProperties",[...Yr,...$V]),VK($W,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),VK($W,"ATTRIBUTE_NAMES",["cx","cy","r",...Zu]),Wp.setClass($W),Wp.setSVGClass($W);let $X=["x1","x2","y1","y2"];class $Y extends Zj{constructor(){let[a,b,c,d]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,$Y.ownDefaults),this.setOptions(e),this.x1=a,this.x2=c,this.y1=b,this.y2=d,this._setWidthHeight();const{left:f,top:g}=e;"number"==typeof f&&this.set(V2,f),"number"==typeof g&&this.set("top",g)}_setWidthHeight(){let{x1:a,y1:b,x2:c,y2:d}=this;this.width=Math.abs(c-a),this.height=Math.abs(d-b);let{left:e,top:f,width:g,height:h}=Xr([{x:a,y:b},{x:c,y:d}]),i=new Wv(e+g/2,f+h/2);this.setPositionByOrigin(i,V1,V1)}_set(a,b){return super._set(a,b),$X.includes(a)&&this._setWidthHeight(),this}_render(a){var b;a.beginPath();let c=this.calcLinePoints();a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2),a.lineWidth=this.strokeWidth;let d=a.strokeStyle;W5(this.stroke)?a.strokeStyle=this.stroke.toLive(a):a.strokeStyle=null!=(b=this.stroke)?b:a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=d}_findCenterFromElement(){return new Wv((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{...super.toObject(a),...this.calcLinePoints()}}_getNonTransformedDimensions(){let a=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(a.y-=this.strokeWidth),0===this.height&&(a.x-=this.strokeWidth)),a}calcLinePoints(){let{x1:a,x2:b,y1:c,y2:d,width:e,height:f}=this,g=a<=b?-.5:.5,h=c<=d?-.5:.5;return{x1:g*e,x2:-(g*e),y1:h*f,y2:-(h*f)}}_toSVG(){let{x1:a,x2:b,y1:c,y2:d}=this.calcLinePoints();return["<line ","COMMON_PARTS",`x1="${a}" y1="${c}" x2="${b}" y2="${d}" />
`]}static async fromElement(a,b,c){let{x1:d=0,y1:e=0,x2:f=0,y2:g=0,...h}=ZL(a,this.ATTRIBUTE_NAMES,c);return new this([d,e,f,g],h)}static fromObject(a){let{x1:b,y1:c,x2:d,y2:e,...f}=a;return this._fromObject({...f,points:[b,c,d,e]},{extraParam:"points"})}}VK($Y,"type","Line"),VK($Y,"cacheProperties",[...Yr,...$X]),VK($Y,"ATTRIBUTE_NAMES",Zu.concat($X)),Wp.setClass($Y),Wp.setSVGClass($Y);class $Z extends Zj{static getDefaults(){return{...super.getDefaults(),...$Z.ownDefaults}}constructor(a){super(),Object.assign(this,$Z.ownDefaults),this.setOptions(a)}_render(a){let b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderPaintInOrder(a)}_toSVG(){let a=this.width/2,b=this.height/2;return["<polygon ","COMMON_PARTS",'points="',`${-a} ${b},0 ${-b},${a} ${b}`,'" />']}}VK($Z,"type","Triangle"),VK($Z,"ownDefaults",{width:100,height:100}),Wp.setClass($Z),Wp.setSVGClass($Z);let $$=["rx","ry"];class $_ extends Zj{static getDefaults(){return{...super.getDefaults(),...$_.ownDefaults}}constructor(a){super(),Object.assign(this,$_.ownDefaults),this.setOptions(a)}_set(a,b){switch(super._set(a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this}getRx(){return this.get("rx")*this.get(Wg)}getRy(){return this.get("ry")*this.get(Wh)}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...$$,...a])}_toSVG(){return["<ellipse ","COMMON_PARTS",`cx="0" cy="0" rx="${Xh(this.rx)}" ry="${Xh(this.ry)}" />
`]}_render(a){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(0,0,this.rx,0,V$,!1),a.restore(),this._renderPaintInOrder(a)}static async fromElement(a,b,c){let d=ZL(a,this.ATTRIBUTE_NAMES,c);return d.left=(d.left||0)-d.rx,d.top=(d.top||0)-d.ry,new this(d)}}VK($_,"type","Ellipse"),VK($_,"cacheProperties",[...Yr,...$$]),VK($_,"ownDefaults",{rx:0,ry:0}),VK($_,"ATTRIBUTE_NAMES",[...Zu,"cx","cy","rx","ry"]),Wp.setClass($_),Wp.setSVGClass($_);let $0={exactBoundingBox:!1};class $1 extends Zj{static getDefaults(){return{...super.getDefaults(),...$1.ownDefaults}}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),VK(this,"strokeDiff",void 0),Object.assign(this,$1.ownDefaults),this.setOptions(b),this.points=a;const{left:c,top:d}=b;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof c&&this.set(V2,c),"number"==typeof d&&this.set("top",d)}isOpen(){return!0}_projectStrokeOnPoints(a){return Zp(this.points,a,this.isOpen())}_calcDimensions(a){a={scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth,...a||{}};let b=this.exactBoundingBox?this._projectStrokeOnPoints(a).map(a=>a.projectedPoint):this.points;if(0===b.length)return{left:0,top:0,width:0,height:0,pathOffset:new Wv,strokeOffset:new Wv,strokeDiff:new Wv};let c=Xr(b),d=WY({...a,scaleX:1,scaleY:1}),e=Xr(this.points.map(a=>WM(a,d,!0))),f=new Wv(this.scaleX,this.scaleY),g=c.left+c.width/2,h=c.top+c.height/2;return this.exactBoundingBox&&(g-=h*Math.tan(WJ(this.skewX)),h-=g*Math.tan(WJ(this.skewY))),{...c,pathOffset:new Wv(g,h),strokeOffset:new Wv(e.left,e.top).subtract(new Wv(c.left,c.top)).multiply(f),strokeDiff:new Wv(c.width,c.height).subtract(new Wv(e.width,e.height)).multiply(f)}}_findCenterFromElement(){let a=Xr(this.points);return new Wv(a.left+a.width/2,a.top+a.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(a){let{left:b,top:c,width:d,height:e,pathOffset:f,strokeOffset:g,strokeDiff:h}=this._calcDimensions();this.set({width:d,height:e,pathOffset:f,strokeOffset:g,strokeDiff:h}),a&&this.setPositionByOrigin(new Wv(b+d/2,c+e/2),V1,V1)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Wv(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){var b,c,d,e;let f;if(Object.keys(a).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){let{width:d,height:e}=this._calcDimensions(a);f=new Wv(null!=(b=a.width)?b:d,null!=(c=a.height)?c:e)}else f=new Wv(null!=(d=a.width)?d:this.width,null!=(e=a.height)?e:this.height);return f.multiply(new Wv(a.scaleX||this.scaleX,a.scaleY||this.scaleY))}return super._getTransformedDimensions(a)}_set(a,b){let c=this.initialized&&this[a]!==b,d=super._set(a,b);return this.exactBoundingBox&&c&&((a===Wg||a===Wh)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(a))&&this.setDimensions(),d}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{...super.toObject(a),points:this.points.map(a=>{let{x:b,y:c}=a;return{x:b,y:c}})}}_toSVG(){let a=this.pathOffset.x,b=this.pathOffset.y,c=VM.NUM_FRACTION_DIGITS,d=this.points.map(d=>{let{x:e,y:f}=d;return`${W3(e-a,c)},${W3(f-b,c)}`}).join(" ");return[`<${Xh(this.constructor.type).toLowerCase()} `,"COMMON_PARTS",`points="${d}" />
`]}_render(a){let b=this.points.length,c=this.pathOffset.x,d=this.pathOffset.y;if(b&&!isNaN(this.points[b-1].y)){a.beginPath(),a.moveTo(this.points[0].x-c,this.points[0].y-d);for(let e=0;e<b;e++){let b=this.points[e];a.lineTo(b.x-c,b.y-d)}this.isOpen()||a.closePath(),this._renderPaintInOrder(a)}}complexity(){return this.points.length}static async fromElement(a,b,c){let d=function(a){if(!a)return[];let b=a.replace(/,/g," ").trim().split(/\s+/),c=[];for(let a=0;a<b.length;a+=2)c.push({x:parseFloat(b[a]),y:parseFloat(b[a+1])});return c}(a.getAttribute("points")),{left:e,top:f,...g}=ZL(a,this.ATTRIBUTE_NAMES,c);return new this(d,{...g,...b})}static fromObject(a){return this._fromObject(a,{extraParam:"points"})}}VK($1,"ownDefaults",$0),VK($1,"type","Polyline"),VK($1,"layoutProperties",[Wi,Wj,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),VK($1,"cacheProperties",[...Yr,"points"]),VK($1,"ATTRIBUTE_NAMES",[...Zu]),Wp.setClass($1),Wp.setSVGClass($1);class $2 extends $1{isOpen(){return!1}}VK($2,"ownDefaults",$0),VK($2,"type","Polygon"),Wp.setClass($2),Wp.setSVGClass($2);class $3 extends Zj{isEmptyStyles(a){if(!this.styles||void 0!==a&&!this.styles[a])return!0;let b=void 0===a?this.styles:{line:this.styles[a]};for(let a in b)for(let c in b[a])for(let d in b[a][c])return!1;return!0}styleHas(a,b){if(!this.styles||void 0!==b&&!this.styles[b])return!1;let c=void 0===b?this.styles:{0:this.styles[b]};for(let b in c)for(let d in c[b])if(void 0!==c[b][d][a])return!0;return!1}cleanStyle(a){if(!this.styles)return!1;let b=this.styles,c,d,e=0,f=!0,g=0;for(let g in b){for(let h in c=0,b[g]){let i=b[g][h]||{};e++,void 0!==i[a]?(d?i[a]!==d&&(f=!1):d=i[a],i[a]===this[a]&&delete i[a]):f=!1,0!==Object.keys(i).length?c++:delete b[g][h]}0===c&&delete b[g]}for(let a=0;a<this._textLines.length;a++)g+=this._textLines[a].length;f&&e===g&&(this[a]=d,this.removeStyle(a))}removeStyle(a){let b,c,d;if(!this.styles)return;let e=this.styles;for(c in e){for(d in b=e[c])delete b[d][a],0===Object.keys(b[d]).length&&delete b[d];0===Object.keys(b).length&&delete e[c]}}_extendStyles(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a);this._getLineStyle(c)||this._setLineStyle(c);let e=W2({...this._getStyleDeclaration(c,d),...b},a=>void 0!==a);this._setStyleDeclaration(c,d,e)}getSelectionStyles(a,b,c){let d=[];for(let e=a;e<(b||a);e++)d.push(this.getStyleAtPosition(e,c));return d}getStyleAtPosition(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a);return b?this.getCompleteStyleDeclaration(c,d):this._getStyleDeclaration(c,d)}setSelectionStyles(a,b,c){for(let d=b;d<(c||b);d++)this._extendStyles(d,a);this._forceClearCache=!0}_getStyleDeclaration(a,b){var c;let d=this.styles&&this.styles[a];return d&&null!=(c=d[b])?c:{}}getCompleteStyleDeclaration(a,b){return{...W1(this,this.constructor._styleProperties),...this._getStyleDeclaration(a,b)}}_setStyleDeclaration(a,b,c){this.styles[a][b]=c}_deleteStyleDeclaration(a,b){delete this.styles[a][b]}_getLineStyle(a){return!!this.styles[a]}_setLineStyle(a){this.styles[a]={}}_deleteLineStyle(a){delete this.styles[a]}}VK($3,"_styleProperties",Ya);let $4=/  +/g,$5=/"/g;function $6(a,b,c,d,e){return`		${function(a,b){let{left:c,top:d,width:e,height:f}=b,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:VM.NUM_FRACTION_DIGITS,h=X2(Wk,a,!1),[i,j,k,l]=[c,d,e,f].map(a=>W3(a,g));return`<rect ${h} x="${i}" y="${j}" width="${k}" height="${l}"></rect>`}(a,{left:b,top:c,width:d,height:e})}
`}class $7 extends $3{static getDefaults(){return{...super.getDefaults(),...$7.ownDefaults}}constructor(a,b){super(),VK(this,"__charBounds",[]),Object.assign(this,$7.ownDefaults),this.setOptions(b),this.styles||(this.styles={}),this.text=a,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){let a=this.path;a&&(a.segmentsInfo=$f(a.path))}_splitText(){let a=this._splitTextIntoLines(this.text);return this.textLines=a.lines,this._textLines=a.graphemeLines,this._unwrappedTextLines=a._unwrappedLines,this._text=a.graphemeText,a}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Yb)&&this.enlargeSpaces()}enlargeSpaces(){let a,b,c,d,e,f,g;for(let h=0,i=this._textLines.length;h<i;h++)if((this.textAlign===Yb||h!==i-1&&!this.isEndOfWrapping(h))&&(d=0,e=this._textLines[h],(b=this.getLineWidth(h))<this.width&&(g=this.textLines[h].match(this._reSpacesAndTabs)))){c=g.length,a=(this.width-b)/c;for(let b=0;b<=e.length;b++)f=this.__charBounds[h][b],this._reSpaceAndTab.test(e[b])?(f.width+=a,f.kernedWidth+=a,f.left+=d,d+=a):f.left+=d}}isEndOfWrapping(a){return a===this._textLines.length-1}missingNewlineOffset(a){return 1}get2DCursorLocation(a,b){let c,d=b?this._unwrappedTextLines:this._textLines;for(c=0;c<d.length;c++){if(a<=d[c].length)return{lineIndex:c,charIndex:a};a-=d[c].length+this.missingNewlineOffset(c,b)}return{lineIndex:c-1,charIndex:d[c-1].length<a?d[c-1].length:a}}toString(){return`#<Text (${this.complexity()}): { "text": "${this.text}", "fontFamily": "${this.fontFamily}" }>`}_getCacheCanvasDimensions(){let a=super._getCacheCanvasDimensions(),b=this.fontSize;return a.width+=b*a.zoomX,a.height+=b*a.zoomY,a}_render(a){let b=this.path;b&&!b.isNotVisible()&&b._render(a),this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")}_renderText(a){this.paintFirst===Wl?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))}_setTextStyles(a,b,c){if(a.textBaseline="alphabetic",this.path)switch(this.pathAlign){case V1:a.textBaseline="middle";break;case"ascender":a.textBaseline="top";break;case"descender":a.textBaseline=V3}a.font=this._getFontDeclaration(b,c)}calcTextWidth(){let a=this.getLineWidth(0);for(let b=1,c=this._textLines.length;b<c;b++){let c=this.getLineWidth(b);c>a&&(a=c)}return a}_renderTextLine(a,b,c,d,e,f){this._renderChars(a,b,c,d,e,f)}_renderTextLinesBackground(a){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;let b=a.fillStyle,c=this._getLeftOffset(),d=this._getTopOffset();for(let b=0,e=this._textLines.length;b<e;b++){let e=this.getHeightOfLine(b);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",b)){d+=e;continue}let f=this._textLines[b].length,g=this._getLineLeftOffset(b),h,i,j=0,k=0,l=this.getValueOfPropertyAt(b,0,"textBackgroundColor"),m=this.getHeightOfLineImpl(b);for(let e=0;e<f;e++){let f=this.__charBounds[b][e];i=this.getValueOfPropertyAt(b,e,"textBackgroundColor"),this.path?(a.save(),a.translate(f.renderLeft,f.renderTop),a.rotate(f.angle),a.fillStyle=i,i&&a.fillRect(-f.width/2,-m*(1-this._fontSizeFraction),f.width,m),a.restore()):i!==l?(h=c+g+k,"rtl"===this.direction&&(h=this.width-h-j),a.fillStyle=l,l&&a.fillRect(h,d,j,m),k=f.left,j=f.width,l=i):j+=f.kernedWidth}i&&!this.path&&(h=c+g+k,"rtl"===this.direction&&(h=this.width-h-j),a.fillStyle=i,a.fillRect(h,d,j,m)),d+=e}a.fillStyle=b,this._removeShadow(a)}_measureChar(a,b,c,d){let e,f,g,h,i=VV.getFontCache(b),j=this._getFontDeclaration(b),k=c?c+a:a,m=c&&j===this._getFontDeclaration(d),n=b.fontSize/this.CACHE_FONT_SIZE;if(c&&i.has(c)&&(g=i.get(c)),i.has(a)&&(h=e=i.get(a)),m&&i.has(k)&&(h=(f=i.get(k))-g),void 0===e||void 0===g||void 0===f){let d=(l||(l=WG({width:0,height:0}).getContext("2d")),l);this._setTextStyles(d,b,!0),void 0===e&&(h=e=d.measureText(a).width,i.set(a,e)),void 0===g&&m&&c&&(g=d.measureText(c).width,i.set(c,g)),m&&void 0===f&&(f=d.measureText(k).width,i.set(k,f),h=f-g)}return{width:e*n,kernedWidth:h*n}}getHeightOfChar(a,b){return this.getValueOfPropertyAt(a,b,"fontSize")}measureLine(a){let b=this._measureLine(a);return 0!==this.charSpacing&&(b.width-=this._getWidthOfCharSpacing()),b.width<0&&(b.width=0),b}_measureLine(a){let b,c,d=0,e=this.pathSide===V4,f=this.path,g=this._textLines[a],h=g.length,i=Array(h);this.__charBounds[a]=i;for(let e=0;e<h;e++){let f=g[e];c=this._getGraphemeBox(f,a,e,b),i[e]=c,d+=c.kernedWidth,b=f}if(i[h]={left:c?c.left+c.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},f&&f.segmentsInfo){let a=0,b=f.segmentsInfo[f.segmentsInfo.length-1].length;switch(this.textAlign){case V2:a=e?b-d:0;break;case V1:a=(b-d)/2;break;case V4:a=e?0:b-d}a+=this.pathStartOffset*(e?-1:1);for(let d=e?h-1:0;e?d>=0:d<h;e?d--:d++)c=i[d],a>b?a%=b:a<0&&(a+=b),this._setGraphemeOnPath(a,c),a+=c.kernedWidth}return{width:d,numOfSpaces:0}}_setGraphemeOnPath(a,b){let c=a+b.kernedWidth/2,d=this.path,e=$g(d.path,c,d.segmentsInfo);b.renderLeft=e.x-d.pathOffset.x,b.renderTop=e.y-d.pathOffset.y,b.angle=e.angle+(this.pathSide===V4?Math.PI:0)}_getGraphemeBox(a,b,c,d,e){let f=this.getCompleteStyleDeclaration(b,c),g=d?this.getCompleteStyleDeclaration(b,c-1):{},h=this._measureChar(a,f,d,g),i,j=h.kernedWidth,k=h.width;0!==this.charSpacing&&(k+=i=this._getWidthOfCharSpacing(),j+=i);let l={width:k,left:0,height:f.fontSize,kernedWidth:j,deltaY:f.deltaY};if(c>0&&!e){let a=this.__charBounds[b][c-1];l.left=a.left+a.width+h.kernedWidth-h.width}return l}getHeightOfLineImpl(a){let b=this.__lineHeights;if(b[a])return b[a];let c=this.getHeightOfChar(a,0);for(let b=1,d=this._textLines[a].length;b<d;b++)c=Math.max(this.getHeightOfChar(a,b),c);return b[a]=c*this._fontSizeMult}getHeightOfLine(a){return this.getHeightOfLineImpl(a)*this.lineHeight}calcTextHeight(){let a=0;for(let b=0,c=this._textLines.length;b<c;b++)a+=b===c-1?this.getHeightOfLineImpl(b):this.getHeightOfLine(b);return a}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(a,b){a.save();let c=0,d=this._getLeftOffset(),e=this._getTopOffset();for(let f=0,g=this._textLines.length;f<g;f++)this._renderTextLine(b,a,this._textLines[f],d+this._getLineLeftOffset(f),e+c+this.getHeightOfLineImpl(f),f),c+=this.getHeightOfLine(f);a.restore()}_renderTextFill(a){(this.fill||this.styleHas(Wk))&&this._renderTextCommon(a,"fillText")}_renderTextStroke(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())}_renderChars(a,b,c,d,e,f){let g=this.textAlign.includes(Yb),h=this.path,i=!g&&0===this.charSpacing&&this.isEmptyStyles(f)&&!h,j="ltr"===this.direction,k="ltr"===this.direction?1:-1,l=b.direction,m,n,o,p,q,r="",s=0;if(b.save(),l!==this.direction&&(b.canvas.setAttribute("dir",j?"ltr":"rtl"),b.direction=j?"ltr":"rtl",b.textAlign=j?V2:V4),e-=this.getHeightOfLineImpl(f)*this._fontSizeFraction,i)return this._renderChar(a,b,f,0,c.join(""),d,e),void b.restore();for(let i=0,j=c.length-1;i<=j;i++)p=i===j||this.charSpacing||h,r+=c[i],o=this.__charBounds[f][i],0===s?(d+=k*(o.kernedWidth-o.width),s+=o.width):s+=o.kernedWidth,g&&!p&&this._reSpaceAndTab.test(c[i])&&(p=!0),p||(p=Zr(m=m||this.getCompleteStyleDeclaration(f,i),n=this.getCompleteStyleDeclaration(f,i+1),!1)),p&&(h?(b.save(),b.translate(o.renderLeft,o.renderTop),b.rotate(o.angle),this._renderChar(a,b,f,i,r,-s/2,0),b.restore()):(q=d,this._renderChar(a,b,f,i,r,q,e)),r="",m=n,d+=k*s,s=0);b.restore()}_applyPatternGradientTransformText(a){let b=this.width+this.strokeWidth,c=this.height+this.strokeWidth,d=WG({width:b,height:c}),e=d.getContext("2d");return d.width=b,d.height=c,e.beginPath(),e.moveTo(0,0),e.lineTo(b,0),e.lineTo(b,c),e.lineTo(0,c),e.closePath(),e.translate(b/2,c/2),e.fillStyle=a.toLive(e),this._applyPatternGradientTransform(e,a),e.fill(),e.createPattern(d,"no-repeat")}handleFiller(a,b,c){let d,e;return W5(c)?"percentage"===c.gradientUnits||c.gradientTransform||c.patternTransform?(d=-this.width/2,e=-this.height/2,a.translate(d,e),a[b]=this._applyPatternGradientTransformText(c),{offsetX:d,offsetY:e}):(a[b]=c.toLive(a),this._applyPatternGradientTransform(a,c)):(a[b]=c,{offsetX:0,offsetY:0})}_setStrokeStyles(a,b){let{stroke:c,strokeWidth:d}=b;return a.lineWidth=d,a.lineCap=this.strokeLineCap,a.lineDashOffset=this.strokeDashOffset,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,this.handleFiller(a,"strokeStyle",c)}_setFillStyles(a,b){let{fill:c}=b;return this.handleFiller(a,"fillStyle",c)}_renderChar(a,b,c,d,e,f,g){let h=this._getStyleDeclaration(c,d),i=this.getCompleteStyleDeclaration(c,d),j="fillText"===a&&i.fill,k="strokeText"===a&&i.stroke&&i.strokeWidth;if(k||j){if(b.save(),b.font=this._getFontDeclaration(i),h.textBackgroundColor&&this._removeShadow(b),h.deltaY&&(g+=h.deltaY),j){let a=this._setFillStyles(b,i);b.fillText(e,f-a.offsetX,g-a.offsetY)}if(k){let a=this._setStrokeStyles(b,i);b.strokeText(e,f-a.offsetX,g-a.offsetY)}b.restore()}}setSuperscript(a,b){this._setScript(a,b,this.superscript)}setSubscript(a,b){this._setScript(a,b,this.subscript)}_setScript(a,b,c){let d=this.get2DCursorLocation(a,!0),e=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),f=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),g={fontSize:e*c.size,deltaY:f+e*c.baseline};this.setSelectionStyles(g,a,b)}_getLineLeftOffset(a){let b=this.getLineWidth(a),c=this.width-b,d=this.textAlign,e=this.direction,f=this.isEndOfWrapping(a),g=0;return d!==Yb&&(d!==Ye||f)&&(d!==Yd||f)&&(d!==Yc||f)?(d===V1&&(g=c/2),d===V4&&(g=c),d===Ye&&(g=c/2),d===Yd&&(g=c),"rtl"===e&&(d===V4||d===Yd?g=0:d===V2||d===Yc?g=-c:d!==V1&&d!==Ye||(g=-c/2)),g):0}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(a){if(void 0!==this.__lineWidths[a])return this.__lineWidths[a];let{width:b}=this.measureLine(a);return this.__lineWidths[a]=b,b}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(a,b,c){var d;return null!=(d=this._getStyleDeclaration(a,b)[c])?d:this[c]}_renderTextDecoration(a,b){if(!this[b]&&!this.styleHas(b))return;let c=this._getTopOffset(),d=this._getLeftOffset(),e=this.path,f=this._getWidthOfCharSpacing(),g="linethrough"===b?.5:+("overline"===b),h=this.offsets[b];for(let i=0,j=this._textLines.length;i<j;i++){let j=this.getHeightOfLine(i);if(!this[b]&&!this.styleHas(b,i)){c+=j;continue}let k=this._textLines[i],l=j/this.lineHeight,m=this._getLineLeftOffset(i),n=0,o=0,p=this.getValueOfPropertyAt(i,0,b),q=this.getValueOfPropertyAt(i,0,Wk),r=this.getValueOfPropertyAt(i,0,X5),s=p,t=q,u=r,v=c+l*(1-this._fontSizeFraction),w=this.getHeightOfChar(i,0),y=this.getValueOfPropertyAt(i,0,"deltaY");for(let c=0,f=k.length;c<f;c++){let f=this.__charBounds[i][c];s=this.getValueOfPropertyAt(i,c,b),t=this.getValueOfPropertyAt(i,c,Wk),u=this.getValueOfPropertyAt(i,c,X5);let j=this.getHeightOfChar(i,c),k=this.getValueOfPropertyAt(i,c,"deltaY");if(e&&s&&t){let b=this.fontSize*u/1e3;a.save(),a.fillStyle=q,a.translate(f.renderLeft,f.renderTop),a.rotate(f.angle),a.fillRect(-f.kernedWidth/2,h*j+k-g*b,f.kernedWidth,b),a.restore()}else if((s!==p||t!==q||j!==w||u!==r||k!==y)&&o>0){let b=this.fontSize*r/1e3,c=d+m+n;"rtl"===this.direction&&(c=this.width-c-o),p&&q&&r&&(a.fillStyle=q,a.fillRect(c,v+h*w+y-g*b,o,b)),n=f.left,o=f.width,p=s,r=u,q=t,w=j,y=k}else o+=f.kernedWidth}let z=d+m+n;"rtl"===this.direction&&(z=this.width-z-o),a.fillStyle=t;let A=this.fontSize*u/1e3;s&&t&&u&&a.fillRect(z,v+h*w+y-g*A,o-f,A),c+=j}this._removeShadow(a)}_getFontDeclaration(){let{fontFamily:a=this.fontFamily,fontStyle:b=this.fontStyle,fontWeight:c=this.fontWeight,fontSize:d=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,f=a.includes("'")||a.includes('"')||a.includes(",")||$7.genericFonts.includes(a.toLowerCase())?a:`"${a}"`;return[b,c,`${e?this.CACHE_FONT_SIZE:d}px`,f].join(" ")}render(a){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(a)))}graphemeSplit(a){return Xi(a)}_splitTextIntoLines(a){let b=a.split(this._reNewline),c=Array(b.length),d=["\n"],e=[];for(let a=0;a<b.length;a++)c[a]=this.graphemeSplit(b[a]),e=e.concat(c[a],d);return e.pop(),{_unwrappedLines:c,lines:b,graphemeText:e,graphemeLines:c}}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{...super.toObject([...X9,...a]),styles:Zs(this.styles,this.text),...this.path?{path:this.path.toObject()}:{}}}set(a,b){let{textLayoutProperties:c}=this.constructor;super.set(a,b);let d=!1,e=!1;if("object"==typeof a)for(let b in a)"path"===b&&this.setPathInfo(),d=d||c.includes(b),e=e||"path"===b;else d=c.includes(a),e="path"===a;return e&&this.setPathInfo(),d&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(a,b,c){let d=ZL(a,$7.ATTRIBUTE_NAMES,c),{textAnchor:e=V2,textDecoration:f="",dx:g=0,dy:h=0,top:i=0,left:j=0,fontSize:k=16,strokeWidth:l=1,...m}={...b,...d},n=new this((a.textContent||"").replace(/\s+/g," ").trim(),{left:j+g,top:i+h,underline:f.includes("underline"),overline:f.includes("overline"),linethrough:f.includes("line-through"),strokeWidth:0,fontSize:k,...m}),o=n.getScaledHeight()/n.height,p=((n.height+n.strokeWidth)*n.lineHeight-n.height)*o,q=n.getScaledHeight()+p,r=0;return e===V1&&(r=n.getScaledWidth()/2),e===V4&&(r=n.getScaledWidth()),n.set({left:n.left-r,top:n.top-(q-n.fontSize*(.07+n._fontSizeFraction))/n.lineHeight,strokeWidth:l}),n}static fromObject(a){return this._fromObject({...a,styles:Zt(a.styles||{},a.text)},{extraParam:"text"})}}VK($7,"textLayoutProperties",X8),VK($7,"cacheProperties",[...Yr,...X9]),VK($7,"ownDefaults",{_reNewline:V6,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:Wn,fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:V2,fontStyle:Wn,lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:V2,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[X5]:66.667}),VK($7,"type","Text"),VK($7,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),VK($7,"ATTRIBUTE_NAMES",Zu.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Zi($7,[class extends X3{_toSVG(){let a=this._getSVGLeftTopOffsets(),b=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(b)}toSVG(a){let b=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),c=this.path;return c?b+c._createBaseSVGMarkup(c._toSVG(),{reviver:a,withShadow:!0,additionalTransform:W4(this.calcOwnMatrix())}):b}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(a){let{textBgRects:b,textSpans:c}=a,d=this.getSvgTextDecoration(this);return[b.join(""),'		<text xml:space="preserve" ',`font-family="${Xh(this.fontFamily.replace($5,"'"))}" `,`font-size="${Xh(this.fontSize)}" `,this.fontStyle?`font-style="${Xh(this.fontStyle)}" `:"",this.fontWeight?`font-weight="${Xh(this.fontWeight)}" `:"",d?`text-decoration="${d}" `:"","rtl"===this.direction?'direction="rtl" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",c.join(""),"</text>\n"]}_getSVGTextAndBg(a,b){let c=[],d=[],e,f=a;this.backgroundColor&&d.push($6(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let a=0,g=this._textLines.length;a<g;a++)e=this._getLineLeftOffset(a),"rtl"===this.direction&&(e+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(d,a,b+e,f),this._setSVGTextLineText(c,a,b+e,f),f+=this.getHeightOfLine(a);return{textSpans:c,textBgRects:d}}_createTextCharSpan(a,b,c,d,e){let f=VM.NUM_FRACTION_DIGITS,g=this.getSvgSpanStyles(b,a!==a.trim()||!!a.match($4)),h=g?`style="${g}"`:"",i=b.deltaY,j=i?` dy="${W3(i,f)}" `:"",{angle:k,renderLeft:l,renderTop:m,width:n}=e,o="";if(void 0!==l){k&&(o=` rotate="${W3(WK(k),f)}"`);let a=WT({angle:WK(k)});a[4]=l,a[5]=m;let b=new Wv(-(n/2),0).transform(a);c=b.x,d=b.y}return`<tspan x="${W3(c,f)}" y="${W3(d,f)}" ${j}${o}${h}>${Xh(a)}</tspan>`}_setSVGTextLineText(a,b,c,d){let e=this.getHeightOfLine(b),f=this.textAlign.includes(Yb),g=this._textLines[b],h,i,j,k,l,m="",n=0;d+=e*(1-this._fontSizeFraction)/this.lineHeight;for(let e=0,o=g.length-1;e<=o;e++)l=e===o||this.charSpacing||this.path,m+=g[e],j=this.__charBounds[b][e],0===n?(c+=j.kernedWidth-j.width,n+=j.width):n+=j.kernedWidth,f&&!l&&this._reSpaceAndTab.test(g[e])&&(l=!0),l||(l=Zr(h=h||this.getCompleteStyleDeclaration(b,e),i=this.getCompleteStyleDeclaration(b,e+1),!0)),l&&(k=this._getStyleDeclaration(b,e),a.push(this._createTextCharSpan(m,k,c,d,j)),m="",h=i,"rtl"===this.direction?c-=n:c+=n,n=0)}_setSVGTextLineBg(a,b,c,d){let e=this._textLines[b],f=this.getHeightOfLine(b)/this.lineHeight,g,h=0,i=0,j=this.getValueOfPropertyAt(b,0,"textBackgroundColor");for(let k=0;k<e.length;k++){let{left:e,width:l,kernedWidth:m}=this.__charBounds[b][k];(g=this.getValueOfPropertyAt(b,k,"textBackgroundColor"))!==j?(j&&a.push($6(j,c+i,d,h,f)),i=e,h=l,j=g):h+=m}g&&a.push($6(j,c+i,d,h,f))}getSvgStyles(a){return`${super.getSvgStyles(a)} text-decoration-thickness: ${W3(this.textDecorationThickness*this.getObjectScaling().y/10,VM.NUM_FRACTION_DIGITS)}%; white-space: pre;`}getSvgSpanStyles(a,b){let{fontFamily:c,strokeWidth:d,stroke:e,fill:f,fontSize:g,fontStyle:h,fontWeight:i,textDecorationThickness:j,linethrough:k,overline:l,underline:m}=a,n=this.getSvgTextDecoration({underline:null!=m?m:this.underline,overline:null!=l?l:this.overline,linethrough:null!=k?k:this.linethrough}),o=j||this.textDecorationThickness;return[e?X2(Wl,e):"",d?`stroke-width: ${Xh(d)}; `:"",c?`font-family: ${c.includes("'")||c.includes('"')?Xh(c):`'${Xh(c)}'`}; `:"",g?`font-size: ${Xh(g)}px; `:"",h?`font-style: ${Xh(h)}; `:"",i?`font-weight: ${Xh(i)}; `:"",n?`text-decoration: ${n}; text-decoration-thickness: ${W3(o*this.getObjectScaling().y/10,VM.NUM_FRACTION_DIGITS)}%; `:"",f?X2(Wk,f):"",b?"white-space: pre; ":""].join("")}getSvgTextDecoration(a){return["overline","underline","line-through"].filter(b=>a[b.replace("-","")]).join(" ")}}]),Wp.setClass($7),Wp.setSVGClass($7);class $8{constructor(a){VK(this,"target",void 0),VK(this,"__mouseDownInPlace",!1),VK(this,"__dragStartFired",!1),VK(this,"__isDraggingOver",!1),VK(this,"__dragStartSelection",void 0),VK(this,"__dragImageDisposer",void 0),VK(this,"_dispose",void 0),this.target=a;const b=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{b.forEach(a=>a()),this._dispose=void 0}}isPointerOverSelection(a){let b=this.target,c=b.getSelectionStartFromPointer(a);return b.isEditing&&c>=b.selectionStart&&c<=b.selectionEnd&&b.selectionStart<b.selectionEnd}start(a){return this.__mouseDownInPlace=this.isPointerOverSelection(a)}isActive(){return this.__mouseDownInPlace}end(a){let b=this.isActive();return b&&!this.__dragStartFired&&(this.target.setCursorByClick(a),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,b}getDragStartSelection(){return this.__dragStartSelection}setDragImage(a,b){var c;let{selectionStart:d,selectionEnd:e}=b,f=this.target,g=f.canvas,h=new Wv(f.flipX?-1:1,f.flipY?-1:1),i=f._getCursorBoundaries(d),j=new Wv(i.left+i.leftOffset,i.top+i.topOffset).multiply(h).transform(f.calcTransformMatrix()),k=g.getScenePoint(a).subtract(j),l=f.getCanvasRetinaScaling(),m=f.getBoundingRect(),n=j.subtract(new Wv(m.left,m.top)),o=g.viewportTransform,p=n.add(k).transform(o,!0),q=f.backgroundColor,r=Zq(f.styles);f.backgroundColor="";let s={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};f.setSelectionStyles(s,0,d),f.setSelectionStyles(s,e,f.text.length),f.dirty=!0;let t=f.toCanvasElement({enableRetinaScaling:g.enableRetinaScaling,viewportTransform:!0});f.backgroundColor=q,f.styles=r,f.dirty=!0,$n(t,{position:"fixed",left:-t.width+"px",border:V5,width:t.width/l+"px",height:t.height/l+"px"}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{t.remove()},Xa(a.target||this.target.hiddenTextarea).body.appendChild(t),null==(c=a.dataTransfer)||c.setDragImage(t,p.x,p.y)}onDragStart(a){this.__dragStartFired=!0;let b=this.target,c=this.isActive();if(c&&a.dataTransfer){let c=this.__dragStartSelection={selectionStart:b.selectionStart,selectionEnd:b.selectionEnd},d=b._text.slice(c.selectionStart,c.selectionEnd).join(""),e={text:b.text,value:d,...c};a.dataTransfer.setData("text/plain",d),a.dataTransfer.setData("application/fabric",JSON.stringify({value:d,styles:b.getSelectionStyles(c.selectionStart,c.selectionEnd,!0)})),a.dataTransfer.effectAllowed="copyMove",this.setDragImage(a,e)}return b.abortCursorAnimation(),c}canDrop(a){if(this.target.editable&&!this.target.getActiveControl()&&!a.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){let b=this.target.getSelectionStartFromPointer(a),c=this.__dragStartSelection;return b<c.selectionStart||b>c.selectionEnd}return!0}return!1}targetCanDrop(a){return this.target.canDrop(a)}dragEnterHandler(a){let{e:b}=a,c=this.targetCanDrop(b);!this.__isDraggingOver&&c&&(this.__isDraggingOver=!0)}dragOverHandler(a){let{e:b}=a,c=this.targetCanDrop(b);!this.__isDraggingOver&&c?this.__isDraggingOver=!0:this.__isDraggingOver&&!c&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(b.preventDefault(),a.canDrop=!0,a.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(a){var b;let{e:c}=a,d=c.defaultPrevented;this.__isDraggingOver=!1,c.preventDefault();let e=null==(b=c.dataTransfer)?void 0:b.getData("text/plain");if(e&&!d){let b=this.target,d=b.canvas,f=b.getSelectionStartFromPointer(c),{styles:g}=c.dataTransfer.types.includes("application/fabric")?JSON.parse(c.dataTransfer.getData("application/fabric")):{},h=e[Math.max(0,e.length-1)];if(this.__dragStartSelection){let a=this.__dragStartSelection.selectionStart,c=this.__dragStartSelection.selectionEnd;f>a&&f<=c?f=a:f>c&&(f-=c-a),b.removeChars(a,c),delete this.__dragStartSelection}b._reNewline.test(h)&&(b._reNewline.test(b._text[f])||f===b._text.length)&&(e=e.trimEnd()),a.didDrop=!0,a.dropTarget=b,b.insertChars(e,g,f),d.setActiveObject(b),b.enterEditing(c),b.selectionStart=Math.min(f+0,b._text.length),b.selectionEnd=Math.min(b.selectionStart+e.length,b._text.length),b.hiddenTextarea.value=b.text,b._updateTextarea(),b.hiddenTextarea.focus(),b.fire(We,{index:f+0,action:"drop"}),d.fire("text:changed",{target:b}),d.contextTopDirty=!0,d.requestRenderAll()}}dragEndHandler(a){let{e:b}=a;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var c;let a=this.target,d=this.target.canvas,{selectionStart:e,selectionEnd:f}=this.__dragStartSelection,g=(null==(c=b.dataTransfer)?void 0:c.dropEffect)||V5;g===V5?(a.selectionStart=e,a.selectionEnd=f,a._updateTextarea(),a.hiddenTextarea.focus()):(a.clearContextTop(),"move"===g&&(a.removeChars(e,f),a.selectionStart=a.selectionEnd=e,a.hiddenTextarea&&(a.hiddenTextarea.value=a.text),a._updateTextarea(),a.fire(We,{index:e,action:"dragend"}),d.fire("text:changed",{target:a}),d.requestRenderAll()),a.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}let $9=/[ \n\.,;!\?\-]/;class _a extends $7{constructor(){super(...arguments),VK(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(a){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(a)}_animateCursor(a){let{toValue:b,duration:c,delay:d,onComplete:e}=a;return YF({startValue:this._currentCursorOpacity,endValue:b,duration:c,delay:d,onComplete:e,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:a=>{this._currentCursorOpacity=a,this.renderCursorOrSelection()}})}_tick(a){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(a||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var a;null==(a=this._currentTickCompleteState)||a.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(a){this.abortCursorAnimation(),this._tick(a?0:this.cursorDelay)}abortCursorAnimation(){let a=!1;[this._currentTickState,this._currentTickCompleteState].forEach(b=>{b&&!b.isDone()&&(a=!0,b.abort())}),this._currentCursorOpacity=1,a&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(a=>!a||a.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(a){let b=0,c=a-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c--;for(;/\S/.test(this._text[c])&&c>-1;)b++,c--;return a-b}findWordBoundaryRight(a){let b=0,c=a;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)b++,c++;for(;/\S/.test(this._text[c])&&c<this._text.length;)b++,c++;return a+b}findLineBoundaryLeft(a){let b=0,c=a-1;for(;!/\n/.test(this._text[c])&&c>-1;)b++,c--;return a-b}findLineBoundaryRight(a){let b=0,c=a;for(;!/\n/.test(this._text[c])&&c<this._text.length;)b++,c++;return a+b}searchWordBoundary(a,b){let c=this._text,d=a>0&&this._reSpace.test(c[a])&&(-1===b||!V6.test(c[a-1]))?a-1:a,e=c[d];for(;d>0&&d<c.length&&!$9.test(e);)d+=b,e=c[d];return -1===b&&$9.test(e)&&d++,d}selectWord(a){a=null!=a?a:this.selectionStart;let b=this.searchWordBoundary(a,-1),c=Math.max(b,this.searchWordBoundary(a,1));this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(a){a=null!=a?a:this.selectionStart;let b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(a){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",a?{e:a}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:a}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(a){if(this.getActiveControl())return;let b=this.hiddenTextarea;Xa(b).activeElement!==b&&b.focus();let c=this.getSelectionStartFromPointer(a),d=this.selectionStart,e=this.selectionEnd;(c===this.__selectionStartOnMouseDown&&d!==e||d!==c&&e!==c)&&(c>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=c):(this.selectionStart=c,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===d&&this.selectionEnd===e||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(a,b,c){let d=c.slice(0,a),e=this.graphemeSplit(d).length;if(a===b)return{selectionStart:e,selectionEnd:e};let f=c.slice(a,b);return{selectionStart:e,selectionEnd:e+this.graphemeSplit(f).length}}fromGraphemeToStringSelection(a,b,c){let d=c.slice(0,a).join("").length;return a===b?{selectionStart:d,selectionEnd:d}:{selectionStart:d,selectionEnd:d+c.slice(a,b).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){let a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){let{hiddenTextarea:a,direction:b,textAlign:c,inCompositionMode:d}=this;if(!a)return;let e=c!==Yb?c.replace("justify-",""):"ltr"===b?V2:V4,f=this.getPositionByOrigin(e,"top");this.cursorOffsetCache={},this.text=a.value,this.set("dirty",!0),this.initDimensions(),this.setPositionByOrigin(f,e,"top"),this.setCoords();let g=this.fromStringToGraphemeSelection(a.selectionStart,a.selectionEnd,a.value);this.selectionEnd=this.selectionStart=g.selectionEnd,d||(this.selectionStart=g.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){let a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};let a=this.inCompositionMode?this.compositionStart:this.selectionStart,b=this._getCursorBoundaries(a),c=this.get2DCursorLocation(a),d=c.lineIndex,e=c.charIndex,f=this.getValueOfPropertyAt(d,e,"fontSize")*this.lineHeight,g=b.leftOffset,h=this.getCanvasRetinaScaling(),i=this.canvas.upperCanvasEl,j=i.width/h,k=i.height/h,l=j-f,m=k-f,n=new Wv(b.left+g,b.top+b.topOffset+f).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Wv(i.clientWidth/j,i.clientHeight/k));return n.x<0&&(n.x=0),n.x>l&&(n.x=l),n.y<0&&(n.y=0),n.y>m&&(n.y=m),n.x+=this.canvas._offset.left,n.y+=this.canvas._offset.top,{left:`${n.x}px`,top:`${n.y}px`,fontSize:`${f}px`,charHeight:f}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}exitEditingImpl(){let a=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){let a=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),a&&this.fire(Wm),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(let a in this.styles)this._textLines[a]||delete this.styles[a]}removeStyleFromTo(a,b){let{lineIndex:c,charIndex:d}=this.get2DCursorLocation(a,!0),{lineIndex:e,charIndex:f}=this.get2DCursorLocation(b,!0);if(c!==e){if(this.styles[c])for(let a=d;a<this._unwrappedTextLines[c].length;a++)delete this.styles[c][a];if(this.styles[e])for(let a=f;a<this._unwrappedTextLines[e].length;a++){let b=this.styles[e][a];b&&(this.styles[c]||(this.styles[c]={}),this.styles[c][d+a-f]=b)}for(let a=c+1;a<=e;a++)delete this.styles[a];this.shiftLineStyles(e,c-e)}else if(this.styles[c]){let a=this.styles[c],b=f-d;for(let b=d;b<f;b++)delete a[b];for(let d in this.styles[c]){let c=parseInt(d,10);c>=f&&(a[c-b]=a[d],delete a[d])}}}shiftLineStyles(a,b){let c=Object.assign({},this.styles);for(let d in this.styles){let e=parseInt(d,10);e>a&&(this.styles[e+b]=c[e],c[e-b]||delete this.styles[e])}}insertNewlineStyleObject(a,b,c,d){let e={},f=this._unwrappedTextLines[a].length,g=f===b,h=!1;c||(c=1),this.shiftLineStyles(a,c);let i=this.styles[a]?this.styles[a][0===b?b:b-1]:void 0;for(let c in this.styles[a]){let d=parseInt(c,10);d>=b&&(h=!0,e[d-b]=this.styles[a][c],g&&0===b||delete this.styles[a][c])}let j=!1;for(h&&!g&&(this.styles[a+c]=e,j=!0),(j||f>b)&&c--;c>0;)d&&d[c-1]?this.styles[a+c]={0:{...d[c-1]}}:i?this.styles[a+c]={0:{...i}}:delete this.styles[a+c],c--;this._forceClearCache=!0}insertCharStyleObject(a,b,c,d){this.styles||(this.styles={});let e=this.styles[a],f=e?{...e}:{};for(let a in c||(c=1),f){let d=parseInt(a,10);d>=b&&(e[d+c]=f[d],f[d-c]||delete e[d])}if(this._forceClearCache=!0,d){for(;c--;)Object.keys(d[c]).length&&(this.styles[a]||(this.styles[a]={}),this.styles[a][b+c]={...d[c]});return}if(!e)return;let g=e[b?b-1:1];for(;g&&c--;)this.styles[a][b+c]={...g}}insertNewStyleBlock(a,b,c){let d=this.get2DCursorLocation(b,!0),e=[0],f,g=0;for(let b=0;b<a.length;b++)"\n"===a[b]?e[++g]=0:e[g]++;for(e[0]>0&&(this.insertCharStyleObject(d.lineIndex,d.charIndex,e[0],c),c=c&&c.slice(e[0]+1)),g&&this.insertNewlineStyleObject(d.lineIndex,d.charIndex+e[0],g),f=1;f<g;f++)e[f]>0?this.insertCharStyleObject(d.lineIndex+f,0,e[f],c):c&&this.styles[d.lineIndex+f]&&c[0]&&(this.styles[d.lineIndex+f][0]=c[0]),c=c&&c.slice(e[f]+1);e[f]>0&&this.insertCharStyleObject(d.lineIndex+f,0,e[f],c)}removeChars(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a+1;this.removeStyleFromTo(a,b),this._text.splice(a,b-a),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(a,b,c){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;d>c&&this.removeStyleFromTo(c,d);let e=this.graphemeSplit(a);this.insertNewStyleBlock(e,c,b),this._text=[...this._text.slice(0,c),...e,...this._text.slice(d)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(a,b,c){c<=a?(b===a?this._selectionDirection=V2:this._selectionDirection===V4&&(this._selectionDirection=V2,this.selectionEnd=a),this.selectionStart=c):c>a&&c<b?this._selectionDirection===V4?this.selectionEnd=c:this.selectionStart=c:(b===a?this._selectionDirection=V4:this._selectionDirection===V2&&(this._selectionDirection=V4,this.selectionStart=b),this.selectionEnd=c)}}class _b extends _a{initHiddenTextarea(){let a=this.canvas&&Xa(this.canvas.getElement())||VT().document,b=a.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off",name:"fabricTextarea"}).map(a=>{let[c,d]=a;return b.setAttribute(c,d)});let{top:c,left:d,fontSize:e}=this._calcTextareaPosition();b.style.cssText=`position: absolute; top: ${c}; left: ${d}; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ${e};`,(this.hiddenTextareaContainer||a.body).appendChild(b),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(a=>{let[c,d]=a;return b.addEventListener(c,this[d].bind(this))}),this.hiddenTextarea=b}blur(){this.abortCursorAnimation()}onKeyDown(a){if(!this.isEditing)return;let b="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(a.keyCode in b)this[b[a.keyCode]](a);else{if(!(a.keyCode in this.ctrlKeysMapDown)||!a.ctrlKey&&!a.metaKey)return;this[this.ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(a){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this.ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(a){let b=this.fromPaste,{value:c,selectionStart:d,selectionEnd:e}=this.hiddenTextarea;if(this.fromPaste=!1,a&&a.stopPropagation(),!this.isEditing)return;let f=()=>{this.updateFromTextArea(),this.fire(We),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void f();let g=this._splitTextIntoLines(c).graphemeText,h=this._text.length,i=g.length,j=this.selectionStart,k=this.selectionEnd,l=j!==k,m,n,o,p,q=i-h,r=this.fromStringToGraphemeSelection(d,e,c),s=j>r.selectionStart;l?(n=this._text.slice(j,k),q+=k-j):i<h&&(n=s?this._text.slice(k+q,k):this._text.slice(j,j-q));let t=g.slice(r.selectionEnd-q,r.selectionEnd);if(n&&n.length&&(t.length&&(m=this.getSelectionStyles(j,j+1,!1),m=t.map(()=>m[0])),l?(o=j,p=k):s?(o=k-n.length,p=k):(o=k,p=k+n.length),this.removeStyleFromTo(o,p)),t.length){let{copyPasteData:a}=VT();b&&t.join("")===a.copiedText&&!VM.disableStyleCopyPaste&&(m=a.copiedTextStyle),this.insertNewStyleBlock(t,j,m)}f()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(a){let{target:b}=a,{selectionStart:c,selectionEnd:d}=b;this.compositionStart=c,this.compositionEnd=d,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;let{copyPasteData:a}=VT();a.copiedText=this.getSelectedText(),VM.disableStyleCopyPaste?a.copiedTextStyle=void 0:a.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(a,b){let c,d=this._getLineLeftOffset(a);return b>0&&(d+=(c=this.__charBounds[a][b-1]).left+c.width),d}getDownCursorOffset(a,b){let c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(e===this._textLines.length-1||a.metaKey||34===a.keyCode)return this._text.length-c;let f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e+1,g);return this._textLines[e].slice(f).length+h+1+this.missingNewlineOffset(e)}_getSelectionForOffset(a,b){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart}getUpCursorOffset(a,b){let c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(0===e||a.metaKey||33===a.keyCode)return-c;let f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e-1,g),i=this._textLines[e].slice(0,f),j=this.missingNewlineOffset(e-1);return-this._textLines[e-1].length+h-i.length+(1-j)}_getIndexOnLine(a,b){let c=this._textLines[a],d,e,f=this._getLineLeftOffset(a),g=0;for(let h=0,i=c.length;h<i;h++)if((f+=d=this.__charBounds[a][h].width)>b){e=!0;let a=Math.abs(f-d-b);g=Math.abs(f-b)<a?h:h-1;break}return e||(g=c.length-1),g}moveCursorDown(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)}moveCursorUp(a){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",a)}_moveCursorUpOrDown(a,b){let c=this[`get${a}CursorOffset`](b,this._selectionDirection===V4);if(b.shiftKey?this.moveCursorWithShift(c):this.moveCursorWithoutShift(c),0!==c){let a=this.text.length;this.selectionStart=Yp(0,this.selectionStart,a),this.selectionEnd=Yp(0,this.selectionEnd,a),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(a){let b=this._selectionDirection===V2?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,b),0!==a}moveCursorWithoutShift(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),0!==a}moveCursorLeft(a){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",a)}_move(a,b,c){let d;if(a.altKey)d=this[`findWordBoundary${c}`](this[b]);else{if(!a.metaKey&&35!==a.keyCode&&36!==a.keyCode)return this[b]+="Left"===c?-1:1,!0;d=this[`findLineBoundary${c}`](this[b])}return void 0!==d&&this[b]!==d&&(this[b]=d,!0)}_moveLeft(a,b){return this._move(a,b,"Left")}_moveRight(a,b){return this._move(a,b,"Right")}moveCursorLeftWithoutShift(a){let b=!0;return this._selectionDirection=V2,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,b}moveCursorLeftWithShift(a){return this._selectionDirection===V4&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=V2,this._moveLeft(a,"selectionStart")):void 0}moveCursorRight(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)}_moveCursorLeftOrRight(a,b){let c=`moveCursor${a}${b.shiftKey?"WithShift":"WithoutShift"}`;this._currentCursorOpacity=1,this[c](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(a){return this._selectionDirection===V2&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=V4,this._moveRight(a,"selectionEnd")):void 0}moveCursorRightWithoutShift(a){let b=!0;return this._selectionDirection=V4,this.selectionStart===this.selectionEnd?(b=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,b}}class _c extends _b{constructor(){super(...arguments),VK(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new $8(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(a){return this.draggableTextDelegate.onDragStart(a)}canDrop(a){return this.draggableTextDelegate.canDrop(a)}doubleClickHandler(a){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(a.e)),this.renderCursorOrSelection())}tripleClickHandler(a){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(a.e)),this.renderCursorOrSelection())}_mouseDownHandler(a){let{e:b,alreadySelected:c}=a;this.canvas&&this.editable&&!b.button&&!this.getActiveControl()&&(this.draggableTextDelegate.start(b)||(this.canvas.textEditingManager.register(this),c&&(this.inCompositionMode=!1,this.setCursorByClick(b)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=c||this.isEditing)))}mouseUpHandler(a){let{e:b,transform:c}=a,d=this.draggableTextDelegate.end(b);if(this.canvas){this.canvas.textEditingManager.unregister(this);let a=this.canvas._activeObject;if(a&&a!==this)return}!this.editable||this.group&&!this.group.interactive||c&&c.actionPerformed||b.button||d||this.selected&&!this.getActiveControl()&&(this.enterEditing(b),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(a){let b=this.getSelectionStartFromPointer(a),c=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(c,d,b):(this.selectionStart=b,this.selectionEnd=b),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(a){let b=this.canvas.getScenePoint(a).transform(WN(this.calcTransformMatrix())).add(new Wv(-this._getLeftOffset(),-this._getTopOffset())),c=0,d=0,e=0;for(let a=0;a<this._textLines.length&&c<=b.y;a++)c+=this.getHeightOfLine(a),e=a,a>0&&(d+=this._textLines[a-1].length+this.missingNewlineOffset(a-1));let f=Math.abs(this._getLineLeftOffset(e)),g=this._textLines[e].length,h=this.__charBounds[e];for(let a=0;a<g;a++){let c=f+h[a].kernedWidth;if(b.x<=c){Math.abs(b.x-c)<=Math.abs(b.x-f)&&d++;break}f=c,d++}return Math.min(this.flipX?g-d:d,this._text.length)}}let _d="moveCursorUp",_e="moveCursorDown",_f="moveCursorLeft",_g="moveCursorRight",_h="exitEditing",_i=(a,b)=>{let c=b.getRetinaScaling();a.setTransform(c,0,0,c,0,0);let d=b.viewportTransform;a.transform(d[0],d[1],d[2],d[3],d[4],d[5])};class _j extends _c{static getDefaults(){return{...super.getDefaults(),..._j.ownDefaults}}get type(){let a=super.type;return"itext"===a?"i-text":a}constructor(a,b){super(a,{..._j.ownDefaults,...b}),this.initBehavior()}_set(a,b){return this.isEditing&&this._savedProps&&a in this._savedProps?(this._savedProps[a]=b,this):("canvas"===a&&(this.canvas instanceof $H&&this.canvas.textEditingManager.remove(this),b instanceof $H&&b.textEditingManager.add(this)),super._set(a,b))}setSelectionStart(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)}setSelectionEnd(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)}_updateAndFire(a,b){this[a]!==b&&(this._fireSelectionChanged(),this[a]=b),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,c=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(a,b,c)}setSelectionStyles(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(a,b,c)}get2DCursorLocation(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(a,b)}render(a){super.render(a),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(a){let b=this.isEditing;this.isEditing=!1;let c=super.toCanvasElement(a);return this.isEditing=b,c}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;let a=this.clearContextTop(!0);if(!a)return;let b=this._getCursorBoundaries(),c=this.findAncestorsWithClipPath(),d=c.length>0,e,f=a;if(d){_i(f=(e=WG(a.canvas)).getContext("2d"),this.canvas);let b=this.calcTransformMatrix();f.transform(b[0],b[1],b[2],b[3],b[4],b[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(f,b):this.renderCursor(f,b),d)for(let b of c){let c=b.clipPath,d=WG(a.canvas),e=d.getContext("2d");if(_i(e,this.canvas),!c.absolutePositioned){let a=b.calcTransformMatrix();e.transform(a[0],a[1],a[2],a[3],a[4],a[5])}c.transform(e),c.drawObject(e,!0,{}),this.drawClipPathOnCache(f,c,d)}d&&(a.setTransform(1,0,0,1,0,0),a.drawImage(e,0,0)),this.canvas.contextTopDirty=!0,a.restore()}findAncestorsWithClipPath(){let a=[],b=this;for(;b;)b.clipPath&&a.push(b),b=b.parent;return a}_getCursorBoundaries(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1?arguments[1]:void 0,c=this._getLeftOffset(),d=this._getTopOffset(),e=this._getCursorBoundariesOffsets(a,b);return{left:c,top:d,leftOffset:e.left,topOffset:e.top}}_getCursorBoundariesOffsets(a,b){return b?this.__getCursorBoundariesOffsets(a):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(a)}__getCursorBoundariesOffsets(a){let b=0,c=0,{charIndex:d,lineIndex:e}=this.get2DCursorLocation(a),{textAlign:f,direction:g}=this;for(let a=0;a<e;a++)b+=this.getHeightOfLine(a);let h=this._getLineLeftOffset(e),i=this.__charBounds[e][d];i&&(c=i.left),0!==this.charSpacing&&d===this._textLines[e].length&&(c-=this._getWidthOfCharSpacing());let j=h+(c>0?c:0);return"rtl"===g&&(f===V4||f===Yb||f===Yd?j*=-1:f===V2||f===Yc?j=h-(c>0?c:0):f!==V1&&f!==Ye||(j=h-(c>0?c:0))),{top:b,left:j}}renderCursorAt(a){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(a,!0),a)}renderCursor(a,b){this._renderCursor(a,b,this.selectionStart)}getCursorRenderingData(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(a),c=this.get2DCursorLocation(a),d=c.lineIndex,e=c.charIndex>0?c.charIndex-1:0,f=this.getValueOfPropertyAt(d,e,"fontSize"),g=this.getObjectScaling().x*this.canvas.getZoom(),h=this.cursorWidth/g,i=this.getValueOfPropertyAt(d,e,"deltaY"),j=b.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(d)/this.lineHeight-f*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(d,e,"fill"),opacity:this._currentCursorOpacity,left:b.left+b.leftOffset-h/2,top:j+b.top+i,width:h,height:f}}_renderCursor(a,b,c){let{color:d,opacity:e,left:f,top:g,width:h,height:i}=this.getCursorRenderingData(c,b);a.fillStyle=d,a.globalAlpha=e,a.fillRect(f,g,h,i)}renderSelection(a,b){let c={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(a,c,b)}renderDragSourceEffect(){let a=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,a,this._getCursorBoundaries(a.selectionStart,!0))}renderDropTargetEffect(a){let b=this.getSelectionStartFromPointer(a);this.renderCursorAt(b)}_renderSelection(a,b,c){let{textAlign:d,direction:e}=this,f=b.selectionStart,g=b.selectionEnd,h=d.includes(Yb),i=this.get2DCursorLocation(f),j=this.get2DCursorLocation(g),k=i.lineIndex,l=j.lineIndex,m=i.charIndex<0?0:i.charIndex,n=j.charIndex<0?0:j.charIndex;for(let b=k;b<=l;b++){let f=this._getLineLeftOffset(b)||0,g=this.getHeightOfLine(b),i=0,j=0,o=0;if(b===k&&(j=this.__charBounds[k][m].left),b>=k&&b<l)o=h&&!this.isEndOfWrapping(b)?this.width:this.getLineWidth(b)||5;else if(b===l)if(0===n)o=this.__charBounds[l][n].left;else{let a=this._getWidthOfCharSpacing();o=this.__charBounds[l][n-1].left+this.__charBounds[l][n-1].width-a}i=g,(this.lineHeight<1||b===l&&this.lineHeight>1)&&(g/=this.lineHeight);let p=c.left+f+j,q=g,r=0,s=o-j;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",q=1,r=g):a.fillStyle=this.selectionColor,"rtl"===e&&(d===V4||d===Yb||d===Yd?p=this.width-p-s:d===V2||d===Yc?p=c.left+f-o:d!==V1&&d!==Ye||(p=c.left+f-o)),a.fillRect(p,c.top+c.topOffset+r,s,q),c.topOffset+=i}}getCurrentCharFontSize(){let a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")}getCurrentCharColor(){let a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,Wk)}_getCurrentCharIndex(){let a=this.get2DCursorLocation(this.selectionStart,!0),b=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c:b}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}VK(_j,"ownDefaults",{selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:_h,27:_h,33:_d,34:_e,35:_g,36:_f,37:_f,38:_d,39:_g,40:_e},keysMapRtl:{9:_h,27:_h,33:_d,34:_e,35:_f,36:_g,37:_g,38:_d,39:_f,40:_e},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"},_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1}),VK(_j,"type","IText"),Wp.setClass(_j),Wp.setClass(_j,"i-text");class _k extends _j{static getDefaults(){return{...super.getDefaults(),..._k.ownDefaults}}constructor(a,b){super(a,{..._k.ownDefaults,...b})}static createControls(){return{controls:Zg()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Yb)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(a){let b=0,c=0,d=0,e={};for(let f=0;f<a.graphemeLines.length;f++)"\n"===a.graphemeText[d]&&f>0?(c=0,d++,b++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[d])&&f>0&&(c++,d++),e[f]={line:b,offset:c},d+=a.graphemeLines[f].length,c+=a.graphemeLines[f].length;return e}styleHas(a,b){if(this._styleMap&&!this.isWrapping){let a=this._styleMap[b];a&&(b=a.line)}return super.styleHas(a,b)}isEmptyStyles(a){if(!this.styles)return!0;let b,c=0,d=!1,e=this._styleMap[a],f=this._styleMap[a+1];e&&(a=e.line,c=e.offset),f&&(d=f.line===a,b=f.offset);let g=void 0===a?this.styles:{line:this.styles[a]};for(let a in g)for(let e in g[a]){let f=parseInt(e,10);if(f>=c&&(!d||f<b))for(let b in g[a][e])return!1}return!0}_getStyleDeclaration(a,b){if(this._styleMap&&!this.isWrapping){let c=this._styleMap[a];if(!c)return{};a=c.line,b=c.offset+b}return super._getStyleDeclaration(a,b)}_setStyleDeclaration(a,b,c){let d=this._styleMap[a];super._setStyleDeclaration(d.line,d.offset+b,c)}_deleteStyleDeclaration(a,b){let c=this._styleMap[a];super._deleteStyleDeclaration(c.line,c.offset+b)}_getLineStyle(a){let b=this._styleMap[a];return!!this.styles[b.line]}_setLineStyle(a){let b=this._styleMap[a];super._setLineStyle(b.line)}_wrapText(a,b){this.isWrapping=!0;let c=this.getGraphemeDataForRender(a),d=[];for(let a=0;a<c.wordsData.length;a++)d.push(...this._wrapLine(a,b,c));return this.isWrapping=!1,d}getGraphemeDataForRender(a){let b=this.splitByGrapheme,c=b?"":" ",d=0;return{wordsData:a.map((a,e)=>{let f=0,g=b?this.graphemeSplit(a):this.wordSplit(a);return 0===g.length?[{word:[],width:0}]:g.map(a=>{let g=b?[a]:this.graphemeSplit(a),h=this._measureWord(g,e,f);return d=Math.max(h,d),f+=g.length+c.length,{word:g,width:h}})}),largestWordWidth:d}}_measureWord(a,b){let c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=0;for(let f=0,g=a.length;f<g;f++)e+=this._getGraphemeBox(a[f],b,f+d,c,!0).kernedWidth,c=a[f];return e}wordSplit(a){return a.split(this._wordJoiners)}_wrapLine(a,b,c){let d,{largestWordWidth:e,wordsData:f}=c,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=this._getWidthOfCharSpacing(),i=this.splitByGrapheme,j=[],k=i?"":" ",l=0,m=[],n=0,o=0,p=!0,q=Math.max(b-=g,e,this.dynamicMinWidth),r=f[a];for(n=0,d=0;d<r.length;d++){let{word:b,width:c}=r[d];n+=b.length,(l+=o+c-h)>q&&!p?(j.push(m),m=[],l=c,p=!0):l+=h,p||i||m.push(k),m=m.concat(b),o=i?0:this._measureWord([k],a,n),n++,p=!1}return d&&j.push(m),e+g>this.dynamicMinWidth&&(this.dynamicMinWidth=e-h+g),j}isEndOfWrapping(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line}missingNewlineOffset(a,b){return this.splitByGrapheme&&!b?+!!this.isEndOfWrapping(a):1}_splitTextIntoLines(a){let b=super._splitTextIntoLines(a),c=this._wrapText(b.lines,this.width),d=Array(c.length);for(let a=0;a<c.length;a++)d[a]=c[a].join("");return b.lines=d,b.graphemeLines=c,b}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){let a=new Map;for(let b in this._styleMap){let c=parseInt(b,10);if(this._textLines[c]){let c=this._styleMap[b].line;a.set(`${c}`,!0)}}for(let b in this.styles)a.has(b)||delete this.styles[b]}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...a])}}VK(_k,"type","Textbox"),VK(_k,"textLayoutProperties",[..._j.textLayoutProperties,"width"]),VK(_k,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),Wp.setClass(_k);class _l extends ZT{shouldPerformLayout(a){return!!a.target.clipPath&&super.shouldPerformLayout(a)}shouldLayoutClipPath(){return!1}calcLayoutResult(a,b){let{target:c}=a,{clipPath:d,group:e}=c;if(!d||!this.shouldPerformLayout(a))return;let{width:f,height:g}=Xr(ZS(c,d)),h=new Wv(f,g);if(d.absolutePositioned)return{center:Xy(d.getRelativeCenterPoint(),void 0,e?e.calcTransformMatrix():void 0),size:h};{let e=d.getRelativeCenterPoint().transform(c.calcOwnMatrix(),!0);if(this.shouldPerformLayout(a)){let{center:c=new Wv,correction:d=new Wv}=this.calcBoundingBox(b,a)||{};return{center:c.add(e),correction:d.subtract(e),size:h}}return{center:c.getRelativeCenterPoint().add(e),size:h}}}}VK(_l,"type","clip-path"),Wp.setClass(_l);class _m extends ZT{getInitialSize(a,b){let{target:c}=a,{size:d}=b;return new Wv(c.width||d.x,c.height||d.y)}}VK(_m,"type","fixed"),Wp.setClass(_m);class _n extends ZW{subscribeTargets(a){let b=a.target;a.targets.reduce((a,b)=>(b.parent&&a.add(b.parent),a),new Set).forEach(a=>{a.layoutManager.subscribeTargets({target:a,targets:[b]})})}unsubscribeTargets(a){let b=a.target,c=b.getObjects();a.targets.reduce((a,b)=>(b.parent&&a.add(b.parent),a),new Set).forEach(a=>{c.some(b=>b.parent===a)||a.layoutManager.unsubscribeTargets({target:a,targets:[b]})})}}class _o extends ZY{static getDefaults(){return{...super.getDefaults(),..._o.ownDefaults}}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,_o.ownDefaults),this.setOptions(b);const{left:c,top:d,layoutManager:e}=b;this.groupInit(a,{left:c,top:d,layoutManager:null!=e?e:new _n})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];"selection-order"===this.multiSelectionStacking?this.add(...b):b.forEach(a=>{let b=this._objects.findIndex(b=>b.isInFrontOf(a)),c=-1===b?this.size():b;this.insertAt(c,a)})}canEnterGroup(a){return this.getObjects().some(b=>b.isDescendantOf(a)||a.isDescendantOf(b))?(VN("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(a)}enterGroup(a,b){a.parent&&a.parent===a.group?a.parent._exitGroup(a):a.group&&a.parent!==a.group&&a.group.remove(a),this._enterGroup(a,b)}exitGroup(a,b){this._exitGroup(a,b),a.parent&&a.parent._enterGroup(a,!0)}_onAfterObjectsChange(a,b){super._onAfterObjectsChange(a,b);let c=new Set;b.forEach(a=>{let{parent:b}=a;b&&c.add(b)}),a===ZQ?c.forEach(a=>{a._onAfterObjectsChange(ZP,b)}):c.forEach(a=>{a._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return`#<ActiveSelection: (${this.complexity()})>`}shouldCache(){return!1}isOnACache(){return!1}_renderControls(a,b,c){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;let d={hasControls:!1,...c,forActiveSelection:!0};for(let b=0;b<this._objects.length;b++)this._objects[b]._renderControls(a,d);super._renderControls(a,b),a.restore()}}VK(_o,"type","ActiveSelection"),VK(_o,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),Wp.setClass(_o),Wp.setClass(_o,"activeSelection");class _p{constructor(){VK(this,"resources",{})}applyFilters(a,b,c,d,e){let f=e.getContext("2d",{willReadFrequently:!0,desynchronized:!0});if(!f)return;f.drawImage(b,0,0,c,d);let g={sourceWidth:c,sourceHeight:d,imageData:f.getImageData(0,0,c,d),originalEl:b,originalImageData:f.getImageData(0,0,c,d),canvasEl:e,ctx:f,filterBackend:this};a.forEach(a=>{a.applyTo(g)});let{imageData:h}=g;return h.width===c&&h.height===d||(e.width=h.width,e.height=h.height),f.putImageData(h,0,0),g}}class _q{constructor(){let{tileSize:a=VM.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};VK(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),VK(this,"resources",{}),this.tileSize=a,this.setupGLContext(a,a),this.captureGPUInfo()}setupGLContext(a,b){this.dispose(),this.createWebGLCanvas(a,b)}createWebGLCanvas(a,b){let c=WG({width:a,height:b}),d=c.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});d&&(d.clearColor(0,0,0,0),this.canvas=c,this.gl=d)}applyFilters(a,b,c,d,e,f){let g,h,i,j,k,l,m=this.gl,n=e.getContext("2d");if(!m||!n)return;f&&(g=this.getCachedTexture(f,b));let o={originalWidth:b.width||b.naturalWidth||0,originalHeight:b.height||b.naturalHeight||0,sourceWidth:c,sourceHeight:d,destinationWidth:c,destinationHeight:d,context:m,sourceTexture:this.createTexture(m,c,d,g?void 0:b),targetTexture:this.createTexture(m,c,d),originalTexture:g||this.createTexture(m,c,d,g?void 0:b),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:e},p=m.createFramebuffer();return m.bindFramebuffer(m.FRAMEBUFFER,p),a.forEach(a=>{a&&a.applyTo(o)}),i=(h=o.targetCanvas).width,j=h.height,k=o.destinationWidth,l=o.destinationHeight,i===k&&j===l||(h.width=k,h.height=l),this.copyGLTo2D(m,o),m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(o.sourceTexture),m.deleteTexture(o.targetTexture),m.deleteFramebuffer(p),n.setTransform(1,0,0,1,0,0),o}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(a,b,c,d,e){let{NEAREST:f,TEXTURE_2D:g,RGBA:h,UNSIGNED_BYTE:i,CLAMP_TO_EDGE:j,TEXTURE_MAG_FILTER:k,TEXTURE_MIN_FILTER:l,TEXTURE_WRAP_S:m,TEXTURE_WRAP_T:n}=a,o=a.createTexture();return a.bindTexture(g,o),a.texParameteri(g,k,e||f),a.texParameteri(g,l,e||f),a.texParameteri(g,m,j),a.texParameteri(g,n,j),d?a.texImage2D(g,0,h,h,i,d):a.texImage2D(g,0,h,b,c,0,h,i,null),o}getCachedTexture(a,b,c){let{textureCache:d}=this;if(d[a])return d[a];{let e=this.createTexture(this.gl,b.width,b.height,b,c);return e&&(d[a]=e),e}}evictCachesForKey(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])}copyGLTo2D(a,b){let c=a.canvas,d=b.targetCanvas,e=d.getContext("2d");if(!e)return;e.translate(0,d.height),e.scale(1,-1);let f=c.height-d.height;e.drawImage(c,0,f,d.width,d.height,0,0,d.width,d.height)}copyGLTo2DPutImageData(a,b){let c=b.targetCanvas.getContext("2d"),d=b.destinationWidth,e=b.destinationHeight,f=d*e*4;if(!c)return;let g=new Uint8Array(this.imageBuffer,0,f),h=new Uint8ClampedArray(this.imageBuffer,0,f);a.readPixels(0,0,d,e,a.RGBA,a.UNSIGNED_BYTE,g);let i=new ImageData(h,d,e);c.putImageData(i,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;let a=this.gl,b={renderer:"",vendor:""};if(!a)return b;let c=a.getExtension("WEBGL_debug_renderer_info");if(c){let d=a.getParameter(c.UNMASKED_RENDERER_WEBGL),e=a.getParameter(c.UNMASKED_VENDOR_WEBGL);d&&(b.renderer=d.toLowerCase()),e&&(b.vendor=e.toLowerCase())}return this.gpuInfo=b,b}}function _r(){return m||arguments.length>0&&void 0!==arguments[0]&&!arguments[0]||(m=function(){let{WebGLProbe:a}=VT();return a.queryWebGL(WE()),VM.enableGLFiltering&&a.isSupported(VM.textureSize)?new _q({tileSize:VM.textureSize}):new _p}()),m}let _s=["cropX","cropY"];class _t extends Zj{static getDefaults(){return{...super.getDefaults(),..._t.ownDefaults}}constructor(a,b){super(),VK(this,"_lastScaleX",1),VK(this,"_lastScaleY",1),VK(this,"_filterScalingX",1),VK(this,"_filterScalingY",1),this.filters=[],Object.assign(this,_t.ownDefaults),this.setOptions(b),this.cacheKey=`texture${WD()}`,this.setElement("string"==typeof a?(this.canvas&&Xa(this.canvas.getElement())||VT().document).getElementById(a):a,b)}getElement(){return this._element}setElement(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture(`${this.cacheKey}_filtered`),this._element=a,this._originalElement=a,this._setWidthHeight(b),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(a){let b=_r(!1);b instanceof _q&&b.evictCachesForKey(a)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture(`${this.cacheKey}_filtered`),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(a=>{let b=this[a];b&&VT().dispose(b),this[a]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){let a=this.getElement();return a?{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}:{width:0,height:0}}_stroke(a){if(!this.stroke||0===this.strokeWidth)return;let b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}toObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=[];return this.filters.forEach(a=>{a&&b.push(a.toObject())}),{...super.toObject([..._s,...a]),src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:b,...this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{}}}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){let a=[],b=this._element,c=-this.width/2,d=-this.height/2,e=[],f=[],g="",h="";if(!b)return[];if(this.hasCrop()){let a=WD();e.push('<clipPath id="imageCrop_'+a+'">\n','	<rect x="'+c+'" y="'+d+'" width="'+Xh(this.width)+'" height="'+Xh(this.height)+'" />\n',"</clipPath>\n"),g=' clip-path="url(#imageCrop_'+a+')" '}if(this.imageSmoothing||(h=' image-rendering="optimizeSpeed"'),a.push("	<image ","COMMON_PARTS",`xlink:href="${Xh(this.getSrc(!0))}" x="${c-this.cropX}" y="${d-this.cropY}" width="${b.width||b.naturalWidth}" height="${b.height||b.naturalHeight}"${h}${g}></image>
`),this.stroke||this.strokeDashArray){let a=this.fill;this.fill=null,f=[`	<rect x="${c}" y="${d}" width="${Xh(this.width)}" height="${Xh(this.height)}" style="${this.getSvgStyles()}" />
`],this.fill=a}return this.paintFirst!==Wk?e.concat(f,a):e.concat(a,f)}getSrc(a){let b=a?this._element:this._originalElement;return b?b.toDataURL?b.toDataURL():this.srcFromAttribute?b.getAttribute("src")||"":b.src:this.src||""}getSvgSrc(a){return this.getSrc(a)}setSrc(a){let{crossOrigin:b,signal:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return W$(a,{crossOrigin:b,signal:c}).then(a=>{void 0!==b&&this.set({crossOrigin:b}),this.setElement(a)})}toString(){return`#<Image: { src: "${this.getSrc()}" }>`}applyResizeFilters(){let a=this.resizeFilter,b=this.minimumScaleTrigger,c=this.getTotalObjectScaling(),d=c.x,e=c.y,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||d>b&&e>b)return this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=d,void(this._lastScaleY=e);let g=WG(f),{width:h,height:i}=f;this._element=g,this._lastScaleX=a.scaleX=d,this._lastScaleY=a.scaleY=e,_r().applyFilters([a],f,h,i,this._element),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height}applyFilters(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(a=a.filter(a=>a&&!a.isNeutralState()),this.set("dirty",!0),this.removeTexture(`${this.cacheKey}_filtered`),0===a.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);let b=this._originalElement,c=b.naturalWidth||b.width,d=b.naturalHeight||b.height;if(this._element===this._originalElement){let a=WG({width:c,height:d});this._element=a,this._filteredEl=a}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,c,d),this._lastScaleX=1,this._lastScaleY=1);_r().applyFilters(a,this._originalElement,c,d,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(a){a.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)}drawCacheOnCanvas(a){a.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(a)}shouldCache(){return this.needsItsOwnCache()}_renderFill(a){let b=this._element;if(!b)return;let c=this._filterScalingX,d=this._filterScalingY,e=this.width,f=this.height,g=Math.max(this.cropX,0),h=Math.max(this.cropY,0),i=b.naturalWidth||b.width,j=b.naturalHeight||b.height,k=g*c,l=h*d,m=Math.min(e*c,i-k),n=Math.min(f*d,j-l),o=Math.min(e,i/c-g),p=Math.min(f,j/d-h);b&&a.drawImage(b,k,l,m,n,-e/2,-f/2,o,p)}_needsResize(){let a=this.getTotalObjectScaling();return a.x!==this._lastScaleX||a.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:a,height:b}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=this.getOriginalSize();this.width=a||c.width,this.height=b||c.height}parsePreserveAspectRatioAttribute(){let a=X1(this.preserveAspectRatio||""),b=this.width,c=this.height,d={width:b,height:c},e,f=this._element.width,g=this._element.height,h=1,i=1,j=0,k=0,l=0,m=0;return a&&(a.alignX!==V5||a.alignY!==V5)?("meet"===a.meetOrSlice&&(e=(b-f*(h=i=ZZ(this._element,d)))/2,"Min"===a.alignX&&(j=-e),"Max"===a.alignX&&(j=e),e=(c-g*i)/2,"Min"===a.alignY&&(k=-e),"Max"===a.alignY&&(k=e)),"slice"===a.meetOrSlice&&(e=f-b/(h=i=Z$(this._element,d)),"Mid"===a.alignX&&(l=e/2),"Max"===a.alignX&&(l=e),e=g-c/i,"Mid"===a.alignY&&(m=e/2),"Max"===a.alignY&&(m=e),f=b/h,g=c/i)):(h=b/f,i=c/g),{width:f,height:g,scaleX:h,scaleY:i,offsetLeft:j,offsetTop:k,cropX:l,cropY:m}}static fromObject(a,b){let{filters:c,resizeFilter:d,src:e,crossOrigin:f,type:g,...h}=a;return Promise.all([W$(e,{...b,crossOrigin:f}),c&&W_(c,b),d?W_([d],b):[],W0(h,b)]).then(a=>{let[b,c=[],[d],f={}]=a;return new this(b,{...h,src:e,filters:c,resizeFilter:d,...f})})}static fromURL(a){let{crossOrigin:b=null,signal:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;return W$(a,{crossOrigin:b,signal:c}).then(a=>new this(a,d))}static async fromElement(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,d=ZL(a,this.ATTRIBUTE_NAMES,c);return this.fromURL(d["xlink:href"]||d.href,b,d).catch(a=>(VN("log","Unable to parse Image",a),null))}}VK(_t,"type","Image"),VK(_t,"cacheProperties",[...Yr,..._s]),VK(_t,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),VK(_t,"ATTRIBUTE_NAMES",[...Zu,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),Wp.setClass(_t),Wp.setSVGClass(_t),X4(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);let _u="precision highp float",_v=`
    ${_u};
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`,_w=RegExp(_u,"g");class _x{get type(){return this.constructor.type}constructor(){let{type:a,...b}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,this.constructor.defaults,b)}getFragmentSource(){return _v}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(a){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource(),{WebGLProbe:{GLPrecision:d="highp"}}=VT();"highp"!==d&&(b=b.replace(_w,_u.replace("highp",d)));let e=a.createShader(a.VERTEX_SHADER),f=a.createShader(a.FRAGMENT_SHADER),g=a.createProgram();if(!e||!f||!g)throw new VO("Vertex, fragment shader or program creation error");if(a.shaderSource(e,c),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new VO(`Vertex shader compile error for ${this.type}: ${a.getShaderInfoLog(e)}`);if(a.shaderSource(f,b),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))throw new VO(`Fragment shader compile error for ${this.type}: ${a.getShaderInfoLog(f)}`);if(a.attachShader(g,e),a.attachShader(g,f),a.linkProgram(g),!a.getProgramParameter(g,a.LINK_STATUS))throw new VO(`Shader link error for "${this.type}" ${a.getProgramInfoLog(g)}`);let h=this.getUniformLocations(a,g)||{};return h.uStepW=a.getUniformLocation(g,"uStepW"),h.uStepH=a.getUniformLocation(g,"uStepH"),{program:g,attributeLocations:this.getAttributeLocations(a,g),uniformLocations:h}}getAttributeLocations(a,b){return{aPosition:a.getAttribLocation(b,"aPosition")}}getUniformLocations(a,b){let c=this.constructor.uniformLocations,d={};for(let e=0;e<c.length;e++)d[c[e]]=a.getUniformLocation(b,c[e]);return d}sendAttributeData(a,b,c){let d=b.aPosition,e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW)}_setupFrameBuffer(a){let b=a.context;if(a.passes>1){let c=a.destinationWidth,d=a.destinationHeight;a.sourceWidth===c&&a.sourceHeight===d||(b.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(b,c,d)),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a.targetTexture,0)}else b.bindFramebuffer(b.FRAMEBUFFER,null),b.finish()}_swapTextures(a){a.passes--,a.pass++;let b=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=b}isNeutralState(a){return!1}applyTo(a){void 0!==a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)}applyTo2d(a){}getCacheKey(){return this.type}retrieveShader(a){let b=this.getCacheKey();return a.programCache[b]||(a.programCache[b]=this.createProgram(a.context)),a.programCache[b]}applyToWebGL(a){let b=a.context,c=this.retrieveShader(a);0===a.pass&&a.originalTexture?b.bindTexture(b.TEXTURE_2D,a.originalTexture):b.bindTexture(b.TEXTURE_2D,a.sourceTexture),b.useProgram(c.program),this.sendAttributeData(b,c.attributeLocations,a.aPosition),b.uniform1f(c.uniformLocations.uStepW,1/a.sourceWidth),b.uniform1f(c.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(b,c.uniformLocations),b.viewport(0,0,a.destinationWidth,a.destinationHeight),b.drawArrays(b.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(a,b,c){a.activeTexture(c),a.bindTexture(a.TEXTURE_2D,b),a.activeTexture(a.TEXTURE0)}unbindAdditionalTexture(a,b){a.activeTexture(b),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)}sendUniformData(a,b){}createHelpLayer(a){if(!a.helpLayer){let{sourceWidth:b,sourceHeight:c}=a;a.helpLayer=WG({width:b,height:c})}}toObject(){let a=Object.keys(this.constructor.defaults||{});return{type:this.type,...a.reduce((a,b)=>(a[b]=this[b],a),{})}}toJSON(){return this.toObject()}static async fromObject(a,b){let{type:c,...d}=a;return new this(d)}}VK(_x,"type","BaseFilter"),VK(_x,"uniformLocations",[]);let _y={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class _z extends _x{getCacheKey(){return`${this.type}_${this.mode}`}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          ${_y[this.mode]}
        }
      }
      `}applyTo2d(a){let{imageData:{data:b}}=a,c=new X_(this.color).getSource(),d=this.alpha,e=c[0]*d,f=c[1]*d,g=c[2]*d,h=1-d;for(let a=0;a<b.length;a+=4){let c,d,i,j=b[a],k=b[a+1],l=b[a+2];switch(this.mode){case"multiply":c=j*e/255,d=k*f/255,i=l*g/255;break;case"screen":c=255-(255-j)*(255-e)/255,d=255-(255-k)*(255-f)/255,i=255-(255-l)*(255-g)/255;break;case"add":c=j+e,d=k+f,i=l+g;break;case"difference":c=Math.abs(j-e),d=Math.abs(k-f),i=Math.abs(l-g);break;case"subtract":c=j-e,d=k-f,i=l-g;break;case"darken":c=Math.min(j,e),d=Math.min(k,f),i=Math.min(l,g);break;case"lighten":c=Math.max(j,e),d=Math.max(k,f),i=Math.max(l,g);break;case"overlay":c=e<128?2*j*e/255:255-2*(255-j)*(255-e)/255,d=f<128?2*k*f/255:255-2*(255-k)*(255-f)/255,i=g<128?2*l*g/255:255-2*(255-l)*(255-g)/255;break;case"exclusion":c=e+j-2*e*j/255,d=f+k-2*f*k/255,i=g+l-2*g*l/255;break;case"tint":c=e+j*h,d=f+k*h,i=g+l*h}b[a]=c,b[a+1]=d,b[a+2]=i}}sendUniformData(a,b){let c=new X_(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,a.uniform4fv(b.uColor,c)}}VK(_z,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),VK(_z,"type","BlendColor"),VK(_z,"uniformLocations",["uColor"]),Wp.setClass(_z);let _A={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "};class _B extends _x{getCacheKey(){return`${this.type}_${this.mode}`}getFragmentSource(){return _A[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(a){let b=a.context,c=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(b,c,b.TEXTURE1),super.applyToWebGL(a),this.unbindAdditionalTexture(b,b.TEXTURE1)}createTexture(a,b){return a.getCachedTexture(b.cacheKey,b.getElement())}calculateMatrix(){let a=this.image,{width:b,height:c}=a.getElement();return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/b,-a.top/c,1]}applyTo2d(a){let{imageData:{data:b,width:c,height:d},filterBackend:{resources:e}}=a,f=this.image;e.blendImage||(e.blendImage=WE());let g=e.blendImage,h=g.getContext("2d");g.width!==c||g.height!==d?(g.width=c,g.height=d):h.clearRect(0,0,c,d),h.setTransform(f.scaleX,0,0,f.scaleY,f.left,f.top),h.drawImage(f.getElement(),0,0,c,d);let i=h.getImageData(0,0,c,d).data;for(let a=0;a<b.length;a+=4){let c=b[a],d=b[a+1],e=b[a+2],f=b[a+3],g=i[a],h=i[a+1],j=i[a+2],k=i[a+3];switch(this.mode){case"multiply":b[a]=c*g/255,b[a+1]=d*h/255,b[a+2]=e*j/255,b[a+3]=f*k/255;break;case"mask":b[a+3]=k}}}sendUniformData(a,b){let c=this.calculateMatrix();a.uniform1i(b.uImage,1),a.uniformMatrix3fv(b.uTransformMatrix,!1,c)}toObject(){return{...super.toObject(),image:this.image&&this.image.toObject()}}static async fromObject(a,b){let{type:c,image:d,...e}=a;return _t.fromObject(d,b).then(a=>new this({...e,image:a}))}}VK(_B,"type","BlendImage"),VK(_B,"defaults",{mode:"multiply",alpha:1}),VK(_B,"uniformLocations",["uTransformMatrix","uImage"]),Wp.setClass(_B);class _C extends _x{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(a){void 0!==a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)}applyTo2d(a){let{imageData:{data:b,width:c,height:d}}=a;this.aspectRatio=c/d,this.horizontal=!0;let e=this.getBlurValue()*c,f=new Uint8ClampedArray(b),g=4*c;for(let a=0;a<b.length;a+=4){let c=0,d=0,h=0,i=0,j=0,k=a-a%g,l=k+g;for(let f=-14;f<15;f++){let g=f/15,m=4*Math.floor(e*g),n=1-Math.abs(g),o=a+m;o<k?o=k:o>l&&(o=l);let p=b[o+3]*n;c+=b[o]*p,d+=b[o+1]*p,h+=b[o+2]*p,i+=p,j+=n}f[a]=c/i,f[a+1]=d/i,f[a+2]=h/i,f[a+3]=i/j}this.horizontal=!1,e=this.getBlurValue()*d;for(let a=0;a<f.length;a+=4){let c=0,d=0,h=0,i=0,j=0,k=a%g,l=f.length-g+k;for(let b=-14;b<15;b++){let m=b/15,n=Math.floor(e*m)*g,o=1-Math.abs(m),p=a+n;p<k?p=k:p>l&&(p=l);let q=f[p+3]*o;c+=f[p]*q,d+=f[p+1]*q,h+=f[p+2]*q,i+=q,j+=o}b[a]=c/i,b[a+1]=d/i,b[a+2]=h/i,b[a+3]=i/j}}sendUniformData(a,b){let c=this.chooseRightDelta();a.uniform2fv(b.uDelta,c)}isNeutralState(){return 0===this.blur}getBlurValue(){let a=1,{horizontal:b,aspectRatio:c}=this;return b?c>1&&(a=1/c):c<1&&(a=c),a*this.blur*.12}chooseRightDelta(){let a=this.getBlurValue();return this.horizontal?[a,0]:[0,a]}}VK(_C,"type","Blur"),VK(_C,"defaults",{blur:0}),VK(_C,"uniformLocations",["uDelta"]),Wp.setClass(_C);class _D extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=Math.round(255*this.brightness);for(let a=0;a<b.length;a+=4)b[a]+=c,b[a+1]+=c,b[a+2]+=c}isNeutralState(){return 0===this.brightness}sendUniformData(a,b){a.uniform1f(b.uBrightness,this.brightness)}}VK(_D,"type","Brightness"),VK(_D,"defaults",{brightness:0}),VK(_D,"uniformLocations",["uBrightness"]),Wp.setClass(_D);let _E={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class _F extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(a){let b=a.imageData.data,c=this.matrix,d=this.colorsOnly;for(let a=0;a<b.length;a+=4){let e=b[a],f=b[a+1],g=b[a+2];if(b[a]=e*c[0]+f*c[1]+g*c[2]+255*c[4],b[a+1]=e*c[5]+f*c[6]+g*c[7]+255*c[9],b[a+2]=e*c[10]+f*c[11]+g*c[12]+255*c[14],!d){let d=b[a+3];b[a]+=d*c[3],b[a+1]+=d*c[8],b[a+2]+=d*c[13],b[a+3]=e*c[15]+f*c[16]+g*c[17]+d*c[18]+255*c[19]}}}sendUniformData(a,b){let c=this.matrix,d=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],e=[c[4],c[9],c[14],c[19]];a.uniformMatrix4fv(b.uColorMatrix,!1,d),a.uniform4fv(b.uConstants,e)}toObject(){return{...super.toObject(),matrix:[...this.matrix]}}}function _G(a,b){var c;let d=(VK(c=class extends _F{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",a),VK(c,"defaults",{colorsOnly:!1,matrix:b}),c);return Wp.setClass(d,a),d}VK(_F,"type","ColorMatrix"),VK(_F,"defaults",_E),VK(_F,"uniformLocations",["uColorMatrix","uConstants"]),Wp.setClass(_F);let _H=_G("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),_I=_G("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),_J=_G("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),_K=_G("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),_L=_G("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),_M=_G("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),_N=_G("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class _O extends _x{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a),this.subFilters=a.subFilters||[]}applyTo(a){void 0!==a.webgl&&(a.passes+=this.subFilters.length-1),this.subFilters.forEach(b=>{b.applyTo(a)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(a=>a.toObject())}}isNeutralState(){return!this.subFilters.some(a=>!a.isNeutralState())}static fromObject(a,b){return Promise.all((a.subFilters||[]).map(a=>Wp.getClass(a.type).fromObject(a,b))).then(a=>new this({subFilters:a}))}}VK(_O,"type","Composed"),Wp.setClass(_O);class _P extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(a){let{imageData:{data:b}}=a,c=Math.floor(255*this.contrast),d=259*(c+255)/(255*(259-c));for(let a=0;a<b.length;a+=4)b[a]=d*(b[a]-128)+128,b[a+1]=d*(b[a+1]-128)+128,b[a+2]=d*(b[a+2]-128)+128}sendUniformData(a,b){a.uniform1f(b.uContrast,this.contrast)}}VK(_P,"type","Contrast"),VK(_P,"defaults",{contrast:0}),VK(_P,"uniformLocations",["uContrast"]),Wp.setClass(_P);let _Q={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class _R extends _x{getCacheKey(){return`${this.type}_${Math.sqrt(this.matrix.length)}_${+!!this.opaque}`}getFragmentSource(){return _Q[this.getCacheKey()]}applyTo2d(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o=a.imageData,p=o.data,q=this.matrix,r=Math.round(Math.sqrt(q.length)),s=Math.floor(r/2),t=o.width,u=o.height,v=a.ctx.createImageData(t,u),w=v.data,y=+!!this.opaque;for(l=0;l<u;l++)for(k=0;k<t;k++){for(f=4*(l*t+k),b=0,c=0,d=0,e=0,n=0;n<r;n++)for(m=0;m<r;m++)h=l+n-s,g=k+m-s,h<0||h>=u||g<0||g>=t||(i=4*(h*t+g),j=q[n*r+m],b+=p[i]*j,c+=p[i+1]*j,d+=p[i+2]*j,y||(e+=p[i+3]*j));w[f]=b,w[f+1]=c,w[f+2]=d,w[f+3]=y?p[f+3]:e}a.imageData=v}sendUniformData(a,b){a.uniform1fv(b.uMatrix,this.matrix)}toObject(){return{...super.toObject(),opaque:this.opaque,matrix:[...this.matrix]}}}VK(_R,"type","Convolute"),VK(_R,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),VK(_R,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),Wp.setClass(_R);let _S="Gamma";class _T extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(a),this.gamma=a.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(a){let{imageData:{data:b}}=a,c=this.gamma,d=1/c[0],e=1/c[1],f=1/c[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});let g=this.rgbValues;for(let a=0;a<256;a++)g.r[a]=255*Math.pow(a/255,d),g.g[a]=255*Math.pow(a/255,e),g.b[a]=255*Math.pow(a/255,f);for(let a=0;a<b.length;a+=4)b[a]=g.r[b[a]],b[a+1]=g.g[b[a+1]],b[a+2]=g.b[b[a+2]]}sendUniformData(a,b){a.uniform3fv(b.uGamma,this.gamma)}isNeutralState(){let{gamma:a}=this;return 1===a[0]&&1===a[1]&&1===a[2]}toObject(){return{type:_S,gamma:this.gamma.concat()}}}VK(_T,"type",_S),VK(_T,"defaults",{gamma:[1,1,1]}),VK(_T,"uniformLocations",["uGamma"]),Wp.setClass(_T);let _U={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class _V extends _x{applyTo2d(a){let{imageData:{data:b}}=a;for(let a,c=0;c<b.length;c+=4){let d=b[c],e=b[c+1],f=b[c+2];switch(this.mode){case"average":a=(d+e+f)/3;break;case"lightness":a=(Math.min(d,e,f)+Math.max(d,e,f))/2;break;case"luminosity":a=.21*d+.72*e+.07*f}b[c+2]=b[c+1]=b[c]=a}}getCacheKey(){return`${this.type}_${this.mode}`}getFragmentSource(){return _U[this.mode]}sendUniformData(a,b){a.uniform1i(b.uMode,1)}isNeutralState(){return!1}}VK(_V,"type","Grayscale"),VK(_V,"defaults",{mode:"average"}),VK(_V,"uniformLocations",["uMode"]),Wp.setClass(_V);let _W={..._E,rotation:0};class _X extends _F{calculateMatrix(){let a=this.rotation*Math.PI,b=Wt(a),c=Wu(a),d=1/3,e=Math.sqrt(1/3)*c,f=1-b;this.matrix=[b+f/3,d*f-e,d*f+e,0,0,d*f+e,b+d*f,d*f-e,0,0,d*f-e,d*f+e,b+d*f,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(a){this.calculateMatrix(),super.applyTo(a)}toObject(){return{type:this.type,rotation:this.rotation}}}VK(_X,"type","HueRotation"),VK(_X,"defaults",_W),Wp.setClass(_X);class _Y extends _x{applyTo2d(a){let{imageData:{data:b}}=a;for(let a=0;a<b.length;a+=4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2],this.alpha&&(b[a+3]=255-b[a+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(a,b){a.uniform1i(b.uInvert,Number(this.invert)),a.uniform1i(b.uAlpha,Number(this.alpha))}}VK(_Y,"type","Invert"),VK(_Y,"defaults",{alpha:!1,invert:!0}),VK(_Y,"uniformLocations",["uInvert","uAlpha"]),Wp.setClass(_Y);class _Z extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=this.noise;for(let a=0;a<b.length;a+=4){let d=(.5-Math.random())*c;b[a]+=d,b[a+1]+=d,b[a+2]+=d}}sendUniformData(a,b){a.uniform1f(b.uNoise,this.noise/255),a.uniform1f(b.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}VK(_Z,"type","Noise"),VK(_Z,"defaults",{noise:0}),VK(_Z,"uniformLocations",["uNoise","uSeed"]),Wp.setClass(_Z);class _$ extends _x{applyTo2d(a){let{imageData:{data:b,width:c,height:d}}=a;for(let a=0;a<d;a+=this.blocksize)for(let e=0;e<c;e+=this.blocksize){let f=4*a*c+4*e,g=b[f],h=b[f+1],i=b[f+2],j=b[f+3];for(let f=a;f<Math.min(a+this.blocksize,d);f++)for(let a=e;a<Math.min(e+this.blocksize,c);a++){let d=4*f*c+4*a;b[d]=g,b[d+1]=h,b[d+2]=i,b[d+3]=j}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(a,b){a.uniform1f(b.uBlocksize,this.blocksize)}}VK(_$,"type","Pixelate"),VK(_$,"defaults",{blocksize:4}),VK(_$,"uniformLocations",["uBlocksize"]),Wp.setClass(_$);class __ extends _x{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=255*this.distance,d=new X_(this.color).getSource(),e=[d[0]-c,d[1]-c,d[2]-c],f=[d[0]+c,d[1]+c,d[2]+c];for(let a=0;a<b.length;a+=4){let c=b[a],d=b[a+1],g=b[a+2];c>e[0]&&d>e[1]&&g>e[2]&&c<f[0]&&d<f[1]&&g<f[2]&&(b[a+3]=0)}}sendUniformData(a,b){let c=new X_(this.color).getSource(),d=this.distance,e=[0+c[0]/255-d,0+c[1]/255-d,0+c[2]/255-d,1],f=[c[0]/255+d,c[1]/255+d,c[2]/255+d,1];a.uniform4fv(b.uLow,e),a.uniform4fv(b.uHigh,f)}}VK(__,"type","RemoveColor"),VK(__,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),VK(__,"uniformLocations",["uLow","uHigh"]),Wp.setClass(__);class _0 extends _x{sendUniformData(a,b){a.uniform2fv(b.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),a.uniform1fv(b.uTaps,this.taps)}getFilterWindow(){let a=this.tempScale;return Math.ceil(this.lanczosLobes/a)}getCacheKey(){let a=this.getFilterWindow();return`${this.type}_${a}`}getFragmentSource(){let a=this.getFilterWindow();return this.generateShader(a)}getTaps(){let a=this.lanczosCreate(this.lanczosLobes),b=this.tempScale,c=this.getFilterWindow(),d=Array(c);for(let e=1;e<=c;e++)d[e-1]=a(e*b);return d}generateShader(a){let b=Array(a);for(let c=1;c<=a;c++)b[c-1]=`${c}.0 * uDelta`;return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[${a}];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        ${b.map((a,b)=>`
              color += texture2D(uTexture, vTexCoord + ${a}) * uTaps[${b}] + texture2D(uTexture, vTexCoord - ${a}) * uTaps[${b}];
              sum += 2.0 * uTaps[${b}];
            `).join("\n")}
        gl_FragColor = color / sum;
      }
    `}applyToForWebgl(a){a.passes++,this.width=a.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=a.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),a.destinationWidth=this.dW,super.applyTo(a),a.sourceWidth=a.destinationWidth,this.height=a.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),a.destinationHeight=this.dH,super.applyTo(a),a.sourceHeight=a.destinationHeight}applyTo(a){void 0!==a.webgl?this.applyToForWebgl(a):this.applyTo2d(a)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(a){return b=>{if(b>=a||b<=-a)return 0;if(b<11920929e-14&&b>-11920929e-14)return 1;let c=(b*=Math.PI)/a;return Math.sin(b)/b*Math.sin(c)/c}}applyTo2d(a){let b,c=a.imageData,d=this.scaleX,e=this.scaleY;this.rcpScaleX=1/d,this.rcpScaleY=1/e;let f=c.width,g=c.height,h=Math.round(f*d),i=Math.round(g*e);b="sliceHack"===this.resizeType?this.sliceByTwo(a,f,g,h,i):"hermite"===this.resizeType?this.hermiteFastResize(a,f,g,h,i):"bilinear"===this.resizeType?this.bilinearFiltering(a,f,g,h,i):"lanczos"===this.resizeType?this.lanczosResize(a,f,g,h,i):new ImageData(h,i),a.imageData=b}sliceByTwo(a,b,c,d,e){let f=a.imageData,g=!1,h=!1,i=.5*b,j=.5*c,k=a.filterBackend.resources,l=0,m=0,n=b,o=0;k.sliceByTwo||(k.sliceByTwo=WE());let p=k.sliceByTwo;(p.width<1.5*b||p.height<c)&&(p.width=1.5*b,p.height=c);let q=p.getContext("2d");for(q.clearRect(0,0,1.5*b,c),q.putImageData(f,0,0),d=Math.floor(d),e=Math.floor(e);!g||!h;)b=i,c=j,d<Math.floor(.5*i)?i=Math.floor(.5*i):(i=d,g=!0),e<Math.floor(.5*j)?j=Math.floor(.5*j):(j=e,h=!0),q.drawImage(p,l,m,b,c,n,o,i,j),l=n,m=o,o+=j;return q.getImageData(l,m,d,e)}lanczosResize(a,b,c,d,e){let f=a.imageData.data,g=a.ctx.createImageData(d,e),h=g.data,i=this.lanczosCreate(this.lanczosLobes),j=this.rcpScaleX,k=this.rcpScaleY,l=2/this.rcpScaleX,m=2/this.rcpScaleY,n=Math.ceil(j*this.lanczosLobes/2),o=Math.ceil(k*this.lanczosLobes/2),p={},q={x:0,y:0},r={x:0,y:0};return function a(s){let t,u,v,w,y,z,A,B,C,D,E;for(q.x=(s+.5)*j,r.x=Math.floor(q.x),t=0;t<e;t++){for(q.y=(t+.5)*k,r.y=Math.floor(q.y),y=0,z=0,A=0,B=0,C=0,u=r.x-n;u<=r.x+n;u++)if(!(u<0||u>=b)){p[D=Math.floor(1e3*Math.abs(u-q.x))]||(p[D]={});for(let a=r.y-o;a<=r.y+o;a++)a<0||a>=c||(E=Math.floor(1e3*Math.abs(a-q.y)),p[D][E]||(p[D][E]=i(Math.sqrt(Math.pow(D*l,2)+Math.pow(E*m,2))/1e3)),(v=p[D][E])>0&&(w=4*(a*b+u),y+=v,z+=v*f[w],A+=v*f[w+1],B+=v*f[w+2],C+=v*f[w+3]))}h[w=4*(t*d+s)]=z/y,h[w+1]=A/y,h[w+2]=B/y,h[w+3]=C/y}return++s<d?a(s):g}(0)}bilinearFiltering(a,b,c,d,e){let f,g,h,i,j,k,l,m,n,o,p,q=0,r=this.rcpScaleX,s=this.rcpScaleY,t=4*(b-1),u=a.imageData.data,v=a.ctx.createImageData(d,e),w=v.data;for(j=0;j<e;j++)for(k=0;k<d;k++)for(h=Math.floor(r*k),i=Math.floor(s*j),l=r*k-h,m=s*j-i,p=4*(i*b+h),n=0;n<4;n++)f=u[p+n],g=u[p+4+n],o=f*(1-l)*(1-m)+g*l*(1-m)+u[p+t+n]*m*(1-l)+u[p+t+4+n]*l*m,w[q++]=o;return v}hermiteFastResize(a,b,c,d,e){let f=this.rcpScaleX,g=this.rcpScaleY,h=Math.ceil(f/2),i=Math.ceil(g/2),j=a.imageData.data,k=a.ctx.createImageData(d,e),l=k.data;for(let a=0;a<e;a++)for(let c=0;c<d;c++){let e=4*(c+a*d),k=0,m=0,n=0,o=0,p=0,q=0,r=0,s=(a+.5)*g;for(let d=Math.floor(a*g);d<(a+1)*g;d++){let a=Math.abs(s-(d+.5))/i,e=(c+.5)*f,g=a*a;for(let a=Math.floor(c*f);a<(c+1)*f;a++){let c=Math.abs(e-(a+.5))/h,f=Math.sqrt(g+c*c);f>1&&f<-1||(k=2*f*f*f-3*f*f+1)>0&&(r+=k*j[(c=4*(a+d*b))+3],n+=k,j[c+3]<255&&(k=k*j[c+3]/250),o+=k*j[c],p+=k*j[c+1],q+=k*j[c+2],m+=k)}}l[e]=o/m,l[e+1]=p/m,l[e+2]=q/m,l[e+3]=r/n}return k}}VK(_0,"type","Resize"),VK(_0,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),VK(_0,"uniformLocations",["uDelta","uTaps"]),Wp.setClass(_0);class _1 extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=-this.saturation;for(let a=0;a<b.length;a+=4){let d=b[a],e=b[a+1],f=b[a+2],g=Math.max(d,e,f);b[a]+=g!==d?(g-d)*c:0,b[a+1]+=g!==e?(g-e)*c:0,b[a+2]+=g!==f?(g-f)*c:0}}sendUniformData(a,b){a.uniform1f(b.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}VK(_1,"type","Saturation"),VK(_1,"defaults",{saturation:0}),VK(_1,"uniformLocations",["uSaturation"]),Wp.setClass(_1);class _2 extends _x{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(a){let{imageData:{data:b}}=a,c=-this.vibrance;for(let a=0;a<b.length;a+=4){let d=b[a],e=b[a+1],f=b[a+2],g=Math.max(d,e,f),h=2*Math.abs(g-(d+e+f)/3)/255*c;b[a]+=g!==d?(g-d)*h:0,b[a+1]+=g!==e?(g-e)*h:0,b[a+2]+=g!==f?(g-f)*h:0}}sendUniformData(a,b){a.uniform1f(b.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}VK(_2,"type","Vibrance"),VK(_2,"defaults",{vibrance:0}),VK(_2,"uniformLocations",["uVibrance"]),Wp.setClass(_2),Object.freeze({__proto__:null,BaseFilter:_x,BlackWhite:_N,BlendColor:_z,BlendImage:_B,Blur:_C,Brightness:_D,Brownie:_H,ColorMatrix:_F,Composed:_O,Contrast:_P,Convolute:_R,Gamma:_T,Grayscale:_V,HueRotation:_X,Invert:_Y,Kodachrome:_J,Noise:_Z,Pixelate:_$,Polaroid:_L,RemoveColor:__,Resize:_0,Saturation:_1,Sepia:_M,Technicolor:_K,Vibrance:_2,Vintage:_I});var _3=a.i(290523),_3=_3,_4=a.i(700857),_5=a.i(879442),_6=a.i(908819),_7=a.i(639928),_8=a.i(106466),_9=a.i(711503);function aaa({sessionId:a,socket:b,userId:c,userName:d,role:e,className:f=""}){let g=(0,bT.useRef)(null),h=(0,bT.useRef)(null),i=(0,bT.useRef)(null),j=(0,bT.useRef)(null),k=(0,bT.useRef)(null),l=(0,bT.useRef)("draw"),m=(0,bT.useRef)(!0),n=(0,bT.useRef)(()=>{}),o=(0,bT.useRef)(null),p=(0,bT.useRef)(null),q=(0,bT.useRef)(null),r=(0,bT.useRef)(!1),[s,t]=(0,bT.useState)("draw"),[u,v]=(0,bT.useState)(!1),[w,y]=(0,bT.useState)(!1),[z,A]=(0,bT.useState)(!1),[B,C]=(0,bT.useState)([]),D="tutor"===e||!w,E=(0,bT.useCallback)(a=>{let b=i.current;b&&(b.isDrawingMode=!a&&("draw"===s||"erase"===s),b.selection=!a&&"select"===s,b.skipTargetFind=a||"select"!==s,b.forEachObject(b=>{b.selectable=!a,b.evented=!a}),a&&b.discardActiveObject(),b.renderAll())},[s]),F=(0,bT.useCallback)(()=>{let c=i.current,d=p.current;c&&d&&D&&(q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{if(r.current||!i.current||!p.current)return;let c=i.current.toJSON();p.current.set("snapshot",c),p.current.set("updatedAt",Date.now()),b?.emit("math_tl_snapshot",{sessionId:a,snapshot:c})},140))},[D,a,b]);(0,bT.useEffect)(()=>{l.current=s},[s]),(0,bT.useEffect)(()=>{m.current=D},[D]),(0,bT.useEffect)(()=>{n.current=F},[F]);let G=(0,bT.useCallback)(a=>{let b=i.current;if(!b||!a)return;r.current=!0;let c=!1,d=()=>{c||(c=!0,b.renderAll(),window.setTimeout(()=>{r.current=!1},0))};try{let c=b.loadFromJSON(a,d);c&&"function"==typeof c.then&&c.then(d).catch(d)}catch{d()}},[]);(0,bT.useEffect)(()=>{let c=new TI,d=c.getMap("meta");o.current=c,p.current=d;let e=(c,d)=>{b&&"remote"!==d&&b.emit("math_yjs_update",{sessionId:a,update:Array.from(c)})},f=()=>{let a=d.get("snapshot");a&&!r.current&&G(a)};return c.on("update",e),d.observe(f),()=>{q.current&&clearTimeout(q.current),d.unobserve(f),c.off("update",e),c.destroy(),o.current=null,p.current=null}},[G,a,b]),(0,bT.useEffect)(()=>{if(!b)return;let f=()=>{b.emit("math_wb_join",{sessionId:a,userId:c,name:d||("tutor"===e?"Tutor":"Student"),role:e}),b.emit("math_wb_request_sync",a),v(!0)},g=()=>f(),h=()=>v(!1),i=a=>{y(!!a.locked),a.locked||(A(!1),"tutor"===e&&C([])),a.tldrawSnapshot&&p.current&&p.current.set("snapshot",a.tldrawSnapshot)},j=a=>{y(!!a.locked),a.locked||(A(!1),"tutor"===e&&C([]))},k=b=>{if(b.sessionId&&b.sessionId!==a||"tutor"!==e)return;let c=b.requester?.name?.trim();c&&C(a=>{let d=b.requester?.userId||c;return[...a.filter(a=>(a.userId||a.name)!==d),{userId:b.requester?.userId,name:c,requestedAt:b.requestedAt||Date.now()}].slice(-6)})},l=b=>{if(b.sessionId&&b.sessionId!==a)return;let c=o.current;c&&TS(c,Uint8Array.from(b.update||[]),"remote",TK)},m=b=>{if(b.sessionId&&b.sessionId!==a||b.actorId&&b.actorId===c)return;let d=o.current;d&&TS(d,Uint8Array.from(b.update||[]),"remote",TK)},n=b=>{b.sessionId&&b.sessionId!==a||b.actorId&&b.actorId===c||b.snapshot&&G(b.snapshot)};return b.on("connect",g),b.on("disconnect",h),b.on("math_wb_state",i),b.on("math_wb_lock_changed",j),b.on("math_wb_edit_request",k),b.on("math_yjs_sync",l),b.on("math_yjs_update",m),b.on("math_tl_snapshot",n),b.connected&&f(),()=>{b.off("connect",g),b.off("disconnect",h),b.off("math_wb_state",i),b.off("math_wb_lock_changed",j),b.off("math_wb_edit_request",k),b.off("math_yjs_sync",l),b.off("math_yjs_update",m),b.off("math_tl_snapshot",n),b.emit("math_wb_leave",a)}},[G,e,a,b,c,d]),(0,bT.useEffect)(()=>{if(!h.current||i.current)return;let b=new $H(h.current,{width:1280,height:720,backgroundColor:"#ffffff",isDrawingMode:!0,selection:!1,preserveObjectStacking:!0});i.current=b,h.current.__fabricCanvas=b;let c=b.upperCanvasEl;c&&(c.dataset.testid="fabric-math-interactive-canvas",c.dataset.mathSession=a,c.__fabricCanvas=b,c.style.pointerEvents="auto",c.style.touchAction="none"),b.lowerCanvasEl&&(b.lowerCanvasEl.style.pointerEvents="auto",b.lowerCanvasEl.style.touchAction="none");let d=b.freeDrawingBrush;d&&(d.color="#111827",d.width=2);let e=()=>{r.current||n.current()},f=a=>{if(a.scenePoint&&Number.isFinite(a.scenePoint.x)&&Number.isFinite(a.scenePoint.y))return{x:a.scenePoint.x,y:a.scenePoint.y};let c=a.e;if(!c)return null;if("function"==typeof b.getScenePoint){let a=b.getScenePoint(c);if(Number.isFinite(a.x)&&Number.isFinite(a.y))return{x:a.x,y:a.y}}if("function"==typeof b.getPointer){let a=b.getPointer(c);if(Number.isFinite(a.x)&&Number.isFinite(a.y))return{x:a.x,y:a.y}}return null},o=a=>{if(!m.current)return;let c=f(a);if(!c)return;let d=l.current;if("text"===d){let a=new _j("Text",{left:c.x,top:c.y,fontSize:20,fill:"#111827"});b.add(a),b.setActiveObject(a),a.enterEditing(),e();return}if("rect"===d||"circle"===d)if(k.current={x:c.x,y:c.y},"rect"===d){let a=new ZN({left:c.x,top:c.y,width:1,height:1,fill:"rgba(37, 99, 235, 0.08)",stroke:"#2563eb",strokeWidth:2});j.current=a,b.add(a)}else{let a=new $W({left:c.x,top:c.y,radius:1,fill:"rgba(16, 185, 129, 0.08)",stroke:"#10b981",strokeWidth:2});j.current=a,b.add(a)}},p=a=>{if(!m.current||!k.current||!j.current)return;let c=f(a);if(c){if(j.current instanceof ZN){let a=Math.min(k.current.x,c.x),b=Math.min(k.current.y,c.y),d=Math.abs(c.x-k.current.x),e=Math.abs(c.y-k.current.y);j.current.set({left:a,top:b,width:d,height:e})}else if(j.current instanceof $W){let a=Math.max(Math.abs(c.x-k.current.x),Math.abs(c.y-k.current.y))/2;j.current.set({radius:a,left:k.current.x-a,top:k.current.y-a})}b.renderAll()}},q=()=>{m.current&&j.current&&(j.current=null,k.current=null,e())};b.on("path:created",e),b.on("object:modified",e),b.on("object:removed",e),b.on("mouse:down",o),b.on("mouse:move",p),b.on("mouse:up",q);let s=()=>{let a=g.current;if(!a)return;let c=a.getBoundingClientRect(),d=Math.max(960,Math.floor(c.width-12)),e=Math.max(520,Math.floor(c.height-12));b.setDimensions({width:d,height:e}),b.renderAll()};s();let t=new ResizeObserver(()=>s());return g.current&&t.observe(g.current),()=>{t.disconnect(),b.off("path:created",e),b.off("object:modified",e),b.off("object:removed",e),b.off("mouse:down",o),b.off("mouse:move",p),b.off("mouse:up",q),b.dispose(),i.current=null}},[a]),(0,bT.useEffect)(()=>{let a=i.current;a&&(a.isDrawingMode=D&&("draw"===s||"erase"===s),a.selection=D&&"select"===s,a.skipTargetFind=!(D&&"select"===s),a.freeDrawingBrush&&(a.freeDrawingBrush.color="erase"===s?"#ffffff":"#111827",a.freeDrawingBrush.width="erase"===s?18:2),"select"!==s&&a.discardActiveObject(),E(!D))},[E,D,s]);let H=(0,bT.useMemo)(()=>u?(0,bS.jsxs)(VD.Badge,{variant:"outline",className:"gap-1",children:[(0,bS.jsx)(VH,{className:"h-3 w-3 text-green-600"}),"Synced"]}):(0,bS.jsxs)(VD.Badge,{variant:"outline",className:"gap-1",children:[(0,bS.jsx)(VI,{className:"h-3 w-3 text-amber-600"}),"Reconnecting"]}),[u]),I=(a,b,c)=>(0,bS.jsxs)(VC.Button,{type:"button",size:"sm",variant:s===a?"default":"outline",onClick:()=>t(a),disabled:!D,className:"gap-1",children:[c,b]},a);return(0,bS.jsxs)("div",{className:`h-full min-h-0 flex flex-col rounded-lg border bg-white ${f}`,"data-testid":"fabric-math-board",children:[(0,bS.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 border-b px-3 py-2",children:[(0,bS.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bS.jsx)("h3",{className:"text-sm font-semibold",children:"Math Whiteboard"}),H,(0,bS.jsx)(VD.Badge,{variant:D?"default":"secondary",children:D?"Editable":"Read only"})]}),(0,bS.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[D?(0,bS.jsxs)(bS.Fragment,{children:[I("select","Select",(0,bS.jsx)(_7.MousePointer2,{className:"h-3 w-3"})),I("draw","Draw",(0,bS.jsx)(_3.default,{className:"h-3 w-3"})),I("erase","Erase",(0,bS.jsx)(_8.Eraser,{className:"h-3 w-3"})),I("rect","Rectangle",(0,bS.jsx)(_4.Square,{className:"h-3 w-3"})),I("circle","Circle",(0,bS.jsx)(_5.Circle,{className:"h-3 w-3"})),I("text","Text",(0,bS.jsx)(_6.Type,{className:"h-3 w-3"}))]}):(0,bS.jsx)(VD.Badge,{variant:"secondary",children:"Toolbar disabled while locked"}),"student"===e&&!D&&(0,bS.jsxs)(VC.Button,{variant:"secondary",size:"sm",className:"gap-1",onClick:()=>{"student"===e&&!D&&b&&(b.emit("math_wb_edit_request",{sessionId:a}),A(!0))},disabled:z,children:[(0,bS.jsx)(_9.Hand,{className:"h-3 w-3"}),z?"Request sent":"Request edit access"]}),"tutor"===e&&(0,bS.jsxs)(VC.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>b?.emit("math_wb_lock",{sessionId:a,locked:!w}),children:[w?(0,bS.jsx)(VF.Unlock,{className:"h-3 w-3"}):(0,bS.jsx)(VE.Lock,{className:"h-3 w-3"}),w?"Unlock Students":"Lock Students"]}),"tutor"===e&&B.length>0&&(0,bS.jsxs)(VD.Badge,{variant:"secondary",children:[B.length," edit request",1===B.length?"":"s"]})]})]}),(0,bS.jsxs)("div",{ref:g,className:"relative flex-1 min-h-0 touch-none p-1",children:["student"===e&&!D&&(0,bS.jsx)("div",{className:"absolute left-3 right-3 top-3 z-10 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-900 shadow-sm",children:"Board locked by tutor. You can view only until access is granted."}),(0,bS.jsx)("canvas",{ref:h,"data-testid":"fabric-math-canvas","data-math-session":a,className:"h-full w-full rounded border border-slate-200"})]})]})}function aab(a){return"tldraw"==("tldraw"===(process.env.NEXT_PUBLIC_MATH_ENGINE||"fabric").toLowerCase()?"tldraw":"fabric")?(0,bS.jsx)(VJ,{...a}):(0,bS.jsx)(aaa,{...a})}a.s(["MathBoardHost",()=>aab],870769)}];

//# debugId=aaba1c82-b0c7-afa0-1b5c-17d9e2cdb7cb
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_19ceea61._.js.map