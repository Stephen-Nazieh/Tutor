;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bca1f35b-0f2b-4ef7-8024-9e1deae63336")}catch(e){}}();
module.exports=[624968,a=>{"use strict";var b=a.i(260576),c=a.i(741510),d=a.i(454069),e=a.i(52028),f=a.i(88684),g=a.i(878677),h=a.i(981354),i=a.i(529004),j=a.i(263805),k=a.i(962337),l=a.i(94261),m=a.i(365134),n=a.i(106466),o=a.i(263531),p=a.i(640132),q=a.i(143650),r=a.i(414030),s=a.i(192730),t=a.i(784276),u=a.i(595484),v=a.i(706562),w=a.i(892094),x=a.i(293357);let y=(0,x.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),z=(0,x.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var A=a.i(711503),B=a.i(609931),C=a.i(479680),D=a.i(554015),E=a.i(36094),F=a.i(846438),G=a.i(591137),H=a.i(326684);let I=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#333333","#666666","#999999","#CCCCCC"];function J(){(0,d.useRouter)();let x=(0,d.useParams)(),{data:J}=(0,H.useSession)(),K=x.id,L=(0,c.useRef)(null),M=(0,c.useRef)(null),[N,O]=(0,c.useState)(!0),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(null),[T,U]=(0,c.useState)([]),[V,W]=(0,c.useState)(0),[X,Y]=(0,c.useState)("pen"),[Z,$]=(0,c.useState)("#000000"),[_,aa]=(0,c.useState)(3),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)([]),[af,ag]=(0,c.useState)(1),[ah,ai]=(0,c.useState)({x:0,y:0}),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)({x:0,y:0}),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(""),[ar,as]=(0,c.useState)(!1),at=T[V],{isConnected:au,activeUsers:av,sendStroke:aw}=function({whiteboardId:b,roomId:d,userId:e,userName:f,userColor:g,onStroke:h,onShape:i,onText:j,onCursor:k,onUserJoined:l,onUserLeft:m,onClear:n,onUndo:o,onStateUpdate:p}){let q=(0,c.useRef)(null),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(null),x=(0,c.useRef)(new Map);(0,c.useEffect)(()=>{if(b)return(async()=>{let c=await a.A(443374).then(a=>a.getSocketToken());if(!c)return;let r=(0,G.io)({path:"/api/socket",transports:["websocket","polling"],auth:{token:c}});q.current=r,r.on("connect",()=>{console.log("Whiteboard socket connected:",r.id),s(!0),w(null),r.emit("wb_join",{whiteboardId:b,roomId:d,userId:e,name:f,color:g})}),r.on("disconnect",()=>{console.log("Whiteboard socket disconnected"),s(!1)}),r.on("connect_error",a=>{console.error("Whiteboard socket error:",a),w(a.message),s(!1)}),r.on("wb_state",a=>{u(a.activeUsers||[]),p?.(a)}),r.on("wb_stroke",a=>{h?.(a)}),r.on("wb_shape",a=>{i?.(a)}),r.on("wb_text",a=>{j?.(a)}),r.on("wb_cursor",a=>{x.current.set(a.userId,a),k?.(a)}),r.on("wb_user_joined",a=>{u(b=>[...b.filter(b=>b!==a.userId),a.userId]),l?.(a)}),r.on("wb_user_left",a=>{u(b=>b.filter(b=>b!==a.userId)),x.current.delete(a.userId),m?.(a)}),r.on("wb_cleared",a=>{n?.(a)}),r.on("wb_undone",a=>{o?.(a)})})(),()=>{q.current?.emit("wb_leave",{whiteboardId:b,userId:e}),q.current?.disconnect(),q.current=null,s(!1)}},[b,d,e,f,g]);let y=(0,c.useCallback)(a=>{q.current?.emit("wb_stroke",{whiteboardId:b,stroke:a})},[b]),z=(0,c.useCallback)(a=>{q.current?.emit("wb_shape",{whiteboardId:b,shape:a})},[b]),A=(0,c.useCallback)(a=>{q.current?.emit("wb_text",{whiteboardId:b,text:a})},[b]),B=(0,c.useCallback)((a,c)=>{q.current?.emit("wb_cursor",{whiteboardId:b,userId:e,name:f,color:g,x:a,y:c})},[b,e,f,g]),C=(0,c.useCallback)(()=>{q.current?.emit("wb_clear",{whiteboardId:b,userId:e})},[b,e]),D=(0,c.useCallback)(()=>{q.current?.emit("wb_undo",{whiteboardId:b,userId:e})},[b,e]);return{isConnected:r,error:v,activeUsers:t,cursors:x.current,sendStroke:y,sendShape:z,sendText:A,sendCursor:B,clearWhiteboard:C,undo:D}}({whiteboardId:K,roomId:K,userId:J?.user?.id||"",userName:J?.user?.name||"Anonymous",userColor:"#3b82f6",onStroke:a=>{if(!T[V])return;let b=[...T];b[V].strokes.push(a),U(b),ay()}});(0,c.useEffect)(()=>{K&&ax()},[K]);let ax=async()=>{try{let a=await fetch(`/api/whiteboards/${K}?pages=true`,{credentials:"include"});if(!a.ok)throw Error("Failed to fetch whiteboard");let b=await a.json();S(b.whiteboard),U(b.whiteboard.pages||[])}catch(a){F.toast.error("Failed to load whiteboard"),console.error(a)}finally{O(!1)}};(0,c.useEffect)(()=>{let a=L.current,b=M.current;if(!a||!b||!at)return;let c=()=>{a.width=b.clientWidth,a.height=b.clientHeight,ay()};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[at]);let ay=(0,c.useCallback)(()=>{let a=L.current,b=a?.getContext("2d");a&&b&&at&&(b.fillStyle=at.backgroundColor||"#ffffff",b.fillRect(0,0,a.width,a.height),az(b,a.width,a.height,at.backgroundStyle),b.save(),b.translate(ah.x,ah.y),b.scale(af,af),at.strokes?.forEach(a=>{aA(b,a)}),ad.length>0&&aA(b,{id:"temp",points:ad,color:"eraser"===X?"#ffffff":Z,width:"eraser"===X?20:_,type:"eraser"===X?"eraser":"pen",userId:""}),b.restore())},[at,af,ah,ad,Z,_,X]),az=(a,b,c,d)=>{switch(a.strokeStyle="#e5e7eb",a.lineWidth=1,d){case"grid":for(let d=0;d<b;d+=40)a.beginPath(),a.moveTo(d,0),a.lineTo(d,c),a.stroke();for(let d=0;d<c;d+=40)a.beginPath(),a.moveTo(0,d),a.lineTo(b,d),a.stroke();break;case"dots":a.fillStyle="#e5e7eb";for(let d=20;d<b;d+=40)for(let b=20;b<c;b+=40)a.beginPath(),a.arc(d,b,2,0,2*Math.PI),a.fill();break;case"lines":for(let d=0;d<c;d+=40)a.beginPath(),a.moveTo(0,d),a.lineTo(b,d),a.stroke()}},aA=(a,b)=>{b.points.length<2||("eraser"===b.type?a.globalCompositeOperation="destination-out":(a.strokeStyle=b.color,a.globalCompositeOperation="source-over"),a.lineWidth=b.width,a.lineCap="round",a.lineJoin="round",a.beginPath(),a.moveTo(b.points[0].x,b.points[0].y),b.points.forEach((b,c)=>{c>0&&a.lineTo(b.x,b.y)}),a.stroke(),a.globalCompositeOperation="source-over")},aB=(a,b)=>{let c=L.current;if(!c)return{x:0,y:0};let d=c.getBoundingClientRect();return{x:(a-d.left-ah.x)/af,y:(b-d.top-ah.y)/af}},aC=async()=>{if(aj)return void ak(!1);if(!ab||0===ad.length)return;ac(!1);let a={id:Date.now().toString(),points:ad,color:"eraser"===X?"#ffffff":Z,width:"eraser"===X?20:_,type:"eraser"===X?"eraser":"pen",userId:J?.user?.id||""},b=[...T];b[V].strokes.push(a),U(b),ae([]),aw(a),await aD()},aD=async()=>{if(at){Q(!0);try{if(!(await fetch(`/api/whiteboards/${K}/pages/${at.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({strokes:at.strokes,viewState:{scale:af,panX:ah.x,panY:ah.y}})})).ok)throw Error("Failed to save")}catch(a){console.error("Save error:",a)}finally{Q(!1)}}},aE=async()=>{if(!at||!confirm("Clear all content from this page?"))return;let a=[...T];a[V].strokes=[],U(a),await aD(),F.toast.success("Page cleared")},aF=async()=>{if(!at||0===at.strokes.length)return;let a=[...T];a[V].strokes.pop(),U(a),await aD()},aG=async a=>{try{let b=await fetch(`/api/whiteboards/${K}/export?format=${a}`,{credentials:"include"});if(!b.ok)throw Error("Export failed");let c=await b.blob(),d=URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`${R.title}.${a}`,e.click(),F.toast.success("Export downloaded")}catch(a){F.toast.error("Export failed")}},aH=async()=>{if(ap.trim())try{if(!(await fetch(`/api/whiteboards/${K}/snapshots`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:ap})})).ok)throw Error("Failed to create snapshot");F.toast.success("Snapshot created"),as(!1),aq("")}catch(a){F.toast.error("Failed to create snapshot")}},aI=async()=>{try{let a=await fetch(`/api/whiteboards/${K}/pages`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:`Page ${T.length+1}`})});if(!a.ok)throw Error("Failed to create page");let b=await a.json();U([...T,b.page]),W(T.length),F.toast.success("Page added")}catch(a){F.toast.error("Failed to add page")}};return((0,c.useEffect)(()=>{ay()},[ay]),N)?(0,b.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,b.jsx)(C.Loader2,{className:"w-8 h-8 animate-spin text-blue-600"})}):R?(0,b.jsxs)("div",{className:"h-screen flex flex-col bg-gray-100",children:[(0,b.jsxs)("div",{className:"h-14 bg-white border-b flex items-center justify-between px-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/tutor/whiteboards",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(r.ArrowLeft,{className:"w-5 h-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"font-semibold",children:R.title}),au&&(0,b.jsxs)("span",{className:"text-xs text-green-600 flex items-center gap-1",children:[(0,b.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Live (",av.length," users)"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[T.length>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2 mr-4",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",disabled:0===V,onClick:()=>W(a=>a-1),children:(0,b.jsx)(v.ChevronLeft,{className:"w-4 h-4"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[V+1," / ",T.length]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",disabled:V===T.length-1,onClick:()=>W(a=>a+1),children:(0,b.jsx)(w.ChevronRight,{className:"w-4 h-4"})})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>aI(),children:(0,b.jsx)(u.Plus,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>as(!0),children:(0,b.jsx)(s.Save,{className:"w-4 h-4"})}),(0,b.jsxs)(k.DropdownMenu,{children:[(0,b.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(t.MoreVertical,{className:"w-4 h-4"})})}),(0,b.jsxs)(k.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(k.DropdownMenuItem,{onClick:()=>aG("json"),children:[(0,b.jsx)(p.Download,{className:"w-4 h-4 mr-2"}),"Export JSON"]}),(0,b.jsxs)(k.DropdownMenuItem,{onClick:()=>aG("svg"),children:[(0,b.jsx)(p.Download,{className:"w-4 h-4 mr-2"}),"Export SVG"]}),(0,b.jsxs)(k.DropdownMenuItem,{onClick:()=>ao(!0),children:[(0,b.jsx)(D.Share2,{className:"w-4 h-4 mr-2"}),"Share"]})]})]}),P&&(0,b.jsx)(C.Loader2,{className:"w-4 h-4 animate-spin text-blue-600"})]})]}),(0,b.jsxs)("div",{className:"h-14 bg-white border-b flex items-center px-4 gap-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:[{id:"pen",icon:m.Pencil,label:"Pen"},{id:"eraser",icon:n.Eraser,label:"Eraser"},{id:"hand",icon:A.Hand,label:"Pan"}].map(({id:a,icon:c,label:d})=>(0,b.jsx)(l.TooltipProvider,{children:(0,b.jsxs)(l.Tooltip,{children:[(0,b.jsx)(l.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("button",{onClick:()=>Y(a),className:`p-2 rounded ${X===a?"bg-white shadow-sm":"hover:bg-gray-200"}`,children:(0,b.jsx)(c,{className:"w-4 h-4"})})}),(0,b.jsx)(l.TooltipContent,{children:d})]})},a))}),(0,b.jsx)("div",{className:"w-px h-8 bg-gray-200"}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:I.slice(0,8).map(a=>(0,b.jsx)("button",{onClick:()=>$(a),className:`w-6 h-6 rounded-full border-2 ${Z===a?"border-blue-500":"border-transparent"}`,style:{backgroundColor:a}},a))}),(0,b.jsx)("div",{className:"w-px h-8 bg-gray-200"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 w-32",children:[(0,b.jsx)(B.Minus,{className:"w-3 h-3"}),(0,b.jsx)(g.Slider,{value:[_],onValueChange:([a])=>aa(a),min:1,max:20,step:1}),(0,b.jsx)("span",{className:"text-xs w-6",children:_})]}),(0,b.jsx)("div",{className:"w-px h-8 bg-gray-200"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>ag(a=>Math.max(.1,a-.1)),children:(0,b.jsx)(z,{className:"w-4 h-4"})}),(0,b.jsxs)("span",{className:"text-sm w-16 text-center",children:[Math.round(100*af),"%"]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>ag(a=>Math.min(5,a+.1)),children:(0,b.jsx)(y,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:aF,children:(0,b.jsx)(o.Undo,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:aE,children:(0,b.jsx)(q.Trash2,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{ref:M,className:"flex-1 overflow-hidden relative",onWheel:a=>{a.preventDefault();let b=a.deltaY>0?.9:1.1;ag(a=>Math.max(.1,Math.min(5,a*b)))},children:(0,b.jsx)("canvas",{ref:L,onMouseDown:a=>{if(at){if("hand"===X){ak(!0),am({x:a.clientX-ah.x,y:a.clientY-ah.y});return}ac(!0),ae([aB(a.clientX,a.clientY)])}},onMouseMove:a=>{if(aj)return void ai({x:a.clientX-al.x,y:a.clientY-al.y});if(!ab)return;let b=aB(a.clientX,a.clientY);ae(a=>[...a,b])},onMouseUp:aC,onMouseLeave:aC,className:`absolute inset-0 ${"hand"===X?"cursor-grab":"cursor-crosshair"} ${aj?"cursor-grabbing":""}`})}),(0,b.jsx)(j.Dialog,{open:an,onOpenChange:ao,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Share Whiteboard"}),(0,b.jsx)(j.DialogDescription,{children:"Share this whiteboard with others to collaborate in real-time."})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(i.Label,{children:"Share Link"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(h.Input,{value:`${window.location.origin}/tutor/live-class/${K}`,readOnly:!0}),(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(`${window.location.origin}/tutor/live-class/${K}`),F.toast.success("Link copied")},children:(0,b.jsx)(E.Copy,{className:"w-4 h-4"})})]})]})]})}),(0,b.jsx)(j.Dialog,{open:ar,onOpenChange:as,children:(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:"Create Snapshot"}),(0,b.jsx)(j.DialogDescription,{children:"Save a snapshot of the current whiteboard state."})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(i.Label,{children:"Snapshot Name"}),(0,b.jsx)(h.Input,{placeholder:"e.g., Before Class",value:ap,onChange:a=>aq(a.target.value),className:"mt-2"})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>as(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:aH,disabled:!ap.trim(),children:"Create Snapshot"})]})]})})]}):(0,b.jsxs)("div",{className:"h-screen flex flex-col items-center justify-center",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Whiteboard not found"}),(0,b.jsx)(e.default,{href:"/tutor/whiteboards",children:(0,b.jsx)(f.Button,{children:"Back to Whiteboards"})})]})}a.s(["default",()=>J],624968)}];

//# debugId=bca1f35b-0f2b-4ef7-8024-9e1deae63336
//# sourceMappingURL=286d7_tutorme-app_src_app_%5Blocale%5D_tutor_whiteboards_%5Bid%5D_page_tsx_f74a14df._.js.map