{
  "version": 3,
  "sources": [],
  "debugId": "62d1eca4-ac10-ecd5-a8eb-26aa9eb66160",
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-simple-socket.ts"],"sourcesContent":["/**\n * Simple Socket.io Hook\n * \n * Provides a basic socket connection for room-based features.\n * Used by the Live Class Whiteboard system.\n */\n\nimport { useEffect, useRef, useState } from 'react'\nimport { io, Socket } from 'socket.io-client'\n\ninterface SimpleSocketOptions {\n  userId?: string\n  name?: string\n  role?: 'student' | 'tutor'\n}\n\nexport function useSimpleSocket(roomId: string, options: SimpleSocketOptions = {}) {\n  const socketRef = useRef<Socket | null>(null)\n  const [socketInstance, setSocketInstance] = useState<Socket | null>(null)\n  const [isConnected, setIsConnected] = useState(false)\n\n  useEffect(() => {\n    if (!roomId) return\n\n    const connect = async () => {\n      const token = await import('@/lib/socket-auth').then((m) => m.getSocketToken())\n      if (!token) return\n      const socket = io({\n        path: '/api/socket',\n        transports: ['websocket', 'polling'],\n        timeout: 20000,\n        reconnection: true,\n        reconnectionAttempts: 10,\n        reconnectionDelay: 500,\n        auth: { token },\n      })\n      socketRef.current = socket\n\n    socket.on('connect', () => {\n      setIsConnected(true)\n      setSocketInstance(socket)\n\n      if (roomId && options.userId && options.role) {\n        socket.emit('join_class', {\n          roomId,\n          userId: options.userId,\n          name: options.name || options.role,\n          role: options.role,\n        })\n      }\n    })\n\n    socket.on('disconnect', () => {\n      setIsConnected(false)\n      setSocketInstance(null)\n    })\n\n    socket.on('connect_error', (err) => {\n      console.warn('Socket connection error:', err?.message || err)\n      setIsConnected(false)\n    })\n    }\n    connect()\n    return () => {\n      socketRef.current?.disconnect()\n      socketRef.current = null\n    }\n  }, [roomId, options.name, options.role, options.userId])\n\n  return {\n    socket: socketInstance,\n    isConnected\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;CAKC,GAED;AACA;;;;AAQO,SAAS,gBAAgB,MAAc,EAAE,UAA+B,CAAC,CAAC;;IAC/E,MAAM,YAAY,IAAA,yNAAM,EAAgB;IACxC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,2NAAQ,EAAgB;IACpE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC;IAE/C,IAAA,4NAAS;qCAAC;YACR,IAAI,CAAC,QAAQ;YAEb,MAAM;qDAAU;oBACd,MAAM,QAAQ,MAAM,0IAA4B,IAAI;6DAAC,CAAC,IAAM,EAAE,cAAc;;oBAC5E,IAAI,CAAC,OAAO;oBACZ,MAAM,SAAS,IAAA,0OAAE,EAAC;wBAChB,MAAM;wBACN,YAAY;4BAAC;4BAAa;yBAAU;wBACpC,SAAS;wBACT,cAAc;wBACd,sBAAsB;wBACtB,mBAAmB;wBACnB,MAAM;4BAAE;wBAAM;oBAChB;oBACA,UAAU,OAAO,GAAG;oBAEtB,OAAO,EAAE,CAAC;6DAAW;4BACnB,eAAe;4BACf,kBAAkB;4BAElB,IAAI,UAAU,QAAQ,MAAM,IAAI,QAAQ,IAAI,EAAE;gCAC5C,OAAO,IAAI,CAAC,cAAc;oCACxB;oCACA,QAAQ,QAAQ,MAAM;oCACtB,MAAM,QAAQ,IAAI,IAAI,QAAQ,IAAI;oCAClC,MAAM,QAAQ,IAAI;gCACpB;4BACF;wBACF;;oBAEA,OAAO,EAAE,CAAC;6DAAc;4BACtB,eAAe;4BACf,kBAAkB;wBACpB;;oBAEA,OAAO,EAAE,CAAC;6DAAiB,CAAC;4BAC1B,QAAQ,IAAI,CAAC,4BAA4B,KAAK,WAAW;4BACzD,eAAe;wBACjB;;gBACA;;YACA;YACA;6CAAO;oBACL,UAAU,OAAO,EAAE;oBACnB,UAAU,OAAO,GAAG;gBACtB;;QACF;oCAAG;QAAC;QAAQ,QAAQ,IAAI;QAAE,QAAQ,IAAI;QAAE,QAAQ,MAAM;KAAC;IAEvD,OAAO;QACL,QAAQ;QACR;IACF;AACF;GAzDgB"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-live-class-whiteboard.ts"],"sourcesContent":["/**\n * Live Class Whiteboard Hook\n * \n * Manages whiteboard state and socket communication for Live Class sessions.\n * Supports both tutor broadcast mode and student personal whiteboards.\n */\n\nimport { useState, useEffect, useCallback, useRef } from 'react'\nimport { useSimpleSocket } from './use-simple-socket'\nimport { useSession } from 'next-auth/react'\nimport { toast } from 'sonner'\n\nexport interface WhiteboardStroke {\n  id: string\n  points: Array<{ x: number; y: number; pressure?: number }>\n  color: string\n  width: number\n  type: 'pen' | 'eraser' | 'pencil' | 'marker' | 'highlighter' | 'calligraphy' | 'shape' | 'text'\n  userId: string\n  opacity?: number\n  shapeType?: 'line' | 'arrow' | 'rectangle' | 'circle' | 'triangle' | 'connector'\n  text?: string\n  fontSize?: number\n  fontFamily?: string\n  textStyle?: {\n    bold?: boolean\n    italic?: boolean\n    align?: 'left' | 'center' | 'right'\n  }\n  pageId?: string\n  layerId?: 'tutor-broadcast' | 'tutor-private' | 'student-personal' | 'shared-group'\n  roomScope?: 'main' | 'breakout'\n  groupId?: string\n  zIndex?: number\n  locked?: boolean\n  rotation?: number\n  createdAt?: number\n  updatedAt?: number\n  sourceStrokeId?: string\n  targetStrokeId?: string\n  sourcePort?: 'top' | 'right' | 'bottom' | 'left' | 'center'\n  targetPort?: 'top' | 'right' | 'bottom' | 'left' | 'center'\n}\n\ninterface WhiteboardStrokeOp {\n  kind: 'upsert' | 'delete'\n  stroke?: WhiteboardStroke\n  strokeId?: string\n  opId?: string\n  sentAt?: number\n  baseVersion?: number\n  _seq?: number\n}\n\nexport interface WhiteboardSelectionPresence {\n  userId: string\n  name: string\n  role: 'tutor' | 'student'\n  strokeIds: string[]\n  pageId?: string\n  color: string\n  updatedAt: number\n}\n\nexport interface StudentWhiteboard {\n  studentId: string\n  studentName: string\n  whiteboardId: string\n  visibility: 'private' | 'tutor-only' | 'public'\n  strokes: WhiteboardStroke[]\n  lastActivity: Date\n}\n\nexport interface WhiteboardCursor {\n  userId: string\n  name: string\n  role: 'tutor' | 'student'\n  x: number\n  y: number\n  pointerMode?: 'cursor' | 'laser'\n  lastUpdated: number\n}\n\nexport interface WhiteboardSubmission {\n  studentId: string\n  studentName: string\n  submittedAt: number\n  strokeCount: number\n  reviewed: boolean\n  pinned?: boolean\n}\n\nexport interface LayerConfig {\n  id: 'tutor-broadcast' | 'tutor-private' | 'student-personal' | 'shared-group'\n  label: string\n  visible: boolean\n  locked: boolean\n}\n\nexport interface WhiteboardSnapshot {\n  id: string\n  createdAt: number\n  roomId: string\n  createdBy: string\n  strokes: WhiteboardStroke[]\n}\n\nexport interface WhiteboardSpotlight {\n  enabled: boolean\n  x: number\n  y: number\n  width: number\n  height: number\n  mode: 'rectangle' | 'pen'\n}\n\nexport function useLiveClassWhiteboard(\n  roomId: string | null,\n  sessionId: string | null,\n  role: 'tutor' | 'student'\n) {\n  const applyStrokeOps = useCallback((prev: WhiteboardStroke[], ops: WhiteboardStrokeOp[]) => {\n    if (!ops.length) return prev\n    let changed = false\n    const byId = new Map(prev.map((stroke) => [stroke.id, stroke]))\n    ops.forEach((op) => {\n      if (op.kind === 'delete') {\n        if (op.strokeId && byId.has(op.strokeId)) {\n          byId.delete(op.strokeId)\n          changed = true\n        }\n        return\n      }\n      const stroke = op.stroke\n      if (!stroke) return\n      const existing = byId.get(stroke.id)\n      const incomingVersion = stroke.updatedAt || stroke.createdAt || 0\n      const currentVersion = existing?.updatedAt || existing?.createdAt || 0\n      if (!existing || (incomingVersion >= currentVersion && JSON.stringify(existing) !== JSON.stringify(stroke))) {\n        byId.set(stroke.id, stroke)\n        changed = true\n      }\n    })\n    return changed ? Array.from(byId.values()) : prev\n  }, [])\n\n  const { data: session } = useSession()\n  const { socket, isConnected } = useSimpleSocket(roomId || '', {\n    userId: session?.user?.id,\n    name: session?.user?.name || role,\n    role,\n  })\n  \n  // Whiteboard state\n  const [myStrokes, setMyStrokes] = useState<WhiteboardStroke[]>([])\n  const [tutorStrokes, setTutorStrokes] = useState<WhiteboardStroke[]>([])\n  const [studentWhiteboards, setStudentWhiteboards] = useState<Map<string, StudentWhiteboard>>(new Map())\n  const [visibility, setVisibility] = useState<'private' | 'tutor-only' | 'public'>('private')\n  const [isBroadcasting, setIsBroadcasting] = useState(false)\n  const [viewingStudentId, setViewingStudentId] = useState<string | null>(null)\n  const [activeStudentBoards, setActiveStudentBoards] = useState<string[]>([])\n  const [remoteCursors, setRemoteCursors] = useState<Map<string, WhiteboardCursor>>(new Map())\n  const [remoteSelections, setRemoteSelections] = useState<Map<string, WhiteboardSelectionPresence>>(new Map())\n  const [availableBranches, setAvailableBranches] = useState<string[]>([])\n  const [isLayerLocked, setIsLayerLocked] = useState(false)\n  const [submissions, setSubmissions] = useState<Map<string, WhiteboardSubmission>>(new Map())\n  const [hasSubmitted, setHasSubmitted] = useState(false)\n  const [layerConfig, setLayerConfig] = useState<LayerConfig[]>([\n    { id: 'tutor-broadcast', label: 'Tutor Broadcast', visible: true, locked: false },\n    { id: 'tutor-private', label: 'Tutor Private', visible: true, locked: false },\n    { id: 'student-personal', label: 'Student Personal', visible: true, locked: false },\n    { id: 'shared-group', label: 'Shared Group', visible: true, locked: false },\n  ])\n  const [activeLayerId, setActiveLayerId] = useState<LayerConfig['id']>(role === 'tutor' ? 'tutor-broadcast' : 'student-personal')\n  const [assignmentOverlay, setAssignmentOverlay] = useState<'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure'>('none')\n  const [spotlight, setSpotlight] = useState<WhiteboardSpotlight>({\n    enabled: false,\n    x: 160,\n    y: 120,\n    width: 420,\n    height: 220,\n    mode: 'rectangle',\n  })\n  const [snapshots, setSnapshots] = useState<WhiteboardSnapshot[]>([])\n  const [timelineIndex, setTimelineIndex] = useState<number | null>(null)\n  const [aiRegionHints, setAiRegionHints] = useState<Array<{\n    requestedBy: string\n    region: { x: number; y: number; width: number; height: number }\n    hint: string\n    misconception: string\n    timestamp: number\n  }>>([])\n  const [moderationState, setModerationState] = useState<{\n    mutedStudentIds: string[]\n    studentStrokeWindowLimit: number\n    strokeWindowMs: number\n    lockedLayers: string[]\n  }>({\n    mutedStudentIds: [],\n    studentStrokeWindowLimit: 80,\n    strokeWindowMs: 5000,\n    lockedLayers: [],\n  })\n  \n  const strokesRef = useRef<WhiteboardStroke[]>([])\n  const pendingOpsRef = useRef<WhiteboardStrokeOp[]>([])\n  const flushTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\n  const localOpSeqRef = useRef(0)\n  const boardSeqRef = useRef<{ student: number; tutor: number }>({ student: 0, tutor: 0 })\n  \n  // Keep ref in sync\n  useEffect(() => {\n    strokesRef.current = myStrokes\n  }, [myStrokes])\n\n  const flushStrokeOps = useCallback(() => {\n    if (!socket || !roomId || !session?.user?.id) return\n    if (!pendingOpsRef.current.length) return\n    const merged = new Map<string, WhiteboardStrokeOp>()\n    pendingOpsRef.current.forEach((op) => {\n      if (op.kind === 'delete' && op.strokeId) {\n        merged.set(op.strokeId, op)\n      } else if (op.kind === 'upsert' && op.stroke) {\n        merged.set(op.stroke.id, op)\n      }\n    })\n    pendingOpsRef.current = []\n    const ops = Array.from(merged.values())\n    if (!ops.length) return\n    if (role === 'student') {\n      socket.emit('lcwb_student_stroke_ops', {\n        roomId,\n        userId: session.user.id,\n        ops,\n        visibility,\n      })\n    } else if (role === 'tutor') {\n      socket.emit('lcwb_tutor_stroke_ops', {\n        roomId,\n        ops,\n      })\n    }\n  }, [role, roomId, session, socket, visibility])\n\n  const enqueueStrokeOps = useCallback((ops: WhiteboardStrokeOp[]) => {\n    if (!ops.length) return\n    pendingOpsRef.current.push(...ops)\n    if (pendingOpsRef.current.length >= 120) {\n      flushStrokeOps()\n      return\n    }\n    if (flushTimerRef.current) return\n    flushTimerRef.current = setTimeout(() => {\n      flushTimerRef.current = null\n      flushStrokeOps()\n    }, 28)\n  }, [flushStrokeOps])\n\n  useEffect(() => {\n    return () => {\n      if (flushTimerRef.current) {\n        clearTimeout(flushTimerRef.current)\n        flushTimerRef.current = null\n      }\n      flushStrokeOps()\n    }\n  }, [flushStrokeOps])\n  \n  // Initialize whiteboard on mount\n  useEffect(() => {\n    if (!sessionId || !socket || !isConnected) return\n    \n    const userId = session?.user?.id\n    if (!userId) return\n    \n    if (role === 'student') {\n      // Join student's personal whiteboard\n      socket.emit('lcwb_student_join', {\n        roomId,\n        userId,\n        name: session?.user?.name || 'Student'\n      })\n    }\n    \n    // Request initial sync\n    socket.emit('lcwb_sync_request', { roomId, userId })\n    socket.emit('lcwb_replay_request', {\n      roomId,\n      userId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      sinceSeq: role === 'tutor' ? boardSeqRef.current.tutor : boardSeqRef.current.student,\n    })\n    if (role === 'student') {\n      socket.emit('lcwb_replay_request', {\n        roomId,\n        userId,\n        scope: 'tutor',\n        sinceSeq: boardSeqRef.current.tutor,\n      })\n    }\n  }, [sessionId, roomId, socket, isConnected, role, session])\n  \n  // Set up socket listeners\n  useEffect(() => {\n    if (!socket) return\n    \n    // Tutor broadcasting started\n    socket.on('lcwb_tutor_broadcasting', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor stopped broadcasting\n    socket.on('lcwb_tutor_broadcast_stopped', () => {\n      setTutorStrokes([])\n    })\n    \n    // Receive tutor's stroke (for students)\n    socket.on('lcwb_tutor_stroke', (stroke: WhiteboardStroke) => {\n      setTutorStrokes(prev => [...prev, stroke])\n    })\n    socket.on('lcwb_tutor_strokes_reset', (data: { strokes: WhiteboardStroke[] }) => {\n      setTutorStrokes(data.strokes || [])\n    })\n    socket.on('lcwb_tutor_stroke_ops', (data: { ops: WhiteboardStrokeOp[] }) => {\n      const maxSeq = Math.max(0, ...((data.ops || []).map((op) => op._seq || 0)))\n      if (maxSeq > 0) boardSeqRef.current.tutor = Math.max(boardSeqRef.current.tutor, maxSeq)\n      setTutorStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n    })\n\n    socket.on('lcwb_student_whiteboard_state', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        } else {\n          next.set(data.studentId, {\n            studentId: data.studentId,\n            studentName: 'Student',\n            whiteboardId: '',\n            visibility: 'tutor-only',\n            strokes: data.strokes,\n            lastActivity: new Date(),\n          })\n        }\n        return next\n      })\n    })\n    \n    // Student created a whiteboard (tutor receives)\n    socket.on('lcwb_student_whiteboard_created', (data: { studentId: string; name: string }) => {\n      setActiveStudentBoards(prev => [...new Set([...prev, data.studentId])])\n      setStudentWhiteboards(prev => new Map(prev.set(data.studentId, {\n        studentId: data.studentId,\n        studentName: data.name,\n        whiteboardId: '',\n        visibility: 'private',\n        strokes: [],\n        lastActivity: new Date()\n      })))\n    })\n    \n    // Receive student's stroke (tutor receives)\n    socket.on('lcwb_student_stroke', (data: { studentId: string; stroke: WhiteboardStroke }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.strokes.push(data.stroke)\n          wb.lastActivity = new Date()\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    socket.on('lcwb_student_strokes_reset', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes || []\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    socket.on('lcwb_student_stroke_ops', (data: { studentId: string; ops: WhiteboardStrokeOp[] }) => {\n      const maxSeq = Math.max(0, ...((data.ops || []).map((op) => op._seq || 0)))\n      if (maxSeq > 0 && session?.user?.id === data.studentId) {\n        boardSeqRef.current.student = Math.max(boardSeqRef.current.student, maxSeq)\n      }\n      setStudentWhiteboards((prev) => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = applyStrokeOps(wb.strokes, data.ops || [])\n          wb.lastActivity = new Date()\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    \n    // Student visibility changed\n    socket.on('lcwb_student_visibility_changed', (data: { studentId: string; visibility: 'private' | 'tutor-only' | 'public' }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.visibility = data.visibility\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    \n    // Student made board public (other students receive)\n    socket.on('lcwb_student_public', (data: { studentId: string; name: string }) => {\n      setActiveStudentBoards(prev => [...new Set([...prev, data.studentId])])\n    })\n    \n    // Receive public student stroke (students receive from other students)\n    socket.on('lcwb_public_student_stroke', (data: { studentId: string; stroke: WhiteboardStroke }) => {\n      setStudentWhiteboards(prev => {\n        const wb = prev.get(data.studentId)\n        if (wb) {\n          wb.strokes.push(data.stroke)\n          return new Map(prev)\n        }\n        return prev\n      })\n    })\n    socket.on('lcwb_public_student_strokes_reset', (data: { studentId: string; strokes: WhiteboardStroke[] }) => {\n      setStudentWhiteboards(prev => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = data.strokes || []\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n    socket.on('lcwb_public_student_stroke_ops', (data: { studentId: string; ops: WhiteboardStrokeOp[] }) => {\n      setStudentWhiteboards((prev) => {\n        const next = new Map(prev)\n        const wb = next.get(data.studentId)\n        if (wb) {\n          wb.strokes = applyStrokeOps(wb.strokes, data.ops || [])\n          next.set(data.studentId, wb)\n        }\n        return next\n      })\n    })\n\n    socket.on('lcwb_replay_ops', (data: {\n      scope: 'student' | 'tutor'\n      userId?: string\n      latestSeq?: number\n      ops: WhiteboardStrokeOp[]\n    }) => {\n      if (data.scope === 'tutor') {\n        boardSeqRef.current.tutor = Math.max(boardSeqRef.current.tutor, data.latestSeq || 0)\n        setTutorStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n        return\n      }\n      const myId = session?.user?.id\n      if (!myId || (data.userId && data.userId !== myId)) return\n      boardSeqRef.current.student = Math.max(boardSeqRef.current.student, data.latestSeq || 0)\n      setMyStrokes((prev) => applyStrokeOps(prev, data.ops || []))\n    })\n\n    socket.on('lcwb_selection_presence_update', (data: WhiteboardSelectionPresence) => {\n      if (!data?.userId || data.userId === session?.user?.id) return\n      setRemoteSelections((prev) => {\n        const next = new Map(prev)\n        next.set(data.userId, data)\n        return next\n      })\n    })\n\n    socket.on('lcwb_selection_presence_remove', (data: { userId: string }) => {\n      if (!data?.userId) return\n      setRemoteSelections((prev) => {\n        if (!prev.has(data.userId)) return prev\n        const next = new Map(prev)\n        next.delete(data.userId)\n        return next\n      })\n    })\n\n    socket.on('lcwb_branch_list', (data: { branches: string[] }) => {\n      setAvailableBranches(data.branches || [])\n    })\n    \n    // Tutor is viewing this student's board\n    socket.on('lcwb_tutor_viewing', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor stopped viewing\n    socket.on('lcwb_tutor_stopped_viewing', () => {\n      // reserved for UI indicators\n    })\n    \n    // Tutor annotated on student's board\n    socket.on('lcwb_tutor_annotation', (data: { stroke: WhiteboardStroke; tutorId: string }) => {\n      setMyStrokes(prev => [...prev, data.stroke])\n    })\n    \n    // Sync response\n    socket.on('lcwb_sync_response', (data: { strokes: WhiteboardStroke[] }) => {\n      setMyStrokes(data.strokes)\n    })\n\n    socket.on('lcwb_cursor_update', (data: WhiteboardCursor) => {\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        next.set(data.userId, data)\n        return next\n      })\n    })\n\n    socket.on('lcwb_cursor_remove', (data: { userId: string }) => {\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        next.delete(data.userId)\n        return next\n      })\n    })\n\n    socket.on('lcwb_layer_locked', (data: { locked: boolean }) => {\n      setIsLayerLocked(data.locked)\n    })\n\n    socket.on('lcwb_layer_config', (data: { visibility: Record<string, boolean>; lockedLayers: string[] }) => {\n      setLayerConfig((prev) => prev.map((layer) => ({\n        ...layer,\n        visible: data.visibility[layer.id] ?? layer.visible,\n        locked: data.lockedLayers.includes(layer.id),\n      })))\n    })\n\n    socket.on('lcwb_student_submitted', (data: {\n      studentId: string\n      studentName: string\n      submittedAt: number\n      strokeCount: number\n    }) => {\n      if (role === 'tutor') {\n        toast.success(`${data.studentName} submitted their board`)\n      }\n      setSubmissions((prev) => {\n        const next = new Map(prev)\n        next.set(data.studentId, {\n          studentId: data.studentId,\n          studentName: data.studentName,\n          submittedAt: data.submittedAt,\n          strokeCount: data.strokeCount,\n          reviewed: false,\n        })\n        return next\n      })\n    })\n\n    socket.on('lcwb_submission_reviewed', (data: { studentId: string }) => {\n      if (role === 'student' && session?.user?.id === data.studentId) {\n        setHasSubmitted(false)\n        toast.success('Your board was reviewed by the tutor')\n      }\n      if (role === 'tutor') {\n        setSubmissions((prev) => {\n          const next = new Map(prev)\n          const existing = next.get(data.studentId)\n          if (existing) {\n            next.set(data.studentId, { ...existing, reviewed: true })\n          }\n          return next\n        })\n      }\n    })\n\n    socket.on('lcwb_moderation_state', (data: {\n      mutedStudentIds: string[]\n      studentStrokeWindowLimit: number\n      strokeWindowMs: number\n      lockedLayers: string[]\n    }) => {\n      setModerationState(data)\n    })\n\n    socket.on('lcwb_moderation_warning', (data: { code: string; message: string }) => {\n      toast.warning(data.message || 'Board action blocked by moderation settings')\n    })\n\n    socket.on('lcwb_assignment_overlay', (data: { overlay: 'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure' }) => {\n      setAssignmentOverlay(data.overlay)\n    })\n\n    socket.on('lcwb_spotlight_update', (data: WhiteboardSpotlight) => {\n      setSpotlight(data)\n    })\n\n    socket.on('lcwb_ai_region_hint', (data: {\n      requestedBy: string\n      region: { x: number; y: number; width: number; height: number }\n      hint: string\n      misconception: string\n      timestamp: number\n    }) => {\n      setAiRegionHints((prev) => [data, ...prev].slice(0, 20))\n    })\n\n    socket.on('lcwb_snapshot_created', (snapshot: WhiteboardSnapshot) => {\n      setSnapshots((prev) => [snapshot, ...prev].slice(0, 80))\n    })\n\n    socket.on('lcwb_snapshot_timeline', (data: { snapshots: WhiteboardSnapshot[] }) => {\n      setSnapshots(data.snapshots)\n    })\n\n    socket.on('lcwb_breakout_promoted', (data: { strokes: WhiteboardStroke[] }) => {\n      if (role === 'tutor') {\n        setTutorStrokes((prev) => [...prev, ...data.strokes])\n      }\n    })\n\n    // AI region hint error\n    socket.on('lcwb_ai_region_error', (data: { message?: string }) => {\n      toast.error(data.message || 'Failed to get AI hint')\n    })\n\n    // Export attached by tutor\n    socket.on('lcwb_export_attached', (data: { exportId: string; name: string; url: string; attachedBy: string }) => {\n      toast.success(`Export \"${data.name}\" attached by tutor`)\n    })\n\n    // Student cleared their own board\n    socket.on('lcwb_student_cleared_own', (data: { studentId: string }) => {\n      if (role === 'tutor') {\n        setStudentWhiteboards(prev => {\n          const next = new Map(prev)\n          const wb = next.get(data.studentId)\n          if (wb) {\n            wb.strokes = []\n            next.set(data.studentId, wb)\n          }\n          return next\n        })\n      }\n      if (role === 'student' && session?.user?.id === data.studentId) {\n        setMyStrokes([])\n        toast.info('Your board was cleared')\n      }\n    })\n    \n    // Cleanup\n    return () => {\n      socket.off('lcwb_tutor_broadcasting')\n      socket.off('lcwb_tutor_broadcast_stopped')\n      socket.off('lcwb_tutor_stroke')\n      socket.off('lcwb_tutor_strokes_reset')\n      socket.off('lcwb_tutor_stroke_ops')\n      socket.off('lcwb_student_whiteboard_created')\n      socket.off('lcwb_student_stroke')\n      socket.off('lcwb_student_strokes_reset')\n      socket.off('lcwb_student_stroke_ops')\n      socket.off('lcwb_student_visibility_changed')\n      socket.off('lcwb_student_public')\n      socket.off('lcwb_public_student_stroke')\n      socket.off('lcwb_public_student_strokes_reset')\n      socket.off('lcwb_public_student_stroke_ops')\n      socket.off('lcwb_replay_ops')\n      socket.off('lcwb_selection_presence_update')\n      socket.off('lcwb_selection_presence_remove')\n      socket.off('lcwb_branch_list')\n      socket.off('lcwb_tutor_viewing')\n      socket.off('lcwb_tutor_stopped_viewing')\n      socket.off('lcwb_tutor_annotation')\n      socket.off('lcwb_sync_response')\n      socket.off('lcwb_student_whiteboard_state')\n      socket.off('lcwb_cursor_update')\n      socket.off('lcwb_cursor_remove')\n      socket.off('lcwb_layer_locked')\n      socket.off('lcwb_layer_config')\n      socket.off('lcwb_student_submitted')\n      socket.off('lcwb_submission_reviewed')\n      socket.off('lcwb_moderation_state')\n      socket.off('lcwb_moderation_warning')\n      socket.off('lcwb_assignment_overlay')\n      socket.off('lcwb_spotlight_update')\n      socket.off('lcwb_ai_region_hint')\n      socket.off('lcwb_snapshot_created')\n      socket.off('lcwb_snapshot_timeline')\n      socket.off('lcwb_breakout_promoted')\n      socket.off('lcwb_ai_region_error')\n      socket.off('lcwb_export_attached')\n      socket.off('lcwb_student_cleared_own')\n    }\n  }, [applyStrokeOps, role, session?.user?.id, socket])\n\n  // Remove stale cursors (network drops / tab backgrounding).\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const cutoff = Date.now() - 5000\n      setRemoteCursors((prev) => {\n        const next = new Map(prev)\n        let changed = false\n        next.forEach((cursor, userId) => {\n          if (cursor.lastUpdated < cutoff) {\n            next.delete(userId)\n            changed = true\n          }\n        })\n        return changed ? next : prev\n      })\n    }, 2000)\n\n    return () => clearInterval(interval)\n  }, [])\n  \n  /** Tutor: Start broadcasting — your strokes are sent to all students in the room in real time. */\n  const startBroadcast = useCallback(() => {\n    if (role !== 'tutor') return\n    if (!socket || !isConnected) {\n      toast.warning('Connect to the class first')\n      return\n    }\n    if (!sessionId || !roomId) {\n      toast.warning('Session or room not ready')\n      return\n    }\n    socket.emit('lcwb_broadcast_start', {\n      roomId,\n      whiteboardId: session?.user?.id\n    })\n    setIsBroadcasting(true)\n  }, [socket, isConnected, role, roomId, sessionId, session])\n  \n  /** Tutor: Stop broadcasting — students no longer receive your strokes. */\n  const stopBroadcast = useCallback(() => {\n    if (!socket || role !== 'tutor') return\n    socket.emit('lcwb_broadcast_stop', { roomId })\n    setIsBroadcasting(false)\n  }, [socket, role, roomId])\n  \n  // Tutor: Broadcast a stroke\n  const broadcastStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    \n    socket.emit('lcwb_stroke_broadcast', { roomId, stroke })\n  }, [socket, role, roomId])\n  \n  // Student: Add a stroke to their whiteboard\n  const addStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || !session?.user?.id) return\n    if (role === 'student' && isLayerLocked) return\n    if (role === 'student' && moderationState.lockedLayers.includes(activeLayerId)) {\n      toast.warning('This layer is locked by the tutor')\n      return\n    }\n    \n    // Update local state\n    setMyStrokes(prev => [...prev, stroke])\n    \n    // Send to server\n    socket.emit('lcwb_student_update', {\n      roomId,\n      userId: session.user.id,\n      stroke: { ...stroke, layerId: stroke.layerId || activeLayerId },\n      visibility\n    })\n    if (role === 'student' && hasSubmitted) {\n      setHasSubmitted(false)\n    }\n  }, [socket, session, role, isLayerLocked, roomId, visibility, hasSubmitted, activeLayerId, moderationState.lockedLayers])\n\n  const addTutorStroke = useCallback((stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    const normalizedStroke = { ...stroke, layerId: stroke.layerId || activeLayerId }\n    setMyStrokes(prev => [...prev, normalizedStroke])\n    if (isBroadcasting || normalizedStroke.layerId === 'tutor-broadcast') {\n      socket.emit('lcwb_stroke_broadcast', { roomId, stroke: normalizedStroke })\n    }\n  }, [socket, role, activeLayerId, isBroadcasting, roomId])\n  \n  // Student: Change visibility\n  const changeVisibility = useCallback((newVisibility: 'private' | 'tutor-only' | 'public') => {\n    if (!socket || role !== 'student' || !session?.user?.id) return\n    \n    setVisibility(newVisibility)\n    socket.emit('lcwb_visibility_change', {\n      roomId,\n      userId: session.user.id,\n      visibility: newVisibility\n    })\n  }, [socket, role, roomId, session])\n  \n  // Tutor: View a specific student's whiteboard\n  const viewStudentWhiteboard = useCallback((studentId: string) => {\n    if (!socket || role !== 'tutor') return\n    \n    // Stop viewing previous student\n    if (viewingStudentId) {\n      socket.emit('lcwb_tutor_stop_view', { roomId, studentId: viewingStudentId })\n    }\n    \n    socket.emit('lcwb_tutor_view_student', { roomId, studentId })\n    setViewingStudentId(studentId)\n  }, [socket, role, roomId, viewingStudentId])\n  \n  // Tutor: Stop viewing student\n  const stopViewingStudent = useCallback(() => {\n    if (!socket || role !== 'tutor' || !viewingStudentId) return\n    \n    socket.emit('lcwb_tutor_stop_view', { roomId, studentId: viewingStudentId })\n    setViewingStudentId(null)\n  }, [socket, role, roomId, viewingStudentId])\n  \n  // Tutor: Annotate on student's whiteboard\n  const annotateOnStudentBoard = useCallback((studentId: string, stroke: WhiteboardStroke) => {\n    if (!socket || role !== 'tutor') return\n    \n    socket.emit('lcwb_tutor_annotate', { roomId, studentId, stroke })\n  }, [socket, role, roomId])\n  \n  // Clear my whiteboard\n  const clearMyWhiteboard = useCallback((pageId?: string) => {\n    if (!pageId) {\n      setMyStrokes([])\n      return\n    }\n    setMyStrokes((prev) => prev.filter((stroke) => stroke.pageId !== pageId))\n  }, [])\n  \n  // Undo last stroke\n  const undoLastStroke = useCallback((pageId?: string) => {\n    setMyStrokes((prev) => {\n      if (!pageId) return prev.slice(0, -1)\n      const lastIndex = [...prev].reverse().findIndex((stroke) => stroke.pageId === pageId)\n      if (lastIndex < 0) return prev\n      const indexToRemove = prev.length - 1 - lastIndex\n      return prev.filter((_, index) => index !== indexToRemove)\n    })\n  }, [])\n\n  const updateCursor = useCallback((x: number, y: number, pointerMode: 'cursor' | 'laser' = 'cursor') => {\n    if (!socket || !session?.user?.id || !roomId) return\n    socket.emit('lcwb_cursor_update', {\n      roomId,\n      userId: session.user.id,\n      name: session.user.name || role,\n      role,\n      x,\n      y,\n      pointerMode,\n      lastUpdated: Date.now(),\n    })\n  }, [socket, session, roomId, role])\n\n  const updateSelectionPresence = useCallback((strokeIds: string[], pageId?: string, color: string = '#2563eb') => {\n    if (!socket || !roomId || !session?.user?.id) return\n    socket.emit('lcwb_selection_presence_update', {\n      roomId,\n      userId: session.user.id,\n      name: session.user.name || role,\n      role,\n      strokeIds,\n      pageId,\n      color,\n      updatedAt: Date.now(),\n    })\n  }, [roomId, role, session, socket])\n\n  const createBoardBranch = useCallback((branchName: string) => {\n    if (!socket || !roomId || !session?.user?.id || !branchName.trim()) return\n    socket.emit('lcwb_branch_create', {\n      roomId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      userId: session.user.id,\n      branchName: branchName.trim(),\n    })\n  }, [roomId, role, session, socket])\n\n  const switchBoardBranch = useCallback((branchName: string) => {\n    if (!socket || !roomId || !session?.user?.id || !branchName.trim()) return\n    socket.emit('lcwb_branch_switch', {\n      roomId,\n      scope: role === 'tutor' ? 'tutor' : 'student',\n      userId: session.user.id,\n      branchName: branchName.trim(),\n    })\n  }, [roomId, role, session, socket])\n\n  /** Tutor: Lock/unlock student layers — when locked, students cannot draw on their boards until you unlock. */\n  const toggleLayerLock = useCallback((locked: boolean) => {\n    if (role !== 'tutor') return\n    if (!socket || !isConnected) {\n      toast.warning('Connect to the class first')\n      return\n    }\n    if (!roomId) {\n      toast.warning('Room not ready')\n      return\n    }\n    setIsLayerLocked(locked)\n    socket.emit('lcwb_layer_lock', {\n      roomId,\n      locked,\n    })\n  }, [socket, isConnected, role, roomId])\n\n  const updateLayerConfig = useCallback((nextConfig: LayerConfig[]) => {\n    setLayerConfig(nextConfig)\n    if (!socket || !roomId || role !== 'tutor') return\n    const visibility = nextConfig.reduce<Record<string, boolean>>((acc, layer) => {\n      acc[layer.id] = layer.visible\n      return acc\n    }, {})\n    socket.emit('lcwb_layer_config_update', {\n      roomId,\n      visibility,\n      lockedLayers: nextConfig.filter((layer) => layer.locked).map((layer) => layer.id),\n    })\n  }, [socket, roomId, role])\n\n  const setLayerLock = useCallback((layerId: LayerConfig['id'], locked: boolean) => {\n    setLayerConfig((prev) => {\n      const next = prev.map((layer) => layer.id === layerId ? { ...layer, locked } : layer)\n      if (socket && roomId && role === 'tutor') {\n        const visibility = next.reduce<Record<string, boolean>>((acc, layer) => {\n          acc[layer.id] = layer.visible\n          return acc\n        }, {})\n        socket.emit('lcwb_layer_config_update', {\n          roomId,\n          visibility,\n          lockedLayers: next.filter((layer) => layer.locked).map((layer) => layer.id),\n        })\n      }\n      return next\n    })\n  }, [socket, roomId, role])\n\n  const submitMyBoard = useCallback(() => {\n    if (!socket || role !== 'student' || !session?.user?.id || !roomId) return\n    socket.emit('lcwb_student_submit', {\n      roomId,\n      studentId: session.user.id,\n      studentName: session.user.name || 'Student',\n      strokeCount: strokesRef.current.length,\n      submittedAt: Date.now(),\n    })\n    setHasSubmitted(true)\n    toast.success('Board submitted to tutor')\n  }, [socket, role, session, roomId])\n\n  const markSubmissionReviewed = useCallback((studentId: string) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_tutor_mark_reviewed', {\n      roomId,\n      studentId,\n    })\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      const existing = next.get(studentId)\n      if (existing) next.set(studentId, { ...existing, reviewed: true })\n      return next\n    })\n  }, [socket, role, roomId])\n\n  const pinSubmission = useCallback((studentId: string, pinned: boolean) => {\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      const existing = next.get(studentId)\n      if (existing) next.set(studentId, { ...existing, pinned })\n      return next\n    })\n  }, [])\n\n  const markAllSubmissionsReviewed = useCallback(() => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    const pending = Array.from(submissions.values()).filter((submission) => !submission.reviewed)\n    pending.forEach((submission) => {\n      socket.emit('lcwb_tutor_mark_reviewed', {\n        roomId,\n        studentId: submission.studentId,\n      })\n    })\n    setSubmissions((prev) => {\n      const next = new Map(prev)\n      next.forEach((submission, studentId) => {\n        next.set(studentId, { ...submission, reviewed: true })\n      })\n      return next\n    })\n  }, [socket, role, roomId, submissions])\n\n  const setDrawMuteForStudent = useCallback((studentId: string, muted: boolean) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    const nextMuted = new Set(moderationState.mutedStudentIds)\n    if (muted) nextMuted.add(studentId)\n    if (!muted) nextMuted.delete(studentId)\n    socket.emit('lcwb_tutor_moderation_update', {\n      roomId,\n      mutedStudentIds: Array.from(nextMuted),\n      studentStrokeWindowLimit: moderationState.studentStrokeWindowLimit,\n      strokeWindowMs: moderationState.strokeWindowMs,\n      lockedLayers: moderationState.lockedLayers,\n    })\n  }, [socket, role, roomId, moderationState])\n\n  const updateStrokeRateLimit = useCallback((limit: number, windowMs: number = moderationState.strokeWindowMs) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_tutor_moderation_update', {\n      roomId,\n      mutedStudentIds: moderationState.mutedStudentIds,\n      studentStrokeWindowLimit: limit,\n      strokeWindowMs: windowMs,\n      lockedLayers: moderationState.lockedLayers,\n    })\n  }, [socket, role, roomId, moderationState])\n\n  const clearOwnStrokes = useCallback(() => {\n    if (!socket || !roomId || !session?.user?.id) return\n    setMyStrokes((prev) => prev.filter((stroke) => stroke.userId !== session.user.id))\n    socket.emit('lcwb_clear_own', { roomId, userId: session.user.id })\n  }, [socket, roomId, session])\n\n  const replaceMyStrokes = useCallback((nextOrUpdater: WhiteboardStroke[] | ((prev: WhiteboardStroke[]) => WhiteboardStroke[])) => {\n    setMyStrokes((prev) => {\n      const next = typeof nextOrUpdater === 'function'\n        ? (nextOrUpdater as (prev: WhiteboardStroke[]) => WhiteboardStroke[])(prev)\n        : nextOrUpdater\n\n      if (socket && roomId && session?.user?.id) {\n        const prevMap = new Map(prev.map((stroke) => [stroke.id, stroke]))\n        const nextMap = new Map(next.map((stroke) => [stroke.id, stroke]))\n        const ops: WhiteboardStrokeOp[] = []\n        nextMap.forEach((stroke, id) => {\n          const existing = prevMap.get(id)\n          if (!existing || JSON.stringify(existing) !== JSON.stringify(stroke)) {\n            localOpSeqRef.current += 1\n            ops.push({\n              kind: 'upsert',\n              stroke,\n              opId: `${session.user.id}:${Date.now()}:${localOpSeqRef.current}:${id}:u`,\n              sentAt: Date.now(),\n              baseVersion: existing?.updatedAt || existing?.createdAt || 0,\n            })\n          }\n        })\n        prevMap.forEach((_, id) => {\n          if (!nextMap.has(id)) {\n            localOpSeqRef.current += 1\n            ops.push({\n              kind: 'delete',\n              strokeId: id,\n              opId: `${session.user.id}:${Date.now()}:${localOpSeqRef.current}:${id}:d`,\n              sentAt: Date.now(),\n            })\n          }\n        })\n\n        if (!ops.length) return prev\n\n        enqueueStrokeOps(ops)\n      }\n      return next\n    })\n  }, [enqueueStrokeOps, roomId, session, socket])\n\n  const setAssignmentOverlayMode = useCallback((overlay: 'none' | 'graph-paper' | 'geometry-grid' | 'coordinate-plane' | 'chemistry-structure') => {\n    setAssignmentOverlay(overlay)\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_assignment_overlay', { roomId, overlay })\n  }, [socket, role, roomId])\n\n  const updateSpotlight = useCallback((nextSpotlight: WhiteboardSpotlight) => {\n    setSpotlight(nextSpotlight)\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_spotlight_update', { roomId, ...nextSpotlight })\n  }, [socket, role, roomId])\n\n  const requestAIRegionHint = useCallback((region: { x: number; y: number; width: number; height: number }, context?: string) => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_ai_region_request', { roomId, region, context })\n  }, [socket, roomId])\n\n  const captureSnapshot = useCallback((strokes: WhiteboardStroke[]) => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_snapshot_capture', { roomId, strokes })\n  }, [socket, roomId])\n\n  const requestSnapshotTimeline = useCallback(() => {\n    if (!socket || !roomId) return\n    socket.emit('lcwb_snapshot_request', { roomId })\n  }, [socket, roomId])\n\n  const promoteBreakoutBoard = useCallback((breakoutRoomId: string, strokes: WhiteboardStroke[], sourceStudentId?: string) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_breakout_promote', {\n      mainRoomId: roomId,\n      breakoutRoomId,\n      sourceStudentId,\n      strokes,\n    })\n  }, [socket, role, roomId])\n\n  const exportAndAttachBoard = useCallback((data: {\n    format: 'png' | 'pdf'\n    fileName: string\n    dataUrl: string\n    studentId?: string\n  }) => {\n    if (!socket || role !== 'tutor' || !roomId) return\n    socket.emit('lcwb_export_attach', {\n      roomId,\n      sessionId,\n      studentId: data.studentId,\n      format: data.format,\n      fileName: data.fileName,\n      dataUrl: data.dataUrl,\n    })\n  }, [socket, role, roomId, sessionId])\n\n  useEffect(() => {\n    if (!roomId || !socket) return\n    const interval = setInterval(() => {\n      const sourceStrokes = role === 'tutor' ? myStrokes : myStrokes\n      if (sourceStrokes.length > 0) {\n        socket.emit('lcwb_snapshot_capture', { roomId, strokes: sourceStrokes })\n      }\n    }, 2 * 60 * 1000)\n    return () => clearInterval(interval)\n  }, [roomId, socket, role, myStrokes])\n  \n  return {\n    // State\n    myStrokes,\n    tutorStrokes,\n    studentWhiteboards,\n    visibility,\n    isBroadcasting,\n    viewingStudentId,\n    activeStudentBoards,\n    isConnected,\n    remoteCursors,\n    remoteSelections: Array.from(remoteSelections.values()),\n    isLayerLocked,\n    submissions: Array.from(submissions.values()).sort((a, b) => b.submittedAt - a.submittedAt),\n    hasSubmitted,\n    layerConfig,\n    activeLayerId,\n    assignmentOverlay,\n    spotlight,\n    snapshots: [...snapshots].sort((a, b) => b.createdAt - a.createdAt),\n    timelineIndex,\n    aiRegionHints,\n    moderationState,\n    availableBranches,\n    \n    // Actions\n    startBroadcast,\n    stopBroadcast,\n    broadcastStroke,\n    addStroke,\n    addTutorStroke,\n    changeVisibility,\n    viewStudentWhiteboard,\n    stopViewingStudent,\n    annotateOnStudentBoard,\n    clearMyWhiteboard,\n    undoLastStroke,\n    updateCursor,\n    updateSelectionPresence,\n    toggleLayerLock,\n    submitMyBoard,\n    markSubmissionReviewed,\n    markAllSubmissionsReviewed,\n    pinSubmission,\n    setLayerConfig: updateLayerConfig,\n    setActiveLayerId,\n    setLayerLock,\n    setDrawMuteForStudent,\n    updateStrokeRateLimit,\n    clearOwnStrokes,\n    replaceMyStrokes,\n    setAssignmentOverlayMode,\n    updateSpotlight,\n    requestAIRegionHint,\n    captureSnapshot,\n    requestSnapshotTimeline,\n    setTimelineIndex,\n    promoteBreakoutBoard,\n    exportAndAttachBoard,\n    createBoardBranch,\n    switchBoardBranch\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1686, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-pdf-collab-socket.ts"],"sourcesContent":["'use client'\n\nimport { useCallback, useEffect, useMemo, useState } from 'react'\nimport { useSimpleSocket } from './use-simple-socket'\nimport type { PdfCanvasEventPayload } from '@/lib/pdf-tutoring/types'\n\nexport interface PdfParticipant {\n  userId?: string\n  name: string\n  role: 'student' | 'tutor'\n  joinedAt: number\n}\n\ninterface UsePdfCollabSocketArgs {\n  roomId: string\n  userId?: string\n  name?: string\n  role?: 'student' | 'tutor'\n  onCanvasEvent?: (payload: PdfCanvasEventPayload) => void\n  onCanvasState?: (payload: { roomId: string; events: PdfCanvasEventPayload[] }) => void\n  onPresenceState?: (payload: { roomId: string; participants: PdfParticipant[] }) => void\n}\n\nexport function usePdfCollabSocket({ roomId, userId, name, role = 'tutor', onCanvasEvent, onCanvasState, onPresenceState }: UsePdfCollabSocketArgs) {\n  const { socket, isConnected } = useSimpleSocket(roomId, {\n    userId,\n    name,\n    role,\n  })\n  const [isLocked, setIsLocked] = useState(false)\n  const [latencyMs, setLatencyMs] = useState<number | null>(null)\n  const [participants, setParticipants] = useState<PdfParticipant[]>([])\n\n  useEffect(() => {\n    if (!socket || !roomId) return\n\n    socket.emit('pdf_join_room', {\n      roomId,\n      userId,\n      name,\n      role,\n    })\n\n    const handleCanvasEvent = (payload: PdfCanvasEventPayload) => {\n      if (typeof payload.sentAt === 'number') {\n        setLatencyMs(Math.max(0, Date.now() - payload.sentAt))\n      }\n      onCanvasEvent?.(payload)\n    }\n\n    const handleLockState = (data: { roomId: string; locked: boolean }) => {\n      if (data.roomId === roomId) setIsLocked(data.locked)\n    }\n\n    const handleCanvasState = (data: { roomId: string; events: PdfCanvasEventPayload[] }) => {\n      if (data.roomId !== roomId) return\n      onCanvasState?.(data)\n    }\n\n    const handlePresenceState = (data: { roomId: string; participants: PdfParticipant[] }) => {\n      if (data.roomId !== roomId) return\n      setParticipants(data.participants || [])\n      onPresenceState?.(data)\n    }\n\n    socket.on('pdf_canvas_event', handleCanvasEvent)\n    socket.on('pdf_lock_state', handleLockState)\n    socket.on('pdf_canvas_state', handleCanvasState)\n    socket.on('pdf_presence_state', handlePresenceState)\n\n    socket.emit('pdf_request_state', { roomId })\n\n    return () => {\n      socket.off('pdf_canvas_event', handleCanvasEvent)\n      socket.off('pdf_lock_state', handleLockState)\n      socket.off('pdf_canvas_state', handleCanvasState)\n      socket.off('pdf_presence_state', handlePresenceState)\n    }\n  }, [socket, roomId, userId, name, role, onCanvasEvent, onCanvasState, onPresenceState])\n\n  const emitCanvasEvent = useCallback(\n    (payload: Omit<PdfCanvasEventPayload, 'roomId' | 'sentAt' | 'actorId'>) => {\n      if (!socket || !roomId) return\n      socket.emit('pdf_canvas_event', {\n        roomId,\n        actorId: userId,\n        sentAt: Date.now(),\n        ...payload,\n      } satisfies PdfCanvasEventPayload)\n    },\n    [socket, roomId, userId]\n  )\n\n  const setLock = useCallback(\n    (locked: boolean) => {\n      if (!socket || !roomId) return\n      socket.emit('pdf_lock_toggle', { roomId, locked })\n    },\n    [socket, roomId]\n  )\n\n  return useMemo(\n    () => ({\n      socket,\n      isConnected,\n      isLocked,\n      latencyMs,\n      participants,\n      emitCanvasEvent,\n      setLock,\n    }),\n    [socket, isConnected, isLocked, latencyMs, participants, emitCanvasEvent, setLock]\n  )\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAuBO,SAAS,mBAAmB,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,OAAO,EAAE,aAAa,EAAE,aAAa,EAAE,eAAe,EAA0B;;IAChJ,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,+MAAe,EAAC,QAAQ;QACtD;QACA;QACA;IACF;IACA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2NAAQ,EAAC;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,2NAAQ,EAAgB;IAC1D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,2NAAQ,EAAmB,EAAE;IAErE,IAAA,4NAAS;wCAAC;YACR,IAAI,CAAC,UAAU,CAAC,QAAQ;YAExB,OAAO,IAAI,CAAC,iBAAiB;gBAC3B;gBACA;gBACA;gBACA;YACF;YAEA,MAAM;kEAAoB,CAAC;oBACzB,IAAI,OAAO,QAAQ,MAAM,KAAK,UAAU;wBACtC,aAAa,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,KAAK,QAAQ,MAAM;oBACtD;oBACA,gBAAgB;gBAClB;;YAEA,MAAM;gEAAkB,CAAC;oBACvB,IAAI,KAAK,MAAM,KAAK,QAAQ,YAAY,KAAK,MAAM;gBACrD;;YAEA,MAAM;kEAAoB,CAAC;oBACzB,IAAI,KAAK,MAAM,KAAK,QAAQ;oBAC5B,gBAAgB;gBAClB;;YAEA,MAAM;oEAAsB,CAAC;oBAC3B,IAAI,KAAK,MAAM,KAAK,QAAQ;oBAC5B,gBAAgB,KAAK,YAAY,IAAI,EAAE;oBACvC,kBAAkB;gBACpB;;YAEA,OAAO,EAAE,CAAC,oBAAoB;YAC9B,OAAO,EAAE,CAAC,kBAAkB;YAC5B,OAAO,EAAE,CAAC,oBAAoB;YAC9B,OAAO,EAAE,CAAC,sBAAsB;YAEhC,OAAO,IAAI,CAAC,qBAAqB;gBAAE;YAAO;YAE1C;gDAAO;oBACL,OAAO,GAAG,CAAC,oBAAoB;oBAC/B,OAAO,GAAG,CAAC,kBAAkB;oBAC7B,OAAO,GAAG,CAAC,oBAAoB;oBAC/B,OAAO,GAAG,CAAC,sBAAsB;gBACnC;;QACF;uCAAG;QAAC;QAAQ;QAAQ;QAAQ;QAAM;QAAM;QAAe;QAAe;KAAgB;IAEtF,MAAM,kBAAkB,IAAA,8NAAW;2DACjC,CAAC;YACC,IAAI,CAAC,UAAU,CAAC,QAAQ;YACxB,OAAO,IAAI,CAAC,oBAAoB;gBAC9B;gBACA,SAAS;gBACT,QAAQ,KAAK,GAAG;gBAChB,GAAG,OAAO;YACZ;QACF;0DACA;QAAC;QAAQ;QAAQ;KAAO;IAG1B,MAAM,UAAU,IAAA,8NAAW;mDACzB,CAAC;YACC,IAAI,CAAC,UAAU,CAAC,QAAQ;YACxB,OAAO,IAAI,CAAC,mBAAmB;gBAAE;gBAAQ;YAAO;QAClD;kDACA;QAAC;QAAQ;KAAO;IAGlB,OAAO,IAAA,0NAAO;sCACZ,IAAM,CAAC;gBACL;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACF,CAAC;qCACD;QAAC;QAAQ;QAAa;QAAU;QAAW;QAAc;QAAiB;KAAQ;AAEtF;GA1FgB;;QACkB,+MAAe"}},
    {"offset": {"line": 1826, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/hooks/use-socket.ts"],"sourcesContent":["/**\n * React Hook for Socket.io Client\n * Provides real-time communication for live class sessions\n */\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { io, Socket } from 'socket.io-client'\nimport { StudentState, ChatMessage, BreakoutRoom } from '@/lib/socket-server'\n\ninterface UseSocketOptions {\n  roomId: string\n  userId: string\n  name: string\n  role: 'student' | 'tutor'\n  tutorId?: string\n  onStudentJoined?: (student: StudentState) => void\n  onStudentLeft?: (userId: string) => void\n  onStudentStateUpdate?: (data: { userId: string; state: StudentState }) => void\n  onStudentDistress?: (data: { userId: string; name: string; message: string }) => void\n  onChatMessage?: (message: ChatMessage) => void\n  onTutorBroadcast?: (message: ChatMessage) => void\n  onAIHint?: (hint: { userId: string; text: string; type: string }) => void\n  onWhiteboardUpdate?: (data: { strokes: any[] }) => void\n  onCodeUpdate?: (data: { content: string; language: string; userId: string }) => void\n  onBreakoutInvite?: (data: { roomId: string; roomUrl: string; tutorName: string }) => void\n  onBreakoutRoomUpdate?: (rooms: BreakoutRoom[]) => void\n  onBreakoutMessage?: (message: { id: string; senderId: string; senderName: string; content: string; timestamp: number; isAi?: boolean }) => void\n  onNotification?: (notification: { type: string; message: string }) => void\n  onRoomState?: (state: {\n    students: StudentState[]\n    chatHistory: ChatMessage[]\n    whiteboardData?: any\n  }) => void\n}\n\nexport function useSocket(options?: UseSocketOptions) {\n  const socketRef = useRef<Socket | null>(null)\n  const [isConnected, setIsConnected] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    let socket: Socket\n    const connect = async () => {\n      const token = await import('@/lib/socket-auth').then((m) => m.getSocketToken())\n      if (!token) {\n        setError('Authentication required')\n        return\n      }\n      socket = io({\n        path: '/api/socket',\n        transports: ['websocket', 'polling'],\n        auth: { token },\n      })\n      socketRef.current = socket\n\n    socket.on('connect', () => {\n      console.log('Socket connected:', socket.id)\n      setIsConnected(true)\n      setError(null)\n\n      // Join class room only when identity context is provided.\n      if (options?.roomId && options.userId && options.name && options.role) {\n        socket.emit('join_class', {\n          roomId: options.roomId,\n          userId: options.userId,\n          name: options.name,\n          role: options.role,\n          tutorId: options.tutorId\n        })\n      }\n    })\n\n    socket.on('disconnect', () => {\n      console.log('Socket disconnected')\n      setIsConnected(false)\n    })\n\n    socket.on('connect_error', (err) => {\n      console.error('Socket connection error:', err)\n      setError(err.message)\n      setIsConnected(false)\n    })\n\n    // Room state (initial load)\n    socket.on('room_state', (state) => {\n      options?.onRoomState?.(state)\n    })\n\n    // Student events\n    socket.on('student_joined', (data) => {\n      options?.onStudentJoined?.(data.state)\n    })\n\n    socket.on('student_left', (data) => {\n      options?.onStudentLeft?.(data.userId)\n    })\n\n    socket.on('student_state_update', (data) => {\n      options?.onStudentStateUpdate?.(data)\n    })\n\n    socket.on('student_distress', (data) => {\n      options?.onStudentDistress?.(data)\n    })\n\n    // Chat events\n    socket.on('chat_message', (message) => {\n      options?.onChatMessage?.(message)\n    })\n\n    socket.on('tutor_broadcast', (message) => {\n      options?.onTutorBroadcast?.(message)\n    })\n\n    // AI hints\n    socket.on('ai_hint', (hint) => {\n      options?.onAIHint?.(hint)\n    })\n\n    // Whiteboard\n    socket.on('whiteboard_update', (data) => {\n      options?.onWhiteboardUpdate?.(data)\n    })\n\n    // Code editor\n    socket.on('code_update', (data) => {\n      options?.onCodeUpdate?.(data)\n    })\n\n    // Breakout\n    socket.on('breakout_invite', (data) => {\n      options?.onBreakoutInvite?.(data)\n    })\n\n    socket.on('breakout_room_update', (data) => {\n      options?.onBreakoutRoomUpdate?.(data.rooms)\n    })\n\n    socket.on('breakout_message', (data) => {\n      options?.onBreakoutMessage?.(data)\n    })\n\n    socket.on('notification', (data) => {\n      options?.onNotification?.(data)\n    })\n\n    }\n    connect()\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect()\n        socketRef.current = null\n      }\n    }\n  }, [options?.roomId, options?.userId, options?.name, options?.role, options?.tutorId])\n\n  // Send chat message\n  const sendChatMessage = useCallback((text: string) => {\n    socketRef.current?.emit('chat_message', { text })\n  }, [])\n\n  // Send whiteboard update\n  const sendWhiteboardUpdate = useCallback((strokes: any[]) => {\n    socketRef.current?.emit('whiteboard_update', { strokes })\n  }, [])\n\n  // Send code update\n  const sendCodeUpdate = useCallback((content: string, language: string) => {\n    socketRef.current?.emit('code_update', { content, language })\n  }, [])\n\n  // Send activity ping\n  const sendActivityPing = useCallback((data: {\n    activity: string\n    engagement?: number\n    understanding?: number\n  }) => {\n    socketRef.current?.emit('activity_ping', data)\n  }, [])\n\n  // Tutor broadcast\n  const sendBroadcast = useCallback((text: string, targetGroup: 'all' | 'struggling' | 'needs_help' = 'all') => {\n    socketRef.current?.emit('tutor_broadcast', { text, targetGroup })\n  }, [])\n\n  // Push hint to student\n  const pushHint = useCallback((targetUserId: string, hint: string, type: 'socratic' | 'direct' | 'encouragement') => {\n    socketRef.current?.emit('push_hint', { targetUserId, hint, type })\n  }, [])\n\n  // Invite to breakout\n  const inviteToBreakout = useCallback((targetUserId: string, roomId: string) => {\n    socketRef.current?.emit('breakout_invite', { targetUserId, roomId })\n  }, [])\n\n  // Broadcast to all breakout rooms\n  const sendBreakoutBroadcast = useCallback((message: string) => {\n    socketRef.current?.emit('breakout_broadcast', { message })\n  }, [])\n\n  // Close a breakout room\n  const closeBreakoutRoom = useCallback((breakoutRoomId: string) => {\n    socketRef.current?.emit('close_breakout', { breakoutRoomId })\n  }, [])\n\n  // Extend breakout room time\n  const extendBreakoutTime = useCallback((breakoutRoomId: string, minutes: number) => {\n    socketRef.current?.emit('extend_breakout_time', { breakoutRoomId, minutes })\n  }, [])\n\n  // Send message in breakout room\n  const sendBreakoutMessage = useCallback((breakoutRoomId: string, message: string) => {\n    socketRef.current?.emit('breakout_message', { breakoutRoomId, message })\n  }, [])\n\n  // Request help in breakout room\n  const requestHelp = useCallback((breakoutRoomId: string, reason: string) => {\n    socketRef.current?.emit('request_help', { breakoutRoomId, reason })\n  }, [])\n\n  return {\n    socket: socketRef.current,\n    isConnected,\n    error,\n    sendChatMessage,\n    sendWhiteboardUpdate,\n    sendCodeUpdate,\n    sendActivityPing,\n    sendBroadcast,\n    pushHint,\n    inviteToBreakout,\n    sendBreakoutBroadcast,\n    closeBreakoutRoom,\n    extendBreakoutTime,\n    sendBreakoutMessage,\n    requestHelp\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2120, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/extract-file-text.ts"],"sourcesContent":["// @ts-nocheck\n/**\n * Extract plain text from uploaded files: .txt, .md, .pdf, .docx, and images (OCR).\n * Used by the course/subject materials upload flow.\n */\n\nexport async function extractTextFromFile(file: File): Promise<string> {\n  const name = file.name.toLowerCase()\n  const type = file.type\n\n  // Plain text\n  if (\n    type === 'text/plain' ||\n    type.startsWith('text/') ||\n    name.endsWith('.txt') ||\n    name.endsWith('.md') ||\n    name.endsWith('.markdown')\n  ) {\n    return readAsText(file)\n  }\n\n  // PDF\n  if (type === 'application/pdf' || name.endsWith('.pdf')) {\n    return extractPdfText(file)\n  }\n\n  // Word .docx\n  if (\n    type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||\n    name.endsWith('.docx')\n  ) {\n    return extractDocxText(file)\n  }\n\n  // Legacy .doc - treat as binary; we could try mammoth with .doc but support is limited\n  if (name.endsWith('.doc')) {\n    try {\n      return extractDocxText(file)\n    } catch {\n      return readAsText(file).catch(() => '')\n    }\n  }\n\n  // Images: OCR\n  if (type.startsWith('image/')) {\n    return extractImageText(file)\n  }\n\n  // Fallback: try as text\n  return readAsText(file).catch(() => '')\n}\n\nfunction readAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(String(reader.result ?? ''))\n    reader.onerror = () => reject(reader.error)\n    reader.readAsText(file)\n  })\n}\n\nasync function extractPdfText(file: File): Promise<string> {\n  const pdfjs = await import('pdfjs-dist')\n  // Worker must be same-origin (CSP blocks external scripts). Served from public/ via copy-pdf-worker script.\n  if (typeof window !== 'undefined') {\n    const opts = (pdfjs as { GlobalWorkerOptions?: { workerSrc?: string } }).GlobalWorkerOptions\n    if (opts && !opts.workerSrc) {\n      opts.workerSrc = '/pdf.worker.min.mjs'\n    }\n  }\n  const data = await file.arrayBuffer()\n  const doc = await pdfjs.getDocument({ data }).promise\n  const numPages = doc.numPages\n  const parts: string[] = []\n  for (let i = 1; i <= numPages; i++) {\n    const page = await doc.getPage(i)\n    const content = await page.getTextContent()\n    const pageText = content.items.map((item: { str?: string }) => (item as { str?: string }).str ?? '').join(' ')\n    parts.push(pageText)\n  }\n  return parts.join('\\n\\n').trim() || ''\n}\n\nasync function extractDocxText(file: File): Promise<string> {\n  const mammoth = await import('mammoth')\n  const arrayBuffer = await file.arrayBuffer()\n  const result = await mammoth.extractRawText({ arrayBuffer })\n  return (result.value || '').trim()\n}\n\nasync function extractImageText(file: File): Promise<string> {\n  const mod = await import('tesseract.js')\n  const api = (mod as { default?: { recognize: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }; recognize?: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }).default ?? mod\n  const { data } = await api.recognize(file, 'eng', { logger: () => {} })\n  return (data?.text || '').trim()\n}\n"],"names":[],"mappings":"AAAA,cAAc;AACd;;;CAGC;;;;AAEM,eAAe,oBAAoB,IAAU;IAClD,MAAM,OAAO,KAAK,IAAI,CAAC,WAAW;IAClC,MAAM,OAAO,KAAK,IAAI;IAEtB,aAAa;IACb,IACE,SAAS,gBACT,KAAK,UAAU,CAAC,YAChB,KAAK,QAAQ,CAAC,WACd,KAAK,QAAQ,CAAC,UACd,KAAK,QAAQ,CAAC,cACd;QACA,OAAO,WAAW;IACpB;IAEA,MAAM;IACN,IAAI,SAAS,qBAAqB,KAAK,QAAQ,CAAC,SAAS;QACvD,OAAO,eAAe;IACxB;IAEA,aAAa;IACb,IACE,SAAS,6EACT,KAAK,QAAQ,CAAC,UACd;QACA,OAAO,gBAAgB;IACzB;IAEA,uFAAuF;IACvF,IAAI,KAAK,QAAQ,CAAC,SAAS;QACzB,IAAI;YACF,OAAO,gBAAgB;QACzB,EAAE,OAAM;YACN,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;QACtC;IACF;IAEA,cAAc;IACd,IAAI,KAAK,UAAU,CAAC,WAAW;QAC7B,OAAO,iBAAiB;IAC1B;IAEA,wBAAwB;IACxB,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;AACtC;AAEA,SAAS,WAAW,IAAU;IAC5B,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG,IAAM,OAAO,OAAO,KAAK;QAC1C,OAAO,UAAU,CAAC;IACpB;AACF;AAEA,eAAe,eAAe,IAAU;IACtC,MAAM,QAAQ;IACd,4GAA4G;IAC5G,wCAAmC;QACjC,MAAM,OAAO,AAAC,MAA2D,mBAAmB;QAC5F,IAAI,QAAQ,CAAC,KAAK,SAAS,EAAE;YAC3B,KAAK,SAAS,GAAG;QACnB;IACF;IACA,MAAM,OAAO,MAAM,KAAK,WAAW;IACnC,MAAM,MAAM,MAAM,MAAM,WAAW,CAAC;QAAE;IAAK,GAAG,OAAO;IACrD,MAAM,WAAW,IAAI,QAAQ;IAC7B,MAAM,QAAkB,EAAE;IAC1B,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;QAClC,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC;QAC/B,MAAM,UAAU,MAAM,KAAK,cAAc;QACzC,MAAM,WAAW,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC,OAA2B,AAAC,KAA0B,GAAG,IAAI,IAAI,IAAI,CAAC;QAC1G,MAAM,IAAI,CAAC;IACb;IACA,OAAO,MAAM,IAAI,CAAC,QAAQ,IAAI,MAAM;AACtC;AAEA,eAAe,gBAAgB,IAAU;IACvC,MAAM,UAAU;IAChB,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,MAAM,QAAQ,cAAc,CAAC;QAAE;IAAY;IAC1D,OAAO,CAAC,OAAO,KAAK,IAAI,EAAE,EAAE,IAAI;AAClC;AAEA,eAAe,iBAAiB,IAAU;IACxC,MAAM,MAAM;IACZ,MAAM,MAAM,AAAC,IAA0N,OAAO,IAAI;IAClP,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,SAAS,CAAC,MAAM,OAAO;QAAE,QAAQ,KAAO;IAAE;IACrE,OAAO,CAAC,MAAM,QAAQ,EAAE,EAAE,IAAI;AAChC"}},
    {"offset": {"line": 2212, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/pdf-tutoring/coordinates.ts"],"sourcesContent":["export interface PointPx {\n  x: number\n  y: number\n}\n\nexport interface PointPercent {\n  x: number\n  y: number\n}\n\nfunction clampPercent(value: number): number {\n  return Math.max(0, Math.min(100, value))\n}\n\nexport function pxToPercent(value: number, total: number): number {\n  if (!Number.isFinite(value) || !Number.isFinite(total) || total <= 0) return 0\n  return clampPercent((value / total) * 100)\n}\n\nexport function percentToPx(value: number, total: number): number {\n  if (!Number.isFinite(value) || !Number.isFinite(total) || total <= 0) return 0\n  return (value / 100) * total\n}\n\nexport function pointToPercent(point: PointPx, width: number, height: number): PointPercent {\n  return {\n    x: pxToPercent(point.x, width),\n    y: pxToPercent(point.y, height),\n  }\n}\n\nexport function pointToPx(point: PointPercent, width: number, height: number): PointPx {\n  return {\n    x: percentToPx(point.x, width),\n    y: percentToPx(point.y, height),\n  }\n}\n\nexport function rectToPercent<T extends { left?: number; top?: number; width?: number; height?: number }>(\n  rect: T,\n  width: number,\n  height: number\n): T {\n  return {\n    ...rect,\n    ...(typeof rect.left === 'number' ? { left: pxToPercent(rect.left, width) } : {}),\n    ...(typeof rect.top === 'number' ? { top: pxToPercent(rect.top, height) } : {}),\n    ...(typeof rect.width === 'number' ? { width: pxToPercent(rect.width, width) } : {}),\n    ...(typeof rect.height === 'number' ? { height: pxToPercent(rect.height, height) } : {}),\n  }\n}\n\nexport function rectToPx<T extends { left?: number; top?: number; width?: number; height?: number }>(\n  rect: T,\n  width: number,\n  height: number\n): T {\n  return {\n    ...rect,\n    ...(typeof rect.left === 'number' ? { left: percentToPx(rect.left, width) } : {}),\n    ...(typeof rect.top === 'number' ? { top: percentToPx(rect.top, height) } : {}),\n    ...(typeof rect.width === 'number' ? { width: percentToPx(rect.width, width) } : {}),\n    ...(typeof rect.height === 'number' ? { height: percentToPx(rect.height, height) } : {}),\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAUA,SAAS,aAAa,KAAa;IACjC,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK;AACnC;AAEO,SAAS,YAAY,KAAa,EAAE,KAAa;IACtD,IAAI,CAAC,OAAO,QAAQ,CAAC,UAAU,CAAC,OAAO,QAAQ,CAAC,UAAU,SAAS,GAAG,OAAO;IAC7E,OAAO,aAAa,AAAC,QAAQ,QAAS;AACxC;AAEO,SAAS,YAAY,KAAa,EAAE,KAAa;IACtD,IAAI,CAAC,OAAO,QAAQ,CAAC,UAAU,CAAC,OAAO,QAAQ,CAAC,UAAU,SAAS,GAAG,OAAO;IAC7E,OAAO,AAAC,QAAQ,MAAO;AACzB;AAEO,SAAS,eAAe,KAAc,EAAE,KAAa,EAAE,MAAc;IAC1E,OAAO;QACL,GAAG,YAAY,MAAM,CAAC,EAAE;QACxB,GAAG,YAAY,MAAM,CAAC,EAAE;IAC1B;AACF;AAEO,SAAS,UAAU,KAAmB,EAAE,KAAa,EAAE,MAAc;IAC1E,OAAO;QACL,GAAG,YAAY,MAAM,CAAC,EAAE;QACxB,GAAG,YAAY,MAAM,CAAC,EAAE;IAC1B;AACF;AAEO,SAAS,cACd,IAAO,EACP,KAAa,EACb,MAAc;IAEd,OAAO;QACL,GAAG,IAAI;QACP,GAAI,OAAO,KAAK,IAAI,KAAK,WAAW;YAAE,MAAM,YAAY,KAAK,IAAI,EAAE;QAAO,IAAI,CAAC,CAAC;QAChF,GAAI,OAAO,KAAK,GAAG,KAAK,WAAW;YAAE,KAAK,YAAY,KAAK,GAAG,EAAE;QAAQ,IAAI,CAAC,CAAC;QAC9E,GAAI,OAAO,KAAK,KAAK,KAAK,WAAW;YAAE,OAAO,YAAY,KAAK,KAAK,EAAE;QAAO,IAAI,CAAC,CAAC;QACnF,GAAI,OAAO,KAAK,MAAM,KAAK,WAAW;YAAE,QAAQ,YAAY,KAAK,MAAM,EAAE;QAAQ,IAAI,CAAC,CAAC;IACzF;AACF;AAEO,SAAS,SACd,IAAO,EACP,KAAa,EACb,MAAc;IAEd,OAAO;QACL,GAAG,IAAI;QACP,GAAI,OAAO,KAAK,IAAI,KAAK,WAAW;YAAE,MAAM,YAAY,KAAK,IAAI,EAAE;QAAO,IAAI,CAAC,CAAC;QAChF,GAAI,OAAO,KAAK,GAAG,KAAK,WAAW;YAAE,KAAK,YAAY,KAAK,GAAG,EAAE;QAAQ,IAAI,CAAC,CAAC;QAC9E,GAAI,OAAO,KAAK,KAAK,KAAK,WAAW;YAAE,OAAO,YAAY,KAAK,KAAK,EAAE;QAAO,IAAI,CAAC,CAAC;QACnF,GAAI,OAAO,KAAK,MAAM,KAAK,WAAW;YAAE,QAAQ,YAAY,KAAK,MAAM,EAAE;QAAQ,IAAI,CAAC,CAAC;IACzF;AACF"}}]
}