{
  "version": 3,
  "sources": [],
  "debugId": "8f6d3897-7be5-3c69-e5b1-69785d4c4a50",
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/extract-file-text.ts"],"sourcesContent":["// @ts-nocheck\n/**\n * Extract plain text from uploaded files: .txt, .md, .pdf, .docx, and images (OCR).\n * Used by the course/subject materials upload flow.\n */\n\nexport async function extractTextFromFile(file: File): Promise<string> {\n  const name = file.name.toLowerCase()\n  const type = file.type\n\n  // Plain text\n  if (\n    type === 'text/plain' ||\n    type.startsWith('text/') ||\n    name.endsWith('.txt') ||\n    name.endsWith('.md') ||\n    name.endsWith('.markdown')\n  ) {\n    return readAsText(file)\n  }\n\n  // PDF\n  if (type === 'application/pdf' || name.endsWith('.pdf')) {\n    return extractPdfText(file)\n  }\n\n  // Word .docx\n  if (\n    type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||\n    name.endsWith('.docx')\n  ) {\n    return extractDocxText(file)\n  }\n\n  // Legacy .doc - treat as binary; we could try mammoth with .doc but support is limited\n  if (name.endsWith('.doc')) {\n    try {\n      return extractDocxText(file)\n    } catch {\n      return readAsText(file).catch(() => '')\n    }\n  }\n\n  // Images: OCR\n  if (type.startsWith('image/')) {\n    return extractImageText(file)\n  }\n\n  // Fallback: try as text\n  return readAsText(file).catch(() => '')\n}\n\nfunction readAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = () => resolve(String(reader.result ?? ''))\n    reader.onerror = () => reject(reader.error)\n    reader.readAsText(file)\n  })\n}\n\nasync function extractPdfText(file: File): Promise<string> {\n  const pdfjs = await import('pdfjs-dist')\n  // Worker must be same-origin (CSP blocks external scripts). Served from public/ via copy-pdf-worker script.\n  if (typeof window !== 'undefined') {\n    const opts = (pdfjs as { GlobalWorkerOptions?: { workerSrc?: string } }).GlobalWorkerOptions\n    if (opts && !opts.workerSrc) {\n      opts.workerSrc = '/pdf.worker.min.mjs'\n    }\n  }\n  const data = await file.arrayBuffer()\n  const doc = await pdfjs.getDocument({ data }).promise\n  const numPages = doc.numPages\n  const parts: string[] = []\n  for (let i = 1; i <= numPages; i++) {\n    const page = await doc.getPage(i)\n    const content = await page.getTextContent()\n    const pageText = content.items.map((item: { str?: string }) => (item as { str?: string }).str ?? '').join(' ')\n    parts.push(pageText)\n  }\n  return parts.join('\\n\\n').trim() || ''\n}\n\nasync function extractDocxText(file: File): Promise<string> {\n  const mammoth = await import('mammoth')\n  const arrayBuffer = await file.arrayBuffer()\n  const result = await mammoth.extractRawText({ arrayBuffer })\n  return (result.value || '').trim()\n}\n\nasync function extractImageText(file: File): Promise<string> {\n  const mod = await import('tesseract.js')\n  const api = (mod as { default?: { recognize: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }; recognize?: (image: File, lang?: string, opts?: object) => Promise<{ data: { text?: string } }> }).default ?? mod\n  const { data } = await api.recognize(file, 'eng', { logger: () => {} })\n  return (data?.text || '').trim()\n}\n"],"names":[],"mappings":"AAAA,cAAc;AACd;;;CAGC;;;;AAEM,eAAe,oBAAoB,IAAU;IAClD,MAAM,OAAO,KAAK,IAAI,CAAC,WAAW;IAClC,MAAM,OAAO,KAAK,IAAI;IAEtB,aAAa;IACb,IACE,SAAS,gBACT,KAAK,UAAU,CAAC,YAChB,KAAK,QAAQ,CAAC,WACd,KAAK,QAAQ,CAAC,UACd,KAAK,QAAQ,CAAC,cACd;QACA,OAAO,WAAW;IACpB;IAEA,MAAM;IACN,IAAI,SAAS,qBAAqB,KAAK,QAAQ,CAAC,SAAS;QACvD,OAAO,eAAe;IACxB;IAEA,aAAa;IACb,IACE,SAAS,6EACT,KAAK,QAAQ,CAAC,UACd;QACA,OAAO,gBAAgB;IACzB;IAEA,uFAAuF;IACvF,IAAI,KAAK,QAAQ,CAAC,SAAS;QACzB,IAAI;YACF,OAAO,gBAAgB;QACzB,EAAE,OAAM;YACN,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;QACtC;IACF;IAEA,cAAc;IACd,IAAI,KAAK,UAAU,CAAC,WAAW;QAC7B,OAAO,iBAAiB;IAC1B;IAEA,wBAAwB;IACxB,OAAO,WAAW,MAAM,KAAK,CAAC,IAAM;AACtC;AAEA,SAAS,WAAW,IAAU;IAC5B,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG,IAAM,OAAO,OAAO,KAAK;QAC1C,OAAO,UAAU,CAAC;IACpB;AACF;AAEA,eAAe,eAAe,IAAU;IACtC,MAAM,QAAQ;IACd,4GAA4G;IAC5G;;IAMA,MAAM,OAAO,MAAM,KAAK,WAAW;IACnC,MAAM,MAAM,MAAM,MAAM,WAAW,CAAC;QAAE;IAAK,GAAG,OAAO;IACrD,MAAM,WAAW,IAAI,QAAQ;IAC7B,MAAM,QAAkB,EAAE;IAC1B,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;QAClC,MAAM,OAAO,MAAM,IAAI,OAAO,CAAC;QAC/B,MAAM,UAAU,MAAM,KAAK,cAAc;QACzC,MAAM,WAAW,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC,OAA2B,AAAC,KAA0B,GAAG,IAAI,IAAI,IAAI,CAAC;QAC1G,MAAM,IAAI,CAAC;IACb;IACA,OAAO,MAAM,IAAI,CAAC,QAAQ,IAAI,MAAM;AACtC;AAEA,eAAe,gBAAgB,IAAU;IACvC,MAAM,UAAU;IAChB,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,MAAM,QAAQ,cAAc,CAAC;QAAE;IAAY;IAC1D,OAAO,CAAC,OAAO,KAAK,IAAI,EAAE,EAAE,IAAI;AAClC;AAEA,eAAe,iBAAiB,IAAU;IACxC,MAAM,MAAM;IACZ,MAAM,MAAM,AAAC,IAA0N,OAAO,IAAI;IAClP,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,SAAS,CAAC,MAAM,OAAO;QAAE,QAAQ,KAAO;IAAE;IACrE,OAAO,CAAC,MAAM,QAAQ,EAAE,EAAE,IAAI;AAChC"}}]
}