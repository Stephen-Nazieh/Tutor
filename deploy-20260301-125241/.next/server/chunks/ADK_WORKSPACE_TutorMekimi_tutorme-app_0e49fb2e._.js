;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="29d1ab95-a5ec-4277-6a47-364ea78fec28")}catch(e){}}();
module.exports=[547344,e=>e.a(async(t,a)=>{try{var n=e.i(620971),r=e.i(738597);e.i(688768);var o=e.i(257357),i=e.i(909105),l=e.i(997103),s=e.i(569773),d=e.i(979651),u=t([r,s]);[r,s]=u.then?(await u)():u;let h={"America/New_York":{lat:40.7128,lon:-74.006},"America/Chicago":{lat:41.8781,lon:-87.6298},"America/Denver":{lat:39.7392,lon:-104.9903},"America/Los_Angeles":{lat:34.0522,lon:-118.2437},"America/Toronto":{lat:43.6532,lon:-79.3832},"America/Mexico_City":{lat:19.4326,lon:-99.1332},"America/Sao_Paulo":{lat:-23.5505,lon:-46.6333},"Europe/London":{lat:51.5072,lon:-.1276},"Europe/Paris":{lat:48.8566,lon:2.3522},"Europe/Berlin":{lat:52.52,lon:13.405},"Europe/Madrid":{lat:40.4168,lon:-3.7038},"Europe/Rome":{lat:41.9028,lon:12.4964},"Europe/Amsterdam":{lat:52.3676,lon:4.9041},"Europe/Istanbul":{lat:41.0082,lon:28.9784},"Europe/Moscow":{lat:55.7558,lon:37.6173},"Africa/Cairo":{lat:30.0444,lon:31.2357},"Africa/Lagos":{lat:6.5244,lon:3.3792},"Africa/Johannesburg":{lat:-26.2041,lon:28.0473},"Asia/Dubai":{lat:25.2048,lon:55.2708},"Asia/Karachi":{lat:24.8607,lon:67.0011},"Asia/Kolkata":{lat:22.5726,lon:88.3639},"Asia/Shanghai":{lat:31.2304,lon:121.4737},"Asia/Singapore":{lat:1.3521,lon:103.8198},"Asia/Hong_Kong":{lat:22.3193,lon:114.1694},"Asia/Seoul":{lat:37.5665,lon:126.978},"Asia/Tokyo":{lat:35.6762,lon:139.6503},"Australia/Sydney":{lat:-33.8688,lon:151.2093},"Australia/Perth":{lat:-31.9505,lon:115.8605},UTC:{lat:0,lon:0}};function c(e,t){let a=e||"UTC",n=h[a];if(n)return n;let r=a.split("/").at(1)?.replace(/_/g," ")||"Unknown",o=Object.entries(h).find(([e])=>e.includes(r.replace(/\s+/g,"_")));if(o)return o[1];let i=function(e){let t=0;for(let a=0;a<e.length;a+=1)t=(t<<5)-t+e.charCodeAt(a)|0;return Math.abs(t)}(`${a}:${t}`);return{lat:Math.max(-70,Math.min(70,i%12e3/100-60)),lon:i/1e3%36e3/100-180}}let g=["active","live","in_progress","inprogress","ongoing"];async function p(e){let{session:t,response:a}=await (0,s.requireAdmin)(e,d.Permissions.ANALYTICS_READ);if(!t)return a;try{let{searchParams:t}=new URL(e.url),a=Number.parseInt(t.get("days")||"7",10),s=new Date;s.setDate(s.getDate()-Math.max(1,Math.min(a,180)));let d=(await r.drizzleDb.selectDistinct({sessionId:o.sessionParticipant.sessionId}).from(o.sessionParticipant)).map(e=>e.sessionId);if(0===d.length)return n.NextResponse.json({topology:{nodes:[],edges:[],stats:{tutors:0,students:0,liveConnections:0,totalConnections:0}},meta:{days:a,generatedAt:new Date().toISOString()}});let u=await r.drizzleDb.select().from(o.liveSession).where((0,i.and)((0,i.inArray)(o.liveSession.id,d),(0,i.or)((0,i.gte)(o.liveSession.startedAt,s),(0,i.inArray)(o.liveSession.status,g)))).orderBy((0,l.desc)(o.liveSession.startedAt)).limit(600),p=[...new Set(u.map(e=>e.tutorId))],h=await r.drizzleDb.select().from(o.sessionParticipant).where((0,i.inArray)(o.sessionParticipant.sessionId,u.map(e=>e.id))),m=[...new Set(h.map(e=>e.studentId))],A=[...new Set([...p,...m])],f=await r.drizzleDb.select().from(o.user).where((0,i.inArray)(o.user.id,A)),v=await r.drizzleDb.select().from(o.profile).where((0,i.inArray)(o.profile.userId,A)),R=new Map(f.map(e=>[e.id,e])),w=new Map(v.map(e=>[e.userId,e])),y=new Map;for(let e of h){let t=y.get(e.sessionId)??[];t.push(e),y.set(e.sessionId,t)}let E=new Map,C=[];for(let e of u){let t=e.tutorId,a=R.get(t),n=w.get(t),r=n?.timezone??"UTC",o=c(r,t),i=E.get(t)||{id:t,role:"TUTOR",name:n?.name??a?.email??"",email:a?.email??"",avatarUrl:n?.avatarUrl??null,timezone:r,lat:o.lat,lon:o.lon,activeSessions:0,totalConnections:0},l=function(e,t,a){if(a)return!1;if(e){let t=e.toLowerCase();if(["active","live","in_progress","inprogress","ongoing"].includes(t))return!0}return!!t}(e.status,e.startedAt,e.endedAt);for(let a of(l&&(i.activeSessions+=1),y.get(e.id)??[])){let n=a.studentId,r=R.get(n),o=w.get(n),s=o?.timezone??"UTC",d=c(s,n),u=E.get(n)||{id:n,role:"STUDENT",name:o?.name??r?.email??"",email:r?.email??"",avatarUrl:o?.avatarUrl??null,timezone:s,lat:d.lat,lon:d.lon,activeSessions:0,totalConnections:0};l&&(u.activeSessions+=1),i.totalConnections+=1,u.totalConnections+=1;let p=`${e.id}:${t}:${n}`;C.push({id:p,sessionId:e.id,tutorId:t,studentId:n,subject:e.subject||"General",status:l?"ACTIVE":"RECENT",isActive:l,startedAt:e.startedAt?.toISOString()??null}),E.set(n,u)}E.set(t,i)}let S=Array.from(E.values());return n.NextResponse.json({topology:{nodes:S,edges:C,stats:{tutors:S.filter(e=>"TUTOR"===e.role).length,students:S.filter(e=>"STUDENT"===e.role).length,liveConnections:C.filter(e=>e.isActive).length,totalConnections:C.length}},meta:{days:a,generatedAt:new Date().toISOString()}})}catch(e){return console.error("Failed to build topology analytics",e),n.NextResponse.json({error:"Failed to build topology analytics"},{status:500})}}e.s(["GET",()=>p]),a()}catch(e){a(e)}},!1),749058,e=>e.a(async(t,a)=>{try{var n=e.i(78315),r=e.i(586961),o=e.i(196657),i=e.i(899733),l=e.i(233979),s=e.i(631683),d=e.i(840960),u=e.i(711373),c=e.i(699699),p=e.i(521140),h=e.i(205260),g=e.i(500249),m=e.i(431740),A=e.i(82608),f=e.i(635207),v=e.i(193695);e.i(708038);var R=e.i(447430),w=e.i(547344),y=t([w]);[w]=y.then?(await y)():y;let S=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/analytics/topology/route",pathname:"/api/admin/analytics/topology",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/admin/analytics/topology/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:T,workUnitAsyncStorage:x,serverHooks:b}=S;function E(){return(0,o.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:x})}async function C(e,t,a){S.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/admin/analytics/topology/route";n=n.replace(/\/index$/,"")||"/";let o=await S.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:y,nextConfig:E,parsedUrl:C,isDraftMode:T,prerenderManifest:x,routerServerContext:b,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,resolvedPathname:P,clientReferenceManifest:_,serverActionsManifest:D}=o,U=(0,d.normalizeAppPath)(n),O=!!(x.dynamicRoutes[U]||x.routes[P]),M=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,C,!1):t.end("This page could not be found"),null);if(O&&!T){let e=!!x.routes[P],t=x.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await M();throw new v.NoFallbackError}}let k=null;!O||S.isDev||T||(k=P,k="/index"===k?"/":k);let H=!0===S.isDev||!O,q=O&&!H;D&&_&&(0,s.setManifestsSingleton)({page:n,clientReferenceManifest:_,serverActionsManifest:D});let z=e.method||"GET",$=(0,l.getTracer)(),j=$.getActiveScopeSpan(),K={params:y,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,r)=>S.onRequestError(e,t,n,r,b)},sharedContext:{buildId:w}},L=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let o=async e=>S.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${z} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${z} ${n}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var l,d;let u=async({previousCacheEntry:r})=>{try{if(!s&&I&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=K.renderOpts.collectedTags;if(!O)return await (0,g.sendResponse)(L,F,n,K.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})},!1,b),t}},c=await S.handleResponse({req:e,nextConfig:E,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:s});if(!O)return null;if((null==c||null==(l=c.value)?void 0:l.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",I?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&O||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,A.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(L,F,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};j?await d(j):await $.withPropagatedContext(e.headers,()=>$.trace(p.BaseServerSpan.handleRequest,{spanName:`${z} ${n}`,kind:l.SpanKind.SERVER,attributes:{"http.method":z,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})},!1,b),O)throw t;return await (0,g.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>E,"routeModule",()=>S,"serverHooks",()=>b,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>x]),a()}catch(e){a(e)}},!1)];

//# debugId=29d1ab95-a5ec-4277-6a47-364ea78fec28
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_0e49fb2e._.js.map