{
  "version": 3,
  "sources": [],
  "debugId": "7b75cda3-9be3-a2d7-eba2-5f25b7818cda",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/video/daily-provider.ts"],"sourcesContent":["/**\n * Daily.co Video Provider Implementation\n * For MVP - can be swapped with Tencent TRTC later\n */\n\nimport { VideoProvider, VideoRoom } from './types'\n\n// Daily.co API configuration\nconst DAILY_API_KEY = process.env.DAILY_API_KEY || ''\nconst DAILY_API_URL = 'https://api.daily.co/v1'\n\nexport class DailyCoProvider implements VideoProvider {\n  private apiKey: string\n  private apiUrl: string\n  private mockMode: boolean\n\n  constructor(apiKey?: string) {\n    this.apiKey = apiKey || DAILY_API_KEY\n    this.apiUrl = DAILY_API_URL\n    this.mockMode = !this.apiKey\n\n    if (this.mockMode) {\n      console.warn('Daily.co API key not configured. Using mock mode for testing.')\n    }\n  }\n\n  private async fetchDaily(endpoint: string, options: RequestInit = {}): Promise<any> {\n    const url = `${this.apiUrl}${endpoint}`\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Authorization': `Bearer ${this.apiKey}`,\n        'Content-Type': 'application/json',\n        ...options.headers\n      }\n    })\n\n    if (!response.ok) {\n      const error = await response.text()\n      throw new Error(`Daily.co API error: ${error}`)\n    }\n\n    return response.json()\n  }\n\n  async createRoom(sessionId: string, options?: {\n    maxParticipants?: number\n    durationMinutes?: number\n    enableRecording?: boolean\n  }): Promise<VideoRoom> {\n    const roomName = `tutorme-${sessionId}-${Date.now()}`\n    \n    const expiry = options?.durationMinutes \n      ? new Date(Date.now() + options.durationMinutes * 60 * 1000)\n      : new Date(Date.now() + 4 * 60 * 60 * 1000) // Default 4 hours\n\n    // Mock mode for testing without Daily.co API key\n    if (this.mockMode) {\n      console.log('Creating mock room:', roomName)\n      return {\n        id: roomName,\n        url: `https://mock.daily.co/${roomName}`,\n        expiry\n      }\n    }\n\n    const room = await this.fetchDaily('/rooms', {\n      method: 'POST',\n      body: JSON.stringify({\n        name: roomName,\n        privacy: 'public',\n        properties: {\n          max_participants: options?.maxParticipants || 50,\n          enable_screenshare: true,\n          enable_chat: false, // We use our own chat\n          enable_recording: options?.enableRecording ? 'cloud' : 'false',\n          exp: Math.floor(expiry.getTime() / 1000),\n          // Auto-join with mic/video off for students\n          start_audio_off: true,\n          start_video_off: true\n        }\n      })\n    })\n\n    return {\n      id: room.name,\n      url: room.url,\n      expiry\n    }\n  }\n\n  async createBreakoutRoom(parentSessionId: string, options?: {\n    durationMinutes?: number\n  }): Promise<VideoRoom> {\n    const roomName = `tutorme-breakout-${parentSessionId}-${Date.now()}`\n    \n    const expiry = options?.durationMinutes \n      ? new Date(Date.now() + options.durationMinutes * 60 * 1000)\n      : new Date(Date.now() + 60 * 60 * 1000) // Default 1 hour for breakout\n\n    if (this.mockMode) {\n      console.log('Creating mock breakout room:', roomName)\n      return {\n        id: roomName,\n        url: `https://mock.daily.co/${roomName}`,\n        expiry\n      }\n    }\n\n    const room = await this.fetchDaily('/rooms', {\n      method: 'POST',\n      body: JSON.stringify({\n        name: roomName,\n        privacy: 'public',\n        properties: {\n          max_participants: 2, // 1:1 breakout\n          enable_screenshare: true,\n          enable_chat: false,\n          enable_recording: 'cloud',\n          exp: Math.floor(expiry.getTime() / 1000),\n          start_audio_off: false,\n          start_video_off: false\n        }\n      })\n    })\n\n    return {\n      id: room.name,\n      url: room.url,\n      expiry\n    }\n  }\n\n  async createMeetingToken(roomName: string, userId: string, options?: {\n    isOwner?: boolean\n    durationMinutes?: number\n  }): Promise<string> {\n    if (this.mockMode) {\n      return `mock-token-${userId}-${Date.now()}`\n    }\n\n    const expiry = options?.durationMinutes\n      ? Math.floor(Date.now() / 1000) + options.durationMinutes * 60\n      : Math.floor(Date.now() / 1000) + 4 * 60 * 60 // 4 hours\n\n    const token = await this.fetchDaily('/meeting-tokens', {\n      method: 'POST',\n      body: JSON.stringify({\n        properties: {\n          room_name: roomName,\n          user_id: userId,\n          is_owner: options?.isOwner || false,\n          exp: expiry\n        }\n      })\n    })\n\n    return token.token\n  }\n\n  async deleteRoom(roomId: string): Promise<void> {\n    if (this.mockMode) {\n      console.log('Deleting mock room:', roomId)\n      return\n    }\n\n    await this.fetchDaily(`/rooms/${roomId}`, {\n      method: 'DELETE'\n    })\n  }\n\n  async isRoomActive(roomId: string): Promise<boolean> {\n    if (this.mockMode) {\n      return true\n    }\n\n    try {\n      const room = await this.fetchDaily(`/rooms/${roomId}`)\n      return room && !room.deleted\n    } catch {\n      return false\n    }\n  }\n}\n\n// Singleton instance\nexport const dailyProvider = new DailyCoProvider()\n"],"names":[],"mappings":"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"}}]
}