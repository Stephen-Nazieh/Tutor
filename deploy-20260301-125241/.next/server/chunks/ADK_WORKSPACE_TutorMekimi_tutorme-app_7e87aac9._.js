;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1bf249f7-09c2-2098-f32e-bef64a2c520b")}catch(e){}}();
module.exports=[944024,e=>e.a(async(t,r)=>{try{var o=e.i(620971),a=e.i(909105),s=e.i(997103),u=e.i(122697),i=e.i(384030),n=e.i(738597);e.i(688768);var d=e.i(257357),l=e.i(917126),p=e.i(254799),c=t([i,n]);async function m(e,t){try{let r,{searchParams:i}=new URL(e.url),l="true"===i.get("myGroups"),p=i.get("subject"),c=parseInt(i.get("limit")||"10");if(l){let e=await n.drizzleDb.select({group:d.studyGroup,memberRole:d.studyGroupMember.role,creatorName:d.profile.name,creatorAvatar:d.profile.avatarUrl}).from(d.studyGroupMember).innerJoin(d.studyGroup,(0,a.eq)(d.studyGroup.id,d.studyGroupMember.groupId)).innerJoin(d.user,(0,a.eq)(d.user.id,d.studyGroup.createdBy)).innerJoin(d.profile,(0,a.eq)(d.profile.userId,d.user.id)).where((0,a.eq)(d.studyGroupMember.studentId,t.user.id)).orderBy((0,s.desc)(d.studyGroup.createdAt)).limit(c);r=await Promise.all(e.map(async e=>{let[t]=await n.drizzleDb.select({value:(0,u.count)()}).from(d.studyGroupMember).where((0,a.eq)(d.studyGroupMember.groupId,e.group.id));return{...e.group,isMember:!0,memberRole:e.memberRole,currentMembers:Number(t?.value||0),creator:{profile:{name:e.creatorName,avatarUrl:e.creatorAvatar}}}}))}else{let e=[(0,a.eq)(d.studyGroup.isActive,!0)];p&&e.push((0,a.eq)(d.studyGroup.subject,p));let o=await n.drizzleDb.select({group:d.studyGroup,creatorName:d.profile.name,creatorAvatar:d.profile.avatarUrl}).from(d.studyGroup).innerJoin(d.user,(0,a.eq)(d.user.id,d.studyGroup.createdBy)).innerJoin(d.profile,(0,a.eq)(d.profile.userId,d.user.id)).where((0,a.and)(...e)).orderBy((0,s.desc)(d.studyGroup.createdAt)).limit(c);r=await Promise.all(o.map(async e=>{let[r]=await n.drizzleDb.select({value:(0,u.count)()}).from(d.studyGroupMember).where((0,a.eq)(d.studyGroupMember.groupId,e.group.id)),[o]=await n.drizzleDb.select({role:d.studyGroupMember.role}).from(d.studyGroupMember).where((0,a.and)((0,a.eq)(d.studyGroupMember.groupId,e.group.id),(0,a.eq)(d.studyGroupMember.studentId,t.user.id))).limit(1),s=Number(r?.value||0);return{...e.group,isMember:!!o,memberRole:o?.role??null,currentMembers:s,isFull:s>=e.group.maxMembers,creator:{profile:{name:e.creatorName,avatarUrl:e.creatorAvatar}}}}))}return o.NextResponse.json({groups:r})}catch(e){return console.error("Failed to fetch study groups:",e),o.NextResponse.json({error:"Failed to fetch study groups"},{status:500})}}async function y(e,t){let r=await (0,i.requireCsrf)(e);if(r)return r;try{let r=await e.json().catch(()=>({})),s="string"==typeof r.groupId?r.groupId.trim():"";if(!s)return o.NextResponse.json({error:"Group ID required"},{status:400});let[i]=await n.drizzleDb.select().from(d.studyGroup).where((0,a.eq)(d.studyGroup.id,s)).limit(1);if(!i)return o.NextResponse.json({error:"Study group not found"},{status:404});if(!i.isActive)return o.NextResponse.json({error:"Study group is not active"},{status:400});let[l]=await n.drizzleDb.select({value:(0,u.count)()}).from(d.studyGroupMember).where((0,a.eq)(d.studyGroupMember.groupId,s));if(Number(l?.value||0)>=i.maxMembers)return o.NextResponse.json({error:"Study group is full"},{status:400});let[c]=await n.drizzleDb.select().from(d.studyGroupMember).where((0,a.and)((0,a.eq)(d.studyGroupMember.groupId,s),(0,a.eq)(d.studyGroupMember.studentId,t.user.id))).limit(1);if(c)return o.NextResponse.json({error:"Already a member of this group"},{status:400});let[m]=await n.drizzleDb.insert(d.studyGroupMember).values({id:p.default.randomUUID(),groupId:s,studentId:t.user.id,role:"member"}).returning();return o.NextResponse.json({success:!0,membership:{...m,group:{name:i.name,subject:i.subject}},message:`Joined ${i.name}`})}catch(e){return console.error("Failed to join study group:",e),o.NextResponse.json({error:"Failed to join study group"},{status:500})}}async function h(e,t){let r=await (0,i.requireCsrf)(e);if(r)return r;try{let{name:r,subject:s,description:u,maxMembers:i}=await e.json().catch(()=>({})),c="string"==typeof r?(0,l.sanitizeHtmlWithMax)(r.trim(),200):"",m="string"==typeof u?(0,l.sanitizeHtmlWithMax)(u,1e3):"";if(!c||!s)return o.NextResponse.json({error:"Name and subject required"},{status:400});let y=p.default.randomUUID(),[h]=await n.drizzleDb.transaction(async e=>{let[r]=await e.insert(d.studyGroup).values({id:y,name:c,subject:String(s).trim().slice(0,50),description:m,maxMembers:i||20,createdBy:t.user.id,isActive:!0}).returning();return await e.insert(d.studyGroupMember).values({id:p.default.randomUUID(),groupId:y,studentId:t.user.id,role:"admin"}),[r]}),[f]=await n.drizzleDb.select({name:d.profile.name}).from(d.profile).where((0,a.eq)(d.profile.userId,t.user.id)).limit(1);return o.NextResponse.json({success:!0,group:{...h,isMember:!0,memberRole:"admin",currentMembers:1,creator:{profile:{name:f?.name}}},message:`Created study group "${r}"`})}catch(e){return console.error("Failed to create study group:",e),o.NextResponse.json({error:"Failed to create study group"},{status:500})}}async function f(e,t){let r=await (0,i.requireCsrf)(e);if(r)return r;try{let r=await e.json().catch(()=>({})),s="string"==typeof r.groupId?r.groupId.trim():"";if(!s)return o.NextResponse.json({error:"Group ID required"},{status:400});let[u]=await n.drizzleDb.select({id:d.studyGroupMember.id,groupCreatedBy:d.studyGroup.createdBy,groupName:d.studyGroup.name}).from(d.studyGroupMember).innerJoin(d.studyGroup,(0,a.eq)(d.studyGroup.id,d.studyGroupMember.groupId)).where((0,a.and)((0,a.eq)(d.studyGroupMember.groupId,s),(0,a.eq)(d.studyGroupMember.studentId,t.user.id))).limit(1);if(!u)return o.NextResponse.json({error:"Not a member of this group"},{status:404});if(u.groupCreatedBy===t.user.id)return o.NextResponse.json({error:"Group creator cannot leave. Delete the group instead."},{status:400});return await n.drizzleDb.delete(d.studyGroupMember).where((0,a.eq)(d.studyGroupMember.id,u.id)),o.NextResponse.json({success:!0,message:`Left ${u.groupName}`})}catch(e){return console.error("Failed to leave study group:",e),o.NextResponse.json({error:"Failed to leave study group"},{status:500})}}[i,n]=c.then?(await c)():c;let g=(0,i.withAuth)(m),b=(0,i.withAuth)(y),R=(0,i.withAuth)(h),w=(0,i.withAuth)(f);e.s(["DELETE",0,w,"GET",0,g,"POST",0,b,"PUT",0,R]),r()}catch(e){r(e)}},!1),151434,e=>e.a(async(t,r)=>{try{var o=e.i(78315),a=e.i(586961),s=e.i(196657),u=e.i(899733),i=e.i(233979),n=e.i(631683),d=e.i(840960),l=e.i(711373),p=e.i(699699),c=e.i(521140),m=e.i(205260),y=e.i(500249),h=e.i(431740),f=e.i(82608),g=e.i(635207),b=e.i(193695);e.i(708038);var R=e.i(447430),w=e.i(944024),v=t([w]);[w]=v.then?(await v)():v;let N=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/study-groups/route",pathname:"/api/study-groups",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/study-groups/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:M,workUnitAsyncStorage:E,serverHooks:A}=N;function x(){return(0,s.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:E})}async function G(e,t,r){N.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/study-groups/route";o=o.replace(/\/index$/,"")||"/";let s=await N.prepare(e,t,{srcPage:o,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:v,nextConfig:x,parsedUrl:G,isDraftMode:M,prerenderManifest:E,routerServerContext:A,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,resolvedPathname:q,clientReferenceManifest:j,serverActionsManifest:D}=s,z=(0,d.normalizeAppPath)(o),T=!!(E.dynamicRoutes[z]||E.routes[q]),P=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,G,!1):t.end("This page could not be found"),null);if(T&&!M){let e=!!E.routes[q],t=E.dynamicRoutes[z];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await P();throw new b.NoFallbackError}}let U=null;!T||N.isDev||M||(U=q,U="/index"===U?"/":U);let S=!0===N.isDev||!T,O=T&&!S;D&&j&&(0,n.setManifestsSingleton)({page:o,clientReferenceManifest:j,serverActionsManifest:D});let _=e.method||"GET",H=(0,i.getTracer)(),F=H.getActiveScopeSpan(),k={params:v,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:S,incrementalCache:(0,u.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o,a)=>N.onRequestError(e,t,o,a,A)},sharedContext:{buildId:w}},B=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let s=async e=>N.handle(K,k).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${_} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${_} ${o}`)}),n=!!(0,u.getRequestMeta)(e,"minimalMode"),d=async u=>{var i,d;let l=async({previousCacheEntry:a})=>{try{if(!n&&I&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(u);e.fetchMetrics=k.renderOpts.fetchMetrics;let i=k.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let d=k.renderOpts.collectedTags;if(!T)return await (0,y.sendResponse)(B,$,o,k.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==k.renderOpts.collectedRevalidate&&!(k.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&k.renderOpts.collectedRevalidate,a=void 0===k.renderOpts.collectedExpire||k.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:k.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:o,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:I})},!1,A),t}},p=await N.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:n});if(!T)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(d=p.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",I?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),M&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return n&&T||c.delete(g.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(p.cacheControl)),await (0,y.sendResponse)(B,$,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};F?await d(F):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${_} ${o}`,kind:i.SpanKind.SERVER,attributes:{"http.method":_,"http.target":e.url}},d))}catch(t){if(t instanceof b.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:z,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:I})},!1,A),T)throw t;return await (0,y.sendResponse)(B,$,new Response(null,{status:500})),null}}e.s(["handler",()=>G,"patchFetch",()=>x,"routeModule",()=>N,"serverHooks",()=>A,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>E]),r()}catch(e){r(e)}},!1)];

//# debugId=1bf249f7-09c2-2098-f32e-bef64a2c520b
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_7e87aac9._.js.map