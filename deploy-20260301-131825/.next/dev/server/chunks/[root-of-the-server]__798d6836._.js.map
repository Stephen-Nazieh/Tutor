{
  "version": 3,
  "sources": [],
  "debugId": "810fe633-c825-edd0-d86b-2c08a0b6c909",
  "sections": [
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///Users/nazy/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/socket-token/route.ts"],"sourcesContent":["/**\n * GET /api/socket-token\n * Returns a short-lived JWT for Socket.io authentication.\n * Used by client hooks (use-socket, use-simple-socket) to pass auth.token when connecting.\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { getToken } from 'next-auth/jwt'\nimport { SignJWT } from 'jose'\n\nexport const dynamic = 'force-dynamic'\n\nexport async function GET(req: NextRequest) {\n  try {\n    const token = await getToken({\n      req,\n      secret: process.env.NEXTAUTH_SECRET,\n    })\n\n    if (!token?.sub && !token?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const userId = (token.sub ?? token.id) as string\n    const secret = new TextEncoder().encode(process.env.NEXTAUTH_SECRET!)\n    const socketToken = await new SignJWT({\n      id: userId,\n      role: token.role ?? 'STUDENT',\n      email: token.email ?? '',\n      name: token.name ?? '',\n    })\n      .setProtectedHeader({ alg: 'HS256' })\n      .setExpirationTime('5m')\n      .setIssuedAt()\n      .sign(secret)\n\n    return NextResponse.json({ token: socketToken })\n  } catch (error) {\n    console.error('Socket token error:', error)\n    return NextResponse.json({ error: 'Failed to issue token' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;CAIC,GAED;AACA;AACA;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,QAAQ,MAAM,IAAA,4MAAQ,EAAC;YAC3B;YACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;QACrC;QAEA,IAAI,CAAC,OAAO,OAAO,CAAC,OAAO,IAAI;YAC7B,OAAO,kMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,SAAU,MAAM,GAAG,IAAI,MAAM,EAAE;QACrC,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,eAAe;QACnE,MAAM,cAAc,MAAM,IAAI,oNAAO,CAAC;YACpC,IAAI;YACJ,MAAM,MAAM,IAAI,IAAI;YACpB,OAAO,MAAM,KAAK,IAAI;YACtB,MAAM,MAAM,IAAI,IAAI;QACtB,GACG,kBAAkB,CAAC;YAAE,KAAK;QAAQ,GAClC,iBAAiB,CAAC,MAClB,WAAW,GACX,IAAI,CAAC;QAER,OAAO,kMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,kMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}