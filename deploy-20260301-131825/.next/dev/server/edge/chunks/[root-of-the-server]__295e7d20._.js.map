{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/messages/en.json"],"sourcesContent":["{\"errors\":{\"authentication_failed\":\"Authentication failed. Please check your credentials and try again.\",\"user_not_found\":\"User not found. Please verify your email address.\",\"insufficient_permissions\":\"You don't have permission to access this resource.\",\"server_error\":\"An unexpected server error occurred. Please try again later.\",\"validation_error\":\"Please check your input and try again.\",\"rate_limit_exceeded\":\"Too many requests. Please wait and try again.\",\"csrf_validation_failed\":\"Security validation failed. Please refresh the page and try again.\",\"payment_failed\":\"Payment processing failed. Please try a different payment method.\",\"invalid_course_format\":\"Invalid course format. Please contact support.\",\"class_full\":\"This class is currently full. Please join the waitlist or try a different time.\",\"parent_not_linked\":\"You need to be linked to a parent account to access this feature.\",\"tutor_unavailable\":\"This tutor is currently unavailable. Please try a different time.\"},\"forms\":{\"submit\":\"Submit\",\"cancel\":\"Cancel\",\"save\":\"Save Changes\",\"edit\":\"Edit\",\"delete\":\"Delete\",\"confirm\":\"Confirm\",\"back\":\"Back\",\"next\":\"Next\",\"create\":\"Create\",\"update\":\"Update\",\"required_field\":\"This field is required\",\"invalid_email\":\"Please enter a valid email address\",\"password_weak\":\"Password must be at least 8 characters with at least one uppercase letter, one lowercase letter, one number, and one special character\",\"password_mismatch\":\"Passwords do not match\",\"phone_invalid\":\"Please enter a valid phone number\",\"age_verification\":\"I confirm I am 13 years or older\",\"privacy_policy\":\"I agree to the Privacy Policy and Terms of Service\"},\"navigation\":{\"home\":\"Home\",\"courses\":\"Courses\",\"dashboard\":\"Dashboard\",\"profile\":\"My Profile\",\"settings\":\"Settings\",\"parent_portal\":\"Parent Portal\",\"ai_tutor\":\"AI Tutor\",\"live_class\":\"Live Classes\",\"study_groups\":\"Study Groups\",\"gamification\":\"My Achievements\",\"messages\":\"Messages\",\"notifications\":\"Notifications\",\"help\":\"Help & Support\",\"logout\":\"Sign Out\"},\"pwa\":{\"install_title\":\"Install TutorMe\",\"install_description\":\"Add TutorMe to your home screen for quick access and offline learning.\",\"ios_install_description\":\"Install TutorMe on your device for the best experience.\",\"install_button\":\"Install\",\"install_dismiss\":\"Not now\",\"install_got_it\":\"Got it\",\"ios_how_to_install\":\"How to install\",\"ios_step_1\":\"Tap the share button\",\"ios_step_2\":\"Scroll and tap \\\"Add to Home Screen\\\"\",\"ios_step_3\":\"Tap \\\"Add\\\" in the top right\"},\"accessibility\":{\"skip_to_main_content\":\"Skip to main content\",\"skip_to_navigation\":\"Skip to navigation\",\"open_in_new_tab\":\"Opens in new tab\",\"external_link\":\"External link\",\"loading\":\"Loading...\",\"aria_label_navigation\":\"Primary navigation\",\"aria_label_main\":\"Main content\",\"aria_label_sidebar\":\"Sidebar navigation\",\"aria_label_footer\":\"Footer navigation\",\"aria_label_search\":\"Search courses and content\",\"aria_label_profile_menu\":\"Profile menu\",\"aria_label_notifications\":\"Notifications\",\"screen_reader_focus_trap\":\"Dialog open, press Escape to close\"}}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 15, "column": 3054}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/messages/zh-CN.json"],"sourcesContent":["{\"errors\":{\"authentication_failed\":\"Authentication failed. Please check your credentials and try again.\",\"user_not_found\":\"User not found. Please verify your email address.\",\"insufficient_permissions\":\"You don't have permission to access this resource.\",\"server_error\":\"An unexpected server error occurred. Please try again later.\",\"validation_error\":\"Please check your input and try again.\",\"rate_limit_exceeded\":\"Too many requests. Please wait and try again.\",\"csrf_validation_failed\":\"Security validation failed. Please refresh the page and try again.\",\"payment_failed\":\"Payment processing failed. Please try a different payment method.\",\"invalid_course_format\":\"Invalid course format. Please contact support.\",\"class_full\":\"This class is currently full. Please join the waitlist or try a different time.\",\"parent_not_linked\":\"You need to be linked to a parent account to access this feature.\",\"tutor_unavailable\":\"This tutor is currently unavailable. Please try a different time.\"},\"forms\":{\"submit\":\"Submit\",\"cancel\":\"Cancel\",\"save\":\"Save Changes\",\"edit\":\"Edit\",\"delete\":\"Delete\",\"confirm\":\"Confirm\",\"back\":\"Back\",\"next\":\"Next\",\"create\":\"Create\",\"update\":\"Update\",\"required_field\":\"This field is required\",\"invalid_email\":\"Please enter a valid email address\",\"password_weak\":\"Password must be at least 8 characters with at least one uppercase letter, one lowercase letter, one number, and one special character\",\"password_mismatch\":\"Passwords do not match\",\"phone_invalid\":\"Please enter a valid phone number\",\"age_verification\":\"I confirm I am 13 years or older\",\"privacy_policy\":\"I agree to the Privacy Policy and Terms of Service\"},\"navigation\":{\"home\":\"Home\",\"courses\":\"Courses\",\"dashboard\":\"Dashboard\",\"profile\":\"My Profile\",\"settings\":\"Settings\",\"parent_portal\":\"Parent Portal\",\"ai_tutor\":\"AI Tutor\",\"live_class\":\"Live Classes\",\"study_groups\":\"Study Groups\",\"gamification\":\"My Achievements\",\"messages\":\"Messages\",\"notifications\":\"Notifications\",\"help\":\"Help & Support\",\"logout\":\"Sign Out\"},\"pwa\":{\"install_title\":\"安装 TutorMe\",\"install_description\":\"将 TutorMe 添加到主屏幕，离线也能学习。\",\"ios_install_description\":\"在您的设备上安装 TutorMe 以获得最佳体验。\",\"install_button\":\"安装\",\"install_dismiss\":\"暂不\",\"install_got_it\":\"知道了\",\"ios_how_to_install\":\"如何安装\",\"ios_step_1\":\"点击分享按钮\",\"ios_step_2\":\"向下滚动并点击「添加到主屏幕」\",\"ios_step_3\":\"点击右上角「添加」\"},\"accessibility\":{\"skip_to_main_content\":\"Skip to main content\",\"skip_to_navigation\":\"Skip to navigation\",\"open_in_new_tab\":\"Opens in new tab\",\"external_link\":\"External link\",\"loading\":\"Loading...\",\"aria_label_navigation\":\"Primary navigation\",\"aria_label_main\":\"Main content\",\"aria_label_sidebar\":\"Sidebar navigation\",\"aria_label_footer\":\"Footer navigation\",\"aria_label_search\":\"Search courses and content\",\"aria_label_profile_menu\":\"Profile menu\",\"aria_label_notifications\":\"Notifications\",\"screen_reader_focus_trap\":\"Dialog open, press Escape to close\"}}"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 18, "column": 2895}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/i18n/request.ts"],"sourcesContent":["import { getRequestConfig } from \"next-intl/server\";\nimport { hasLocale } from \"next-intl\";\nimport { routing } from \"@/lib/i18n/config\";\n\nexport default getRequestConfig(async ({ requestLocale }) => {\n  // Typically corresponds to the `[locale]` segment\n  const requested = await requestLocale;\n  const locale = hasLocale(routing.locales, requested)\n    ? requested\n    : routing.defaultLocale;\n\n  return {\n    locale,\n    messages: (await import(`../../messages/${locale}.json`)).default,\n  };\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;uCAEe,IAAA,wUAAgB,EAAC,OAAO,EAAE,aAAa,EAAE;IACtD,kDAAkD;IAClD,MAAM,YAAY,MAAM;IACxB,MAAM,SAAS,IAAA,wPAAS,EAAC,iMAAO,CAAC,OAAO,EAAE,aACtC,YACA,iMAAO,CAAC,aAAa;IAEzB,OAAO;QACL;QACA,UAAU,CAAC;;;;;;;;;kBAAa,CAAC,eAAe,EAAE,OAAO,KAAK,CAAC,CAAC,EAAE,OAAO;IACnE;AACF"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/i18n/config.ts"],"sourcesContent":["// Enterprise-grade internationalization with next-intl\nimport { defineRouting } from \"next-intl/routing\";\nimport { createNavigation } from \"next-intl/navigation\";\n\n// Global language support for enterprise deployment\nexport const LOCALES = [\n  \"en\",\n  \"zh-CN\",\n  \"es\",\n  \"fr\",\n  \"de\",\n  \"ja\",\n  \"ko\",\n  \"pt\",\n  \"ru\",\n  \"ar\",\n] as const;\nexport type Locale = (typeof LOCALES)[number];\n\n// Default locale for global platform\nexport const DEFAULT_LOCALE = \"en\" as const;\n\n// Routing configuration for next-intl middleware\nexport const routing = defineRouting({\n  locales: [...LOCALES],\n  defaultLocale: DEFAULT_LOCALE,\n  localePrefix: \"as-needed\", // Clean URLs for SEO\n  pathnames: {\n    \"/\": \"/\",\n    \"/courses\": \"/courses\",\n    \"/dashboard\": \"/dashboard\",\n    \"/parent\": \"/parent\",\n    \"/tutor\": \"/tutor\",\n    \"/login\": \"/login\",\n    \"/register\": \"/register\",\n    \"/ai-tutor\": \"/ai-tutor\",\n    \"/live-class\": \"/live-class\",\n  } as const,\n});\n\n// Navigation configuration with i18n\nexport const {\n  Link: IntlLink,\n  redirect: intlRedirect,\n  usePathname: useIntlPathname,\n  useRouter: useIntlRouter,\n  getPathname,\n} = createNavigation(routing);\n\n// Locale detection for user preferences\nexport function detectLocale(requestHeaders: Headers): Locale {\n  const acceptLanguage = requestHeaders.get(\"accept-language\");\n\n  // Parse Accept-Language header\n  if (acceptLanguage) {\n    const preferredLanguages = acceptLanguage\n      .split(\",\")\n      .map((lang) => lang.trim().split(\";\")[0])\n      .filter(Boolean);\n\n    // Find best match for user's preferred language\n    for (const language of preferredLanguages) {\n      const baseLanguage = language.split(\"-\")[0];\n\n      // Direct match\n      const directMatch = LOCALES.find((locale) => locale === language);\n      if (directMatch) return directMatch;\n\n      // Base language match\n      const baseMatch = LOCALES.find((locale) => locale === baseLanguage);\n      if (baseMatch) return baseMatch;\n    }\n  }\n\n  // Return default if no match found\n  return DEFAULT_LOCALE;\n}\n\n// Translation namespaces for enterprise scale\nexport const NAMESPACES = [\n  \"common\",\n  \"navigation\",\n  \"auth\",\n  \"courses\",\n  \"dashboard\",\n  \"classroom\",\n  \"parent\",\n  \"tutor\",\n  \"ai-tutor\",\n  \"gamification\",\n  \"payments\",\n  \"notifications\",\n  \"errors\",\n  \"validation\",\n  \"forms\",\n  \"time\",\n  \"accessibility\",\n] as const;\nexport type Namespace = (typeof NAMESPACES)[number];\n\n// Time and number formatting based on locale\nexport function getLocaleInfo(locale: Locale) {\n  const localeConfigs: Record<\n    Locale,\n    {\n      direction: \"ltr\" | \"rtl\";\n      language: string;\n      region: string;\n      currency: string;\n      timezone: string;\n      dateFormat: string;\n      numberFormat: string;\n      name: string;\n    }\n  > = {\n    en: {\n      direction: \"ltr\",\n      language: \"en\",\n      region: \"en-US\",\n      currency: \"USD\",\n      timezone: \"America/New_York\",\n      dateFormat: \"MM/DD/YYYY\",\n      numberFormat: \"1,000.00\",\n      name: \"English\",\n    },\n    \"zh-CN\": {\n      direction: \"ltr\",\n      language: \"zh\",\n      region: \"zh-CN\",\n      currency: \"CNY\",\n      timezone: \"Asia/Shanghai\",\n      dateFormat: \"YYYY/MM/DD\",\n      numberFormat: \"1,0000.00\",\n      name: \"中文 (简体)\",\n    },\n    es: {\n      direction: \"ltr\",\n      language: \"es\",\n      region: \"es-ES\",\n      currency: \"EUR\",\n      timezone: \"Europe/Madrid\",\n      dateFormat: \"DD/MM/YYYY\",\n      numberFormat: \"1.000,00\",\n      name: \"Español\",\n    },\n    fr: {\n      direction: \"ltr\",\n      language: \"fr\",\n      region: \"fr-FR\",\n      currency: \"EUR\",\n      timezone: \"Europe/Paris\",\n      dateFormat: \"DD/MM/YYYY\",\n      numberFormat: \"1 000,00\",\n      name: \"Français\",\n    },\n    de: {\n      direction: \"ltr\",\n      language: \"de\",\n      region: \"de-DE\",\n      currency: \"EUR\",\n      timezone: \"Europe/Berlin\",\n      dateFormat: \"DD.MM.YYYY\",\n      numberFormat: \"1.000,00\",\n      name: \"Deutsch\",\n    },\n    ja: {\n      direction: \"ltr\",\n      language: \"ja\",\n      region: \"ja-JP\",\n      currency: \"JPY\",\n      timezone: \"Asia/Tokyo\",\n      dateFormat: \"YYYY/MM/DD\",\n      numberFormat: \"1,000\",\n      name: \"日本語\",\n    },\n    ko: {\n      direction: \"ltr\",\n      language: \"ko\",\n      region: \"ko-KR\",\n      currency: \"KRW\",\n      timezone: \"Asia/Seoul\",\n      dateFormat: \"YYYY/MM/DD\",\n      numberFormat: \"1,000\",\n      name: \"한국어\",\n    },\n    pt: {\n      direction: \"ltr\",\n      language: \"pt\",\n      region: \"pt-BR\",\n      currency: \"BRL\",\n      timezone: \"America/Sao_Paulo\",\n      dateFormat: \"DD/MM/YYYY\",\n      numberFormat: \"1.000,00\",\n      name: \"Português\",\n    },\n    ru: {\n      direction: \"ltr\",\n      language: \"ru\",\n      region: \"ru-RU\",\n      currency: \"RUB\",\n      timezone: \"Europe/Moscow\",\n      dateFormat: \"DD.MM.YYYY\",\n      numberFormat: \"1 000,00\",\n      name: \"Русский\",\n    },\n    ar: {\n      direction: \"rtl\",\n      language: \"ar\",\n      region: \"ar-SA\",\n      currency: \"SAR\",\n      timezone: \"Asia/Riyadh\",\n      dateFormat: \"DD/MM/YYYY\",\n      numberFormat: \"1,000.00\",\n      name: \"العربية\",\n    },\n  };\n\n  return localeConfigs[locale] ?? localeConfigs[DEFAULT_LOCALE];\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/i18n/routing.ts"],"sourcesContent":["// Re-export routing config for next-intl middleware\nexport { routing } from \"@/lib/i18n/config\";\n"],"names":[],"mappings":";AAAA,oDAAoD;AACpD"}},
    {"offset": {"line": 287, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'fs')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`fs`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,EAAE,CAAC"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'path')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`path`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 299, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'dns')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`dns`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'net')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`net`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'tls')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`tls`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 315, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'string_decoder')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`string_decoder`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,cAAc,CAAC"}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/security/rate-limit.ts"],"sourcesContent":["/**\n * Rate limiting for API routes.\n * Uses Redis when REDIS_URL is set (shared across instances); otherwise in-memory store.\n */\nconst DEFAULT_WINDOW_MS = 60 * 1000 // 1 minute\nconst DEFAULT_MAX = 100 // requests per window per key\nconst REDIS_PREFIX = 'ratelimit:'\n\ninterface Entry {\n  count: number\n  resetAt: number\n}\n\ninterface RateLimitOptions {\n  max: number\n  windowMs?: number\n}\n\ninterface RateLimitResult {\n  allowed: boolean\n  remaining: number\n  resetAt: number\n}\n\nconst memoryStore = new Map<string, Entry>()\n\nfunction prune(): void {\n  const now = Date.now()\n  for (const [key, entry] of memoryStore.entries()) {\n    if (entry.resetAt < now) memoryStore.delete(key)\n  }\n}\n\nfunction checkRateLimitMemory(\n  key: string,\n  options: RateLimitOptions\n): RateLimitResult {\n  const windowMs = options.windowMs ?? DEFAULT_WINDOW_MS\n  const { max } = options\n  const now = Date.now()\n  if (memoryStore.size > 10000) prune()\n  let entry = memoryStore.get(key)\n  if (!entry || entry.resetAt < now) {\n    entry = { count: 0, resetAt: now + windowMs }\n    memoryStore.set(key, entry)\n  }\n  entry.count += 1\n  const allowed = entry.count <= max\n  const remaining = Math.max(0, max - entry.count)\n  return { allowed, remaining, resetAt: entry.resetAt }\n}\n\nlet redisClient: import('ioredis').Redis | null = null\nlet redisInitPromise: Promise<import('ioredis').Redis | null> | null = null\n\nasync function getRedisClient(): Promise<import('ioredis').Redis | null> {\n  if (redisClient) return redisClient\n  if (typeof window !== 'undefined') return null // browser\n  const url = process.env.REDIS_URL\n  if (!url) return null\n  if (!redisInitPromise) {\n    redisInitPromise = (async () => {\n      try {\n        const { Redis } = await import('ioredis')\n        const client = new Redis(url, {\n          retryStrategy: (times) => Math.min(times * 50, 2000),\n          maxRetriesPerRequest: 3,\n        })\n        client.on('error', () => {})\n        redisClient = client\n        return client\n      } catch {\n        return null\n      }\n    })()\n  }\n  return redisInitPromise\n}\n\nasync function checkRateLimitRedis(\n  key: string,\n  options: RateLimitOptions\n): Promise<RateLimitResult> {\n  const redis = await getRedisClient()\n  if (!redis) return checkRateLimitMemory(key, options)\n\n  const windowMs = options.windowMs ?? DEFAULT_WINDOW_MS\n  const { max } = options\n  const now = Date.now()\n  const fullKey = REDIS_PREFIX + key\n  const ttlSeconds = Math.ceil(windowMs / 1000)\n\n  try {\n    // Atomic Lua: INCR + EXPIRE (when count=1) in single round-trip - no race conditions\n    const result = (await redis.eval(\n      `local c=redis.call('INCR',KEYS[1]) if c==1 then redis.call('EXPIRE',KEYS[1],ARGV[1]) end return {c,redis.call('PTTL',KEYS[1])}`,\n      1,\n      fullKey,\n      ttlSeconds\n    )) as [number, number]\n    const [newCount, pttl] = result\n    const resetAt = pttl > 0 ? now + pttl : now + windowMs\n\n    const allowed = newCount <= max\n    const remaining = Math.max(0, max - newCount)\n    return { allowed, remaining, resetAt }\n  } catch {\n    return checkRateLimitMemory(key, options)\n  }\n}\n\n/**\n * Check rate limit. Returns { allowed, remaining, resetAt }.\n * Uses Redis when REDIS_URL is set; otherwise in-memory (per instance).\n * key: typically prefix + IP (e.g. \"login:\" + getClientIdentifier(req))\n */\nexport async function checkRateLimit(\n  key: string,\n  maxOrOptions: number | RateLimitOptions = DEFAULT_MAX\n): Promise<RateLimitResult> {\n  const options: RateLimitOptions =\n    typeof maxOrOptions === 'number'\n      ? { max: maxOrOptions, windowMs: DEFAULT_WINDOW_MS }\n      : { windowMs: DEFAULT_WINDOW_MS, ...maxOrOptions }\n\n  if (process.env.REDIS_URL) {\n    return checkRateLimitRedis(key, options)\n  }\n  return checkRateLimitMemory(key, options)\n}\n\n/** Presets for sensitive routes (stricter limits) */\nexport const RATE_LIMIT_PRESETS = {\n  /** Login: 10 attempts per 15 minutes per IP */\n  login: { max: 10, windowMs: 15 * 60 * 1000 },\n  /** Signup/register: allow multi-step retries and multi-role onboarding in the same browser */\n  register: { max: 12, windowMs: 15 * 60 * 1000 },\n  /** Payment create: 20 per minute per IP */\n  paymentCreate: { max: 20, windowMs: 60 * 1000 },\n  /** Enroll (subject or curriculum): 30 per minute per IP */\n  enroll: { max: 30, windowMs: 60 * 1000 },\n  /** Class booking: 20 per minute per IP */\n  booking: { max: 20, windowMs: 60 * 1000 },\n  /** AI generation/chat: 12 per minute per client identifier */\n  aiGenerate: { max: 12, windowMs: 60 * 1000 },\n} as const\n\n/**\n * Check rate limit using a named preset. Key will be prefixed with the preset name.\n */\nexport async function checkRateLimitPreset(\n  req: Request,\n  preset: keyof typeof RATE_LIMIT_PRESETS\n): Promise<RateLimitResult> {\n  const ip = getClientIdentifier(req)\n  const key = `${preset}:${ip}`\n  const options = RATE_LIMIT_PRESETS[preset]\n  return checkRateLimit(key, options)\n}\n\n/**\n * Get client identifier for rate limiting (IP or x-forwarded-for).\n */\nexport function getClientIdentifier(req: Request): string {\n  const trustProxy = process.env.TRUST_PROXY === 'true'\n  const forwarded = req.headers.get('x-forwarded-for')\n  const realIp = req.headers.get('x-real-ip')\n  const cfIp = req.headers.get('cf-connecting-ip')\n\n  const firstForwarded = forwarded?.split(',')[0]?.trim()\n  const candidate = trustProxy ? (firstForwarded || realIp || cfIp) : (realIp || cfIp)\n  const ip = normalizeIp(candidate)\n  if (ip !== 'unknown') return ip\n\n  // Fallback identifier when no reliable IP is available (prevents all unknown clients sharing one bucket).\n  const ua = req.headers.get('user-agent') || 'unknown'\n  const lang = req.headers.get('accept-language') || 'unknown'\n  const fingerprint = simpleHash(`${ua}|${lang}`)\n  return `unknown:${fingerprint}`\n}\n\nfunction normalizeIp(ip: string | null | undefined): string {\n  if (!ip) return 'unknown'\n  const trimmed = ip.trim()\n  if (!trimmed) return 'unknown'\n  if (trimmed === '::1') return '127.0.0.1'\n  return trimmed\n}\n\nfunction simpleHash(input: string): string {\n  let hash = 2166136261\n  for (let i = 0; i < input.length; i += 1) {\n    hash ^= input.charCodeAt(i)\n    hash = Math.imul(hash, 16777619)\n  }\n  return (hash >>> 0).toString(16).padStart(8, '0')\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 497, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/middleware.ts"],"sourcesContent":["/**\n * Next.js Middleware\n * i18n: locale routing via next-intl. Security: rate limiting, headers. Auth: protects routes.\n */\n\nimport createMiddleware from 'next-intl/middleware'\nimport { withAuth } from 'next-auth/middleware'\nimport { NextResponse } from 'next/server'\nimport { routing } from '@/i18n/routing'\nimport { checkRateLimit, checkRateLimitPreset, getClientIdentifier } from '@/lib/security/rate-limit'\n\nconst intlMiddleware = createMiddleware(routing)\n\nconst API_RATE_LIMIT_MAX = 100 // per minute per IP\nconst RATE_LIMIT_SKIP = ['/api/auth', '/api/health', '/api/payments/webhooks']\n\n/**\n * Build a strict Content-Security-Policy.\n * Next.js requires 'unsafe-inline' and 'unsafe-eval' for script in dev/prod with current setup;\n * use nonces in future for stricter script-src.\n * @see docs/CSP_HARDENING.md for hardening steps and nonce/hash migration plan.\n */\nfunction getCspHeader(): string {\n  const directives = [\n    \"default-src 'self'\",\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval'\",\n    \"style-src 'self' 'unsafe-inline'\",\n    \"img-src 'self' data: blob: https:\",\n    \"font-src 'self' data:\",\n    \"connect-src 'self' https: wss:\",\n    \"frame-src 'self'\",\n    \"frame-ancestors 'self'\",\n    \"base-uri 'self'\",\n    \"form-action 'self'\",\n    \"object-src 'none'\",\n  ]\n  if (process.env.NODE_ENV === 'production') {\n    directives.push('upgrade-insecure-requests')\n  }\n  return directives.join('; ')\n}\n\nfunction addSecurityHeaders(res: NextResponse): NextResponse {\n  res.headers.set('X-Content-Type-Options', 'nosniff')\n  res.headers.set('X-Frame-Options', 'SAMEORIGIN')\n  res.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')\n  res.headers.set('Content-Security-Policy', getCspHeader())\n  return res\n}\n\nfunction stripLocalePrefix(pathname: string): string {\n  const segments = pathname.split('/').filter(Boolean)\n  const locale = segments[0]\n  if (locale && routing.locales.includes(locale as (typeof routing.locales)[number])) {\n    if (segments.length === 1) return '/'\n    return `/${segments.slice(1).join('/')}`\n  }\n  return pathname\n}\n\nexport default withAuth(\n  async function middleware(req) {\n    const path = req.nextUrl.pathname\n    const normalizedPath = path.startsWith('/api') ? path : stripLocalePrefix(path)\n    const token = req.nextauth.token\n    const method = req.method ?? 'GET'\n    const handleMatch = normalizedPath.match(/^\\/@([a-zA-Z0-9._]{3,30})$/)\n\n    if (handleMatch) {\n      const username = handleMatch[1].toLowerCase()\n      return NextResponse.redirect(new URL(`/${routing.defaultLocale}/u/${username}`, req.url))\n    }\n\n    // Stricter rate limit for login (POST to signin; NextAuth uses signin/credentials)\n    const isSignin = (path === '/api/auth/signin' || path === '/api/auth/signin/credentials') && method === 'POST'\n    if (isSignin) {\n      try {\n        const { allowed, resetAt } = await checkRateLimitPreset(req as unknown as Request, 'login')\n        if (!allowed) {\n          const retryAfter = Math.ceil((resetAt - Date.now()) / 1000)\n          const res = new NextResponse(\n            JSON.stringify({ error: 'Too many login attempts. Please try again later.' }),\n            {\n              status: 429,\n              headers: {\n                'Content-Type': 'application/json',\n                'Retry-After': String(Math.max(1, retryAfter)),\n              },\n            }\n          )\n          addSecurityHeaders(res)\n          return res\n        }\n      } catch (error) {\n        console.error('[Middleware] Login rate-limit check failed:', error)\n      }\n    }\n\n    // Rate limit API (except auth, health, webhooks)\n    if (path.startsWith('/api') && !RATE_LIMIT_SKIP.some((p) => path.startsWith(p))) {\n      try {\n        const key = getClientIdentifier(req as unknown as Request)\n        const { allowed } = await checkRateLimit(key, API_RATE_LIMIT_MAX)\n        if (!allowed) {\n          const res = new NextResponse(JSON.stringify({ error: 'Too many requests' }), {\n            status: 429,\n            headers: { 'Content-Type': 'application/json', 'Retry-After': '60' }\n          })\n          addSecurityHeaders(res)\n          return res\n        }\n      } catch (error) {\n        console.error('[Middleware] API rate-limit check failed:', error)\n      }\n    }\n\n    // Allow access to onboarding pages\n    if (normalizedPath.startsWith('/onboarding')) {\n      const res = NextResponse.next()\n      addSecurityHeaders(res)\n      return res\n    }\n\n    // Protect student routes\n    if (normalizedPath.startsWith('/student') && token?.role !== 'STUDENT' && token?.role !== 'ADMIN') {\n      return NextResponse.redirect(new URL('/login', req.url))\n    }\n\n    // Protect tutor routes\n    if (normalizedPath.startsWith('/tutor') && token?.role !== 'TUTOR' && token?.role !== 'ADMIN') {\n      return NextResponse.redirect(new URL('/login', req.url))\n    }\n\n    // Protect parent routes - only PARENT and ADMIN roles allowed\n    if (normalizedPath.startsWith('/parent')) {\n      const allowedRoles = ['PARENT', 'ADMIN']\n      if (!token?.role || !allowedRoles.includes(token.role)) {\n        // Redirect to role-appropriate dashboard or login\n        const redirectUrl =\n          token?.role === 'STUDENT'\n            ? new URL('/student', req.url)\n            : token?.role === 'TUTOR'\n              ? new URL('/tutor', req.url)\n              : new URL('/login', req.url)\n        return NextResponse.redirect(redirectUrl)\n      }\n    }\n\n    // Enforce TOS acceptance\n    if (token && !token.tosAccepted && !normalizedPath.startsWith('/student/agreement') && !path.startsWith('/api')) {\n      return NextResponse.redirect(new URL('/student/agreement', req.url))\n    }\n\n    // Never run i18n middleware for API routes.\n    if (path.startsWith('/api')) {\n      const res = NextResponse.next()\n      addSecurityHeaders(res)\n      return res\n    }\n\n    const res = intlMiddleware(req)\n    addSecurityHeaders(res)\n    return res\n  },\n  {\n    callbacks: {\n      authorized({ req, token }) {\n        const pathname = req.nextUrl.pathname\n        const normalizedPath = pathname.startsWith('/api') ? pathname : stripLocalePrefix(pathname)\n        const publicExactPaths = [\n          '/login',\n          '/register',\n          '/',\n        ]\n        const publicPrefixPaths = [\n          '/api/auth',\n          '/api/health',\n          '/api/csrf',\n          '/api/public',\n          '/onboarding',\n          '/u/',\n          '/admin',\n          '/api/admin/',\n          '/api/admin/auth',\n        ]\n        const isPublicExact = publicExactPaths.includes(normalizedPath)\n        const isPublicPrefix = publicPrefixPaths.some((p) => {\n          if (p.endsWith('/')) return normalizedPath.startsWith(p)\n          return normalizedPath === p || normalizedPath.startsWith(`${p}/`)\n        })\n        const isPublicPath =\n          isPublicExact || isPublicPrefix\n        if (isPublicPath) return true\n        return token !== null\n      }\n    }\n  }\n)\n\nexport const config = {\n  matcher: [\n    // Match all pathnames except api, _next, _vercel, static files (for next-intl)\n    '/((?!api|_next|_vercel|.*\\\\..*).*)',\n    // Explicit locale-prefixed paths\n    '/(en|zh-CN|es|fr|de|ja|ko|pt|ru|ar)/:path*',\n    // Root\n    '/',\n    // Auth and API (for rate limiting)\n    '/api/auth/signin',\n    '/api/auth/signin/credentials',\n    '/api/((?!auth|health).*)'\n  ]\n}\n"],"names":[],"mappings":"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"}}]
}