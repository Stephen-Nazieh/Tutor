{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'fs')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`fs`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,EAAE,CAAC"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'path')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`path`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'dns')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`dns`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'net')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`net`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'tls')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`tls`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,GAAG,CAAC"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'string_decoder')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`string_decoder`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,cAAc,CAAC"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/db/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-require-imports */\n\n/**\n * Database Client with Connection Pooling\n * \n * Features:\n * - Connection pooling for high concurrency (100+ users)\n * - Query caching with Redis\n * - Read replica support for scaling\n * - N+1 query prevention with dataloaders\n * \n * Note: Redis is lazily initialized to avoid bundling issues\n */\n\n// Connection pool configuration\nconst POOL_CONFIG = {\n  // Connection pool settings for 100+ concurrent users\n  min: 5,                    // Minimum connections\n  max: 50,                   // Maximum connections (supports 100+ concurrent users)\n  idleTimeoutMillis: 30000,  // Close idle connections after 30s\n  connectionTimeoutMillis: 5000, // Connection timeout\n  allowExitOnIdle: false,    // Keep pool alive\n}\n\n// Query cache configuration\nconst CACHE_CONFIG = {\n  ttl: 60,                   // Default cache TTL in seconds\n  staleWhileRevalidate: 30,  // Serve stale data while refreshing\n  prefix: 'tutorme:query:',  // Cache key prefix\n}\n\nlet db: any\nlet redis: any | null = null\nlet queryCache: Map<string, { data: any; expires: number }> | null = null\nlet redisInitialized = false\n\n// Safe check for server-side environment (not Edge Runtime)\n// Edge Runtime (used by Next.js middleware) doesn't support Prisma Client\nconst isEdgeRuntime = typeof (globalThis as any).EdgeRuntime !== 'undefined' || \n  (typeof process !== 'undefined' && process.env.NEXT_RUNTIME === 'edge')\nconst isServer = typeof window === 'undefined' && !isEdgeRuntime\n\n// Initialize in-memory cache only on server\nfunction getQueryCache() {\n  if (!isServer) return null\n  if (!queryCache) {\n    queryCache = new Map()\n  }\n  return queryCache\n}\n\n// Initialize Redis client if available (server-side only)\nasync function initRedis() {\n  if (!isServer) return null\n  if (redisInitialized) return redis\n  \n  try {\n    const redisUrl = process.env.REDIS_URL\n    if (!redisUrl) {\n      console.log('[DB] Redis URL not configured, using in-memory cache')\n      redisInitialized = true\n      return null\n    }\n    \n    // Dynamic import to avoid bundling issues\n    const { Redis } = await import('ioredis')\n    redis = new Redis(redisUrl, {\n      retryStrategy: (times) => Math.min(times * 50, 2000),\n      maxRetriesPerRequest: 3,\n    })\n    \n    redis.on('error', (err: any) => {\n      console.error('[Redis] Connection error:', err)\n      redis = null\n    })\n    \n    console.log('[DB] Redis cache initialized')\n    redisInitialized = true\n    return redis\n  } catch (e) {\n    console.warn('[DB] Failed to initialize Redis, using in-memory cache')\n    redisInitialized = true\n    return null\n  }\n}\n\n// Initialize Prisma Client with connection pooling (server-side only)\nif (isServer) {\n  try {\n    const { PrismaClient } = require('@prisma/client')\n    \n    const globalForPrisma = globalThis as unknown as {\n      prisma: typeof PrismaClient | undefined\n      redis: any | null\n      redisInitialized: boolean\n    }\n    \n    // Initialize Redis on first use (lazy initialization)\n    if (globalForPrisma.redisInitialized) {\n      redis = globalForPrisma.redis\n      redisInitialized = true\n    }\n    \n    if (process.env.NODE_ENV !== 'production') {\n      globalForPrisma.redis = redis\n      globalForPrisma.redisInitialized = redisInitialized\n    }\n    \n    // Initialize Prisma with connection pooling\n    if (globalForPrisma.prisma) {\n      db = globalForPrisma.prisma\n    } else {\n      db = new PrismaClient({\n        log: process.env.NODE_ENV === 'development' \n          ? ['query', 'error', 'warn'] \n          : ['error'],\n        \n        // Connection pooling configuration\n        datasources: {\n          db: {\n            url: process.env.DATABASE_URL,\n          },\n        },\n      })\n      \n      // Add connection pool monitoring\n      db.$on('query', (e: any) => {\n        if (process.env.NODE_ENV === 'development') {\n          console.log('[Prisma Query]', e.query, `${e.duration}ms`)\n        }\n      })\n      \n      if (process.env.NODE_ENV !== 'production') {\n        globalForPrisma.prisma = db\n      }\n    }\n    \n    console.log('[DB] Prisma Client initialized with connection pooling')\n  } catch (e) {\n    console.error('[DB] Failed to initialize Prisma:', e)\n    // Fallback for build time\n    db = {\n      $connect: async () => {},\n      $disconnect: async () => {},\n    }\n  }\n} else {\n  // Client-side mock\n  db = {\n    $connect: async () => {},\n    $disconnect: async () => {},\n  }\n}\n\n/**\n * Cache utilities\n */\nexport const cache = {\n  /**\n   * Ensure Redis is initialized\n   */\n  async ensureRedis() {\n    if (!isServer) return null\n    if (!redisInitialized) {\n      await initRedis()\n    }\n    return redis\n  },\n\n  /**\n   * Get cached value\n   */\n  async get<T>(key: string): Promise<T | null> {\n    if (!isServer) return null\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    // Try Redis first\n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const value = await client.get(fullKey)\n        if (value) return JSON.parse(value)\n      } catch (e) {\n        console.error('[Cache] Redis get error:', e)\n      }\n    }\n    \n    // Fallback to in-memory cache\n    const cache = getQueryCache()\n    if (!cache) return null\n    \n    const cached = cache.get(fullKey)\n    if (cached && cached.expires > Date.now()) {\n      return cached.data\n    }\n    \n    cache.delete(fullKey)\n    return null\n  },\n  \n  /**\n   * Set cached value\n   */\n  async set<T>(key: string, value: T, ttlSeconds = CACHE_CONFIG.ttl): Promise<void> {\n    if (!isServer) return\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    // Try Redis first\n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        await client.setex(fullKey, ttlSeconds, JSON.stringify(value))\n        return\n      } catch (e) {\n        console.error('[Cache] Redis set error:', e)\n      }\n    }\n    \n    // Fallback to in-memory cache\n    const cache = getQueryCache()\n    if (cache) {\n      cache.set(fullKey, {\n        data: value,\n        expires: Date.now() + ttlSeconds * 1000\n      })\n    }\n  },\n  \n  /**\n   * Delete cached value\n   */\n  async delete(key: string): Promise<void> {\n    if (!isServer) return\n    \n    const fullKey = CACHE_CONFIG.prefix + key\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        await client.del(fullKey)\n      } catch (e) {\n        console.error('[Cache] Redis del error:', e)\n      }\n    }\n    \n    const cache = getQueryCache()\n    if (cache) cache.delete(fullKey)\n  },\n  \n  /**\n   * Clear all cached values\n   */\n  async clear(): Promise<void> {\n    if (!isServer) return\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const keys = await client.keys(CACHE_CONFIG.prefix + '*')\n        if (keys.length > 0) {\n          await client.del(...keys)\n        }\n      } catch (e) {\n        console.error('[Cache] Redis clear error:', e)\n      }\n    }\n    \n    const cache = getQueryCache()\n    if (cache) cache.clear()\n  },\n  \n  /**\n   * Get or set cached value\n   */\n  async getOrSet<T>(\n    key: string,\n    factory: () => Promise<T>,\n    ttlSeconds = CACHE_CONFIG.ttl\n  ): Promise<T> {\n    const cached = await this.get<T>(key)\n    if (cached !== null) return cached\n    \n    const value = await factory()\n    await this.set(key, value, ttlSeconds)\n    return value\n  },\n\n  /**\n   * Invalidate cache for a pattern\n   */\n  async invalidatePattern(pattern: string): Promise<void> {\n    if (!isServer) return\n    \n    const client = await this.ensureRedis()\n    if (client) {\n      try {\n        const keys = await client.keys(CACHE_CONFIG.prefix + pattern)\n        if (keys.length > 0) {\n          await client.del(...keys)\n        }\n      } catch (e) {\n        console.error('[Cache] Pattern invalidation error:', e)\n      }\n    }\n    \n    // Clear in-memory cache matching pattern\n    const cache = getQueryCache()\n    if (cache) {\n      const regex = new RegExp(CACHE_CONFIG.prefix + pattern.replace('*', '.*'))\n      for (const key of cache.keys()) {\n        if (regex.test(key)) cache.delete(key)\n      }\n    }\n  }\n}\n\n/**\n * Query optimization utilities\n */\nexport const queryOptimizer = {\n  /**\n   * Batch load function for N+1 prevention\n   */\n  async batchLoad<T>(\n    ids: string[],\n    fetchFn: (ids: string[]) => Promise<T[]>,\n    getId: (item: T) => string\n  ): Promise<(T | null)[]> {\n    if (!isServer) return ids.map(() => null)\n    if (ids.length === 0) return []\n    \n    // Deduplicate IDs\n    const uniqueIds = [...new Set(ids)]\n    \n    // Fetch all items in one query\n    const items = await fetchFn(uniqueIds)\n    \n    // Create lookup map\n    const itemMap = new Map(items.map(item => [getId(item), item]))\n    \n    // Return items in original order\n    return ids.map(id => itemMap.get(id) || null)\n  },\n  \n  /**\n   * Wrap a query with caching\n   */\n  async cachedQuery<T>(\n    cacheKey: string,\n    queryFn: () => Promise<T>,\n    ttlSeconds = CACHE_CONFIG.ttl\n  ): Promise<T> {\n    return cache.getOrSet(cacheKey, queryFn, ttlSeconds)\n  }\n}\n\n/**\n * Read replica support (for future scaling)\n */\nexport const readReplica = {\n  /**\n   * Check if read replicas are configured\n   */\n  isConfigured(): boolean {\n    return isServer && !!process.env.DATABASE_READ_REPLICA_URL\n  },\n  \n  /**\n   * Get read-only database client\n   * Falls back to primary if replicas not configured\n   */\n  getClient() {\n    // For now, return the same client\n    // In production, this would return a connection to the read replica\n    return db\n  }\n}\n\nexport { db }\n/** Alias for code that imports prisma from @/lib/db */\nexport const prisma = db\n\n// Drizzle is NOT re-exported here so that @/lib/db is safe for client/instrumentation (pg is Node-only).\n// Server-only code that needs Drizzle: import { drizzleDb } from '@/lib/db/drizzle'\n\n// Re-export Prisma types (will be empty on client)\nexport * from '@prisma/client'\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 375, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/notifications/notify.ts"],"sourcesContent":["/**\n * Central Notification Service\n *\n * Handles all three channels in one call:\n *  - In-app (DB record)\n *  - Email (via Resend API)\n *  - Real-time push (via SSE broadcast)\n *\n * Usage:\n *   import { notify, notifyMany } from '@/lib/notifications/notify'\n *   await notify({ userId, type: 'assignment', title, message, actionUrl })\n *   await notifyMany({ userIds: [...], type, title, message })\n */\n\nimport { db } from '@/lib/db'\n\n// ---- Types ----\n\nexport type NotificationType =\n    | 'assignment'\n    | 'class'\n    | 'message'\n    | 'enrollment'\n    | 'payment'\n    | 'system'\n    | 'reminder'\n    | 'achievement'\n    | 'grade'\n\ninterface NotifyParams {\n    userId: string\n    type: NotificationType\n    title: string\n    message: string\n    data?: Record<string, unknown>\n    actionUrl?: string\n    /** Skip checking preferences (for critical system notifications) */\n    force?: boolean\n}\n\ninterface NotifyManyParams {\n    userIds: string[]\n    type: NotificationType\n    title: string\n    message: string\n    data?: Record<string, unknown>\n    actionUrl?: string\n    force?: boolean\n}\n\n// ---- SSE Event Bus (in-memory) ----\n\ntype SSECallback = (notification: any) => void\nconst sseListeners = new Map<string, Set<SSECallback>>()\n\nexport function addSSEListener(userId: string, cb: SSECallback) {\n    if (!sseListeners.has(userId)) sseListeners.set(userId, new Set())\n    sseListeners.get(userId)!.add(cb)\n    return () => {\n        sseListeners.get(userId)?.delete(cb)\n        if (sseListeners.get(userId)?.size === 0) sseListeners.delete(userId)\n    }\n}\n\nfunction broadcastToUser(userId: string, notification: any) {\n    const listeners = sseListeners.get(userId)\n    if (listeners) {\n        for (const cb of listeners) {\n            try { cb(notification) } catch { /* ignore */ }\n        }\n    }\n}\n\n// ---- Preference Check ----\n\ninterface ChannelDecision {\n    inApp: boolean\n    email: boolean\n    push: boolean\n}\n\nasync function getChannelDecision(\n    userId: string,\n    type: NotificationType,\n    force: boolean\n): Promise<ChannelDecision> {\n    if (force) return { inApp: true, email: true, push: true }\n\n    const prefs = await db.notificationPreference.findUnique({\n        where: { userId },\n    })\n\n    if (!prefs) return { inApp: true, email: true, push: true } // defaults\n\n    // Start with global toggles\n    let decision: ChannelDecision = {\n        inApp: prefs.inAppEnabled,\n        email: prefs.emailEnabled,\n        push: prefs.pushEnabled,\n    }\n\n    // Apply per-type overrides\n    const overrides = prefs.channelOverrides as Record<string, any> | null\n    if (overrides && overrides[type]) {\n        const typeOverride = overrides[type]\n        if (typeof typeOverride.inApp === 'boolean') decision.inApp = typeOverride.inApp\n        if (typeof typeOverride.email === 'boolean') decision.email = typeOverride.email\n        if (typeof typeOverride.push === 'boolean') decision.push = typeOverride.push\n    }\n\n    // Check quiet hours for push/email\n    if (prefs.quietHoursStart && prefs.quietHoursEnd) {\n        const isQuiet = isInQuietHours(prefs.quietHoursStart, prefs.quietHoursEnd, prefs.timezone)\n        if (isQuiet) {\n            decision.push = false\n            // Email follows digest preference during quiet hours\n        }\n    }\n\n    // Email digest: if not \"instant\", skip immediate email\n    if (prefs.emailDigest !== 'instant') {\n        decision.email = false\n    }\n\n    return decision\n}\n\nfunction isInQuietHours(start: string, end: string, timezone: string): boolean {\n    try {\n        const now = new Date()\n        const formatter = new Intl.DateTimeFormat('en-US', {\n            timeZone: timezone,\n            hour: '2-digit',\n            minute: '2-digit',\n            hour12: false,\n        })\n        const currentTime = formatter.format(now) // \"HH:MM\"\n\n        // Simple string comparison works for HH:mm format\n        if (start <= end) {\n            return currentTime >= start && currentTime <= end\n        }\n        // Wraps midnight (e.g. 22:00 - 07:00)\n        return currentTime >= start || currentTime <= end\n    } catch {\n        return false\n    }\n}\n\n// ---- Email Sending ----\n\nasync function sendNotificationEmail(\n    userId: string,\n    type: NotificationType,\n    title: string,\n    message: string,\n    actionUrl?: string\n) {\n    const apiKey = process.env.RESEND_API_KEY\n    if (!apiKey) {\n        console.log(`[notify-email] (no RESEND_API_KEY) Would email user ${userId}: ${title}`)\n        return\n    }\n\n    // Fetch user email\n    const user = await db.user.findUnique({\n        where: { id: userId },\n        select: { email: true, name: true },\n    })\n    if (!user?.email) return\n\n    const from = process.env.NOTIFICATION_EMAIL_FROM || 'TutorMe <notifications@tutorme.com>'\n    const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'\n\n    const actionButton = actionUrl\n        ? `<p style=\"margin-top:16px\"><a href=\"${appUrl}${actionUrl}\" style=\"background:#3b82f6;color:white;padding:10px 20px;border-radius:6px;text-decoration:none;display:inline-block\">View Details</a></p>`\n        : ''\n\n    const html = `\n    <div style=\"max-width:480px;margin:0 auto;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif\">\n      <div style=\"padding:24px;background:#f8fafc;border-radius:12px\">\n        <h2 style=\"margin:0 0 8px;color:#1e293b;font-size:18px\">${title}</h2>\n        <p style=\"margin:0;color:#475569;font-size:14px;line-height:1.6\">${message}</p>\n        ${actionButton}\n      </div>\n      <p style=\"text-align:center;color:#94a3b8;font-size:12px;margin-top:16px\">\n        You can <a href=\"${appUrl}/student/settings\" style=\"color:#3b82f6\">manage your notification preferences</a>.\n      </p>\n    </div>\n  `\n\n    try {\n        const res = await fetch('https://api.resend.com/emails', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                Authorization: `Bearer ${apiKey}`,\n            },\n            body: JSON.stringify({\n                from,\n                to: user.email,\n                subject: `${title} ‚Äì TutorMe`,\n                html,\n            }),\n        })\n        if (!res.ok) {\n            const err = await res.text()\n            console.error(`[notify-email] Resend failed:`, res.status, err)\n        }\n    } catch (e) {\n        console.error(`[notify-email] Send failed:`, e)\n    }\n}\n\n// ---- Main Functions ----\n\n/**\n * Send a notification to a single user across all enabled channels.\n */\nexport async function notify(params: NotifyParams) {\n    const { userId, type, title, message, data, actionUrl, force = false } = params\n\n    const channels = await getChannelDecision(userId, type, force)\n\n    let notification = null\n\n    // 1. In-app notification (DB)\n    if (channels.inApp) {\n        notification = await db.notification.create({\n            data: {\n                userId,\n                type,\n                title,\n                message,\n                data: data ?? undefined,\n                actionUrl,\n            },\n        })\n    }\n\n    // 2. Real-time push via SSE\n    if (channels.push) {\n        broadcastToUser(userId, notification ?? { type, title, message, actionUrl, createdAt: new Date() })\n    }\n\n    // 3. Email\n    if (channels.email) {\n        // Fire-and-forget (don't block the response)\n        sendNotificationEmail(userId, type, title, message, actionUrl).catch((e) =>\n            console.error('[notify] Email send error:', e)\n        )\n    }\n\n    return notification\n}\n\n/**\n * Send a notification to multiple users at once.\n */\nexport async function notifyMany(params: NotifyManyParams) {\n    const { userIds, type, title, message, data, actionUrl, force = false } = params\n\n    const results = await Promise.allSettled(\n        userIds.map((userId) =>\n            notify({ userId, type, title, message, data, actionUrl, force })\n        )\n    )\n\n    const succeeded = results.filter((r) => r.status === 'fulfilled').length\n    const failed = results.filter((r) => r.status === 'rejected').length\n\n    return { sent: succeeded, failed, total: userIds.length }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/performance/performance-monitoring.ts"],"sourcesContent":["/**\n * Comprehensive Performance Monitoring System\n * \n * Real-time performance metrics collection with:\n * - Frontend and backend performance tracking\n * - Chinese market specific monitoring\n * - WeChat/DingTalk/SMS alerting integration\n * - Web Vitals and custom metrics\n * - Error tracking and performance budgets\n * \n * Usage:\n *   import { PerformanceMonitor, reportMetric, reportError } from '@/lib/performance/performance-monitoring'\n *   \n *   // Initialize monitor\n *   const monitor = new PerformanceMonitor()\n *   await monitor.initialize()\n *   \n *   // Report custom metric\n *   reportMetric('api_call_duration', 150, { endpoint: '/api/users' })\n *   \n *   // Report error\n *   reportError(new Error('API failed'), { context: 'user_dashboard' })\n */\n\nimport { db } from '@/lib/db'\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface PerformanceMetric {\n  name: string\n  value: number\n  unit: 'ms' | 'bytes' | 'count' | 'percentage'\n  timestamp: number\n  tags?: Record<string, string>\n  userId?: string\n  sessionId?: string\n}\n\nexport interface PerformanceAlert {\n  id: string\n  type: 'error' | 'performance' | 'availability' | 'budget' | 'security'\n  severity: 'critical' | 'warning' | 'info'\n  message: string\n  metric?: string\n  threshold?: number\n  currentValue?: number\n  timestamp: number\n  resolved?: boolean\n  resolvedAt?: Date\n}\n\nexport interface AlertChannel {\n  wechat?: {\n    enabled: boolean\n    webhook?: string\n    templateId?: string\n  }\n  dingtalk?: {\n    enabled: boolean\n    webhook?: string\n  }\n  sms?: {\n    enabled: boolean\n    provider?: 'aliyun' | 'tencent'\n    accessKeyId?: string\n    accessKeySecret?: string\n    signName?: string\n    templateCode?: string\n  }\n  email?: {\n    enabled: boolean\n    recipients?: string[]\n  }\n}\n\nexport interface PerformanceBudget {\n  metric: string\n  threshold: number\n  window: '1m' | '5m' | '15m' | '1h' | '24h'\n  alertOnBreach: boolean\n}\n\nexport interface MonitoringConfig {\n  // Collection settings\n  enableFrontendMonitoring: boolean\n  enableBackendMonitoring: boolean\n  enableRealTimeMetrics: boolean\n  sampleRate: number // 0-1, percentage of requests to monitor\n  \n  // Alerting\n  alerts: AlertChannel\n  alertThresholds: {\n    errorRate: number // percentage\n    responseTime: number // ms\n    availability: number // percentage\n  }\n  \n  // Performance budgets\n  budgets: PerformanceBudget[]\n  \n  // Storage\n  retentionDays: number\n  batchSize: number\n  \n  // China-specific\n  useChinaRegion: boolean\n  chinaCDNMonitoring: boolean\n}\n\n// ============================================================================\n// Metric Storage (In-Memory Buffer)\n// ============================================================================\n\nclass MetricBuffer {\n  private buffer: PerformanceMetric[] = []\n  private maxSize: number\n  private flushInterval: number\n  private flushTimer: NodeJS.Timeout | null = null\n\n  constructor(maxSize: number = 1000, flushInterval: number = 5000) {\n    this.maxSize = maxSize\n    this.flushInterval = flushInterval\n  }\n\n  add(metric: PerformanceMetric): void {\n    this.buffer.push(metric)\n    \n    if (this.buffer.length >= this.maxSize) {\n      this.flush()\n    }\n  }\n\n  async flush(): Promise<void> {\n    if (this.buffer.length === 0) return\n\n    const metrics = [...this.buffer]\n    this.buffer = []\n\n    try {\n      // Store metrics in database\n      await db.$transaction(\n        metrics.map((metric) =>\n          db.performanceMetric.create({\n            data: {\n              name: metric.name,\n              metricValue: metric.value,\n              unit: metric.unit,\n              tags: metric.tags || {},\n              userId: metric.userId,\n              sessionId: metric.sessionId,\n              timestamp: new Date(metric.timestamp),\n            },\n          })\n        )\n      )\n    } catch (error) {\n      console.error('Failed to flush metrics:', error)\n      // Re-add to buffer on failure\n      this.buffer.unshift(...metrics)\n    }\n  }\n\n  start(): void {\n    if (this.flushTimer) return\n    \n    this.flushTimer = setInterval(() => {\n      this.flush()\n    }, this.flushInterval)\n  }\n\n  stop(): void {\n    if (this.flushTimer) {\n      clearInterval(this.flushTimer)\n      this.flushTimer = null\n    }\n    this.flush()\n  }\n\n  getBuffer(): PerformanceMetric[] {\n    return [...this.buffer]\n  }\n}\n\n// ============================================================================\n// Alert Manager\n// ============================================================================\n\nclass AlertManager {\n  private config: AlertChannel\n  private activeAlerts: Map<string, PerformanceAlert> = new Map()\n\n  constructor(config: AlertChannel) {\n    this.config = config\n  }\n\n  /**\n   * Send alert through configured channels\n   */\n  async sendAlert(alert: PerformanceAlert): Promise<void> {\n    // Store alert\n    this.activeAlerts.set(alert.id, alert)\n\n    // Send to database\n    try {\n      const performanceAlertModel = (db as unknown as {\n        performanceAlert?: {\n          create?: (args: {\n            data: {\n              id: string\n              type: PerformanceAlert['type']\n              severity: PerformanceAlert['severity']\n              message: string\n              metric?: string\n              threshold?: number\n              currentValue?: number\n              timestamp: Date\n            }\n          }) => Promise<unknown>\n          update?: (args: {\n            where: { id: string }\n            data: { resolved: boolean; resolvedAt: Date }\n          }) => Promise<unknown>\n        }\n      } | null | undefined)?.performanceAlert\n\n      if (typeof performanceAlertModel?.create === 'function') {\n        await performanceAlertModel.create({\n          data: {\n            id: alert.id,\n            type: alert.type,\n            severity: alert.severity,\n            message: alert.message,\n            metric: alert.metric,\n            threshold: alert.threshold,\n            currentValue: alert.currentValue,\n            timestamp: new Date(alert.timestamp),\n          },\n        })\n      }\n    } catch (error) {\n      console.error('Failed to store alert:', error)\n    }\n\n    // Send through channels\n    const promises: Promise<void>[] = []\n\n    if (this.config.wechat?.enabled && this.config.wechat.webhook) {\n      promises.push(this.sendWeChatAlert(alert))\n    }\n\n    if (this.config.dingtalk?.enabled && this.config.dingtalk.webhook) {\n      promises.push(this.sendDingTalkAlert(alert))\n    }\n\n    if (this.config.sms?.enabled) {\n      promises.push(this.sendSMSAlert(alert))\n    }\n\n    if (this.config.email?.enabled && this.config.email.recipients) {\n      promises.push(this.sendEmailAlert(alert))\n    }\n\n    await Promise.allSettled(promises)\n  }\n\n  /**\n   * Send WeChat alert\n   */\n  private async sendWeChatAlert(alert: PerformanceAlert): Promise<void> {\n    const webhook = this.config.wechat?.webhook\n    if (!webhook) return\n\n    try {\n      const message = {\n        msgtype: 'markdown',\n        markdown: {\n          content: `# ${this.getSeverityEmoji(alert.severity)} ÊÄßËÉΩÂëäË≠¶\\n\\n` +\n                   `**Á±ªÂûã**: ${this.getTypeLabel(alert.type)}\\n` +\n                   `**‰∏•ÈáçÁ®ãÂ∫¶**: ${alert.severity}\\n` +\n                   `**Ê∂àÊÅØ**: ${alert.message}\\n` +\n                   (alert.metric ? `**ÊåáÊ†á**: ${alert.metric}\\n` : '') +\n                   (alert.currentValue !== undefined ? `**ÂΩìÂâçÂÄº**: ${alert.currentValue}\\n` : '') +\n                   (alert.threshold !== undefined ? `**ÈòàÂÄº**: ${alert.threshold}\\n` : '') +\n                   `**Êó∂Èó¥**: ${new Date(alert.timestamp).toLocaleString('zh-CN')}\\n`\n        },\n      }\n\n      await fetch(webhook, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(message),\n      })\n    } catch (error) {\n      console.error('Failed to send WeChat alert:', error)\n    }\n  }\n\n  /**\n   * Send DingTalk alert\n   */\n  private async sendDingTalkAlert(alert: PerformanceAlert): Promise<void> {\n    const webhook = this.config.dingtalk?.webhook\n    if (!webhook) return\n\n    try {\n      const message = {\n        msgtype: 'markdown',\n        markdown: {\n          title: `ÊÄßËÉΩÂëäË≠¶: ${this.getTypeLabel(alert.type)}`,\n          text: `# ${this.getSeverityEmoji(alert.severity)} ÊÄßËÉΩÂëäË≠¶\\n\\n` +\n                `**Á±ªÂûã**: ${this.getTypeLabel(alert.type)}\\n` +\n                `**‰∏•ÈáçÁ®ãÂ∫¶**: ${alert.severity}\\n` +\n                `**Ê∂àÊÅØ**: ${alert.message}\\n` +\n                (alert.metric ? `**ÊåáÊ†á**: ${alert.metric}\\n` : '') +\n                (alert.currentValue !== undefined ? `**ÂΩìÂâçÂÄº**: ${alert.currentValue}\\n` : '') +\n                (alert.threshold !== undefined ? `**ÈòàÂÄº**: ${alert.threshold}\\n` : '') +\n                `**Êó∂Èó¥**: ${new Date(alert.timestamp).toLocaleString('zh-CN')}\\n`\n        },\n      }\n\n      await fetch(webhook, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(message),\n      })\n    } catch (error) {\n      console.error('Failed to send DingTalk alert:', error)\n    }\n  }\n\n  /**\n   * Send SMS alert\n   */\n  private async sendSMSAlert(alert: PerformanceAlert): Promise<void> {\n    const smsConfig = this.config.sms\n    if (!smsConfig?.enabled) return\n\n    // Only send critical alerts via SMS\n    if (alert.severity !== 'critical') return\n\n    try {\n      const message = `[TutorMeÊÄßËÉΩÂëäË≠¶] ${this.getTypeLabel(alert.type)}: ${alert.message}`\n\n      if (smsConfig.provider === 'aliyun') {\n        await this.sendAliyunSMS(message, smsConfig)\n      } else if (smsConfig.provider === 'tencent') {\n        await this.sendTencentSMS(message, smsConfig)\n      }\n    } catch (error) {\n      console.error('Failed to send SMS alert:', error)\n    }\n  }\n\n  /**\n   * Send Aliyun SMS\n   */\n  private async sendAliyunSMS(\n    message: string,\n    config: NonNullable<AlertChannel['sms']>\n  ): Promise<void> {\n    // Implementation would use Aliyun SMS SDK\n    // This is a placeholder - actual implementation requires SDK\n    console.log('Aliyun SMS:', message, config)\n  }\n\n  /**\n   * Send Tencent SMS\n   */\n  private async sendTencentSMS(\n    message: string,\n    config: NonNullable<AlertChannel['sms']>\n  ): Promise<void> {\n    // Implementation would use Tencent SMS SDK\n    // This is a placeholder - actual implementation requires SDK\n    console.log('Tencent SMS:', message, config)\n  }\n\n  /**\n   * Send email alert\n   */\n  private async sendEmailAlert(alert: PerformanceAlert): Promise<void> {\n    const recipients = this.config.email?.recipients\n    if (!recipients || recipients.length === 0) return\n\n    try {\n      // Use existing notification service\n      const { notifyMany } = await import('@/lib/notifications/notify')\n      \n      // Get admin user IDs (simplified - would need proper admin lookup)\n      const admins = await db.user.findMany({\n        where: { role: 'ADMIN' },\n        select: { id: true },\n      })\n\n      await notifyMany({\n        userIds: admins.map((a) => a.id),\n        type: 'system',\n        title: `ÊÄßËÉΩÂëäË≠¶: ${this.getTypeLabel(alert.type)}`,\n        message: alert.message,\n      })\n    } catch (error) {\n      console.error('Failed to send email alert:', error)\n    }\n  }\n\n  private getSeverityEmoji(severity: string): string {\n    switch (severity) {\n      case 'critical':\n        return 'üî¥'\n      case 'warning':\n        return 'üü°'\n      case 'info':\n        return 'üîµ'\n      default:\n        return '‚ö™'\n    }\n  }\n\n  private getTypeLabel(type: string): string {\n    const labels: Record<string, string> = {\n      error: 'ÈîôËØØ',\n      performance: 'ÊÄßËÉΩ',\n      availability: 'ÂèØÁî®ÊÄß',\n      budget: 'È¢ÑÁÆó',\n      security: 'ÂÆâÂÖ®',\n    }\n    return labels[type] || type\n  }\n\n  /**\n   * Resolve alert\n   */\n  async resolveAlert(alertId: string): Promise<void> {\n    const alert = this.activeAlerts.get(alertId)\n    if (!alert) return\n\n    alert.resolved = true\n    alert.resolvedAt = new Date()\n\n    try {\n      const performanceAlertModel = (db as unknown as {\n        performanceAlert?: {\n          update?: (args: {\n            where: { id: string }\n            data: { resolved: boolean; resolvedAt: Date }\n          }) => Promise<unknown>\n        }\n      } | null | undefined)?.performanceAlert\n\n      if (typeof performanceAlertModel?.update === 'function') {\n        await performanceAlertModel.update({\n          where: { id: alertId },\n          data: {\n            resolved: true,\n            resolvedAt: new Date(),\n          },\n        })\n      }\n    } catch (error) {\n      console.error('Failed to resolve alert:', error)\n    }\n\n    this.activeAlerts.delete(alertId)\n  }\n}\n\n// ============================================================================\n// Performance Monitor\n// ============================================================================\n\nclass PerformanceMonitor {\n  private config: MonitoringConfig\n  private metricBuffer: MetricBuffer\n  private alertManager: AlertManager\n  private initialized: boolean = false\n\n  constructor(config?: Partial<MonitoringConfig>) {\n    this.config = {\n      enableFrontendMonitoring: true,\n      enableBackendMonitoring: true,\n      enableRealTimeMetrics: true,\n      sampleRate: 1.0,\n      alerts: {\n        wechat: {\n          enabled: !!process.env.WECHAT_WEBHOOK_URL,\n          webhook: process.env.WECHAT_WEBHOOK_URL,\n        },\n        dingtalk: {\n          enabled: !!process.env.DINGTALK_WEBHOOK_URL,\n          webhook: process.env.DINGTALK_WEBHOOK_URL,\n        },\n        sms: {\n          enabled: !!process.env.SMS_PROVIDER,\n          provider: process.env.SMS_PROVIDER as 'aliyun' | 'tencent',\n          accessKeyId: process.env.SMS_ACCESS_KEY_ID,\n          accessKeySecret: process.env.SMS_ACCESS_KEY_SECRET,\n          signName: process.env.SMS_SIGN_NAME,\n          templateCode: process.env.SMS_TEMPLATE_CODE,\n        },\n        email: {\n          enabled: true,\n        },\n      },\n      alertThresholds: {\n        errorRate: 5, // 5%\n        responseTime: 1000, // 1s\n        availability: 99, // 99%\n      },\n      budgets: [],\n      retentionDays: 30,\n      batchSize: 100,\n      useChinaRegion: true,\n      chinaCDNMonitoring: true,\n      ...config,\n    }\n\n    this.metricBuffer = new MetricBuffer(this.config.batchSize)\n    this.alertManager = new AlertManager(this.config.alerts)\n  }\n\n  /**\n   * Initialize monitor\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) return\n\n    // Start metric buffer\n    this.metricBuffer.start()\n\n    // Setup frontend monitoring if in browser\n    if (typeof window !== 'undefined' && this.config.enableFrontendMonitoring) {\n      this.setupFrontendMonitoring()\n    }\n\n    // Setup budget checking\n    if (this.config.budgets.length > 0) {\n      this.startBudgetChecker()\n    }\n\n    this.initialized = true\n  }\n\n  /**\n   * Setup frontend monitoring\n   */\n  private setupFrontendMonitoring(): void {\n    if (typeof window === 'undefined') return\n\n    // Monitor Web Vitals\n    if ('PerformanceObserver' in window) {\n      this.observeWebVitals()\n    }\n\n    // Monitor API calls\n    this.interceptFetch()\n\n    // Monitor errors\n    window.addEventListener('error', (event) => {\n      this.reportError(event.error || new Error(event.message), {\n        filename: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n      })\n    })\n\n    window.addEventListener('unhandledrejection', (event) => {\n      this.reportError(\n        event.reason instanceof Error ? event.reason : new Error(String(event.reason)),\n        { type: 'unhandledrejection' }\n      )\n    })\n  }\n\n  /**\n   * Observe Web Vitals\n   */\n  private observeWebVitals(): void {\n    if (typeof window === 'undefined') return\n\n    try {\n      // LCP\n      const lcpObserver = new PerformanceObserver((list) => {\n        const entries = list.getEntries()\n        const lastEntry = entries[entries.length - 1] as any\n        const value = lastEntry.renderTime || lastEntry.loadTime\n        this.reportMetric('lcp', value, 'ms')\n      })\n      lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] })\n\n      // FID\n      const fidObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries() as any[]) {\n          this.reportMetric('fid', entry.processingStart - entry.startTime, 'ms')\n        }\n      })\n      fidObserver.observe({ entryTypes: ['first-input'] })\n\n      // CLS\n      let clsValue = 0\n      const clsObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries() as any[]) {\n          if (!(entry as any).hadRecentInput) {\n            clsValue += (entry as any).value\n          }\n        }\n        this.reportMetric('cls', clsValue, 'count')\n      })\n      clsObserver.observe({ entryTypes: ['layout-shift'] })\n    } catch (error) {\n      console.warn('Web Vitals observation failed:', error)\n    }\n  }\n\n  /**\n   * Intercept fetch for API monitoring\n   */\n  private interceptFetch(): void {\n    if (typeof window === 'undefined') return\n\n    const originalFetch = window.fetch\n    window.fetch = async (...args) => {\n      const startTime = performance.now()\n      const url = typeof args[0] === 'string' ? args[0] : args[0].url\n\n      try {\n        const response = await originalFetch(...args)\n        const duration = performance.now() - startTime\n\n        this.reportMetric('api_call_duration', duration, 'ms', {\n          endpoint: url,\n          method: args[1]?.method || 'GET',\n          status: response.status.toString(),\n        })\n\n        return response\n      } catch (error) {\n        const duration = performance.now() - startTime\n        this.reportMetric('api_call_error', duration, 'ms', {\n          endpoint: url,\n          error: error instanceof Error ? error.message : String(error),\n        })\n        throw error\n      }\n    }\n  }\n\n  /**\n   * Start budget checker\n   */\n  private startBudgetChecker(): void {\n    setInterval(async () => {\n      for (const budget of this.config.budgets) {\n        await this.checkBudget(budget)\n      }\n    }, 60000) // Check every minute\n  }\n\n  /**\n   * Check performance budget\n   */\n  private async checkBudget(budget: PerformanceBudget): Promise<void> {\n    try {\n      // Get average metric value for the window\n      const windowMs = this.getWindowMs(budget.window)\n      const cutoff = new Date(Date.now() - windowMs)\n\n      const avg = await db.performanceMetric.aggregate({\n        where: {\n          name: budget.metric,\n          timestamp: { gte: cutoff },\n        },\n        _avg: {\n          metricValue: true,\n        },\n      })\n\n      const avgValue = avg._avg.metricValue\n      if (avgValue && avgValue > budget.threshold && budget.alertOnBreach) {\n        await this.alertManager.sendAlert({\n          id: `budget-${budget.metric}-${Date.now()}`,\n          type: 'budget',\n          severity: 'warning',\n          message: `ÊÄßËÉΩÈ¢ÑÁÆóË∂ÖÈôê: ${budget.metric} Ë∂ÖËøáÈòàÂÄº ${budget.threshold}`,\n          metric: budget.metric,\n          threshold: budget.threshold,\n          currentValue: avgValue,\n          timestamp: Date.now(),\n        })\n      }\n    } catch (error) {\n      console.error('Budget check failed:', error)\n    }\n  }\n\n  private getWindowMs(window: string): number {\n    const multipliers: Record<string, number> = {\n      '1m': 60000,\n      '5m': 300000,\n      '15m': 900000,\n      '1h': 3600000,\n      '24h': 86400000,\n    }\n    return multipliers[window] || 60000\n  }\n\n  /**\n   * Report metric\n   */\n  reportMetric(\n    name: string,\n    value: number,\n    unit: 'ms' | 'bytes' | 'count' | 'percentage' = 'ms',\n    tags?: Record<string, string>\n  ): void {\n    // Apply sample rate\n    if (Math.random() > this.config.sampleRate) return\n\n    const metric: PerformanceMetric = {\n      name,\n      value,\n      unit,\n      timestamp: Date.now(),\n      tags,\n    }\n\n    this.metricBuffer.add(metric)\n\n    // Check thresholds\n    this.checkThresholds(name, value)\n  }\n\n  /**\n   * Check alert thresholds\n   */\n  private checkThresholds(name: string, value: number): void {\n    const thresholds = this.config.alertThresholds\n\n    if (name === 'api_call_duration' && value > thresholds.responseTime) {\n      this.alertManager.sendAlert({\n        id: `threshold-${name}-${Date.now()}`,\n        type: 'performance',\n        severity: value > thresholds.responseTime * 2 ? 'critical' : 'warning',\n        message: `APIÂìçÂ∫îÊó∂Èó¥Ë∂ÖÈôê: ${name} = ${value}ms`,\n        metric: name,\n        threshold: thresholds.responseTime,\n        currentValue: value,\n        timestamp: Date.now(),\n      })\n    }\n  }\n\n  /**\n   * Report error\n   */\n  reportError(error: Error, context?: Record<string, any>): void {\n    const errorMetric: PerformanceMetric = {\n      name: 'error',\n      value: 1,\n      unit: 'count',\n      timestamp: Date.now(),\n      tags: {\n        message: error.message,\n        stack: error.stack?.substring(0, 200) || '',\n        ...context,\n      },\n    }\n\n    this.metricBuffer.add(errorMetric)\n\n    // Send critical error alert\n    this.alertManager.sendAlert({\n      id: `error-${Date.now()}-${Math.random()}`,\n      type: 'error',\n      severity: 'critical',\n      message: `ÈîôËØØ: ${error.message}`,\n      timestamp: Date.now(),\n    })\n  }\n\n  /**\n   * Report security event (payment alerts, access attempts, role violations).\n   * Enterprise security event tracking for compliance (GDPR, PIPL, PRC).\n   */\n  reportSecurityEvent(\n    eventType: string,\n    tags?: Record<string, string>\n  ): void {\n    this.reportMetric('security_event', 1, 'count', {\n      eventType,\n      ...tags,\n    })\n  }\n\n  /**\n   * Get metrics summary\n   */\n  async getMetricsSummary(\n    metricName: string,\n    window: '1h' | '24h' | '7d' = '24h'\n  ): Promise<{\n    avg: number\n    min: number\n    max: number\n    p95: number\n    p99: number\n    count: number\n  }> {\n    const windowMs = {\n      '1h': 3600000,\n      '24h': 86400000,\n      '7d': 604800000,\n    }[window]\n\n    const cutoff = new Date(Date.now() - windowMs)\n\n    const metrics = await db.performanceMetric.findMany({\n      where: {\n        name: metricName,\n        timestamp: { gte: cutoff },\n      },\n      orderBy: { metricValue: 'asc' },\n    })\n\n    if (metrics.length === 0) {\n      return { avg: 0, min: 0, max: 0, p95: 0, p99: 0, count: 0 }\n    }\n\n    const values = metrics.map((m) => m.metricValue).sort((a, b) => a - b)\n    const sum = values.reduce((a, b) => a + b, 0)\n\n    return {\n      avg: sum / values.length,\n      min: values[0],\n      max: values[values.length - 1],\n      p95: values[Math.floor(values.length * 0.95)],\n      p99: values[Math.floor(values.length * 0.99)],\n      count: values.length,\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  async cleanup(): Promise<void> {\n    this.metricBuffer.stop()\n    this.initialized = false\n  }\n}\n\n// ============================================================================\n// Global Instance\n// ============================================================================\n\nlet globalMonitor: PerformanceMonitor | null = null\n\n/**\n * Get or create global monitor instance\n */\nexport function getPerformanceMonitor(): PerformanceMonitor {\n  if (!globalMonitor) {\n    globalMonitor = new PerformanceMonitor()\n  }\n  return globalMonitor\n}\n\n/**\n * Initialize global monitor\n */\nexport async function initializeMonitoring(\n  config?: Partial<MonitoringConfig>\n): Promise<void> {\n  const monitor = config ? new PerformanceMonitor(config) : getPerformanceMonitor()\n  await monitor.initialize()\n  globalMonitor = monitor\n}\n\n/**\n * Report metric (convenience function)\n */\nexport function reportMetric(\n  name: string,\n  value: number,\n  unit: 'ms' | 'bytes' | 'count' | 'percentage' = 'ms',\n  tags?: Record<string, string>\n): void {\n  const monitor = getPerformanceMonitor()\n  monitor.reportMetric(name, value, unit, tags)\n}\n\n/**\n * Report error (convenience function)\n */\nexport function reportError(error: Error, context?: Record<string, any>): void {\n  const monitor = getPerformanceMonitor()\n  monitor.reportError(error, context)\n}\n\n// ============================================================================\n// Database Schema Types (should match Prisma schema)\n// ============================================================================\n\n// Note: These types should match your Prisma schema\n// You may need to add these models to your schema.prisma:\n/*\nmodel PerformanceMetric {\n  id        String   @id @default(cuid())\n  name      String\n  value     Float\n  unit      String\n  tags      Json?\n  userId    String?\n  sessionId String?\n  timestamp DateTime @default(now())\n\n  @@index([name])\n  @@index([timestamp])\n  @@index([userId])\n}\n\nmodel PerformanceAlert {\n  id           String    @id @default(cuid())\n  type         String\n  severity     String\n  message      String\n  metric       String?\n  threshold    Float?\n  currentValue Float?\n  timestamp    DateTime  @default(now())\n  resolved     Boolean   @default(false)\n  resolvedAt   DateTime?\n\n  @@index([type])\n  @@index([severity])\n  @@index([resolved])\n  @@index([timestamp])\n}\n*/\n\n/**\n * Parent dashboard performance monitor (alias for global monitor with parent context).\n * Tracks parent-specific metrics: responseTime, cacheHitRate, throughput.\n */\nexport const ParentDashboardPerformanceMonitor = PerformanceMonitor\nexport const parentDashboardPerformanceMonitor = getPerformanceMonitor\n\n// ============================================================================\n// Default Export\n// ============================================================================\n\nexport default PerformanceMonitor\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1185, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/monitoring/sentry-setup.ts"],"sourcesContent":["/**\n * Enterprise-grade Sentry monitoring for global platform\n * - Global error tracking, Core Web Vitals, PII filtering, GDPR/PIPL compliant\n */\n\nimport * as Sentry from '@sentry/nextjs'\nimport { reportMetric, reportError } from '@/lib/performance/performance-monitoring'\n\nexport function getSentryInitOptions(overrides?: Record<string, unknown>) {\n  const base: Parameters<typeof Sentry.init>[0] = {\n    dsn: process.env.SENTRY_DSN ?? process.env.NEXT_PUBLIC_SENTRY_DSN,\n    environment: process.env.NODE_ENV ?? 'development',\n    tracesSampleRate: 0.1,\n    profilesSampleRate: 0.1,\n    normalizeDepth: 10,\n    autoSessionTracking: true,\n    maxBreadcrumbs: 50,\n    maxValueLength: 10000,\n    beforeSend(event) {\n      if (event.extra) {\n        const extra = event.extra as Record<string, unknown>\n        if ('password' in extra) delete extra.password\n        if ('creditCard' in extra) delete extra.creditCard\n        if ('token' in extra) delete extra.token\n        if ('apiKey' in extra) delete extra.apiKey\n      }\n      const t = event.exception?.values?.[0]?.type\n      if (t === 'ChunkLoadError' || t === 'Loading chunk failed') return null\n      if (event.message?.includes?.('loading') || event.message?.includes?.('chunk')) return null\n      return event\n    },\n    beforeBreadcrumb(breadcrumb) {\n      if (breadcrumb.category === 'console' && breadcrumb.data?.arguments) {\n        const args = breadcrumb.data.arguments as unknown[]\n        if (args.some((a) => typeof a === 'string' && a.toLowerCase().includes('password'))) return null\n      }\n      return breadcrumb\n    },\n  }\n  return { ...base, ...overrides } as Parameters<typeof Sentry.init>[0]\n}\n\nexport const globalErrorHandler = {\n  handleError(error: Error, context?: Record<string, unknown>) {\n    Sentry.captureException(error, { extra: context, tags: { source: 'global_handler', region: 'global' } })\n    try {\n      reportError(error, context)\n    } catch {\n      /* ignore */\n    }\n  },\n  handleWarning(warning: string, context?: Record<string, unknown>) {\n    Sentry.captureMessage(warning, 'warning', { extra: context, tags: { source: 'global_handler', region: 'global' } })\n  },\n  addBreadcrumb(breadcrumb: { message: string; data?: Record<string, unknown>; category?: string }) {\n    Sentry.addBreadcrumb({\n      category: breadcrumb.category ?? 'default',\n      message: breadcrumb.message,\n      data: breadcrumb.data,\n      timestamp: Date.now() / 1000,\n    })\n  },\n}\n\nfunction captureMetric(name: string, value: number, unit: string) {\n  try {\n    const m = (Sentry as { metrics?: { distribution?: (n: string, v: number, o?: object) => void; count?: (n: string, v?: number) => void } }).metrics\n    if (unit === 'count' && typeof m?.count === 'function') m.count(name, value)\n    else if (typeof m?.distribution === 'function') m.distribution(name, value, { unit: 'millisecond' })\n    else reportMetric(name, value, unit === 'count' ? 'count' : 'ms')\n  } catch {\n    reportMetric(name, value, unit === 'count' ? 'count' : 'ms')\n  }\n}\n\nexport const globalPerformanceMonitor = {\n  trackApiEndpoint(endpoint: string, responseTime: number, errorCount: number) {\n    captureMetric('api_response_time', responseTime, 'ms')\n    if (errorCount > 0) captureMetric('api_error_count', errorCount, 'count')\n  },\n  trackInteraction(type: string, element: string, value?: unknown) {\n    Sentry.addBreadcrumb({ category: 'interaction', message: `${type} on ${element}`, data: value as Record<string, unknown>, timestamp: Date.now() / 1000 })\n  },\n  trackCacheHit(cacheKey: string, hit: boolean) {\n    reportMetric('cache_hit_rate', hit ? 1 : 0, 'count', { cacheKey, type: hit ? 'HIT' : 'MISS' })\n  },\n  trackWebVital(name: string, value: number) {\n    captureMetric(`web_vital_${name.toLowerCase()}`, value, name === 'CLS' ? 'none' : 'ms')\n  },\n  trackLongTask(_startTime: number, duration: number) {\n    captureMetric('long_task_duration', duration, 'ms')\n  },\n}\n\nexport function setupClientMonitoring() {\n  if (typeof window === 'undefined') return\n  window.addEventListener('error', (event) => {\n    if (event.error?.message?.includes?.('loading') || event.error?.message?.includes?.('chunk') || event.message?.includes?.('loading') || event.message?.includes?.('chunk')) return\n    globalErrorHandler.handleError(event.error ?? new Error(event.message), { filename: event.filename, lineno: event.lineno, colno: event.colno, userAgent: navigator.userAgent, timestamp: Date.now() })\n  })\n  window.addEventListener('unhandledrejection', (event) => {\n    const err = event.reason instanceof Error ? event.reason : new Error(String(event.reason))\n    if (err.message?.includes?.('loading') || err.message?.includes?.('chunk')) return\n    globalErrorHandler.handleError(err, { type: 'unhandledrejection', timestamp: Date.now() })\n  })\n  if ('PerformanceObserver' in window) {\n    try {\n      const o = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          const e = entry as PerformanceEntry & { value?: number; renderTime?: number; loadTime?: number }\n          const value = e.value ?? e.renderTime ?? e.loadTime ?? e.duration ?? 0\n          if (value > 0) {\n            const name = (e.name || e.entryType || '').toUpperCase()\n            const vital = name.includes('LCP') || name.includes('LARGEST') ? 'LCP' : name.includes('FID') || name.includes('FIRST-INPUT') ? 'FID' : name.includes('CLS') || name.includes('LAYOUT') ? 'CLS' : name.includes('TTFB') ? 'TTFB' : name.includes('FCP') ? 'FCP' : name\n            globalPerformanceMonitor.trackWebVital(vital, value)\n          }\n        }\n      })\n      o.observe({ entryTypes: ['largest-contentful-paint', 'first-input', 'layout-shift', 'navigation'] })\n    } catch {\n      /* ignore */\n    }\n    try {\n      const o2 = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          const e = entry as PerformanceEntry\n          globalPerformanceMonitor.trackLongTask(e.startTime, e.duration)\n        }\n      })\n      o2.observe({ entryTypes: ['longtask'] })\n    } catch {\n      /* ignore */\n    }\n  }\n}\n\nexport { Sentry }\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1318, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/sentry.edge.config.ts"],"sourcesContent":["import * as Sentry from '@sentry/nextjs'\nimport { getSentryInitOptions } from '@/lib/monitoring/sentry-setup'\n\nSentry.init({\n  ...getSentryInitOptions(),\n  tracesSampleRate: 0.1,\n})\n"],"names":[],"mappings":";AAAA;AACA;;;AAEA,0PAAW,CAAC;IACV,GAAG,IAAA,kPAAoB,GAAE;IACzB,kBAAkB;AACpB"}},
    {"offset": {"line": 1331, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/instrumentation.ts"],"sourcesContent":[";globalThis[\"__SENTRY_SERVER_MODULES__\"] = {\"@aws-sdk/client-s3\":\"^3.994.0\",\"@aws-sdk/s3-request-presigner\":\"^3.994.0\",\"@daily-co/daily-js\":\"^0.87.0\",\"@dnd-kit/core\":\"^6.3.1\",\"@dnd-kit/sortable\":\"^10.0.0\",\"@dnd-kit/utilities\":\"^3.2.2\",\"@next-auth/prisma-adapter\":\"^1.0.7\",\"@prisma/client\":\"^5.22.0\",\"@radix-ui/react-avatar\":\"^1.1.11\",\"@radix-ui/react-checkbox\":\"^1.3.3\",\"@radix-ui/react-dialog\":\"^1.1.15\",\"@radix-ui/react-dropdown-menu\":\"^2.1.16\",\"@radix-ui/react-label\":\"^2.1.8\",\"@radix-ui/react-popover\":\"^1.1.15\",\"@radix-ui/react-progress\":\"^1.1.8\",\"@radix-ui/react-radio-group\":\"^1.3.8\",\"@radix-ui/react-scroll-area\":\"^1.2.10\",\"@radix-ui/react-select\":\"^2.2.6\",\"@radix-ui/react-slider\":\"^1.3.6\",\"@radix-ui/react-slot\":\"^1.2.4\",\"@radix-ui/react-switch\":\"^1.2.6\",\"@radix-ui/react-tabs\":\"^1.1.13\",\"@radix-ui/react-tooltip\":\"^1.2.8\",\"@react-three/drei\":\"^10.7.7\",\"@react-three/fiber\":\"^9.5.0\",\"@sentry/nextjs\":\"^10.39.0\",\"@tanstack/react-query\":\"^5.90.21\",\"@types/jsonwebtoken\":\"^9.0.10\",\"@types/three\":\"^0.182.0\",\"@types/ws\":\"^8.18.1\",\"bcryptjs\":\"^3.0.3\",\"class-variance-authority\":\"^0.7.1\",\"clsx\":\"^2.1.1\",\"cmdk\":\"^1.1.1\",\"date-fns\":\"^4.1.0\",\"drizzle-orm\":\"^0.38.0\",\"fabric\":\"^7.2.0\",\"framer-motion\":\"^12.34.0\",\"immer\":\"^11.1.4\",\"ioredis\":\"^5.9.2\",\"jose\":\"^6.1.3\",\"jsonwebtoken\":\"^9.0.3\",\"jspdf\":\"^4.2.0\",\"jspdf-autotable\":\"^5.0.7\",\"lucide-react\":\"^0.563.0\",\"mammoth\":\"^1.11.0\",\"mathjax\":\"^4.1.1\",\"nanoid\":\"^5.1.6\",\"next\":\"^16.1.6\",\"next-auth\":\"^4.24.13\",\"next-intl\":\"^4.8.3\",\"ollama\":\"^0.6.3\",\"openai\":\"^6.19.0\",\"pg\":\"^8.13.0\",\"pdf-lib\":\"^1.17.1\",\"pdf-parse\":\"^2.4.5\",\"pdfjs-dist\":\"^4.2.67\",\"plotly.js-dist\":\"^3.4.0\",\"prisma\":\"^5.22.0\",\"react\":\"^18\",\"react-day-picker\":\"^9.13.2\",\"react-dom\":\"^18\",\"react-resizable-panels\":\"^4.6.4\",\"recharts\":\"^3.7.0\",\"redis\":\"^5.11.0\",\"server-only\":\"^0.0.1\",\"socket.io\":\"^4.8.3\",\"socket.io-client\":\"^4.8.3\",\"sonner\":\"^2.0.7\",\"swagger-ui-react\":\"^5.31.2\",\"tailwind-merge\":\"^3.4.0\",\"tailwindcss-animate\":\"^1.0.7\",\"tesseract.js\":\"^7.0.0\",\"three\":\"^0.182.0\",\"tldraw\":\"^4.4.0\",\"unpdf\":\"^1.4.0\",\"xlsx\":\"^0.18.5\",\"y-websocket\":\"^3.0.0\",\"yjs\":\"^13.6.29\",\"zod\":\"^4.3.6\",\"zustand\":\"^5.0.11\",\"@axe-core/playwright\":\"^4.11.1\",\"@playwright/test\":\"^1.49.0\",\"@testing-library/dom\":\"^10.4.0\",\"@testing-library/jest-dom\":\"^6.6.3\",\"@testing-library/react\":\"^16.0.1\",\"@types/bcryptjs\":\"^2.4.6\",\"@types/node\":\"^20.19.33\",\"@types/pg\":\"^8.11.0\",\"drizzle-kit\":\"^0.30.0\",\"@types/react\":\"^18.3.28\",\"@types/react-dom\":\"^18.3.7\",\"@types/swagger-ui-react\":\"^5.18.0\",\"dotenv\":\"^17.3.1\",\"eslint\":\"^9\",\"eslint-config-next\":\"^16.1.6\",\"eslint-config-prettier\":\"^10\",\"jsdom\":\"^25.0.1\",\"postcss\":\"^8\",\"tailwindcss\":\"^3.4.1\",\"tsx\":\"^4.21.0\",\"typescript\":\"^5.9.3\",\"vitest\":\"^2.1.8\"};globalThis[\"_sentryNextJsVersion\"] = \"16.1.6\";import * as Sentry from '@sentry/nextjs'\n\nexport async function register() {\n  if (process.env.NEXT_RUNTIME === 'nodejs') {\n    await import('./sentry.server.config')\n  }\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    await import('./sentry.edge.config')\n  }\n}\n\nexport const onRequestError = Sentry.captureRequestError\n"],"names":[],"mappings":";;;;;;AAAyqF;AAAxqF,UAAU,CAAC,4BAA4B,GAAG;IAAC,sBAAqB;IAAW,iCAAgC;IAAW,sBAAqB;IAAU,iBAAgB;IAAS,qBAAoB;IAAU,sBAAqB;IAAS,6BAA4B;IAAS,kBAAiB;IAAU,0BAAyB;IAAU,4BAA2B;IAAS,0BAAyB;IAAU,iCAAgC;IAAU,yBAAwB;IAAS,2BAA0B;IAAU,4BAA2B;IAAS,+BAA8B;IAAS,+BAA8B;IAAU,0BAAyB;IAAS,0BAAyB;IAAS,wBAAuB;IAAS,0BAAyB;IAAS,wBAAuB;IAAU,2BAA0B;IAAS,qBAAoB;IAAU,sBAAqB;IAAS,kBAAiB;IAAW,yBAAwB;IAAW,uBAAsB;IAAU,gBAAe;IAAW,aAAY;IAAU,YAAW;IAAS,4BAA2B;IAAS,QAAO;IAAS,QAAO;IAAS,YAAW;IAAS,eAAc;IAAU,UAAS;IAAS,iBAAgB;IAAW,SAAQ;IAAU,WAAU;IAAS,QAAO;IAAS,gBAAe;IAAS,SAAQ;IAAS,mBAAkB;IAAS,gBAAe;IAAW,WAAU;IAAU,WAAU;IAAS,UAAS;IAAS,QAAO;IAAU,aAAY;IAAW,aAAY;IAAS,UAAS;IAAS,UAAS;IAAU,MAAK;IAAU,WAAU;IAAU,aAAY;IAAS,cAAa;IAAU,kBAAiB;IAAS,UAAS;IAAU,SAAQ;IAAM,oBAAmB;IAAU,aAAY;IAAM,0BAAyB;IAAS,YAAW;IAAS,SAAQ;IAAU,eAAc;IAAS,aAAY;IAAS,oBAAmB;IAAS,UAAS;IAAS,oBAAmB;IAAU,kBAAiB;IAAS,uBAAsB;IAAS,gBAAe;IAAS,SAAQ;IAAW,UAAS;IAAS,SAAQ;IAAS,QAAO;IAAU,eAAc;IAAS,OAAM;IAAW,OAAM;IAAS,WAAU;IAAU,wBAAuB;IAAU,oBAAmB;IAAU,wBAAuB;IAAU,6BAA4B;IAAS,0BAAyB;IAAU,mBAAkB;IAAS,eAAc;IAAY,aAAY;IAAU,eAAc;IAAU,gBAAe;IAAW,oBAAmB;IAAU,2BAA0B;IAAU,UAAS;IAAU,UAAS;IAAK,sBAAqB;IAAU,0BAAyB;IAAM,SAAQ;IAAU,WAAU;IAAK,eAAc;IAAS,OAAM;IAAU,cAAa;IAAS,UAAS;AAAQ;AAAE,UAAU,CAAC,uBAAuB,GAAG;;AAEzpF,eAAe;IACpB;;IAGA,wCAAyC;QACvC;IACF;AACF;AAEO,MAAM,iBAAiB,yQAA0B"}}]
}