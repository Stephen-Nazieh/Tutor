;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d694470f-fbe8-e3dc-ff73-0a13ddb81097")}catch(e){}}();
module.exports=[407166,e=>e.a(async(t,a)=>{try{var r=e.i(620971),o=e.i(384030),i=e.i(908286),n=e.i(738597);e.i(688768);var s=e.i(257357),d=e.i(909105),l=e.i(997103),u=e.i(841195),p=t([o,n]);[o,n]=p.then?(await p)():p;let h=u.z.object({name:u.z.string().min(1).optional(),strokes:u.z.array(u.z.any()).optional(),shapes:u.z.array(u.z.any()).optional(),texts:u.z.array(u.z.any()).optional(),images:u.z.array(u.z.any()).optional(),viewState:u.z.object({scale:u.z.number().optional(),panX:u.z.number().optional(),panY:u.z.number().optional()}).optional(),backgroundColor:u.z.string().optional(),backgroundStyle:u.z.enum(["solid","grid","dots","lines"]).optional(),backgroundImage:u.z.string().optional()}),c=(0,o.withAuth)(async(e,t,a)=>{let o=await (0,i.getParamAsync)(a?.params,"id"),l=await (0,i.getParamAsync)(a?.params,"pageId");if(!o||!l)return r.NextResponse.json({error:"Whiteboard ID and page ID required"},{status:400});let u=t.user.id;try{let[e]=await n.drizzleDb.select().from(s.whiteboard).where((0,d.and)((0,d.eq)(s.whiteboard.id,o),(0,d.eq)(s.whiteboard.tutorId,u),(0,d.isNull)(s.whiteboard.deletedAt))).limit(1);if(!e)return r.NextResponse.json({error:"Whiteboard not found"},{status:404});let[t]=await n.drizzleDb.select().from(s.whiteboardPage).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,l),(0,d.eq)(s.whiteboardPage.whiteboardId,o))).limit(1);if(!t)return r.NextResponse.json({error:"Page not found"},{status:404});return r.NextResponse.json({page:t})}catch(e){return console.error("Fetch page error:",e),r.NextResponse.json({error:"Failed to fetch page"},{status:500})}},{role:"TUTOR"}),w=(0,o.withAuth)(async(e,t,a)=>{let o=await (0,i.getParamAsync)(a?.params,"id"),l=await (0,i.getParamAsync)(a?.params,"pageId");if(!o||!l)return r.NextResponse.json({error:"Whiteboard ID and page ID required"},{status:400});let u=t.user.id;try{let t=await e.json(),a=h.safeParse(t);if(!a.success)return r.NextResponse.json({error:"Invalid request",details:a.error.format()},{status:400});let i=a.data,[p]=await n.drizzleDb.select().from(s.whiteboard).where((0,d.and)((0,d.eq)(s.whiteboard.id,o),(0,d.eq)(s.whiteboard.tutorId,u),(0,d.isNull)(s.whiteboard.deletedAt))).limit(1);if(!p)return r.NextResponse.json({error:"Whiteboard not found"},{status:404});let[c]=await n.drizzleDb.select({id:s.whiteboardPage.id}).from(s.whiteboardPage).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,l),(0,d.eq)(s.whiteboardPage.whiteboardId,o))).limit(1);if(!c)return r.NextResponse.json({error:"Page not found"},{status:404});let w={};void 0!==i.name&&(w.name=i.name),void 0!==i.strokes&&(w.strokes=i.strokes),void 0!==i.shapes&&(w.shapes=i.shapes),void 0!==i.texts&&(w.texts=i.texts),void 0!==i.images&&(w.images=i.images),void 0!==i.viewState&&(w.viewState=i.viewState),void 0!==i.backgroundColor&&(w.backgroundColor=i.backgroundColor),void 0!==i.backgroundStyle&&(w.backgroundStyle=i.backgroundStyle),void 0!==i.backgroundImage&&(w.backgroundImage=i.backgroundImage),await n.drizzleDb.update(s.whiteboardPage).set(w).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,l),(0,d.eq)(s.whiteboardPage.whiteboardId,o))),await n.drizzleDb.update(s.whiteboard).set({updatedAt:new Date}).where((0,d.eq)(s.whiteboard.id,o));let[g]=await n.drizzleDb.select().from(s.whiteboardPage).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,l),(0,d.eq)(s.whiteboardPage.whiteboardId,o))).limit(1);return r.NextResponse.json({page:g})}catch(e){return console.error("Update page error:",e),r.NextResponse.json({error:"Failed to update page"},{status:500})}},{role:"TUTOR"}),g=(0,o.withAuth)(async(e,t,a)=>{let o=await (0,i.getParamAsync)(a?.params,"id"),u=await (0,i.getParamAsync)(a?.params,"pageId");if(!o||!u)return r.NextResponse.json({error:"Whiteboard ID and page ID required"},{status:400});let p=t.user.id;try{let[e]=await n.drizzleDb.select().from(s.whiteboard).where((0,d.and)((0,d.eq)(s.whiteboard.id,o),(0,d.eq)(s.whiteboard.tutorId,p),(0,d.isNull)(s.whiteboard.deletedAt))).limit(1);if(!e)return r.NextResponse.json({error:"Whiteboard not found"},{status:404});let[t]=await n.drizzleDb.select({id:s.whiteboardPage.id}).from(s.whiteboardPage).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,u),(0,d.eq)(s.whiteboardPage.whiteboardId,o))).limit(1);if(!t)return r.NextResponse.json({error:"Page not found"},{status:404});if((await n.drizzleDb.select().from(s.whiteboardPage).where((0,d.eq)(s.whiteboardPage.whiteboardId,o))).length<=1)return r.NextResponse.json({error:"Cannot delete the last page"},{status:400});await n.drizzleDb.delete(s.whiteboardPage).where((0,d.and)((0,d.eq)(s.whiteboardPage.id,u),(0,d.eq)(s.whiteboardPage.whiteboardId,o)));let a=await n.drizzleDb.select().from(s.whiteboardPage).where((0,d.eq)(s.whiteboardPage.whiteboardId,o)).orderBy((0,l.asc)(s.whiteboardPage.order));return await n.drizzleDb.transaction(async e=>{for(let t=0;t<a.length;t++)await e.update(s.whiteboardPage).set({order:t}).where((0,d.eq)(s.whiteboardPage.id,a[t].id))}),r.NextResponse.json({message:"Page deleted"})}catch(e){return console.error("Delete page error:",e),r.NextResponse.json({error:"Failed to delete page"},{status:500})}},{role:"TUTOR"});e.s(["DELETE",0,g,"GET",0,c,"PUT",0,w]),a()}catch(e){a(e)}},!1),790163,e=>e.a(async(t,a)=>{try{var r=e.i(78315),o=e.i(586961),i=e.i(196657),n=e.i(899733),s=e.i(233979),d=e.i(631683),l=e.i(840960),u=e.i(711373),p=e.i(699699),h=e.i(521140),c=e.i(205260),w=e.i(500249),g=e.i(431740),b=e.i(82608),m=e.i(635207),R=e.i(193695);e.i(708038);var f=e.i(447430),P=e.i(407166),v=t([P]);[P]=v.then?(await v)():v;let E=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/whiteboards/[id]/pages/[pageId]/route",pathname:"/api/whiteboards/[id]/pages/[pageId]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/whiteboards/[id]/pages/[pageId]/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:I}=E;function y(){return(0,i.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(e,t,a){E.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/whiteboards/[id]/pages/[pageId]/route";r=r.replace(/\/index$/,"")||"/";let i=await E.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:P,params:v,nextConfig:y,parsedUrl:x,isDraftMode:z,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,resolvedPathname:q,clientReferenceManifest:D,serverActionsManifest:T}=i,k=(0,l.normalizeAppPath)(r),S=!!(A.dynamicRoutes[k]||A.routes[q]),j=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,x,!1):t.end("This page could not be found"),null);if(S&&!z){let e=!!A.routes[q],t=A.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await j();throw new R.NoFallbackError}}let O=null;!S||E.isDev||z||(O=q,O="/index"===O?"/":O);let U=!0===E.isDev||!S,_=S&&!U;T&&D&&(0,d.setManifestsSingleton)({page:r,clientReferenceManifest:D,serverActionsManifest:T});let H=e.method||"GET",M=(0,s.getTracer)(),F=M.getActiveScopeSpan(),K={params:v,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,o)=>E.onRequestError(e,t,r,o,I)},sharedContext:{buildId:P}},W=new u.NodeNextRequest(e),$=new u.NodeNextResponse(t),B=p.NextRequestAdapter.fromNodeNextRequest(W,(0,p.signalFromNodeResponse)(t));try{let i=async e=>E.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=a.get("next.route");if(o){let t=`${H} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${r}`)}),d=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:o})=>{try{if(!d&&N&&C&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await i(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let s=K.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let l=K.renderOpts.collectedTags;if(!S)return await (0,w.sendResponse)(W,$,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(r.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,o=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:N})},!1,I),t}},p=await E.handleResponse({req:e,nextConfig:y,cacheKey:O,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:d});if(!S)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",N?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),z&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,g.fromNodeOutgoingHttpHeaders)(p.value.headers);return d&&S||h.delete(m.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,b.getCacheControlHeader)(p.cacheControl)),await (0,w.sendResponse)(W,$,new Response(p.value.body,{headers:h,status:p.value.status||200})),null};F?await l(F):await M.withPropagatedContext(e.headers,()=>M.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:N})},!1,I),S)throw t;return await (0,w.sendResponse)(W,$,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>y,"routeModule",()=>E,"serverHooks",()=>I,"workAsyncStorage",()=>z,"workUnitAsyncStorage",()=>A]),a()}catch(e){a(e)}},!1)];

//# debugId=d694470f-fbe8-e3dc-ff73-0a13ddb81097
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_16f29b9a._.js.map