;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f4d4ab23-f663-fe7a-24fa-0a322b381d8e")}catch(e){}}();
module.exports=[848380,e=>e.a(async(t,a)=>{try{var r=e.i(738597),s=e.i(320947),i=t([r]);[r]=i.then?(await i)():i;let o=new Map,l=new class{queryLog=[];slowQueryThreshold=100;maxLogSize=1e3;cacheHits=0;cacheMisses=0;logQuery(e,t,a,r){let s={query:e.substring(0,200),duration:t,timestamp:Date.now(),operation:a,table:r};this.queryLog.push(s),this.queryLog.length>this.maxLogSize&&this.queryLog.shift(),t>this.slowQueryThreshold&&console.warn(`[Slow Query] ${t}ms: ${e.substring(0,100)}...`)}recordCacheHit(){this.cacheHits++}recordCacheMiss(){this.cacheMisses++}getCacheMetrics(){let e=this.cacheHits+this.cacheMisses;return{hits:this.cacheHits,misses:this.cacheMisses,hitRate:e>0?this.cacheHits/e*100:0,size:o.size}}getSlowQueries(e=this.slowQueryThreshold,t=10){return this.queryLog.filter(t=>t.duration>e).sort((e,t)=>t.duration-e.duration).slice(0,t)}getMostFrequentQueries(e=10){let t=new Map;for(let e of this.queryLog){let a=e.query,r=t.get(a);r?(r.count++,r.totalDuration+=e.duration):t.set(a,{count:1,totalDuration:e.duration})}return Array.from(t.entries()).map(([e,t])=>({query:e,count:t.count,avgDuration:t.totalDuration/t.count})).sort((e,t)=>t.count-e.count).slice(0,e)}async getHealthStatus(){let t=[],a="healthy",i=Date.now(),n=!1,o=0;try{await r.drizzleDb.execute(s.sql`SELECT 1`),o=Date.now()-i,n=!0,o>500&&(t.push(`High database latency: ${o}ms`),a="degraded")}catch(e){t.push("Database connection failed"),a="unhealthy"}let l=!1;try{let t=process.env.REDIS_URL;if(t){let{Redis:a}=await e.A(443460),r=new a(t,{maxRetriesPerRequest:1});await r.ping(),await r.quit(),l=!0}else l=!0}catch(e){t.push("Cache connection failed"),"healthy"===a&&(a="degraded")}let u=this.queryLog.filter(e=>e.timestamp>Date.now()-6e4&&e.duration>this.slowQueryThreshold).length;return u>10&&(t.push(`${u} slow queries in the last minute`),"healthy"===a&&(a="degraded")),{status:a,database:n,cache:l,latency:o,slowQueries:u,issues:t}}getStats(){let e=Date.now(),t=e-6e4,a=e-3e5,r=this.queryLog.filter(e=>e.timestamp>t),s=this.queryLog.filter(e=>e.timestamp>a);return{queries:{last1Minute:r.length,last5Minutes:s.length,avgDuration:r.length>0?r.reduce((e,t)=>e+t.duration,0)/r.length:0,maxDuration:r.length>0?Math.max(...r.map(e=>e.duration)):0},cache:this.getCacheMetrics(),slowQueries:this.getSlowQueries(100,5)}}reset(){this.queryLog=[],this.cacheHits=0,this.cacheMisses=0}};async function n(){let e=await l.getHealthStatus(),t=l.getStats();return{...e,stats:{queriesPerMinute:t.queries.last1Minute,averageQueryTime:Math.round(t.queries.avgDuration),cacheHitRate:Math.round(t.cache.hitRate)}}}e.s(["dbMonitor",0,l,"getHealthCheck",()=>n]),a()}catch(e){a(e)}},!1),283756,e=>e.a(async(t,a)=>{try{var r=e.i(620971),s=e.i(320947),i=e.i(848380),n=e.i(738597),o=e.i(384030),l=t([i,n,o]);async function u(t){try{let a="true"===t.nextUrl.searchParams.get("detailed"),o=await (0,i.getHealthCheck)();if(!a)return r.NextResponse.json({status:o.status,timestamp:new Date().toISOString(),uptime:process.uptime()},{status:"healthy"===o.status||"degraded"===o.status?200:503});let l=null,u=null;try{let e=await n.drizzleDb.execute(s.sql`SELECT version() as version`),t=e?.rows??(Array.isArray(e)?e:[]);l=t[0]?.version??e[0]?.version}catch(e){}try{let t=process.env.REDIS_URL;if(t){let{Redis:a}=await e.A(443460),r=new a(t,{maxRetriesPerRequest:1});u=await r.info("server"),await r.quit()}}catch(e){}return r.NextResponse.json({status:o.status,timestamp:new Date().toISOString(),uptime:process.uptime(),node:{version:process.version,platform:process.platform,memory:process.memoryUsage()},services:{database:{connected:o.database,latency:o.latency,version:l},cache:{connected:o.cache,type:u?"redis":"in-memory",redisVersion:u?u.match(/redis_version:(.+)/)?.[1]:null}},performance:o.stats,issues:o.issues,stats:i.dbMonitor.getStats()},{status:"unhealthy"===o.status?503:200})}catch(e){return console.error("[Health Check] Error:",e),r.NextResponse.json({status:"unhealthy",timestamp:new Date().toISOString(),error:"Health check failed"},{status:503})}}async function c(e){try{return i.dbMonitor.reset(),r.NextResponse.json({message:"Metrics reset"})}catch(e){return r.NextResponse.json({error:"Failed to reset metrics"},{status:500})}}[i,n,o]=l.then?(await l)():l;let h=(0,o.withAuth)(c,{role:"ADMIN"});e.s(["GET",()=>u,"POST",0,h,"dynamic",0,"force-dynamic"]),a()}catch(e){a(e)}},!1),654054,e=>e.a(async(t,a)=>{try{var r=e.i(78315),s=e.i(586961),i=e.i(196657),n=e.i(899733),o=e.i(233979),l=e.i(631683),u=e.i(840960),c=e.i(711373),h=e.i(699699),d=e.i(521140),p=e.i(205260),m=e.i(500249),g=e.i(431740),y=e.i(82608),w=e.i(635207),R=e.i(193695);e.i(708038);var v=e.i(447430),f=e.i(283756),E=t([f]);[f]=E.then?(await E)():E;let _=new r.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/health/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:S,workUnitAsyncStorage:A,serverHooks:q}=_;function C(){return(0,i.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:A})}async function x(e,t,a){_.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/health/route";r=r.replace(/\/index$/,"")||"/";let i=await _.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:f,params:E,nextConfig:C,parsedUrl:x,isDraftMode:S,prerenderManifest:A,routerServerContext:q,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,resolvedPathname:D,clientReferenceManifest:T,serverActionsManifest:P}=i,H=(0,u.normalizeAppPath)(r),N=!!(A.dynamicRoutes[H]||A.routes[D]),O=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,x,!1):t.end("This page could not be found"),null);if(N&&!S){let e=!!A.routes[D],t=A.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await O();throw new R.NoFallbackError}}let k=null;!N||_.isDev||S||(k=D,k="/index"===k?"/":k);let I=!0===_.isDev||!N,L=N&&!I;P&&T&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:T,serverActionsManifest:P});let U=e.method||"GET",j=(0,o.getTracer)(),$=j.getActiveScopeSpan(),K={params:E,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,s)=>_.onRequestError(e,t,r,s,q)},sharedContext:{buildId:f}},Q=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),z=h.NextRequestAdapter.fromNodeNextRequest(Q,(0,h.signalFromNodeResponse)(t));try{let i=async e=>_.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=j.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=a.get("next.route");if(s){let t=`${U} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${r}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var o,u;let c=async({previousCacheEntry:s})=>{try{if(!l&&M&&b&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await i(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let o=K.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let u=K.renderOpts.collectedTags;if(!N)return await (0,m.sendResponse)(Q,F,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[w.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,s=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:M})},!1,q),t}},h=await _.handleResponse({req:e,nextConfig:C,cacheKey:k,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:l});if(!N)return null;if((null==h||null==(o=h.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(u=h.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",M?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,g.fromNodeOutgoingHttpHeaders)(h.value.headers);return l&&N||d.delete(w.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,y.getCacheControlHeader)(h.cacheControl)),await (0,m.sendResponse)(Q,F,new Response(h.value.body,{headers:d,status:h.value.status||200})),null};$?await u($):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${r}`,kind:o.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},u))}catch(t){if(t instanceof R.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:M})},!1,q),N)throw t;return await (0,m.sendResponse)(Q,F,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>C,"routeModule",()=>_,"serverHooks",()=>q,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>A]),a()}catch(e){a(e)}},!1),443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=f4d4ab23-f663-fe7a-24fa-0a322b381d8e
//# sourceMappingURL=%5Broot-of-the-server%5D__33dc945d._.js.map