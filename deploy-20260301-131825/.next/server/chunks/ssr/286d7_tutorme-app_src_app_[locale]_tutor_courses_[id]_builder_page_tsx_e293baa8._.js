;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="e4fc2dcf-0354-8ad6-2112-a8c201d90323")}catch(e){}}();
module.exports=[298506,a=>{"use strict";var b=a.i(260576),c=a.i(454069),d=a.i(52028),e=a.i(741510),f=a.i(88684),g=a.i(113098),h=a.i(414030),i=a.i(342621),j=a.i(957512),k=a.i(479680),l=a.i(290385),m=a.i(192730),n=a.i(102355),o=a.i(846438),p=a.i(494176),q=a.i(899622),r=a.i(263805),s=a.i(763485),t=a.i(868606),u=a.i(333340),v=a.i(226886),w=a.i(143650),x=a.i(294532),y=a.i(802386),y=y,z=a.i(342202),A=a.i(102710);function B({courseId:a}){let[c,d]=(0,e.useState)(null),[h,i]=(0,e.useState)(""),[j,l]=(0,e.useState)(""),[n,q]=(0,e.useState)(!1),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)(!1),[J,K]=(0,e.useState)(!1),[L,M]=(0,e.useState)("ai");(0,e.useEffect)(()=>{N()},[a]);let N=async()=>{q(!0);try{let b=await fetch(`/api/tutor/courses/${a}/pitch`,{credentials:"include"});if(b.ok){let a=await b.json();d(a.pitch),i(a.pitch||""),l(a.pitch||"")}}catch{}finally{q(!1)}},O=async()=>{C(!0);try{let b=await fetch("/api/csrf",{credentials:"include"}),c=await b.json().catch(()=>({})),e=c?.token??null,f=await fetch(`/api/tutor/courses/${a}/pitch`,{method:"POST",headers:{"Content-Type":"application/json",...e?{"X-CSRF-Token":e}:{}},credentials:"include"});if(!f.ok){let a=await f.json();throw Error(a.error||"Failed to generate pitch")}let g=await f.json();d(g.pitch),i(g.pitch),l(g.pitch),M("ai"),o.toast.success("Course pitch generated successfully!")}catch(a){o.toast.error(a instanceof Error?a.message:"Failed to generate pitch")}finally{C(!1)}},P=async()=>{if(!j.trim())return void o.toast.error("Please enter a pitch");E(!0);try{let b=await fetch("/api/csrf",{credentials:"include"}),c=await b.json().catch(()=>({})),e=c?.token??null;if(!(await fetch(`/api/tutor/courses/${a}/pitch`,{method:"PATCH",headers:{"Content-Type":"application/json",...e?{"X-CSRF-Token":e}:{}},credentials:"include",body:JSON.stringify({pitch:j})})).ok)throw Error("Failed to save");d(j),i(j),o.toast.success("Course pitch saved!")}catch{o.toast.error("Failed to save pitch")}finally{E(!1)}},Q=async()=>{K(!0);try{let b=await fetch("/api/csrf",{credentials:"include"}),c=await b.json().catch(()=>({})),e=c?.token??null;if(!(await fetch(`/api/tutor/courses/${a}/pitch`,{method:"PATCH",headers:{"Content-Type":"application/json",...e?{"X-CSRF-Token":e}:{}},credentials:"include",body:JSON.stringify({pitch:h})})).ok)throw Error("Failed to save");d(h),l(h),I(!1),o.toast.success("Course pitch saved!")}catch{o.toast.error("Failed to save pitch")}finally{K(!1)}},R=async()=>{try{let b=await fetch("/api/csrf",{credentials:"include"}),c=await b.json().catch(()=>({})),e=c?.token??null;if(!(await fetch(`/api/tutor/courses/${a}/pitch`,{method:"DELETE",headers:e?{"X-CSRF-Token":e}:{},credentials:"include"})).ok)throw Error("Failed to delete");d(null),i(""),l(""),o.toast.success("Course pitch deleted")}catch{o.toast.error("Failed to delete pitch")}},S=a=>a.replace(/^## (.*$)/gim,'<h2 class="text-xl font-bold mt-6 mb-3 text-slate-900">$1</h2>').replace(/^### (.*$)/gim,'<h3 class="text-lg font-semibold mt-4 mb-2 text-slate-800">$1</h3>').replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^- (.*$)/gim,'<li class="ml-4 mb-1">$1</li>').replace(/(<li.*<\/li>\n?)+/g,'<ul class="list-disc mb-4">$&</ul>').replace(/\n\n/g,"<br/><br/>");return n?(0,b.jsx)(g.Card,{className:"mb-6",children:(0,b.jsx)(g.CardContent,{className:"py-8 text-center",children:(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin mx-auto text-muted-foreground"})})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(g.Card,{className:(0,p.cn)("mb-6",c&&"border-green-200 bg-green-50/30"),children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(v.Sparkles,{className:"h-5 w-5 text-amber-500"}),"Course Pitch"]}),(0,b.jsx)(g.CardDescription,{children:"Create a compelling marketing description that persuades students to enroll"})]}),c&&(0,b.jsx)(u.Badge,{variant:"default",className:"bg-green-100 text-green-800",children:"Saved"})]})}),(0,b.jsx)(g.CardContent,{children:c?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-white rounded-lg p-4 max-h-[300px] overflow-y-auto border",children:(0,b.jsx)("div",{className:"prose prose-slate max-w-none",dangerouslySetInnerHTML:{__html:S(c)}})}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>G(!0),className:"gap-2",children:[(0,b.jsx)(x.Eye,{className:"h-4 w-4"}),"Full Preview"]}),(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>I(!0),className:"gap-2",children:[(0,b.jsx)(y.default,{className:"h-4 w-4"}),"Edit"]}),(0,b.jsxs)(f.Button,{variant:"outline",onClick:O,disabled:B,className:"gap-2",children:[B?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(z.Wand2,{className:"h-4 w-4"}),"Regenerate with AI"]}),(0,b.jsxs)(f.Button,{variant:"ghost",onClick:R,className:"gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,b.jsx)(w.Trash2,{className:"h-4 w-4"}),"Delete"]})]}),(0,b.jsx)("div",{className:"rounded-lg border bg-amber-50 border-amber-200 p-4",children:(0,b.jsxs)("p",{className:"text-sm text-amber-800",children:[(0,b.jsx)("strong",{children:"ðŸ’¡ Tip:"})," This pitch will be displayed on the course page for students to read. A compelling pitch can significantly increase enrollment rates!"]})})]}):(0,b.jsxs)(t.Tabs,{value:L,onValueChange:a=>M(a),children:[(0,b.jsxs)(t.TabsList,{className:"mb-4",children:[(0,b.jsxs)(t.TabsTrigger,{value:"ai",className:"gap-2",children:[(0,b.jsx)(z.Wand2,{className:"h-4 w-4"}),"AI Generate"]}),(0,b.jsxs)(t.TabsTrigger,{value:"manual",className:"gap-2",children:[(0,b.jsx)(A.PenLine,{className:"h-4 w-4"}),"Write My Own"]})]}),(0,b.jsx)(t.TabsContent,{value:"ai",children:(0,b.jsxs)("div",{className:"text-center py-8 bg-muted/30 rounded-lg",children:[(0,b.jsx)(z.Wand2,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Generate with AI"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:"Let AI create a persuasive course description that highlights what students will learn, who it's for, and why they should enroll."}),(0,b.jsx)(f.Button,{onClick:O,disabled:B,size:"lg",className:"gap-2",children:B?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.Sparkles,{className:"h-4 w-4"}),"Generate Course Pitch"]})})]})}),(0,b.jsx)(t.TabsContent,{value:"manual",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(s.Textarea,{placeholder:"Write your course pitch here... Describe what students will learn, who this course is for, and why they should enroll.",value:j,onChange:a=>l(a.target.value),rows:8,className:"resize-none"}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(f.Button,{onClick:P,disabled:D||!j.trim(),className:"gap-2",children:[D&&(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsx)(m.Save,{className:"h-4 w-4"}),"Save Pitch"]})})]})})]})})]}),(0,b.jsx)(r.Dialog,{open:F,onOpenChange:G,children:(0,b.jsxs)(r.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(r.DialogHeader,{children:[(0,b.jsx)(r.DialogTitle,{children:"Course Pitch Preview"}),(0,b.jsx)(r.DialogDescription,{children:"This is how students will see your course pitch"})]}),(0,b.jsx)("div",{className:"prose prose-slate max-w-none",children:(0,b.jsx)("div",{dangerouslySetInnerHTML:{__html:S(c||"")}})})]})}),(0,b.jsx)(r.Dialog,{open:H,onOpenChange:I,children:(0,b.jsxs)(r.DialogContent,{className:"max-w-3xl max-h-[90vh]",children:[(0,b.jsxs)(r.DialogHeader,{children:[(0,b.jsx)(r.DialogTitle,{children:"Edit Course Pitch"}),(0,b.jsx)(r.DialogDescription,{children:"Make adjustments to your course pitch"})]}),(0,b.jsx)(s.Textarea,{value:h,onChange:a=>i(a.target.value),rows:20,className:"font-mono text-sm"}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),(0,b.jsxs)(f.Button,{onClick:Q,disabled:J,className:"gap-2",children:[J&&(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsx)(m.Save,{className:"h-4 w-4"}),"Save Changes"]})]})]})})]})}let C={beginner:0,intermediate:1,advanced:2};function D({courseId:a}){let[c,r]=(0,e.useState)(null),[s,t]=(0,e.useState)(!0),[u,v]=(0,e.useState)(!1),[w,x]=(0,e.useState)(!0),[y,z]=(0,e.useState)(null),[A,D]=(0,e.useState)([]),E=(0,e.useRef)(null),F=(0,e.useCallback)(async()=>{if(a){t(!0);try{let b=await fetch(`/api/tutor/courses/${a}`,{credentials:"include"});if(b.ok){let a=await b.json();r(a.course),x(a.course?.isLiveOnline??!0)}let c=await fetch(`/api/tutor/courses/${a}/curriculum`,{credentials:"include"});if(c.ok){let a=await c.json();Array.isArray(a.modules)&&a.modules.length>0?z(a.modules):z(null)}}catch{}finally{t(!1)}}},[a]);(0,e.useEffect)(()=>{F()},[F]);let G=async()=>{let b=!w;x(b),v(!0);try{let c=await fetch("/api/csrf",{credentials:"include"}),d=await c.json().catch(()=>({})),e=d?.token??null;(await fetch(`/api/tutor/courses/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",...e&&{"X-CSRF-Token":e}},credentials:"include",body:JSON.stringify({isLiveOnline:b})})).ok?(o.toast.success(b?"Course is now online":"Course is now offline"),r(a=>a?{...a,isLiveOnline:b}:null)):(x(!b),o.toast.error("Failed to update availability"))}catch{x(!b),o.toast.error("Failed to update availability")}finally{v(!1)}};if(!a)return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:(0,b.jsxs)(g.Card,{className:"max-w-md w-full",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(i.BookOpen,{className:"h-5 w-5"}),"Course Builder"]}),(0,b.jsx)(g.CardDescription,{children:"Select a course to edit its curriculum. Open a course from the Course Catalogue or from your dashboard to use the builder."})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)(f.Button,{asChild:!0,className:"w-full",children:(0,b.jsx)(d.default,{href:"/curriculum",children:"Open Course Catalogue"})})})]})});let H=async(b,c)=>{v(!0);try{let e=await fetch("/api/csrf",{credentials:"include"}),f=await e.json().catch(()=>({})),g=f?.token??null,h=await fetch(`/api/tutor/courses/${a}/curriculum`,{method:"PUT",headers:{"Content-Type":"application/json",...g&&{"X-CSRF-Token":g}},credentials:"include",body:JSON.stringify({modules:b,developmentMode:c?.developmentMode??"single",previewDifficulty:c?.previewDifficulty??"all"})});if(h.ok){var d;let a=await h.json();o.toast.success(`Curriculum saved â€” ${a.moduleCount} modules, ${a.lessonCount} lessons`);let b=(d=a.variants,Array.isArray(d)?d.filter(a=>!!a&&"object"==typeof a&&("beginner"===a.difficulty||"intermediate"===a.difficulty||"advanced"===a.difficulty)&&"string"==typeof a.batchId&&"string"==typeof a.batchName&&"string"==typeof a.joinLink).sort((a,b)=>C[a.difficulty]-C[b.difficulty]):[]);b.length>0?(D(b),o.toast.success(`Adaptive variants ready: ${b.map(a=>a.difficulty).join(", ")}`)):D([])}else{let a=await h.json().catch(()=>({}));o.toast.error(a.error??"Failed to save curriculum")}}catch{o.toast.error("Failed to save curriculum")}finally{v(!1)}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b sticky top-0 z-10",children:(0,b.jsx)("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",asChild:!0,children:(0,b.jsx)(d.default,{href:"/tutor/my-page?tab=drafts",children:(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:s?"Loading...":c?.name??"Course Builder 2.0"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,b.jsx)(d.default,{href:"/tutor/my-page?tab=drafts",className:"hover:text-blue-600 hover:underline",children:"â† Back to Work in Progress"}),u&&(0,b.jsx)("span",{className:"ml-2 text-blue-600",children:"â€¢ Saving..."})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 pr-4 border-r",children:[(0,b.jsx)(j.Radio,{className:(0,p.cn)("h-4 w-4",w?"text-green-500":"text-gray-400")}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:w?"Online":"Offline"}),(0,b.jsx)("button",{type:"button",onClick:G,disabled:u||s,className:(0,p.cn)("relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",w?"bg-green-500":"bg-gray-200",(u||s)&&"opacity-50 cursor-not-allowed"),children:(0,b.jsx)("span",{className:(0,p.cn)("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",w?"translate-x-6":"translate-x-1")})})]}),(0,b.jsxs)(f.Button,{variant:"default",className:"gap-2",onClick:()=>E.current?.save(),disabled:u,children:[u?(0,b.jsx)(k.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(m.Save,{className:"w-4 h-4"}),"Save Course"]}),c&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.PublishStatusBadge,{isPublished:c.isPublished}),(0,b.jsx)(f.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(d.default,{href:`/tutor/courses/${a}`,children:[(0,b.jsx)(l.Settings,{className:"w-4 h-4 mr-2"}),"Settings"]})})]})]})]})})}),(0,b.jsxs)("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 py-6",children:[A.length>0&&(0,b.jsxs)(g.Card,{className:"mb-4 border-emerald-200 bg-emerald-50/40",children:[(0,b.jsxs)(g.CardHeader,{className:"pb-2 pt-4",children:[(0,b.jsx)(g.CardTitle,{className:"text-sm",children:"Adaptive Variant Join Links"}),(0,b.jsx)(g.CardDescription,{children:"Share the correct link with students for each difficulty level."})]}),(0,b.jsx)(g.CardContent,{className:"space-y-2 pb-4",children:A.map(a=>(0,b.jsxs)("div",{className:"rounded-md border bg-white p-2.5",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-xs font-medium capitalize",children:a.difficulty}),(0,b.jsx)("p",{className:"truncate text-[11px] text-muted-foreground",children:a.batchName})]}),(0,b.jsx)(f.Button,{type:"button",size:"sm",variant:"outline",className:"h-7 px-2 text-xs",onClick:async()=>{try{await navigator.clipboard.writeText(a.joinLink),o.toast.success(`${a.difficulty} join link copied`)}catch{o.toast.error("Failed to copy link")}},children:"Copy Link"})]}),(0,b.jsx)("p",{className:"mt-1 break-all text-[11px] text-muted-foreground",children:a.joinLink})]},a.batchId))})]}),s?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin text-blue-500"})}):(0,b.jsx)(n.CourseBuilder,{ref:E,courseId:a,courseName:c?.name,initialModules:y??void 0,onSave:H}),a&&(0,b.jsx)(B,{courseId:a})]})]})}function E(){let a=(0,c.useParams)(),d=a?.id??null;return(0,b.jsx)(D,{courseId:d})}a.s(["default",()=>E],298506)}];

//# debugId=e4fc2dcf-0354-8ad6-2112-a8c201d90323
//# sourceMappingURL=286d7_tutorme-app_src_app_%5Blocale%5D_tutor_courses_%5Bid%5D_builder_page_tsx_e293baa8._.js.map