{
  "version": 3,
  "sources": [],
  "debugId": "88b8bba3-d6ed-0c00-94af-e11d376aa2b9",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/gamification/activity-log.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/gamification/constants.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/gamification/service.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/gamification/badges.ts"],"sourcesContent":["/**\n * Activity Log Service\n *\n * Tracks user activities for analytics and retention insights (Drizzle ORM)\n */\n\nimport crypto from 'crypto'\nimport { eq, and, gte, lte, inArray, desc, sql } from 'drizzle-orm'\nimport { drizzleDb } from '@/lib/db/drizzle'\nimport { userActivityLog } from '@/lib/db/schema'\n\nexport const ACTIVITY_EVENTS = {\n  // XP & Leveling\n  XP_EARNED: 'xp_earned',\n  LEVEL_UP: 'level_up',\n\n  // Streaks\n  STREAK_UPDATED: 'streak_updated',\n  STREAK_BROKEN: 'streak_broken',\n\n  // Worlds & Missions\n  WORLD_UNLOCK: 'world_unlock',\n  MISSION_START: 'mission_start',\n  MISSION_COMPLETE: 'mission_complete',\n  MISSION_ABANDON: 'mission_abandon',\n\n  // Skills\n  CONFIDENCE_MILESTONE: 'confidence_milestone',\n  SKILL_IMPROVEMENT: 'skill_improvement',\n\n  // AI Tutor\n  AI_SESSION_START: 'ai_session_start',\n  AI_SESSION_END: 'ai_session_end',\n  PERSONALITY_SWITCH: 'personality_switch',\n\n  // Learning\n  LESSON_COMPLETE: 'lesson_complete',\n  QUIZ_COMPLETE: 'quiz_complete',\n\n  // Subscription\n  SUBSCRIPTION_UPGRADE: 'subscription_upgrade',\n  SUBSCRIPTION_DOWNGRADE: 'subscription_downgrade',\n\n  // Engagement\n  DAILY_LOGIN: 'daily_login',\n  QUEST_COMPLETE: 'quest_complete',\n} as const\n\nexport type ActivityEvent = (typeof ACTIVITY_EVENTS)[keyof typeof ACTIVITY_EVENTS]\n\n/**\n * Log a user activity (stored in action column)\n */\nexport async function logActivity(\n  userId: string,\n  eventType: ActivityEvent | string,\n  metadata?: Record<string, unknown>\n) {\n  try {\n    await drizzleDb.insert(userActivityLog).values({\n      id: crypto.randomUUID(),\n      userId,\n      action: eventType,\n      metadata: metadata ?? {},\n    })\n  } catch (error) {\n    console.error('Failed to log activity:', error)\n  }\n}\n\n/**\n * Get user's recent activities\n */\nexport async function getRecentActivities(\n  userId: string,\n  limit: number = 20,\n  eventTypes?: string[]\n) {\n  return drizzleDb\n    .select()\n    .from(userActivityLog)\n    .where(\n      eventTypes?.length\n        ? and(eq(userActivityLog.userId, userId), inArray(userActivityLog.action, eventTypes))\n        : eq(userActivityLog.userId, userId)\n    )\n    .orderBy(desc(userActivityLog.createdAt))\n    .limit(limit)\n}\n\n/**\n * Get activity counts for analytics\n */\nexport async function getActivityCounts(\n  userId: string,\n  startDate: Date,\n  endDate: Date\n) {\n  const rows = await drizzleDb\n    .select({\n      action: userActivityLog.action,\n      count: sql<number>`count(*)::int`,\n    })\n    .from(userActivityLog)\n    .where(\n      and(\n        eq(userActivityLog.userId, userId),\n        gte(userActivityLog.createdAt, startDate),\n        lte(userActivityLog.createdAt, endDate)\n      )\n    )\n    .groupBy(userActivityLog.action)\n\n  const result: Record<string, number> = {}\n  for (const row of rows) {\n    result[row.action] = row.count\n  }\n  return result\n}\n\n/**\n * Get user's learning streak history\n */\nexport async function getStreakHistory(userId: string, days: number = 30) {\n  const startDate = new Date()\n  startDate.setDate(startDate.getDate() - days)\n\n  return drizzleDb\n    .select()\n    .from(userActivityLog)\n    .where(\n      and(\n        eq(userActivityLog.userId, userId),\n        inArray(userActivityLog.action, ['daily_login', 'streak_updated', 'streak_broken']),\n        gte(userActivityLog.createdAt, startDate)\n      )\n    )\n    .orderBy(userActivityLog.createdAt)\n}\n\n/**\n * Calculate engagement score (0-100)\n */\nexport async function calculateEngagementScore(userId: string): Promise<number> {\n  const last7Days = new Date()\n  last7Days.setDate(last7Days.getDate() - 7)\n\n  const activities = await getActivityCounts(userId, last7Days, new Date())\n\n  let score = 0\n  score += Math.min(30, (activities['daily_login'] || 0) * 5)\n  score += Math.min(40, (activities['mission_complete'] || 0) * 10)\n  score += Math.min(20, (activities['ai_session_end'] || 0) * 5)\n  score += Math.min(10, (activities['skill_improvement'] || 0) * 2)\n\n  return Math.min(100, score)\n}\n","// XP required for each level (exponential growth)\nexport const XP_LEVELS: Record<number, number> = {\n    1: 0,\n    2: 200,\n    3: 500,\n    4: 1000,\n    5: 1800,\n    6: 3000,\n    7: 4600,\n    8: 6600,\n    9: 9100,\n    10: 12100,\n    11: 15600,\n    12: 19600,\n    13: 24100,\n    14: 29100,\n    15: 34600,\n    16: 40600,\n    17: 47100,\n    18: 54100,\n    19: 61600,\n    20: 69600,\n}\n\n// XP rewards for different actions\nexport const XP_REWARDS = {\n    COMPLETE_MISSION: 50,\n    PERFECT_QUIZ: 20,\n    DAILY_LOGIN: 10,\n    STREAK_3_DAYS: 50,\n    STREAK_7_DAYS: 150,\n    STREAK_30_DAYS: 500,\n    SPEAKING_PRACTICE: 30,\n    AI_CONVERSATION: 40,\n    COMPLETE_LESSON: 40,\n    FIRST_MISSION: 100,\n}\n\n// Avatar personalities with Socratic balance\nexport const AVATAR_PERSONALITIES = {\n    friendly_mentor: {\n        id: 'friendly_mentor',\n        name: 'Friendly Mentor',\n        description: 'Warm, supportive, and encouraging',\n        tone: 'warm and supportive',\n        usesEmojis: true,\n        correctionStyle: 'gentle',\n        encouragement: 'frequent',\n        socraticBalance: 0.6,\n        voiceStyle: 'encouraging',\n        examplePhrases: {\n            greeting: \"Hey there! I'm so excited to learn with you today!\",\n            correction: \"Almost perfect! Here's a slightly smoother way to say that:\",\n            encouragement: \"You're doing amazing! I can see your confidence growing!\",\n            socraticPrompt: \"That's a great start! What do you think would happen if...?\",\n        },\n    },\n    strict_coach: {\n        id: 'strict_coach',\n        name: 'Strict Coach',\n        description: 'Professional, direct, and disciplined',\n        tone: 'professional and direct',\n        usesEmojis: false,\n        correctionStyle: 'immediate',\n        encouragement: 'achievement-based',\n        socraticBalance: 0.4,\n        voiceStyle: 'authoritative',\n        examplePhrases: {\n            greeting: \"Let's begin. Today's focus is clear communication.\",\n            correction: \"Correction: Use present perfect with 'for' + duration.\",\n            encouragement: \"Good. Your accuracy improved by 15% this week.\",\n            socraticPrompt: \"Consider this: what is the core issue in your sentence?\",\n        },\n    },\n    corporate_trainer: {\n        id: 'corporate_trainer',\n        name: 'Corporate Trainer',\n        description: 'Business-focused and performance-oriented',\n        tone: 'business professional',\n        usesEmojis: false,\n        correctionStyle: 'constructive',\n        encouragement: 'performance-focused',\n        socraticBalance: 0.5,\n        voiceStyle: 'professional',\n        examplePhrases: {\n            greeting: \"Welcome. Let's work on your professional communication skills.\",\n            correction: \"In a business context, consider this phrasing instead:\",\n            encouragement: \"Your professional articulation is showing measurable improvement.\",\n            socraticPrompt: \"From a stakeholder perspective, how would you frame this?\",\n        },\n    },\n    funny_teacher: {\n        id: 'funny_teacher',\n        name: 'Funny Teacher',\n        description: 'Light, humorous, and engaging',\n        tone: 'light and humorous',\n        usesEmojis: true,\n        correctionStyle: 'playful',\n        encouragement: 'enthusiastic',\n        socraticBalance: 0.7,\n        voiceStyle: 'friendly',\n        examplePhrases: {\n            greeting: \"Ready to level up your English? Let's make some grammar magic!\",\n            correction: \"Oops! Let's give that sentence a little makeover!\",\n            encouragement: \"Boom! You're crushing it! High five!\",\n            socraticPrompt: \"Ooh, interesting! But what if we looked at it this way...?\",\n        },\n    },\n    calm_professor: {\n        id: 'calm_professor',\n        name: 'Calm Professor',\n        description: 'Patient, thoughtful, and explanatory',\n        tone: 'patient and thoughtful',\n        usesEmojis: false,\n        correctionStyle: 'explanatory',\n        encouragement: 'steady',\n        socraticBalance: 0.8,\n        voiceStyle: 'calm',\n        examplePhrases: {\n            greeting: \"Welcome. Take your time, and let's explore this together.\",\n            correction: \"I see your thought process. Let's refine it gently:\",\n            encouragement: \"Your progress is steady and meaningful. Well done.\",\n            socraticPrompt: \"That's an interesting approach. What led you to that conclusion?\",\n        },\n    },\n} as const\n\nexport type AvatarPersonality = keyof typeof AVATAR_PERSONALITIES\n","/**\n * Gamification Service\n *\n * Handles XP, Level, Streak, and Skill Score calculations (Drizzle ORM)\n * Merged Socratic teaching with Gamified Avatar personalities\n */\n\nimport crypto from 'crypto'\nimport { eq } from 'drizzle-orm'\nimport { drizzleDb } from '@/lib/db/drizzle'\nimport { userGamification } from '@/lib/db/schema'\nimport { logActivity } from './activity-log'\nimport { XP_LEVELS, XP_REWARDS, AVATAR_PERSONALITIES, type AvatarPersonality } from './constants'\n\nexport async function getOrCreateGamification(userId: string) {\n  const [existing] = await drizzleDb\n    .select()\n    .from(userGamification)\n    .where(eq(userGamification.userId, userId))\n    .limit(1)\n\n  if (existing) return existing\n\n  const [created] = await drizzleDb\n    .insert(userGamification)\n    .values({\n      id: crypto.randomUUID(),\n      userId,\n      level: 1,\n      xp: 0,\n      streakDays: 0,\n      longestStreak: 0,\n      totalStudyMinutes: 0,\n      grammarScore: 0,\n      vocabularyScore: 0,\n      speakingScore: 0,\n      listeningScore: 0,\n      confidenceScore: 0,\n      fluencyScore: 0,\n      unlockedWorlds: [],\n    })\n    .returning()\n\n  if (!created) throw new Error('Failed to create user gamification')\n  return created\n}\n\nexport function calculateLevel(xp: number): number {\n  let level = 1\n  for (let i = 1; i <= 20; i++) {\n    if (xp >= XP_LEVELS[i]) {\n      level = i\n    } else {\n      break\n    }\n  }\n  return level\n}\n\nexport function getXpForNextLevel(currentLevel: number): number {\n  return XP_LEVELS[currentLevel + 1] || XP_LEVELS[20] * 2\n}\n\nexport function getLevelProgress(xp: number, level: number): number {\n  const currentLevelXp = XP_LEVELS[level]\n  const nextLevelXp = XP_LEVELS[level + 1] || XP_LEVELS[20] * 2\n  const xpInLevel = xp - currentLevelXp\n  const xpNeeded = nextLevelXp - currentLevelXp\n  return Math.min(100, Math.round((xpInLevel / xpNeeded) * 100))\n}\n\nexport async function awardXp(\n  userId: string,\n  amount: number,\n  source: string,\n  metadata?: Record<string, unknown>\n) {\n  const gamification = await getOrCreateGamification(userId)\n\n  const newXp = gamification.xp + amount\n  const newLevel = calculateLevel(newXp)\n  const leveledUp = newLevel > gamification.level\n\n  const [updated] = await drizzleDb\n    .update(userGamification)\n    .set({ xp: newXp, level: newLevel })\n    .where(eq(userGamification.userId, userId))\n    .returning()\n\n  if (!updated) throw new Error('Failed to update gamification')\n\n  await logActivity(userId, 'XP_EARNED', {\n    amount,\n    source,\n    newTotal: newXp,\n    leveledUp,\n    ...metadata,\n  })\n\n  return {\n    ...updated,\n    xpEarned: amount,\n    leveledUp,\n    previousLevel: gamification.level,\n  }\n}\n\nexport async function updateStreak(userId: string) {\n  const gamification = await getOrCreateGamification(userId)\n\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n\n  const lastActive = gamification.lastActiveDate\n    ? new Date(gamification.lastActiveDate)\n    : null\n\n  let newStreak = gamification.streakDays\n  let streakBonus = 0\n  let streakContinued = false\n  let streakBroken = false\n\n  if (lastActive) {\n    lastActive.setHours(0, 0, 0, 0)\n    const diffDays = Math.floor((today.getTime() - lastActive.getTime()) / (1000 * 60 * 60 * 24))\n\n    if (diffDays === 1) {\n      newStreak += 1\n      streakContinued = true\n\n      if (newStreak === 3) streakBonus = XP_REWARDS.STREAK_3_DAYS\n      else if (newStreak === 7) streakBonus = XP_REWARDS.STREAK_7_DAYS\n      else if (newStreak === 30) streakBonus = XP_REWARDS.STREAK_30_DAYS\n    } else if (diffDays === 0) {\n      streakContinued = true\n    } else {\n      streakBroken = true\n      newStreak = 1\n    }\n  } else {\n    newStreak = 1\n  }\n\n  const longestStreak = Math.max(gamification.longestStreak, newStreak)\n\n  const [updated] = await drizzleDb\n    .update(userGamification)\n    .set({\n      streakDays: newStreak,\n      longestStreak,\n      lastActiveDate: today,\n    })\n    .where(eq(userGamification.userId, userId))\n    .returning()\n\n  if (!updated) throw new Error('Failed to update streak')\n\n  await logActivity(userId, streakBroken ? 'STREAK_BROKEN' : 'STREAK_UPDATED', {\n    streakDays: newStreak,\n    previousStreak: gamification.streakDays,\n    streakBroken,\n    streakContinued,\n  })\n\n  return {\n    ...updated,\n    streakBonus,\n    streakContinued,\n    streakBroken,\n  }\n}\n\nexport async function checkDailyLogin(userId: string) {\n  const gamification = await getOrCreateGamification(userId)\n\n  const today = new Date()\n  today.setHours(0, 0, 0, 0)\n\n  const lastActive = gamification.lastActiveDate\n    ? new Date(gamification.lastActiveDate)\n    : null\n\n  if (!lastActive || lastActive.getTime() !== today.getTime()) {\n    const streakResult = await updateStreak(userId)\n    const xpResult = await awardXp(userId, XP_REWARDS.DAILY_LOGIN, 'daily_login')\n\n    return {\n      firstLoginToday: true,\n      xpEarned: xpResult.xpEarned + streakResult.streakBonus,\n      streakBonus: streakResult.streakBonus,\n      streakDays: streakResult.streakDays,\n      leveledUp: xpResult.leveledUp,\n    }\n  }\n\n  return {\n    firstLoginToday: false,\n    streakDays: gamification.streakDays,\n  }\n}\n\nexport async function updateSkillScores(\n  userId: string,\n  scores: {\n    grammar?: number\n    vocabulary?: number\n    speaking?: number\n    listening?: number\n    confidence?: number\n    fluency?: number\n  }\n) {\n  const gamification = await getOrCreateGamification(userId)\n\n  const calculateScore = (existing: number, newScore?: number) => {\n    if (newScore === undefined) return existing\n    return Math.round(existing * 0.7 + newScore * 0.3)\n  }\n\n  const [updated] = await drizzleDb\n    .update(userGamification)\n    .set({\n      grammarScore: calculateScore(gamification.grammarScore, scores.grammar),\n      vocabularyScore: calculateScore(gamification.vocabularyScore, scores.vocabulary),\n      speakingScore: calculateScore(gamification.speakingScore, scores.speaking),\n      listeningScore: calculateScore(gamification.listeningScore, scores.listening),\n      confidenceScore: calculateScore(gamification.confidenceScore, scores.confidence),\n      fluencyScore: calculateScore(gamification.fluencyScore, scores.fluency),\n    })\n    .where(eq(userGamification.userId, userId))\n    .returning()\n\n  if (!updated) throw new Error('Failed to update skill scores')\n\n  if (scores.confidence && scores.confidence > gamification.confidenceScore + 5) {\n    await logActivity(userId, 'CONFIDENCE_MILESTONE', {\n      previousScore: gamification.confidenceScore,\n      newScore: updated.confidenceScore,\n      delta: updated.confidenceScore - gamification.confidenceScore,\n    })\n  }\n\n  return updated\n}\n\nexport async function getGamificationSummary(userId: string) {\n  const gamification = await getOrCreateGamification(userId)\n  const nextLevelXp = getXpForNextLevel(gamification.level)\n  const currentLevelXp = XP_LEVELS[gamification.level]\n  const progress = getLevelProgress(gamification.xp, gamification.level)\n\n  return {\n    level: gamification.level,\n    xp: gamification.xp,\n    nextLevelXp,\n    currentLevelXp,\n    progress,\n    xpToNextLevel: nextLevelXp - gamification.xp,\n    streakDays: gamification.streakDays,\n    longestStreak: gamification.longestStreak,\n    skills: {\n      grammar: gamification.grammarScore,\n      vocabulary: gamification.vocabularyScore,\n      speaking: gamification.speakingScore,\n      listening: gamification.listeningScore,\n      confidence: gamification.confidenceScore,\n      fluency: gamification.fluencyScore,\n    },\n    unlockedWorlds: gamification.unlockedWorlds,\n  }\n}\n\nexport async function unlockWorld(userId: string, worldId: string) {\n  const gamification = await getOrCreateGamification(userId)\n\n  const current = gamification.unlockedWorlds ?? []\n  if (!current.includes(worldId)) {\n    const [updated] = await drizzleDb\n      .update(userGamification)\n      .set({ unlockedWorlds: [...current, worldId] })\n      .where(eq(userGamification.userId, userId))\n      .returning()\n\n    if (updated) {\n      await logActivity(userId, 'WORLD_UNLOCK', { worldId })\n      return { unlocked: true, updated }\n    }\n  }\n\n  return { unlocked: false }\n}\n\nexport async function canAccessWorld(userId: string, requiredLevel: number) {\n  const gamification = await getOrCreateGamification(userId)\n  return gamification.level >= requiredLevel\n}\n","/**\n * Badge System (Drizzle ORM)\n *\n * Defines all badges, their requirements, and handles badge awarding\n */\n\nimport crypto from 'crypto'\nimport { eq, and, desc, asc } from 'drizzle-orm'\nimport { drizzleDb } from '@/lib/db/drizzle'\nimport { badge, userBadge } from '@/lib/db/schema'\nimport { awardXp } from './service'\nimport { logActivity } from './activity-log'\n\nexport interface BadgeDefinition {\n  key: string\n  name: string\n  description: string\n  icon: string\n  color: string\n  category: 'general' | 'streak' | 'quiz' | 'social' | 'mastery'\n  rarity: 'common' | 'rare' | 'epic' | 'legendary'\n  xpBonus: number\n  requirement: {\n    type: string\n    count?: number\n    score?: number\n    days?: number\n    level?: number\n  }\n  isSecret?: boolean\n  order: number\n}\n\n// Badge definitions - all available badges in the system\nexport const BADGE_DEFINITIONS: BadgeDefinition[] = [\n  { key: 'first_steps', name: 'First Steps', description: 'Complete your first lesson', icon: 'footprints', color: '#22c55e', category: 'general', rarity: 'common', xpBonus: 50, requirement: { type: 'complete_lessons', count: 1 }, order: 1 },\n  { key: 'quick_learner', name: 'Quick Learner', description: 'Complete 10 lessons', icon: 'zap', color: '#3b82f6', category: 'general', rarity: 'common', xpBonus: 100, requirement: { type: 'complete_lessons', count: 10 }, order: 2 },\n  { key: 'knowledge_seeker', name: 'Knowledge Seeker', description: 'Complete 50 lessons', icon: 'book-open', color: '#8b5cf6', category: 'general', rarity: 'rare', xpBonus: 250, requirement: { type: 'complete_lessons', count: 50 }, order: 3 },\n  { key: 'master_scholar', name: 'Master Scholar', description: 'Complete 100 lessons', icon: 'graduation-cap', color: '#f59e0b', category: 'general', rarity: 'epic', xpBonus: 500, requirement: { type: 'complete_lessons', count: 100 }, order: 4 },\n  { key: 'streak_3', name: 'On Fire', description: 'Maintain a 3-day learning streak', icon: 'flame', color: '#f97316', category: 'streak', rarity: 'common', xpBonus: 100, requirement: { type: 'streak_days', days: 3 }, order: 10 },\n  { key: 'streak_7', name: 'Week Warrior', description: 'Maintain a 7-day learning streak', icon: 'flame', color: '#ef4444', category: 'streak', rarity: 'rare', xpBonus: 250, requirement: { type: 'streak_days', days: 7 }, order: 11 },\n  { key: 'streak_30', name: 'Monthly Master', description: 'Maintain a 30-day learning streak', icon: 'crown', color: '#eab308', category: 'streak', rarity: 'epic', xpBonus: 1000, requirement: { type: 'streak_days', days: 30 }, order: 12 },\n  { key: 'streak_100', name: 'Centurion', description: 'Maintain a 100-day learning streak', icon: 'medal', color: '#6366f1', category: 'streak', rarity: 'legendary', xpBonus: 5000, requirement: { type: 'streak_days', days: 100 }, order: 13 },\n  { key: 'first_quiz', name: 'Quiz Taker', description: 'Complete your first quiz', icon: 'help-circle', color: '#10b981', category: 'quiz', rarity: 'common', xpBonus: 50, requirement: { type: 'complete_quizzes', count: 1 }, order: 20 },\n  { key: 'quiz_pro', name: 'Quiz Pro', description: 'Complete 20 quizzes', icon: 'check-circle', color: '#3b82f6', category: 'quiz', rarity: 'common', xpBonus: 150, requirement: { type: 'complete_quizzes', count: 20 }, order: 21 },\n  { key: 'perfect_score', name: 'Perfect Score', description: 'Score 100% on a quiz', icon: 'star', color: '#f59e0b', category: 'quiz', rarity: 'rare', xpBonus: 200, requirement: { type: 'perfect_quiz', count: 1 }, order: 22 },\n  { key: 'quiz_master', name: 'Quiz Master', description: 'Complete 50 quizzes with 80%+ average', icon: 'trophy', color: '#8b5cf6', category: 'quiz', rarity: 'epic', xpBonus: 500, requirement: { type: 'complete_quizzes_expert', count: 50, score: 80 }, order: 23 },\n  { key: 'social_butterfly', name: 'Social Butterfly', description: 'Join 5 live sessions', icon: 'users', color: '#ec4899', category: 'social', rarity: 'common', xpBonus: 100, requirement: { type: 'join_sessions', count: 5 }, order: 30 },\n  { key: 'active_participant', name: 'Active Participant', description: 'Send 50 messages in live sessions', icon: 'message-circle', color: '#06b6d4', category: 'social', rarity: 'rare', xpBonus: 200, requirement: { type: 'send_messages', count: 50 }, order: 31 },\n  { key: 'study_group_hero', name: 'Study Group Hero', description: 'Join or create 3 study groups', icon: 'users-round', color: '#84cc16', category: 'social', rarity: 'rare', xpBonus: 300, requirement: { type: 'join_groups', count: 3 }, order: 32 },\n  { key: 'level_5', name: 'Rising Star', description: 'Reach level 5', icon: 'rocket', color: '#f97316', category: 'mastery', rarity: 'common', xpBonus: 200, requirement: { type: 'reach_level', level: 5 }, order: 40 },\n  { key: 'level_10', name: 'Expert Learner', description: 'Reach level 10', icon: 'award', color: '#3b82f6', category: 'mastery', rarity: 'rare', xpBonus: 500, requirement: { type: 'reach_level', level: 10 }, order: 41 },\n  { key: 'level_20', name: 'Grandmaster', description: 'Reach level 20', icon: 'crown', color: '#eab308', category: 'mastery', rarity: 'epic', xpBonus: 2000, requirement: { type: 'reach_level', level: 20 }, order: 42 },\n  { key: 'xp_10000', name: 'XP Hunter', description: 'Earn 10,000 total XP', icon: 'target', color: '#8b5cf6', category: 'mastery', rarity: 'rare', xpBonus: 500, requirement: { type: 'earn_xp', count: 10000 }, order: 43 },\n  { key: 'night_owl', name: 'Night Owl', description: 'Complete a lesson between midnight and 5 AM', icon: 'moon', color: '#6366f1', category: 'general', rarity: 'rare', xpBonus: 150, requirement: { type: 'night_study' }, isSecret: true, order: 50 },\n  { key: 'early_bird', name: 'Early Bird', description: 'Complete a lesson before 7 AM', icon: 'sunrise', color: '#f59e0b', category: 'general', rarity: 'rare', xpBonus: 150, requirement: { type: 'morning_study' }, isSecret: true, order: 51 },\n]\n\nexport async function initializeBadges() {\n  for (const b of BADGE_DEFINITIONS) {\n    const [existing] = await drizzleDb.select().from(badge).where(eq(badge.key, b.key)).limit(1)\n    if (existing) {\n      await drizzleDb\n        .update(badge)\n        .set({\n          name: b.name,\n          description: b.description,\n          icon: b.icon,\n          color: b.color,\n          category: b.category,\n          rarity: b.rarity,\n          xpBonus: b.xpBonus,\n          requirement: b.requirement as unknown as typeof badge.$inferInsert.requirement,\n          isSecret: b.isSecret ?? false,\n          order: b.order,\n        })\n        .where(eq(badge.id, existing.id))\n    } else {\n      await drizzleDb.insert(badge).values({\n        id: crypto.randomUUID(),\n        key: b.key,\n        name: b.name,\n        description: b.description,\n        icon: b.icon,\n        color: b.color,\n        category: b.category,\n        rarity: b.rarity,\n        xpBonus: b.xpBonus,\n        requirement: b.requirement as unknown as typeof badge.$inferInsert.requirement,\n        isSecret: b.isSecret ?? false,\n        order: b.order,\n      })\n    }\n  }\n  console.log(`[Badges] Initialized ${BADGE_DEFINITIONS.length} badges`)\n}\n\nexport async function awardBadge(userId: string, badgeKey: string) {\n  const [badgeRow] = await drizzleDb.select().from(badge).where(eq(badge.key, badgeKey)).limit(1)\n  if (!badgeRow) throw new Error(`Badge not found: ${badgeKey}`)\n\n  const [existing] = await drizzleDb\n    .select()\n    .from(userBadge)\n    .where(and(eq(userBadge.userId, userId), eq(userBadge.badgeId, badgeRow.id)))\n    .limit(1)\n  if (existing) return { awarded: false, alreadyHad: true }\n\n  await drizzleDb.insert(userBadge).values({\n    id: crypto.randomUUID(),\n    userId,\n    badgeId: badgeRow.id,\n    progress: 0,\n  })\n\n  if (badgeRow.xpBonus > 0) {\n    await awardXp(userId, badgeRow.xpBonus, 'badge_earned', { badgeKey })\n  }\n  await logActivity(userId, 'BADGE_EARNED', {\n    badgeKey,\n    badgeName: badgeRow.name,\n    rarity: badgeRow.rarity,\n    xpBonus: badgeRow.xpBonus,\n  })\n\n  return {\n    awarded: true,\n    badge: badgeRow,\n    xpBonus: badgeRow.xpBonus,\n  }\n}\n\nexport async function getUserBadges(userId: string) {\n  const rows = await drizzleDb\n    .select({\n      id: badge.id,\n      key: badge.key,\n      name: badge.name,\n      description: badge.description,\n      icon: badge.icon,\n      color: badge.color,\n      category: badge.category,\n      rarity: badge.rarity,\n      xpBonus: badge.xpBonus,\n      requirement: badge.requirement,\n      isSecret: badge.isSecret,\n      order: badge.order,\n      earnedAt: userBadge.earnedAt,\n    })\n    .from(userBadge)\n    .innerJoin(badge, eq(badge.id, userBadge.badgeId))\n    .where(eq(userBadge.userId, userId))\n    .orderBy(desc(userBadge.earnedAt))\n\n  return rows.map((r) => ({ ...r, earnedAt: r.earnedAt }))\n}\n\nexport async function getAllBadgesWithProgress(userId: string) {\n  const [allBadges, userBadgesRows] = await Promise.all([\n    drizzleDb.select().from(badge).orderBy(asc(badge.order)),\n    drizzleDb.select({ badgeId: userBadge.badgeId, earnedAt: userBadge.earnedAt, progress: userBadge.progress }).from(userBadge).where(eq(userBadge.userId, userId)),\n  ])\n\n  const earnedBadgeIds = new Set(userBadgesRows.map((ub) => ub.badgeId))\n  const userBadgeMap = new Map(userBadgesRows.map((ub) => [ub.badgeId, ub]))\n\n  return allBadges.map((b) => ({\n    ...b,\n    earned: earnedBadgeIds.has(b.id),\n    earnedAt: userBadgeMap.get(b.id)?.earnedAt ?? null,\n    progress: userBadgeMap.get(b.id)?.progress ?? 0,\n  }))\n}\n\nexport async function checkAndAwardBadges(\n  userId: string,\n  stats: {\n    lessonsCompleted?: number\n    quizzesCompleted?: number\n    streakDays?: number\n    currentLevel?: number\n    totalXp?: number\n    sessionsJoined?: number\n    messagesSent?: number\n    perfectQuizzes?: number\n    quizAverage?: number\n  }\n) {\n  const badgesToCheck: string[] = []\n  if (stats.lessonsCompleted !== undefined) {\n    if (stats.lessonsCompleted >= 1) badgesToCheck.push('first_steps')\n    if (stats.lessonsCompleted >= 10) badgesToCheck.push('quick_learner')\n    if (stats.lessonsCompleted >= 50) badgesToCheck.push('knowledge_seeker')\n    if (stats.lessonsCompleted >= 100) badgesToCheck.push('master_scholar')\n  }\n  if (stats.streakDays !== undefined) {\n    if (stats.streakDays >= 3) badgesToCheck.push('streak_3')\n    if (stats.streakDays >= 7) badgesToCheck.push('streak_7')\n    if (stats.streakDays >= 30) badgesToCheck.push('streak_30')\n    if (stats.streakDays >= 100) badgesToCheck.push('streak_100')\n  }\n  if (stats.quizzesCompleted !== undefined) {\n    if (stats.quizzesCompleted >= 1) badgesToCheck.push('first_quiz')\n    if (stats.quizzesCompleted >= 20) badgesToCheck.push('quiz_pro')\n  }\n  if (stats.perfectQuizzes && stats.perfectQuizzes >= 1) badgesToCheck.push('perfect_score')\n  if (stats.quizzesCompleted && stats.quizAverage && stats.quizzesCompleted >= 50 && stats.quizAverage >= 80) badgesToCheck.push('quiz_master')\n  if (stats.sessionsJoined !== undefined && stats.sessionsJoined >= 5) badgesToCheck.push('social_butterfly')\n  if (stats.messagesSent !== undefined && stats.messagesSent >= 50) badgesToCheck.push('active_participant')\n  if (stats.currentLevel !== undefined) {\n    if (stats.currentLevel >= 5) badgesToCheck.push('level_5')\n    if (stats.currentLevel >= 10) badgesToCheck.push('level_10')\n    if (stats.currentLevel >= 20) badgesToCheck.push('level_20')\n  }\n  if (stats.totalXp !== undefined && stats.totalXp >= 10000) badgesToCheck.push('xp_10000')\n\n  const awarded: Array<{ badgeKey: string; badgeName: string; xpBonus: number }> = []\n  for (const badgeKey of badgesToCheck) {\n    const result = await awardBadge(userId, badgeKey)\n    if (result.awarded && result.badge) {\n      awarded.push({ badgeKey, badgeName: result.badge.name, xpBonus: result.xpBonus })\n    }\n  }\n  return awarded\n}\n\nexport async function getBadgeStats(userId: string) {\n  const [earnedRows, allBadges] = await Promise.all([\n    drizzleDb\n      .select({ badgeId: userBadge.badgeId, bRarity: badge.rarity, bCategory: badge.category, bXpBonus: badge.xpBonus })\n      .from(userBadge)\n      .innerJoin(badge, eq(badge.id, userBadge.badgeId))\n      .where(eq(userBadge.userId, userId)),\n    drizzleDb.select().from(badge),\n  ])\n\n  const byRarity = {\n    common: earnedRows.filter((r) => r.bRarity === 'common').length,\n    rare: earnedRows.filter((r) => r.bRarity === 'rare').length,\n    epic: earnedRows.filter((r) => r.bRarity === 'epic').length,\n    legendary: earnedRows.filter((r) => r.bRarity === 'legendary').length,\n  }\n  const byCategory = {\n    general: earnedRows.filter((r) => r.bCategory === 'general').length,\n    streak: earnedRows.filter((r) => r.bCategory === 'streak').length,\n    quiz: earnedRows.filter((r) => r.bCategory === 'quiz').length,\n    social: earnedRows.filter((r) => r.bCategory === 'social').length,\n    mastery: earnedRows.filter((r) => r.bCategory === 'mastery').length,\n  }\n\n  return {\n    totalEarned: earnedRows.length,\n    totalAvailable: allBadges.length,\n    completionPercentage: allBadges.length ? Math.round((earnedRows.length / allBadges.length) * 100) : 0,\n    byRarity,\n    byCategory,\n    totalXpFromBadges: earnedRows.reduce((sum, r) => sum + r.bXpBonus, 0),\n  }\n}\n"],"names":[],"mappings":"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"}}]
}