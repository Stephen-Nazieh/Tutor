;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="34d5215b-f8c9-474b-3923-21cd72e022d2")}catch(e){}}();
module.exports=[633540,e=>e.a(async(t,n)=>{try{var r=e.i(620971),a=e.i(384030),o=e.i(738597);e.i(688768);var i=e.i(257357),s=e.i(909105),l=e.i(320947),u=t([a,o]);[a,o]=u.then?(await u)():u;let d=(0,a.withAuth)(async(e,t,n)=>{let{id:u}=await n.params,d=(await o.drizzleDb.select().from(i.quiz).where((0,s.and)((0,s.eq)(i.quiz.id,u),(0,s.eq)(i.quiz.tutorId,t.user.id))).limit(1))[0];if(!d)throw new a.NotFoundError("Quiz not found");await o.drizzleDb.select().from(i.quizAssignment).where((0,s.eq)(i.quizAssignment.quizId,u));let c=await o.drizzleDb.select({attempt:i.quizAttempt,studentId:i.quizAttempt.studentId,profileName:i.profile.name}).from(i.quizAttempt).leftJoin(i.user,(0,s.eq)(i.quizAttempt.studentId,i.user.id)).leftJoin(i.profile,(0,s.eq)(i.profile.userId,i.user.id)).where((0,s.eq)(i.quizAttempt.quizId,u)),p=await o.drizzleDb.select({count:l.sql`count(*)::int`}).from(i.quizAssignment).where((0,s.and)((0,s.eq)(i.quizAssignment.quizId,u),(0,s.eq)(i.quizAssignment.isActive,!0))),m=p[0]?.count??0,h=c.map(e=>({...e.attempt,studentId:e.studentId,student:{id:e.studentId,profile:{name:e.profileName}}})).filter(e=>"graded"===e.status||"submitted"===e.status),A=h.length;if(0===A)return r.NextResponse.json({analytics:{quizId:u,quizTitle:d.title,totalStudents:10*m,attemptsCount:0,completionRate:0,averageScore:0,averageTimeSpent:0,scoreDistribution:{"90-100":0,"80-89":0,"70-79":0,"60-69":0,"below-60":0},questionAnalytics:[],studentPerformance:[]}});let w={"90-100":0,"80-89":0,"70-79":0,"60-69":0,"below-60":0},f=0,g=0;h.forEach(e=>{let t=e.score/e.maxScore*100;f+=t,g+=e.timeSpent,t>=90?w["90-100"]++:t>=80?w["80-89"]++:t>=70?w["70-79"]++:t>=60?w["60-69"]++:w["below-60"]++});let R=d.questions||[],q={};R.forEach((e,t)=>{q[e.id||`q-${t}`]={questionId:e.id||`q-${t}`,questionText:e.question,type:e.type,points:e.points||1,correctCount:0,incorrectCount:0,partialCount:0,totalScore:0,totalTimeSpent:0,wrongAnswers:{}}}),h.forEach(e=>{(e.questionResults||[]).forEach(e=>{let t=q[e.questionId];t&&(e.correct?t.correctCount++:e.pointsEarned>0?t.partialCount++:t.incorrectCount++,t.totalScore+=e.pointsEarned||0,t.totalTimeSpent+=e.timeSpentSec||0,!e.correct&&e.selectedAnswer&&"string"==typeof e.selectedAnswer&&(t.wrongAnswers[e.selectedAnswer]=(t.wrongAnswers[e.selectedAnswer]||0)+1))})});let v=Object.values(q).map(e=>{let t=e.correctCount+e.incorrectCount+e.partialCount,n=t>0?e.totalScore/t:0,r=t>0?e.totalTimeSpent/t:0,a=t>0?e.correctCount/t:0,o=Object.entries(e.wrongAnswers).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e,t])=>({answer:e,count:t}));return{questionId:e.questionId,questionText:e.questionText.substring(0,100)+(e.questionText.length>100?"...":""),type:e.type,points:e.points,correctCount:e.correctCount,incorrectCount:e.incorrectCount,partialCount:e.partialCount,averageScore:Math.round(100*n)/100,averageTimeSpent:Math.round(r),difficultyIndex:Math.round(100*a)/100,discriminationIndex:0,commonWrongAnswers:o.length>0?o:void 0}}),C=new Map;h.forEach(e=>{let t=e.studentId,n=C.get(t),r=e.score/e.maxScore*100,a=e.student?.profile?.name||"Unknown";n?(n.attempts.push({score:e.score,percentage:r}),e.completedAt&&(!n.lastAttemptAt||e.completedAt>n.lastAttemptAt)&&(n.lastAttemptAt=e.completedAt),n.status="completed"):C.set(t,{studentId:t,studentName:a,attempts:[{score:e.score,percentage:r}],lastAttemptAt:e.completedAt,status:"completed"})});let E=Array.from(C.values()).map(e=>({studentId:e.studentId,studentName:e.studentName,attemptCount:e.attempts.length,bestScore:Math.round(Math.max(...e.attempts.map(e=>e.percentage))),averageScore:Math.round(e.attempts.reduce((e,t)=>e+t.percentage,0)/e.attempts.length),lastAttemptAt:e.lastAttemptAt||void 0,status:e.status}));E.sort((e,t)=>t.bestScore-e.bestScore);let y={quizId:u,quizTitle:d.title,totalStudents:E.length,attemptsCount:A,completionRate:Math.round(A/Math.max(m,1)*100),averageScore:Math.round(f/A),averageTimeSpent:Math.round(g/A),scoreDistribution:w,questionAnalytics:v,studentPerformance:E};return r.NextResponse.json({analytics:y})},{role:"TUTOR"});e.s(["GET",0,d]),n()}catch(e){n(e)}},!1),477172,e=>e.a(async(t,n)=>{try{var r=e.i(78315),a=e.i(586961),o=e.i(196657),i=e.i(899733),s=e.i(233979),l=e.i(631683),u=e.i(840960),d=e.i(711373),c=e.i(699699),p=e.i(521140),m=e.i(205260),h=e.i(500249),A=e.i(431740),w=e.i(82608),f=e.i(635207),g=e.i(193695);e.i(708038);var R=e.i(447430),q=e.i(633540),v=t([q]);[q]=v.then?(await v)():v;let y=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tutor/quizzes/[id]/analytics/route",pathname:"/api/tutor/quizzes/[id]/analytics",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/quizzes/[id]/analytics/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:x,workUnitAsyncStorage:S,serverHooks:T}=y;function C(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:S})}async function E(e,t,n){y.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/tutor/quizzes/[id]/analytics/route";r=r.replace(/\/index$/,"")||"/";let o=await y.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:q,params:v,nextConfig:C,parsedUrl:E,isDraftMode:x,prerenderManifest:S,routerServerContext:T,isOnDemandRevalidate:z,revalidateOnlyGenerated:I,resolvedPathname:b,clientReferenceManifest:N,serverActionsManifest:O}=o,P=(0,u.normalizeAppPath)(r),M=!!(S.dynamicRoutes[P]||S.routes[b]),_=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,E,!1):t.end("This page could not be found"),null);if(M&&!x){let e=!!S.routes[b],t=S.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await _();throw new g.NoFallbackError}}let D=null;!M||y.isDev||x||(D=b,D="/index"===D?"/":D);let U=!0===y.isDev||!M,H=M&&!U;O&&N&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:N,serverActionsManifest:O});let k=e.method||"GET",j=(0,s.getTracer)(),$=j.getActiveScopeSpan(),K={params:v,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,a)=>y.onRequestError(e,t,r,a,T)},sharedContext:{buildId:q}},F=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),L=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let o=async e=>y.handle(L,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=j.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${r}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var s,u;let d=async({previousCacheEntry:a})=>{try{if(!l&&z&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(i);e.fetchMetrics=K.renderOpts.fetchMetrics;let s=K.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let u=K.renderOpts.collectedTags;if(!M)return await (0,h.sendResponse)(F,B,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,A.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:z})},!1,T),t}},c=await y.handleResponse({req:e,nextConfig:C,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:z,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:l});if(!M)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(u=c.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",z?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,A.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&M||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(F,B,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};$?await u($):await j.withPropagatedContext(e.headers,()=>j.trace(p.BaseServerSpan.handleRequest,{spanName:`${k} ${r}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},u))}catch(t){if(t instanceof g.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:z})},!1,T),M)throw t;return await (0,h.sendResponse)(F,B,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>C,"routeModule",()=>y,"serverHooks",()=>T,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>S]),n()}catch(e){n(e)}},!1)];

//# debugId=34d5215b-f8c9-474b-3923-21cd72e022d2
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_aaac3492._.js.map