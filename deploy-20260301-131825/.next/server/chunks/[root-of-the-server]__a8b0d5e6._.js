;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="b1df31fc-8a47-81a7-59aa-ddb67333c3fd")}catch(e){}}();
module.exports=[721064,e=>e.a(async(t,n)=>{try{var i=e.i(620971),a=e.i(384030),r=e.i(784266),o=e.i(738597);e.i(688768);var l=e.i(257357),s=e.i(909105),c=e.i(997103),d=t([a,o]);[a,o]=d.then?(await d)():d;let u=(0,a.withAuth)(async(e,t)=>{let n=(0,a.requireAdminIp)(e);if(n)return n;let d=(0,a.requirePermission)(t,r.PERMISSIONS.ADMIN_VIEW_PAYMENTS);if(d)return d;if("ADMIN"!==t.user.role)throw new a.ForbiddenError("Admin only");let{searchParams:u}=new URL(e.url),p=u.get("status"),h=u.get("gateway"),m=Math.min(parseInt(u.get("limit")||"50",10),100),R=[];p&&R.push((0,s.eq)(l.payment.status,p)),h&&R.push((0,s.eq)(l.payment.gateway,h));let g=R.length>0?(0,s.and)(...R):void 0,v=(await o.drizzleDb.select({payment:l.payment,bookingId:l.clinicBooking.id,bookingClinicId:l.clinicBooking.clinicId,bookingStudentId:l.clinicBooking.studentId,clinicTitle:l.clinic.title,clinicSubject:l.clinic.subject}).from(l.payment).leftJoin(l.clinicBooking,(0,s.eq)(l.payment.bookingId,l.clinicBooking.id)).leftJoin(l.clinic,(0,s.eq)(l.clinicBooking.clinicId,l.clinic.id)).where(g).orderBy((0,c.desc)(l.payment.createdAt)).limit(m)).map(e=>({...e.payment,booking:e.bookingId?{id:e.bookingId,clinicId:e.bookingClinicId,studentId:e.bookingStudentId,clinic:null!=e.clinicTitle?{title:e.clinicTitle,subject:e.clinicSubject}:null}:null}));return i.NextResponse.json({payments:v})},{role:"ADMIN"});e.s(["GET",0,u]),n()}catch(e){n(e)}},!1),228023,e=>e.a(async(t,n)=>{try{var i=e.i(78315),a=e.i(586961),r=e.i(196657),o=e.i(899733),l=e.i(233979),s=e.i(631683),c=e.i(840960),d=e.i(711373),u=e.i(699699),p=e.i(521140),h=e.i(205260),m=e.i(500249),R=e.i(431740),g=e.i(82608),v=e.i(635207),y=e.i(193695);e.i(708038);var E=e.i(447430),f=e.i(721064),w=t([f]);[f]=w.then?(await w)():w;let b=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/payments/route",pathname:"/api/admin/payments",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/admin/payments/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:C,workUnitAsyncStorage:I,serverHooks:k}=b;function _(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:I})}async function A(e,t,n){b.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/payments/route";i=i.replace(/\/index$/,"")||"/";let r=await b.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:f,params:w,nextConfig:_,parsedUrl:A,isDraftMode:C,prerenderManifest:I,routerServerContext:k,isOnDemandRevalidate:x,revalidateOnlyGenerated:T,resolvedPathname:P,clientReferenceManifest:N,serverActionsManifest:S}=r,O=(0,c.normalizeAppPath)(i),M=!!(I.dynamicRoutes[O]||I.routes[P]),q=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,A,!1):t.end("This page could not be found"),null);if(M&&!C){let e=!!I.routes[P],t=I.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await q();throw new y.NoFallbackError}}let D=null;!M||b.isDev||C||(D=P,D="/index"===D?"/":D);let H=!0===b.isDev||!M,U=M&&!H;S&&N&&(0,s.setManifestsSingleton)({page:i,clientReferenceManifest:N,serverActionsManifest:S});let j=e.method||"GET",B=(0,l.getTracer)(),K=B.getActiveScopeSpan(),F={params:w,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,i,a)=>b.onRequestError(e,t,i,a,k)},sharedContext:{buildId:f}},$=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let r=async e=>b.handle(W,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=B.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${i}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var l,c;let d=async({previousCacheEntry:a})=>{try{if(!s&&x&&T&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)($,L,i,F.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,k),t}},u=await b.handleResponse({req:e,nextConfig:_,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:s});if(!M)return null;if((null==u||null==(l=u.value)?void 0:l.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,R.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&M||p.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)($,L,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};K?await c(K):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${i}`,kind:l.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,k),M)throw t;return await (0,m.sendResponse)($,L,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>_,"routeModule",()=>b,"serverHooks",()=>k,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>I]),n()}catch(e){n(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=b1df31fc-8a47-81a7-59aa-ddb67333c3fd
//# sourceMappingURL=%5Broot-of-the-server%5D__a8b0d5e6._.js.map