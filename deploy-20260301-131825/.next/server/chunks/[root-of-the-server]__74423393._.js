;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="29a276c5-495b-f978-00b8-de89d210d92f")}catch(e){}}();
module.exports=[908286,e=>{"use strict";async function t(e,t){var r=e instanceof Promise?await e:e;if(!r||"object"!=typeof r)return;let a=r[t];return null!=a?Array.isArray(a)?a[0]:a:void 0}e.s(["getParamAsync",()=>t])},852766,e=>e.a(async(t,r)=>{try{var a=e.i(620971),i=e.i(384030),n=e.i(908286),s=e.i(738597);e.i(688768);var o=e.i(257357),l=e.i(909105),u=e.i(997103),c=t([i,s]);[i,s]=c.then?(await c)():c;let d=(0,i.withAuth)(async(e,t,r)=>{var c,d,p;let m,h,g=await (0,n.getParamAsync)(r?.params,"subjectCode");if(!g)return a.NextResponse.json({error:"Subject code required"},{status:400});let[w]=await s.drizzleDb.select().from(o.curriculum).where((0,l.eq)(o.curriculum.subject,g)).limit(1);if(!w)throw new i.NotFoundError("Subject not found");let[v]=await s.drizzleDb.select().from(o.curriculumEnrollment).where((0,l.and)((0,l.eq)(o.curriculumEnrollment.studentId,t.user.id),(0,l.eq)(o.curriculumEnrollment.curriculumId,w.id))).limit(1);if(!v)throw new i.NotFoundError("Subject not found");let f=(await s.drizzleDb.select().from(o.curriculumModule).where((0,l.eq)(o.curriculumModule.curriculumId,w.id))).map(e=>e.id),y=f.length>0?await s.drizzleDb.select().from(o.curriculumLesson).where((0,l.inArray)(o.curriculumLesson.moduleId,f)):[],R=y.map(e=>e.id),b=R.length>0?await s.drizzleDb.select().from(o.curriculumLessonProgress).where((0,l.and)((0,l.eq)(o.curriculumLessonProgress.studentId,t.user.id),(0,l.inArray)(o.curriculumLessonProgress.lessonId,R))):[],E=new Map(b.map(e=>[e.lessonId,e])),C=await s.drizzleDb.select().from(o.quizAttempt).where((0,l.eq)(o.quizAttempt.studentId,t.user.id)).orderBy((0,u.desc)(o.quizAttempt.completedAt)).limit(20),[A]=await s.drizzleDb.select().from(o.userGamification).where((0,l.eq)(o.userGamification.userId,t.user.id)).limit(1),_=y.length,x=y.filter(e=>E.get(e.id)?.status==="COMPLETED").length,P=_>0?Math.round(x/_*100):0,T=C.length>0?C.reduce((e,t)=>e+t.score/t.maxScore*100,0)/C.length:0,j=(c=g,d=T,m=({english:{grammar:75,vocabulary:80,speaking:70,listening:85,writing:72,reading:88},math:{algebra:65,geometry:70,calculus:45,statistics:60,probability:55,"problem-solving":58},physics:{mechanics:55,thermodynamics:40,electricity:50,waves:45,quantum:30,optics:42},chemistry:{organic:60,inorganic:55,physical:45,analytical:50,biochemistry:40},biology:{"cell-biology":65,genetics:70,ecology:60,anatomy:55,evolution:50},history:{ancient:70,medieval:65,modern:75,"world-wars":80,civilizations:60},cs:{programming:75,algorithms:60,"data-structures":65,databases:55,"web-dev":70}})[c.toLowerCase()]||{general:50},Object.fromEntries(Object.entries(m).map(([e,t])=>[e,Math.min(100,Math.round(t+(d-50)*.3))]))),q="math"===g.toLowerCase()?(h=(p=C).length>0?p.reduce((e,t)=>e+t.score/t.maxScore*100,0)/p.length:50,[{name:"Linear Equations",weight:1},{name:"Systems of Equations",weight:.9},{name:"Fractional Equations",weight:.8},{name:"Quadratic Equations",weight:.95},{name:"Polynomials",weight:.85}].map((e,t)=>{let r=(Math.random()-.5)*30,a=Math.min(100,Math.max(20,Math.round(h+r))),i=10+2*t,n=Math.round(a/100*i);return{concept:e.name,score:a,totalQuestions:i,correctAnswers:n}})):void 0,S=y.slice(0,5).map(e=>{let t=E.get(e.id);return{id:e.id,title:e.title,completed:t?.status==="COMPLETED",score:t?.score??void 0}});return a.NextResponse.json({subject:{id:w.id,name:w.name,subject:w.subject,description:w.description,progress:P,completedLessons:x,totalLessons:_,confidence:Math.round(T),xp:A?.xp??0,level:A?.level??1,streakDays:A?.streakDays??0,skills:j,conceptMastery:q,recentLessons:S,enrollmentSource:v.enrollmentSource??null}})},{role:"STUDENT"});e.s(["GET",0,d]),r()}catch(e){r(e)}},!1),299535,e=>e.a(async(t,r)=>{try{var a=e.i(78315),i=e.i(586961),n=e.i(196657),s=e.i(899733),o=e.i(233979),l=e.i(631683),u=e.i(840960),c=e.i(711373),d=e.i(699699),p=e.i(521140),m=e.i(205260),h=e.i(500249),g=e.i(431740),w=e.i(82608),v=e.i(635207),f=e.i(193695);e.i(708038);var y=e.i(447430),R=e.i(852766),b=t([R]);[R]=b.then?(await b)():b;let A=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/student/subjects/[subjectCode]/route",pathname:"/api/student/subjects/[subjectCode]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/student/subjects/[subjectCode]/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:_,workUnitAsyncStorage:x,serverHooks:P}=A;function E(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:x})}async function C(e,t,r){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/student/subjects/[subjectCode]/route";a=a.replace(/\/index$/,"")||"/";let n=await A.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:b,nextConfig:E,parsedUrl:C,isDraftMode:_,prerenderManifest:x,routerServerContext:P,isOnDemandRevalidate:T,revalidateOnlyGenerated:j,resolvedPathname:q,clientReferenceManifest:S,serverActionsManifest:M}=n,N=(0,u.normalizeAppPath)(a),D=!!(x.dynamicRoutes[N]||x.routes[q]),O=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,C,!1):t.end("This page could not be found"),null);if(D&&!_){let e=!!x.routes[q],t=x.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await O();throw new f.NoFallbackError}}let I=null;!D||A.isDev||_||(I=q,I="/index"===I?"/":I);let k=!0===A.isDev||!D,z=D&&!k;M&&S&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:S,serverActionsManifest:M});let H=e.method||"GET",U=(0,o.getTracer)(),L=U.getActiveScopeSpan(),K={params:b,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>A.onRequestError(e,t,a,i,P)},sharedContext:{buildId:R}},F=new c.NodeNextRequest(e),$=new c.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(F,(0,d.signalFromNodeResponse)(t));try{let n=async e=>A.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${a}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var o,u;let c=async({previousCacheEntry:i})=>{try{if(!l&&T&&j&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let o=K.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let u=K.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(F,$,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,i=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})},!1,P),t}},d=await A.handleResponse({req:e,nextConfig:E,cacheKey:I,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:j,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!D)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&D||p.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(F,$,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};L?await u(L):await U.withPropagatedContext(e.headers,()=>U.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(t){if(t instanceof f.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})},!1,P),D)throw t;return await (0,h.sendResponse)(F,$,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>E,"routeModule",()=>A,"serverHooks",()=>P,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>x]),r()}catch(e){r(e)}},!1),412171,e=>{e.v(t=>Promise.all(["server/chunks/b1c00_TutorMekimi_tutorme-app_src_lib_security_suspicious-activity_ts_7865686f._.js"].map(t=>e.l(t))).then(()=>t(145830)))},443460,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_ioredis_c74819ca._.js"].map(t=>e.l(t))).then(()=>t(693545)))},571363,e=>{e.v(t=>Promise.all(["server/chunks/ADK_WORKSPACE_TutorMekimi_tutorme-app_src_lib_security_api-key_ts_45091e81._.js"].map(t=>e.l(t))).then(()=>t(175922)))}];

//# debugId=29a276c5-495b-f978-00b8-de89d210d92f
//# sourceMappingURL=%5Broot-of-the-server%5D__74423393._.js.map