;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="eaf94e7a-3150-7afb-dfe9-6172e02dfb8f")}catch(e){}}();
module.exports=[556072,e=>e.a(async(t,r)=>{try{var i=e.i(620971),s=e.i(8235),o=e.i(738597);e.i(688768);var n=e.i(257357),a=e.i(909105),u=e.i(997103),l=e.i(320947),d=e.i(254799),c=t([s,o]);[s,o]=c.then?(await c)():c;let v=["beginner","intermediate","advanced"];function p(e){return"mcq"===e?"multiple_choice":"multiselect"===e?"multi_select":"truefalse"===e?"true_false":"shortanswer"===e?"short_answer":"matching"===e?"matching":"fillblank"===e?"fill_in_blank":"essay"===e?"essay":"short_answer"}function m(e){if("truefalse"===e.type){let t="string"==typeof e.correctAnswer?e.correctAnswer.toLowerCase():"";return"true"===t||"false"===t?t:null}return e.correctAnswer??null}function f(e,t,r){return`${r??"none"}::${e}::${t.trim().toLowerCase()}`}function h(e){let t=e.nextUrl.pathname.split("/"),r=t.indexOf("courses");return t[r+1]}async function w(e){let t=await (0,s.getServerSession)(s.authOptions,e);if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=h(e),l=t.user.id,[d]=await o.drizzleDb.select({id:n.curriculum.id,name:n.curriculum.name}).from(n.curriculum).where((0,a.and)((0,a.eq)(n.curriculum.id,r),(0,a.eq)(n.curriculum.creatorId,l)));if(!d)return i.NextResponse.json({error:"Not found or not yours"},{status:404});let c=await o.drizzleDb.select().from(n.curriculumModule).where((0,a.eq)(n.curriculumModule.curriculumId,r)).orderBy((0,u.asc)(n.curriculumModule.order)),p=c.map(e=>e.id),m=p.length>0?await o.drizzleDb.select().from(n.curriculumLesson).where((0,a.inArray)(n.curriculumLesson.moduleId,p)).orderBy((0,u.asc)(n.curriculumLesson.order)):[],f=c.map(e=>{let t=e.builderData??{},r=m.filter(t=>t.moduleId===e.id);return{id:e.id,title:e.title,description:e.description??"",order:e.order,isPublished:t.isPublished??!1,difficultyMode:t.difficultyMode??"all",variants:t.variants??{},moduleQuizzes:t.moduleQuizzes??[],lessons:r.map(e=>{let t=e.builderData??{};return{id:e.id,title:e.title,description:e.description??"",duration:e.duration,order:e.order,isPublished:t.isPublished??!1,prerequisites:e.prerequisiteLessonIds??[],media:t.media??{videos:[],images:[]},docs:t.docs??[],content:t.content??[],tasks:t.tasks??[],homework:t.homework??[],quizzes:t.quizzes??[],difficultyMode:t.difficultyMode??"all",variants:t.variants??{}}})}});return i.NextResponse.json({modules:f})}async function y(e){let t=await (0,s.getServerSession)(s.authOptions,e);if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=h(e),c=t.user.id,[w]=await o.drizzleDb.select({id:n.curriculum.id,name:n.curriculum.name}).from(n.curriculum).where((0,a.and)((0,a.eq)(n.curriculum.id,r),(0,a.eq)(n.curriculum.creatorId,c)));if(!w)return i.NextResponse.json({error:"Not found or not yours"},{status:404});let y=await e.json(),g=y.modules,q="multi"===y.developmentMode?"multi":"single",R="beginner"===y.previewDifficulty||"intermediate"===y.previewDifficulty||"advanced"===y.previewDifficulty?y.previewDifficulty:"all",A="multi"===q&&"all"===R,b=[];return Array.isArray(g)?(await o.drizzleDb.transaction(async t=>{let i=await t.select({id:n.curriculumModule.id}).from(n.curriculumModule).where((0,a.eq)(n.curriculumModule.curriculumId,r)),s=new Set(i.map(e=>e.id)),o=s.size>0?await t.select({id:n.curriculumLesson.id}).from(n.curriculumLesson).where((0,a.inArray)(n.curriculumLesson.moduleId,[...s])):[],h=new Set(o.map(e=>e.id)),y=new Set(g.map(e=>e.id)),q=new Set(g.flatMap(e=>(e.lessons??[]).map(e=>e.id))),R=[...h].filter(e=>!q.has(e));R.length>0&&await t.delete(n.curriculumLesson).where((0,a.inArray)(n.curriculumLesson.id,R));let I=[...s].filter(e=>!y.has(e));for(let e of(I.length>0&&await t.delete(n.curriculumModule).where((0,a.inArray)(n.curriculumModule.id,I)),g)){let i={isPublished:e.isPublished??!1,difficultyMode:e.difficultyMode??"all",variants:e.variants??{},moduleQuizzes:e.moduleQuizzes??[]};for(let s of(await t.insert(n.curriculumModule).values({id:e.id,curriculumId:r,title:e.title||"Untitled Module",description:e.description||null,order:e.order??0,builderData:i}).onConflictDoUpdate({target:n.curriculumModule.id,set:{title:e.title||"Untitled Module",description:e.description||null,order:e.order??0,builderData:i}}),e.lessons??[])){let r={isPublished:s.isPublished??!1,difficultyMode:s.difficultyMode??"all",variants:s.variants??{},media:s.media??{videos:[],images:[]},docs:s.docs??[],content:s.content??[],tasks:s.tasks??[],homework:s.homework??[],quizzes:s.quizzes??[]};await t.insert(n.curriculumLesson).values({id:s.id,moduleId:e.id,title:s.title||"Untitled Lesson",description:s.description||null,duration:s.duration??30,order:s.order??0,prerequisiteLessonIds:s.prerequisites??[],builderData:r,difficulty:"intermediate",learningObjectives:[],teachingPoints:[],keyConcepts:[],commonMisconceptions:[]}).onConflictDoUpdate({target:n.curriculumLesson.id,set:{moduleId:e.id,title:s.title||"Untitled Lesson",description:s.description||null,duration:s.duration??30,order:s.order??0,prerequisiteLessonIds:s.prerequisites??[],builderData:r}})}}let x=function(e,t,r,i){let s=[];for(let o of e){for(let e of Array.isArray(o?.moduleQuizzes)?o.moduleQuizzes:[])for(let o of Array.isArray(e?.questions)?e.questions:[]){if(!o?.question||!o.question.trim())continue;let e=p(o.type);s.push({tutorId:t,curriculumId:r,lessonId:null,type:e,question:o.question.trim(),options:Array.isArray(o.options)?o.options:null,correctAnswer:m(o),points:Math.max(1,o.points??1),difficulty:"medium",explanation:o.explanation?.trim()||null,tags:["course-builder","module-quiz"],subject:i,isPublic:!1})}for(let e of Array.isArray(o?.lessons)?o.lessons:[]){let o="string"==typeof e?.id?e.id:null;for(let n of[{source:e?.tasks,tag:"task"},{source:e?.homework,tag:"homework"},{source:e?.worksheets,tag:"worksheet"},{source:e?.quizzes,tag:"lesson-quiz"}])for(let e of Array.isArray(n.source)?n.source:[])for(let a of Array.isArray(e?.questions)?e.questions:[]){if(!a?.question||!a.question.trim())continue;let e=p(a.type);s.push({tutorId:t,curriculumId:r,lessonId:o,type:e,question:a.question.trim(),options:Array.isArray(a.options)?a.options:null,correctAnswer:m(a),points:Math.max(1,a.points??1),difficulty:"medium",explanation:a.explanation?.trim()||null,tags:["course-builder",n.tag],subject:i,isPublic:!1})}}}return s}(g,c,r,w.name);if(x.length>0){let e=await t.select({lessonId:n.questionBankItem.lessonId,type:n.questionBankItem.type,question:n.questionBankItem.question}).from(n.questionBankItem).where((0,a.and)((0,a.eq)(n.questionBankItem.tutorId,c),(0,a.eq)(n.questionBankItem.curriculumId,r))),i=new Set(e.map(e=>f(e.type,e.question,e.lessonId??null))),s=x.filter(e=>{let t=f(e.type,e.question,e.lessonId);return!i.has(t)&&(i.add(t),!0)});s.length>0&&await t.insert(n.questionBankItem).values(s.map(e=>({id:d.default.randomUUID(),tutorId:e.tutorId,curriculumId:e.curriculumId,lessonId:e.lessonId,type:e.type,question:e.question,options:e.options,correctAnswer:e.correctAnswer,points:e.points,difficulty:e.difficulty,explanation:e.explanation,tags:e.tags,subject:e.subject,isPublic:e.isPublic,usageCount:0})))}if(A){let i=await t.select({id:n.courseBatch.id,name:n.courseBatch.name,difficulty:n.courseBatch.difficulty,order:n.courseBatch.order}).from(n.courseBatch).where((0,a.and)((0,a.eq)(n.courseBatch.curriculumId,r),(0,a.inArray)(n.courseBatch.difficulty,[...v]))).orderBy((0,u.asc)(n.courseBatch.order)),s=new Map;for(let e of i){let t=e.difficulty;!t||s.has(t)||s.set(t,{id:e.id,name:e.name,order:e.order})}let[{maxOrder:o}]=await t.select({maxOrder:l.sql`coalesce(max(${n.courseBatch.order}), -1)`}).from(n.courseBatch).where((0,a.eq)(n.courseBatch.curriculumId,r)),c=(Number(o)??-1)+1;for(let i of v){let o=s.get(i);if(!o){let e=d.default.randomUUID();await t.insert(n.courseBatch).values({id:e,curriculumId:r,name:`Adaptive ${i[0].toUpperCase()}${i.slice(1)}`,difficulty:i,order:c,isLive:!1,maxStudents:50}),o={id:e,name:`Adaptive ${i[0].toUpperCase()}${i.slice(1)}`,order:c},s.set(i,o),c+=1}if(!o)continue;let u=`${e.nextUrl.origin}/curriculum/${r}?batch=${o.id}`;await t.update(n.courseBatch).set({meetingUrl:u}).where((0,a.eq)(n.courseBatch.id,o.id)),b.push({difficulty:i,batchId:o.id,batchName:o.name,joinLink:u})}}}),i.NextResponse.json({message:"Curriculum saved",moduleCount:g.length,lessonCount:g.reduce((e,t)=>e+(t.lessons?.length??0),0),variants:b})):i.NextResponse.json({error:"`modules` array required"},{status:400})}e.s(["GET",()=>w,"PUT",()=>y]),r()}catch(e){r(e)}},!1),347308,e=>e.a(async(t,r)=>{try{var i=e.i(78315),s=e.i(586961),o=e.i(196657),n=e.i(899733),a=e.i(233979),u=e.i(631683),l=e.i(840960),d=e.i(711373),c=e.i(699699),p=e.i(521140),m=e.i(205260),f=e.i(500249),h=e.i(431740),w=e.i(82608),y=e.i(635207),v=e.i(193695);e.i(708038);var g=e.i(447430),q=e.i(556072),R=t([q]);[q]=R.then?(await R)():R;let I=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/tutor/courses/[id]/curriculum/route",pathname:"/api/tutor/courses/[id]/curriculum",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/tutor/courses/[id]/curriculum/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:x,workUnitAsyncStorage:C,serverHooks:E}=I;function A(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:C})}async function b(e,t,r){I.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/tutor/courses/[id]/curriculum/route";i=i.replace(/\/index$/,"")||"/";let o=await I.prepare(e,t,{srcPage:i,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:q,params:R,nextConfig:A,parsedUrl:b,isDraftMode:x,prerenderManifest:C,routerServerContext:E,isOnDemandRevalidate:M,revalidateOnlyGenerated:k,resolvedPathname:z,clientReferenceManifest:P,serverActionsManifest:N}=o,U=(0,l.normalizeAppPath)(i),D=!!(C.dynamicRoutes[U]||C.routes[z]),S=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,b,!1):t.end("This page could not be found"),null);if(D&&!x){let e=!!C.routes[z],t=C.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await S();throw new v.NoFallbackError}}let B=null;!D||I.isDev||x||(B=z,B="/index"===B?"/":B);let _=!0===I.isDev||!D,O=D&&!_;N&&P&&(0,u.setManifestsSingleton)({page:i,clientReferenceManifest:P,serverActionsManifest:N});let T=e.method||"GET",L=(0,a.getTracer)(),j=L.getActiveScopeSpan(),$={params:R,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:_,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,s)=>I.onRequestError(e,t,i,s,E)},sharedContext:{buildId:q}},H=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),F=c.NextRequestAdapter.fromNodeNextRequest(H,(0,c.signalFromNodeResponse)(t));try{let o=async e=>I.handle(F,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${T} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${T} ${i}`)}),u=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let d=async({previousCacheEntry:s})=>{try{if(!u&&M&&k&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(n);e.fetchMetrics=$.renderOpts.fetchMetrics;let a=$.renderOpts.pendingWaitUntil;a&&r.waitUntil&&(r.waitUntil(a),a=void 0);let l=$.renderOpts.collectedTags;if(!D)return await (0,f.sendResponse)(H,K,i,$.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[y.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,s=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:i,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:M})},!1,E),t}},c=await I.handleResponse({req:e,nextConfig:A,cacheKey:B,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:u});if(!D)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});u||t.setHeader("x-nextjs-cache",M?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return u&&D||p.delete(y.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(H,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};j?await l(j):await L.withPropagatedContext(e.headers,()=>L.trace(p.BaseServerSpan.handleRequest,{spanName:`${T} ${i}`,kind:a.SpanKind.SERVER,attributes:{"http.method":T,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:M})},!1,E),D)throw t;return await (0,f.sendResponse)(H,K,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>A,"routeModule",()=>I,"serverHooks",()=>E,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>C]),r()}catch(e){r(e)}},!1)];

//# debugId=eaf94e7a-3150-7afb-dfe9-6172e02dfb8f
//# sourceMappingURL=ADK_WORKSPACE_TutorMekimi_tutorme-app_dfeba93f._.js.map