{
  "version": 3,
  "sources": [],
  "debugId": "6fd8b614-942a-3bb6-76c7-0632091808ee",
  "sections": [
    {"offset": {"line": 1, "column": 0}, "map": {"version":3,"sources":["../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/lib/ai/tutor-service.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/src/app/api/ai/chat/route.ts","../../../../../../ADK_WORKSPACE/TutorMekimi/tutorme-app/node_modules/next/src/build/templates/app-route.ts"],"sourcesContent":["/**\n * AI Tutor Service\n * Subject-aware tutoring with Socratic methodology\n */\n\nimport { generateWithFallback } from './orchestrator'\nimport {\n  buildSystemPrompt,\n  getSubjectContext,\n  findRelevantConcepts,\n  getCommonMistakeHelp\n} from './subjects'\nimport { MemoryService } from './memory-service'\nimport { StudentContext } from './types/context'\n\nexport interface TutorMessage {\n  role: 'system' | 'user' | 'assistant'\n  content: string\n}\n\nexport interface TutorContext {\n  studentId?: string // Link to memory service\n  subject: string\n  currentTopic?: string\n  conversationHistory: TutorMessage[]\n  knowledgeGraph?: any\n  recentQuizAttempts?: any[]\n  // NEW: Age-based teaching and voice preferences\n  teachingAge?: number\n  voiceGender?: string\n  voiceAccent?: string\n}\n\nexport interface TutorResponse {\n  message: string\n  hintType: 'socratic' | 'direct' | 'encouragement' | 'clarification'\n  relevantConcepts?: string[]\n  suggestedNextSteps?: string[]\n}\n\n/**\n * Generate a Socratic tutor response\n */\nexport async function generateTutorResponse(\n  studentMessage: string,\n  context: TutorContext\n): Promise<TutorResponse> {\n  const subjectContext = getSubjectContext(context.subject)\n\n  // Build system prompt with subject context and preferences\n  const systemPrompt = buildSystemPrompt(context.subject, {\n    teachingAge: context.teachingAge || 15,\n    voiceGender: context.voiceGender || 'female',\n    voiceAccent: context.voiceAccent || 'us'\n  })\n\n  // Fetch unified student context\n  let studentContext: StudentContext | null = null\n  if (context.studentId) {\n    try {\n      studentContext = await MemoryService.getStudentContext(context.studentId)\n    } catch (error) {\n      console.error('Failed to fetch student memory:', error)\n    }\n  }\n\n  // Find relevant concepts\n  const relevantConcepts = findRelevantConcepts(context.subject, studentMessage)\n\n  // Check for common mistakes\n  const mistakeHelp = getCommonMistakeHelp(context.subject, studentMessage)\n\n  // Build conversation context\n  let fullPrompt = `${systemPrompt}\\n\\n`\n\n  // Inject Student Context (Shared Brain)\n  if (studentContext) {\n    fullPrompt += `## Student Context (SHARED BRAIN)\\n`\n    fullPrompt += `Name: ${studentContext.profile.name} (${studentContext.profile.level})\\n`\n    fullPrompt += `Learning Style: ${studentContext.profile.learningStyle}\\n`\n    fullPrompt += `Current Mood: ${studentContext.state.currentMood}\\n`\n\n    if (studentContext.state.recentStruggles.length > 0) {\n      fullPrompt += `Recent Struggles:\\n`\n      studentContext.state.recentStruggles.forEach(s => {\n        fullPrompt += `- ${s.topic} (${s.errorType})\\n`\n      })\n      fullPrompt += `INSTRUCTION: Be extra patient with these topics. Acknowledge improvement if they do well.\\n`\n    }\n\n    if (studentContext.signals.length > 0) {\n      const recentSignals = studentContext.signals.slice(-3)\n      fullPrompt += `Recent Signals (from other agents):\\n`\n      recentSignals.forEach(s => {\n        fullPrompt += `- [${s.source}]: ${s.content}\\n`\n      })\n    }\n    fullPrompt += `\\n`\n  }\n\n  // Add relevant concepts if found\n  if (relevantConcepts.length > 0) {\n    fullPrompt += `## Relevant Concepts\\n`\n    relevantConcepts.forEach(conceptId => {\n      const concept = subjectContext.concepts.find(c => c.id === conceptId)\n      if (concept) {\n        fullPrompt += `- ${concept.name}: ${concept.description}\\n`\n      }\n    })\n    fullPrompt += `\\n`\n  }\n\n  // Add common mistake guidance if detected\n  if (mistakeHelp) {\n    fullPrompt += `## Mistake Prevention\\n${mistakeHelp}\\n\\n`\n  }\n\n  // Add conversation history\n  fullPrompt += `## Conversation History\\n`\n  context.conversationHistory.slice(-5).forEach(msg => {\n    fullPrompt += `${msg.role === 'user' ? 'Student' : 'Tutor'}: ${msg.content}\\n`\n  })\n\n  // Add current message\n  fullPrompt += `\\nStudent: ${studentMessage}\\n`\n  fullPrompt += `\\nTutor (respond as a Socratic tutor):`\n\n  // Generate response\n  const result = await generateWithFallback(fullPrompt, {\n    temperature: 0.7,\n    maxTokens: 300\n  })\n\n  // Determine hint type based on content\n  const hintType = classifyHintType(result.content)\n\n  // Extract suggested next steps if any\n  const suggestedNextSteps = extractNextSteps(result.content)\n\n  return {\n    message: result.content.trim(),\n    hintType,\n    relevantConcepts,\n    suggestedNextSteps\n  }\n}\n\n/**\n * Generate a hint for a specific concept\n */\nexport async function generateConceptHint(\n  conceptId: string,\n  subject: string,\n  difficulty: 'gentle' | 'medium' | 'strong' = 'medium'\n): Promise<string> {\n  const subjectContext = getSubjectContext(subject)\n  const concept = subjectContext.concepts.find(c => c.id === conceptId)\n\n  if (!concept) {\n    return \"Let's think about this step by step. What do you know so far?\"\n  }\n\n  const difficultyPrompts = {\n    gentle: 'Give a very gentle nudge in the right direction.',\n    medium: 'Provide a helpful hint that guides thinking.',\n    strong: 'Give a more specific hint while still requiring student work.'\n  }\n\n  const prompt = `\n    You are a ${subjectContext.name} tutor helping a student with: ${concept.name}\n    \n    Concept: ${concept.description}\n    Common misconceptions: ${concept.commonMisconceptions.join(', ')}\n    \n    ${difficultyPrompts[difficulty]}\n    \n    Provide a Socratic hint (question or guidance, NOT the answer):\n  `\n\n  const result = await generateWithFallback(prompt, {\n    temperature: 0.6,\n    maxTokens: 150\n  })\n\n  return result.content.trim()\n}\n\n/**\n * Analyze student work for errors\n */\nexport async function analyzeStudentWork(\n  problem: string,\n  studentWork: string,\n  subject: string\n): Promise<{\n  hasError: boolean\n  errorType?: string\n  feedback: string\n  correctionGuidance: string\n}> {\n  const subjectContext = getSubjectContext(subject)\n\n  const prompt = `\n    Subject: ${subjectContext.name}\n    \n    Problem: ${problem}\n    Student's work: ${studentWork}\n    \n    Common mistakes in ${subjectContext.name}:\n    ${subjectContext.commonMistakes.map(m => `- ${m.pattern}: ${m.description}`).join('\\n')}\n    \n    Analyze the student's work. If there are errors:\n    1. Identify the error type\n    2. Provide gentle feedback (don't say \"you're wrong\")\n    3. Give Socratic guidance to help them discover the error\n    \n    If the work is correct, provide encouraging feedback and suggest next steps.\n    \n    Respond in this format:\n    HAS_ERROR: true/false\n    ERROR_TYPE: [type or \"none\"]\n    FEEDBACK: [encouraging response]\n    GUIDANCE: [Socratic question to guide to correction]\n  `\n\n  const result = await generateWithFallback(prompt, {\n    temperature: 0.5,\n    maxTokens: 250\n  })\n\n  const lines = result.content.split('\\n')\n  const hasError = lines.find(l => l.includes('HAS_ERROR:'))?.includes('true') || false\n  const errorType = lines.find(l => l.includes('ERROR_TYPE:'))?.split(':')[1]?.trim()\n  const feedback = lines.find(l => l.includes('FEEDBACK:'))?.split(':').slice(1).join(':').trim() || ''\n  const correctionGuidance = lines.find(l => l.includes('GUIDANCE:'))?.split(':').slice(1).join(':').trim() || ''\n\n  return {\n    hasError,\n    errorType,\n    feedback,\n    correctionGuidance\n  }\n}\n\n/**\n * Generate encouragement message\n */\nexport async function generateEncouragement(\n  context: string,\n  subject: string\n): Promise<string> {\n  const encouragements = [\n    \"You're making great progress! Keep thinking it through.\",\n    \"That's a good insight. Let's build on that.\",\n    \"I can see you're really thinking about this - that's exactly what good learners do!\",\n    \"You're on the right track. What would happen if you tried...\",\n    \"That's an interesting approach. Let's see where it leads.\",\n    \"You're developing strong problem-solving skills!\",\n    \"Don't worry if it takes time - deep understanding comes from persistence.\",\n    \"You're asking the right questions. Keep exploring!\"\n  ]\n\n  // Could use AI to generate contextual encouragement\n  // For now, return random encouragement\n  return encouragements[Math.floor(Math.random() * encouragements.length)]\n}\n\n// Helper functions\n\nfunction classifyHintType(message: string): TutorResponse['hintType'] {\n  const lower = message.toLowerCase()\n\n  if (lower.includes('?') && (lower.includes('what') || lower.includes('how') || lower.includes('why'))) {\n    return 'socratic'\n  }\n  if (lower.includes('try') || lower.includes('consider') || lower.includes('think about')) {\n    return 'socratic'\n  }\n  if (lower.includes('well done') || lower.includes('great') || lower.includes('excellent')) {\n    return 'encouragement'\n  }\n  if (lower.includes('let me explain') || lower.includes('here\\'s how')) {\n    return 'direct'\n  }\n\n  return 'clarification'\n}\n\nfunction extractNextSteps(message: string): string[] | undefined {\n  // Look for phrases suggesting next steps\n  const patterns = [\n    /try (to |)([^.]+)/i,\n    /next, ([^.]+)/i,\n    /you could ([^.]+)/i,\n    /consider ([^.]+)/i\n  ]\n\n  const steps: string[] = []\n  patterns.forEach(pattern => {\n    const match = message.match(pattern)\n    if (match) {\n      steps.push(match[0])\n    }\n  })\n\n  return steps.length > 0 ? steps : undefined\n}\n","/**\n * AI Chat API with Subject Context\n * Chat with the AI tutor using Socratic method and subject-specific knowledge\n * \n * POST /api/ai/chat\n * Body: { message: string, subject?: string, context?: {...} }\n */\n\nimport { NextRequest, NextResponse } from 'next/server'\nimport { generateTutorResponse, TutorMessage } from '@/lib/ai/tutor-service'\nimport { getServerSession, authOptions } from '@/lib/auth'\nimport { withRateLimitPreset } from '@/lib/api/middleware'\nimport { z } from 'zod'\nimport { AISecurityManager } from '@/lib/security/ai-sanitization'\n\n// In-memory conversation storage (use Redis in production)\nconst conversationStore = new Map<string, TutorMessage[]>()\nconst MAX_CONVERSATIONS = 500\n\nconst AIChatRequestSchema = z.object({\n  message: z.string().min(1).max(2000),\n  subject: z.string().max(80).default('general'),\n  context: z.record(z.string(), z.unknown()).default({}),\n  conversationId: z.string().max(128).optional(),\n})\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { response: rateLimitResponse } = await withRateLimitPreset(request, 'aiGenerate')\n    if (rateLimitResponse) return rateLimitResponse\n\n    const session = await getServerSession(authOptions, request)\n    const body = await request.json().catch(() => null)\n    const parsed = AIChatRequestSchema.safeParse(body)\n    if (!parsed.success) {\n      return NextResponse.json({ error: 'Invalid request body' }, { status: 400 })\n    }\n    const { message, subject, context, conversationId } = parsed.data\n\n    const safeMessage = AISecurityManager.sanitizeAiInput(message)\n    if (!safeMessage) {\n      return NextResponse.json({ error: 'Invalid or empty message after sanitization' }, { status: 400 })\n    }\n\n    // Get or initialize conversation history\n    const userId = session?.user?.id || 'anonymous'\n    const convoKey = conversationId || `${userId}-${subject}`\n    \n    let conversationHistory = conversationStore.get(convoKey) || []\n    \n    // Add user message to history (sanitized)\n    conversationHistory.push({\n      role: 'user',\n      content: safeMessage\n    })\n    \n    // Keep only last 10 messages for context\n    if (conversationHistory.length > 10) {\n      conversationHistory = conversationHistory.slice(-10)\n    }\n\n    // Generate subject-aware response\n    const ctx = context as Record<string, unknown>\n    const response = await generateTutorResponse(safeMessage, {\n      subject,\n      currentTopic: (ctx.videoTitle as string) || (ctx.topic as string),\n      conversationHistory,\n      knowledgeGraph: ctx.knowledgeGraph,\n      recentQuizAttempts: ctx.recentQuizAttempts as any[]\n    })\n\n    // Add assistant response to history\n    conversationHistory.push({\n      role: 'assistant',\n      content: response.message\n    })\n    \n    // Store updated history\n    conversationStore.set(convoKey, conversationHistory)\n    if (conversationStore.size > MAX_CONVERSATIONS) {\n      const oldestKey = conversationStore.keys().next().value\n      if (oldestKey) conversationStore.delete(oldestKey)\n    }\n\n    // Validate AI response before returning\n    const validation = await AISecurityManager.validateAiResponse(response.message)\n    if (!validation.isValid && validation.severity === 'CRITICAL') {\n      return NextResponse.json(\n        { error: 'AI response failed security validation' },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({\n      response: response.message,\n      hintType: response.hintType,\n      relevantConcepts: response.relevantConcepts,\n      suggestedNextSteps: response.suggestedNextSteps,\n      conversationId: convoKey\n    })\n  } catch (error) {\n    console.error('AI chat error:', error)\n    return NextResponse.json(\n      { error: 'Failed to get AI response' },\n      { status: 500 }\n    )\n  }\n}\n\n// Get available subjects\nexport async function GET() {\n  const { getAvailableSubjects } = await import('@/lib/ai/subjects')\n  \n  return NextResponse.json({\n    subjects: getAvailableSubjects()\n  })\n}\n","import {\n  AppRouteRouteModule,\n  type AppRouteRouteHandlerContext,\n  type AppRouteRouteModuleOptions,\n} from '../../server/route-modules/app-route/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\nimport { patchFetch as _patchFetch } from '../../server/lib/patch-fetch'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\nimport { addRequestMeta, getRequestMeta } from '../../server/request-meta'\nimport { getTracer, type Span, SpanKind } from '../../server/lib/trace/tracer'\nimport { setManifestsSingleton } from '../../server/app-render/manifests-singleton'\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\nimport { NodeNextRequest, NodeNextResponse } from '../../server/base-http/node'\nimport {\n  NextRequestAdapter,\n  signalFromNodeResponse,\n} from '../../server/web/spec-extension/adapters/next-request'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport { getRevalidateReason } from '../../server/instrumentation/utils'\nimport { sendResponse } from '../../server/send-response'\nimport {\n  fromNodeOutgoingHttpHeaders,\n  toNodeOutgoingHttpHeaders,\n} from '../../server/web/utils'\nimport { getCacheControlHeader } from '../../server/lib/cache-control'\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from '../../lib/constants'\nimport { NoFallbackError } from '../../shared/lib/no-fallback-error.external'\nimport {\n  CachedRouteKind,\n  type ResponseCacheEntry,\n  type ResponseGenerator,\n} from '../../server/response-cache'\n\nimport * as userland from 'VAR_USERLAND'\n\n// These are injected by the loader afterwards. This is injected as a variable\n// instead of a replacement because this could also be `undefined` instead of\n// an empty string.\ndeclare const nextConfigOutput: AppRouteRouteModuleOptions['nextConfigOutput']\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\n// INJECT:nextConfigOutput\n\nconst routeModule = new AppRouteRouteModule({\n  definition: {\n    kind: RouteKind.APP_ROUTE,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    filename: 'VAR_DEFINITION_FILENAME',\n    bundlePath: 'VAR_DEFINITION_BUNDLE_PATH',\n  },\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n  resolvedPagePath: 'VAR_RESOLVED_PAGE_PATH',\n  nextConfigOutput,\n  userland,\n})\n\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule\n\nfunction patchFetch() {\n  return _patchFetch({\n    workAsyncStorage,\n    workUnitAsyncStorage,\n  })\n}\n\nexport {\n  routeModule,\n  workAsyncStorage,\n  workUnitAsyncStorage,\n  serverHooks,\n  patchFetch,\n}\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil: (prom: Promise<void>) => void\n  }\n) {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  } else if (srcPage === '/index') {\n    // we always normalize /index specifically\n    srcPage = '/'\n  }\n  const multiZoneDraftMode = process.env\n    .__NEXT_MULTI_ZONE_DRAFT_MODE as any as boolean\n\n  const prepareResult = await routeModule.prepare(req, res, {\n    srcPage,\n    multiZoneDraftMode,\n  })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return null\n  }\n\n  const {\n    buildId,\n    params,\n    nextConfig,\n    parsedUrl,\n    isDraftMode,\n    prerenderManifest,\n    routerServerContext,\n    isOnDemandRevalidate,\n    revalidateOnlyGenerated,\n    resolvedPathname,\n    clientReferenceManifest,\n    serverActionsManifest,\n  } = prepareResult\n\n  const normalizedSrcPage = normalizeAppPath(srcPage)\n\n  let isIsr = Boolean(\n    prerenderManifest.dynamicRoutes[normalizedSrcPage] ||\n      prerenderManifest.routes[resolvedPathname]\n  )\n\n  const render404 = async () => {\n    // TODO: should route-module itself handle rendering the 404\n    if (routerServerContext?.render404) {\n      await routerServerContext.render404(req, res, parsedUrl, false)\n    } else {\n      res.end('This page could not be found')\n    }\n    return null\n  }\n\n  if (isIsr && !isDraftMode) {\n    const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname])\n    const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage]\n\n    if (prerenderInfo) {\n      if (prerenderInfo.fallback === false && !isPrerendered) {\n        if (nextConfig.experimental.adapterPath) {\n          return await render404()\n        }\n        throw new NoFallbackError()\n      }\n    }\n  }\n\n  let cacheKey: string | null = null\n\n  if (isIsr && !routeModule.isDev && !isDraftMode) {\n    cacheKey = resolvedPathname\n    // ensure /index and / is normalized to one key\n    cacheKey = cacheKey === '/index' ? '/' : cacheKey\n  }\n\n  const supportsDynamicResponse: boolean =\n    // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true ||\n    // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr\n\n  // This is a revalidation request if the request is for a static\n  // page and it is not being resumed from a postponed render and\n  // it is not a dynamic RSC request then it is a revalidation\n  // request.\n  const isStaticGeneration = isIsr && !supportsDynamicResponse\n\n  // Before rendering (which initializes component tree modules), we have to\n  // set the reference manifests to our global store so Server Action's\n  // encryption util can access to them at the top level of the page module.\n  if (serverActionsManifest && clientReferenceManifest) {\n    setManifestsSingleton({\n      page: srcPage,\n      clientReferenceManifest,\n      serverActionsManifest,\n    })\n  }\n\n  const method = req.method || 'GET'\n  const tracer = getTracer()\n  const activeSpan = tracer.getActiveScopeSpan()\n\n  const context: AppRouteRouteHandlerContext = {\n    params,\n    prerenderManifest,\n    renderOpts: {\n      experimental: {\n        authInterrupts: Boolean(nextConfig.experimental.authInterrupts),\n      },\n      cacheComponents: Boolean(nextConfig.cacheComponents),\n      supportsDynamicResponse,\n      incrementalCache: getRequestMeta(req, 'incrementalCache'),\n      cacheLifeProfiles: nextConfig.cacheLife,\n      waitUntil: ctx.waitUntil,\n      onClose: (cb) => {\n        res.on('close', cb)\n      },\n      onAfterTaskError: undefined,\n      onInstrumentationRequestError: (\n        error,\n        _request,\n        errorContext,\n        silenceLog\n      ) =>\n        routeModule.onRequestError(\n          req,\n          error,\n          errorContext,\n          silenceLog,\n          routerServerContext\n        ),\n    },\n    sharedContext: {\n      buildId,\n    },\n  }\n  const nodeNextReq = new NodeNextRequest(req)\n  const nodeNextRes = new NodeNextResponse(res)\n\n  const nextReq = NextRequestAdapter.fromNodeNextRequest(\n    nodeNextReq,\n    signalFromNodeResponse(res)\n  )\n\n  try {\n    const invokeRouteModule = async (span?: Span) => {\n      return routeModule.handle(nextReq, context).finally(() => {\n        if (!span) return\n\n        span.setAttributes({\n          'http.status_code': res.statusCode,\n          'next.rsc': false,\n        })\n\n        const rootSpanAttributes = tracer.getRootSpanAttributes()\n        // We were unable to get attributes, probably OTEL is not enabled\n        if (!rootSpanAttributes) {\n          return\n        }\n\n        if (\n          rootSpanAttributes.get('next.span_type') !==\n          BaseServerSpan.handleRequest\n        ) {\n          console.warn(\n            `Unexpected root span type '${rootSpanAttributes.get(\n              'next.span_type'\n            )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n          )\n          return\n        }\n\n        const route = rootSpanAttributes.get('next.route')\n        if (route) {\n          const name = `${method} ${route}`\n\n          span.setAttributes({\n            'next.route': route,\n            'http.route': route,\n            'next.span_name': name,\n          })\n          span.updateName(name)\n        } else {\n          span.updateName(`${method} ${srcPage}`)\n        }\n      })\n    }\n    const isMinimalMode = Boolean(\n      process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode')\n    )\n\n    const handleResponse = async (currentSpan?: Span) => {\n      const responseGenerator: ResponseGenerator = async ({\n        previousCacheEntry,\n      }) => {\n        try {\n          if (\n            !isMinimalMode &&\n            isOnDemandRevalidate &&\n            revalidateOnlyGenerated &&\n            !previousCacheEntry\n          ) {\n            res.statusCode = 404\n            // on-demand revalidate always sets this header\n            res.setHeader('x-nextjs-cache', 'REVALIDATED')\n            res.end('This page could not be found')\n            return null\n          }\n\n          const response = await invokeRouteModule(currentSpan)\n\n          ;(req as any).fetchMetrics = (context.renderOpts as any).fetchMetrics\n          let pendingWaitUntil = context.renderOpts.pendingWaitUntil\n\n          // Attempt using provided waitUntil if available\n          // if it's not we fallback to sendResponse's handling\n          if (pendingWaitUntil) {\n            if (ctx.waitUntil) {\n              ctx.waitUntil(pendingWaitUntil)\n              pendingWaitUntil = undefined\n            }\n          }\n          const cacheTags = context.renderOpts.collectedTags\n\n          // If the request is for a static response, we can cache it so long\n          // as it's not edge.\n          if (isIsr) {\n            const blob = await response.blob()\n\n            // Copy the headers from the response.\n            const headers = toNodeOutgoingHttpHeaders(response.headers)\n\n            if (cacheTags) {\n              headers[NEXT_CACHE_TAGS_HEADER] = cacheTags\n            }\n\n            if (!headers['content-type'] && blob.type) {\n              headers['content-type'] = blob.type\n            }\n\n            const revalidate =\n              typeof context.renderOpts.collectedRevalidate === 'undefined' ||\n              context.renderOpts.collectedRevalidate >= INFINITE_CACHE\n                ? false\n                : context.renderOpts.collectedRevalidate\n\n            const expire =\n              typeof context.renderOpts.collectedExpire === 'undefined' ||\n              context.renderOpts.collectedExpire >= INFINITE_CACHE\n                ? undefined\n                : context.renderOpts.collectedExpire\n\n            // Create the cache entry for the response.\n            const cacheEntry: ResponseCacheEntry = {\n              value: {\n                kind: CachedRouteKind.APP_ROUTE,\n                status: response.status,\n                body: Buffer.from(await blob.arrayBuffer()),\n                headers,\n              },\n              cacheControl: { revalidate, expire },\n            }\n\n            return cacheEntry\n          } else {\n            // send response without caching if not ISR\n            await sendResponse(\n              nodeNextReq,\n              nodeNextRes,\n              response,\n              context.renderOpts.pendingWaitUntil\n            )\n            return null\n          }\n        } catch (err) {\n          // if this is a background revalidate we need to report\n          // the request error here as it won't be bubbled\n          if (previousCacheEntry?.isStale) {\n            const silenceLog = false\n            await routeModule.onRequestError(\n              req,\n              err,\n              {\n                routerKind: 'App Router',\n                routePath: srcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                  isStaticGeneration,\n                  isOnDemandRevalidate,\n                }),\n              },\n              silenceLog,\n              routerServerContext\n            )\n          }\n          throw err\n        }\n      }\n\n      const cacheEntry = await routeModule.handleResponse({\n        req,\n        nextConfig,\n        cacheKey,\n        routeKind: RouteKind.APP_ROUTE,\n        isFallback: false,\n        prerenderManifest,\n        isRoutePPREnabled: false,\n        isOnDemandRevalidate,\n        revalidateOnlyGenerated,\n        responseGenerator,\n        waitUntil: ctx.waitUntil,\n        isMinimalMode,\n      })\n\n      // we don't create a cacheEntry for ISR\n      if (!isIsr) {\n        return null\n      }\n\n      if (cacheEntry?.value?.kind !== CachedRouteKind.APP_ROUTE) {\n        throw new Error(\n          `Invariant: app-route received invalid cache entry ${cacheEntry?.value?.kind}`\n        )\n      }\n\n      if (!isMinimalMode) {\n        res.setHeader(\n          'x-nextjs-cache',\n          isOnDemandRevalidate\n            ? 'REVALIDATED'\n            : cacheEntry.isMiss\n              ? 'MISS'\n              : cacheEntry.isStale\n                ? 'STALE'\n                : 'HIT'\n        )\n      }\n\n      // Draft mode should never be cached\n      if (isDraftMode) {\n        res.setHeader(\n          'Cache-Control',\n          'private, no-cache, no-store, max-age=0, must-revalidate'\n        )\n      }\n\n      const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers)\n\n      if (!(isMinimalMode && isIsr)) {\n        headers.delete(NEXT_CACHE_TAGS_HEADER)\n      }\n\n      // If cache control is already set on the response we don't\n      // override it to allow users to customize it via next.config\n      if (\n        cacheEntry.cacheControl &&\n        !res.getHeader('Cache-Control') &&\n        !headers.get('Cache-Control')\n      ) {\n        headers.set(\n          'Cache-Control',\n          getCacheControlHeader(cacheEntry.cacheControl)\n        )\n      }\n\n      await sendResponse(\n        nodeNextReq,\n        nodeNextRes,\n        // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n        new Response(cacheEntry.value.body, {\n          headers,\n          status: cacheEntry.value.status || 200,\n        })\n      )\n      return null\n    }\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await handleResponse(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          handleResponse\n        )\n      )\n    }\n  } catch (err) {\n    if (!(err instanceof NoFallbackError)) {\n      const silenceLog = false\n      await routeModule.onRequestError(\n        req,\n        err,\n        {\n          routerKind: 'App Router',\n          routePath: normalizedSrcPage,\n          routeType: 'route',\n          revalidateReason: getRevalidateReason({\n            isStaticGeneration,\n            isOnDemandRevalidate,\n          }),\n        },\n        silenceLog,\n        routerServerContext\n      )\n    }\n\n    // rethrow so that we can handle serving error page\n\n    // If this is during static generation, throw the error again.\n    if (isIsr) throw err\n\n    // Otherwise, send a 500 response.\n    await sendResponse(\n      nodeNextReq,\n      nodeNextRes,\n      new Response(null, { status: 500 })\n    )\n    return null\n  }\n}\n"],"names":["AppRouteRouteModule","RouteKind","patchFetch","_patchFetch","addRequestMeta","getRequestMeta","getTracer","SpanKind","setManifestsSingleton","normalizeAppPath","NodeNextRequest","NodeNextResponse","NextRequestAdapter","signalFromNodeResponse","BaseServerSpan","getRevalidateReason","sendResponse","fromNodeOutgoingHttpHeaders","toNodeOutgoingHttpHeaders","getCacheControlHeader","INFINITE_CACHE","NEXT_CACHE_TAGS_HEADER","NoFallbackError","CachedRouteKind","userland","routeModule","definition","kind","APP_ROUTE","page","pathname","filename","bundlePath","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","resolvedPagePath","nextConfigOutput","workAsyncStorage","workUnitAsyncStorage","serverHooks","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","multiZoneDraftMode","__NEXT_MULTI_ZONE_DRAFT_MODE","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","buildId","params","nextConfig","parsedUrl","isDraftMode","prerenderManifest","routerServerContext","isOnDemandRevalidate","revalidateOnlyGenerated","resolvedPathname","clientReferenceManifest","serverActionsManifest","normalizedSrcPage","isIsr","Boolean","dynamicRoutes","routes","render404","isPrerendered","prerenderInfo","fallback","experimental","adapterPath","cacheKey","supportsDynamicResponse","isStaticGeneration","method","tracer","activeSpan","getActiveScopeSpan","context","renderOpts","authInterrupts","cacheComponents","incrementalCache","cacheLifeProfiles","cacheLife","onClose","cb","on","onAfterTaskError","undefined","onInstrumentationRequestError","error","_request","errorContext","silenceLog","onRequestError","sharedContext","nodeNextReq","nodeNextRes","nextReq","fromNodeNextRequest","invokeRouteModule","span","handle","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","isMinimalMode","MINIMAL_MODE","handleResponse","currentSpan","cacheEntry","responseGenerator","previousCacheEntry","setHeader","response","fetchMetrics","pendingWaitUntil","cacheTags","collectedTags","blob","headers","type","revalidate","collectedRevalidate","expire","collectedExpire","value","status","body","Buffer","from","arrayBuffer","cacheControl","err","isStale","routerKind","routePath","routeType","revalidateReason","routeKind","isFallback","isRoutePPREnabled","Error","isMiss","delete","getHeader","set","Response","withPropagatedContext","trace","spanName","SERVER","attributes","url"],"mappings":"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","ignoreList":[2]}}]
}